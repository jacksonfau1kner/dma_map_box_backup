(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))g(w);new MutationObserver(w=>{for(const M of w)if(M.type==="childList")for(const k of M.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&g(k)}).observe(document,{childList:!0,subtree:!0});function h(w){const M={};return w.integrity&&(M.integrity=w.integrity),w.referrerPolicy&&(M.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?M.credentials="include":w.crossOrigin==="anonymous"?M.credentials="omit":M.credentials="same-origin",M}function g(w){if(w.ep)return;w.ep=!0;const M=h(w);fetch(w.href,M)}})();function kp(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Im={exports:{}},Kh={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Am,iy;function Tg(){if(iy)return Am;iy=1;var c=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable;function g(M){if(M==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(M)}function w(){try{if(!Object.assign)return!1;var M=new String("abc");if(M[5]="de",Object.getOwnPropertyNames(M)[0]==="5")return!1;for(var k={},R=0;R<10;R++)k["_"+String.fromCharCode(R)]=R;var o=Object.getOwnPropertyNames(k).map(function(ne){return k[ne]});if(o.join("")!=="0123456789")return!1;var G={};return"abcdefghijklmnopqrst".split("").forEach(function(ne){G[ne]=ne}),Object.keys(Object.assign({},G)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return Am=w()?Object.assign:function(M,k){for(var R,o=g(M),G,ne=1;ne<arguments.length;ne++){R=Object(arguments[ne]);for(var oe in R)s.call(R,oe)&&(o[oe]=R[oe]);if(c){G=c(R);for(var $=0;$<G.length;$++)h.call(R,G[$])&&(o[G[$]]=R[G[$]])}}return o},Am}var km={exports:{}},Yn={};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oy;function H0(){if(oy)return Yn;oy=1;var c=Tg(),s=60103,h=60106;Yn.Fragment=60107,Yn.StrictMode=60108,Yn.Profiler=60114;var g=60109,w=60110,M=60112;Yn.Suspense=60113;var k=60115,R=60116;if(typeof Symbol=="function"&&Symbol.for){var o=Symbol.for;s=o("react.element"),h=o("react.portal"),Yn.Fragment=o("react.fragment"),Yn.StrictMode=o("react.strict_mode"),Yn.Profiler=o("react.profiler"),g=o("react.provider"),w=o("react.context"),M=o("react.forward_ref"),Yn.Suspense=o("react.suspense"),k=o("react.memo"),R=o("react.lazy")}var G=typeof Symbol=="function"&&Symbol.iterator;function ne(Fe){return Fe===null||typeof Fe!="object"?null:(Fe=G&&Fe[G]||Fe["@@iterator"],typeof Fe=="function"?Fe:null)}function oe(Fe){for(var gt="https://reactjs.org/docs/error-decoder.html?invariant="+Fe,Qt=1;Qt<arguments.length;Qt++)gt+="&args[]="+encodeURIComponent(arguments[Qt]);return"Minified React error #"+Fe+"; visit "+gt+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var $={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},de={};function H(Fe,gt,Qt){this.props=Fe,this.context=gt,this.refs=de,this.updater=Qt||$}H.prototype.isReactComponent={},H.prototype.setState=function(Fe,gt){if(typeof Fe!="object"&&typeof Fe!="function"&&Fe!=null)throw Error(oe(85));this.updater.enqueueSetState(this,Fe,gt,"setState")},H.prototype.forceUpdate=function(Fe){this.updater.enqueueForceUpdate(this,Fe,"forceUpdate")};function Te(){}Te.prototype=H.prototype;function Me(Fe,gt,Qt){this.props=Fe,this.context=gt,this.refs=de,this.updater=Qt||$}var je=Me.prototype=new Te;je.constructor=Me,c(je,H.prototype),je.isPureReactComponent=!0;var He={current:null},Ve=Object.prototype.hasOwnProperty,Xe={key:!0,ref:!0,__self:!0,__source:!0};function $e(Fe,gt,Qt){var vn,ut={},st=null,wt=null;if(gt!=null)for(vn in gt.ref!==void 0&&(wt=gt.ref),gt.key!==void 0&&(st=""+gt.key),gt)Ve.call(gt,vn)&&!Xe.hasOwnProperty(vn)&&(ut[vn]=gt[vn]);var Wt=arguments.length-2;if(Wt===1)ut.children=Qt;else if(1<Wt){for(var Jt=Array(Wt),nr=0;nr<Wt;nr++)Jt[nr]=arguments[nr+2];ut.children=Jt}if(Fe&&Fe.defaultProps)for(vn in Wt=Fe.defaultProps,Wt)ut[vn]===void 0&&(ut[vn]=Wt[vn]);return{$$typeof:s,type:Fe,key:st,ref:wt,props:ut,_owner:He.current}}function Ze(Fe,gt){return{$$typeof:s,type:Fe.type,key:gt,ref:Fe.ref,props:Fe.props,_owner:Fe._owner}}function xt(Fe){return typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===s}function It(Fe){var gt={"=":"=0",":":"=2"};return"$"+Fe.replace(/[=:]/g,function(Qt){return gt[Qt]})}var Pt=/\/+/g;function Ot(Fe,gt){return typeof Fe=="object"&&Fe!==null&&Fe.key!=null?It(""+Fe.key):gt.toString(36)}function Yt(Fe,gt,Qt,vn,ut){var st=typeof Fe;(st==="undefined"||st==="boolean")&&(Fe=null);var wt=!1;if(Fe===null)wt=!0;else switch(st){case"string":case"number":wt=!0;break;case"object":switch(Fe.$$typeof){case s:case h:wt=!0}}if(wt)return wt=Fe,ut=ut(wt),Fe=vn===""?"."+Ot(wt,0):vn,Array.isArray(ut)?(Qt="",Fe!=null&&(Qt=Fe.replace(Pt,"$&/")+"/"),Yt(ut,gt,Qt,"",function(nr){return nr})):ut!=null&&(xt(ut)&&(ut=Ze(ut,Qt+(!ut.key||wt&&wt.key===ut.key?"":(""+ut.key).replace(Pt,"$&/")+"/")+Fe)),gt.push(ut)),1;if(wt=0,vn=vn===""?".":vn+":",Array.isArray(Fe))for(var Wt=0;Wt<Fe.length;Wt++){st=Fe[Wt];var Jt=vn+Ot(st,Wt);wt+=Yt(st,gt,Qt,Jt,ut)}else if(Jt=ne(Fe),typeof Jt=="function")for(Fe=Jt.call(Fe),Wt=0;!(st=Fe.next()).done;)st=st.value,Jt=vn+Ot(st,Wt++),wt+=Yt(st,gt,Qt,Jt,ut);else if(st==="object")throw gt=""+Fe,Error(oe(31,gt==="[object Object]"?"object with keys {"+Object.keys(Fe).join(", ")+"}":gt));return wt}function Nt(Fe,gt,Qt){if(Fe==null)return Fe;var vn=[],ut=0;return Yt(Fe,vn,"","",function(st){return gt.call(Qt,st,ut++)}),vn}function $t(Fe){if(Fe._status===-1){var gt=Fe._result;gt=gt(),Fe._status=0,Fe._result=gt,gt.then(function(Qt){Fe._status===0&&(Qt=Qt.default,Fe._status=1,Fe._result=Qt)},function(Qt){Fe._status===0&&(Fe._status=2,Fe._result=Qt)})}if(Fe._status===1)return Fe._result;throw Fe._result}var Et={current:null};function yn(){var Fe=Et.current;if(Fe===null)throw Error(oe(321));return Fe}var Dr={ReactCurrentDispatcher:Et,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:He,IsSomeRendererActing:{current:!1},assign:c};return Yn.Children={map:Nt,forEach:function(Fe,gt,Qt){Nt(Fe,function(){gt.apply(this,arguments)},Qt)},count:function(Fe){var gt=0;return Nt(Fe,function(){gt++}),gt},toArray:function(Fe){return Nt(Fe,function(gt){return gt})||[]},only:function(Fe){if(!xt(Fe))throw Error(oe(143));return Fe}},Yn.Component=H,Yn.PureComponent=Me,Yn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Dr,Yn.cloneElement=function(Fe,gt,Qt){if(Fe==null)throw Error(oe(267,Fe));var vn=c({},Fe.props),ut=Fe.key,st=Fe.ref,wt=Fe._owner;if(gt!=null){if(gt.ref!==void 0&&(st=gt.ref,wt=He.current),gt.key!==void 0&&(ut=""+gt.key),Fe.type&&Fe.type.defaultProps)var Wt=Fe.type.defaultProps;for(Jt in gt)Ve.call(gt,Jt)&&!Xe.hasOwnProperty(Jt)&&(vn[Jt]=gt[Jt]===void 0&&Wt!==void 0?Wt[Jt]:gt[Jt])}var Jt=arguments.length-2;if(Jt===1)vn.children=Qt;else if(1<Jt){Wt=Array(Jt);for(var nr=0;nr<Jt;nr++)Wt[nr]=arguments[nr+2];vn.children=Wt}return{$$typeof:s,type:Fe.type,key:ut,ref:st,props:vn,_owner:wt}},Yn.createContext=function(Fe,gt){return gt===void 0&&(gt=null),Fe={$$typeof:w,_calculateChangedBits:gt,_currentValue:Fe,_currentValue2:Fe,_threadCount:0,Provider:null,Consumer:null},Fe.Provider={$$typeof:g,_context:Fe},Fe.Consumer=Fe},Yn.createElement=$e,Yn.createFactory=function(Fe){var gt=$e.bind(null,Fe);return gt.type=Fe,gt},Yn.createRef=function(){return{current:null}},Yn.forwardRef=function(Fe){return{$$typeof:M,render:Fe}},Yn.isValidElement=xt,Yn.lazy=function(Fe){return{$$typeof:R,_payload:{_status:-1,_result:Fe},_init:$t}},Yn.memo=function(Fe,gt){return{$$typeof:k,type:Fe,compare:gt===void 0?null:gt}},Yn.useCallback=function(Fe,gt){return yn().useCallback(Fe,gt)},Yn.useContext=function(Fe,gt){return yn().useContext(Fe,gt)},Yn.useDebugValue=function(){},Yn.useEffect=function(Fe,gt){return yn().useEffect(Fe,gt)},Yn.useImperativeHandle=function(Fe,gt,Qt){return yn().useImperativeHandle(Fe,gt,Qt)},Yn.useLayoutEffect=function(Fe,gt){return yn().useLayoutEffect(Fe,gt)},Yn.useMemo=function(Fe,gt){return yn().useMemo(Fe,gt)},Yn.useReducer=function(Fe,gt,Qt){return yn().useReducer(Fe,gt,Qt)},Yn.useRef=function(Fe){return yn().useRef(Fe)},Yn.useState=function(Fe){return yn().useState(Fe)},Yn.version="17.0.2",Yn}var sy;function vf(){return sy||(sy=1,km.exports=H0()),km.exports}/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ay;function Y0(){if(ay)return Kh;ay=1,Tg();var c=vf(),s=60103;if(Kh.Fragment=60107,typeof Symbol=="function"&&Symbol.for){var h=Symbol.for;s=h("react.element"),Kh.Fragment=h("react.fragment")}var g=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,w=Object.prototype.hasOwnProperty,M={key:!0,ref:!0,__self:!0,__source:!0};function k(R,o,G){var ne,oe={},$=null,de=null;G!==void 0&&($=""+G),o.key!==void 0&&($=""+o.key),o.ref!==void 0&&(de=o.ref);for(ne in o)w.call(o,ne)&&!M.hasOwnProperty(ne)&&(oe[ne]=o[ne]);if(R&&R.defaultProps)for(ne in o=R.defaultProps,o)oe[ne]===void 0&&(oe[ne]=o[ne]);return{$$typeof:s,type:R,key:$,ref:de,props:oe,_owner:g.current}}return Kh.jsx=k,Kh.jsxs=k,Kh}var ly;function Hv(){return ly||(ly=1,Im.exports=Y0()),Im.exports}var Un=Hv(),lt=vf();const Yv=kp(lt);var zm={exports:{}},Ps={},Dm={exports:{}},Lm={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uy;function K0(){return uy||(uy=1,function(c){var s,h,g,w;if(typeof performance=="object"&&typeof performance.now=="function"){var M=performance;c.unstable_now=function(){return M.now()}}else{var k=Date,R=k.now();c.unstable_now=function(){return k.now()-R}}if(typeof window>"u"||typeof MessageChannel!="function"){var o=null,G=null,ne=function(){if(o!==null)try{var ut=c.unstable_now();o(!0,ut),o=null}catch(st){throw setTimeout(ne,0),st}};s=function(ut){o!==null?setTimeout(s,0,ut):(o=ut,setTimeout(ne,0))},h=function(ut,st){G=setTimeout(ut,st)},g=function(){clearTimeout(G)},c.unstable_shouldYield=function(){return!1},w=c.unstable_forceFrameRate=function(){}}else{var oe=window.setTimeout,$=window.clearTimeout;if(typeof console<"u"){var de=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof de!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var H=!1,Te=null,Me=-1,je=5,He=0;c.unstable_shouldYield=function(){return c.unstable_now()>=He},w=function(){},c.unstable_forceFrameRate=function(ut){0>ut||125<ut?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):je=0<ut?Math.floor(1e3/ut):5};var Ve=new MessageChannel,Xe=Ve.port2;Ve.port1.onmessage=function(){if(Te!==null){var ut=c.unstable_now();He=ut+je;try{Te(!0,ut)?Xe.postMessage(null):(H=!1,Te=null)}catch(st){throw Xe.postMessage(null),st}}else H=!1},s=function(ut){Te=ut,H||(H=!0,Xe.postMessage(null))},h=function(ut,st){Me=oe(function(){ut(c.unstable_now())},st)},g=function(){$(Me),Me=-1}}function $e(ut,st){var wt=ut.length;ut.push(st);e:for(;;){var Wt=wt-1>>>1,Jt=ut[Wt];if(Jt!==void 0&&0<It(Jt,st))ut[Wt]=st,ut[wt]=Jt,wt=Wt;else break e}}function Ze(ut){return ut=ut[0],ut===void 0?null:ut}function xt(ut){var st=ut[0];if(st!==void 0){var wt=ut.pop();if(wt!==st){ut[0]=wt;e:for(var Wt=0,Jt=ut.length;Wt<Jt;){var nr=2*(Wt+1)-1,On=ut[nr],ar=nr+1,Pn=ut[ar];if(On!==void 0&&0>It(On,wt))Pn!==void 0&&0>It(Pn,On)?(ut[Wt]=Pn,ut[ar]=wt,Wt=ar):(ut[Wt]=On,ut[nr]=wt,Wt=nr);else if(Pn!==void 0&&0>It(Pn,wt))ut[Wt]=Pn,ut[ar]=wt,Wt=ar;else break e}}return st}return null}function It(ut,st){var wt=ut.sortIndex-st.sortIndex;return wt!==0?wt:ut.id-st.id}var Pt=[],Ot=[],Yt=1,Nt=null,$t=3,Et=!1,yn=!1,Dr=!1;function Fe(ut){for(var st=Ze(Ot);st!==null;){if(st.callback===null)xt(Ot);else if(st.startTime<=ut)xt(Ot),st.sortIndex=st.expirationTime,$e(Pt,st);else break;st=Ze(Ot)}}function gt(ut){if(Dr=!1,Fe(ut),!yn)if(Ze(Pt)!==null)yn=!0,s(Qt);else{var st=Ze(Ot);st!==null&&h(gt,st.startTime-ut)}}function Qt(ut,st){yn=!1,Dr&&(Dr=!1,g()),Et=!0;var wt=$t;try{for(Fe(st),Nt=Ze(Pt);Nt!==null&&(!(Nt.expirationTime>st)||ut&&!c.unstable_shouldYield());){var Wt=Nt.callback;if(typeof Wt=="function"){Nt.callback=null,$t=Nt.priorityLevel;var Jt=Wt(Nt.expirationTime<=st);st=c.unstable_now(),typeof Jt=="function"?Nt.callback=Jt:Nt===Ze(Pt)&&xt(Pt),Fe(st)}else xt(Pt);Nt=Ze(Pt)}if(Nt!==null)var nr=!0;else{var On=Ze(Ot);On!==null&&h(gt,On.startTime-st),nr=!1}return nr}finally{Nt=null,$t=wt,Et=!1}}var vn=w;c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(ut){ut.callback=null},c.unstable_continueExecution=function(){yn||Et||(yn=!0,s(Qt))},c.unstable_getCurrentPriorityLevel=function(){return $t},c.unstable_getFirstCallbackNode=function(){return Ze(Pt)},c.unstable_next=function(ut){switch($t){case 1:case 2:case 3:var st=3;break;default:st=$t}var wt=$t;$t=st;try{return ut()}finally{$t=wt}},c.unstable_pauseExecution=function(){},c.unstable_requestPaint=vn,c.unstable_runWithPriority=function(ut,st){switch(ut){case 1:case 2:case 3:case 4:case 5:break;default:ut=3}var wt=$t;$t=ut;try{return st()}finally{$t=wt}},c.unstable_scheduleCallback=function(ut,st,wt){var Wt=c.unstable_now();switch(typeof wt=="object"&&wt!==null?(wt=wt.delay,wt=typeof wt=="number"&&0<wt?Wt+wt:Wt):wt=Wt,ut){case 1:var Jt=-1;break;case 2:Jt=250;break;case 5:Jt=1073741823;break;case 4:Jt=1e4;break;default:Jt=5e3}return Jt=wt+Jt,ut={id:Yt++,callback:st,priorityLevel:ut,startTime:wt,expirationTime:Jt,sortIndex:-1},wt>Wt?(ut.sortIndex=wt,$e(Ot,ut),Ze(Pt)===null&&ut===Ze(Ot)&&(Dr?g():Dr=!0,h(gt,wt-Wt))):(ut.sortIndex=Jt,$e(Pt,ut),yn||Et||(yn=!0,s(Qt))),ut},c.unstable_wrapCallback=function(ut){var st=$t;return function(){var wt=$t;$t=st;try{return ut.apply(this,arguments)}finally{$t=wt}}}}(Lm)),Lm}var cy;function J0(){return cy||(cy=1,Dm.exports=K0()),Dm.exports}/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hy;function Q0(){if(hy)return Ps;hy=1;var c=vf(),s=Tg(),h=J0();function g(a){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+a,y=1;y<arguments.length;y++)d+="&args[]="+encodeURIComponent(arguments[y]);return"Minified React error #"+a+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!c)throw Error(g(227));var w=new Set,M={};function k(a,d){R(a,d),R(a+"Capture",d)}function R(a,d){for(M[a]=d,a=0;a<d.length;a++)w.add(d[a])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),G=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ne=Object.prototype.hasOwnProperty,oe={},$={};function de(a){return ne.call($,a)?!0:ne.call(oe,a)?!1:G.test(a)?$[a]=!0:(oe[a]=!0,!1)}function H(a,d,y,C){if(y!==null&&y.type===0)return!1;switch(typeof d){case"function":case"symbol":return!0;case"boolean":return C?!1:y!==null?!y.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function Te(a,d,y,C){if(d===null||typeof d>"u"||H(a,d,y,C))return!0;if(C)return!1;if(y!==null)switch(y.type){case 3:return!d;case 4:return d===!1;case 5:return isNaN(d);case 6:return isNaN(d)||1>d}return!1}function Me(a,d,y,C,L,j,Y){this.acceptsBooleans=d===2||d===3||d===4,this.attributeName=C,this.attributeNamespace=L,this.mustUseProperty=y,this.propertyName=a,this.type=d,this.sanitizeURL=j,this.removeEmptyString=Y}var je={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){je[a]=new Me(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var d=a[0];je[d]=new Me(d,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){je[a]=new Me(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){je[a]=new Me(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){je[a]=new Me(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){je[a]=new Me(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){je[a]=new Me(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){je[a]=new Me(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){je[a]=new Me(a,5,!1,a.toLowerCase(),null,!1,!1)});var He=/[\-:]([a-z])/g;function Ve(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var d=a.replace(He,Ve);je[d]=new Me(d,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var d=a.replace(He,Ve);je[d]=new Me(d,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var d=a.replace(He,Ve);je[d]=new Me(d,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){je[a]=new Me(a,1,!1,a.toLowerCase(),null,!1,!1)}),je.xlinkHref=new Me("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){je[a]=new Me(a,1,!1,a.toLowerCase(),null,!0,!0)});function Xe(a,d,y,C){var L=je.hasOwnProperty(d)?je[d]:null,j=L!==null?L.type===0:C?!1:!(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N");j||(Te(d,y,L,C)&&(y=null),C||L===null?de(d)&&(y===null?a.removeAttribute(d):a.setAttribute(d,""+y)):L.mustUseProperty?a[L.propertyName]=y===null?L.type===3?!1:"":y:(d=L.attributeName,C=L.attributeNamespace,y===null?a.removeAttribute(d):(L=L.type,y=L===3||L===4&&y===!0?"":""+y,C?a.setAttributeNS(C,d,y):a.setAttribute(d,y))))}var $e=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ze=60103,xt=60106,It=60107,Pt=60108,Ot=60114,Yt=60109,Nt=60110,$t=60112,Et=60113,yn=60120,Dr=60115,Fe=60116,gt=60121,Qt=60128,vn=60129,ut=60130,st=60131;if(typeof Symbol=="function"&&Symbol.for){var wt=Symbol.for;Ze=wt("react.element"),xt=wt("react.portal"),It=wt("react.fragment"),Pt=wt("react.strict_mode"),Ot=wt("react.profiler"),Yt=wt("react.provider"),Nt=wt("react.context"),$t=wt("react.forward_ref"),Et=wt("react.suspense"),yn=wt("react.suspense_list"),Dr=wt("react.memo"),Fe=wt("react.lazy"),gt=wt("react.block"),wt("react.scope"),Qt=wt("react.opaque.id"),vn=wt("react.debug_trace_mode"),ut=wt("react.offscreen"),st=wt("react.legacy_hidden")}var Wt=typeof Symbol=="function"&&Symbol.iterator;function Jt(a){return a===null||typeof a!="object"?null:(a=Wt&&a[Wt]||a["@@iterator"],typeof a=="function"?a:null)}var nr;function On(a){if(nr===void 0)try{throw Error()}catch(y){var d=y.stack.trim().match(/\n( *(at )?)/);nr=d&&d[1]||""}return`
`+nr+a}var ar=!1;function Pn(a,d){if(!a||ar)return"";ar=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(Ee){var C=Ee}Reflect.construct(a,[],d)}else{try{d.call()}catch(Ee){C=Ee}a.call(d.prototype)}else{try{throw Error()}catch(Ee){C=Ee}a()}}catch(Ee){if(Ee&&C&&typeof Ee.stack=="string"){for(var L=Ee.stack.split(`
`),j=C.stack.split(`
`),Y=L.length-1,ce=j.length-1;1<=Y&&0<=ce&&L[Y]!==j[ce];)ce--;for(;1<=Y&&0<=ce;Y--,ce--)if(L[Y]!==j[ce]){if(Y!==1||ce!==1)do if(Y--,ce--,0>ce||L[Y]!==j[ce])return`
`+L[Y].replace(" at new "," at ");while(1<=Y&&0<=ce);break}}}finally{ar=!1,Error.prepareStackTrace=y}return(a=a?a.displayName||a.name:"")?On(a):""}function Lr(a){switch(a.tag){case 5:return On(a.type);case 16:return On("Lazy");case 13:return On("Suspense");case 19:return On("SuspenseList");case 0:case 2:case 15:return a=Pn(a.type,!1),a;case 11:return a=Pn(a.type.render,!1),a;case 22:return a=Pn(a.type._render,!1),a;case 1:return a=Pn(a.type,!0),a;default:return""}}function Ai(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case It:return"Fragment";case xt:return"Portal";case Ot:return"Profiler";case Pt:return"StrictMode";case Et:return"Suspense";case yn:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case Nt:return(a.displayName||"Context")+".Consumer";case Yt:return(a._context.displayName||"Context")+".Provider";case $t:var d=a.render;return d=d.displayName||d.name||"",a.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case Dr:return Ai(a.type);case gt:return Ai(a._render);case Fe:d=a._payload,a=a._init;try{return Ai(a(d))}catch{}}return null}function Vr(a){switch(typeof a){case"boolean":case"number":case"object":case"string":case"undefined":return a;default:return""}}function yo(a){var d=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function no(a){var d=yo(a)?"checked":"value",y=Object.getOwnPropertyDescriptor(a.constructor.prototype,d),C=""+a[d];if(!a.hasOwnProperty(d)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var L=y.get,j=y.set;return Object.defineProperty(a,d,{configurable:!0,get:function(){return L.call(this)},set:function(Y){C=""+Y,j.call(this,Y)}}),Object.defineProperty(a,d,{enumerable:y.enumerable}),{getValue:function(){return C},setValue:function(Y){C=""+Y},stopTracking:function(){a._valueTracker=null,delete a[d]}}}}function en(a){a._valueTracker||(a._valueTracker=no(a))}function cr(a){if(!a)return!1;var d=a._valueTracker;if(!d)return!0;var y=d.getValue(),C="";return a&&(C=yo(a)?a.checked?"true":"false":a.value),a=C,a!==y?(d.setValue(a),!0):!1}function $r(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function Oo(a,d){var y=d.checked;return s({},d,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:y??a._wrapperState.initialChecked})}function is(a,d){var y=d.defaultValue==null?"":d.defaultValue,C=d.checked!=null?d.checked:d.defaultChecked;y=Vr(d.value!=null?d.value:y),a._wrapperState={initialChecked:C,initialValue:y,controlled:d.type==="checkbox"||d.type==="radio"?d.checked!=null:d.value!=null}}function vo(a,d){d=d.checked,d!=null&&Xe(a,"checked",d,!1)}function rn(a,d){vo(a,d);var y=Vr(d.value),C=d.type;if(y!=null)C==="number"?(y===0&&a.value===""||a.value!=y)&&(a.value=""+y):a.value!==""+y&&(a.value=""+y);else if(C==="submit"||C==="reset"){a.removeAttribute("value");return}d.hasOwnProperty("value")?Ni(a,d.type,y):d.hasOwnProperty("defaultValue")&&Ni(a,d.type,Vr(d.defaultValue)),d.checked==null&&d.defaultChecked!=null&&(a.defaultChecked=!!d.defaultChecked)}function xo(a,d,y){if(d.hasOwnProperty("value")||d.hasOwnProperty("defaultValue")){var C=d.type;if(!(C!=="submit"&&C!=="reset"||d.value!==void 0&&d.value!==null))return;d=""+a._wrapperState.initialValue,y||d===a.value||(a.value=d),a.defaultValue=d}y=a.name,y!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,y!==""&&(a.name=y)}function Ni(a,d,y){(d!=="number"||$r(a.ownerDocument)!==a)&&(y==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+y&&(a.defaultValue=""+y))}function os(a){var d="";return c.Children.forEach(a,function(y){y!=null&&(d+=y)}),d}function Bo(a,d){return a=s({children:void 0},d),(d=os(d.children))&&(a.children=d),a}function qn(a,d,y,C){if(a=a.options,d){d={};for(var L=0;L<y.length;L++)d["$"+y[L]]=!0;for(y=0;y<a.length;y++)L=d.hasOwnProperty("$"+a[y].value),a[y].selected!==L&&(a[y].selected=L),L&&C&&(a[y].defaultSelected=!0)}else{for(y=""+Vr(y),d=null,L=0;L<a.length;L++){if(a[L].value===y){a[L].selected=!0,C&&(a[L].defaultSelected=!0);return}d!==null||a[L].disabled||(d=a[L])}d!==null&&(d.selected=!0)}}function Fo(a,d){if(d.dangerouslySetInnerHTML!=null)throw Error(g(91));return s({},d,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function ss(a,d){var y=d.value;if(y==null){if(y=d.children,d=d.defaultValue,y!=null){if(d!=null)throw Error(g(92));if(Array.isArray(y)){if(!(1>=y.length))throw Error(g(93));y=y[0]}d=y}d==null&&(d=""),y=d}a._wrapperState={initialValue:Vr(y)}}function as(a,d){var y=Vr(d.value),C=Vr(d.defaultValue);y!=null&&(y=""+y,y!==a.value&&(a.value=y),d.defaultValue==null&&a.defaultValue!==y&&(a.defaultValue=y)),C!=null&&(a.defaultValue=""+C)}function oi(a){var d=a.textContent;d===a._wrapperState.initialValue&&d!==""&&d!==null&&(a.value=d)}var bo={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function wo(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function No(a,d){return a==null||a==="http://www.w3.org/1999/xhtml"?wo(d):a==="http://www.w3.org/2000/svg"&&d==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var Ui,ls=function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(d,y,C,L){MSApp.execUnsafeLocalFunction(function(){return a(d,y,C,L)})}:a}(function(a,d){if(a.namespaceURI!==bo.svg||"innerHTML"in a)a.innerHTML=d;else{for(Ui=Ui||document.createElement("div"),Ui.innerHTML="<svg>"+d.valueOf().toString()+"</svg>",d=Ui.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;d.firstChild;)a.appendChild(d.firstChild)}});function Zr(a,d){if(d){var y=a.firstChild;if(y&&y===a.lastChild&&y.nodeType===3){y.nodeValue=d;return}}a.textContent=d}var Uo={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Kn=["Webkit","ms","Moz","O"];Object.keys(Uo).forEach(function(a){Kn.forEach(function(d){d=d+a.charAt(0).toUpperCase()+a.substring(1),Uo[d]=Uo[a]})});function yi(a,d,y){return d==null||typeof d=="boolean"||d===""?"":y||typeof d!="number"||d===0||Uo.hasOwnProperty(a)&&Uo[a]?(""+d).trim():d+"px"}function us(a,d){a=a.style;for(var y in d)if(d.hasOwnProperty(y)){var C=y.indexOf("--")===0,L=yi(y,d[y],C);y==="float"&&(y="cssFloat"),C?a.setProperty(y,L):a[y]=L}}var ji=s({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Eo(a,d){if(d){if(ji[a]&&(d.children!=null||d.dangerouslySetInnerHTML!=null))throw Error(g(137,a));if(d.dangerouslySetInnerHTML!=null){if(d.children!=null)throw Error(g(60));if(!(typeof d.dangerouslySetInnerHTML=="object"&&"__html"in d.dangerouslySetInnerHTML))throw Error(g(61))}if(d.style!=null&&typeof d.style!="object")throw Error(g(62))}}function Vi(a,d){if(a.indexOf("-")===-1)return typeof d.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function $i(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var vi=null,xi=null,Rr=null;function cs(a){if(a=ol(a)){if(typeof vi!="function")throw Error(g(280));var d=a.stateNode;d&&(d=va(d),vi(a.stateNode,a.type,d))}}function si(a){xi?Rr?Rr.push(a):Rr=[a]:xi=a}function se(){if(xi){var a=xi,d=Rr;if(Rr=xi=null,cs(a),d)for(a=0;a<d.length;a++)cs(d[a])}}function F(a,d){return a(d)}function Z(a,d,y,C,L){return a(d,y,C,L)}function re(){}var ue=F,ve=!1,Ie=!1;function Ce(){(xi!==null||Rr!==null)&&(re(),se())}function we(a,d,y){if(Ie)return a(d,y);Ie=!0;try{return ue(a,d,y)}finally{Ie=!1,Ce()}}function De(a,d){var y=a.stateNode;if(y===null)return null;var C=va(y);if(C===null)return null;y=C[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(a=a.type,C=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!C;break e;default:a=!1}if(a)return null;if(y&&typeof y!="function")throw Error(g(231,d,typeof y));return y}var We=!1;if(o)try{var et={};Object.defineProperty(et,"passive",{get:function(){We=!0}}),window.addEventListener("test",et,et),window.removeEventListener("test",et,et)}catch{We=!1}function it(a,d,y,C,L,j,Y,ce,Ee){var Ge=Array.prototype.slice.call(arguments,3);try{d.apply(y,Ge)}catch(zt){this.onError(zt)}}var Mt=!1,At=null,Lt=!1,Ut=null,on={onError:function(a){Mt=!0,At=a}};function jn(a,d,y,C,L,j,Y,ce,Ee){Mt=!1,At=null,it.apply(on,arguments)}function Qn(a,d,y,C,L,j,Y,ce,Ee){if(jn.apply(this,arguments),Mt){if(Mt){var Ge=At;Mt=!1,At=null}else throw Error(g(198));Lt||(Lt=!0,Ut=Ge)}}function Sn(a){var d=a,y=a;if(a.alternate)for(;d.return;)d=d.return;else{a=d;do d=a,d.flags&1026&&(y=d.return),a=d.return;while(a)}return d.tag===3?y:null}function Vn(a){if(a.tag===13){var d=a.memoizedState;if(d===null&&(a=a.alternate,a!==null&&(d=a.memoizedState)),d!==null)return d.dehydrated}return null}function br(a){if(Sn(a)!==a)throw Error(g(188))}function ai(a){var d=a.alternate;if(!d){if(d=Sn(a),d===null)throw Error(g(188));return d!==a?null:a}for(var y=a,C=d;;){var L=y.return;if(L===null)break;var j=L.alternate;if(j===null){if(C=L.return,C!==null){y=C;continue}break}if(L.child===j.child){for(j=L.child;j;){if(j===y)return br(L),a;if(j===C)return br(L),d;j=j.sibling}throw Error(g(188))}if(y.return!==C.return)y=L,C=j;else{for(var Y=!1,ce=L.child;ce;){if(ce===y){Y=!0,y=L,C=j;break}if(ce===C){Y=!0,C=L,y=j;break}ce=ce.sibling}if(!Y){for(ce=j.child;ce;){if(ce===y){Y=!0,y=j,C=L;break}if(ce===C){Y=!0,C=j,y=L;break}ce=ce.sibling}if(!Y)throw Error(g(189))}}if(y.alternate!==C)throw Error(g(190))}if(y.tag!==3)throw Error(g(188));return y.stateNode.current===y?a:d}function rr(a){if(a=ai(a),!a)return null;for(var d=a;;){if(d.tag===5||d.tag===6)return d;if(d.child)d.child.return=d,d=d.child;else{if(d===a)break;for(;!d.sibling;){if(!d.return||d.return===a)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}}return null}function Sr(a,d){for(var y=a.alternate;d!==null;){if(d===a||d===y)return!0;d=d.return}return!1}var To,bi,ki,hs,ks=!1,Gr=[],gr=null,Qr=null,zi=null,Or=new Map,Zi=new Map,qr=[],ra="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Gi(a,d,y,C,L){return{blockedOn:a,domEventName:d,eventSystemFlags:y|16,nativeEvent:L,targetContainers:[C]}}function ds(a,d){switch(a){case"focusin":case"focusout":gr=null;break;case"dragenter":case"dragleave":Qr=null;break;case"mouseover":case"mouseout":zi=null;break;case"pointerover":case"pointerout":Or.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zi.delete(d.pointerId)}}function qi(a,d,y,C,L,j){return a===null||a.nativeEvent!==j?(a=Gi(d,y,C,L,j),d!==null&&(d=ol(d),d!==null&&bi(d)),a):(a.eventSystemFlags|=C,d=a.targetContainers,L!==null&&d.indexOf(L)===-1&&d.push(L),a)}function fs(a,d,y,C,L){switch(d){case"focusin":return gr=qi(gr,a,d,y,C,L),!0;case"dragenter":return Qr=qi(Qr,a,d,y,C,L),!0;case"mouseover":return zi=qi(zi,a,d,y,C,L),!0;case"pointerover":var j=L.pointerId;return Or.set(j,qi(Or.get(j)||null,a,d,y,C,L)),!0;case"gotpointercapture":return j=L.pointerId,Zi.set(j,qi(Zi.get(j)||null,a,d,y,C,L)),!0}return!1}function El(a){var d=xs(a.target);if(d!==null){var y=Sn(d);if(y!==null){if(d=y.tag,d===13){if(d=Vn(y),d!==null){a.blockedOn=d,hs(a.lanePriority,function(){h.unstable_runWithPriority(a.priority,function(){ki(y)})});return}}else if(d===3&&y.stateNode.hydrate){a.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}a.blockedOn=null}function ia(a){if(a.blockedOn!==null)return!1;for(var d=a.targetContainers;0<d.length;){var y=sa(a.domEventName,a.eventSystemFlags,d[0],a.nativeEvent);if(y!==null)return d=ol(y),d!==null&&bi(d),a.blockedOn=y,!1;d.shift()}return!0}function oa(a,d,y){ia(a)&&y.delete(d)}function X(){for(ks=!1;0<Gr.length;){var a=Gr[0];if(a.blockedOn!==null){a=ol(a.blockedOn),a!==null&&To(a);break}for(var d=a.targetContainers;0<d.length;){var y=sa(a.domEventName,a.eventSystemFlags,d[0],a.nativeEvent);if(y!==null){a.blockedOn=y;break}d.shift()}a.blockedOn===null&&Gr.shift()}gr!==null&&ia(gr)&&(gr=null),Qr!==null&&ia(Qr)&&(Qr=null),zi!==null&&ia(zi)&&(zi=null),Or.forEach(oa),Zi.forEach(oa)}function ie(a,d){a.blockedOn===d&&(a.blockedOn=null,ks||(ks=!0,h.unstable_scheduleCallback(h.unstable_NormalPriority,X)))}function xe(a){function d(L){return ie(L,a)}if(0<Gr.length){ie(Gr[0],a);for(var y=1;y<Gr.length;y++){var C=Gr[y];C.blockedOn===a&&(C.blockedOn=null)}}for(gr!==null&&ie(gr,a),Qr!==null&&ie(Qr,a),zi!==null&&ie(zi,a),Or.forEach(d),Zi.forEach(d),y=0;y<qr.length;y++)C=qr[y],C.blockedOn===a&&(C.blockedOn=null);for(;0<qr.length&&(y=qr[0],y.blockedOn===null);)El(y),y.blockedOn===null&&qr.shift()}function le(a,d){var y={};return y[a.toLowerCase()]=d.toLowerCase(),y["Webkit"+a]="webkit"+d,y["Moz"+a]="moz"+d,y}var ke={animationend:le("Animation","AnimationEnd"),animationiteration:le("Animation","AnimationIteration"),animationstart:le("Animation","AnimationStart"),transitionend:le("Transition","TransitionEnd")},kt={},tn={};o&&(tn=document.createElement("div").style,"AnimationEvent"in window||(delete ke.animationend.animation,delete ke.animationiteration.animation,delete ke.animationstart.animation),"TransitionEvent"in window||delete ke.transitionend.transition);function an(a){if(kt[a])return kt[a];if(!ke[a])return a;var d=ke[a],y;for(y in d)if(d.hasOwnProperty(y)&&y in tn)return kt[a]=d[y];return a}var er=an("animationend"),ir=an("animationiteration"),li=an("animationstart"),ps=an("transitionend"),bt=new Map,xn=new Map,mn=["abort","abort",er,"animationEnd",ir,"animationIteration",li,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ps,"transitionEnd","waiting","waiting"];function ro(a,d){for(var y=0;y<a.length;y+=2){var C=a[y],L=a[y+1];L="on"+(L[0].toUpperCase()+L.slice(1)),xn.set(C,d),bt.set(C,L),k(L,[C])}}var $a=h.unstable_now;$a();var Bt=8;function jo(a){if(1&a)return Bt=15,1;if(2&a)return Bt=14,2;if(4&a)return Bt=13,4;var d=24&a;return d!==0?(Bt=12,d):a&32?(Bt=11,32):(d=192&a,d!==0?(Bt=10,d):a&256?(Bt=9,256):(d=3584&a,d!==0?(Bt=8,d):a&4096?(Bt=7,4096):(d=4186112&a,d!==0?(Bt=6,d):(d=62914560&a,d!==0?(Bt=5,d):a&67108864?(Bt=4,67108864):a&134217728?(Bt=3,134217728):(d=805306368&a,d!==0?(Bt=2,d):1073741824&a?(Bt=1,1073741824):(Bt=8,a))))))}function zs(a){switch(a){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function Tl(a){switch(a){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(g(358,a))}}function ui(a,d){var y=a.pendingLanes;if(y===0)return Bt=0;var C=0,L=0,j=a.expiredLanes,Y=a.suspendedLanes,ce=a.pingedLanes;if(j!==0)C=j,L=Bt=15;else if(j=y&134217727,j!==0){var Ee=j&~Y;Ee!==0?(C=jo(Ee),L=Bt):(ce&=j,ce!==0&&(C=jo(ce),L=Bt))}else j=y&~Y,j!==0?(C=jo(j),L=Bt):ce!==0&&(C=jo(ce),L=Bt);if(C===0)return 0;if(C=31-Wi(C),C=y&((0>C?0:1<<C)<<1)-1,d!==0&&d!==C&&!(d&Y)){if(jo(d),L<=Bt)return d;Bt=L}if(d=a.entangledLanes,d!==0)for(a=a.entanglements,d&=C;0<d;)y=31-Wi(d),L=1<<y,C|=a[y],d&=~L;return C}function hr(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function mu(a,d){switch(a){case 15:return 1;case 14:return 2;case 12:return a=Br(24&~d),a===0?mu(10,d):a;case 10:return a=Br(192&~d),a===0?mu(8,d):a;case 8:return a=Br(3584&~d),a===0&&(a=Br(4186112&~d),a===0&&(a=512)),a;case 2:return d=Br(805306368&~d),d===0&&(d=268435456),d}throw Error(g(358,a))}function Br(a){return a&-a}function Za(a){for(var d=[],y=0;31>y;y++)d.push(a);return d}function ms(a,d,y){a.pendingLanes|=d;var C=d-1;a.suspendedLanes&=C,a.pingedLanes&=C,a=a.eventTimes,d=31-Wi(d),a[d]=y}var Wi=Math.clz32?Math.clz32:gu,Ga=Math.log,In=Math.LN2;function gu(a){return a===0?32:31-(Ga(a)/In|0)|0}var fc=h.unstable_UserBlockingPriority,sn=h.unstable_runWithPriority,wi=!0;function fh(a,d,y,C){ve||re();var L=_r,j=ve;ve=!0;try{Z(L,a,d,y,C)}finally{(ve=j)||Ce()}}function _u(a,d,y,C){sn(fc,_r.bind(null,a,d,y,C))}function _r(a,d,y,C){if(wi){var L;if((L=(d&4)===0)&&0<Gr.length&&-1<ra.indexOf(a))a=Gi(null,a,d,y,C),Gr.push(a);else{var j=sa(a,d,y,C);if(j===null)L&&ds(a,C);else{if(L){if(-1<ra.indexOf(a)){a=Gi(j,a,d,y,C),Gr.push(a);return}if(fs(j,a,d,y,C))return;ds(a,C)}el(a,d,C,null,y)}}}}function sa(a,d,y,C){var L=$i(C);if(L=xs(L),L!==null){var j=Sn(L);if(j===null)L=null;else{var Y=j.tag;if(Y===13){if(L=Vn(j),L!==null)return L;L=null}else if(Y===3){if(j.stateNode.hydrate)return j.tag===3?j.stateNode.containerInfo:null;L=null}else j!==L&&(L=null)}}return el(a,d,C,L,y),null}var Ei=null,Ar=null,aa=null;function Xi(){if(aa)return aa;var a,d=Ar,y=d.length,C,L="value"in Ei?Ei.value:Ei.textContent,j=L.length;for(a=0;a<y&&d[a]===L[a];a++);var Y=y-a;for(C=1;C<=Y&&d[y-C]===L[j-C];C++);return aa=L.slice(a,1<C?1-C:void 0)}function Hi(a){var d=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&d===13&&(a=13)):a=d,a===10&&(a=13),32<=a||a===13?a:0}function Vo(){return!0}function ph(){return!1}function wr(a){function d(y,C,L,j,Y){this._reactName=y,this._targetInst=L,this.type=C,this.nativeEvent=j,this.target=Y,this.currentTarget=null;for(var ce in a)a.hasOwnProperty(ce)&&(y=a[ce],this[ce]=y?y(j):j[ce]);return this.isDefaultPrevented=(j.defaultPrevented!=null?j.defaultPrevented:j.returnValue===!1)?Vo:ph,this.isPropagationStopped=ph,this}return s(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=Vo)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=Vo)},persist:function(){},isPersistent:Vo}),d}var la={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yu=wr(la),ei=s({},la,{view:0,detail:0}),Sl=wr(ei),$o,qa,gs,Ml=s({},ei,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ca,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==gs&&(gs&&a.type==="mousemove"?($o=a.screenX-gs.screenX,qa=a.screenY-gs.screenY):qa=$o=0,gs=a),$o)},movementY:function(a){return"movementY"in a?a.movementY:qa}}),pc=wr(Ml),mc=s({},Ml,{dataTransfer:0}),mh=wr(mc),gc=s({},ei,{relatedTarget:0}),_c=wr(gc),gh=s({},la,{animationName:0,elapsedTime:0,pseudoElement:0}),yd=wr(gh),yc=s({},la,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),_h=wr(yc),vc=s({},la,{data:0}),xc=wr(vc),yh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ua={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Wa={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cl(a){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(a):(a=Wa[a])?!!d[a]:!1}function ca(){return Cl}var vu=s({},ei,{key:function(a){if(a.key){var d=yh[a.key]||a.key;if(d!=="Unidentified")return d}return a.type==="keypress"?(a=Hi(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?ua[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ca,charCode:function(a){return a.type==="keypress"?Hi(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Hi(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),xu=wr(vu),bu=s({},Ml,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Xa=wr(bu),Pl=s({},ei,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ca}),Nn=wr(Pl),wu=s({},la,{propertyName:0,elapsedTime:0,pseudoElement:0}),vh=wr(wu),Il=s({},Ml,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),bc=wr(Il),Eu=[9,13,27,32],Tu=o&&"CompositionEvent"in window,Al=null;o&&"documentMode"in document&&(Al=document.documentMode);var vd=o&&"TextEvent"in window&&!Al,kl=o&&(!Tu||Al&&8<Al&&11>=Al),zl=" ",Dl=!1;function Ha(a,d){switch(a){case"keyup":return Eu.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wc(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var ha=!1;function xd(a,d){switch(a){case"compositionend":return wc(d);case"keypress":return d.which!==32?null:(Dl=!0,zl);case"textInput":return a=d.data,a===zl&&Dl?null:a;default:return null}}function Ll(a,d){if(ha)return a==="compositionend"||!Tu&&Ha(a,d)?(a=Xi(),aa=Ar=Ei=null,ha=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return kl&&d.locale!=="ko"?null:d.data;default:return null}}var Rl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ec(a){var d=a&&a.nodeName&&a.nodeName.toLowerCase();return d==="input"?!!Rl[a.type]:d==="textarea"}function Ti(a,d,y,C){si(C),d=tl(d,"onChange"),0<d.length&&(y=new yu("onChange","change",null,y,C),a.push({event:y,listeners:d}))}var Ds=null,So=null;function Su(a){Nl(a,0)}function Ya(a){var d=ya(a);if(cr(d))return a}function Tc(a,d){if(a==="change")return d}var io=!1;if(o){var Ka;if(o){var Zo="oninput"in document;if(!Zo){var Ja=document.createElement("div");Ja.setAttribute("oninput","return;"),Zo=typeof Ja.oninput=="function"}Ka=Zo}else Ka=!1;io=Ka&&(!document.documentMode||9<document.documentMode)}function Sc(){Ds&&(Ds.detachEvent("onpropertychange",Ol),So=Ds=null)}function Ol(a){if(a.propertyName==="value"&&Ya(So)){var d=[];if(Ti(d,So,a,$i(a)),a=Su,ve)a(d);else{ve=!0;try{F(a,d)}finally{ve=!1,Ce()}}}}function Ls(a,d,y){a==="focusin"?(Sc(),Ds=d,So=y,Ds.attachEvent("onpropertychange",Ol)):a==="focusout"&&Sc()}function xh(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Ya(So)}function Mc(a,d){if(a==="click")return Ya(d)}function Cc(a,d){if(a==="input"||a==="change")return Ya(d)}function bh(a,d){return a===d&&(a!==0||1/a===1/d)||a!==a&&d!==d}var Di=typeof Object.is=="function"?Object.is:bh,wh=Object.prototype.hasOwnProperty;function Rs(a,d){if(Di(a,d))return!0;if(typeof a!="object"||a===null||typeof d!="object"||d===null)return!1;var y=Object.keys(a),C=Object.keys(d);if(y.length!==C.length)return!1;for(C=0;C<y.length;C++)if(!wh.call(d,y[C])||!Di(a[y[C]],d[y[C]]))return!1;return!0}function Bl(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function oo(a,d){var y=Bl(a);a=0;for(var C;y;){if(y.nodeType===3){if(C=a+y.textContent.length,a<=d&&C>=d)return{node:y,offset:d-a};a=C}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=Bl(y)}}function Mu(a,d){return a&&d?a===d?!0:a&&a.nodeType===3?!1:d&&d.nodeType===3?Mu(a,d.parentNode):"contains"in a?a.contains(d):a.compareDocumentPosition?!!(a.compareDocumentPosition(d)&16):!1:!1}function Cu(){for(var a=window,d=$r();d instanceof a.HTMLIFrameElement;){try{var y=typeof d.contentWindow.location.href=="string"}catch{y=!1}if(y)a=d.contentWindow;else break;d=$r(a.document)}return d}function da(a){var d=a&&a.nodeName&&a.nodeName.toLowerCase();return d&&(d==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||d==="textarea"||a.contentEditable==="true")}var Os=o&&"documentMode"in document&&11>=document.documentMode,fa=null,Mo=null,Go=null,Pu=!1;function Iu(a,d,y){var C=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;Pu||fa==null||fa!==$r(C)||(C=fa,"selectionStart"in C&&da(C)?C={start:C.selectionStart,end:C.selectionEnd}:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection(),C={anchorNode:C.anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset}),Go&&Rs(Go,C)||(Go=C,C=tl(Mo,"onSelect"),0<C.length&&(d=new yu("onSelect","select",null,d,y),a.push({event:d,listeners:C}),d.target=fa)))}ro("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),ro("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),ro(mn,2);for(var kn="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Qa=0;Qa<kn.length;Qa++)xn.set(kn[Qa],0);R("onMouseEnter",["mouseout","mouseover"]),R("onMouseLeave",["mouseout","mouseover"]),R("onPointerEnter",["pointerout","pointerover"]),R("onPointerLeave",["pointerout","pointerover"]),k("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),k("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),k("onBeforeInput",["compositionend","keypress","textInput","paste"]),k("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),k("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),k("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fl=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bs));function Wr(a,d,y){var C=a.type||"unknown-event";a.currentTarget=y,Qn(C,d,void 0,a),a.currentTarget=null}function Nl(a,d){d=(d&4)!==0;for(var y=0;y<a.length;y++){var C=a[y],L=C.event;C=C.listeners;e:{var j=void 0;if(d)for(var Y=C.length-1;0<=Y;Y--){var ce=C[Y],Ee=ce.instance,Ge=ce.currentTarget;if(ce=ce.listener,Ee!==j&&L.isPropagationStopped())break e;Wr(L,ce,Ge),j=Ee}else for(Y=0;Y<C.length;Y++){if(ce=C[Y],Ee=ce.instance,Ge=ce.currentTarget,ce=ce.listener,Ee!==j&&L.isPropagationStopped())break e;Wr(L,ce,Ge),j=Ee}}}if(Lt)throw a=Ut,Lt=!1,Ut=null,a}function dr(a,d){var y=zu(d),C=a+"__bubble";y.has(C)||(pa(d,a,2,!1),y.add(C))}var Pc="_reactListening"+Math.random().toString(36).slice(2);function Eh(a){a[Pc]||(a[Pc]=!0,w.forEach(function(d){Fl.has(d)||Au(d,!1,a,null),Au(d,!0,a,null)}))}function Au(a,d,y,C){var L=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,j=y;a==="selectionchange"&&y.nodeType!==9&&(j=y.ownerDocument);var Y=zu(j),ce=a+"__"+(d?"capture":"bubble");Y.has(ce)||(d&&(L|=4),pa(j,a,L,d),Y.add(ce))}function pa(a,d,y,C){var L=xn.get(d);switch(L===void 0?2:L){case 0:L=fh;break;case 1:L=_u;break;default:L=_r}y=L.bind(null,d,y,a),L=void 0,!We||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(L=!0),C?L!==void 0?a.addEventListener(d,y,{capture:!0,passive:L}):a.addEventListener(d,y,!0):L!==void 0?a.addEventListener(d,y,{passive:L}):a.addEventListener(d,y,!1)}function el(a,d,y,C,L){var j=C;if(!(d&1)&&!(d&2)&&C!==null)e:for(;;){if(C===null)return;var Y=C.tag;if(Y===3||Y===4){var ce=C.stateNode.containerInfo;if(ce===L||ce.nodeType===8&&ce.parentNode===L)break;if(Y===4)for(Y=C.return;Y!==null;){var Ee=Y.tag;if((Ee===3||Ee===4)&&(Ee=Y.stateNode.containerInfo,Ee===L||Ee.nodeType===8&&Ee.parentNode===L))return;Y=Y.return}for(;ce!==null;){if(Y=xs(ce),Y===null)return;if(Ee=Y.tag,Ee===5||Ee===6){C=j=Y;continue e}ce=ce.parentNode}}C=C.return}we(function(){var Ge=j,zt=$i(y),hn=[];e:{var _t=bt.get(a);if(_t!==void 0){var qt=yu,dn=a;switch(a){case"keypress":if(Hi(y)===0)break e;case"keydown":case"keyup":qt=xu;break;case"focusin":dn="focus",qt=_c;break;case"focusout":dn="blur",qt=_c;break;case"beforeblur":case"afterblur":qt=_c;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qt=pc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qt=mh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qt=Nn;break;case er:case ir:case li:qt=yd;break;case ps:qt=vh;break;case"scroll":qt=Sl;break;case"wheel":qt=bc;break;case"copy":case"cut":case"paste":qt=_h;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qt=Xa}var nn=(d&4)!==0,Be=!nn&&a==="scroll",Pe=nn?_t!==null?_t+"Capture":null:_t;nn=[];for(var Re=Ge,at;Re!==null;){at=Re;var ct=at.stateNode;if(at.tag===5&&ct!==null&&(at=ct,Pe!==null&&(ct=De(Re,Pe),ct!=null&&nn.push(_s(Re,ct,at)))),Be)break;Re=Re.return}0<nn.length&&(_t=new qt(_t,dn,null,y,zt),hn.push({event:_t,listeners:nn}))}}if(!(d&7)){e:{if(_t=a==="mouseover"||a==="pointerover",qt=a==="mouseout"||a==="pointerout",_t&&!(d&16)&&(dn=y.relatedTarget||y.fromElement)&&(xs(dn)||dn[Ns]))break e;if((qt||_t)&&(_t=zt.window===zt?zt:(_t=zt.ownerDocument)?_t.defaultView||_t.parentWindow:window,qt?(dn=y.relatedTarget||y.toElement,qt=Ge,dn=dn?xs(dn):null,dn!==null&&(Be=Sn(dn),dn!==Be||dn.tag!==5&&dn.tag!==6)&&(dn=null)):(qt=null,dn=Ge),qt!==dn)){if(nn=pc,ct="onMouseLeave",Pe="onMouseEnter",Re="mouse",(a==="pointerout"||a==="pointerover")&&(nn=Xa,ct="onPointerLeave",Pe="onPointerEnter",Re="pointer"),Be=qt==null?_t:ya(qt),at=dn==null?_t:ya(dn),_t=new nn(ct,Re+"leave",qt,y,zt),_t.target=Be,_t.relatedTarget=at,ct=null,xs(zt)===Ge&&(nn=new nn(Pe,Re+"enter",dn,y,zt),nn.target=at,nn.relatedTarget=Be,ct=nn),Be=ct,qt&&dn)t:{for(nn=qt,Pe=dn,Re=0,at=nn;at;at=ma(at))Re++;for(at=0,ct=Pe;ct;ct=ma(ct))at++;for(;0<Re-at;)nn=ma(nn),Re--;for(;0<at-Re;)Pe=ma(Pe),at--;for(;Re--;){if(nn===Pe||Pe!==null&&nn===Pe.alternate)break t;nn=ma(nn),Pe=ma(Pe)}nn=null}else nn=null;qt!==null&&ga(hn,_t,qt,nn,!1),dn!==null&&Be!==null&&ga(hn,Be,dn,nn,!0)}}e:{if(_t=Ge?ya(Ge):window,qt=_t.nodeName&&_t.nodeName.toLowerCase(),qt==="select"||qt==="input"&&_t.type==="file")var _n=Tc;else if(Ec(_t))if(io)_n=Cc;else{_n=xh;var Zt=Ls}else(qt=_t.nodeName)&&qt.toLowerCase()==="input"&&(_t.type==="checkbox"||_t.type==="radio")&&(_n=Mc);if(_n&&(_n=_n(a,Ge))){Ti(hn,_n,y,zt);break e}Zt&&Zt(a,_t,Ge),a==="focusout"&&(Zt=_t._wrapperState)&&Zt.controlled&&_t.type==="number"&&Ni(_t,"number",_t.value)}switch(Zt=Ge?ya(Ge):window,a){case"focusin":(Ec(Zt)||Zt.contentEditable==="true")&&(fa=Zt,Mo=Ge,Go=null);break;case"focusout":Go=Mo=fa=null;break;case"mousedown":Pu=!0;break;case"contextmenu":case"mouseup":case"dragend":Pu=!1,Iu(hn,y,zt);break;case"selectionchange":if(Os)break;case"keydown":case"keyup":Iu(hn,y,zt)}var pn;if(Tu)e:{switch(a){case"compositionstart":var Mn="onCompositionStart";break e;case"compositionend":Mn="onCompositionEnd";break e;case"compositionupdate":Mn="onCompositionUpdate";break e}Mn=void 0}else ha?Ha(a,y)&&(Mn="onCompositionEnd"):a==="keydown"&&y.keyCode===229&&(Mn="onCompositionStart");Mn&&(kl&&y.locale!=="ko"&&(ha||Mn!=="onCompositionStart"?Mn==="onCompositionEnd"&&ha&&(pn=Xi()):(Ei=zt,Ar="value"in Ei?Ei.value:Ei.textContent,ha=!0)),Zt=tl(Ge,Mn),0<Zt.length&&(Mn=new xc(Mn,a,null,y,zt),hn.push({event:Mn,listeners:Zt}),pn?Mn.data=pn:(pn=wc(y),pn!==null&&(Mn.data=pn)))),(pn=vd?xd(a,y):Ll(a,y))&&(Ge=tl(Ge,"onBeforeInput"),0<Ge.length&&(zt=new xc("onBeforeInput","beforeinput",null,y,zt),hn.push({event:zt,listeners:Ge}),zt.data=pn))}Nl(hn,d)})}function _s(a,d,y){return{instance:a,listener:d,currentTarget:y}}function tl(a,d){for(var y=d+"Capture",C=[];a!==null;){var L=a,j=L.stateNode;L.tag===5&&j!==null&&(L=j,j=De(a,y),j!=null&&C.unshift(_s(a,j,L)),j=De(a,d),j!=null&&C.push(_s(a,j,L))),a=a.return}return C}function ma(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function ga(a,d,y,C,L){for(var j=d._reactName,Y=[];y!==null&&y!==C;){var ce=y,Ee=ce.alternate,Ge=ce.stateNode;if(Ee!==null&&Ee===C)break;ce.tag===5&&Ge!==null&&(ce=Ge,L?(Ee=De(y,j),Ee!=null&&Y.unshift(_s(y,Ee,ce))):L||(Ee=De(y,j),Ee!=null&&Y.push(_s(y,Ee,ce)))),y=y.return}Y.length!==0&&a.push({event:d,listeners:Y})}function _a(){}var Li=null,Ul=null;function Ic(a,d){switch(a){case"button":case"input":case"select":case"textarea":return!!d.autoFocus}return!1}function nl(a,d){return a==="textarea"||a==="option"||a==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var qo=typeof setTimeout=="function"?setTimeout:void 0,Ac=typeof clearTimeout=="function"?clearTimeout:void 0;function rl(a){a.nodeType===1?a.textContent="":a.nodeType===9&&(a=a.body,a!=null&&(a.textContent=""))}function ys(a){for(;a!=null;a=a.nextSibling){var d=a.nodeType;if(d===1||d===3)break}return a}function jl(a){a=a.previousSibling;for(var d=0;a;){if(a.nodeType===8){var y=a.data;if(y==="$"||y==="$!"||y==="$?"){if(d===0)return a;d--}else y==="/$"&&d++}a=a.previousSibling}return null}var il=0;function Th(a){return{$$typeof:Qt,toString:a,valueOf:a}}var vs=Math.random().toString(36).slice(2),Fs="__reactFiber$"+vs,ku="__reactProps$"+vs,Ns="__reactContainer$"+vs,Vl="__reactEvents$"+vs;function xs(a){var d=a[Fs];if(d)return d;for(var y=a.parentNode;y;){if(d=y[Ns]||y[Fs]){if(y=d.alternate,d.child!==null||y!==null&&y.child!==null)for(a=jl(a);a!==null;){if(y=a[Fs])return y;a=jl(a)}return d}a=y,y=a.parentNode}return null}function ol(a){return a=a[Fs]||a[Ns],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function ya(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(g(33))}function va(a){return a[ku]||null}function zu(a){var d=a[Vl];return d===void 0&&(d=a[Vl]=new Set),d}var Du=[],Wo=-1;function bs(a){return{current:a}}function lr(a){0>Wo||(a.current=Du[Wo],Du[Wo]=null,Wo--)}function ur(a,d){Wo++,Du[Wo]=a.current,a.current=d}var Yi={},Xr=bs(Yi),Si=bs(!1),ws=Yi;function Us(a,d){var y=a.type.contextTypes;if(!y)return Yi;var C=a.stateNode;if(C&&C.__reactInternalMemoizedUnmaskedChildContext===d)return C.__reactInternalMemoizedMaskedChildContext;var L={},j;for(j in y)L[j]=d[j];return C&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=d,a.__reactInternalMemoizedMaskedChildContext=L),L}function ci(a){return a=a.childContextTypes,a!=null}function sl(){lr(Si),lr(Xr)}function Fr(a,d,y){if(Xr.current!==Yi)throw Error(g(168));ur(Xr,d),ur(Si,y)}function Lu(a,d,y){var C=a.stateNode;if(a=d.childContextTypes,typeof C.getChildContext!="function")return y;C=C.getChildContext();for(var L in C)if(!(L in a))throw Error(g(108,Ai(d)||"Unknown",L));return s({},y,C)}function so(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Yi,ws=Xr.current,ur(Xr,a),ur(Si,Si.current),!0}function kc(a,d,y){var C=a.stateNode;if(!C)throw Error(g(169));y?(a=Lu(a,d,ws),C.__reactInternalMemoizedMergedChildContext=a,lr(Si),lr(Xr),ur(Xr,a)):lr(Si),ur(Si,y)}var Ki=null,ao=null,al=h.unstable_runWithPriority,zc=h.unstable_scheduleCallback,$l=h.unstable_cancelCallback,bd=h.unstable_shouldYield,Dc=h.unstable_requestPaint,xa=h.unstable_now,Mi=h.unstable_getCurrentPriorityLevel,js=h.unstable_ImmediatePriority,ba=h.unstable_UserBlockingPriority,ll=h.unstable_NormalPriority,Tt=h.unstable_LowPriority,wa=h.unstable_IdlePriority,Ru={},Zl=Dc!==void 0?Dc:function(){},hi=null,p=null,n=!1,l=xa(),m=1e4>l?xa:function(){return xa()-l};function v(){switch(Mi()){case js:return 99;case ba:return 98;case ll:return 97;case Tt:return 96;case wa:return 95;default:throw Error(g(332))}}function b(a){switch(a){case 99:return js;case 98:return ba;case 97:return ll;case 96:return Tt;case 95:return wa;default:throw Error(g(332))}}function T(a,d){return a=b(a),al(a,d)}function P(a,d,y){return a=b(a),zc(a,d,y)}function D(){if(p!==null){var a=p;p=null,$l(a)}O()}function O(){if(!n&&hi!==null){n=!0;var a=0;try{var d=hi;T(99,function(){for(;a<d.length;a++){var y=d[a];do y=y(!0);while(y!==null)}}),hi=null}catch(y){throw hi!==null&&(hi=hi.slice(a+1)),zc(js,D),y}finally{n=!1}}}var B=$e.ReactCurrentBatchConfig;function U(a,d){if(a&&a.defaultProps){d=s({},d),a=a.defaultProps;for(var y in a)d[y]===void 0&&(d[y]=a[y]);return d}return d}var q=bs(null),Q=null,K=null,te=null;function _e(){te=K=Q=null}function J(a){var d=q.current;lr(q),a.type._context._currentValue=d}function me(a,d){for(;a!==null;){var y=a.alternate;if((a.childLanes&d)===d){if(y===null||(y.childLanes&d)===d)break;y.childLanes|=d}else a.childLanes|=d,y!==null&&(y.childLanes|=d);a=a.return}}function pe(a,d){Q=a,te=K=null,a=a.dependencies,a!==null&&a.firstContext!==null&&(a.lanes&d&&(Es=!0),a.firstContext=null)}function he(a,d){if(te!==a&&d!==!1&&d!==0)if((typeof d!="number"||d===1073741823)&&(te=a,d=1073741823),d={context:a,observedBits:d,next:null},K===null){if(Q===null)throw Error(g(308));K=d,Q.dependencies={lanes:0,firstContext:d,responders:null}}else K=K.next=d;return a._currentValue}var fe=!1;function ye(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function Le(a,d){a=a.updateQueue,d.updateQueue===a&&(d.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function Ue(a,d){return{eventTime:a,lane:d,tag:0,payload:null,callback:null,next:null}}function ht(a,d){if(a=a.updateQueue,a!==null){a=a.shared;var y=a.pending;y===null?d.next=d:(d.next=y.next,y.next=d),a.pending=d}}function ot(a,d){var y=a.updateQueue,C=a.alternate;if(C!==null&&(C=C.updateQueue,y===C)){var L=null,j=null;if(y=y.firstBaseUpdate,y!==null){do{var Y={eventTime:y.eventTime,lane:y.lane,tag:y.tag,payload:y.payload,callback:y.callback,next:null};j===null?L=j=Y:j=j.next=Y,y=y.next}while(y!==null);j===null?L=j=d:j=j.next=d}else L=j=d;y={baseState:C.baseState,firstBaseUpdate:L,lastBaseUpdate:j,shared:C.shared,effects:C.effects},a.updateQueue=y;return}a=y.lastBaseUpdate,a===null?y.firstBaseUpdate=d:a.next=d,y.lastBaseUpdate=d}function nt(a,d,y,C){var L=a.updateQueue;fe=!1;var j=L.firstBaseUpdate,Y=L.lastBaseUpdate,ce=L.shared.pending;if(ce!==null){L.shared.pending=null;var Ee=ce,Ge=Ee.next;Ee.next=null,Y===null?j=Ge:Y.next=Ge,Y=Ee;var zt=a.alternate;if(zt!==null){zt=zt.updateQueue;var hn=zt.lastBaseUpdate;hn!==Y&&(hn===null?zt.firstBaseUpdate=Ge:hn.next=Ge,zt.lastBaseUpdate=Ee)}}if(j!==null){hn=L.baseState,Y=0,zt=Ge=Ee=null;do{ce=j.lane;var _t=j.eventTime;if((C&ce)===ce){zt!==null&&(zt=zt.next={eventTime:_t,lane:0,tag:j.tag,payload:j.payload,callback:j.callback,next:null});e:{var qt=a,dn=j;switch(ce=d,_t=y,dn.tag){case 1:if(qt=dn.payload,typeof qt=="function"){hn=qt.call(_t,hn,ce);break e}hn=qt;break e;case 3:qt.flags=qt.flags&-4097|64;case 0:if(qt=dn.payload,ce=typeof qt=="function"?qt.call(_t,hn,ce):qt,ce==null)break e;hn=s({},hn,ce);break e;case 2:fe=!0}}j.callback!==null&&(a.flags|=32,ce=L.effects,ce===null?L.effects=[j]:ce.push(j))}else _t={eventTime:_t,lane:ce,tag:j.tag,payload:j.payload,callback:j.callback,next:null},zt===null?(Ge=zt=_t,Ee=hn):zt=zt.next=_t,Y|=ce;if(j=j.next,j===null){if(ce=L.shared.pending,ce===null)break;j=ce.next,ce.next=null,L.lastBaseUpdate=ce,L.shared.pending=null}}while(!0);zt===null&&(Ee=hn),L.baseState=Ee,L.firstBaseUpdate=Ge,L.lastBaseUpdate=zt,Vc|=Y,a.lanes=Y,a.memoizedState=hn}}function qe(a,d,y){if(a=d.effects,d.effects=null,a!==null)for(d=0;d<a.length;d++){var C=a[d],L=C.callback;if(L!==null){if(C.callback=null,C=y,typeof L!="function")throw Error(g(191,L));L.call(C)}}}var Ne=new c.Component().refs;function tt(a,d,y,C){d=a.memoizedState,y=y(C,d),y=y==null?d:s({},d,y),a.memoizedState=y,a.lanes===0&&(a.updateQueue.baseState=y)}var Ye={isMounted:function(a){return(a=a._reactInternals)?Sn(a)===a:!1},enqueueSetState:function(a,d,y){a=a._reactInternals;var C=fo(),L=Ys(a),j=Ue(C,L);j.payload=d,y!=null&&(j.callback=y),ht(a,j),ka(a,L,C)},enqueueReplaceState:function(a,d,y){a=a._reactInternals;var C=fo(),L=Ys(a),j=Ue(C,L);j.tag=1,j.payload=d,y!=null&&(j.callback=y),ht(a,j),ka(a,L,C)},enqueueForceUpdate:function(a,d){a=a._reactInternals;var y=fo(),C=Ys(a),L=Ue(y,C);L.tag=2,d!=null&&(L.callback=d),ht(a,L),ka(a,C,y)}};function Rt(a,d,y,C,L,j,Y){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(C,j,Y):d.prototype&&d.prototype.isPureReactComponent?!Rs(y,C)||!Rs(L,j):!0}function Gt(a,d,y){var C=!1,L=Yi,j=d.contextType;return typeof j=="object"&&j!==null?j=he(j):(L=ci(d)?ws:Xr.current,C=d.contextTypes,j=(C=C!=null)?Us(a,L):Yi),d=new d(y,j),a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Ye,a.stateNode=d,d._reactInternals=a,C&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=L,a.__reactInternalMemoizedMaskedChildContext=j),d}function ln(a,d,y,C){a=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(y,C),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(y,C),d.state!==a&&Ye.enqueueReplaceState(d,d.state,null)}function ft(a,d,y,C){var L=a.stateNode;L.props=y,L.state=a.memoizedState,L.refs=Ne,ye(a);var j=d.contextType;typeof j=="object"&&j!==null?L.context=he(j):(j=ci(d)?ws:Xr.current,L.context=Us(a,j)),nt(a,y,L,C),L.state=a.memoizedState,j=d.getDerivedStateFromProps,typeof j=="function"&&(tt(a,d,j,y),L.state=a.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(d=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),d!==L.state&&Ye.enqueueReplaceState(L,L.state,null),nt(a,y,L,C),L.state=a.memoizedState),typeof L.componentDidMount=="function"&&(a.flags|=4)}var Ft=Array.isArray;function Kt(a,d,y){if(a=y.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(y._owner){if(y=y._owner,y){if(y.tag!==1)throw Error(g(309));var C=y.stateNode}if(!C)throw Error(g(147,a));var L=""+a;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===L?d.ref:(d=function(j){var Y=C.refs;Y===Ne&&(Y=C.refs={}),j===null?delete Y[L]:Y[L]=j},d._stringRef=L,d)}if(typeof a!="string")throw Error(g(284));if(!y._owner)throw Error(g(290,a))}return a}function zn(a,d){if(a.type!=="textarea")throw Error(g(31,Object.prototype.toString.call(d)==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":d))}function Wn(a){function d(Be,Pe){if(a){var Re=Be.lastEffect;Re!==null?(Re.nextEffect=Pe,Be.lastEffect=Pe):Be.firstEffect=Be.lastEffect=Pe,Pe.nextEffect=null,Pe.flags=8}}function y(Be,Pe){if(!a)return null;for(;Pe!==null;)d(Be,Pe),Pe=Pe.sibling;return null}function C(Be,Pe){for(Be=new Map;Pe!==null;)Pe.key!==null?Be.set(Pe.key,Pe):Be.set(Pe.index,Pe),Pe=Pe.sibling;return Be}function L(Be,Pe){return Be=Js(Be,Pe),Be.index=0,Be.sibling=null,Be}function j(Be,Pe,Re){return Be.index=Re,a?(Re=Be.alternate,Re!==null?(Re=Re.index,Re<Pe?(Be.flags=2,Pe):Re):(Be.flags=2,Pe)):Pe}function Y(Be){return a&&Be.alternate===null&&(Be.flags=2),Be}function ce(Be,Pe,Re,at){return Pe===null||Pe.tag!==6?(Pe=ou(Re,Be.mode,at),Pe.return=Be,Pe):(Pe=L(Pe,Re),Pe.return=Be,Pe)}function Ee(Be,Pe,Re,at){return Pe!==null&&Pe.elementType===Re.type?(at=L(Pe,Re.props),at.ref=Kt(Be,Pe,Re),at.return=Be,at):(at=Zu(Re.type,Re.key,Re.props,null,Be.mode,at),at.ref=Kt(Be,Pe,Re),at.return=Be,at)}function Ge(Be,Pe,Re,at){return Pe===null||Pe.tag!==4||Pe.stateNode.containerInfo!==Re.containerInfo||Pe.stateNode.implementation!==Re.implementation?(Pe=Jc(Re,Be.mode,at),Pe.return=Be,Pe):(Pe=L(Pe,Re.children||[]),Pe.return=Be,Pe)}function zt(Be,Pe,Re,at,ct){return Pe===null||Pe.tag!==7?(Pe=Gu(Re,Be.mode,at,ct),Pe.return=Be,Pe):(Pe=L(Pe,Re),Pe.return=Be,Pe)}function hn(Be,Pe,Re){if(typeof Pe=="string"||typeof Pe=="number")return Pe=ou(""+Pe,Be.mode,Re),Pe.return=Be,Pe;if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case Ze:return Re=Zu(Pe.type,Pe.key,Pe.props,null,Be.mode,Re),Re.ref=Kt(Be,null,Pe),Re.return=Be,Re;case xt:return Pe=Jc(Pe,Be.mode,Re),Pe.return=Be,Pe}if(Ft(Pe)||Jt(Pe))return Pe=Gu(Pe,Be.mode,Re,null),Pe.return=Be,Pe;zn(Be,Pe)}return null}function _t(Be,Pe,Re,at){var ct=Pe!==null?Pe.key:null;if(typeof Re=="string"||typeof Re=="number")return ct!==null?null:ce(Be,Pe,""+Re,at);if(typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case Ze:return Re.key===ct?Re.type===It?zt(Be,Pe,Re.props.children,at,ct):Ee(Be,Pe,Re,at):null;case xt:return Re.key===ct?Ge(Be,Pe,Re,at):null}if(Ft(Re)||Jt(Re))return ct!==null?null:zt(Be,Pe,Re,at,null);zn(Be,Re)}return null}function qt(Be,Pe,Re,at,ct){if(typeof at=="string"||typeof at=="number")return Be=Be.get(Re)||null,ce(Pe,Be,""+at,ct);if(typeof at=="object"&&at!==null){switch(at.$$typeof){case Ze:return Be=Be.get(at.key===null?Re:at.key)||null,at.type===It?zt(Pe,Be,at.props.children,ct,at.key):Ee(Pe,Be,at,ct);case xt:return Be=Be.get(at.key===null?Re:at.key)||null,Ge(Pe,Be,at,ct)}if(Ft(at)||Jt(at))return Be=Be.get(Re)||null,zt(Pe,Be,at,ct,null);zn(Pe,at)}return null}function dn(Be,Pe,Re,at){for(var ct=null,_n=null,Zt=Pe,pn=Pe=0,Mn=null;Zt!==null&&pn<Re.length;pn++){Zt.index>pn?(Mn=Zt,Zt=null):Mn=Zt.sibling;var En=_t(Be,Zt,Re[pn],at);if(En===null){Zt===null&&(Zt=Mn);break}a&&Zt&&En.alternate===null&&d(Be,Zt),Pe=j(En,Pe,pn),_n===null?ct=En:_n.sibling=En,_n=En,Zt=Mn}if(pn===Re.length)return y(Be,Zt),ct;if(Zt===null){for(;pn<Re.length;pn++)Zt=hn(Be,Re[pn],at),Zt!==null&&(Pe=j(Zt,Pe,pn),_n===null?ct=Zt:_n.sibling=Zt,_n=Zt);return ct}for(Zt=C(Be,Zt);pn<Re.length;pn++)Mn=qt(Zt,Be,pn,Re[pn],at),Mn!==null&&(a&&Mn.alternate!==null&&Zt.delete(Mn.key===null?pn:Mn.key),Pe=j(Mn,Pe,pn),_n===null?ct=Mn:_n.sibling=Mn,_n=Mn);return a&&Zt.forEach(function(ml){return d(Be,ml)}),ct}function nn(Be,Pe,Re,at){var ct=Jt(Re);if(typeof ct!="function")throw Error(g(150));if(Re=ct.call(Re),Re==null)throw Error(g(151));for(var _n=ct=null,Zt=Pe,pn=Pe=0,Mn=null,En=Re.next();Zt!==null&&!En.done;pn++,En=Re.next()){Zt.index>pn?(Mn=Zt,Zt=null):Mn=Zt.sibling;var ml=_t(Be,Zt,En.value,at);if(ml===null){Zt===null&&(Zt=Mn);break}a&&Zt&&ml.alternate===null&&d(Be,Zt),Pe=j(ml,Pe,pn),_n===null?ct=ml:_n.sibling=ml,_n=ml,Zt=Mn}if(En.done)return y(Be,Zt),ct;if(Zt===null){for(;!En.done;pn++,En=Re.next())En=hn(Be,En.value,at),En!==null&&(Pe=j(En,Pe,pn),_n===null?ct=En:_n.sibling=En,_n=En);return ct}for(Zt=C(Be,Zt);!En.done;pn++,En=Re.next())En=qt(Zt,Be,pn,En.value,at),En!==null&&(a&&En.alternate!==null&&Zt.delete(En.key===null?pn:En.key),Pe=j(En,Pe,pn),_n===null?ct=En:_n.sibling=En,_n=En);return a&&Zt.forEach(function(Xp){return d(Be,Xp)}),ct}return function(Be,Pe,Re,at){var ct=typeof Re=="object"&&Re!==null&&Re.type===It&&Re.key===null;ct&&(Re=Re.props.children);var _n=typeof Re=="object"&&Re!==null;if(_n)switch(Re.$$typeof){case Ze:e:{for(_n=Re.key,ct=Pe;ct!==null;){if(ct.key===_n){switch(ct.tag){case 7:if(Re.type===It){y(Be,ct.sibling),Pe=L(ct,Re.props.children),Pe.return=Be,Be=Pe;break e}break;default:if(ct.elementType===Re.type){y(Be,ct.sibling),Pe=L(ct,Re.props),Pe.ref=Kt(Be,ct,Re),Pe.return=Be,Be=Pe;break e}}y(Be,ct);break}else d(Be,ct);ct=ct.sibling}Re.type===It?(Pe=Gu(Re.props.children,Be.mode,at,Re.key),Pe.return=Be,Be=Pe):(at=Zu(Re.type,Re.key,Re.props,null,Be.mode,at),at.ref=Kt(Be,Pe,Re),at.return=Be,Be=at)}return Y(Be);case xt:e:{for(ct=Re.key;Pe!==null;){if(Pe.key===ct)if(Pe.tag===4&&Pe.stateNode.containerInfo===Re.containerInfo&&Pe.stateNode.implementation===Re.implementation){y(Be,Pe.sibling),Pe=L(Pe,Re.children||[]),Pe.return=Be,Be=Pe;break e}else{y(Be,Pe);break}else d(Be,Pe);Pe=Pe.sibling}Pe=Jc(Re,Be.mode,at),Pe.return=Be,Be=Pe}return Y(Be)}if(typeof Re=="string"||typeof Re=="number")return Re=""+Re,Pe!==null&&Pe.tag===6?(y(Be,Pe.sibling),Pe=L(Pe,Re),Pe.return=Be,Be=Pe):(y(Be,Pe),Pe=ou(Re,Be.mode,at),Pe.return=Be,Be=Pe),Y(Be);if(Ft(Re))return dn(Be,Pe,Re,at);if(Jt(Re))return nn(Be,Pe,Re,at);if(_n&&zn(Be,Re),typeof Re>"u"&&!ct)switch(Be.tag){case 1:case 22:case 0:case 11:case 15:throw Error(g(152,Ai(Be.type)||"Component"))}return y(Be,Pe)}}var Xt=Wn(!0),gn=Wn(!1),Xn={},Jn=bs(Xn),Hr=bs(Xn),di=bs(Xn);function ti(a){if(a===Xn)throw Error(g(174));return a}function Tn(a,d){switch(ur(di,d),ur(Hr,a),ur(Jn,Xn),a=d.nodeType,a){case 9:case 11:d=(d=d.documentElement)?d.namespaceURI:No(null,"");break;default:a=a===8?d.parentNode:d,d=a.namespaceURI||null,a=a.tagName,d=No(d,a)}lr(Jn),ur(Jn,d)}function Ht(){lr(Jn),lr(Hr),lr(di)}function bn(a){ti(di.current);var d=ti(Jn.current),y=No(d,a.type);d!==y&&(ur(Hr,a),ur(Jn,y))}function fr(a){Hr.current===a&&(lr(Jn),lr(Hr))}var Bn=bs(0);function Hn(a){for(var d=a;d!==null;){if(d.tag===13){var y=d.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||y.data==="$!"))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if(d.flags&64)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var Mr=null,lo=null,yr=!1;function Vs(a,d){var y=ko(5,null,null,0);y.elementType="DELETED",y.type="DELETED",y.stateNode=d,y.return=a,y.flags=8,a.lastEffect!==null?(a.lastEffect.nextEffect=y,a.lastEffect=y):a.firstEffect=a.lastEffect=y}function Ct(a,d){switch(a.tag){case 5:var y=a.type;return d=d.nodeType!==1||y.toLowerCase()!==d.nodeName.toLowerCase()?null:d,d!==null?(a.stateNode=d,!0):!1;case 6:return d=a.pendingProps===""||d.nodeType!==3?null:d,d!==null?(a.stateNode=d,!0):!1;case 13:return!1;default:return!1}}function jt(a){if(yr){var d=lo;if(d){var y=d;if(!Ct(a,d)){if(d=ys(y.nextSibling),!d||!Ct(a,d)){a.flags=a.flags&-1025|2,yr=!1,Mr=a;return}Vs(Mr,y)}Mr=a,lo=ys(d.firstChild)}else a.flags=a.flags&-1025|2,yr=!1,Mr=a}}function Nr(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;Mr=a}function Xo(a){if(a!==Mr)return!1;if(!yr)return Nr(a),yr=!0,!1;var d=a.type;if(a.tag!==5||d!=="head"&&d!=="body"&&!nl(d,a.memoizedProps))for(d=lo;d;)Vs(a,d),d=ys(d.nextSibling);if(Nr(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(g(317));e:{for(a=a.nextSibling,d=0;a;){if(a.nodeType===8){var y=a.data;if(y==="/$"){if(d===0){lo=ys(a.nextSibling);break e}d--}else y!=="$"&&y!=="$!"&&y!=="$?"||d++}a=a.nextSibling}lo=null}}else lo=Mr?ys(a.stateNode.nextSibling):null;return!0}function Ho(){lo=Mr=null,yr=!1}var Er=[];function Sh(){for(var a=0;a<Er.length;a++)Er[a]._workInProgressVersionPrimary=null;Er.length=0}var Lc=$e.ReactCurrentDispatcher,Ri=$e.ReactCurrentBatchConfig,pr=0,un=null,Ci=null,kr=null,Ea=!1,Gl=!1;function ni(){throw Error(g(321))}function $s(a,d){if(d===null)return!1;for(var y=0;y<d.length&&y<a.length;y++)if(!Di(a[y],d[y]))return!1;return!0}function Ou(a,d,y,C,L,j){if(pr=j,un=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,Lc.current=a===null||a.memoizedState===null?bf:wf,a=y(C,L),Gl){j=0;do{if(Gl=!1,!(25>j))throw Error(g(301));j+=1,kr=Ci=null,d.updateQueue=null,Lc.current=Ef,a=y(C,L)}while(Gl)}if(Lc.current=Bc,d=Ci!==null&&Ci.next!==null,pr=0,kr=Ci=un=null,Ea=!1,d)throw Error(g(300));return a}function Ta(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return kr===null?un.memoizedState=kr=a:kr=kr.next=a,kr}function Sa(){if(Ci===null){var a=un.alternate;a=a!==null?a.memoizedState:null}else a=Ci.next;var d=kr===null?un.memoizedState:kr.next;if(d!==null)kr=d,Ci=a;else{if(a===null)throw Error(g(310));Ci=a,a={memoizedState:Ci.memoizedState,baseState:Ci.baseState,baseQueue:Ci.baseQueue,queue:Ci.queue,next:null},kr===null?un.memoizedState=kr=a:kr=kr.next=a}return kr}function Yo(a,d){return typeof d=="function"?d(a):d}function ul(a){var d=Sa(),y=d.queue;if(y===null)throw Error(g(311));y.lastRenderedReducer=a;var C=Ci,L=C.baseQueue,j=y.pending;if(j!==null){if(L!==null){var Y=L.next;L.next=j.next,j.next=Y}C.baseQueue=L=j,y.pending=null}if(L!==null){L=L.next,C=C.baseState;var ce=Y=j=null,Ee=L;do{var Ge=Ee.lane;if((pr&Ge)===Ge)ce!==null&&(ce=ce.next={lane:0,action:Ee.action,eagerReducer:Ee.eagerReducer,eagerState:Ee.eagerState,next:null}),C=Ee.eagerReducer===a?Ee.eagerState:a(C,Ee.action);else{var zt={lane:Ge,action:Ee.action,eagerReducer:Ee.eagerReducer,eagerState:Ee.eagerState,next:null};ce===null?(Y=ce=zt,j=C):ce=ce.next=zt,un.lanes|=Ge,Vc|=Ge}Ee=Ee.next}while(Ee!==null&&Ee!==L);ce===null?j=C:ce.next=Y,Di(C,d.memoizedState)||(Es=!0),d.memoizedState=C,d.baseState=j,d.baseQueue=ce,y.lastRenderedState=C}return[d.memoizedState,y.dispatch]}function ql(a){var d=Sa(),y=d.queue;if(y===null)throw Error(g(311));y.lastRenderedReducer=a;var C=y.dispatch,L=y.pending,j=d.memoizedState;if(L!==null){y.pending=null;var Y=L=L.next;do j=a(j,Y.action),Y=Y.next;while(Y!==L);Di(j,d.memoizedState)||(Es=!0),d.memoizedState=j,d.baseQueue===null&&(d.baseState=j),y.lastRenderedState=j}return[j,C]}function Mh(a,d,y){var C=d._getVersion;C=C(d._source);var L=d._workInProgressVersionPrimary;if(L!==null?a=L===C:(a=a.mutableReadLanes,(a=(pr&a)===a)&&(d._workInProgressVersionPrimary=C,Er.push(d))),a)return y(d._source);throw Er.push(d),Error(g(350))}function uo(a,d,y,C){var L=Pi;if(L===null)throw Error(g(349));var j=d._getVersion,Y=j(d._source),ce=Lc.current,Ee=ce.useState(function(){return Mh(L,d,y)}),Ge=Ee[1],zt=Ee[0];Ee=kr;var hn=a.memoizedState,_t=hn.refs,qt=_t.getSnapshot,dn=hn.source;hn=hn.subscribe;var nn=un;return a.memoizedState={refs:_t,source:d,subscribe:C},ce.useEffect(function(){_t.getSnapshot=y,_t.setSnapshot=Ge;var Be=j(d._source);if(!Di(Y,Be)){Be=y(d._source),Di(zt,Be)||(Ge(Be),Be=Ys(nn),L.mutableReadLanes|=Be&L.pendingLanes),Be=L.mutableReadLanes,L.entangledLanes|=Be;for(var Pe=L.entanglements,Re=Be;0<Re;){var at=31-Wi(Re),ct=1<<at;Pe[at]|=Be,Re&=~ct}}},[y,d,C]),ce.useEffect(function(){return C(d._source,function(){var Be=_t.getSnapshot,Pe=_t.setSnapshot;try{Pe(Be(d._source));var Re=Ys(nn);L.mutableReadLanes|=Re&L.pendingLanes}catch(at){Pe(function(){throw at})}})},[d,C]),Di(qt,y)&&Di(dn,d)&&Di(hn,C)||(a={pending:null,dispatch:null,lastRenderedReducer:Yo,lastRenderedState:zt},a.dispatch=Ge=zh.bind(null,un,a),Ee.queue=a,Ee.baseQueue=null,zt=Mh(L,d,y),Ee.memoizedState=Ee.baseState=zt),zt}function Ch(a,d,y){var C=Sa();return uo(C,a,d,y)}function Wl(a){var d=Ta();return typeof a=="function"&&(a=a()),d.memoizedState=d.baseState=a,a=d.queue={pending:null,dispatch:null,lastRenderedReducer:Yo,lastRenderedState:a},a=a.dispatch=zh.bind(null,un,a),[d.memoizedState,a]}function Xl(a,d,y,C){return a={tag:a,create:d,destroy:y,deps:C,next:null},d=un.updateQueue,d===null?(d={lastEffect:null},un.updateQueue=d,d.lastEffect=a.next=a):(y=d.lastEffect,y===null?d.lastEffect=a.next=a:(C=y.next,y.next=a,a.next=C,d.lastEffect=a)),a}function Ph(a){var d=Ta();return a={current:a},d.memoizedState=a}function cl(){return Sa().memoizedState}function Rc(a,d,y,C){var L=Ta();un.flags|=a,L.memoizedState=Xl(1|d,y,void 0,C===void 0?null:C)}function Zs(a,d,y,C){var L=Sa();C=C===void 0?null:C;var j=void 0;if(Ci!==null){var Y=Ci.memoizedState;if(j=Y.destroy,C!==null&&$s(C,Y.deps)){Xl(d,y,j,C);return}}un.flags|=a,L.memoizedState=Xl(1|d,y,j,C)}function Oc(a,d){return Rc(516,4,a,d)}function Hl(a,d){return Zs(516,4,a,d)}function Ih(a,d){return Zs(4,2,a,d)}function wd(a,d){if(typeof d=="function")return a=a(),d(a),function(){d(null)};if(d!=null)return a=a(),d.current=a,function(){d.current=null}}function Ah(a,d,y){return y=y!=null?y.concat([a]):null,Zs(4,2,wd.bind(null,d,a),y)}function kh(){}function Ed(a,d){var y=Sa();d=d===void 0?null:d;var C=y.memoizedState;return C!==null&&d!==null&&$s(d,C[1])?C[0]:(y.memoizedState=[a,d],a)}function Td(a,d){var y=Sa();d=d===void 0?null:d;var C=y.memoizedState;return C!==null&&d!==null&&$s(d,C[1])?C[0]:(a=a(),y.memoizedState=[a,d],a)}function xf(a,d){var y=v();T(98>y?98:y,function(){a(!0)}),T(97<y?97:y,function(){var C=Ri.transition;Ri.transition=1;try{a(!1),d()}finally{Ri.transition=C}})}function zh(a,d,y){var C=fo(),L=Ys(a),j={lane:L,action:y,eagerReducer:null,eagerState:null,next:null},Y=d.pending;if(Y===null?j.next=j:(j.next=Y.next,Y.next=j),d.pending=j,Y=a.alternate,a===un||Y!==null&&Y===un)Gl=Ea=!0;else{if(a.lanes===0&&(Y===null||Y.lanes===0)&&(Y=d.lastRenderedReducer,Y!==null))try{var ce=d.lastRenderedState,Ee=Y(ce,y);if(j.eagerReducer=Y,j.eagerState=Ee,Di(Ee,ce))return}catch{}finally{}ka(a,L,C)}}var Bc={readContext:he,useCallback:ni,useContext:ni,useEffect:ni,useImperativeHandle:ni,useLayoutEffect:ni,useMemo:ni,useReducer:ni,useRef:ni,useState:ni,useDebugValue:ni,useDeferredValue:ni,useTransition:ni,useMutableSource:ni,useOpaqueIdentifier:ni,unstable_isNewReconciler:!1},bf={readContext:he,useCallback:function(a,d){return Ta().memoizedState=[a,d===void 0?null:d],a},useContext:he,useEffect:Oc,useImperativeHandle:function(a,d,y){return y=y!=null?y.concat([a]):null,Rc(4,2,wd.bind(null,d,a),y)},useLayoutEffect:function(a,d){return Rc(4,2,a,d)},useMemo:function(a,d){var y=Ta();return d=d===void 0?null:d,a=a(),y.memoizedState=[a,d],a},useReducer:function(a,d,y){var C=Ta();return d=y!==void 0?y(d):d,C.memoizedState=C.baseState=d,a=C.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:d},a=a.dispatch=zh.bind(null,un,a),[C.memoizedState,a]},useRef:Ph,useState:Wl,useDebugValue:kh,useDeferredValue:function(a){var d=Wl(a),y=d[0],C=d[1];return Oc(function(){var L=Ri.transition;Ri.transition=1;try{C(a)}finally{Ri.transition=L}},[a]),y},useTransition:function(){var a=Wl(!1),d=a[0];return a=xf.bind(null,a[1]),Ph(a),[a,d]},useMutableSource:function(a,d,y){var C=Ta();return C.memoizedState={refs:{getSnapshot:d,setSnapshot:null},source:a,subscribe:y},uo(C,a,d,y)},useOpaqueIdentifier:function(){if(yr){var a=!1,d=Th(function(){throw a||(a=!0,y("r:"+(il++).toString(36))),Error(g(355))}),y=Wl(d)[1];return!(un.mode&2)&&(un.flags|=516,Xl(5,function(){y("r:"+(il++).toString(36))},void 0,null)),d}return d="r:"+(il++).toString(36),Wl(d),d},unstable_isNewReconciler:!1},wf={readContext:he,useCallback:Ed,useContext:he,useEffect:Hl,useImperativeHandle:Ah,useLayoutEffect:Ih,useMemo:Td,useReducer:ul,useRef:cl,useState:function(){return ul(Yo)},useDebugValue:kh,useDeferredValue:function(a){var d=ul(Yo),y=d[0],C=d[1];return Hl(function(){var L=Ri.transition;Ri.transition=1;try{C(a)}finally{Ri.transition=L}},[a]),y},useTransition:function(){var a=ul(Yo)[0];return[cl().current,a]},useMutableSource:Ch,useOpaqueIdentifier:function(){return ul(Yo)[0]},unstable_isNewReconciler:!1},Ef={readContext:he,useCallback:Ed,useContext:he,useEffect:Hl,useImperativeHandle:Ah,useLayoutEffect:Ih,useMemo:Td,useReducer:ql,useRef:cl,useState:function(){return ql(Yo)},useDebugValue:kh,useDeferredValue:function(a){var d=ql(Yo),y=d[0],C=d[1];return Hl(function(){var L=Ri.transition;Ri.transition=1;try{C(a)}finally{Ri.transition=L}},[a]),y},useTransition:function(){var a=ql(Yo)[0];return[cl().current,a]},useMutableSource:Ch,useOpaqueIdentifier:function(){return ql(Yo)[0]},unstable_isNewReconciler:!1},Tf=$e.ReactCurrentOwner,Es=!1;function co(a,d,y,C){d.child=a===null?gn(d,null,y,C):Xt(d,a.child,y,C)}function Sd(a,d,y,C,L){y=y.render;var j=d.ref;return pe(d,L),C=Ou(a,d,y,C,j,L),a!==null&&!Es?(d.updateQueue=a.updateQueue,d.flags&=-517,a.lanes&=~L,ho(a,d,L)):(d.flags|=1,co(a,d,C,L),d.child)}function Sf(a,d,y,C,L,j){if(a===null){var Y=y.type;return typeof Y=="function"&&!Nh(Y)&&Y.defaultProps===void 0&&y.compare===null&&y.defaultProps===void 0?(d.tag=15,d.type=Y,Bu(a,d,Y,C,L,j)):(a=Zu(y.type,null,C,d,d.mode,j),a.ref=d.ref,a.return=d,d.child=a)}return Y=a.child,!(L&j)&&(L=Y.memoizedProps,y=y.compare,y=y!==null?y:Rs,y(L,C)&&a.ref===d.ref)?ho(a,d,j):(d.flags|=1,a=Js(Y,C),a.ref=d.ref,a.return=d,d.child=a)}function Bu(a,d,y,C,L,j){if(a!==null&&Rs(a.memoizedProps,C)&&a.ref===d.ref)if(Es=!1,(j&L)!==0)a.flags&16384&&(Es=!0);else return d.lanes=a.lanes,ho(a,d,j);return Dh(a,d,y,C,j)}function Md(a,d,y){var C=d.pendingProps,L=C.children,j=a!==null?a.memoizedState:null;if(C.mode==="hidden"||C.mode==="unstable-defer-without-hiding")if(!(d.mode&4))d.memoizedState={baseLanes:0},nu(d,y);else if(y&1073741824)d.memoizedState={baseLanes:0},nu(d,j!==null?j.baseLanes:y);else return a=j!==null?j.baseLanes|y:y,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:a},nu(d,a),null;else j!==null?(C=j.baseLanes|y,d.memoizedState=null):C=y,nu(d,C);return co(a,d,L,y),d.child}function Fc(a,d){var y=d.ref;(a===null&&y!==null||a!==null&&a.ref!==y)&&(d.flags|=128)}function Dh(a,d,y,C,L){var j=ci(y)?ws:Xr.current;return j=Us(d,j),pe(d,L),y=Ou(a,d,y,C,j,L),a!==null&&!Es?(d.updateQueue=a.updateQueue,d.flags&=-517,a.lanes&=~L,ho(a,d,L)):(d.flags|=1,co(a,d,y,L),d.child)}function Lh(a,d,y,C,L){if(ci(y)){var j=!0;so(d)}else j=!1;if(pe(d,L),d.stateNode===null)a!==null&&(a.alternate=null,d.alternate=null,d.flags|=2),Gt(d,y,C),ft(d,y,C,L),C=!0;else if(a===null){var Y=d.stateNode,ce=d.memoizedProps;Y.props=ce;var Ee=Y.context,Ge=y.contextType;typeof Ge=="object"&&Ge!==null?Ge=he(Ge):(Ge=ci(y)?ws:Xr.current,Ge=Us(d,Ge));var zt=y.getDerivedStateFromProps,hn=typeof zt=="function"||typeof Y.getSnapshotBeforeUpdate=="function";hn||typeof Y.UNSAFE_componentWillReceiveProps!="function"&&typeof Y.componentWillReceiveProps!="function"||(ce!==C||Ee!==Ge)&&ln(d,Y,C,Ge),fe=!1;var _t=d.memoizedState;Y.state=_t,nt(d,C,Y,L),Ee=d.memoizedState,ce!==C||_t!==Ee||Si.current||fe?(typeof zt=="function"&&(tt(d,y,zt,C),Ee=d.memoizedState),(ce=fe||Rt(d,y,ce,C,_t,Ee,Ge))?(hn||typeof Y.UNSAFE_componentWillMount!="function"&&typeof Y.componentWillMount!="function"||(typeof Y.componentWillMount=="function"&&Y.componentWillMount(),typeof Y.UNSAFE_componentWillMount=="function"&&Y.UNSAFE_componentWillMount()),typeof Y.componentDidMount=="function"&&(d.flags|=4)):(typeof Y.componentDidMount=="function"&&(d.flags|=4),d.memoizedProps=C,d.memoizedState=Ee),Y.props=C,Y.state=Ee,Y.context=Ge,C=ce):(typeof Y.componentDidMount=="function"&&(d.flags|=4),C=!1)}else{Y=d.stateNode,Le(a,d),ce=d.memoizedProps,Ge=d.type===d.elementType?ce:U(d.type,ce),Y.props=Ge,hn=d.pendingProps,_t=Y.context,Ee=y.contextType,typeof Ee=="object"&&Ee!==null?Ee=he(Ee):(Ee=ci(y)?ws:Xr.current,Ee=Us(d,Ee));var qt=y.getDerivedStateFromProps;(zt=typeof qt=="function"||typeof Y.getSnapshotBeforeUpdate=="function")||typeof Y.UNSAFE_componentWillReceiveProps!="function"&&typeof Y.componentWillReceiveProps!="function"||(ce!==hn||_t!==Ee)&&ln(d,Y,C,Ee),fe=!1,_t=d.memoizedState,Y.state=_t,nt(d,C,Y,L);var dn=d.memoizedState;ce!==hn||_t!==dn||Si.current||fe?(typeof qt=="function"&&(tt(d,y,qt,C),dn=d.memoizedState),(Ge=fe||Rt(d,y,Ge,C,_t,dn,Ee))?(zt||typeof Y.UNSAFE_componentWillUpdate!="function"&&typeof Y.componentWillUpdate!="function"||(typeof Y.componentWillUpdate=="function"&&Y.componentWillUpdate(C,dn,Ee),typeof Y.UNSAFE_componentWillUpdate=="function"&&Y.UNSAFE_componentWillUpdate(C,dn,Ee)),typeof Y.componentDidUpdate=="function"&&(d.flags|=4),typeof Y.getSnapshotBeforeUpdate=="function"&&(d.flags|=256)):(typeof Y.componentDidUpdate!="function"||ce===a.memoizedProps&&_t===a.memoizedState||(d.flags|=4),typeof Y.getSnapshotBeforeUpdate!="function"||ce===a.memoizedProps&&_t===a.memoizedState||(d.flags|=256),d.memoizedProps=C,d.memoizedState=dn),Y.props=C,Y.state=dn,Y.context=Ee,C=Ge):(typeof Y.componentDidUpdate!="function"||ce===a.memoizedProps&&_t===a.memoizedState||(d.flags|=4),typeof Y.getSnapshotBeforeUpdate!="function"||ce===a.memoizedProps&&_t===a.memoizedState||(d.flags|=256),C=!1)}return Fu(a,d,y,C,j,L)}function Fu(a,d,y,C,L,j){Fc(a,d);var Y=(d.flags&64)!==0;if(!C&&!Y)return L&&kc(d,y,!1),ho(a,d,j);C=d.stateNode,Tf.current=d;var ce=Y&&typeof y.getDerivedStateFromError!="function"?null:C.render();return d.flags|=1,a!==null&&Y?(d.child=Xt(d,a.child,null,j),d.child=Xt(d,null,ce,j)):co(a,d,ce,j),d.memoizedState=C.state,L&&kc(d,y,!0),d.child}function Gs(a){var d=a.stateNode;d.pendingContext?Fr(a,d.pendingContext,d.pendingContext!==d.context):d.context&&Fr(a,d.context,!1),Tn(a,d.containerInfo)}var Yl={dehydrated:null,retryLane:0};function Cd(a,d,y){var C=d.pendingProps,L=Bn.current,j=!1,Y;return(Y=(d.flags&64)!==0)||(Y=a!==null&&a.memoizedState===null?!1:(L&2)!==0),Y?(j=!0,d.flags&=-65):a!==null&&a.memoizedState===null||C.fallback===void 0||C.unstable_avoidThisFallback===!0||(L|=1),ur(Bn,L&1),a===null?(C.fallback!==void 0&&jt(d),a=C.children,L=C.fallback,j?(a=Pd(d,a,L,y),d.child.memoizedState={baseLanes:y},d.memoizedState=Yl,a):typeof C.unstable_expectedLoadTime=="number"?(a=Pd(d,a,L,y),d.child.memoizedState={baseLanes:y},d.memoizedState=Yl,d.lanes=33554432,a):(y=Uh({mode:"visible",children:a},d.mode,y,null),y.return=d,d.child=y)):a.memoizedState!==null?j?(C=Cf(a,d,C.children,C.fallback,y),j=d.child,L=a.child.memoizedState,j.memoizedState=L===null?{baseLanes:y}:{baseLanes:L.baseLanes|y},j.childLanes=a.childLanes&~y,d.memoizedState=Yl,C):(y=Mf(a,d,C.children,y),d.memoizedState=null,y):j?(C=Cf(a,d,C.children,C.fallback,y),j=d.child,L=a.child.memoizedState,j.memoizedState=L===null?{baseLanes:y}:{baseLanes:L.baseLanes|y},j.childLanes=a.childLanes&~y,d.memoizedState=Yl,C):(y=Mf(a,d,C.children,y),d.memoizedState=null,y)}function Pd(a,d,y,C){var L=a.mode,j=a.child;return d={mode:"hidden",children:d},!(L&2)&&j!==null?(j.childLanes=0,j.pendingProps=d):j=Uh(d,L,0,null),y=Gu(y,L,C,null),j.return=a,y.return=a,j.sibling=y,a.child=j,y}function Mf(a,d,y,C){var L=a.child;return a=L.sibling,y=Js(L,{mode:"visible",children:y}),!(d.mode&2)&&(y.lanes=C),y.return=d,y.sibling=null,a!==null&&(a.nextEffect=null,a.flags=8,d.firstEffect=d.lastEffect=a),d.child=y}function Cf(a,d,y,C,L){var j=d.mode,Y=a.child;a=Y.sibling;var ce={mode:"hidden",children:y};return!(j&2)&&d.child!==Y?(y=d.child,y.childLanes=0,y.pendingProps=ce,Y=y.lastEffect,Y!==null?(d.firstEffect=y.firstEffect,d.lastEffect=Y,Y.nextEffect=null):d.firstEffect=d.lastEffect=null):y=Js(Y,ce),a!==null?C=Js(a,C):(C=Gu(C,j,L,null),C.flags|=2),C.return=d,y.return=d,y.sibling=C,d.child=y,C}function Pf(a,d){a.lanes|=d;var y=a.alternate;y!==null&&(y.lanes|=d),me(a.return,d)}function Nc(a,d,y,C,L,j){var Y=a.memoizedState;Y===null?a.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:C,tail:y,tailMode:L,lastEffect:j}:(Y.isBackwards=d,Y.rendering=null,Y.renderingStartTime=0,Y.last=C,Y.tail=y,Y.tailMode=L,Y.lastEffect=j)}function Nu(a,d,y){var C=d.pendingProps,L=C.revealOrder,j=C.tail;if(co(a,d,C.children,y),C=Bn.current,C&2)C=C&1|2,d.flags|=64;else{if(a!==null&&a.flags&64)e:for(a=d.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Pf(a,y);else if(a.tag===19)Pf(a,y);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===d)break e;for(;a.sibling===null;){if(a.return===null||a.return===d)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}C&=1}if(ur(Bn,C),!(d.mode&2))d.memoizedState=null;else switch(L){case"forwards":for(y=d.child,L=null;y!==null;)a=y.alternate,a!==null&&Hn(a)===null&&(L=y),y=y.sibling;y=L,y===null?(L=d.child,d.child=null):(L=y.sibling,y.sibling=null),Nc(d,!1,L,y,j,d.lastEffect);break;case"backwards":for(y=null,L=d.child,d.child=null;L!==null;){if(a=L.alternate,a!==null&&Hn(a)===null){d.child=L;break}a=L.sibling,L.sibling=y,y=L,L=a}Nc(d,!0,y,null,j,d.lastEffect);break;case"together":Nc(d,!1,null,null,void 0,d.lastEffect);break;default:d.memoizedState=null}return d.child}function ho(a,d,y){if(a!==null&&(d.dependencies=a.dependencies),Vc|=d.lanes,y&d.childLanes){if(a!==null&&d.child!==a.child)throw Error(g(153));if(d.child!==null){for(a=d.child,y=Js(a,a.pendingProps),d.child=y,y.return=d;a.sibling!==null;)a=a.sibling,y=y.sibling=Js(a,a.pendingProps),y.return=d;y.sibling=null}return d.child}return null}var qs,Co,Ma,Ws;qs=function(a,d){for(var y=d.child;y!==null;){if(y.tag===5||y.tag===6)a.appendChild(y.stateNode);else if(y.tag!==4&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===d)break;for(;y.sibling===null;){if(y.return===null||y.return===d)return;y=y.return}y.sibling.return=y.return,y=y.sibling}},Co=function(){},Ma=function(a,d,y,C){var L=a.memoizedProps;if(L!==C){a=d.stateNode,ti(Jn.current);var j=null;switch(y){case"input":L=Oo(a,L),C=Oo(a,C),j=[];break;case"option":L=Bo(a,L),C=Bo(a,C),j=[];break;case"select":L=s({},L,{value:void 0}),C=s({},C,{value:void 0}),j=[];break;case"textarea":L=Fo(a,L),C=Fo(a,C),j=[];break;default:typeof L.onClick!="function"&&typeof C.onClick=="function"&&(a.onclick=_a)}Eo(y,C);var Y;y=null;for(Ge in L)if(!C.hasOwnProperty(Ge)&&L.hasOwnProperty(Ge)&&L[Ge]!=null)if(Ge==="style"){var ce=L[Ge];for(Y in ce)ce.hasOwnProperty(Y)&&(y||(y={}),y[Y]="")}else Ge!=="dangerouslySetInnerHTML"&&Ge!=="children"&&Ge!=="suppressContentEditableWarning"&&Ge!=="suppressHydrationWarning"&&Ge!=="autoFocus"&&(M.hasOwnProperty(Ge)?j||(j=[]):(j=j||[]).push(Ge,null));for(Ge in C){var Ee=C[Ge];if(ce=L!=null?L[Ge]:void 0,C.hasOwnProperty(Ge)&&Ee!==ce&&(Ee!=null||ce!=null))if(Ge==="style")if(ce){for(Y in ce)!ce.hasOwnProperty(Y)||Ee&&Ee.hasOwnProperty(Y)||(y||(y={}),y[Y]="");for(Y in Ee)Ee.hasOwnProperty(Y)&&ce[Y]!==Ee[Y]&&(y||(y={}),y[Y]=Ee[Y])}else y||(j||(j=[]),j.push(Ge,y)),y=Ee;else Ge==="dangerouslySetInnerHTML"?(Ee=Ee?Ee.__html:void 0,ce=ce?ce.__html:void 0,Ee!=null&&ce!==Ee&&(j=j||[]).push(Ge,Ee)):Ge==="children"?typeof Ee!="string"&&typeof Ee!="number"||(j=j||[]).push(Ge,""+Ee):Ge!=="suppressContentEditableWarning"&&Ge!=="suppressHydrationWarning"&&(M.hasOwnProperty(Ge)?(Ee!=null&&Ge==="onScroll"&&dr("scroll",a),j||ce===Ee||(j=[])):typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===Qt?Ee.toString():(j=j||[]).push(Ge,Ee))}y&&(j=j||[]).push("style",y);var Ge=j;(d.updateQueue=Ge)&&(d.flags|=4)}},Ws=function(a,d,y,C){y!==C&&(d.flags|=4)};function Ts(a,d){if(!yr)switch(a.tailMode){case"hidden":d=a.tail;for(var y=null;d!==null;)d.alternate!==null&&(y=d),d=d.sibling;y===null?a.tail=null:y.sibling=null;break;case"collapsed":y=a.tail;for(var C=null;y!==null;)y.alternate!==null&&(C=y),y=y.sibling;C===null?d||a.tail===null?a.tail=null:a.tail.sibling=null:C.sibling=null}}function Rp(a,d,y){var C=d.pendingProps;switch(d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return ci(d.type)&&sl(),null;case 3:return Ht(),lr(Si),lr(Xr),Sh(),C=d.stateNode,C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(a===null||a.child===null)&&(Xo(d)?d.flags|=4:C.hydrate||(d.flags|=256)),Co(d),null;case 5:fr(d);var L=ti(di.current);if(y=d.type,a!==null&&d.stateNode!=null)Ma(a,d,y,C,L),a.ref!==d.ref&&(d.flags|=128);else{if(!C){if(d.stateNode===null)throw Error(g(166));return null}if(a=ti(Jn.current),Xo(d)){C=d.stateNode,y=d.type;var j=d.memoizedProps;switch(C[Fs]=d,C[ku]=j,y){case"dialog":dr("cancel",C),dr("close",C);break;case"iframe":case"object":case"embed":dr("load",C);break;case"video":case"audio":for(a=0;a<Bs.length;a++)dr(Bs[a],C);break;case"source":dr("error",C);break;case"img":case"image":case"link":dr("error",C),dr("load",C);break;case"details":dr("toggle",C);break;case"input":is(C,j),dr("invalid",C);break;case"select":C._wrapperState={wasMultiple:!!j.multiple},dr("invalid",C);break;case"textarea":ss(C,j),dr("invalid",C)}Eo(y,j),a=null;for(var Y in j)j.hasOwnProperty(Y)&&(L=j[Y],Y==="children"?typeof L=="string"?C.textContent!==L&&(a=["children",L]):typeof L=="number"&&C.textContent!==""+L&&(a=["children",""+L]):M.hasOwnProperty(Y)&&L!=null&&Y==="onScroll"&&dr("scroll",C));switch(y){case"input":en(C),xo(C,j,!0);break;case"textarea":en(C),oi(C);break;case"select":case"option":break;default:typeof j.onClick=="function"&&(C.onclick=_a)}C=a,d.updateQueue=C,C!==null&&(d.flags|=4)}else{switch(Y=L.nodeType===9?L:L.ownerDocument,a===bo.html&&(a=wo(y)),a===bo.html?y==="script"?(a=Y.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof C.is=="string"?a=Y.createElement(y,{is:C.is}):(a=Y.createElement(y),y==="select"&&(Y=a,C.multiple?Y.multiple=!0:C.size&&(Y.size=C.size))):a=Y.createElementNS(a,y),a[Fs]=d,a[ku]=C,qs(a,d,!1,!1),d.stateNode=a,Y=Vi(y,C),y){case"dialog":dr("cancel",a),dr("close",a),L=C;break;case"iframe":case"object":case"embed":dr("load",a),L=C;break;case"video":case"audio":for(L=0;L<Bs.length;L++)dr(Bs[L],a);L=C;break;case"source":dr("error",a),L=C;break;case"img":case"image":case"link":dr("error",a),dr("load",a),L=C;break;case"details":dr("toggle",a),L=C;break;case"input":is(a,C),L=Oo(a,C),dr("invalid",a);break;case"option":L=Bo(a,C);break;case"select":a._wrapperState={wasMultiple:!!C.multiple},L=s({},C,{value:void 0}),dr("invalid",a);break;case"textarea":ss(a,C),L=Fo(a,C),dr("invalid",a);break;default:L=C}Eo(y,L);var ce=L;for(j in ce)if(ce.hasOwnProperty(j)){var Ee=ce[j];j==="style"?us(a,Ee):j==="dangerouslySetInnerHTML"?(Ee=Ee?Ee.__html:void 0,Ee!=null&&ls(a,Ee)):j==="children"?typeof Ee=="string"?(y!=="textarea"||Ee!=="")&&Zr(a,Ee):typeof Ee=="number"&&Zr(a,""+Ee):j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&j!=="autoFocus"&&(M.hasOwnProperty(j)?Ee!=null&&j==="onScroll"&&dr("scroll",a):Ee!=null&&Xe(a,j,Ee,Y))}switch(y){case"input":en(a),xo(a,C,!1);break;case"textarea":en(a),oi(a);break;case"option":C.value!=null&&a.setAttribute("value",""+Vr(C.value));break;case"select":a.multiple=!!C.multiple,j=C.value,j!=null?qn(a,!!C.multiple,j,!1):C.defaultValue!=null&&qn(a,!!C.multiple,C.defaultValue,!0);break;default:typeof L.onClick=="function"&&(a.onclick=_a)}Ic(y,C)&&(d.flags|=4)}d.ref!==null&&(d.flags|=128)}return null;case 6:if(a&&d.stateNode!=null)Ws(a,d,a.memoizedProps,C);else{if(typeof C!="string"&&d.stateNode===null)throw Error(g(166));y=ti(di.current),ti(Jn.current),Xo(d)?(C=d.stateNode,y=d.memoizedProps,C[Fs]=d,C.nodeValue!==y&&(d.flags|=4)):(C=(y.nodeType===9?y:y.ownerDocument).createTextNode(C),C[Fs]=d,d.stateNode=C)}return null;case 13:return lr(Bn),C=d.memoizedState,d.flags&64?(d.lanes=y,d):(C=C!==null,y=!1,a===null?d.memoizedProps.fallback!==void 0&&Xo(d):y=a.memoizedState!==null,C&&!y&&d.mode&2&&(a===null&&d.memoizedProps.unstable_avoidThisFallback!==!0||Bn.current&1?Kr===0&&(Kr=3):((Kr===0||Kr===3)&&(Kr=4),Pi===null||!(Vc&134217727)&&!(Ql&134217727)||$u(Pi,Oi))),(C||y)&&(d.flags|=4),null);case 4:return Ht(),Co(d),a===null&&Eh(d.stateNode.containerInfo),null;case 10:return J(d),null;case 17:return ci(d.type)&&sl(),null;case 19:if(lr(Bn),C=d.memoizedState,C===null)return null;if(j=(d.flags&64)!==0,Y=C.rendering,Y===null)if(j)Ts(C,!1);else{if(Kr!==0||a!==null&&a.flags&64)for(a=d.child;a!==null;){if(Y=Hn(a),Y!==null){for(d.flags|=64,Ts(C,!1),j=Y.updateQueue,j!==null&&(d.updateQueue=j,d.flags|=4),C.lastEffect===null&&(d.firstEffect=null),d.lastEffect=C.lastEffect,C=y,y=d.child;y!==null;)j=y,a=C,j.flags&=2,j.nextEffect=null,j.firstEffect=null,j.lastEffect=null,Y=j.alternate,Y===null?(j.childLanes=0,j.lanes=a,j.child=null,j.memoizedProps=null,j.memoizedState=null,j.updateQueue=null,j.dependencies=null,j.stateNode=null):(j.childLanes=Y.childLanes,j.lanes=Y.lanes,j.child=Y.child,j.memoizedProps=Y.memoizedProps,j.memoizedState=Y.memoizedState,j.updateQueue=Y.updateQueue,j.type=Y.type,a=Y.dependencies,j.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),y=y.sibling;return ur(Bn,Bn.current&1|2),d.child}a=a.sibling}C.tail!==null&&m()>Zc&&(d.flags|=64,j=!0,Ts(C,!1),d.lanes=33554432)}else{if(!j)if(a=Hn(Y),a!==null){if(d.flags|=64,j=!0,y=a.updateQueue,y!==null&&(d.updateQueue=y,d.flags|=4),Ts(C,!0),C.tail===null&&C.tailMode==="hidden"&&!Y.alternate&&!yr)return d=d.lastEffect=C.lastEffect,d!==null&&(d.nextEffect=null),null}else 2*m()-C.renderingStartTime>Zc&&y!==1073741824&&(d.flags|=64,j=!0,Ts(C,!1),d.lanes=33554432);C.isBackwards?(Y.sibling=d.child,d.child=Y):(y=C.last,y!==null?y.sibling=Y:d.child=Y,C.last=Y)}return C.tail!==null?(y=C.tail,C.rendering=y,C.tail=y.sibling,C.lastEffect=d.lastEffect,C.renderingStartTime=m(),y.sibling=null,d=Bn.current,ur(Bn,j?d&1|2:d&1),y):null;case 23:case 24:return Bd(),a!==null&&a.memoizedState!==null!=(d.memoizedState!==null)&&C.mode!=="unstable-defer-without-hiding"&&(d.flags|=4),null}throw Error(g(156,d.tag))}function Op(a){switch(a.tag){case 1:ci(a.type)&&sl();var d=a.flags;return d&4096?(a.flags=d&-4097|64,a):null;case 3:if(Ht(),lr(Si),lr(Xr),Sh(),d=a.flags,d&64)throw Error(g(285));return a.flags=d&-4097|64,a;case 5:return fr(a),null;case 13:return lr(Bn),d=a.flags,d&4096?(a.flags=d&-4097|64,a):null;case 19:return lr(Bn),null;case 4:return Ht(),null;case 10:return J(a),null;case 23:case 24:return Bd(),null;default:return null}}function Id(a,d){try{var y="",C=d;do y+=Lr(C),C=C.return;while(C);var L=y}catch(j){L=`
Error generating stack: `+j.message+`
`+j.stack}return{value:a,source:d,stack:L}}function Ad(a,d){try{console.error(d.value)}catch(y){setTimeout(function(){throw y})}}var If=typeof WeakMap=="function"?WeakMap:Map;function Uc(a,d,y){y=Ue(-1,y),y.tag=3,y.payload={element:null};var C=d.value;return y.callback=function(){Pa||(Pa=!0,Rh=C),Ad(a,d)},y}function Ko(a,d,y){y=Ue(-1,y),y.tag=3;var C=a.type.getDerivedStateFromError;if(typeof C=="function"){var L=d.value;y.payload=function(){return Ad(a,d),C(L)}}var j=a.stateNode;return j!==null&&typeof j.componentDidCatch=="function"&&(y.callback=function(){typeof C!="function"&&(Hs===null?Hs=new Set([this]):Hs.add(this),Ad(a,d));var Y=d.stack;this.componentDidCatch(d.value,{componentStack:Y!==null?Y:""})}),y}var Bp=typeof WeakSet=="function"?WeakSet:Set;function Af(a){var d=a.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(y){Ms(a,y)}else d.current=null}function Cr(a,d){switch(d.tag){case 0:case 11:case 15:case 22:return;case 1:if(d.flags&256&&a!==null){var y=a.memoizedProps,C=a.memoizedState;a=d.stateNode,d=a.getSnapshotBeforeUpdate(d.elementType===d.type?y:U(d.type,y),C),a.__reactInternalSnapshotBeforeUpdate=d}return;case 3:d.flags&256&&rl(d.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(g(163))}function wn(a,d,y){switch(y.tag){case 0:case 11:case 15:case 22:if(d=y.updateQueue,d=d!==null?d.lastEffect:null,d!==null){a=d=d.next;do{if((a.tag&3)===3){var C=a.create;a.destroy=C()}a=a.next}while(a!==d)}if(d=y.updateQueue,d=d!==null?d.lastEffect:null,d!==null){a=d=d.next;do{var L=a;C=L.next,L=L.tag,L&4&&L&1&&(iu(y,a),$p(y,a)),a=C}while(a!==d)}return;case 1:a=y.stateNode,y.flags&4&&(d===null?a.componentDidMount():(C=y.elementType===y.type?d.memoizedProps:U(y.type,d.memoizedProps),a.componentDidUpdate(C,d.memoizedState,a.__reactInternalSnapshotBeforeUpdate))),d=y.updateQueue,d!==null&&qe(y,d,a);return;case 3:if(d=y.updateQueue,d!==null){if(a=null,y.child!==null)switch(y.child.tag){case 5:a=y.child.stateNode;break;case 1:a=y.child.stateNode}qe(y,d,a)}return;case 5:a=y.stateNode,d===null&&y.flags&4&&Ic(y.type,y.memoizedProps)&&a.focus();return;case 6:return;case 4:return;case 12:return;case 13:y.memoizedState===null&&(y=y.alternate,y!==null&&(y=y.memoizedState,y!==null&&(y=y.dehydrated,y!==null&&xe(y))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(g(163))}function hl(a,d){for(var y=a;;){if(y.tag===5){var C=y.stateNode;if(d)C=C.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none";else{C=y.stateNode;var L=y.memoizedProps.style;L=L!=null&&L.hasOwnProperty("display")?L.display:null,C.style.display=yi("display",L)}}else if(y.tag===6)y.stateNode.nodeValue=d?"":y.memoizedProps;else if((y.tag!==23&&y.tag!==24||y.memoizedState===null||y===a)&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===a)break;for(;y.sibling===null;){if(y.return===null||y.return===a)return;y=y.return}y.sibling.return=y.return,y=y.sibling}}function kd(a,d){if(ao&&typeof ao.onCommitFiberUnmount=="function")try{ao.onCommitFiberUnmount(Ki,d)}catch{}switch(d.tag){case 0:case 11:case 14:case 15:case 22:if(a=d.updateQueue,a!==null&&(a=a.lastEffect,a!==null)){var y=a=a.next;do{var C=y,L=C.destroy;if(C=C.tag,L!==void 0)if(C&4)iu(d,y);else{C=d;try{L()}catch(j){Ms(C,j)}}y=y.next}while(y!==a)}break;case 1:if(Af(d),a=d.stateNode,typeof a.componentWillUnmount=="function")try{a.props=d.memoizedProps,a.state=d.memoizedState,a.componentWillUnmount()}catch(j){Ms(d,j)}break;case 5:Af(d);break;case 4:Jo(a,d)}}function Gn(a){a.alternate=null,a.child=null,a.dependencies=null,a.firstEffect=null,a.lastEffect=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.return=null,a.updateQueue=null}function zd(a){return a.tag===5||a.tag===3||a.tag===4}function Dd(a){e:{for(var d=a.return;d!==null;){if(zd(d))break e;d=d.return}throw Error(g(160))}var y=d;switch(d=y.stateNode,y.tag){case 5:var C=!1;break;case 3:d=d.containerInfo,C=!0;break;case 4:d=d.containerInfo,C=!0;break;default:throw Error(g(161))}y.flags&16&&(Zr(d,""),y.flags&=-17);e:t:for(y=a;;){for(;y.sibling===null;){if(y.return===null||zd(y.return)){y=null;break e}y=y.return}for(y.sibling.return=y.return,y=y.sibling;y.tag!==5&&y.tag!==6&&y.tag!==18;){if(y.flags&2||y.child===null||y.tag===4)continue t;y.child.return=y,y=y.child}if(!(y.flags&2)){y=y.stateNode;break e}}C?dl(a,y,d):fl(a,y,d)}function dl(a,d,y){var C=a.tag,L=C===5||C===6;if(L)a=L?a.stateNode:a.stateNode.instance,d?y.nodeType===8?y.parentNode.insertBefore(a,d):y.insertBefore(a,d):(y.nodeType===8?(d=y.parentNode,d.insertBefore(a,y)):(d=y,d.appendChild(a)),y=y._reactRootContainer,y!=null||d.onclick!==null||(d.onclick=_a));else if(C!==4&&(a=a.child,a!==null))for(dl(a,d,y),a=a.sibling;a!==null;)dl(a,d,y),a=a.sibling}function fl(a,d,y){var C=a.tag,L=C===5||C===6;if(L)a=L?a.stateNode:a.stateNode.instance,d?y.insertBefore(a,d):y.appendChild(a);else if(C!==4&&(a=a.child,a!==null))for(fl(a,d,y),a=a.sibling;a!==null;)fl(a,d,y),a=a.sibling}function Jo(a,d){for(var y=d,C=!1,L,j;;){if(!C){C=y.return;e:for(;;){if(C===null)throw Error(g(160));switch(L=C.stateNode,C.tag){case 5:j=!1;break e;case 3:L=L.containerInfo,j=!0;break e;case 4:L=L.containerInfo,j=!0;break e}C=C.return}C=!0}if(y.tag===5||y.tag===6){e:for(var Y=a,ce=y,Ee=ce;;)if(kd(Y,Ee),Ee.child!==null&&Ee.tag!==4)Ee.child.return=Ee,Ee=Ee.child;else{if(Ee===ce)break e;for(;Ee.sibling===null;){if(Ee.return===null||Ee.return===ce)break e;Ee=Ee.return}Ee.sibling.return=Ee.return,Ee=Ee.sibling}j?(Y=L,ce=y.stateNode,Y.nodeType===8?Y.parentNode.removeChild(ce):Y.removeChild(ce)):L.removeChild(y.stateNode)}else if(y.tag===4){if(y.child!==null){L=y.stateNode.containerInfo,j=!0,y.child.return=y,y=y.child;continue}}else if(kd(a,y),y.child!==null){y.child.return=y,y=y.child;continue}if(y===d)break;for(;y.sibling===null;){if(y.return===null||y.return===d)return;y=y.return,y.tag===4&&(C=!1)}y.sibling.return=y.return,y=y.sibling}}function Ss(a,d){switch(d.tag){case 0:case 11:case 14:case 15:case 22:var y=d.updateQueue;if(y=y!==null?y.lastEffect:null,y!==null){var C=y=y.next;do(C.tag&3)===3&&(a=C.destroy,C.destroy=void 0,a!==void 0&&a()),C=C.next;while(C!==y)}return;case 1:return;case 5:if(y=d.stateNode,y!=null){C=d.memoizedProps;var L=a!==null?a.memoizedProps:C;a=d.type;var j=d.updateQueue;if(d.updateQueue=null,j!==null){for(y[ku]=C,a==="input"&&C.type==="radio"&&C.name!=null&&vo(y,C),Vi(a,L),d=Vi(a,C),L=0;L<j.length;L+=2){var Y=j[L],ce=j[L+1];Y==="style"?us(y,ce):Y==="dangerouslySetInnerHTML"?ls(y,ce):Y==="children"?Zr(y,ce):Xe(y,Y,ce,d)}switch(a){case"input":rn(y,C);break;case"textarea":as(y,C);break;case"select":a=y._wrapperState.wasMultiple,y._wrapperState.wasMultiple=!!C.multiple,j=C.value,j!=null?qn(y,!!C.multiple,j,!1):a!==!!C.multiple&&(C.defaultValue!=null?qn(y,!!C.multiple,C.defaultValue,!0):qn(y,!!C.multiple,C.multiple?[]:"",!1))}}}return;case 6:if(d.stateNode===null)throw Error(g(162));d.stateNode.nodeValue=d.memoizedProps;return;case 3:y=d.stateNode,y.hydrate&&(y.hydrate=!1,xe(y.containerInfo));return;case 12:return;case 13:d.memoizedState!==null&&(Rd=m(),hl(d.child,!0)),Po(d);return;case 19:Po(d);return;case 17:return;case 23:case 24:hl(d,d.memoizedState!==null);return}throw Error(g(163))}function Po(a){var d=a.updateQueue;if(d!==null){a.updateQueue=null;var y=a.stateNode;y===null&&(y=a.stateNode=new Bp),d.forEach(function(C){var L=Fh.bind(null,a,C);y.has(C)||(y.add(C),C.then(L,L))})}}function kf(a,d){return a!==null&&(a=a.memoizedState,a===null||a.dehydrated!==null)?(d=d.memoizedState,d!==null&&d.dehydrated===null):!1}var Xs=Math.ceil,Kl=$e.ReactCurrentDispatcher,jc=$e.ReactCurrentOwner,cn=0,Pi=null,Yr=null,Oi=0,Ji=0,Ca=bs(0),Kr=0,Uu=null,Jl=0,Vc=0,Ql=0,Ld=0,$c=null,Rd=0,Zc=1/0;function eu(){Zc=m()+500}var Vt=null,Pa=!1,Rh=null,Hs=null,Io=!1,pl=null,ju=90,Oh=[],Od=[],Ia=null,tu=0,Ao=null,Gc=-1,Aa=0,qc=0,Wc=null,Bh=!1;function fo(){return cn&48?m():Gc!==-1?Gc:Gc=m()}function Ys(a){if(a=a.mode,!(a&2))return 1;if(!(a&4))return v()===99?1:2;if(Aa===0&&(Aa=Jl),B.transition!==0){qc!==0&&(qc=$c!==null?$c.pendingLanes:0),a=Aa;var d=4186112&~qc;return d&=-d,d===0&&(a=4186112&~a,d=a&-a,d===0&&(d=8192)),d}return a=v(),cn&4&&a===98?a=mu(12,Aa):(a=zs(a),a=mu(a,Aa)),a}function ka(a,d,y){if(50<tu)throw tu=0,Ao=null,Error(g(185));if(a=Vu(a,d),a===null)return null;ms(a,d,y),a===Pi&&(Ql|=d,Kr===4&&$u(a,Oi));var C=v();d===1?cn&8&&!(cn&48)?Xc(a):(ri(a,y),cn===0&&(eu(),D())):(!(cn&4)||C!==98&&C!==99||(Ia===null?Ia=new Set([a]):Ia.add(a)),ri(a,y)),$c=a}function Vu(a,d){a.lanes|=d;var y=a.alternate;for(y!==null&&(y.lanes|=d),y=a,a=a.return;a!==null;)a.childLanes|=d,y=a.alternate,y!==null&&(y.childLanes|=d),y=a,a=a.return;return y.tag===3?y.stateNode:null}function ri(a,d){for(var y=a.callbackNode,C=a.suspendedLanes,L=a.pingedLanes,j=a.expirationTimes,Y=a.pendingLanes;0<Y;){var ce=31-Wi(Y),Ee=1<<ce,Ge=j[ce];if(Ge===-1){if(!(Ee&C)||Ee&L){Ge=d,jo(Ee);var zt=Bt;j[ce]=10<=zt?Ge+250:6<=zt?Ge+5e3:-1}}else Ge<=d&&(a.expiredLanes|=Ee);Y&=~Ee}if(C=ui(a,a===Pi?Oi:0),d=Bt,C===0)y!==null&&(y!==Ru&&$l(y),a.callbackNode=null,a.callbackPriority=0);else{if(y!==null){if(a.callbackPriority===d)return;y!==Ru&&$l(y)}d===15?(y=Xc.bind(null,a),hi===null?(hi=[y],p=zc(js,O)):hi.push(y),y=Ru):d===14?y=P(99,Xc.bind(null,a)):(y=Tl(d),y=P(y,po.bind(null,a))),a.callbackPriority=d,a.callbackNode=y}}function po(a){if(Gc=-1,qc=Aa=0,cn&48)throw Error(g(327));var d=a.callbackNode;if(Ks()&&a.callbackNode!==d)return null;var y=ui(a,a===Pi?Oi:0);if(y===0)return null;var C=y,L=cn;cn|=16;var j=Da();(Pi!==a||Oi!==C)&&(eu(),za(a,C));do try{Up();break}catch(ce){Fd(a,ce)}while(!0);if(_e(),Kl.current=j,cn=L,Yr!==null?C=0:(Pi=null,Oi=0,C=Kr),Jl&Ql)za(a,0);else if(C!==0){if(C===2&&(cn|=64,a.hydrate&&(a.hydrate=!1,rl(a.containerInfo)),y=hr(a),y!==0&&(C=La(a,y))),C===1)throw d=Uu,za(a,0),$u(a,y),ri(a,m()),d;switch(a.finishedWork=a.current.alternate,a.finishedLanes=y,C){case 0:case 1:throw Error(g(345));case 2:ru(a);break;case 3:if($u(a,y),(y&62914560)===y&&(C=Rd+500-m(),10<C)){if(ui(a,0)!==0)break;if(L=a.suspendedLanes,(L&y)!==y){fo(),a.pingedLanes|=a.suspendedLanes&L;break}a.timeoutHandle=qo(ru.bind(null,a),C);break}ru(a);break;case 4:if($u(a,y),(y&4186112)===y)break;for(C=a.eventTimes,L=-1;0<y;){var Y=31-Wi(y);j=1<<Y,Y=C[Y],Y>L&&(L=Y),y&=~j}if(y=L,y=m()-y,y=(120>y?120:480>y?480:1080>y?1080:1920>y?1920:3e3>y?3e3:4320>y?4320:1960*Xs(y/1960))-y,10<y){a.timeoutHandle=qo(ru.bind(null,a),y);break}ru(a);break;case 5:ru(a);break;default:throw Error(g(329))}}return ri(a,m()),a.callbackNode===d?po.bind(null,a):null}function $u(a,d){for(d&=~Ld,d&=~Ql,a.suspendedLanes|=d,a.pingedLanes&=~d,a=a.expirationTimes;0<d;){var y=31-Wi(d),C=1<<y;a[y]=-1,d&=~C}}function Xc(a){if(cn&48)throw Error(g(327));if(Ks(),a===Pi&&a.expiredLanes&Oi){var d=Oi,y=La(a,d);Jl&Ql&&(d=ui(a,d),y=La(a,d))}else d=ui(a,0),y=La(a,d);if(a.tag!==0&&y===2&&(cn|=64,a.hydrate&&(a.hydrate=!1,rl(a.containerInfo)),d=hr(a),d!==0&&(y=La(a,d))),y===1)throw y=Uu,za(a,0),$u(a,d),ri(a,m()),y;return a.finishedWork=a.current.alternate,a.finishedLanes=d,ru(a),ri(a,m()),null}function Fp(){if(Ia!==null){var a=Ia;Ia=null,a.forEach(function(d){d.expiredLanes|=24&d.pendingLanes,ri(d,m())})}D()}function zf(a,d){var y=cn;cn|=1;try{return a(d)}finally{cn=y,cn===0&&(eu(),D())}}function Df(a,d){var y=cn;cn&=-2,cn|=8;try{return a(d)}finally{cn=y,cn===0&&(eu(),D())}}function nu(a,d){ur(Ca,Ji),Ji|=d,Jl|=d}function Bd(){Ji=Ca.current,lr(Ca)}function za(a,d){a.finishedWork=null,a.finishedLanes=0;var y=a.timeoutHandle;if(y!==-1&&(a.timeoutHandle=-1,Ac(y)),Yr!==null)for(y=Yr.return;y!==null;){var C=y;switch(C.tag){case 1:C=C.type.childContextTypes,C!=null&&sl();break;case 3:Ht(),lr(Si),lr(Xr),Sh();break;case 5:fr(C);break;case 4:Ht();break;case 13:lr(Bn);break;case 19:lr(Bn);break;case 10:J(C);break;case 23:case 24:Bd()}y=y.return}Pi=a,Yr=Js(a.current,null),Oi=Ji=Jl=d,Kr=0,Uu=null,Ld=Ql=Vc=0}function Fd(a,d){do{var y=Yr;try{if(_e(),Lc.current=Bc,Ea){for(var C=un.memoizedState;C!==null;){var L=C.queue;L!==null&&(L.pending=null),C=C.next}Ea=!1}if(pr=0,kr=Ci=un=null,Gl=!1,jc.current=null,y===null||y.return===null){Kr=1,Uu=d,Yr=null;break}e:{var j=a,Y=y.return,ce=y,Ee=d;if(d=Oi,ce.flags|=2048,ce.firstEffect=ce.lastEffect=null,Ee!==null&&typeof Ee=="object"&&typeof Ee.then=="function"){var Ge=Ee;if(!(ce.mode&2)){var zt=ce.alternate;zt?(ce.updateQueue=zt.updateQueue,ce.memoizedState=zt.memoizedState,ce.lanes=zt.lanes):(ce.updateQueue=null,ce.memoizedState=null)}var hn=(Bn.current&1)!==0,_t=Y;do{var qt;if(qt=_t.tag===13){var dn=_t.memoizedState;if(dn!==null)qt=dn.dehydrated!==null;else{var nn=_t.memoizedProps;qt=nn.fallback===void 0?!1:nn.unstable_avoidThisFallback!==!0?!0:!hn}}if(qt){var Be=_t.updateQueue;if(Be===null){var Pe=new Set;Pe.add(Ge),_t.updateQueue=Pe}else Be.add(Ge);if(!(_t.mode&2)){if(_t.flags|=64,ce.flags|=16384,ce.flags&=-2981,ce.tag===1)if(ce.alternate===null)ce.tag=17;else{var Re=Ue(-1,1);Re.tag=2,ht(ce,Re)}ce.lanes|=1;break e}Ee=void 0,ce=d;var at=j.pingCache;if(at===null?(at=j.pingCache=new If,Ee=new Set,at.set(Ge,Ee)):(Ee=at.get(Ge),Ee===void 0&&(Ee=new Set,at.set(Ge,Ee))),!Ee.has(ce)){Ee.add(ce);var ct=Of.bind(null,j,Ge,ce);Ge.then(ct,ct)}_t.flags|=4096,_t.lanes=d;break e}_t=_t.return}while(_t!==null);Ee=Error((Ai(ce.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}Kr!==5&&(Kr=2),Ee=Id(Ee,ce),_t=Y;do{switch(_t.tag){case 3:j=Ee,_t.flags|=4096,d&=-d,_t.lanes|=d;var _n=Uc(_t,j,d);ot(_t,_n);break e;case 1:j=Ee;var Zt=_t.type,pn=_t.stateNode;if(!(_t.flags&64)&&(typeof Zt.getDerivedStateFromError=="function"||pn!==null&&typeof pn.componentDidCatch=="function"&&(Hs===null||!Hs.has(pn)))){_t.flags|=4096,d&=-d,_t.lanes|=d;var Mn=Ko(_t,j,d);ot(_t,Mn);break e}}_t=_t.return}while(_t!==null)}Rf(y)}catch(En){d=En,Yr===y&&y!==null&&(Yr=y=y.return);continue}break}while(!0)}function Da(){var a=Kl.current;return Kl.current=Bc,a===null?Bc:a}function La(a,d){var y=cn;cn|=16;var C=Da();Pi===a&&Oi===d||za(a,d);do try{Np();break}catch(L){Fd(a,L)}while(!0);if(_e(),cn=y,Kl.current=C,Yr!==null)throw Error(g(261));return Pi=null,Oi=0,Kr}function Np(){for(;Yr!==null;)Lf(Yr)}function Up(){for(;Yr!==null&&!bd();)Lf(Yr)}function Lf(a){var d=Hc(a.alternate,a,Ji);a.memoizedProps=a.pendingProps,d===null?Rf(a):Yr=d,jc.current=null}function Rf(a){var d=a;do{var y=d.alternate;if(a=d.return,d.flags&2048){if(y=Op(d),y!==null){y.flags&=2047,Yr=y;return}a!==null&&(a.firstEffect=a.lastEffect=null,a.flags|=2048)}else{if(y=Rp(y,d,Ji),y!==null){Yr=y;return}if(y=d,y.tag!==24&&y.tag!==23||y.memoizedState===null||Ji&1073741824||!(y.mode&4)){for(var C=0,L=y.child;L!==null;)C|=L.lanes|L.childLanes,L=L.sibling;y.childLanes=C}a!==null&&!(a.flags&2048)&&(a.firstEffect===null&&(a.firstEffect=d.firstEffect),d.lastEffect!==null&&(a.lastEffect!==null&&(a.lastEffect.nextEffect=d.firstEffect),a.lastEffect=d.lastEffect),1<d.flags&&(a.lastEffect!==null?a.lastEffect.nextEffect=d:a.firstEffect=d,a.lastEffect=d))}if(d=d.sibling,d!==null){Yr=d;return}Yr=d=a}while(d!==null);Kr===0&&(Kr=5)}function ru(a){var d=v();return T(99,jp.bind(null,a,d)),null}function jp(a,d){do Ks();while(pl!==null);if(cn&48)throw Error(g(327));var y=a.finishedWork;if(y===null)return null;if(a.finishedWork=null,a.finishedLanes=0,y===a.current)throw Error(g(177));a.callbackNode=null;var C=y.lanes|y.childLanes,L=C,j=a.pendingLanes&~L;a.pendingLanes=L,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=L,a.mutableReadLanes&=L,a.entangledLanes&=L,L=a.entanglements;for(var Y=a.eventTimes,ce=a.expirationTimes;0<j;){var Ee=31-Wi(j),Ge=1<<Ee;L[Ee]=0,Y[Ee]=-1,ce[Ee]=-1,j&=~Ge}if(Ia!==null&&!(C&24)&&Ia.has(a)&&Ia.delete(a),a===Pi&&(Yr=Pi=null,Oi=0),1<y.flags?y.lastEffect!==null?(y.lastEffect.nextEffect=y,C=y.firstEffect):C=y:C=y.firstEffect,C!==null){if(L=cn,cn|=32,jc.current=null,Li=wi,Y=Cu(),da(Y)){if("selectionStart"in Y)ce={start:Y.selectionStart,end:Y.selectionEnd};else e:if(ce=(ce=Y.ownerDocument)&&ce.defaultView||window,(Ge=ce.getSelection&&ce.getSelection())&&Ge.rangeCount!==0){ce=Ge.anchorNode,j=Ge.anchorOffset,Ee=Ge.focusNode,Ge=Ge.focusOffset;try{ce.nodeType,Ee.nodeType}catch{ce=null;break e}var zt=0,hn=-1,_t=-1,qt=0,dn=0,nn=Y,Be=null;t:for(;;){for(var Pe;nn!==ce||j!==0&&nn.nodeType!==3||(hn=zt+j),nn!==Ee||Ge!==0&&nn.nodeType!==3||(_t=zt+Ge),nn.nodeType===3&&(zt+=nn.nodeValue.length),(Pe=nn.firstChild)!==null;)Be=nn,nn=Pe;for(;;){if(nn===Y)break t;if(Be===ce&&++qt===j&&(hn=zt),Be===Ee&&++dn===Ge&&(_t=zt),(Pe=nn.nextSibling)!==null)break;nn=Be,Be=nn.parentNode}nn=Pe}ce=hn===-1||_t===-1?null:{start:hn,end:_t}}else ce=null;ce=ce||{start:0,end:0}}else ce=null;Ul={focusedElem:Y,selectionRange:ce},wi=!1,Wc=null,Bh=!1,Vt=C;do try{Vp()}catch(En){if(Vt===null)throw Error(g(330));Ms(Vt,En),Vt=Vt.nextEffect}while(Vt!==null);Wc=null,Vt=C;do try{for(Y=a;Vt!==null;){var Re=Vt.flags;if(Re&16&&Zr(Vt.stateNode,""),Re&128){var at=Vt.alternate;if(at!==null){var ct=at.ref;ct!==null&&(typeof ct=="function"?ct(null):ct.current=null)}}switch(Re&1038){case 2:Dd(Vt),Vt.flags&=-3;break;case 6:Dd(Vt),Vt.flags&=-3,Ss(Vt.alternate,Vt);break;case 1024:Vt.flags&=-1025;break;case 1028:Vt.flags&=-1025,Ss(Vt.alternate,Vt);break;case 4:Ss(Vt.alternate,Vt);break;case 8:ce=Vt,Jo(Y,ce);var _n=ce.alternate;Gn(ce),_n!==null&&Gn(_n)}Vt=Vt.nextEffect}}catch(En){if(Vt===null)throw Error(g(330));Ms(Vt,En),Vt=Vt.nextEffect}while(Vt!==null);if(ct=Ul,at=Cu(),Re=ct.focusedElem,Y=ct.selectionRange,at!==Re&&Re&&Re.ownerDocument&&Mu(Re.ownerDocument.documentElement,Re)){for(Y!==null&&da(Re)&&(at=Y.start,ct=Y.end,ct===void 0&&(ct=at),"selectionStart"in Re?(Re.selectionStart=at,Re.selectionEnd=Math.min(ct,Re.value.length)):(ct=(at=Re.ownerDocument||document)&&at.defaultView||window,ct.getSelection&&(ct=ct.getSelection(),ce=Re.textContent.length,_n=Math.min(Y.start,ce),Y=Y.end===void 0?_n:Math.min(Y.end,ce),!ct.extend&&_n>Y&&(ce=Y,Y=_n,_n=ce),ce=oo(Re,_n),j=oo(Re,Y),ce&&j&&(ct.rangeCount!==1||ct.anchorNode!==ce.node||ct.anchorOffset!==ce.offset||ct.focusNode!==j.node||ct.focusOffset!==j.offset)&&(at=at.createRange(),at.setStart(ce.node,ce.offset),ct.removeAllRanges(),_n>Y?(ct.addRange(at),ct.extend(j.node,j.offset)):(at.setEnd(j.node,j.offset),ct.addRange(at)))))),at=[],ct=Re;ct=ct.parentNode;)ct.nodeType===1&&at.push({element:ct,left:ct.scrollLeft,top:ct.scrollTop});for(typeof Re.focus=="function"&&Re.focus(),Re=0;Re<at.length;Re++)ct=at[Re],ct.element.scrollLeft=ct.left,ct.element.scrollTop=ct.top}wi=!!Li,Ul=Li=null,a.current=y,Vt=C;do try{for(Re=a;Vt!==null;){var Zt=Vt.flags;if(Zt&36&&wn(Re,Vt.alternate,Vt),Zt&128){at=void 0;var pn=Vt.ref;if(pn!==null){var Mn=Vt.stateNode;switch(Vt.tag){case 5:at=Mn;break;default:at=Mn}typeof pn=="function"?pn(at):pn.current=at}}Vt=Vt.nextEffect}}catch(En){if(Vt===null)throw Error(g(330));Ms(Vt,En),Vt=Vt.nextEffect}while(Vt!==null);Vt=null,Zl(),cn=L}else a.current=y;if(Io)Io=!1,pl=a,ju=d;else for(Vt=C;Vt!==null;)d=Vt.nextEffect,Vt.nextEffect=null,Vt.flags&8&&(Zt=Vt,Zt.sibling=null,Zt.stateNode=null),Vt=d;if(C=a.pendingLanes,C===0&&(Hs=null),C===1?a===Ao?tu++:(tu=0,Ao=a):tu=0,y=y.stateNode,ao&&typeof ao.onCommitFiberRoot=="function")try{ao.onCommitFiberRoot(Ki,y,void 0,(y.current.flags&64)===64)}catch{}if(ri(a,m()),Pa)throw Pa=!1,a=Rh,Rh=null,a;return cn&8||D(),null}function Vp(){for(;Vt!==null;){var a=Vt.alternate;Bh||Wc===null||(Vt.flags&8?Sr(Vt,Wc)&&(Bh=!0):Vt.tag===13&&kf(a,Vt)&&Sr(Vt,Wc)&&(Bh=!0));var d=Vt.flags;d&256&&Cr(a,Vt),!(d&512)||Io||(Io=!0,P(97,function(){return Ks(),null})),Vt=Vt.nextEffect}}function Ks(){if(ju!==90){var a=97<ju?97:ju;return ju=90,T(a,Zp)}return!1}function $p(a,d){Oh.push(d,a),Io||(Io=!0,P(97,function(){return Ks(),null}))}function iu(a,d){Od.push(d,a),Io||(Io=!0,P(97,function(){return Ks(),null}))}function Zp(){if(pl===null)return!1;var a=pl;if(pl=null,cn&48)throw Error(g(331));var d=cn;cn|=32;var y=Od;Od=[];for(var C=0;C<y.length;C+=2){var L=y[C],j=y[C+1],Y=L.destroy;if(L.destroy=void 0,typeof Y=="function")try{Y()}catch(Ee){if(j===null)throw Error(g(330));Ms(j,Ee)}}for(y=Oh,Oh=[],C=0;C<y.length;C+=2){L=y[C],j=y[C+1];try{var ce=L.create;L.destroy=ce()}catch(Ee){if(j===null)throw Error(g(330));Ms(j,Ee)}}for(ce=a.current.firstEffect;ce!==null;)a=ce.nextEffect,ce.nextEffect=null,ce.flags&8&&(ce.sibling=null,ce.stateNode=null),ce=a;return cn=d,D(),!0}function Tr(a,d,y){d=Id(y,d),d=Uc(a,d,1),ht(a,d),d=fo(),a=Vu(a,1),a!==null&&(ms(a,1,d),ri(a,d))}function Ms(a,d){if(a.tag===3)Tr(a,a,d);else for(var y=a.return;y!==null;){if(y.tag===3){Tr(y,a,d);break}else if(y.tag===1){var C=y.stateNode;if(typeof y.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(Hs===null||!Hs.has(C))){a=Id(d,a);var L=Ko(y,a,1);if(ht(y,L),L=fo(),y=Vu(y,1),y!==null)ms(y,1,L),ri(y,L);else if(typeof C.componentDidCatch=="function"&&(Hs===null||!Hs.has(C)))try{C.componentDidCatch(d,a)}catch{}break}}y=y.return}}function Of(a,d,y){var C=a.pingCache;C!==null&&C.delete(d),d=fo(),a.pingedLanes|=a.suspendedLanes&y,Pi===a&&(Oi&y)===y&&(Kr===4||Kr===3&&(Oi&62914560)===Oi&&500>m()-Rd?za(a,0):Ld|=y),ri(a,d)}function Fh(a,d){var y=a.stateNode;y!==null&&y.delete(d),d=0,d===0&&(d=a.mode,d&2?d&4?(Aa===0&&(Aa=Jl),d=Br(62914560&~Aa),d===0&&(d=4194304)):d=v()===99?1:2:d=1),y=fo(),a=Vu(a,d),a!==null&&(ms(a,d,y),ri(a,y))}var Hc;Hc=function(a,d,y){var C=d.lanes;if(a!==null)if(a.memoizedProps!==d.pendingProps||Si.current)Es=!0;else if(y&C)Es=!!(a.flags&16384);else{switch(Es=!1,d.tag){case 3:Gs(d),Ho();break;case 5:bn(d);break;case 1:ci(d.type)&&so(d);break;case 4:Tn(d,d.stateNode.containerInfo);break;case 10:C=d.memoizedProps.value;var L=d.type._context;ur(q,L._currentValue),L._currentValue=C;break;case 13:if(d.memoizedState!==null)return y&d.child.childLanes?Cd(a,d,y):(ur(Bn,Bn.current&1),d=ho(a,d,y),d!==null?d.sibling:null);ur(Bn,Bn.current&1);break;case 19:if(C=(y&d.childLanes)!==0,a.flags&64){if(C)return Nu(a,d,y);d.flags|=64}if(L=d.memoizedState,L!==null&&(L.rendering=null,L.tail=null,L.lastEffect=null),ur(Bn,Bn.current),C)break;return null;case 23:case 24:return d.lanes=0,Md(a,d,y)}return ho(a,d,y)}else Es=!1;switch(d.lanes=0,d.tag){case 2:if(C=d.type,a!==null&&(a.alternate=null,d.alternate=null,d.flags|=2),a=d.pendingProps,L=Us(d,Xr.current),pe(d,y),L=Ou(null,d,C,a,L,y),d.flags|=1,typeof L=="object"&&L!==null&&typeof L.render=="function"&&L.$$typeof===void 0){if(d.tag=1,d.memoizedState=null,d.updateQueue=null,ci(C)){var j=!0;so(d)}else j=!1;d.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,ye(d);var Y=C.getDerivedStateFromProps;typeof Y=="function"&&tt(d,C,Y,a),L.updater=Ye,d.stateNode=L,L._reactInternals=d,ft(d,C,a,y),d=Fu(null,d,C,!0,j,y)}else d.tag=0,co(null,d,L,y),d=d.child;return d;case 16:L=d.elementType;e:{switch(a!==null&&(a.alternate=null,d.alternate=null,d.flags|=2),a=d.pendingProps,j=L._init,L=j(L._payload),d.type=L,j=d.tag=Kc(L),a=U(L,a),j){case 0:d=Dh(null,d,L,a,y);break e;case 1:d=Lh(null,d,L,a,y);break e;case 11:d=Sd(null,d,L,a,y);break e;case 14:d=Sf(null,d,L,U(L.type,a),C,y);break e}throw Error(g(306,L,""))}return d;case 0:return C=d.type,L=d.pendingProps,L=d.elementType===C?L:U(C,L),Dh(a,d,C,L,y);case 1:return C=d.type,L=d.pendingProps,L=d.elementType===C?L:U(C,L),Lh(a,d,C,L,y);case 3:if(Gs(d),C=d.updateQueue,a===null||C===null)throw Error(g(282));if(C=d.pendingProps,L=d.memoizedState,L=L!==null?L.element:null,Le(a,d),nt(d,C,null,y),C=d.memoizedState.element,C===L)Ho(),d=ho(a,d,y);else{if(L=d.stateNode,(j=L.hydrate)&&(lo=ys(d.stateNode.containerInfo.firstChild),Mr=d,j=yr=!0),j){if(a=L.mutableSourceEagerHydrationData,a!=null)for(L=0;L<a.length;L+=2)j=a[L],j._workInProgressVersionPrimary=a[L+1],Er.push(j);for(y=gn(d,null,C,y),d.child=y;y;)y.flags=y.flags&-3|1024,y=y.sibling}else co(a,d,C,y),Ho();d=d.child}return d;case 5:return bn(d),a===null&&jt(d),C=d.type,L=d.pendingProps,j=a!==null?a.memoizedProps:null,Y=L.children,nl(C,L)?Y=null:j!==null&&nl(C,j)&&(d.flags|=16),Fc(a,d),co(a,d,Y,y),d.child;case 6:return a===null&&jt(d),null;case 13:return Cd(a,d,y);case 4:return Tn(d,d.stateNode.containerInfo),C=d.pendingProps,a===null?d.child=Xt(d,null,C,y):co(a,d,C,y),d.child;case 11:return C=d.type,L=d.pendingProps,L=d.elementType===C?L:U(C,L),Sd(a,d,C,L,y);case 7:return co(a,d,d.pendingProps,y),d.child;case 8:return co(a,d,d.pendingProps.children,y),d.child;case 12:return co(a,d,d.pendingProps.children,y),d.child;case 10:e:{C=d.type._context,L=d.pendingProps,Y=d.memoizedProps,j=L.value;var ce=d.type._context;if(ur(q,ce._currentValue),ce._currentValue=j,Y!==null)if(ce=Y.value,j=Di(ce,j)?0:(typeof C._calculateChangedBits=="function"?C._calculateChangedBits(ce,j):1073741823)|0,j===0){if(Y.children===L.children&&!Si.current){d=ho(a,d,y);break e}}else for(ce=d.child,ce!==null&&(ce.return=d);ce!==null;){var Ee=ce.dependencies;if(Ee!==null){Y=ce.child;for(var Ge=Ee.firstContext;Ge!==null;){if(Ge.context===C&&Ge.observedBits&j){ce.tag===1&&(Ge=Ue(-1,y&-y),Ge.tag=2,ht(ce,Ge)),ce.lanes|=y,Ge=ce.alternate,Ge!==null&&(Ge.lanes|=y),me(ce.return,y),Ee.lanes|=y;break}Ge=Ge.next}}else Y=ce.tag===10&&ce.type===d.type?null:ce.child;if(Y!==null)Y.return=ce;else for(Y=ce;Y!==null;){if(Y===d){Y=null;break}if(ce=Y.sibling,ce!==null){ce.return=Y.return,Y=ce;break}Y=Y.return}ce=Y}co(a,d,L.children,y),d=d.child}return d;case 9:return L=d.type,j=d.pendingProps,C=j.children,pe(d,y),L=he(L,j.unstable_observedBits),C=C(L),d.flags|=1,co(a,d,C,y),d.child;case 14:return L=d.type,j=U(L,d.pendingProps),j=U(L.type,j),Sf(a,d,L,j,C,y);case 15:return Bu(a,d,d.type,d.pendingProps,C,y);case 17:return C=d.type,L=d.pendingProps,L=d.elementType===C?L:U(C,L),a!==null&&(a.alternate=null,d.alternate=null,d.flags|=2),d.tag=1,ci(C)?(a=!0,so(d)):a=!1,pe(d,y),Gt(d,C,L),ft(d,C,L,y),Fu(null,d,C,!0,a,y);case 19:return Nu(a,d,y);case 23:return Md(a,d,y);case 24:return Md(a,d,y)}throw Error(g(156,d.tag))};function Yc(a,d,y,C){this.tag=a,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function ko(a,d,y,C){return new Yc(a,d,y,C)}function Nh(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Kc(a){if(typeof a=="function")return Nh(a)?1:0;if(a!=null){if(a=a.$$typeof,a===$t)return 11;if(a===Dr)return 14}return 2}function Js(a,d){var y=a.alternate;return y===null?(y=ko(a.tag,d,a.key,a.mode),y.elementType=a.elementType,y.type=a.type,y.stateNode=a.stateNode,y.alternate=a,a.alternate=y):(y.pendingProps=d,y.type=a.type,y.flags=0,y.nextEffect=null,y.firstEffect=null,y.lastEffect=null),y.childLanes=a.childLanes,y.lanes=a.lanes,y.child=a.child,y.memoizedProps=a.memoizedProps,y.memoizedState=a.memoizedState,y.updateQueue=a.updateQueue,d=a.dependencies,y.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},y.sibling=a.sibling,y.index=a.index,y.ref=a.ref,y}function Zu(a,d,y,C,L,j){var Y=2;if(C=a,typeof a=="function")Nh(a)&&(Y=1);else if(typeof a=="string")Y=5;else e:switch(a){case It:return Gu(y.children,L,j,d);case vn:Y=8,L|=16;break;case Pt:Y=8,L|=1;break;case Ot:return a=ko(12,y,d,L|8),a.elementType=Ot,a.type=Ot,a.lanes=j,a;case Et:return a=ko(13,y,d,L),a.type=Et,a.elementType=Et,a.lanes=j,a;case yn:return a=ko(19,y,d,L),a.elementType=yn,a.lanes=j,a;case ut:return Uh(y,L,j,d);case st:return a=ko(24,y,d,L),a.elementType=st,a.lanes=j,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Yt:Y=10;break e;case Nt:Y=9;break e;case $t:Y=11;break e;case Dr:Y=14;break e;case Fe:Y=16,C=null;break e;case gt:Y=22;break e}throw Error(g(130,a==null?a:typeof a,""))}return d=ko(Y,y,d,L),d.elementType=a,d.type=C,d.lanes=j,d}function Gu(a,d,y,C){return a=ko(7,a,C,d),a.lanes=y,a}function Uh(a,d,y,C){return a=ko(23,a,C,d),a.elementType=ut,a.lanes=y,a}function ou(a,d,y){return a=ko(6,a,null,d),a.lanes=y,a}function Jc(a,d,y){return d=ko(4,a.children!==null?a.children:[],a.key,d),d.lanes=y,d.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},d}function Gp(a,d,y){this.tag=d,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=y,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Za(0),this.expirationTimes=Za(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Za(0),this.mutableSourceEagerHydrationData=null}function Nd(a,d,y){var C=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xt,key:C==null?null:""+C,children:a,containerInfo:d,implementation:y}}function qu(a,d,y,C){var L=d.current,j=fo(),Y=Ys(L);e:if(y){y=y._reactInternals;t:{if(Sn(y)!==y||y.tag!==1)throw Error(g(170));var ce=y;do{switch(ce.tag){case 3:ce=ce.stateNode.context;break t;case 1:if(ci(ce.type)){ce=ce.stateNode.__reactInternalMemoizedMergedChildContext;break t}}ce=ce.return}while(ce!==null);throw Error(g(171))}if(y.tag===1){var Ee=y.type;if(ci(Ee)){y=Lu(y,Ee,ce);break e}}y=ce}else y=Yi;return d.context===null?d.context=y:d.pendingContext=y,d=Ue(j,Y),d.payload={element:a},C=C===void 0?null:C,C!==null&&(d.callback=C),ht(L,d),ka(L,Y,j),Y}function Wu(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Bf(a,d){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var y=a.retryLane;a.retryLane=y!==0&&y<d?y:d}}function Ud(a,d){Bf(a,d),(a=a.alternate)&&Bf(a,d)}function jd(a,d,y){var C=y!=null&&y.hydrationOptions!=null&&y.hydrationOptions.mutableSources||null;if(y=new Gp(a,d,y!=null&&y.hydrate===!0),d=ko(3,null,null,d===2?7:d===1?3:0),y.current=d,d.stateNode=y,ye(d),a[Ns]=y.current,Eh(a.nodeType===8?a.parentNode:a),C)for(a=0;a<C.length;a++){d=C[a];var L=d._getVersion;L=L(d._source),y.mutableSourceEagerHydrationData==null?y.mutableSourceEagerHydrationData=[d,L]:y.mutableSourceEagerHydrationData.push(d,L)}this._internalRoot=y}jd.prototype.render=function(a){qu(a,this._internalRoot,null,null)},jd.prototype.unmount=function(){var a=this._internalRoot,d=a.containerInfo;qu(null,a,null,function(){d[Ns]=null})};function Qc(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function qp(a,d){if(d||(d=a?a.nodeType===9?a.documentElement:a.firstChild:null,d=!(!d||d.nodeType!==1||!d.hasAttribute("data-reactroot"))),!d)for(var y;y=a.lastChild;)a.removeChild(y);return new jd(a,0,d?{hydrate:!0}:void 0)}function eh(a,d,y,C,L){var j=y._reactRootContainer;if(j){var Y=j._internalRoot;if(typeof L=="function"){var ce=L;L=function(){var Ge=Wu(Y);ce.call(Ge)}}qu(d,Y,a,L)}else{if(j=y._reactRootContainer=qp(y,C),Y=j._internalRoot,typeof L=="function"){var Ee=L;L=function(){var Ge=Wu(Y);Ee.call(Ge)}}Df(function(){qu(d,Y,a,L)})}return Wu(Y)}To=function(a){if(a.tag===13){var d=fo();ka(a,4,d),Ud(a,4)}},bi=function(a){if(a.tag===13){var d=fo();ka(a,67108864,d),Ud(a,67108864)}},ki=function(a){if(a.tag===13){var d=fo(),y=Ys(a);ka(a,y,d),Ud(a,y)}},hs=function(a,d){return d()},vi=function(a,d,y){switch(d){case"input":if(rn(a,y),d=y.name,y.type==="radio"&&d!=null){for(y=a;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll("input[name="+JSON.stringify(""+d)+'][type="radio"]'),d=0;d<y.length;d++){var C=y[d];if(C!==a&&C.form===a.form){var L=va(C);if(!L)throw Error(g(90));cr(C),rn(C,L)}}}break;case"textarea":as(a,y);break;case"select":d=y.value,d!=null&&qn(a,!!y.multiple,d,!1)}},F=zf,Z=function(a,d,y,C,L){var j=cn;cn|=4;try{return T(98,a.bind(null,d,y,C,L))}finally{cn=j,cn===0&&(eu(),D())}},re=function(){!(cn&49)&&(Fp(),Ks())},ue=function(a,d){var y=cn;cn|=2;try{return a(d)}finally{cn=y,cn===0&&(eu(),D())}};function su(a,d){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Qc(d))throw Error(g(200));return Nd(a,d,null,y)}var Wp={Events:[ol,ya,va,si,se,Ks,{current:!1}]},th={findFiberByHostInstance:xs,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},Ff={bundleType:th.bundleType,version:th.version,rendererPackageName:th.rendererPackageName,rendererConfig:th.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$e.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=rr(a),a===null?null:a.stateNode},findFiberByHostInstance:th.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var nh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nh.isDisabled&&nh.supportsFiber)try{Ki=nh.inject(Ff),ao=nh}catch{}}return Ps.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wp,Ps.createPortal=su,Ps.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var d=a._reactInternals;if(d===void 0)throw typeof a.render=="function"?Error(g(188)):Error(g(268,Object.keys(a)));return a=rr(d),a=a===null?null:a.stateNode,a},Ps.flushSync=function(a,d){var y=cn;if(y&48)return a(d);cn|=1;try{if(a)return T(99,a.bind(null,d))}finally{cn=y,D()}},Ps.hydrate=function(a,d,y){if(!Qc(d))throw Error(g(200));return eh(null,a,d,!0,y)},Ps.render=function(a,d,y){if(!Qc(d))throw Error(g(200));return eh(null,a,d,!1,y)},Ps.unmountComponentAtNode=function(a){if(!Qc(a))throw Error(g(40));return a._reactRootContainer?(Df(function(){eh(null,null,a,!1,function(){a._reactRootContainer=null,a[Ns]=null})}),!0):!1},Ps.unstable_batchedUpdates=zf,Ps.unstable_createPortal=function(a,d){return su(a,d,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)},Ps.unstable_renderSubtreeIntoContainer=function(a,d,y,C){if(!Qc(y))throw Error(g(200));if(a==null||a._reactInternals===void 0)throw Error(g(38));return eh(a,d,y,!1,C)},Ps.version="17.0.2",Ps}var dy;function e1(){if(dy)return zm.exports;dy=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(s){console.error(s)}}return c(),zm.exports=Q0(),zm.exports}var t1=e1();const n1=kp(t1);var Qd={},Rm={},fy;function r1(){return fy||(fy=1,Object.defineProperty(Rm,"__esModule",{value:!0})),Rm}var ef={},Ir={},tf={},nf={},rf={},of={},py;function i1(){if(py)return of;py=1,Object.defineProperty(of,"__esModule",{value:!0}),of.validateConfigId=void 0;function c(s,h){s===void 0&&console.warn(`Invalid config ${h}: ${s}`)}return of.validateConfigId=c,of}const o1="@sigmacomputing/plugin",s1="1.0.6",a1="Sigma Computing Plugin Client API",l1="MIT",u1="https://github.com/sigmacomputing/plugin",c1="./dist/index.js",h1={type:"git",url:"https://github.com/sigmacomputing/plugin.git"},d1={email:"support@sigmacomputing.com",url:"https://github.com/sigmacomputing/plugin/issues"},f1="yarn@4.4.1",p1=["dist/*"],m1={"*":{react:["dist/react/index.d.ts"]}},g1={build:"yarn tsc --build tsconfig.build.json","build:watch":"yarn build --watch",format:"prettier --write 'src/**/*.{ts,tsx}' 'jest.config.ts'",precommit:"lint-staged",prepublish:"yarn build",test:"jest --ci","test:watch":"yarn test --watch"},_1={react:"^16.8.0 || ^17.0.0 || ^18.0.0","react-dom":"^16.8.0 || ^17.0.0 || ^18.0.0"},y1={"@jest/types":"^27.5.1","@types/jest":"^27.5.1","@types/node":"^18.7.14","@types/react":"^18.0.18","@types/react-dom":"^18.0.6",jest:"^27.5.1","jest-watch-typeahead":"^2.1.1","lint-staged":"^13.0.3",prettier:"^2.7.1","ts-jest":"^27.1.4",typescript:"^4.8.2"},v1={name:o1,version:s1,description:a1,license:l1,homepage:u1,main:c1,repository:h1,bugs:d1,packageManager:f1,files:p1,typesVersions:m1,scripts:g1,peerDependencies:_1,devDependencies:y1};var my;function x1(){if(my)return rf;my=1,Object.defineProperty(rf,"__esModule",{value:!0}),rf.initialize=void 0;const c=i1();function s(){const h={config:{}};let g={},w={};const M={},k={};for(const[$,de]of new URL(document.location.toString()).searchParams.entries())h[$]=JSON.parse(de);const R=$=>{ne($.data.type,$.data.result,$.data.error)};window.addEventListener("message",R,!1),window.addEventListener("click",()=>oe("wb:plugin:focus")),o("wb:plugin:config:update",$=>{var de;Object.assign(h,$),ne("config",(de=h.config)!==null&&de!==void 0?de:{})}),oe("wb:plugin:init",v1.version).then($=>{Object.assign(h,$),ne("init",h),ne("config",h.config)}),o("wb:plugin:variable:update",$=>{w={},Object.assign(w,$)}),o("wb:plugin:selection:update",$=>{g={},Object.assign(g,$)}),o("wb:plugin:action-effect:invoke",$=>{const de=M[$];if(!de)throw new Error(`Unknown action effect with name: ${$}`);de()});function o($,de){k[$]=k[$]||[],k[$].push(de)}function G($,de){k[$]!=null&&(k[$]=k[$].filter(H=>H!==de))}function ne($,...de){Object.values(k[$]||[]).forEach(H=>H(...de))}function oe($,...de){return new Promise((H,Te)=>{var Me;const je=(He,Ve)=>{Ve?Te(Ve):H(He),G($,je)};o($,je),window.parent.postMessage({type:$,args:de,elementId:h.id},(Me=h==null?void 0:h.wbOrigin)!==null&&Me!==void 0?Me:"*")})}return{get sigmaEnv(){return h.sigmaEnv},get isScreenshot(){return h.screenshot},config:{getKey($){var de;return(de=h==null?void 0:h.config)===null||de===void 0?void 0:de[$]},get(){return h.config},set($){oe("wb:plugin:config:update",$)},setKey($,de){oe("wb:plugin:config:update",{[$]:de})},subscribe($){return o("config",$),()=>G("config",$)},getVariable($){return(0,c.validateConfigId)($,"variable"),w[$]},setVariable($,...de){(0,c.validateConfigId)($,"variable"),oe("wb:plugin:variable:set",$,...de)},getInteraction($){return(0,c.validateConfigId)($,"interaction"),g[$]},setInteraction($,de,H){(0,c.validateConfigId)($,"interaction"),oe("wb:plugin:selection:set",$,de,H)},triggerAction($){(0,c.validateConfigId)($,"action-trigger"),oe("wb:plugin:action-trigger:invoke",$)},registerEffect($,de){return(0,c.validateConfigId)($,"action-effect"),M[$]=de,()=>{delete M[$]}},configureEditorPanel($){oe("wb:plugin:config:inspector",$)},setLoadingState($){oe("wb:plugin:config:loading-state",$)},subscribeToWorkbookVariable($,de){(0,c.validateConfigId)($,"variable");const H=Te=>{de(Te[$])};return o("wb:plugin:variable:update",H),()=>{G("wb:plugin:variable:update",H)}},subscribeToWorkbookInteraction($,de){(0,c.validateConfigId)($,"interaction");const H=Te=>{de(Te[$])};return o("wb:plugin:selection:update",H),()=>{G("wb:plugin:selection:update",H)}}},elements:{getElementColumns($){return(0,c.validateConfigId)($,"element"),oe("wb:plugin:element:columns:get",$)},subscribeToElementColumns($,de){(0,c.validateConfigId)($,"element");const H=`wb:plugin:element:${$}:columns`;return o(H,de),oe("wb:plugin:element:subscribe:columns",$),()=>{G(H,de),oe("wb:plugin:element:unsubscribe:columns",$)}},subscribeToElementData($,de){(0,c.validateConfigId)($,"element");const H=`wb:plugin:element:${$}:data`;return o(H,de),oe("wb:plugin:element:subscribe:data",$),()=>{G(H,de),oe("wb:plugin:element:unsubscribe:data",$)}},fetchMoreElementData($){(0,c.validateConfigId)($,"element"),oe("wb:plugin:element:fetch-more",$)}},destroy(){Object.keys(k).forEach($=>delete k[$]),window.removeEventListener("message",R,!1)}}}return rf.initialize=s,rf}var gy;function Kv(){if(gy)return nf;gy=1,Object.defineProperty(nf,"__esModule",{value:!0}),nf.client=void 0;const c=x1();return nf.client=(0,c.initialize)(),nf}var _y;function Jv(){if(_y)return tf;_y=1,Object.defineProperty(tf,"__esModule",{value:!0}),tf.PluginContext=void 0;const c=vf(),s=Kv();return tf.PluginContext=(0,c.createContext)(s.client),tf}var sf={},yy;function b1(){if(yy)return sf;yy=1,Object.defineProperty(sf,"__esModule",{value:!0}),sf.deepEqual=void 0;function c(h){return typeof h=="object"&&h!=null}function s(h,g){if(h===g)return!0;if(c(h)&&c(g)){if(Object.keys(h).length!==Object.keys(g).length)return!1;for(const w in h)if(!s(h[w],g[w]))return!1;return!0}}return sf.deepEqual=s,sf}var vy;function w1(){if(vy)return Ir;vy=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.useActionEffect=Ir.useActionTrigger=Ir.useInteraction=Ir.useVariable=Ir.useConfig=Ir.usePaginatedElementData=Ir.useElementData=Ir.useElementColumns=Ir.useLoadingState=Ir.useEditorPanelConfig=Ir.usePlugin=void 0;const c=vf(),s=Jv(),h=b1();function g(){return(0,c.useContext)(s.PluginContext)}Ir.usePlugin=g;function w(H){const Te=g(),Me=(0,c.useRef)({});(0,c.useEffect)(()=>{H!=null&&((0,h.deepEqual)(H,Me.current)||(Te.config.configureEditorPanel(H),Me.current=H))},[Te,H])}Ir.useEditorPanelConfig=w;function M(H){const Te=g(),[Me,je]=(0,c.useState)(()=>(Te.config.setLoadingState(H),H));return[Me,He=>{He!==Me&&(je(He),Te.config.setLoadingState(He))}]}Ir.useLoadingState=M;function k(H){const Te=g(),[Me,je]=(0,c.useState)({});return(0,c.useEffect)(()=>{if(H)return Te.elements.subscribeToElementColumns(H,je)},[Te,H]),Me}Ir.useElementColumns=k;function R(H){const Te=g(),[Me,je]=(0,c.useState)({});return(0,c.useEffect)(()=>{if(H)return Te.elements.subscribeToElementData(H,je)},[Te,H]),Me}Ir.useElementData=R;function o(H){const Te=g(),[Me,je]=(0,c.useState)({}),He=(0,c.useCallback)(()=>{H&&Te.elements.fetchMoreElementData(H)},[H]);return(0,c.useEffect)(()=>{if(H)return Te.elements.subscribeToElementData(H,je)},[Te,H]),[Me,He]}Ir.usePaginatedElementData=o;function G(H){const Te=g(),[Me,je]=(0,c.useState)(H!=null?Te.config.getKey(H):Te.config.get());return(0,c.useEffect)(()=>Te.config.subscribe(He=>{H!=null&&He[H]!==Me[H]?je(He[H]):je(He)}),[Te]),Me}Ir.useConfig=G;function ne(H){const Te=g(),[Me,je]=(0,c.useState)();(0,c.useEffect)(()=>Te.config.subscribeToWorkbookVariable(H,je),[Te,H]);const He=(0,c.useCallback)((...Ve)=>Te.config.setVariable(H,...Ve),[H]);return[Me,He]}Ir.useVariable=ne;function oe(H,Te){const Me=g(),[je,He]=(0,c.useState)();(0,c.useEffect)(()=>Me.config.subscribeToWorkbookInteraction(H,He),[Me,H]);const Ve=(0,c.useCallback)(Xe=>{Me.config.setInteraction(H,Te,Xe)},[H]);return[je,Ve]}Ir.useInteraction=oe;function $(H){const Te=g();return(0,c.useCallback)(()=>{Te.config.triggerAction(H)},[Te,H])}Ir.useActionTrigger=$;function de(H,Te){const Me=g(),je=(0,c.useRef)(Te);(0,c.useEffect)(()=>{je.current=Te}),(0,c.useEffect)(()=>Me.config.registerEffect(H,je.current),[Me,H,Te])}return Ir.useActionEffect=de,Ir}var af={},xy;function E1(){if(xy)return af;xy=1,Object.defineProperty(af,"__esModule",{value:!0}),af.SigmaClientProvider=void 0;const c=Hv(),s=Jv();function h(g){return(0,c.jsx)(s.PluginContext.Provider,Object.assign({value:g.client},{children:g.children}))}return af.SigmaClientProvider=h,af}var by;function T1(){return by||(by=1,function(c){var s=ef.__createBinding||(Object.create?function(w,M,k,R){R===void 0&&(R=k);var o=Object.getOwnPropertyDescriptor(M,k);(!o||("get"in o?!M.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return M[k]}}),Object.defineProperty(w,R,o)}:function(w,M,k,R){R===void 0&&(R=k),w[R]=M[k]}),h=ef.__exportStar||function(w,M){for(var k in w)k!=="default"&&!Object.prototype.hasOwnProperty.call(M,k)&&s(M,w,k)};Object.defineProperty(c,"__esModule",{value:!0}),c.SigmaClientProvider=void 0,h(w1(),c);var g=E1();Object.defineProperty(c,"SigmaClientProvider",{enumerable:!0,get:function(){return g.SigmaClientProvider}})}(ef)),ef}var lf={},wy;function S1(){if(wy)return lf;wy=1,Object.defineProperty(lf,"__esModule",{value:!0}),lf.polyfillRequestAnimationFrame=void 0;function c(s){"requestAnimationFrame"in s&&(s.requestAnimationFrame=h=>s.setTimeout(h,1e3/60),s.cancelAnimationFrame=h=>s.clearTimeout(h))}return lf.polyfillRequestAnimationFrame=c,lf}var Ey;function M1(){return Ey||(Ey=1,function(c){var s=Qd.__createBinding||(Object.create?function(w,M,k,R){R===void 0&&(R=k);var o=Object.getOwnPropertyDescriptor(M,k);(!o||("get"in o?!M.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return M[k]}}),Object.defineProperty(w,R,o)}:function(w,M,k,R){R===void 0&&(R=k),w[R]=M[k]}),h=Qd.__exportStar||function(w,M){for(var k in w)k!=="default"&&!Object.prototype.hasOwnProperty.call(M,k)&&s(M,w,k)};Object.defineProperty(c,"__esModule",{value:!0}),c.polyfillRequestAnimationFrame=void 0,h(r1(),c),h(T1(),c),h(Kv(),c);var g=S1();Object.defineProperty(c,"polyfillRequestAnimationFrame",{enumerable:!0,get:function(){return g.polyfillRequestAnimationFrame}})}(Qd)),Qd}var Qm=M1();function vp(){return vp=Object.assign||function(c){for(var s=1;s<arguments.length;s++){var h=arguments[s];for(var g in h)Object.prototype.hasOwnProperty.call(h,g)&&(c[g]=h[g])}return c},vp.apply(this,arguments)}function eg(c,s){(s==null||s>c.length)&&(s=c.length);for(var h=0,g=new Array(s);h<s;h++)g[h]=c[h];return g}function C1(c){if(Array.isArray(c))return eg(c)}function P1(c){if(typeof Symbol<"u"&&c[Symbol.iterator]!=null||c["@@iterator"]!=null)return Array.from(c)}function Qv(c,s){if(c){if(typeof c=="string")return eg(c,s);var h=Object.prototype.toString.call(c).slice(8,-1);if(h==="Object"&&c.constructor&&(h=c.constructor.name),h==="Map"||h==="Set")return Array.from(c);if(h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return eg(c,s)}}function I1(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A1(c){return C1(c)||P1(c)||Qv(c)||I1()}function fn(c,s,h){return s in c?Object.defineProperty(c,s,{value:h,enumerable:!0,configurable:!0,writable:!0}):c[s]=h,c}var Om={exports:{}},Bm,Ty;function k1(){if(Ty)return Bm;Ty=1;var c="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Bm=c,Bm}var Fm,Sy;function z1(){if(Sy)return Fm;Sy=1;var c=k1();function s(){}function h(){}return h.resetWarningCache=s,Fm=function(){function g(k,R,o,G,ne,oe){if(oe!==c){var $=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw $.name="Invariant Violation",$}}g.isRequired=g;function w(){return g}var M={array:g,bigint:g,bool:g,func:g,number:g,object:g,string:g,symbol:g,any:g,arrayOf:w,element:g,elementType:g,instanceOf:w,node:g,objectOf:w,oneOf:w,oneOfType:w,shape:w,exact:w,checkPropTypes:h,resetWarningCache:s};return M.PropTypes=M,M},Fm}var My;function D1(){return My||(My=1,Om.exports=z1()()),Om.exports}var Oe=D1();function L1(c){if(Array.isArray(c))return c}function R1(c,s){var h=c==null?null:typeof Symbol<"u"&&c[Symbol.iterator]||c["@@iterator"];if(h!=null){var g=[],w=!0,M=!1,k,R;try{for(h=h.call(c);!(w=(k=h.next()).done)&&(g.push(k.value),!(s&&g.length===s));w=!0);}catch(o){M=!0,R=o}finally{try{!w&&h.return!=null&&h.return()}finally{if(M)throw R}}return g}}function O1(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _i(c,s){return L1(c)||R1(c,s)||Qv(c,s)||O1()}var _o=1e-6,cd=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var c=0,s=arguments.length;s--;)c+=arguments[s]*arguments[s];return Math.sqrt(c)});function B1(){var c=new cd(4);return cd!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0,c[3]=0),c}function F1(c,s,h){return c[0]=s[0]*h,c[1]=s[1]*h,c[2]=s[2]*h,c[3]=s[3]*h,c}function N1(c,s,h){var g=s[0],w=s[1],M=s[2],k=s[3];return c[0]=h[0]*g+h[4]*w+h[8]*M+h[12]*k,c[1]=h[1]*g+h[5]*w+h[9]*M+h[13]*k,c[2]=h[2]*g+h[6]*w+h[10]*M+h[14]*k,c[3]=h[3]*g+h[7]*w+h[11]*M+h[15]*k,c}(function(){var c=B1();return function(s,h,g,w,M,k){var R,o;for(h||(h=4),g||(g=0),w?o=Math.min(w*h+g,s.length):o=s.length,R=g;R<o;R+=h)c[0]=s[R],c[1]=s[R+1],c[2]=s[R+2],c[3]=s[R+3],M(c,c,k),s[R]=c[0],s[R+1]=c[1],s[R+2]=c[2],s[R+3]=c[3];return s}})();function pp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ad(c,s){const h=N1([],s,c);return F1(h,h,1/h[3]),h}function Cy(c,s){const h=c%s;return h<0?s+h:h}function U1(c,s,h){return h*s+(1-h)*c}function Py(c,s,h){return c<s?s:c>h?h:c}function j1(c){return Math.log(c)*Math.LOG2E}const Sg=Math.log2||j1;function V1(c,s){var h=s[0],g=s[1],w=s[2],M=s[3],k=s[4],R=s[5],o=s[6],G=s[7],ne=s[8],oe=s[9],$=s[10],de=s[11],H=s[12],Te=s[13],Me=s[14],je=s[15],He=h*R-g*k,Ve=h*o-w*k,Xe=h*G-M*k,$e=g*o-w*R,Ze=g*G-M*R,xt=w*G-M*o,It=ne*Te-oe*H,Pt=ne*Me-$*H,Ot=ne*je-de*H,Yt=oe*Me-$*Te,Nt=oe*je-de*Te,$t=$*je-de*Me,Et=He*$t-Ve*Nt+Xe*Yt+$e*Ot-Ze*Pt+xt*It;return Et?(Et=1/Et,c[0]=(R*$t-o*Nt+G*Yt)*Et,c[1]=(w*Nt-g*$t-M*Yt)*Et,c[2]=(Te*xt-Me*Ze+je*$e)*Et,c[3]=($*Ze-oe*xt-de*$e)*Et,c[4]=(o*Ot-k*$t-G*Pt)*Et,c[5]=(h*$t-w*Ot+M*Pt)*Et,c[6]=(Me*Xe-H*xt-je*Ve)*Et,c[7]=(ne*xt-$*Xe+de*Ve)*Et,c[8]=(k*Nt-R*Ot+G*It)*Et,c[9]=(g*Ot-h*Nt-M*It)*Et,c[10]=(H*Ze-Te*Xe+je*He)*Et,c[11]=(oe*Xe-ne*Ze-de*He)*Et,c[12]=(R*Pt-k*Yt-o*It)*Et,c[13]=(h*Yt-g*Pt+w*It)*Et,c[14]=(Te*Ve-H*$e-Me*He)*Et,c[15]=(ne*$e-oe*Ve+$*He)*Et,c):null}function Nm(c,s,h){var g=s[0],w=s[1],M=s[2],k=s[3],R=s[4],o=s[5],G=s[6],ne=s[7],oe=s[8],$=s[9],de=s[10],H=s[11],Te=s[12],Me=s[13],je=s[14],He=s[15],Ve=h[0],Xe=h[1],$e=h[2],Ze=h[3];return c[0]=Ve*g+Xe*R+$e*oe+Ze*Te,c[1]=Ve*w+Xe*o+$e*$+Ze*Me,c[2]=Ve*M+Xe*G+$e*de+Ze*je,c[3]=Ve*k+Xe*ne+$e*H+Ze*He,Ve=h[4],Xe=h[5],$e=h[6],Ze=h[7],c[4]=Ve*g+Xe*R+$e*oe+Ze*Te,c[5]=Ve*w+Xe*o+$e*$+Ze*Me,c[6]=Ve*M+Xe*G+$e*de+Ze*je,c[7]=Ve*k+Xe*ne+$e*H+Ze*He,Ve=h[8],Xe=h[9],$e=h[10],Ze=h[11],c[8]=Ve*g+Xe*R+$e*oe+Ze*Te,c[9]=Ve*w+Xe*o+$e*$+Ze*Me,c[10]=Ve*M+Xe*G+$e*de+Ze*je,c[11]=Ve*k+Xe*ne+$e*H+Ze*He,Ve=h[12],Xe=h[13],$e=h[14],Ze=h[15],c[12]=Ve*g+Xe*R+$e*oe+Ze*Te,c[13]=Ve*w+Xe*o+$e*$+Ze*Me,c[14]=Ve*M+Xe*G+$e*de+Ze*je,c[15]=Ve*k+Xe*ne+$e*H+Ze*He,c}function tg(c,s,h){var g=h[0],w=h[1],M=h[2],k,R,o,G,ne,oe,$,de,H,Te,Me,je;return s===c?(c[12]=s[0]*g+s[4]*w+s[8]*M+s[12],c[13]=s[1]*g+s[5]*w+s[9]*M+s[13],c[14]=s[2]*g+s[6]*w+s[10]*M+s[14],c[15]=s[3]*g+s[7]*w+s[11]*M+s[15]):(k=s[0],R=s[1],o=s[2],G=s[3],ne=s[4],oe=s[5],$=s[6],de=s[7],H=s[8],Te=s[9],Me=s[10],je=s[11],c[0]=k,c[1]=R,c[2]=o,c[3]=G,c[4]=ne,c[5]=oe,c[6]=$,c[7]=de,c[8]=H,c[9]=Te,c[10]=Me,c[11]=je,c[12]=k*g+ne*w+H*M+s[12],c[13]=R*g+oe*w+Te*M+s[13],c[14]=o*g+$*w+Me*M+s[14],c[15]=G*g+de*w+je*M+s[15]),c}function ex(c,s,h){var g=h[0],w=h[1],M=h[2];return c[0]=s[0]*g,c[1]=s[1]*g,c[2]=s[2]*g,c[3]=s[3]*g,c[4]=s[4]*w,c[5]=s[5]*w,c[6]=s[6]*w,c[7]=s[7]*w,c[8]=s[8]*M,c[9]=s[9]*M,c[10]=s[10]*M,c[11]=s[11]*M,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c}function $1(c,s,h){var g=Math.sin(h),w=Math.cos(h),M=s[4],k=s[5],R=s[6],o=s[7],G=s[8],ne=s[9],oe=s[10],$=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=M*w+G*g,c[5]=k*w+ne*g,c[6]=R*w+oe*g,c[7]=o*w+$*g,c[8]=G*w-M*g,c[9]=ne*w-k*g,c[10]=oe*w-R*g,c[11]=$*w-o*g,c}function Z1(c,s,h){var g=Math.sin(h),w=Math.cos(h),M=s[0],k=s[1],R=s[2],o=s[3],G=s[4],ne=s[5],oe=s[6],$=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=M*w+G*g,c[1]=k*w+ne*g,c[2]=R*w+oe*g,c[3]=o*w+$*g,c[4]=G*w-M*g,c[5]=ne*w-k*g,c[6]=oe*w-R*g,c[7]=$*w-o*g,c}function G1(c,s,h,g,w){var M=1/Math.tan(s/2),k;return c[0]=M/h,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=M,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,w!=null&&w!==1/0?(k=1/(g-w),c[10]=(w+g)*k,c[14]=2*w*g*k):(c[10]=-1,c[14]=-2*g),c}function Iy(c,s){var h=c[0],g=c[1],w=c[2],M=c[3],k=c[4],R=c[5],o=c[6],G=c[7],ne=c[8],oe=c[9],$=c[10],de=c[11],H=c[12],Te=c[13],Me=c[14],je=c[15],He=s[0],Ve=s[1],Xe=s[2],$e=s[3],Ze=s[4],xt=s[5],It=s[6],Pt=s[7],Ot=s[8],Yt=s[9],Nt=s[10],$t=s[11],Et=s[12],yn=s[13],Dr=s[14],Fe=s[15];return Math.abs(h-He)<=_o*Math.max(1,Math.abs(h),Math.abs(He))&&Math.abs(g-Ve)<=_o*Math.max(1,Math.abs(g),Math.abs(Ve))&&Math.abs(w-Xe)<=_o*Math.max(1,Math.abs(w),Math.abs(Xe))&&Math.abs(M-$e)<=_o*Math.max(1,Math.abs(M),Math.abs($e))&&Math.abs(k-Ze)<=_o*Math.max(1,Math.abs(k),Math.abs(Ze))&&Math.abs(R-xt)<=_o*Math.max(1,Math.abs(R),Math.abs(xt))&&Math.abs(o-It)<=_o*Math.max(1,Math.abs(o),Math.abs(It))&&Math.abs(G-Pt)<=_o*Math.max(1,Math.abs(G),Math.abs(Pt))&&Math.abs(ne-Ot)<=_o*Math.max(1,Math.abs(ne),Math.abs(Ot))&&Math.abs(oe-Yt)<=_o*Math.max(1,Math.abs(oe),Math.abs(Yt))&&Math.abs($-Nt)<=_o*Math.max(1,Math.abs($),Math.abs(Nt))&&Math.abs(de-$t)<=_o*Math.max(1,Math.abs(de),Math.abs($t))&&Math.abs(H-Et)<=_o*Math.max(1,Math.abs(H),Math.abs(Et))&&Math.abs(Te-yn)<=_o*Math.max(1,Math.abs(Te),Math.abs(yn))&&Math.abs(Me-Dr)<=_o*Math.max(1,Math.abs(Me),Math.abs(Dr))&&Math.abs(je-Fe)<=_o*Math.max(1,Math.abs(je),Math.abs(Fe))}function q1(){var c=new cd(2);return cd!=Float32Array&&(c[0]=0,c[1]=0),c}function ng(c,s,h){return c[0]=s[0]+h[0],c[1]=s[1]+h[1],c}function W1(c,s,h){return c[0]=s[0]-h[0],c[1]=s[1]-h[1],c}function X1(c,s,h){return c[0]=s[0]*h,c[1]=s[1]*h,c}function H1(c){var s=c[0],h=c[1];return Math.hypot(s,h)}function Y1(c,s){return c[0]=-s[0],c[1]=-s[1],c}function tx(c,s,h,g){var w=s[0],M=s[1];return c[0]=w+g*(h[0]-w),c[1]=M+g*(h[1]-M),c}var K1=W1;(function(){var c=q1();return function(s,h,g,w,M,k){var R,o;for(h||(h=2),g||(g=0),w?o=Math.min(w*h+g,s.length):o=s.length,R=g;R<o;R+=h)c[0]=s[R],c[1]=s[R+1],M(c,c,k),s[R]=c[0],s[R+1]=c[1];return s}})();function J1(){var c=new cd(3);return cd!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Q1(c,s,h){return c[0]=s[0]+h[0],c[1]=s[1]+h[1],c[2]=s[2]+h[2],c}function eb(c,s,h){return c[0]=s[0]*h[0],c[1]=s[1]*h[1],c[2]=s[2]*h[2],c}function tb(c,s){return c[0]=-s[0],c[1]=-s[1],c[2]=-s[2],c}var nb=eb;(function(){var c=J1();return function(s,h,g,w,M,k){var R,o;for(h||(h=3),g||(g=0),w?o=Math.min(w*h+g,s.length):o=s.length,R=g;R<o;R+=h)c[0]=s[R],c[1]=s[R+1],c[2]=s[R+2],M(c,c,k),s[R]=c[0],s[R+1]=c[1],s[R+2]=c[2];return s}})();function oc(c,s){if(!c)throw new Error(s||"@math.gl/web-mercator: assertion failed.")}const Ua=Math.PI,nx=Ua/4,bl=Ua/180,rg=180/Ua,pf=512,Ay=4003e4,ky=85.051129,rx=1.5;function ig(c){return Math.pow(2,c)}function rb(c){return Sg(c)}function rc([c,s]){oc(Number.isFinite(c)),oc(Number.isFinite(s)&&s>=-90&&s<=90,"invalid latitude");const h=c*bl,g=s*bl,w=pf*(h+Ua)/(2*Ua),M=pf*(Ua+Math.log(Math.tan(nx+g*.5)))/(2*Ua);return[w,M]}function sc([c,s]){const h=c/pf*(2*Ua)-Ua,g=2*(Math.atan(Math.exp(s/pf*(2*Ua)-Ua))-nx);return[h*rg,g*rg]}function ib({latitude:c,longitude:s,highPrecision:h=!1}){oc(Number.isFinite(c)&&Number.isFinite(s));const g={},w=pf,M=Math.cos(c*bl),k=w/360,R=k/M,o=w/Ay/M;if(g.unitsPerMeter=[o,o,o],g.metersPerUnit=[1/o,1/o,1/o],g.unitsPerDegree=[k,R,o],g.degreesPerUnit=[1/k,1/R,1/o],h){const G=bl*Math.tan(c*bl)/M,ne=k*G/2,oe=w/Ay*G,$=oe/R*o;g.unitsPerDegree2=[0,ne,oe],g.unitsPerMeter2=[$,0,$]}return g}function ob({height:c,pitch:s,bearing:h,altitude:g,scale:w,center:M=null}){const k=pp();return tg(k,k,[0,0,-g]),$1(k,k,-s*bl),Z1(k,k,h*bl),w/=c,ex(k,k,[w,w,w]),M&&tg(k,k,tb([],M)),k}function sb({width:c,height:s,fovy:h=xp(rx),altitude:g,pitch:w=0,nearZMultiplier:M=1,farZMultiplier:k=1}){g!==void 0&&(h=xp(g));const R=.5*h*bl,o=ix(h),G=w*bl,ne=Math.sin(R)*o/Math.sin(Math.min(Math.max(Math.PI/2-G-R,.01),Math.PI-.01)),oe=Math.sin(G)*ne+o;return{fov:2*R,aspect:c/s,focalDistance:o,near:M,far:oe*k}}function ab({width:c,height:s,pitch:h,altitude:g,fovy:w,nearZMultiplier:M,farZMultiplier:k}){const{fov:R,aspect:o,near:G,far:ne}=sb({width:c,height:s,altitude:g,fovy:w,pitch:h,nearZMultiplier:M,farZMultiplier:k});return G1([],R,o,G,ne)}function xp(c){return 2*Math.atan(.5/c)*rg}function ix(c){return .5/Math.tan(.5*c*bl)}function lb(c,s){const[h,g,w=0]=c;return oc(Number.isFinite(h)&&Number.isFinite(g)&&Number.isFinite(w)),ad(s,[h,g,w,1])}function zy(c,s,h=0){const[g,w,M]=c;if(oc(Number.isFinite(g)&&Number.isFinite(w),"invalid pixel coordinate"),Number.isFinite(M))return ad(s,[g,w,M,1]);const k=ad(s,[g,w,0,1]),R=ad(s,[g,w,1,1]),o=k[2],G=R[2],ne=o===G?0:((h||0)-o)/(G-o);return tx([],k,R,ne)}function ub({width:c,height:s,bounds:h,minExtent:g=0,maxZoom:w=24,padding:M=0,offset:k=[0,0]}){const[[R,o],[G,ne]]=h;if(Number.isFinite(M)){const Ze=M;M={top:Ze,bottom:Ze,left:Ze,right:Ze}}else oc(Number.isFinite(M.top)&&Number.isFinite(M.bottom)&&Number.isFinite(M.left)&&Number.isFinite(M.right));const oe=rc([R,Py(ne,-85.051129,ky)]),$=rc([G,Py(o,-85.051129,ky)]),de=[Math.max(Math.abs($[0]-oe[0]),g),Math.max(Math.abs($[1]-oe[1]),g)],H=[c-M.left-M.right-Math.abs(k[0])*2,s-M.top-M.bottom-Math.abs(k[1])*2];oc(H[0]>0&&H[1]>0);const Te=H[0]/de[0],Me=H[1]/de[1],je=(M.right-M.left)/2/Te,He=(M.bottom-M.top)/2/Me,Ve=[($[0]+oe[0])/2+je,($[1]+oe[1])/2+He],Xe=sc(Ve),$e=Math.min(w,Sg(Math.abs(Math.min(Te,Me))));return oc(Number.isFinite($e)),{longitude:Xe[0],latitude:Xe[1],zoom:$e}}const Dy=Math.PI/180;function cb(c,s=0){const{width:h,height:g,unproject:w}=c,M={targetZ:s},k=w([0,g],M),R=w([h,g],M);let o,G;const ne=c.fovy?.5*c.fovy*Dy:Math.atan(.5/c.altitude),oe=(90-c.pitch)*Dy;return ne>oe-.01?(o=Ly(c,0,s),G=Ly(c,h,s)):(o=w([0,0],M),G=w([h,0],M)),[k,R,G,o]}function Ly(c,s,h){const{pixelUnprojectionMatrix:g}=c,w=ad(g,[s,0,1,1]),M=ad(g,[s,c.height,1,1]),R=(h*c.distanceScales.unitsPerMeter[2]-w[2])/(M[2]-w[2]),o=tx([],w,M,R),G=sc(o);return G[2]=h,G}let ch=class og{constructor({width:s,height:h,latitude:g=0,longitude:w=0,zoom:M=0,pitch:k=0,bearing:R=0,altitude:o=null,fovy:G=null,position:ne=null,nearZMultiplier:oe=.02,farZMultiplier:$=1.01}={width:1,height:1}){s=s||1,h=h||1,G===null&&o===null?(o=rx,G=xp(o)):G===null?G=xp(o):o===null&&(o=ix(G));const de=ig(M);o=Math.max(.75,o);const H=ib({longitude:w,latitude:g}),Te=rc([w,g]);Te[2]=0,ne&&Q1(Te,Te,nb([],ne,H.unitsPerMeter)),this.projectionMatrix=ab({width:s,height:h,pitch:k,fovy:G,nearZMultiplier:oe,farZMultiplier:$}),this.viewMatrix=ob({height:h,scale:de,center:Te,pitch:k,bearing:R,altitude:o}),this.width=s,this.height=h,this.scale=de,this.latitude=g,this.longitude=w,this.zoom=M,this.pitch=k,this.bearing=R,this.altitude=o,this.fovy=G,this.center=Te,this.meterOffset=ne||[0,0,0],this.distanceScales=H,this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this)}_initMatrices(){const{width:s,height:h,projectionMatrix:g,viewMatrix:w}=this,M=pp();Nm(M,M,g),Nm(M,M,w),this.viewProjectionMatrix=M;const k=pp();ex(k,k,[s/2,-h/2,1]),tg(k,k,[1,-1,0]),Nm(k,k,M);const R=V1(pp(),k);if(!R)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=k,this.pixelUnprojectionMatrix=R}equals(s){return s instanceof og?s.width===this.width&&s.height===this.height&&Iy(s.projectionMatrix,this.projectionMatrix)&&Iy(s.viewMatrix,this.viewMatrix):!1}project(s,{topLeft:h=!0}={}){const g=this.projectPosition(s),w=lb(g,this.pixelProjectionMatrix),[M,k]=w,R=h?k:this.height-k;return s.length===2?[M,R]:[M,R,w[2]]}unproject(s,{topLeft:h=!0,targetZ:g=void 0}={}){const[w,M,k]=s,R=h?M:this.height-M,o=g&&g*this.distanceScales.unitsPerMeter[2],G=zy([w,R,k],this.pixelUnprojectionMatrix,o),[ne,oe,$]=this.unprojectPosition(G);return Number.isFinite(k)?[ne,oe,$]:Number.isFinite(g)?[ne,oe,g]:[ne,oe]}projectPosition(s){const[h,g]=rc(s),w=(s[2]||0)*this.distanceScales.unitsPerMeter[2];return[h,g,w]}unprojectPosition(s){const[h,g]=sc(s),w=(s[2]||0)*this.distanceScales.metersPerUnit[2];return[h,g,w]}projectFlat(s){return rc(s)}unprojectFlat(s){return sc(s)}getMapCenterByLngLatPosition({lngLat:s,pos:h}){const g=zy(h,this.pixelUnprojectionMatrix),w=rc(s),M=ng([],w,Y1([],g)),k=ng([],this.center,M);return sc(k)}getLocationAtPoint({lngLat:s,pos:h}){return this.getMapCenterByLngLatPosition({lngLat:s,pos:h})}fitBounds(s,h={}){const{width:g,height:w}=this,{longitude:M,latitude:k,zoom:R}=ub(Object.assign({width:g,height:w,bounds:s},h));return new og({width:g,height:w,longitude:M,latitude:k,zoom:R})}getBounds(s){const h=this.getBoundingRegion(s),g=Math.min(...h.map(R=>R[0])),w=Math.max(...h.map(R=>R[0])),M=Math.min(...h.map(R=>R[1])),k=Math.max(...h.map(R=>R[1]));return[[g,M],[w,k]]}getBoundingRegion(s={}){return cb(this,s.z||0)}};const Ry=512;function hb({width:c,height:s,longitude:h,latitude:g,zoom:w,pitch:M=0,bearing:k=0}){(h<-180||h>180)&&(h=Cy(h+180,360)-180),(k<-180||k>180)&&(k=Cy(k+180,360)-180);const R=Sg(s/Ry);if(w<=R)w=R,g=0;else{const o=s/2/Math.pow(2,w),G=sc([0,o])[1];if(g<G)g=G;else{const ne=sc([0,Ry-o])[1];g>ne&&(g=ne)}}return{width:c,height:s,longitude:h,latitude:g,zoom:w,pitch:M,bearing:k}}const ox=.01,db=["longitude","latitude","zoom"],sx={curve:1.414,speed:1.2};function fb(c,s,h,g={}){const w={},{startZoom:M,startCenterXY:k,uDelta:R,w0:o,u1:G,S:ne,rho:oe,rho2:$,r0:de}=ax(c,s,g);if(G<ox){for(const $e of db){const Ze=c[$e],xt=s[$e];w[$e]=U1(Ze,xt,h)}return w}const H=h*ne,Te=Math.cosh(de)/Math.cosh(de+oe*H),Me=o*((Math.cosh(de)*Math.tanh(de+oe*H)-Math.sinh(de))/$)/G,je=1/Te,He=M+rb(je),Ve=X1([],R,Me);ng(Ve,Ve,k);const Xe=sc(Ve);return w.longitude=Xe[0],w.latitude=Xe[1],w.zoom=He,w}function pb(c,s,h={}){h=Object.assign({},sx,h);const{screenSpeed:g,speed:w,maxDuration:M}=h,{S:k,rho:R}=ax(c,s,h),o=1e3*k;let G;return Number.isFinite(g)?G=o/(g/R):G=o/w,Number.isFinite(M)&&G>M?0:G}function ax(c,s,h){h=Object.assign({},sx,h);const g=h.curve,w=c.zoom,M=[c.longitude,c.latitude],k=ig(w),R=s.zoom,o=[s.longitude,s.latitude],G=ig(R-w),ne=rc(M),oe=rc(o),$=K1([],oe,ne),de=Math.max(c.width,c.height),H=de/G,Te=H1($)*k,Me=Math.max(Te,ox),je=g*g,He=(H*H-de*de+je*je*Me*Me)/(2*de*je*Me),Ve=(H*H-de*de-je*je*Me*Me)/(2*H*je*Me),Xe=Math.log(Math.sqrt(He*He+1)-He),$e=Math.log(Math.sqrt(Ve*Ve+1)-Ve),Ze=($e-Xe)/g;return{startZoom:w,startCenterXY:ne,uDelta:$,w0:de,u1:Te,S:Ze,rho:g,rho2:je,r0:Xe,r1:$e}}var lx=function(){if(typeof Map<"u")return Map;function c(s,h){var g=-1;return s.some(function(w,M){return w[0]===h?(g=M,!0):!1}),g}return function(){function s(){this.__entries__=[]}return Object.defineProperty(s.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),s.prototype.get=function(h){var g=c(this.__entries__,h),w=this.__entries__[g];return w&&w[1]},s.prototype.set=function(h,g){var w=c(this.__entries__,h);~w?this.__entries__[w][1]=g:this.__entries__.push([h,g])},s.prototype.delete=function(h){var g=this.__entries__,w=c(g,h);~w&&g.splice(w,1)},s.prototype.has=function(h){return!!~c(this.__entries__,h)},s.prototype.clear=function(){this.__entries__.splice(0)},s.prototype.forEach=function(h,g){g===void 0&&(g=null);for(var w=0,M=this.__entries__;w<M.length;w++){var k=M[w];h.call(g,k[1],k[0])}},s}()}(),sg=typeof window<"u"&&typeof document<"u"&&window.document===document,bp=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),mb=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(bp):function(c){return setTimeout(function(){return c(Date.now())},1e3/60)}}(),gb=2;function _b(c,s){var h=!1,g=!1,w=0;function M(){h&&(h=!1,c()),g&&R()}function k(){mb(M)}function R(){var o=Date.now();if(h){if(o-w<gb)return;g=!0}else h=!0,g=!1,setTimeout(k,s);w=o}return R}var yb=20,vb=["top","right","bottom","left","width","height","size","weight"],xb=typeof MutationObserver<"u",bb=function(){function c(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=_b(this.refresh.bind(this),yb)}return c.prototype.addObserver=function(s){~this.observers_.indexOf(s)||this.observers_.push(s),this.connected_||this.connect_()},c.prototype.removeObserver=function(s){var h=this.observers_,g=h.indexOf(s);~g&&h.splice(g,1),!h.length&&this.connected_&&this.disconnect_()},c.prototype.refresh=function(){var s=this.updateObservers_();s&&this.refresh()},c.prototype.updateObservers_=function(){var s=this.observers_.filter(function(h){return h.gatherActive(),h.hasActive()});return s.forEach(function(h){return h.broadcastActive()}),s.length>0},c.prototype.connect_=function(){!sg||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),xb?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},c.prototype.disconnect_=function(){!sg||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},c.prototype.onTransitionEnd_=function(s){var h=s.propertyName,g=h===void 0?"":h,w=vb.some(function(M){return!!~g.indexOf(M)});w&&this.refresh()},c.getInstance=function(){return this.instance_||(this.instance_=new c),this.instance_},c.instance_=null,c}(),ux=function(c,s){for(var h=0,g=Object.keys(s);h<g.length;h++){var w=g[h];Object.defineProperty(c,w,{value:s[w],enumerable:!1,writable:!1,configurable:!0})}return c},hd=function(c){var s=c&&c.ownerDocument&&c.ownerDocument.defaultView;return s||bp},cx=zp(0,0,0,0);function wp(c){return parseFloat(c)||0}function Oy(c){for(var s=[],h=1;h<arguments.length;h++)s[h-1]=arguments[h];return s.reduce(function(g,w){var M=c["border-"+w+"-width"];return g+wp(M)},0)}function wb(c){for(var s=["top","right","bottom","left"],h={},g=0,w=s;g<w.length;g++){var M=w[g],k=c["padding-"+M];h[M]=wp(k)}return h}function Eb(c){var s=c.getBBox();return zp(0,0,s.width,s.height)}function Tb(c){var s=c.clientWidth,h=c.clientHeight;if(!s&&!h)return cx;var g=hd(c).getComputedStyle(c),w=wb(g),M=w.left+w.right,k=w.top+w.bottom,R=wp(g.width),o=wp(g.height);if(g.boxSizing==="border-box"&&(Math.round(R+M)!==s&&(R-=Oy(g,"left","right")+M),Math.round(o+k)!==h&&(o-=Oy(g,"top","bottom")+k)),!Mb(c)){var G=Math.round(R+M)-s,ne=Math.round(o+k)-h;Math.abs(G)!==1&&(R-=G),Math.abs(ne)!==1&&(o-=ne)}return zp(w.left,w.top,R,o)}var Sb=function(){return typeof SVGGraphicsElement<"u"?function(c){return c instanceof hd(c).SVGGraphicsElement}:function(c){return c instanceof hd(c).SVGElement&&typeof c.getBBox=="function"}}();function Mb(c){return c===hd(c).document.documentElement}function Cb(c){return sg?Sb(c)?Eb(c):Tb(c):cx}function Pb(c){var s=c.x,h=c.y,g=c.width,w=c.height,M=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,k=Object.create(M.prototype);return ux(k,{x:s,y:h,width:g,height:w,top:h,right:s+g,bottom:w+h,left:s}),k}function zp(c,s,h,g){return{x:c,y:s,width:h,height:g}}var Ib=function(){function c(s){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=zp(0,0,0,0),this.target=s}return c.prototype.isActive=function(){var s=Cb(this.target);return this.contentRect_=s,s.width!==this.broadcastWidth||s.height!==this.broadcastHeight},c.prototype.broadcastRect=function(){var s=this.contentRect_;return this.broadcastWidth=s.width,this.broadcastHeight=s.height,s},c}(),Ab=function(){function c(s,h){var g=Pb(h);ux(this,{target:s,contentRect:g})}return c}(),kb=function(){function c(s,h,g){if(this.activeObservations_=[],this.observations_=new lx,typeof s!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=s,this.controller_=h,this.callbackCtx_=g}return c.prototype.observe=function(s){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(s instanceof hd(s).Element))throw new TypeError('parameter 1 is not of type "Element".');var h=this.observations_;h.has(s)||(h.set(s,new Ib(s)),this.controller_.addObserver(this),this.controller_.refresh())}},c.prototype.unobserve=function(s){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(s instanceof hd(s).Element))throw new TypeError('parameter 1 is not of type "Element".');var h=this.observations_;h.has(s)&&(h.delete(s),h.size||this.controller_.removeObserver(this))}},c.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},c.prototype.gatherActive=function(){var s=this;this.clearActive(),this.observations_.forEach(function(h){h.isActive()&&s.activeObservations_.push(h)})},c.prototype.broadcastActive=function(){if(this.hasActive()){var s=this.callbackCtx_,h=this.activeObservations_.map(function(g){return new Ab(g.target,g.broadcastRect())});this.callback_.call(s,h,s),this.clearActive()}},c.prototype.clearActive=function(){this.activeObservations_.splice(0)},c.prototype.hasActive=function(){return this.activeObservations_.length>0},c}(),hx=typeof WeakMap<"u"?new WeakMap:new lx,dx=function(){function c(s){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var h=bb.getInstance(),g=new kb(s,h,this);hx.set(this,g)}return c}();["observe","unobserve","disconnect"].forEach(function(c){dx.prototype[c]=function(){var s;return(s=hx.get(this))[c].apply(s,arguments)}});var zb=function(){return typeof bp.ResizeObserver<"u"?bp.ResizeObserver:dx}();function lc(c,s){if(!(c instanceof s))throw new TypeError("Cannot call a class as a function")}function Db(c,s){for(var h=0;h<s.length;h++){var g=s[h];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(c,g.key,g)}}function uc(c,s,h){return s&&Db(c.prototype,s),Object.defineProperty(c,"prototype",{writable:!1}),c}var du=typeof document<"u"?document:{};function By(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function op(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?By(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):By(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}function Fy(c,s){var h;if(typeof Symbol>"u"||c[Symbol.iterator]==null){if(Array.isArray(c)||(h=Lb(c))||s){h&&(c=h);var g=0,w=function(){};return{s:w,n:function(){return g>=c.length?{done:!0}:{done:!1,value:c[g++]}},e:function(G){throw G},f:w}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var M=!0,k=!1,R;return{s:function(){h=c[Symbol.iterator]()},n:function(){var G=h.next();return M=G.done,G},e:function(G){k=!0,R=G},f:function(){try{!M&&h.return!=null&&h.return()}finally{if(k)throw R}}}}function Lb(c,s){if(c){if(typeof c=="string")return Ny(c,s);var h=Object.prototype.toString.call(c).slice(8,-1);if(h==="Object"&&c.constructor&&(h=c.constructor.name),h==="Map"||h==="Set")return Array.from(c);if(h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return Ny(c,s)}}function Ny(c,s){(s==null||s>c.length)&&(s=c.length);for(var h=0,g=new Array(s);h<s;h++)g[h]=c[h];return g}var Rb=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Um(c){if(!c)return null;if(typeof c=="string")return c;c.toJS&&(c=c.toJS());var s={},h=Fy(c.layers),g;try{for(h.s();!(g=h.n()).done;){var w=g.value;s[w.id]=w}}catch(k){h.e(k)}finally{h.f()}var M=c.layers.map(function(k){var R=s[k.ref],o=null;if("interactive"in k&&(o=op({},k),delete o.interactive),R){o=o||op({},k),delete o.ref;var G=Fy(Rb),ne;try{for(G.s();!(ne=G.n()).done;){var oe=ne.value;oe in R&&(o[oe]=R[oe])}}catch($){G.e($)}finally{G.f()}}return o||k});return op(op({},c),{},{layers:M})}var Uy={};function Ob(){}function Bb(c){c&&console.error(c.error)}var fx={container:Oe.object,gl:Oe.object,mapboxApiAccessToken:Oe.string,mapboxApiUrl:Oe.string,attributionControl:Oe.bool,preserveDrawingBuffer:Oe.bool,reuseMaps:Oe.bool,transformRequest:Oe.func,mapOptions:Oe.object,mapStyle:Oe.oneOfType([Oe.string,Oe.object]),preventStyleDiffing:Oe.bool,visible:Oe.bool,asyncRender:Oe.bool,onLoad:Oe.func,onError:Oe.func,width:Oe.number,height:Oe.number,viewState:Oe.object,longitude:Oe.number,latitude:Oe.number,zoom:Oe.number,bearing:Oe.number,pitch:Oe.number,altitude:Oe.number},mp={container:du.body,mapboxApiAccessToken:Fb(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:Ob,onError:Bb,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function Fb(){var c=null;if(typeof window<"u"&&window.location){var s=window.location.search.match(/access_token=([^&\/]*)/);c=s&&s[1]}return!c&&typeof process<"u"&&(c=c||Uy.MapboxAccessToken||Uy.REACT_APP_MAPBOX_ACCESS_TOKEN),c||"no-token"}function jy(c){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";c.debug&&Oe.checkPropTypes(fx,c,"prop",s)}var dh=function(){function c(s){var h=this;if(lc(this,c),fn(this,"props",mp),fn(this,"width",0),fn(this,"height",0),fn(this,"_fireLoadEvent",function(){h.props.onLoad({type:"load",target:h._map})}),fn(this,"_handleError",function(g){h.props.onError(g)}),!s.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=s.mapboxgl,c.initialized||(c.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(s)}return uc(c,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(h){return this._update(this.props,h),this}},{key:"redraw",value:function(){var h=this._map;h.style&&(h._frame&&(h._frame.cancel(),h._frame=null),h._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(h){this._map=c.savedMap;var g=this._map.getContainer(),w=h.container;for(w.classList.add("mapboxgl-map");g.childNodes.length>0;)w.appendChild(g.childNodes[0]);this._map._container=w,c.savedMap=null,h.mapStyle&&this._map.setStyle(Um(h.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(h){if(h.reuseMaps&&c.savedMap)this._reuse(h);else{if(h.gl){var g=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=g,h.gl}}var w={container:h.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:Um(h.mapStyle),interactive:!1,trackResize:!1,attributionControl:h.attributionControl,preserveDrawingBuffer:h.preserveDrawingBuffer};h.transformRequest&&(w.transformRequest=h.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},w,h.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!c.savedMap?(c.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(h){var g=this;h=Object.assign({},mp,h),jy(h,"Mapbox"),this.mapboxgl.accessToken=h.mapboxApiAccessToken||mp.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=h.mapboxApiUrl,this._create(h);var w=h,M=w.container;Object.defineProperty(M,"offsetWidth",{configurable:!0,get:function(){return g.width}}),Object.defineProperty(M,"clientWidth",{configurable:!0,get:function(){return g.width}}),Object.defineProperty(M,"offsetHeight",{configurable:!0,get:function(){return g.height}}),Object.defineProperty(M,"clientHeight",{configurable:!0,get:function(){return g.height}});var k=this._map.getCanvas();k&&(k.style.outline="none"),this._updateMapViewport({},h),this._updateMapSize({},h),this.props=h}},{key:"_update",value:function(h,g){if(this._map){g=Object.assign({},this.props,g),jy(g,"Mapbox");var w=this._updateMapViewport(h,g),M=this._updateMapSize(h,g);this._updateMapStyle(h,g),!g.asyncRender&&(w||M)&&this.redraw(),this.props=g}}},{key:"_updateMapStyle",value:function(h,g){var w=h.mapStyle!==g.mapStyle;w&&this._map.setStyle(Um(g.mapStyle),{diff:!g.preventStyleDiffing})}},{key:"_updateMapSize",value:function(h,g){var w=h.width!==g.width||h.height!==g.height;return w&&(this.width=g.width,this.height=g.height,this._map.resize()),w}},{key:"_updateMapViewport",value:function(h,g){var w=this._getViewState(h),M=this._getViewState(g),k=M.latitude!==w.latitude||M.longitude!==w.longitude||M.zoom!==w.zoom||M.pitch!==w.pitch||M.bearing!==w.bearing||M.altitude!==w.altitude;return k&&(this._map.jumpTo(this._viewStateToMapboxProps(M)),M.altitude!==w.altitude&&(this._map.transform.altitude=M.altitude)),k}},{key:"_getViewState",value:function(h){var g=h.viewState||h,w=g.longitude,M=g.latitude,k=g.zoom,R=g.pitch,o=R===void 0?0:R,G=g.bearing,ne=G===void 0?0:G,oe=g.altitude,$=oe===void 0?1.5:oe;return{longitude:w,latitude:M,zoom:k,pitch:o,bearing:ne,altitude:$}}},{key:"_checkStyleSheet",value:function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof du>"u"))try{var g=du.createElement("div");g.className="mapboxgl-map",g.style.display="none",du.body.appendChild(g);var w=window.getComputedStyle(g).position!=="static";if(!w){var M=du.createElement("link");M.setAttribute("rel","stylesheet"),M.setAttribute("type","text/css"),M.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(h,"/mapbox-gl.css")),du.head.appendChild(M)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(h){return{center:[h.longitude,h.latitude],zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}}}]),c}();fn(dh,"initialized",!1);fn(dh,"propTypes",fx);fn(dh,"defaultProps",mp);fn(dh,"savedMap",null);var gp={exports:{}},Nb=gp.exports,Vy;function Ub(){return Vy||(Vy=1,function(c,s){var h={};(function(g,w){c.exports=w()})(Nb,function(){var g,w,M;function k(o,G){if(!g)g=G;else if(!w)w=G;else{var ne="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+g+")(sharedChunk); ("+w+")(sharedChunk); self.onerror = null;",oe={};g(oe),M=G(oe),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(M.workerUrl=window.URL.createObjectURL(new Blob([ne],{type:"text/javascript"})))}}k(["exports"],function(o){var G="2.7.1",ne=oe;function oe(t,e,r,i){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=r,this.p2y=i}oe.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},oe.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},oe.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},oe.prototype.solveCurveX=function(t,e){var r,i,u,f,_;for(e===void 0&&(e=1e-6),u=t,_=0;_<8;_++){if(f=this.sampleCurveX(u)-t,Math.abs(f)<e)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=f/x}if((u=t)<(r=0))return r;if(u>(i=1))return i;for(;r<i;){if(f=this.sampleCurveX(u),Math.abs(f-t)<e)return u;t>f?r=u:i=u,u=.5*(i-r)+r}return u},oe.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var $=de;function de(t,e){this.x=t,this.y=e}de.prototype={clone:function(){return new de(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),u=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-i*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},de.convert=function(t){return t instanceof de?t:Array.isArray(t)?new de(t[0],t[1]):t};var H=typeof self<"u"?self:{},Te=1e-6,Me=typeof Float32Array<"u"?Float32Array:Array;function je(){var t=new Me(9);return Me!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function He(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ve(t,e,r){var i=e[0],u=e[1],f=e[2],_=e[3],x=e[4],E=e[5],S=e[6],I=e[7],A=e[8],z=e[9],N=e[10],V=e[11],W=e[12],ee=e[13],ae=e[14],ge=e[15],be=r[0],Se=r[1],Ae=r[2],ze=r[3];return t[0]=be*i+Se*x+Ae*A+ze*W,t[1]=be*u+Se*E+Ae*z+ze*ee,t[2]=be*f+Se*S+Ae*N+ze*ae,t[3]=be*_+Se*I+Ae*V+ze*ge,t[4]=(be=r[4])*i+(Se=r[5])*x+(Ae=r[6])*A+(ze=r[7])*W,t[5]=be*u+Se*E+Ae*z+ze*ee,t[6]=be*f+Se*S+Ae*N+ze*ae,t[7]=be*_+Se*I+Ae*V+ze*ge,t[8]=(be=r[8])*i+(Se=r[9])*x+(Ae=r[10])*A+(ze=r[11])*W,t[9]=be*u+Se*E+Ae*z+ze*ee,t[10]=be*f+Se*S+Ae*N+ze*ae,t[11]=be*_+Se*I+Ae*V+ze*ge,t[12]=(be=r[12])*i+(Se=r[13])*x+(Ae=r[14])*A+(ze=r[15])*W,t[13]=be*u+Se*E+Ae*z+ze*ee,t[14]=be*f+Se*S+Ae*N+ze*ae,t[15]=be*_+Se*I+Ae*V+ze*ge,t}function Xe(t,e,r){var i,u,f,_,x,E,S,I,A,z,N,V,W=r[0],ee=r[1],ae=r[2];return e===t?(t[12]=e[0]*W+e[4]*ee+e[8]*ae+e[12],t[13]=e[1]*W+e[5]*ee+e[9]*ae+e[13],t[14]=e[2]*W+e[6]*ee+e[10]*ae+e[14],t[15]=e[3]*W+e[7]*ee+e[11]*ae+e[15]):(u=e[1],f=e[2],_=e[3],x=e[4],E=e[5],S=e[6],I=e[7],A=e[8],z=e[9],N=e[10],V=e[11],t[0]=i=e[0],t[1]=u,t[2]=f,t[3]=_,t[4]=x,t[5]=E,t[6]=S,t[7]=I,t[8]=A,t[9]=z,t[10]=N,t[11]=V,t[12]=i*W+x*ee+A*ae+e[12],t[13]=u*W+E*ee+z*ae+e[13],t[14]=f*W+S*ee+N*ae+e[14],t[15]=_*W+I*ee+V*ae+e[15]),t}function $e(t,e,r){var i=r[0],u=r[1],f=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*f,t[9]=e[9]*f,t[10]=e[10]*f,t[11]=e[11]*f,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ze(t,e,r){var i=Math.sin(r),u=Math.cos(r),f=e[4],_=e[5],x=e[6],E=e[7],S=e[8],I=e[9],A=e[10],z=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=f*u+S*i,t[5]=_*u+I*i,t[6]=x*u+A*i,t[7]=E*u+z*i,t[8]=S*u-f*i,t[9]=I*u-_*i,t[10]=A*u-x*i,t[11]=z*u-E*i,t}function xt(t,e,r){var i=Math.sin(r),u=Math.cos(r),f=e[0],_=e[1],x=e[2],E=e[3],S=e[8],I=e[9],A=e[10],z=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u-S*i,t[1]=_*u-I*i,t[2]=x*u-A*i,t[3]=E*u-z*i,t[8]=f*i+S*u,t[9]=_*i+I*u,t[10]=x*i+A*u,t[11]=E*i+z*u,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var It=Ve;function Pt(){var t=new Me(3);return Me!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ot(t){var e=new Me(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Yt(t){return Math.hypot(t[0],t[1],t[2])}function Nt(t,e,r){var i=new Me(3);return i[0]=t,i[1]=e,i[2]=r,i}function $t(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Et(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function yn(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Dr(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Fe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function gt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function Qt(t,e){var r=e[0],i=e[1],u=e[2],f=r*r+i*i+u*u;return f>0&&(f=1/Math.sqrt(f)),t[0]=e[0]*f,t[1]=e[1]*f,t[2]=e[2]*f,t}function vn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ut(t,e,r){var i=e[0],u=e[1],f=e[2],_=r[0],x=r[1],E=r[2];return t[0]=u*E-f*x,t[1]=f*_-i*E,t[2]=i*x-u*_,t}function st(t,e,r){var i=e[0],u=e[1],f=e[2],_=r[3]*i+r[7]*u+r[11]*f+r[15];return t[0]=(r[0]*i+r[4]*u+r[8]*f+r[12])/(_=_||1),t[1]=(r[1]*i+r[5]*u+r[9]*f+r[13])/_,t[2]=(r[2]*i+r[6]*u+r[10]*f+r[14])/_,t}function wt(t,e,r){var i=r[0],u=r[1],f=r[2],_=e[0],x=e[1],E=e[2],S=u*E-f*x,I=f*_-i*E,A=i*x-u*_,z=u*A-f*I,N=f*S-i*A,V=i*I-u*S,W=2*r[3];return I*=W,A*=W,N*=2,V*=2,t[0]=_+(S*=W)+(z*=2),t[1]=x+I+N,t[2]=E+A+V,t}var Wt,Jt=Et,nr=yn,On=Yt;function ar(t,e,r){var i=e[0],u=e[1],f=e[2],_=e[3];return t[0]=r[0]*i+r[4]*u+r[8]*f+r[12]*_,t[1]=r[1]*i+r[5]*u+r[9]*f+r[13]*_,t[2]=r[2]*i+r[6]*u+r[10]*f+r[14]*_,t[3]=r[3]*i+r[7]*u+r[11]*f+r[15]*_,t}function Pn(){var t=new Me(4);return Me!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Lr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ai(t,e,r){r*=.5;var i=e[0],u=e[1],f=e[2],_=e[3],x=Math.sin(r),E=Math.cos(r);return t[0]=i*E+_*x,t[1]=u*E+f*x,t[2]=f*E-u*x,t[3]=_*E-i*x,t}function Vr(t,e){return t[0]===e[0]&&t[1]===e[1]}Pt(),Wt=new Me(4),Me!=Float32Array&&(Wt[0]=0,Wt[1]=0,Wt[2]=0,Wt[3]=0),Pt(),Nt(1,0,0),Nt(0,1,0),Pn(),Pn(),je(),function(){var t;t=new Me(2),Me!=Float32Array&&(t[0]=0,t[1]=0)}();const yo=Math.PI/180,no=180/Math.PI;function en(t){return t*yo}function cr(t){return t*no}const $r=[[0,0],[1,0],[1,1],[0,1]];function Oo(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function is(t,e,r,i){const u=new ne(t,e,r,i);return function(f){return u.solve(f)}}const vo=is(.25,.1,.25,1);function rn(t,e,r){return Math.min(r,Math.max(e,t))}function xo(t,e,r){return(r=rn((r-t)/(e-t),0,1))*r*(3-2*r)}function Ni(t,e,r){const i=r-e,u=((t-e)%i+i)%i+e;return u===e?r:u}function os(t,e,r){if(!t.length)return r(null,[]);let i=t.length;const u=new Array(t.length);let f=null;t.forEach((_,x)=>{e(_,(E,S)=>{E&&(f=E),u[x]=S,--i==0&&r(f,u)})})}function Bo(t){const e=[];for(const r in t)e.push(t[r]);return e}function qn(t,...e){for(const r of e)for(const i in r)t[i]=r[i];return t}let Fo=1;function ss(){return Fo++}function as(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function oi(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function bo(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function wo(t,e){t.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function No(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Ui(t,e,r){const i={};for(const u in t)i[u]=e.call(this,t[u],u,t);return i}function ls(t,e,r){const i={};for(const u in t)e.call(r||this,t[u],u,t)&&(i[u]=t[u]);return i}function Zr(t){return Array.isArray(t)?t.map(Zr):typeof t=="object"&&t?Ui(t,Zr):t}const Uo={};function Kn(t){Uo[t]||(typeof console<"u"&&console.warn(t),Uo[t]=!0)}function yi(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function us(t){let e=0;for(let r,i,u=0,f=t.length,_=f-1;u<f;_=u++)r=t[u],i=t[_],e+=(i.x-r.x)*(r.y+i.y);return e}function ji(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Eo(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,i,u,f)=>{const _=u||f;return e[i]=!_||_.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Vi,$i,vi,xi=null;function Rr(t){if(xi==null){const e=t.navigator?t.navigator.userAgent:null;xi=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return xi}function cs(t){try{const e=H[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const si={now:()=>vi!==void 0?vi:H.performance.now(),setNow(t){vi=t},restoreNow(){vi=void 0},frame(t){const e=H.requestAnimationFrame(t);return{cancel:()=>H.cancelAnimationFrame(e)}},getImageData(t,e=0){const r=H.document.createElement("canvas"),i=r.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,i.drawImage(t,0,0,t.width,t.height),i.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(Vi||(Vi=H.document.createElement("a")),Vi.href=t,Vi.href),get devicePixelRatio(){return H.devicePixelRatio},get prefersReducedMotion(){return!!H.matchMedia&&($i==null&&($i=H.matchMedia("(prefers-reduced-motion: reduce)")),$i.matches)}};let se;const F={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(se==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{se=h.API_URL_REGEX!=null?new RegExp(h.API_URL_REGEX):t}catch{se=t}}return se},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Z={supported:!1,testSupport:function(t){!ve&&ue&&(Ie?Ce(t):re=t)}};let re,ue,ve=!1,Ie=!1;function Ce(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ue),t.isContextLost())return;Z.supported=!0}catch{}t.deleteTexture(e),ve=!0}H.document&&(ue=H.document.createElement("img"),ue.onload=function(){re&&Ce(re),re=null,Ie=!0},ue.onerror=function(){ve=!0,re=null},ue.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const we="01",De="NO_ACCESS_TOKEN";function We(t){return t.indexOf("mapbox:")===0}function et(t){return F.API_URL_REGEX.test(t)}const it=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Mt(t){const e=t.match(it);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function At(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function Lt(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(H.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ut{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Lt(F.ACCESS_TOKEN);let i="";return i=r&&r.u?H.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(+("0x"+f)))):F.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${i}`:`mapbox.eventData:${i}`}fetchEventData(){const e=cs("localStorage"),r=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{const u=H.localStorage.getItem(r);u&&(this.eventData=JSON.parse(u));const f=H.localStorage.getItem(i);f&&(this.anonId=f)}catch{Kn("Unable to read from LocalStorage")}}saveEventData(){const e=cs("localStorage"),r=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{H.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&H.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Kn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,i,u){if(!F.EVENTS_URL)return;const f=Mt(F.EVENTS_URL);f.params.push(`access_token=${u||F.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:we,userId:this.anonId},x=r?qn(_,r):_,E={url:At(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=qr(E,S=>{this.pendingRequest=null,i(S),this.saveEventData(),this.processRequests(u)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const on=new class extends Ut{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){F.EVENTS_URL&&F.ACCESS_TOKEN&&Array.isArray(t)&&t.some(r=>We(r)||et(r))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Lt(F.ACCESS_TOKEN),r=e?e.u:F.ACCESS_TOKEN;let i=r!==this.eventData.tokenU;bo(this.anonId)||(this.anonId=as(),i=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),_=new Date(u),x=(u-this.eventData.lastSuccess)/864e5;i=i||x>=1||x<-1||f.getDate()!==_.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(u,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=r)},t)}},jn=on.postTurnstileEvent.bind(on),Qn=new class extends Ut{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,i){this.skuToken=e,this.errorCb=i,F.EVENTS_URL&&(r||F.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(De)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),bo(this.anonId)||(this.anonId=as()),this.postEvent(r,{skuToken:this.skuToken},i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t))}},Sn=Qn.postMapLoadEvent.bind(Qn),Vn=new class extends Ut{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,i){if(!F.API_URL||!F.SESSION_PATH)return;const u=Mt(F.API_URL+F.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${i||F.ACCESS_TOKEN||""}`);const f={url:At(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ra(f,_=>{this.pendingRequest=null,r(_),this.saveEventData(),this.processRequests(i)})}getSessionAPI(t,e,r,i){this.skuToken=e,this.errorCb=i,F.SESSION_PATH&&F.API_URL&&(r||F.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(De)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t)}},br=Vn.getSessionAPI.bind(Vn),ai=new Set,rr="mapbox-tiles";let Sr,To,bi=500,ki=50;function hs(){H.caches&&!Sr&&(Sr=H.caches.open(rr))}function ks(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let Gr=1/0;const gr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(gr);class Qr extends Error{constructor(e,r,i){r===401&&et(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const zi=ji()?()=>self.worker&&self.worker.referrer:()=>(H.location.protocol==="blob:"?H.parent:H).location.href,Or=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(zi())&&!/^\w+:/.test(r))){if(H.fetch&&H.Request&&H.AbortController&&H.Request.prototype.hasOwnProperty("signal"))return function(i,u){const f=new H.AbortController,_=new H.Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:zi(),signal:f.signal});let x=!1,E=!1;const S=(I=_.url).indexOf("sku=")>0&&et(I);var I;i.type==="json"&&_.headers.set("Accept","application/json");const A=(N,V,W)=>{if(E)return;if(N&&N.message!=="SecurityError"&&Kn(N),V&&W)return z(V);const ee=Date.now();H.fetch(_).then(ae=>{if(ae.ok){const ge=S?ae.clone():null;return z(ae,ge,ee)}return u(new Qr(ae.statusText,ae.status,i.url))}).catch(ae=>{ae.code!==20&&u(new Error(ae.message))})},z=(N,V,W)=>{(i.type==="arrayBuffer"?N.arrayBuffer():i.type==="json"?N.json():N.text()).then(ee=>{E||(V&&W&&function(ae,ge,be){if(hs(),!Sr)return;const Se={status:ge.status,statusText:ge.statusText,headers:new H.Headers};ge.headers.forEach((ze,Qe)=>Se.headers.set(Qe,ze));const Ae=Eo(ge.headers.get("Cache-Control")||"");Ae["no-store"]||(Ae["max-age"]&&Se.headers.set("Expires",new Date(be+1e3*Ae["max-age"]).toUTCString()),new Date(Se.headers.get("Expires")).getTime()-be<42e4||function(ze,Qe){if(To===void 0)try{new Response(new ReadableStream),To=!0}catch{To=!1}To?Qe(ze.body):ze.blob().then(Qe)}(ge,ze=>{const Qe=new H.Response(ze,Se);hs(),Sr&&Sr.then(Ke=>Ke.put(ks(ae.url),Qe)).catch(Ke=>Kn(Ke.message))}))}(_,V,W),x=!0,u(null,ee,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(ee=>{E||u(new Error(ee.message))})};return S?function(N,V){if(hs(),!Sr)return V(null);const W=ks(N.url);Sr.then(ee=>{ee.match(W).then(ae=>{const ge=function(be){if(!be)return!1;const Se=new Date(be.headers.get("Expires")||0),Ae=Eo(be.headers.get("Cache-Control")||"");return Se>Date.now()&&!Ae["no-cache"]}(ae);ee.delete(W),ge&&ee.put(W,ae.clone()),V(null,ae,ge)}).catch(V)}).catch(V)}(_,A):A(null,null),{cancel:()=>{E=!0,x||f.abort()}}}(t,e);if(ji()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(i,u){const f=new H.XMLHttpRequest;f.open(i.method||"GET",i.url,!0),i.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const _ in i.headers)f.setRequestHeader(_,i.headers[_]);return i.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=i.credentials==="include",f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let _=f.response;if(i.type==="json")try{_=JSON.parse(f.response)}catch(x){return u(x)}u(null,_,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new Qr(f.statusText,f.status,i.url))},f.send(i.body),{cancel:()=>f.abort()}}(t,e)},Zi=function(t,e){return Or(qn(t,{type:"arrayBuffer"}),e)},qr=function(t,e){return Or(qn(t,{method:"POST"}),e)},ra=function(t,e){return Or(qn(t,{method:"GET"}),e)};function Gi(t){const e=H.document.createElement("a");return e.href=t,e.protocol===H.document.location.protocol&&e.host===H.document.location.host}const ds="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let qi,fs;qi=[],fs=0;const El=function(t,e){if(Z.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),fs>=F.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return qi.push(f),f}fs++;let r=!1;const i=()=>{if(!r)for(r=!0,fs--;qi.length&&fs<F.MAX_PARALLEL_IMAGE_REQUESTS;){const f=qi.shift(),{requestParameters:_,callback:x,cancelled:E}=f;E||(f.cancel=El(_,x).cancel)}},u=Zi(t,(f,_,x,E)=>{i(),f?e(f):_&&(H.createImageBitmap?function(S,I){const A=new H.Blob([new Uint8Array(S)],{type:"image/png"});H.createImageBitmap(A).then(z=>{I(null,z)}).catch(z=>{I(new Error(`Could not load image because of ${z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(S,I)=>e(S,I,x,E)):function(S,I){const A=new H.Image,z=H.URL;A.onload=()=>{I(null,A),z.revokeObjectURL(A.src),A.onload=null,H.requestAnimationFrame(()=>{A.src=ds})},A.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new H.Blob([new Uint8Array(S)],{type:"image/png"});A.src=S.byteLength?z.createObjectURL(N):ds}(_,(S,I)=>e(S,I,x,E)))});return{cancel:()=>{u.cancel(),i()}}};function ia(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function oa(t,e,r){if(r&&r[t]){const i=r[t].indexOf(e);i!==-1&&r[t].splice(i,1)}}class X{constructor(e,r={}){qn(this,r),this.type=e}}class ie extends X{constructor(e,r={}){super("error",qn({error:e},r))}}class xe{on(e,r){return this._listeners=this._listeners||{},ia(e,r,this._listeners),this}off(e,r){return oa(e,r,this._listeners),oa(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},ia(e,r,this._oneTimeListeners),this):new Promise(i=>this.once(e,i))}fire(e,r){typeof e=="string"&&(e=new X(e,r||{}));const i=e.type;if(this.listens(i)){e.target=this;const u=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const x of u)x.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const x of f)oa(i,x,this._oneTimeListeners),x.call(this,e);const _=this._eventedParent;_&&(qn(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof ie&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var le=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class ke{constructor(e,r,i,u){this.message=(e?`${e}: `:"")+i,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function kt(t){const e=t.value;return e?[new ke(t.key,e,"constants have been deprecated as of v8")]:[]}function tn(t,...e){for(const r of e)for(const i in r)t[i]=r[i];return t}function an(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function er(t){if(Array.isArray(t))return t.map(er);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=er(t[r]);return e}return an(t)}class ir extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class li{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[i,u]of r)this.bindings[i]=u}concat(e){return new li(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ps={kind:"null"},bt={kind:"number"},xn={kind:"string"},mn={kind:"boolean"},ro={kind:"color"},$a={kind:"object"},Bt={kind:"value"},jo={kind:"collator"},zs={kind:"formatted"},Tl={kind:"resolvedImage"};function ui(t,e){return{kind:"array",itemType:t,N:e}}function hr(t){if(t.kind==="array"){const e=hr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const mu=[ps,bt,xn,mn,ro,zs,$a,ui(Bt),Tl];function Br(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Br(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const r of mu)if(!Br(r,e))return null}}return`Expected ${hr(t)} but found ${hr(e)} instead.`}function Za(t,e){return e.some(r=>r.kind===t.kind)}function ms(t,e){return e.some(r=>r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t)}function Wi(t){var e={exports:{}};return t(e,e.exports),e.exports}var Ga=Wi(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(x){return(x=Math.round(x))<0?0:x>255?255:x}function u(x){return i(x[x.length-1]==="%"?parseFloat(x)/100*255:parseInt(x))}function f(x){return(E=x[x.length-1]==="%"?parseFloat(x)/100:parseFloat(x))<0?0:E>1?1:E;var E}function _(x,E,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?x+(E-x)*S*6:2*S<1?E:3*S<2?x+(E-x)*(2/3-S)*6:x}try{e.parseCSSColor=function(x){var E,S=x.replace(/ /g,"").toLowerCase();if(S in r)return r[S].slice();if(S[0]==="#")return S.length===4?(E=parseInt(S.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:S.length===7&&(E=parseInt(S.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var I=S.indexOf("("),A=S.indexOf(")");if(I!==-1&&A+1===S.length){var z=S.substr(0,I),N=S.substr(I+1,A-(I+1)).split(","),V=1;switch(z){case"rgba":if(N.length!==4)return null;V=f(N.pop());case"rgb":return N.length!==3?null:[u(N[0]),u(N[1]),u(N[2]),V];case"hsla":if(N.length!==4)return null;V=f(N.pop());case"hsl":if(N.length!==3)return null;var W=(parseFloat(N[0])%360+360)%360/360,ee=f(N[1]),ae=f(N[2]),ge=ae<=.5?ae*(ee+1):ae+ee-ae*ee,be=2*ae-ge;return[i(255*_(be,ge,W+1/3)),i(255*_(be,ge,W)),i(255*_(be,ge,W-1/3)),V];default:return null}}return null}}catch{}});class In{constructor(e,r,i,u=1){this.r=e,this.g=r,this.b=i,this.a=u}static parse(e){if(!e)return;if(e instanceof In)return e;if(typeof e!="string")return;const r=Ga.parseCSSColor(e);return r?new In(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,i,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(i)},${u})`}toArray(){const{r:e,g:r,b:i,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*r/u,255*i/u,u]}}In.black=new In(0,0,0,1),In.white=new In(1,1,1,1),In.transparent=new In(0,0,0,0),In.red=new In(1,0,0,1),In.blue=new In(0,0,1,1);class gu{constructor(e,r,i){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fc{constructor(e,r,i,u,f){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=i,this.fontStack=u,this.textColor=f}}class sn{constructor(e){this.sections=e}static fromString(e){return new sn([new fc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof sn?e:sn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const i={};r.fontStack&&(i["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(i["font-scale"]=r.scale),r.textColor&&(i["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(i)}return e}}class wi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new wi({name:e,available:!1}):null}serialize(){return["image",this.name]}}function fh(t,e,r,i){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?i===void 0||typeof i=="number"&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,r,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof i=="number"?[t,e,r,i]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function _u(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof In||t instanceof gu||t instanceof sn||t instanceof wi)return!0;if(Array.isArray(t)){for(const e of t)if(!_u(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!_u(t[e]))return!1;return!0}return!1}function _r(t){if(t===null)return ps;if(typeof t=="string")return xn;if(typeof t=="boolean")return mn;if(typeof t=="number")return bt;if(t instanceof In)return ro;if(t instanceof gu)return jo;if(t instanceof sn)return zs;if(t instanceof wi)return Tl;if(Array.isArray(t)){const e=t.length;let r;for(const i of t){const u=_r(i);if(r){if(r===u)continue;r=Bt;break}r=u}return ui(r||Bt,e)}return $a}function sa(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof In||t instanceof sn||t instanceof wi?t.toString():JSON.stringify(t)}class Ei{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!_u(e[1]))return r.error("invalid value");const i=e[1];let u=_r(i);const f=r.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new Ei(u,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof In?["rgba"].concat(this.value.toArray()):this.value instanceof sn?this.value.serialize():this.value}}class Ar{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const aa={string:xn,number:bt,boolean:mn,object:$a};class Xi{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let i,u=1;const f=e[0];if(f==="array"){let x,E;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in aa)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);x=aa[S],u++}else x=Bt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);E=e[2],u++}i=ui(x,E)}else i=aa[f];const _=[];for(;u<e.length;u++){const x=r.parse(e[u],u,Bt);if(!x)return null;_.push(x)}return new Xi(i,_)}evaluate(e){for(let r=0;r<this.args.length;r++){const i=this.args[r].evaluate(e);if(!Br(this.type,_r(i)))return i;if(r===this.args.length-1)throw new Ar(`Expected value to be of type ${hr(this.type)}, but found ${hr(_r(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const i=e.itemType;if(i.kind==="string"||i.kind==="number"||i.kind==="boolean"){r.push(i.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&r.push(u)}}return r.concat(this.args.map(i=>i.serialize()))}}class Hi{constructor(e){this.type=zs,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&typeof i=="object")return r.error("First argument must be an image or text section.");const u=[];let f=!1;for(let _=1;_<=e.length-1;++_){const x=e[_];if(f&&typeof x=="object"&&!Array.isArray(x)){f=!1;let E=null;if(x["font-scale"]&&(E=r.parse(x["font-scale"],1,bt),!E))return null;let S=null;if(x["text-font"]&&(S=r.parse(x["text-font"],1,ui(xn)),!S))return null;let I=null;if(x["text-color"]&&(I=r.parse(x["text-color"],1,ro),!I))return null;const A=u[u.length-1];A.scale=E,A.font=S,A.textColor=I}else{const E=r.parse(e[_],1,Bt);if(!E)return null;const S=E.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:E,scale:null,font:null,textColor:null})}}return new Hi(u)}evaluate(e){return new sn(this.sections.map(r=>{const i=r.content.evaluate(e);return _r(i)===Tl?new fc("",i,null,null,null):new fc(sa(i),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const i={};r.scale&&(i["font-scale"]=r.scale.serialize()),r.font&&(i["text-font"]=r.font.serialize()),r.textColor&&(i["text-color"]=r.textColor.serialize()),e.push(i)}return e}}class Vo{constructor(e){this.type=Tl,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const i=r.parse(e[1],1,xn);return i?new Vo(i):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),i=wi.fromString(r);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(r)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ph={"to-boolean":mn,"to-color":ro,"to-number":bt,"to-string":xn};class wr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const i=e[0];if((i==="to-boolean"||i==="to-string")&&e.length!==2)return r.error("Expected one argument.");const u=ph[i],f=[];for(let _=1;_<e.length;_++){const x=r.parse(e[_],_,Bt);if(!x)return null;f.push(x)}return new wr(u,f)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,i;for(const u of this.args){if(r=u.evaluate(e),i=null,r instanceof In)return r;if(typeof r=="string"){const f=e.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(i=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:fh(r[0],r[1],r[2],r[3]),!i))return new In(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ar(i||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const i of this.args){if(r=i.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new Ar(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?sn.fromString(sa(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?wi.fromString(sa(this.args[0].evaluate(e))):sa(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Hi([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const la=["Unknown","Point","LineString","Polygon"];class yu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?la[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:i,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*r-e[0])+this.featureDistanceData.bearing[1]*(u*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=In.parse(e)),r}}class ei{constructor(e,r,i,u){this.name=e,this.type=r,this._evaluate=i,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const i=e[0],u=ei.definitions[i];if(!u)return r.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=_.filter(([S])=>!Array.isArray(S)||S.length===e.length-1);let E=null;for(const[S,I]of x){E=new xu(r.registry,r.path,null,r.scope);const A=[];let z=!1;for(let N=1;N<e.length;N++){const V=e[N],W=Array.isArray(S)?S[N-1]:S.type,ee=E.parse(V,1+A.length,W);if(!ee){z=!0;break}A.push(ee)}if(!z)if(Array.isArray(S)&&S.length!==A.length)E.error(`Expected ${S.length} arguments, but found ${A.length} instead.`);else{for(let N=0;N<A.length;N++){const V=Array.isArray(S)?S[N]:S.type,W=A[N];E.concat(N+1).checkSubtype(V,W.type)}if(E.errors.length===0)return new ei(i,f,I,A)}}if(x.length===1)r.errors.push(...E.errors);else{const S=(x.length?x:_).map(([A])=>{return z=A,Array.isArray(z)?`(${z.map(hr).join(", ")})`:`(${hr(z.type)}...)`;var z}).join(" | "),I=[];for(let A=1;A<e.length;A++){const z=r.parse(e[A],1+I.length);if(!z)return null;I.push(hr(z.type))}r.error(`Expected arguments of type ${S}, but found (${I.join(", ")}) instead.`)}return null}static register(e,r){ei.definitions=r;for(const i in r)e[i]=ei}}class Sl{constructor(e,r,i){this.type=jo,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const i=e[1];if(typeof i!="object"||Array.isArray(i))return r.error("Collator options argument must be an object.");const u=r.parse(i["case-sensitive"]!==void 0&&i["case-sensitive"],1,mn);if(!u)return null;const f=r.parse(i["diacritic-sensitive"]!==void 0&&i["diacritic-sensitive"],1,mn);if(!f)return null;let _=null;return i.locale&&(_=r.parse(i.locale,1,xn),!_)?null:new Sl(u,f,_)}evaluate(e){return new gu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const $o=8192;function qa(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function gs(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Ml(t,e){const r=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*$o),Math.round(i*u*$o)]}function pc(t,e,r){const i=t[0]-e[0],u=t[1]-e[1],f=t[0]-r[0],_=t[1]-r[1];return i*_-f*u==0&&i*f<=0&&u*_<=0}function mc(t,e){let r=!1;for(let _=0,x=e.length;_<x;_++){const E=e[_];for(let S=0,I=E.length;S<I-1;S++){if(pc(t,E[S],E[S+1]))return!1;(u=E[S])[1]>(i=t)[1]!=(f=E[S+1])[1]>i[1]&&i[0]<(f[0]-u[0])*(i[1]-u[1])/(f[1]-u[1])+u[0]&&(r=!r)}}var i,u,f;return r}function mh(t,e){for(let r=0;r<e.length;r++)if(mc(t,e[r]))return!0;return!1}function gc(t,e,r,i){const u=i[0]-r[0],f=i[1]-r[1],_=(t[0]-r[0])*f-u*(t[1]-r[1]),x=(e[0]-r[0])*f-u*(e[1]-r[1]);return _>0&&x<0||_<0&&x>0}function _c(t,e,r){for(const S of r)for(let I=0;I<S.length-1;++I)if((x=[(_=S[I+1])[0]-(f=S[I])[0],_[1]-f[1]])[0]*(E=[(u=e)[0]-(i=t)[0],u[1]-i[1]])[1]-x[1]*E[0]!=0&&gc(i,u,f,_)&&gc(f,_,i,u))return!0;var i,u,f,_,x,E;return!1}function gh(t,e){for(let r=0;r<t.length;++r)if(!mc(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(_c(t[r],t[r+1],e))return!1;return!0}function yd(t,e){for(let r=0;r<e.length;r++)if(gh(t,e[r]))return!0;return!1}function yc(t,e,r){const i=[];for(let u=0;u<t.length;u++){const f=[];for(let _=0;_<t[u].length;_++){const x=Ml(t[u][_],r);qa(e,x),f.push(x)}i.push(f)}return i}function _h(t,e,r){const i=[];for(let u=0;u<t.length;u++){const f=yc(t[u],e,r);i.push(f)}return i}function vc(t,e,r,i){if(t[0]<r[0]||t[0]>r[2]){const u=.5*i;let f=t[0]-r[0]>u?-i:r[0]-t[0]>u?i:0;f===0&&(f=t[0]-r[2]>u?-i:r[2]-t[0]>u?i:0),t[0]+=f}qa(e,t)}function xc(t,e,r,i){const u=Math.pow(2,i.z)*$o,f=[i.x*$o,i.y*$o],_=[];for(const x of t)for(const E of x){const S=[E.x+f[0],E.y+f[1]];vc(S,e,r,u),_.push(S)}return _}function yh(t,e,r,i){const u=Math.pow(2,i.z)*$o,f=[i.x*$o,i.y*$o],_=[];for(const E of t){const S=[];for(const I of E){const A=[I.x+f[0],I.y+f[1]];qa(e,A),S.push(A)}_.push(S)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of _)for(const S of E)vc(S,e,r,u)}var x;return _}class ua{constructor(e,r){this.type=mn,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(_u(e[1])){const i=e[1];if(i.type==="FeatureCollection")for(let u=0;u<i.features.length;++u){const f=i.features[u].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new ua(i,i.features[u].geometry)}else if(i.type==="Feature"){const u=i.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new ua(i,i.geometry)}else if(i.type==="Polygon"||i.type==="MultiPolygon")return new ua(i,i)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,i){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(i.type==="Polygon"){const x=yc(i.coordinates,f,_),E=xc(r.geometry(),u,f,_);if(!gs(u,f))return!1;for(const S of E)if(!mc(S,x))return!1}if(i.type==="MultiPolygon"){const x=_h(i.coordinates,f,_),E=xc(r.geometry(),u,f,_);if(!gs(u,f))return!1;for(const S of E)if(!mh(S,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,i){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(i.type==="Polygon"){const x=yc(i.coordinates,f,_),E=yh(r.geometry(),u,f,_);if(!gs(u,f))return!1;for(const S of E)if(!gh(S,x))return!1}if(i.type==="MultiPolygon"){const x=_h(i.coordinates,f,_),E=yh(r.geometry(),u,f,_);if(!gs(u,f))return!1;for(const S of E)if(!yd(S,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Wa(t){if(t instanceof ei&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof ua)return!1;let e=!0;return t.eachChild(r=>{e&&!Wa(r)&&(e=!1)}),e}function Cl(t){if(t instanceof ei&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(r=>{e&&!Cl(r)&&(e=!1)}),e}function ca(t,e){if(t instanceof ei&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild(i=>{r&&!ca(i,e)&&(r=!1)}),r}class vu{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const i=e[1];return r.scope.has(i)?new vu(i,r.scope.get(i)):r.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class xu{constructor(e,r=[],i,u=new li,f=[]){this.registry=e,this.path=r,this.key=r.map(_=>`[${_}]`).join(""),this.scope=u,this.errors=f,this.expectedType=i}parse(e,r,i,u,f={}){return r?this.concat(r,i,u)._parse(e,f):this._parse(e,f)}_parse(e,r){function i(u,f,_){return _==="assert"?new Xi(f,[u]):_==="coerce"?new wr(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let _=f.parse(e,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,E=_.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||E.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string"){if(this.checkSubtype(x,E))return null}else _=i(_,x,r.typeAnnotation||"coerce");else _=i(_,x,r.typeAnnotation||"assert")}if(!(_ instanceof Ei)&&_.type.kind!=="resolvedImage"&&bu(_)){const x=new yu;try{_=new Ei(_.type,_.evaluate(x))}catch(E){return this.error(E.message),null}}return _}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,i){const u=typeof e=="number"?this.path.concat(e):this.path,f=i?this.scope.concat(i):this.scope;return new xu(this.registry,u,r||null,f,this.errors)}error(e,...r){const i=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new ir(i,e))}checkSubtype(e,r){const i=Br(e,r);return i&&this.error(i),i}}function bu(t){if(t instanceof vu)return bu(t.boundExpression);if(t instanceof ei&&t.name==="error"||t instanceof Sl||t instanceof ua)return!1;const e=t instanceof wr||t instanceof Xi;let r=!0;return t.eachChild(i=>{r=e?r&&bu(i):r&&i instanceof Ei}),!!r&&Wa(t)&&ca(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Xa(t,e){const r=t.length-1;let i,u,f=0,_=r,x=0;for(;f<=_;)if(x=Math.floor((f+_)/2),i=t[x],u=t[x+1],i<=e){if(x===r||e<u)return x;f=x+1}else{if(!(i>e))throw new Ar("Input is not a number.");_=x-1}return 0}class Pl{constructor(e,r,i){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,f]of i)this.labels.push(u),this.outputs.push(f)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const i=r.parse(e[1],1,bt);if(!i)return null;const u=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let _=1;_<e.length;_+=2){const x=_===1?-1/0:e[_],E=e[_+1],S=_,I=_+1;if(typeof x!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(u.length&&u[u.length-1][0]>=x)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const A=r.parse(E,I,f);if(!A)return null;f=f||A.type,u.push([x,A])}return new Pl(f,i,u)}evaluate(e){const r=this.labels,i=this.outputs;if(r.length===1)return i[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return i[0].evaluate(e);const f=r.length;return u>=r[f-1]?i[f-1].evaluate(e):i[Xa(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}function Nn(t,e,r){return t*(1-r)+e*r}var wu=Object.freeze({__proto__:null,number:Nn,color:function(t,e,r){return new In(Nn(t.r,e.r,r),Nn(t.g,e.g,r),Nn(t.b,e.b,r),Nn(t.a,e.a,r))},array:function(t,e,r){return t.map((i,u)=>Nn(i,e[u],r))}});const vh=.95047,Il=1.08883,bc=4/29,Eu=6/29,Tu=3*Eu*Eu,Al=Math.PI/180,vd=180/Math.PI;function kl(t){return t>.008856451679035631?Math.pow(t,1/3):t/Tu+bc}function zl(t){return t>Eu?t*t*t:Tu*(t-bc)}function Dl(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ha(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function wc(t){const e=Ha(t.r),r=Ha(t.g),i=Ha(t.b),u=kl((.4124564*e+.3575761*r+.1804375*i)/vh),f=kl((.2126729*e+.7151522*r+.072175*i)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-kl((.0193339*e+.119192*r+.9503041*i)/Il)),alpha:t.a}}function ha(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*zl(e),r=vh*zl(r),i=Il*zl(i),new In(Dl(3.2404542*r-1.5371385*e-.4985314*i),Dl(-.969266*r+1.8760108*e+.041556*i),Dl(.0556434*r-.2040259*e+1.0572252*i),t.alpha)}function xd(t,e,r){const i=e-t;return t+r*(i>180||i<-180?i-360*Math.round(i/360):i)}const Ll={forward:wc,reverse:ha,interpolate:function(t,e,r){return{l:Nn(t.l,e.l,r),a:Nn(t.a,e.a,r),b:Nn(t.b,e.b,r),alpha:Nn(t.alpha,e.alpha,r)}}},Rl={forward:function(t){const{l:e,a:r,b:i}=wc(t),u=Math.atan2(i,r)*vd;return{h:u<0?u+360:u,c:Math.sqrt(r*r+i*i),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Al,r=t.c;return ha({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:xd(t.h,e.h,r),c:Nn(t.c,e.c,r),l:Nn(t.l,e.l,r),alpha:Nn(t.alpha,e.alpha,r)}}};var Ec=Object.freeze({__proto__:null,lab:Ll,hcl:Rl});class Ti{constructor(e,r,i,u,f){this.type=e,this.operator=r,this.interpolation=i,this.input=u,this.labels=[],this.outputs=[];for(const[_,x]of f)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(e,r,i,u){let f=0;if(e.name==="exponential")f=Ds(r,e.base,i,u);else if(e.name==="linear")f=Ds(r,1,i,u);else if(e.name==="cubic-bezier"){const _=e.controlPoints;f=new ne(_[0],_[1],_[2],_[3]).solve(Ds(r,1,i,u))}return f}static parse(e,r){let[i,u,f,..._]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const S=u[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:S}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const S=u.slice(1);if(S.length!==4||S.some(I=>typeof I!="number"||I<0||I>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,bt),!f)return null;const x=[];let E=null;i==="interpolate-hcl"||i==="interpolate-lab"?E=ro:r.expectedType&&r.expectedType.kind!=="value"&&(E=r.expectedType);for(let S=0;S<_.length;S+=2){const I=_[S],A=_[S+1],z=S+3,N=S+4;if(typeof I!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(x.length&&x[x.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const V=r.parse(A,N,E);if(!V)return null;E=E||V.type,x.push([I,V])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new Ti(E,i,u,f,x):r.error(`Type ${hr(E)} is not interpolatable.`)}evaluate(e){const r=this.labels,i=this.outputs;if(r.length===1)return i[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return i[0].evaluate(e);const f=r.length;if(u>=r[f-1])return i[f-1].evaluate(e);const _=Xa(r,u),x=Ti.interpolationFactor(this.interpolation,u,r[_],r[_+1]),E=i[_].evaluate(e),S=i[_+1].evaluate(e);return this.operator==="interpolate"?wu[this.type.kind.toLowerCase()](E,S,x):this.operator==="interpolate-hcl"?Rl.reverse(Rl.interpolate(Rl.forward(E),Rl.forward(S),x)):Ll.reverse(Ll.interpolate(Ll.forward(E),Ll.forward(S),x))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let i=0;i<this.labels.length;i++)r.push(this.labels[i],this.outputs[i].serialize());return r}}function Ds(t,e,r,i){const u=i-r,f=t-r;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}class So{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let i=null;const u=r.expectedType;u&&u.kind!=="value"&&(i=u);const f=[];for(const x of e.slice(1)){const E=r.parse(x,1+f.length,i,void 0,{typeAnnotation:"omit"});if(!E)return null;i=i||E.type,f.push(E)}const _=u&&f.some(x=>Br(u,x.type));return new So(_?Bt:i,f)}evaluate(e){let r,i=null,u=0;for(const f of this.args){if(u++,i=f.evaluate(e),i&&i instanceof wi&&!i.available&&(r||(r=i),i=null,u===this.args.length))return r;if(i!==null)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Su{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let f=1;f<e.length-1;f+=2){const _=e[f];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,f);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const x=r.parse(e[f+1],f+1);if(!x)return null;i.push([_,x])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,i);return u?new Su(i,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,i]of this.bindings)e.push(r,i.serialize());return e.push(this.result.serialize()),e}}class Ya{constructor(e,r,i){this.type=e,this.index=r,this.input=i}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=r.parse(e[1],1,bt),u=r.parse(e[2],2,ui(r.expectedType||Bt));return i&&u?new Ya(u.type.itemType,i,u):null}evaluate(e){const r=this.index.evaluate(e),i=this.input.evaluate(e);if(r<0)throw new Ar(`Array index out of bounds: ${r} < 0.`);if(r>=i.length)throw new Ar(`Array index out of bounds: ${r} > ${i.length-1}.`);if(r!==Math.floor(r))throw new Ar(`Array index must be an integer, but found ${r} instead.`);return i[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Tc{constructor(e,r){this.type=mn,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=r.parse(e[1],1,Bt),u=r.parse(e[2],2,Bt);return i&&u?Za(i.type,[mn,xn,bt,ps,Bt])?new Tc(i,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${hr(i.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!i)return!1;if(!ms(r,["boolean","string","number","null"]))throw new Ar(`Expected first argument to be of type boolean, string, number or null, but found ${hr(_r(r))} instead.`);if(!ms(i,["string","array"]))throw new Ar(`Expected second argument to be of type array or string, but found ${hr(_r(i))} instead.`);return i.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class io{constructor(e,r,i){this.type=bt,this.needle=e,this.haystack=r,this.fromIndex=i}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=r.parse(e[1],1,Bt),u=r.parse(e[2],2,Bt);if(!i||!u)return null;if(!Za(i.type,[mn,xn,bt,ps,Bt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${hr(i.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,bt);return f?new io(i,u,f):null}return new io(i,u)}evaluate(e){const r=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!ms(r,["boolean","string","number","null"]))throw new Ar(`Expected first argument to be of type boolean, string, number or null, but found ${hr(_r(r))} instead.`);if(!ms(i,["string","array"]))throw new Ar(`Expected second argument to be of type array or string, but found ${hr(_r(i))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return i.indexOf(r,u)}return i.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ka{constructor(e,r,i,u,f,_){this.inputType=e,this.type=r,this.input=i,this.cases=u,this.outputs=f,this.otherwise=_}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let i,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const f={},_=[];for(let S=2;S<e.length-1;S+=2){let I=e[S];const A=e[S+1];Array.isArray(I)||(I=[I]);const z=r.concat(S);if(I.length===0)return z.error("Expected at least one branch label.");for(const V of I){if(typeof V!="number"&&typeof V!="string")return z.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return z.error("Numeric branch labels must be integer values.");if(i){if(z.checkSubtype(i,_r(V)))return null}else i=_r(V);if(f[String(V)]!==void 0)return z.error("Branch labels must be unique.");f[String(V)]=_.length}const N=r.parse(A,S,u);if(!N)return null;u=u||N.type,_.push(N)}const x=r.parse(e[1],1,Bt);if(!x)return null;const E=r.parse(e[e.length-1],e.length-1,u);return E?x.type.kind!=="value"&&r.concat(1).checkSubtype(i,x.type)?null:new Ka(i,u,x,f,_,E):null}evaluate(e){const r=this.input.evaluate(e);return(_r(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),i=[],u={};for(const _ of r){const x=u[this.cases[_]];x===void 0?(u[this.cases[_]]=i.length,i.push([this.cases[_],[_]])):i[x][1].push(_)}const f=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,x]of i)e.push(x.length===1?f(x[0]):x.map(f)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class Zo{constructor(e,r,i){this.type=e,this.branches=r,this.otherwise=i}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let i;r.expectedType&&r.expectedType.kind!=="value"&&(i=r.expectedType);const u=[];for(let _=1;_<e.length-1;_+=2){const x=r.parse(e[_],_,mn);if(!x)return null;const E=r.parse(e[_+1],_+1,i);if(!E)return null;u.push([x,E]),i=i||E.type}const f=r.parse(e[e.length-1],e.length-1,i);return f?new Zo(i,u,f):null}evaluate(e){for(const[r,i]of this.branches)if(r.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,i]of this.branches)e(r),e(i);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Ja{constructor(e,r,i,u){this.type=e,this.input=r,this.beginIndex=i,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=r.parse(e[1],1,Bt),u=r.parse(e[2],2,bt);if(!i||!u)return null;if(!Za(i.type,[ui(Bt),xn,Bt]))return r.error(`Expected first argument to be of type array or string, but found ${hr(i.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,bt);return f?new Ja(i.type,i,u,f):null}return new Ja(i.type,i,u)}evaluate(e){const r=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!ms(r,["string","array"]))throw new Ar(`Expected first argument to be of type array or string, but found ${hr(_r(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(i,u)}return r.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Sc(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ol(t,e,r,i){return i.compare(e,r)===0}function Ls(t,e,r){const i=t!=="=="&&t!=="!=";return class px{constructor(f,_,x){this.type=mn,this.lhs=f,this.rhs=_,this.collator=x,this.hasUntypedArgument=f.type.kind==="value"||_.type.kind==="value"}static parse(f,_){if(f.length!==3&&f.length!==4)return _.error("Expected two or three arguments.");const x=f[0];let E=_.parse(f[1],1,Bt);if(!E)return null;if(!Sc(x,E.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${hr(E.type)}'.`);let S=_.parse(f[2],2,Bt);if(!S)return null;if(!Sc(x,S.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${hr(S.type)}'.`);if(E.type.kind!==S.type.kind&&E.type.kind!=="value"&&S.type.kind!=="value")return _.error(`Cannot compare types '${hr(E.type)}' and '${hr(S.type)}'.`);i&&(E.type.kind==="value"&&S.type.kind!=="value"?E=new Xi(S.type,[E]):E.type.kind!=="value"&&S.type.kind==="value"&&(S=new Xi(E.type,[S])));let I=null;if(f.length===4){if(E.type.kind!=="string"&&S.type.kind!=="string"&&E.type.kind!=="value"&&S.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(I=_.parse(f[3],3,jo),!I)return null}return new px(E,S,I)}evaluate(f){const _=this.lhs.evaluate(f),x=this.rhs.evaluate(f);if(i&&this.hasUntypedArgument){const E=_r(_),S=_r(x);if(E.kind!==S.kind||E.kind!=="string"&&E.kind!=="number")throw new Ar(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${E.kind}, ${S.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const E=_r(_),S=_r(x);if(E.kind!=="string"||S.kind!=="string")return e(f,_,x)}return this.collator?r(f,_,x,this.collator.evaluate(f)):e(f,_,x)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[t];return this.eachChild(_=>{f.push(_.serialize())}),f}}}const xh=Ls("==",function(t,e,r){return e===r},Ol),Mc=Ls("!=",function(t,e,r){return e!==r},function(t,e,r,i){return!Ol(0,e,r,i)}),Cc=Ls("<",function(t,e,r){return e<r},function(t,e,r,i){return i.compare(e,r)<0}),bh=Ls(">",function(t,e,r){return e>r},function(t,e,r,i){return i.compare(e,r)>0}),Di=Ls("<=",function(t,e,r){return e<=r},function(t,e,r,i){return i.compare(e,r)<=0}),wh=Ls(">=",function(t,e,r){return e>=r},function(t,e,r,i){return i.compare(e,r)>=0});class Rs{constructor(e,r,i,u,f){this.type=xn,this.number=e,this.locale=r,this.currency=i,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const i=r.parse(e[1],1,bt);if(!i)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=r.parse(u.locale,1,xn),!f))return null;let _=null;if(u.currency&&(_=r.parse(u.currency,1,xn),!_))return null;let x=null;if(u["min-fraction-digits"]&&(x=r.parse(u["min-fraction-digits"],1,bt),!x))return null;let E=null;return u["max-fraction-digits"]&&(E=r.parse(u["max-fraction-digits"],1,bt),!E)?null:new Rs(i,f,_,x,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Bl{constructor(e){this.type=bt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=r.parse(e[1],1);return i?i.type.kind!=="array"&&i.type.kind!=="string"&&i.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${hr(i.type)} instead.`):new Bl(i):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Ar(`Expected value to be of type string or array, but found ${hr(_r(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const oo={"==":xh,"!=":Mc,">":bh,"<":Cc,">=":wh,"<=":Di,array:Xi,at:Ya,boolean:Xi,case:Zo,coalesce:So,collator:Sl,format:Hi,image:Vo,in:Tc,"index-of":io,interpolate:Ti,"interpolate-hcl":Ti,"interpolate-lab":Ti,length:Bl,let:Su,literal:Ei,match:Ka,number:Xi,"number-format":Rs,object:Xi,slice:Ja,step:Pl,string:Xi,"to-boolean":wr,"to-color":wr,"to-number":wr,"to-string":wr,var:vu,within:ua};function Mu(t,[e,r,i,u]){e=e.evaluate(t),r=r.evaluate(t),i=i.evaluate(t);const f=u?u.evaluate(t):1,_=fh(e,r,i,f);if(_)throw new Ar(_);return new In(e/255*f,r/255*f,i/255*f,f)}function Cu(t,e){return t in e}function da(t,e){const r=e[t];return r===void 0?null:r}function Os(t){return{type:t}}function fa(t){return{result:"success",value:t}}function Mo(t){return{result:"error",value:t}}function Go(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Pu(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Iu(t){return!!t.expression&&t.expression.interpolated}function kn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Qa(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Bs(t){return t}function Fl(t,e){const r=e.type==="color",i=t.stops&&typeof t.stops[0][0]=="object",u=i||!(i||t.property!==void 0),f=t.type||(Iu(e)?"exponential":"interval");if(r&&((t=tn({},t)).stops&&(t.stops=t.stops.map(S=>[S[0],In.parse(S[1])])),t.default=In.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Ec[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let _,x,E;if(f==="exponential")_=Pc;else if(f==="interval")_=dr;else if(f==="categorical"){_=Nl,x=Object.create(null);for(const S of t.stops)x[S[0]]=S[1];E=typeof t.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);_=Eh}if(i){const S={},I=[];for(let N=0;N<t.stops.length;N++){const V=t.stops[N],W=V[0].zoom;S[W]===void 0&&(S[W]={zoom:W,type:t.type,property:t.property,default:t.default,stops:[]},I.push(W)),S[W].stops.push([V[0].value,V[1]])}const A=[];for(const N of I)A.push([S[N].zoom,Fl(S[N],e)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Ti.interpolationFactor.bind(void 0,z),zoomStops:A.map(N=>N[0]),evaluate:({zoom:N},V)=>Pc({stops:A,base:t.base},e,N).evaluate(N,V)}}if(u){const S=f==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Ti.interpolationFactor.bind(void 0,S),zoomStops:t.stops.map(I=>I[0]),evaluate:({zoom:I})=>_(t,e,I,x,E)}}return{kind:"source",evaluate(S,I){const A=I&&I.properties?I.properties[t.property]:void 0;return A===void 0?Wr(t.default,e.default):_(t,e,A,x,E)}}}function Wr(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function Nl(t,e,r,i,u){return Wr(typeof r===u?i[r]:void 0,t.default,e.default)}function dr(t,e,r){if(kn(r)!=="number")return Wr(t.default,e.default);const i=t.stops.length;if(i===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];const u=Xa(t.stops.map(f=>f[0]),r);return t.stops[u][1]}function Pc(t,e,r){const i=t.base!==void 0?t.base:1;if(kn(r)!=="number")return Wr(t.default,e.default);const u=t.stops.length;if(u===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[u-1][0])return t.stops[u-1][1];const f=Xa(t.stops.map(I=>I[0]),r),_=function(I,A,z,N){const V=N-z,W=I-z;return V===0?0:A===1?W/V:(Math.pow(A,W)-1)/(Math.pow(A,V)-1)}(r,i,t.stops[f][0],t.stops[f+1][0]),x=t.stops[f][1],E=t.stops[f+1][1];let S=wu[e.type]||Bs;if(t.colorSpace&&t.colorSpace!=="rgb"){const I=Ec[t.colorSpace];S=(A,z)=>I.reverse(I.interpolate(I.forward(A),I.forward(z),_))}return typeof x.evaluate=="function"?{evaluate(...I){const A=x.evaluate.apply(void 0,I),z=E.evaluate.apply(void 0,I);if(A!==void 0&&z!==void 0)return S(A,z,_)}}:S(x,E,_)}function Eh(t,e,r){return e.type==="color"?r=In.parse(r):e.type==="formatted"?r=sn.fromString(r.toString()):e.type==="resolvedImage"?r=wi.fromString(r.toString()):kn(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Wr(r,t.default,e.default)}ei.register(oo,{error:[{kind:"error"},[xn],(t,[e])=>{throw new Ar(e.evaluate(t))}],typeof:[xn,[Bt],(t,[e])=>hr(_r(e.evaluate(t)))],"to-rgba":[ui(bt,4),[ro],(t,[e])=>e.evaluate(t).toArray()],rgb:[ro,[bt,bt,bt],Mu],rgba:[ro,[bt,bt,bt,bt],Mu],has:{type:mn,overloads:[[[xn],(t,[e])=>Cu(e.evaluate(t),t.properties())],[[xn,$a],(t,[e,r])=>Cu(e.evaluate(t),r.evaluate(t))]]},get:{type:Bt,overloads:[[[xn],(t,[e])=>da(e.evaluate(t),t.properties())],[[xn,$a],(t,[e,r])=>da(e.evaluate(t),r.evaluate(t))]]},"feature-state":[Bt,[xn],(t,[e])=>da(e.evaluate(t),t.featureState||{})],properties:[$a,[],t=>t.properties()],"geometry-type":[xn,[],t=>t.geometryType()],id:[Bt,[],t=>t.id()],zoom:[bt,[],t=>t.globals.zoom],pitch:[bt,[],t=>t.globals.pitch||0],"distance-from-center":[bt,[],t=>t.distanceFromCenter()],"heatmap-density":[bt,[],t=>t.globals.heatmapDensity||0],"line-progress":[bt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[bt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Bt,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[bt,Os(bt),(t,e)=>{let r=0;for(const i of e)r+=i.evaluate(t);return r}],"*":[bt,Os(bt),(t,e)=>{let r=1;for(const i of e)r*=i.evaluate(t);return r}],"-":{type:bt,overloads:[[[bt,bt],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[bt],(t,[e])=>-e.evaluate(t)]]},"/":[bt,[bt,bt],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[bt,[bt,bt],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[bt,[],()=>Math.LN2],pi:[bt,[],()=>Math.PI],e:[bt,[],()=>Math.E],"^":[bt,[bt,bt],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[bt,[bt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[bt,[bt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[bt,[bt],(t,[e])=>Math.log(e.evaluate(t))],log2:[bt,[bt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[bt,[bt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[bt,[bt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[bt,[bt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[bt,[bt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[bt,[bt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[bt,[bt],(t,[e])=>Math.atan(e.evaluate(t))],min:[bt,Os(bt),(t,e)=>Math.min(...e.map(r=>r.evaluate(t)))],max:[bt,Os(bt),(t,e)=>Math.max(...e.map(r=>r.evaluate(t)))],abs:[bt,[bt],(t,[e])=>Math.abs(e.evaluate(t))],round:[bt,[bt],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[bt,[bt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[bt,[bt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[mn,[xn,Bt],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[mn,[Bt],(t,[e])=>t.id()===e.value],"filter-type-==":[mn,[xn],(t,[e])=>t.geometryType()===e.value],"filter-<":[mn,[xn,Bt],(t,[e,r])=>{const i=t.properties()[e.value],u=r.value;return typeof i==typeof u&&i<u}],"filter-id-<":[mn,[Bt],(t,[e])=>{const r=t.id(),i=e.value;return typeof r==typeof i&&r<i}],"filter->":[mn,[xn,Bt],(t,[e,r])=>{const i=t.properties()[e.value],u=r.value;return typeof i==typeof u&&i>u}],"filter-id->":[mn,[Bt],(t,[e])=>{const r=t.id(),i=e.value;return typeof r==typeof i&&r>i}],"filter-<=":[mn,[xn,Bt],(t,[e,r])=>{const i=t.properties()[e.value],u=r.value;return typeof i==typeof u&&i<=u}],"filter-id-<=":[mn,[Bt],(t,[e])=>{const r=t.id(),i=e.value;return typeof r==typeof i&&r<=i}],"filter->=":[mn,[xn,Bt],(t,[e,r])=>{const i=t.properties()[e.value],u=r.value;return typeof i==typeof u&&i>=u}],"filter-id->=":[mn,[Bt],(t,[e])=>{const r=t.id(),i=e.value;return typeof r==typeof i&&r>=i}],"filter-has":[mn,[Bt],(t,[e])=>e.value in t.properties()],"filter-has-id":[mn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[mn,[ui(xn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[mn,[ui(Bt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[mn,[xn,ui(Bt)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[mn,[xn,ui(Bt)],(t,[e,r])=>function(i,u,f,_){for(;f<=_;){const x=f+_>>1;if(u[x]===i)return!0;u[x]>i?_=x-1:f=x+1}return!1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:mn,overloads:[[[mn,mn],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[Os(mn),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:mn,overloads:[[[mn,mn],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[Os(mn),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[mn,[mn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[mn,[xn],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[xn,[xn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[xn,[xn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[xn,Os(Bt),(t,e)=>e.map(r=>sa(r.evaluate(t))).join("")],"resolved-locale":[xn,[jo],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Au{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new yu,this._defaultValue=r?function(i){return i.type==="color"&&Qa(i.default)?new In(0,0,0,0):i.type==="color"?In.parse(i.default)||null:i.default===void 0?null:i.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,i,u,f,_,x,E){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=i,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,i,u,f,_,x,E){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=i||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ar(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function pa(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in oo}function el(t,e){const r=new xu(oo,[],e?function(u){const f={color:ro,string:xn,number:bt,enum:xn,boolean:mn,formatted:zs,resolvedImage:Tl};return u.type==="array"?ui(f[u.value]||Bt,u.length):f[u.type]}(e):void 0),i=r.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return i?fa(new Au(i,e)):Mo(r.errors)}class _s{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Cl(r.expression)}evaluateWithoutErrorHandling(e,r,i,u,f,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,i,u,f,_)}evaluate(e,r,i,u,f,_){return this._styleExpression.evaluate(e,r,i,u,f,_)}}class tl{constructor(e,r,i,u){this.kind=e,this.zoomStops=i,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Cl(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,i,u,f,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,i,u,f,_)}evaluate(e,r,i,u,f,_){return this._styleExpression.evaluate(e,r,i,u,f,_)}interpolationFactor(e,r,i){return this.interpolationType?Ti.interpolationFactor(this.interpolationType,e,r,i):0}}function ma(t,e){if((t=el(t,e)).result==="error")return t;const r=t.value.expression,i=Wa(r);if(!i&&!Go(e))return Mo([new ir("","data expressions not supported")]);const u=ca(r,["zoom","pitch","distance-from-center"]);if(!u&&!Pu(e))return Mo([new ir("","zoom expressions not supported")]);const f=_a(r);return f||u?f instanceof ir?Mo([f]):f instanceof Ti&&!Iu(e)?Mo([new ir("",'"interpolate" expressions cannot be used with this property')]):fa(f?new tl(i?"camera":"composite",t.value,f.labels,f instanceof Ti?f.interpolation:void 0):new _s(i?"constant":"source",t.value)):Mo([new ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ga{constructor(e,r){this._parameters=e,this._specification=r,tn(this,Fl(this._parameters,this._specification))}static deserialize(e){return new ga(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function _a(t){let e=null;if(t instanceof Su)e=_a(t.result);else if(t instanceof So){for(const r of t.args)if(e=_a(r),e)break}else(t instanceof Pl||t instanceof Ti)&&t.input instanceof ei&&t.input.name==="zoom"&&(e=t);return e instanceof ir||t.eachChild(r=>{const i=_a(r);i instanceof ir?e=i:!e&&i?e=new ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new ir("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Li(t){const e=t.key,r=t.value,i=t.valueSpec||{},u=t.objectElementValidators||{},f=t.style,_=t.styleSpec;let x=[];const E=kn(r);if(E!=="object")return[new ke(e,r,`object expected, ${E} found`)];for(const S in r){const I=S.split(".")[0],A=i[I]||i["*"];let z;if(u[I])z=u[I];else if(i[I])z=Fr;else if(u["*"])z=u["*"];else{if(!i["*"]){x.push(new ke(e,r[S],`unknown property "${S}"`));continue}z=Fr}x=x.concat(z({key:(e&&`${e}.`)+S,value:r[S],valueSpec:A,style:f,styleSpec:_,object:r,objectKey:S},r))}for(const S in i)u[S]||i[S].required&&i[S].default===void 0&&r[S]===void 0&&x.push(new ke(e,r,`missing required property "${S}"`));return x}function Ul(t){const e=t.value,r=t.valueSpec,i=t.style,u=t.styleSpec,f=t.key,_=t.arrayElementValidator||Fr;if(kn(e)!=="array")return[new ke(f,e,`array expected, ${kn(e)} found`)];if(r.length&&e.length!==r.length)return[new ke(f,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new ke(f,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let x={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum};u.$version<7&&(x.function=r.function),kn(r.value)==="object"&&(x=r.value);let E=[];for(let S=0;S<e.length;S++)E=E.concat(_({array:e,arrayIndex:S,value:e[S],valueSpec:x,style:i,styleSpec:u,key:`${f}[${S}]`}));return E}function Ic(t){const e=t.key,r=t.value,i=t.valueSpec;let u=kn(r);if(u==="number"&&r!=r&&(u="NaN"),u!=="number")return[new ke(e,r,`number expected, ${u} found`)];if("minimum"in i){let f=i.minimum;if(kn(i.minimum)==="array"&&(f=i.minimum[t.arrayIndex]),r<f)return[new ke(e,r,`${r} is less than the minimum value ${f}`)]}if("maximum"in i){let f=i.maximum;if(kn(i.maximum)==="array"&&(f=i.maximum[t.arrayIndex]),r>f)return[new ke(e,r,`${r} is greater than the maximum value ${f}`)]}return[]}function nl(t){const e=t.valueSpec,r=an(t.value.type);let i,u,f,_={};const x=r!=="categorical"&&t.value.property===void 0,E=!x,S=kn(t.value.stops)==="array"&&kn(t.value.stops[0])==="array"&&kn(t.value.stops[0][0])==="object",I=Li({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(N){if(r==="identity")return[new ke(N.key,N.value,'identity function may not have a "stops" property')];let V=[];const W=N.value;return V=V.concat(Ul({key:N.key,value:W,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:A})),kn(W)==="array"&&W.length===0&&V.push(new ke(N.key,W,"array must have at least one stop")),V},default:function(N){return Fr({key:N.key,value:N.value,valueSpec:e,style:N.style,styleSpec:N.styleSpec})}}});return r==="identity"&&x&&I.push(new ke(t.key,t.value,'missing required property "property"')),r==="identity"||t.value.stops||I.push(new ke(t.key,t.value,'missing required property "stops"')),r==="exponential"&&t.valueSpec.expression&&!Iu(t.valueSpec)&&I.push(new ke(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(E&&!Go(t.valueSpec)?I.push(new ke(t.key,t.value,"property functions not supported")):x&&!Pu(t.valueSpec)&&I.push(new ke(t.key,t.value,"zoom functions not supported"))),r!=="categorical"&&!S||t.value.property!==void 0||I.push(new ke(t.key,t.value,'"property" property is required')),I;function A(N){let V=[];const W=N.value,ee=N.key;if(kn(W)!=="array")return[new ke(ee,W,`array expected, ${kn(W)} found`)];if(W.length!==2)return[new ke(ee,W,`array length 2 expected, length ${W.length} found`)];if(S){if(kn(W[0])!=="object")return[new ke(ee,W,`object expected, ${kn(W[0])} found`)];if(W[0].zoom===void 0)return[new ke(ee,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new ke(ee,W,"object stop key must have value")];if(f&&f>an(W[0].zoom))return[new ke(ee,W[0].zoom,"stop zoom values must appear in ascending order")];an(W[0].zoom)!==f&&(f=an(W[0].zoom),u=void 0,_={}),V=V.concat(Li({key:`${ee}[0]`,value:W[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:Ic,value:z}}))}else V=V.concat(z({key:`${ee}[0]`,value:W[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},W));return pa(er(W[1]))?V.concat([new ke(`${ee}[1]`,W[1],"expressions are not allowed in function stops.")]):V.concat(Fr({key:`${ee}[1]`,value:W[1],valueSpec:e,style:N.style,styleSpec:N.styleSpec}))}function z(N,V){const W=kn(N.value),ee=an(N.value),ae=N.value!==null?N.value:V;if(i){if(W!==i)return[new ke(N.key,ae,`${W} stop domain type must match previous stop domain type ${i}`)]}else i=W;if(W!=="number"&&W!=="string"&&W!=="boolean")return[new ke(N.key,ae,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&r!=="categorical"){let ge=`number expected, ${W} found`;return Go(e)&&r===void 0&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(N.key,ae,ge)]}return r!=="categorical"||W!=="number"||isFinite(ee)&&Math.floor(ee)===ee?r!=="categorical"&&W==="number"&&u!==void 0&&ee<u?[new ke(N.key,ae,"stop domain values must appear in ascending order")]:(u=ee,r==="categorical"&&ee in _?[new ke(N.key,ae,"stop domain values must be unique")]:(_[ee]=!0,[])):[new ke(N.key,ae,`integer expected, found ${ee}`)]}}function qo(t){const e=(t.expressionContext==="property"?ma:el)(er(t.value),t.valueSpec);if(e.result==="error")return e.value.map(i=>new ke(`${t.key}${i.key}`,t.value,i.message));const r=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!r.outputDefined())return[new ke(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Cl(r))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return Ac(r,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ca(r,["zoom","feature-state"]))return[new ke(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Wa(r))return[new ke(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ac(t,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const u of e.valueSpec.expression.parameters)r.delete(u);if(r.size===0)return[];const i=[];return t instanceof ei&&r.has(t.name)?[new ke(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(u=>{i.push(...Ac(u,e))}),i)}function rl(t){const e=t.key,r=t.value,i=t.valueSpec,u=[];return Array.isArray(i.values)?i.values.indexOf(an(r))===-1&&u.push(new ke(e,r,`expected one of [${i.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(i.values).indexOf(an(r))===-1&&u.push(new ke(e,r,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function ys(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!ys(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function jl(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ys(t)||(t=Vl(t));const r=t;let i=!0;try{i=function(S){if(!vs(S))return S;let I=er(S);return Th(I),I=il(I),I}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const u=le[`filter_${e}`],f=el(i,u);let _=null;if(f.result==="error")throw new Error(f.value.map(S=>`${S.key}: ${S.message}`).join(", "));_=(S,I,A)=>f.value.evaluate(S,I,{},A);let x=null,E=null;if(i!==r){const S=el(r,u);if(S.result==="error")throw new Error(S.value.map(I=>`${I.key}: ${I.message}`).join(", "));x=(I,A,z,N,V)=>S.value.evaluate(I,A,{},z,void 0,void 0,N,V),E=!Wa(S.value.expression)}return _=_,{filter:_,dynamicFilter:x||void 0,needGeometry:Ns(i),needFeature:!!E}}function il(t){if(!Array.isArray(t))return t;const e=function(r){if(Fs.has(r[0])){for(let i=1;i<r.length;i++)if(vs(r[i]))return!0}return r}(t);return e===!0?e:e.map(r=>il(r))}function Th(t){let e=!1;const r=[];if(t[0]==="case"){for(let i=1;i<t.length-1;i+=2)e=e||vs(t[i]),r.push(t[i+1]);r.push(t[t.length-1])}else if(t[0]==="match"){e=e||vs(t[1]);for(let i=2;i<t.length-1;i+=2)r.push(t[i+1]);r.push(t[t.length-1])}else if(t[0]==="step"){e=e||vs(t[1]);for(let i=1;i<t.length-1;i+=2)r.push(t[i+1])}e&&(t.length=0,t.push("any",...r));for(let i=1;i<t.length;i++)Th(t[i])}function vs(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<t.length;r++)if(vs(t[r]))return!0;return!1}const Fs=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ku(t,e){return t<e?-1:t>e?1:0}function Ns(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(Ns(t[e]))return!0;return!1}function Vl(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?xs(t[1],t[2],"=="):e==="!="?va(xs(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?xs(t[1],t[2],e):e==="any"?(r=t.slice(1),["any"].concat(r.map(Vl))):e==="all"?["all"].concat(t.slice(1).map(Vl)):e==="none"?["all"].concat(t.slice(1).map(Vl).map(va)):e==="in"?ol(t[1],t.slice(2)):e==="!in"?va(ol(t[1],t.slice(2))):e==="has"?ya(t[1]):e==="!has"?va(ya(t[1])):e!=="within"||t;var r}function xs(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function ol(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",t,["literal",e.sort(ku)]]:["filter-in-small",t,["literal",e]]}}function ya(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function va(t){return["!",t]}function zu(t){if(ys(er(t.value))){const e=er(t.layerType);return qo(tn({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${e||"fill"}`]}))}return Du(t)}function Du(t){const e=t.value,r=t.key;if(kn(e)!=="array")return[new ke(r,e,`array expected, ${kn(e)} found`)];const i=t.styleSpec;let u,f=[];if(e.length<1)return[new ke(r,e,"filter array must have at least 1 element")];switch(f=f.concat(rl({key:`${r}[0]`,value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),an(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&an(e[1])==="$type"&&f.push(new ke(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new ke(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=kn(e[1]),u!=="string"&&f.push(new ke(`${r}[1]`,e[1],`string expected, ${u} found`)));for(let _=2;_<e.length;_++)u=kn(e[_]),an(e[1])==="$type"?f=f.concat(rl({key:`${r}[${_}]`,value:e[_],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new ke(`${r}[${_}]`,e[_],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)f=f.concat(Du({key:`${r}[${_}]`,value:e[_],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":u=kn(e[1]),e.length!==2?f.push(new ke(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new ke(`${r}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=kn(e[1]),e.length!==2?f.push(new ke(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&f.push(new ke(`${r}[1]`,e[1],`object expected, ${u} found`))}return f}function Wo(t,e){const r=t.key,i=t.style,u=t.styleSpec,f=t.value,_=t.objectKey,x=u[`${e}_${t.layerType}`];if(!x)return[];const E=_.match(/^(.*)-transition$/);if(e==="paint"&&E&&x[E[1]]&&x[E[1]].transition)return Fr({key:r,value:f,valueSpec:u.transition,style:i,styleSpec:u});const S=t.valueSpec||x[_];if(!S)return[new ke(r,f,`unknown property "${_}"`)];let I;if(kn(f)==="string"&&Go(S)&&!S.tokens&&(I=/^{([^}]+)}$/.exec(f)))return[new ke(r,f,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const A=[];return t.layerType==="symbol"&&(_==="text-field"&&i&&!i.glyphs&&A.push(new ke(r,f,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Qa(er(f))&&an(f.type)==="identity"&&A.push(new ke(r,f,'"text-font" does not support identity functions'))),A.concat(Fr({key:t.key,value:f,valueSpec:S,style:i,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:_}))}function bs(t){return Wo(t,"paint")}function lr(t){return Wo(t,"layout")}function ur(t){let e=[];const r=t.value,i=t.key,u=t.style,f=t.styleSpec;r.type||r.ref||e.push(new ke(i,r,'either "type" or "ref" is required'));let _=an(r.type);const x=an(r.ref);if(r.id){const E=an(r.id);for(let S=0;S<t.arrayIndex;S++){const I=u.layers[S];an(I.id)===E&&e.push(new ke(i,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let E;["type","source","source-layer","filter","layout"].forEach(S=>{S in r&&e.push(new ke(i,r[S],`"${S}" is prohibited for ref layers`))}),u.layers.forEach(S=>{an(S.id)===x&&(E=S)}),E?E.ref?e.push(new ke(i,r.ref,"ref cannot reference another ref layer")):_=an(E.type):e.push(new ke(i,r.ref,`ref layer "${x}" not found`))}else if(_!=="background"&&_!=="sky")if(r.source){const E=u.sources&&u.sources[r.source],S=E&&an(E.type);E?S==="vector"&&_==="raster"?e.push(new ke(i,r.source,`layer "${r.id}" requires a raster source`)):S==="raster"&&_!=="raster"?e.push(new ke(i,r.source,`layer "${r.id}" requires a vector source`)):S!=="vector"||r["source-layer"]?S==="raster-dem"&&_!=="hillshade"?e.push(new ke(i,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||S==="geojson"&&E.lineMetrics||e.push(new ke(i,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ke(i,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new ke(i,r.source,`source "${r.source}" not found`))}else e.push(new ke(i,r,'missing required property "source"'));return e=e.concat(Li({key:i,value:r,valueSpec:f.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fr({key:`${i}.type`,value:r.type,valueSpec:f.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:E=>zu(tn({layerType:_},E)),layout:E=>Li({layer:r,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":S=>lr(tn({layerType:_},S))}}),paint:E=>Li({layer:r,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":S=>bs(tn({layerType:_},S))}})}})),e}function Yi(t){const e=t.value,r=t.key,i=kn(e);return i!=="string"?[new ke(r,e,`string expected, ${i} found`)]:[]}const Xr={promoteId:function({key:t,value:e}){if(kn(e)==="string")return Yi({key:t,value:e});{const r=[];for(const i in e)r.push(...Yi({key:`${t}.${i}`,value:e[i]}));return r}}};function Si(t){const e=t.value,r=t.key,i=t.styleSpec,u=t.style;if(!e.type)return[new ke(r,e,'"type" is required')];const f=an(e.type);let _;switch(f){case"vector":case"raster":case"raster-dem":return _=Li({key:r,value:e,valueSpec:i[`source_${f.replace("-","_")}`],style:t.style,styleSpec:i,objectElementValidators:Xr}),_;case"geojson":if(_=Li({key:r,value:e,valueSpec:i.source_geojson,style:u,styleSpec:i,objectElementValidators:Xr}),e.cluster)for(const x in e.clusterProperties){const[E,S]=e.clusterProperties[x],I=typeof E=="string"?[E,["accumulated"],["get",x]]:E;_.push(...qo({key:`${r}.${x}.map`,value:S,expressionContext:"cluster-map"})),_.push(...qo({key:`${r}.${x}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return _;case"video":return Li({key:r,value:e,valueSpec:i.source_video,style:u,styleSpec:i});case"image":return Li({key:r,value:e,valueSpec:i.source_image,style:u,styleSpec:i});case"canvas":return[new ke(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rl({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:i})}}function ws(t){const e=t.value,r=t.styleSpec,i=r.light,u=t.style;let f=[];const _=kn(e);if(e===void 0)return f;if(_!=="object")return f=f.concat([new ke("light",e,`object expected, ${_} found`)]),f;for(const x in e){const E=x.match(/^(.*)-transition$/);f=f.concat(E&&i[E[1]]&&i[E[1]].transition?Fr({key:x,value:e[x],valueSpec:r.transition,style:u,styleSpec:r}):i[x]?Fr({key:x,value:e[x],valueSpec:i[x],style:u,styleSpec:r}):[new ke(x,e[x],`unknown property "${x}"`)])}return f}function Us(t){const e=t.value,r=t.key,i=t.style,u=t.styleSpec,f=u.terrain;let _=[];const x=kn(e);if(e===void 0)return _;if(x!=="object")return _=_.concat([new ke("terrain",e,`object expected, ${x} found`)]),_;for(const E in e){const S=E.match(/^(.*)-transition$/);_=_.concat(S&&f[S[1]]&&f[S[1]].transition?Fr({key:E,value:e[E],valueSpec:u.transition,style:i,styleSpec:u}):f[E]?Fr({key:E,value:e[E],valueSpec:f[E],style:i,styleSpec:u}):[new ke(E,e[E],`unknown property "${E}"`)])}if(e.source){const E=i.sources&&i.sources[e.source],S=E&&an(E.type);E?S!=="raster-dem"&&_.push(new ke(r,e.source,`terrain cannot be used with a source of type ${S}, it only be used with a "raster-dem" source type`)):_.push(new ke(r,e.source,`source "${e.source}" not found`))}else _.push(new ke(r,e,'terrain is missing required property "source"'));return _}function ci(t){const e=t.value,r=t.style,i=t.styleSpec,u=i.fog;let f=[];const _=kn(e);if(e===void 0)return f;if(_!=="object")return f=f.concat([new ke("fog",e,`object expected, ${_} found`)]),f;for(const x in e){const E=x.match(/^(.*)-transition$/);f=f.concat(E&&u[E[1]]&&u[E[1]].transition?Fr({key:x,value:e[x],valueSpec:i.transition,style:r,styleSpec:i}):u[x]?Fr({key:x,value:e[x],valueSpec:u[x],style:r,styleSpec:i}):[new ke(x,e[x],`unknown property "${x}"`)])}return f}const sl={"*":()=>[],array:Ul,boolean:function(t){const e=t.value,r=t.key,i=kn(e);return i!=="boolean"?[new ke(r,e,`boolean expected, ${i} found`)]:[]},number:Ic,color:function(t){const e=t.key,r=t.value,i=kn(r);return i!=="string"?[new ke(e,r,`color expected, ${i} found`)]:Ga.parseCSSColor(r)===null?[new ke(e,r,`color expected, "${r}" found`)]:[]},constants:kt,enum:rl,filter:zu,function:nl,layer:ur,object:Li,source:Si,light:ws,terrain:Us,fog:ci,string:Yi,formatted:function(t){return Yi(t).length===0?[]:qo(t)},resolvedImage:function(t){return Yi(t).length===0?[]:qo(t)},projection:function(t){const e=t.value,r=t.styleSpec,i=r.projection,u=t.style;let f=[];const _=kn(e);if(_==="object")for(const x in e)f=f.concat(Fr({key:x,value:e[x],valueSpec:i[x],style:u,styleSpec:r}));else _!=="string"&&(f=f.concat([new ke("projection",e,`object or string expected, ${_} found`)]));return f}};function Fr(t){const e=t.value,r=t.valueSpec,i=t.styleSpec;return r.expression&&Qa(an(e))?nl(t):r.expression&&pa(er(e))?qo(t):r.type&&sl[r.type]?sl[r.type](t):Li(tn({},t,{valueSpec:r.type?i[r.type]:r}))}function Lu(t){const e=t.value,r=t.key,i=Yi(t);return i.length||(e.indexOf("{fontstack}")===-1&&i.push(new ke(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&i.push(new ke(r,e,'"glyphs" url must include a "{range}" token'))),i}function so(t,e=le){let r=[];return r=r.concat(Fr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Lu,"*":()=>[]}})),t.constants&&(r=r.concat(kt({key:"constants",value:t.constants,style:t,styleSpec:e}))),kc(r)}function kc(t){return[].concat(t).sort((e,r)=>e.line-r.line)}function Ki(t){return function(...e){return kc(t.apply(this,e))}}so.source=Ki(Si),so.light=Ki(ws),so.terrain=Ki(Us),so.fog=Ki(ci),so.layer=Ki(ur),so.filter=Ki(zu),so.paintProperty=Ki(bs),so.layoutProperty=Ki(lr);const ao=so,al=ao.light,zc=ao.fog,$l=ao.paintProperty,bd=ao.layoutProperty;function Dc(t,e){let r=!1;if(e&&e.length)for(const i of e)t.fire(new ie(new Error(i.message))),r=!0;return r}var xa=Mi;function Mi(t,e,r){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(r=u[2]);for(var f=0;f<this.d*this.d;f++){var _=u[3+f],x=u[3+f+1];i.push(_===x?null:u.subarray(_,x))}var E=u[3+i.length+1];this.keys=u.subarray(u[3+i.length],E),this.bboxes=u.subarray(E),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var S=0;S<this.d*this.d;S++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var I=r/e*t;this.min=-I,this.max=t+I}Mi.prototype.insert=function(t,e,r,i,u){this._forEachCell(e,r,i,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(u)},Mi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Mi.prototype._insertCell=function(t,e,r,i,u,f){this.cells[u].push(f)},Mi.prototype.query=function(t,e,r,i,u){var f=this.min,_=this.max;if(t<=f&&e<=f&&_<=r&&_<=i&&!u)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(t,e,r,i,this._queryCell,x,{},u),x},Mi.prototype._queryCell=function(t,e,r,i,u,f,_,x){var E=this.cells[u];if(E!==null)for(var S=this.keys,I=this.bboxes,A=0;A<E.length;A++){var z=E[A];if(_[z]===void 0){var N=4*z;(x?x(I[N+0],I[N+1],I[N+2],I[N+3]):t<=I[N+2]&&e<=I[N+3]&&r>=I[N+0]&&i>=I[N+1])?(_[z]=!0,f.push(S[z])):_[z]=!1}}},Mi.prototype._forEachCell=function(t,e,r,i,u,f,_,x){for(var E=this._convertToCellCoord(t),S=this._convertToCellCoord(e),I=this._convertToCellCoord(r),A=this._convertToCellCoord(i),z=E;z<=I;z++)for(var N=S;N<=A;N++){var V=this.d*N+z;if((!x||x(this._convertFromCellCoord(z),this._convertFromCellCoord(N),this._convertFromCellCoord(z+1),this._convertFromCellCoord(N+1)))&&u.call(this,t,e,r,i,V,f,_,x))return}},Mi.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Mi.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Mi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,r=0,i=0;i<this.cells.length;i++)r+=this.cells[i].length;var u=new Int32Array(e+r+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,_=0;_<t.length;_++){var x=t[_];u[3+_]=f,u.set(x,f),f+=x.length}return u[3+t.length]=f,u.set(this.keys,f),u[3+t.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};const{ImageData:js,ImageBitmap:ba}=H,ll={};function Tt(t,e,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),ll[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Tt("Object",Object),xa.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},xa.deserialize=function(t){return new xa(t.buffer)},Tt("Grid",xa),Tt("Color",In),Tt("Error",Error),Tt("ResolvedImage",wi),Tt("StylePropertyFunction",ga),Tt("StyleExpression",Au,{omit:["_evaluator"]}),Tt("ZoomDependentExpression",tl),Tt("ZoomConstantExpression",_s),Tt("CompoundExpression",ei,{omit:["_evaluate"]});for(const t in oo)oo[t]._classRegistryKey||Tt(`Expression_${t}`,oo[t]);function wa(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Ru(t){return ba&&t instanceof ba}function Zl(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(wa(t)||Ru(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.push(r.buffer),r}if(t instanceof js)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const i of t)r.push(Zl(i,e));return r}if(typeof t=="object"){const r=t.constructor,i=r._classRegistryKey;if(!i)throw new Error("can't serialize object of unregistered class");const u=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const f in t){if(!t.hasOwnProperty(f)||ll[i].omit.indexOf(f)>=0)continue;const _=t[f];u[f]=ll[i].shallow.indexOf(f)>=0?_:Zl(_,e)}t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(u.$name=i),u}throw new Error("can't serialize object of type "+typeof t)}function hi(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||wa(t)||Ru(t)||ArrayBuffer.isView(t)||t instanceof js)return t;if(Array.isArray(t))return t.map(hi);if(typeof t=="object"){const e=t.$name||"Object",{klass:r}=ll[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const i=Object.create(r.prototype);for(const u of Object.keys(t)){if(u==="$name")continue;const f=t[u];i[u]=ll[e].shallow.indexOf(u)>=0?f:hi(f)}return i}throw new Error("can't deserialize object of type "+typeof t)}class p{constructor(){this.first=!0}update(e,r){const i=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=i,!0))}}const n=t=>t>=1536&&t<=1791,l=t=>t>=1872&&t<=1919,m=t=>t>=2208&&t<=2303,v=t=>t>=11904&&t<=12031,b=t=>t>=12032&&t<=12255,T=t=>t>=12272&&t<=12287,P=t=>t>=12288&&t<=12351,D=t=>t>=12352&&t<=12447,O=t=>t>=12448&&t<=12543,B=t=>t>=12544&&t<=12591,U=t=>t>=12704&&t<=12735,q=t=>t>=12736&&t<=12783,Q=t=>t>=12784&&t<=12799,K=t=>t>=12800&&t<=13055,te=t=>t>=13056&&t<=13311,_e=t=>t>=13312&&t<=19903,J=t=>t>=19968&&t<=40959,me=t=>t>=40960&&t<=42127,pe=t=>t>=42128&&t<=42191,he=t=>t>=44032&&t<=55215,fe=t=>t>=63744&&t<=64255,ye=t=>t>=64336&&t<=65023,Le=t=>t>=65040&&t<=65055,Ue=t=>t>=65072&&t<=65103,ht=t=>t>=65104&&t<=65135,ot=t=>t>=65136&&t<=65279,nt=t=>t>=65280&&t<=65519;function qe(t){for(const e of t)if(Ye(e.charCodeAt(0)))return!0;return!1}function Ne(t){for(const e of t)if(!tt(e.charCodeAt(0)))return!1;return!0}function tt(t){return!(n(t)||l(t)||m(t)||ye(t)||ot(t))}function Ye(t){return!(t!==746&&t!==747&&(t<4352||!(U(t)||B(t)||Ue(t)&&!(t>=65097&&t<=65103)||fe(t)||te(t)||v(t)||q(t)||!(!P(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||_e(t)||J(t)||K(t)||(e=>e>=12592&&e<=12687)(t)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||he(t)||D(t)||T(t)||(e=>e>=12688&&e<=12703)(t)||b(t)||Q(t)||O(t)&&t!==12540||!(!nt(t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!ht(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||Le(t)||(e=>e>=19904&&e<=19967)(t)||me(t)||pe(t))))}function Rt(t){return!(Ye(t)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||P(e)||O(e)||(r=>r>=57344&&r<=63743)(e)||Ue(e)||ht(e)||nt(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Gt(t){return t>=1424&&t<=2303||ye(t)||ot(t)}function ln(t,e){return!(!e&&Gt(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(r=>r>=6016&&r<=6143)(t))}function ft(t){for(const e of t)if(Gt(e.charCodeAt(0)))return!0;return!1}const Ft="deferred",Kt="loading",zn="loaded";let Wn=null,Xt="unavailable",gn=null;const Xn=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Xt="error"),Wn&&Wn(t)};function Jn(){Hr.fire(new X("pluginStateChange",{pluginStatus:Xt,pluginURL:gn}))}const Hr=new xe,di=function(){return Xt},ti=function(){if(Xt!==Ft||!gn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Xt=Kt,Jn(),gn&&Zi({url:gn},t=>{t?Xn(t):(Xt=zn,Jn())})},Tn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Xt===zn||Tn.applyArabicShaping!=null,isLoading:()=>Xt===Kt,setState(t){Xt=t.pluginStatus,gn=t.pluginURL},isParsed:()=>Tn.applyArabicShaping!=null&&Tn.processBidirectionalText!=null&&Tn.processStyledBidirectionalText!=null,getPluginURL:()=>gn};class Ht{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new p,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,i){for(const u of r)if(!ln(u.charCodeAt(0),i))return!1;return!0}(e,Tn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),i=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*r}}}class bn{constructor(e,r){this.property=e,this.value=r,this.expression=function(i,u){if(Qa(i))return new ga(i,u);if(pa(i)){const f=ma(i,u);if(f.result==="error")throw new Error(f.value.map(_=>`${_.key}: ${_.message}`).join(", "));return f.value}{let f=i;return typeof i=="string"&&u.type==="color"&&(f=In.parse(i)),{kind:"constant",evaluate:()=>f}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,i){return this.property.possiblyEvaluate(this,e,r,i)}}class fr{constructor(e){this.property=e,this.value=new bn(e,void 0)}transitioned(e,r){return new Hn(this.property,this.value,r,qn({},e.transition,this.transition),e.now)}untransitioned(){return new Hn(this.property,this.value,null,{},0)}}class Bn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Zr(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new fr(this._values[e].property)),this._values[e].value=new bn(this._values[e].property,r===null?void 0:Zr(r))}getTransition(e){return Zr(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new fr(this._values[e].property)),this._values[e].transition=Zr(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const i=this.getValue(r);i!==void 0&&(e[r]=i);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const i=new Mr(this._properties);for(const u of Object.keys(this._values))i._values[u]=this._values[u].transitioned(e,r._values[u]);return i}untransitioned(){const e=new Mr(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Hn{constructor(e,r,i,u,f){const _=u.delay||0,x=u.duration||0;f=f||0,this.property=e,this.value=r,this.begin=f+_,this.end=this.begin+x,e.specification.transition&&(u.delay||u.duration)&&(this.prior=i)}possiblyEvaluate(e,r,i){const u=e.now||0,f=this.value.possiblyEvaluate(e,r,i),_=this.prior;if(_){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return _.possiblyEvaluate(e,r,i);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,r,i),f,Oo(x))}}return f}}class Mr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,i){const u=new Vs(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,r,i);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class lo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Zr(this._values[e].value)}setValue(e,r){this._values[e]=new bn(this._values[e].property,r===null?void 0:Zr(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const i=this.getValue(r);i!==void 0&&(e[r]=i)}return e}possiblyEvaluate(e,r,i){const u=new Vs(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,r,i);return u}}class yr{constructor(e,r,i){this.property=e,this.value=r,this.parameters=i}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,i,u){return this.property.evaluate(this.value,this.parameters,e,r,i,u)}}class Vs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ct{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,i){const u=wu[this.specification.type];return u?u(e,r,i):e}}class jt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,i,u){return new yr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},i,u)}:e.expression,r)}interpolate(e,r,i){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new yr(this,{kind:"constant",value:void 0},e.parameters);const u=wu[this.specification.type];return u?new yr(this,{kind:"constant",value:u(e.value.value,r.value.value,i)},e.parameters):e}evaluate(e,r,i,u,f,_){return e.kind==="constant"?e.value:e.evaluate(r,i,u,f,_)}}class Nr extends jt{possiblyEvaluate(e,r,i,u){if(e.value===void 0)return new yr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},i,u),_=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,x=this._calculate(_,_,_,r);return new yr(this,{kind:"constant",value:x},r)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new yr(this,{kind:"constant",value:f},r)}return new yr(this,e.expression,r)}evaluate(e,r,i,u,f,_){if(e.kind==="source"){const x=e.evaluate(r,i,u,f,_);return this._calculate(x,x,x,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},i,u),e.evaluate({zoom:Math.floor(r.zoom)},i,u),e.evaluate({zoom:Math.floor(r.zoom)+1},i,u),r):e.value}_calculate(e,r,i,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r,other:i}:{from:i,to:r,other:e}}interpolate(e){return e}}class Xo{constructor(e){this.specification=e}possiblyEvaluate(e,r,i,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},i,u);return this._calculate(f,f,f,r)}return this._calculate(e.expression.evaluate(new Ht(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Ht(Math.floor(r.zoom),r)),e.expression.evaluate(new Ht(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,i,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:i,to:r}}interpolate(e){return e}}class Ho{constructor(e){this.specification=e}possiblyEvaluate(e,r,i,u){return!!e.expression.evaluate(r,null,{},i,u)}interpolate(){return!1}}class Er{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const i=e[r];i.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new bn(i,void 0),f=this.defaultTransitionablePropertyValues[r]=new fr(i);this.defaultTransitioningPropertyValues[r]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}function Sh(t,e){return 256*(t=rn(Math.floor(t),0,255))+rn(Math.floor(e),0,255)}Tt("DataDrivenProperty",jt),Tt("DataConstantProperty",Ct),Tt("CrossFadedDataDrivenProperty",Nr),Tt("CrossFadedProperty",Xo),Tt("ColorRampProperty",Ho);const Lc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ri{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class pr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function un(t,e=1){let r=0,i=0;return{members:t.map(u=>{const f=Lc[u.type].BYTES_PER_ELEMENT,_=r=Ci(r,Math.max(e,f)),x=u.components||1;return i=Math.max(i,f),r+=f*x,{name:u.name,type:u.type,components:x,offset:_}}),size:Ci(r,Math.max(i,e)),alignment:e}}function Ci(t,e){return Math.ceil(t/e)*e}class kr extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,r)}emplace(e,r,i){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=i,e}}kr.prototype.bytesPerElement=4,Tt("StructArrayLayout2i4",kr);class Ea extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,i,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,i,u)}emplace(e,r,i,u,f){const _=4*e;return this.int16[_+0]=r,this.int16[_+1]=i,this.int16[_+2]=u,this.int16[_+3]=f,e}}Ea.prototype.bytesPerElement=8,Tt("StructArrayLayout4i8",Ea);class Gl extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,i,u,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,i,u,f,_,x)}emplace(e,r,i,u,f,_,x,E){const S=6*e,I=12*e,A=3*e;return this.int16[S+0]=r,this.int16[S+1]=i,this.uint8[I+4]=u,this.uint8[I+5]=f,this.uint8[I+6]=_,this.uint8[I+7]=x,this.float32[A+2]=E,e}}Gl.prototype.bytesPerElement=12,Tt("StructArrayLayout2i4ub1f12",Gl);class ni extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,i){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,i)}emplace(e,r,i,u){const f=3*e;return this.float32[f+0]=r,this.float32[f+1]=i,this.float32[f+2]=u,e}}ni.prototype.bytesPerElement=12,Tt("StructArrayLayout3f12",ni);class $s extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,i,u,f,_,x,E,S,I){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,i,u,f,_,x,E,S,I)}emplace(e,r,i,u,f,_,x,E,S,I,A){const z=10*e;return this.uint16[z+0]=r,this.uint16[z+1]=i,this.uint16[z+2]=u,this.uint16[z+3]=f,this.uint16[z+4]=_,this.uint16[z+5]=x,this.uint16[z+6]=E,this.uint16[z+7]=S,this.uint16[z+8]=I,this.uint16[z+9]=A,e}}$s.prototype.bytesPerElement=20,Tt("StructArrayLayout10ui20",$s);class Ou extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,i,u,f,_,x,E){const S=this.length;return this.resize(S+1),this.emplace(S,e,r,i,u,f,_,x,E)}emplace(e,r,i,u,f,_,x,E,S){const I=8*e;return this.uint16[I+0]=r,this.uint16[I+1]=i,this.uint16[I+2]=u,this.uint16[I+3]=f,this.uint16[I+4]=_,this.uint16[I+5]=x,this.uint16[I+6]=E,this.uint16[I+7]=S,e}}Ou.prototype.bytesPerElement=16,Tt("StructArrayLayout8ui16",Ou);class Ta extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,i,u,f,_,x,E,S,I,A,z,N,V,W,ee){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,r,i,u,f,_,x,E,S,I,A,z,N,V,W,ee)}emplace(e,r,i,u,f,_,x,E,S,I,A,z,N,V,W,ee,ae){const ge=16*e;return this.int16[ge+0]=r,this.int16[ge+1]=i,this.int16[ge+2]=u,this.int16[ge+3]=f,this.uint16[ge+4]=_,this.uint16[ge+5]=x,this.uint16[ge+6]=E,this.uint16[ge+7]=S,this.int16[ge+8]=I,this.int16[ge+9]=A,this.int16[ge+10]=z,this.int16[ge+11]=N,this.int16[ge+12]=V,this.int16[ge+13]=W,this.int16[ge+14]=ee,this.int16[ge+15]=ae,e}}Ta.prototype.bytesPerElement=32,Tt("StructArrayLayout4i4ui4i4i32",Ta);class Sa extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Sa.prototype.bytesPerElement=4,Tt("StructArrayLayout1ul4",Sa);class Yo extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,i,u,f,_,x,E,S,I,A,z,N){const V=this.length;return this.resize(V+1),this.emplace(V,e,r,i,u,f,_,x,E,S,I,A,z,N)}emplace(e,r,i,u,f,_,x,E,S,I,A,z,N,V){const W=20*e,ee=10*e;return this.int16[W+0]=r,this.int16[W+1]=i,this.int16[W+2]=u,this.int16[W+3]=f,this.int16[W+4]=_,this.float32[ee+3]=x,this.float32[ee+4]=E,this.float32[ee+5]=S,this.float32[ee+6]=I,this.int16[W+14]=A,this.uint32[ee+8]=z,this.uint16[W+18]=N,this.uint16[W+19]=V,e}}Yo.prototype.bytesPerElement=40,Tt("StructArrayLayout5i4f1i1ul2ui40",Yo);class ul extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,i,u,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,i,u,f,_,x)}emplace(e,r,i,u,f,_,x,E){const S=8*e;return this.int16[S+0]=r,this.int16[S+1]=i,this.int16[S+2]=u,this.int16[S+4]=f,this.int16[S+5]=_,this.int16[S+6]=x,this.int16[S+7]=E,e}}ul.prototype.bytesPerElement=16,Tt("StructArrayLayout3i2i2i16",ul);class ql extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,i,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,i,u,f)}emplace(e,r,i,u,f,_){const x=4*e,E=8*e;return this.float32[x+0]=r,this.float32[x+1]=i,this.float32[x+2]=u,this.int16[E+6]=f,this.int16[E+7]=_,e}}ql.prototype.bytesPerElement=16,Tt("StructArrayLayout2f1f2i16",ql);class Mh extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,i,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,i,u)}emplace(e,r,i,u,f){const _=12*e,x=3*e;return this.uint8[_+0]=r,this.uint8[_+1]=i,this.float32[x+1]=u,this.float32[x+2]=f,e}}Mh.prototype.bytesPerElement=12,Tt("StructArrayLayout2ub2f12",Mh);class uo extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,i){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,i)}emplace(e,r,i,u){const f=3*e;return this.uint16[f+0]=r,this.uint16[f+1]=i,this.uint16[f+2]=u,e}}uo.prototype.bytesPerElement=6,Tt("StructArrayLayout3ui6",uo);class Ch extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,i,u,f,_,x,E,S,I,A,z,N,V,W,ee,ae,ge,be,Se,Ae){const ze=this.length;return this.resize(ze+1),this.emplace(ze,e,r,i,u,f,_,x,E,S,I,A,z,N,V,W,ee,ae,ge,be,Se,Ae)}emplace(e,r,i,u,f,_,x,E,S,I,A,z,N,V,W,ee,ae,ge,be,Se,Ae,ze){const Qe=30*e,Ke=15*e,yt=60*e;return this.int16[Qe+0]=r,this.int16[Qe+1]=i,this.int16[Qe+2]=u,this.float32[Ke+2]=f,this.float32[Ke+3]=_,this.uint16[Qe+8]=x,this.uint16[Qe+9]=E,this.uint32[Ke+5]=S,this.uint32[Ke+6]=I,this.uint32[Ke+7]=A,this.uint16[Qe+16]=z,this.uint16[Qe+17]=N,this.uint16[Qe+18]=V,this.float32[Ke+10]=W,this.float32[Ke+11]=ee,this.uint8[yt+48]=ae,this.uint8[yt+49]=ge,this.uint8[yt+50]=be,this.uint32[Ke+13]=Se,this.int16[Qe+28]=Ae,this.uint8[yt+58]=ze,e}}Ch.prototype.bytesPerElement=60,Tt("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Ch);class Wl extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,i,u,f,_,x,E,S,I,A,z,N,V,W,ee,ae,ge,be,Se,Ae,ze,Qe,Ke,yt,pt,Je,mt,vt,rt){const St=this.length;return this.resize(St+1),this.emplace(St,e,r,i,u,f,_,x,E,S,I,A,z,N,V,W,ee,ae,ge,be,Se,Ae,ze,Qe,Ke,yt,pt,Je,mt,vt,rt)}emplace(e,r,i,u,f,_,x,E,S,I,A,z,N,V,W,ee,ae,ge,be,Se,Ae,ze,Qe,Ke,yt,pt,Je,mt,vt,rt,St){const Dt=38*e,An=19*e;return this.int16[Dt+0]=r,this.int16[Dt+1]=i,this.int16[Dt+2]=u,this.float32[An+2]=f,this.float32[An+3]=_,this.int16[Dt+8]=x,this.int16[Dt+9]=E,this.int16[Dt+10]=S,this.int16[Dt+11]=I,this.int16[Dt+12]=A,this.int16[Dt+13]=z,this.uint16[Dt+14]=N,this.uint16[Dt+15]=V,this.uint16[Dt+16]=W,this.uint16[Dt+17]=ee,this.uint16[Dt+18]=ae,this.uint16[Dt+19]=ge,this.uint16[Dt+20]=be,this.uint16[Dt+21]=Se,this.uint16[Dt+22]=Ae,this.uint16[Dt+23]=ze,this.uint16[Dt+24]=Qe,this.uint16[Dt+25]=Ke,this.uint16[Dt+26]=yt,this.uint16[Dt+27]=pt,this.uint16[Dt+28]=Je,this.uint32[An+15]=mt,this.float32[An+16]=vt,this.float32[An+17]=rt,this.float32[An+18]=St,e}}Wl.prototype.bytesPerElement=76,Tt("StructArrayLayout3i2f6i15ui1ul3f76",Wl);class Xl extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Xl.prototype.bytesPerElement=4,Tt("StructArrayLayout1f4",Xl);class Ph extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,i){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,i)}emplace(e,r,i,u){const f=3*e;return this.int16[f+0]=r,this.int16[f+1]=i,this.int16[f+2]=u,e}}Ph.prototype.bytesPerElement=6,Tt("StructArrayLayout3i6",Ph);class cl extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,i,u,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,i,u,f,_,x)}emplace(e,r,i,u,f,_,x,E){const S=7*e;return this.float32[S+0]=r,this.float32[S+1]=i,this.float32[S+2]=u,this.float32[S+3]=f,this.float32[S+4]=_,this.float32[S+5]=x,this.float32[S+6]=E,e}}cl.prototype.bytesPerElement=28,Tt("StructArrayLayout7f28",cl);class Rc extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,i,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,i,u)}emplace(e,r,i,u,f){const _=6*e;return this.uint32[3*e+0]=r,this.uint16[_+2]=i,this.uint16[_+3]=u,this.uint16[_+4]=f,e}}Rc.prototype.bytesPerElement=12,Tt("StructArrayLayout1ul3ui12",Rc);class Zs extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,r)}emplace(e,r,i){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=i,e}}Zs.prototype.bytesPerElement=4,Tt("StructArrayLayout2ui4",Zs);class Oc extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Oc.prototype.bytesPerElement=2,Tt("StructArrayLayout1ui2",Oc);class Hl extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,r)}emplace(e,r,i){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=i,e}}Hl.prototype.bytesPerElement=8,Tt("StructArrayLayout2f8",Hl);class Ih extends pr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,i,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,i,u)}emplace(e,r,i,u,f){const _=4*e;return this.float32[_+0]=r,this.float32[_+1]=i,this.float32[_+2]=u,this.float32[_+3]=f,e}}Ih.prototype.bytesPerElement=16,Tt("StructArrayLayout4f16",Ih);class wd extends Ri{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wd.prototype.size=40;class Ah extends Yo{get(e){return new wd(this,e)}}Tt("CollisionBoxArray",Ah);class kh extends Ri{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}kh.prototype.size=60;class Ed extends Ch{get(e){return new kh(this,e)}}Tt("PlacedSymbolArray",Ed);class Td extends Ri{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Td.prototype.size=76;class xf extends Wl{get(e){return new Td(this,e)}}Tt("SymbolInstanceArray",xf);class zh extends Xl{getoffsetX(e){return this.float32[1*e+0]}}Tt("GlyphOffsetArray",zh);class Bc extends Ph{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Tt("SymbolLineVertexArray",Bc);class bf extends Ri{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}bf.prototype.size=12;class wf extends Rc{get(e){return new bf(this,e)}}Tt("FeatureIndexArray",wf);class Ef extends Ri{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Ef.prototype.size=4;class Tf extends Zs{get(e){return new Ef(this,e)}}Tt("FillExtrusionCentroidArray",Tf);const Es=un([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),co=un([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Sd=Wi(function(t){t.exports=function(e,r){var i,u,f,_,x,E,S,I;for(u=e.length-(i=3&e.length),f=r,x=3432918353,E=461845907,I=0;I<u;)S=255&e.charCodeAt(I)|(255&e.charCodeAt(++I))<<8|(255&e.charCodeAt(++I))<<16|(255&e.charCodeAt(++I))<<24,++I,f=27492+(65535&(_=5*(65535&(f=(f^=S=(65535&(S=(S=(65535&S)*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*E+(((S>>>16)*E&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(S=0,i){case 3:S^=(255&e.charCodeAt(I+2))<<16;case 2:S^=(255&e.charCodeAt(I+1))<<8;case 1:f^=S=(65535&(S=(S=(65535&(S^=255&e.charCodeAt(I)))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*E+(((S>>>16)*E&65535)<<16)&4294967295}return f^=e.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),Sf=Wi(function(t){t.exports=function(e,r){for(var i,u=e.length,f=r^u,_=0;u>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(_)|(255&e.charCodeAt(++_))<<8|(255&e.charCodeAt(++_))<<16|(255&e.charCodeAt(++_))<<24))+((1540483477*(i>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),u-=4,++_;switch(u){case 3:f^=(255&e.charCodeAt(_+2))<<16;case 2:f^=(255&e.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&e.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),Bu=Sd,Md=Sf;Bu.murmur3=Sd,Bu.murmur2=Md;class Fc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,i,u){this.ids.push(Dh(e)),this.positions.push(r,i,u)}getPositions(e){const r=Dh(e);let i=0,u=this.ids.length-1;for(;i<u;){const _=i+u>>1;this.ids[_]>=r?u=_:i=_+1}const f=[];for(;this.ids[i]===r;)f.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return f}static serialize(e,r){const i=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Lh(i,u,0,i.length-1),r&&r.push(i.buffer,u.buffer),{ids:i,positions:u}}static deserialize(e){const r=new Fc;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Dh(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Bu(String(t))}function Lh(t,e,r,i){for(;r<i;){const u=t[r+i>>1];let f=r-1,_=i+1;for(;;){do f++;while(t[f]<u);do _--;while(t[_]>u);if(f>=_)break;Fu(t,f,_),Fu(e,3*f,3*_),Fu(e,3*f+1,3*_+1),Fu(e,3*f+2,3*_+2)}_-r<i-_?(Lh(t,e,r,_),r=_+1):(Lh(t,e,_+1,i),i=_)}}function Fu(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}Tt("FeaturePositionMap",Fc);class Gs{constructor(e,r){this.gl=e.gl,this.location=r}}class Yl extends Gs{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Cd extends Gs{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Pd extends Gs{constructor(e,r){super(e,r),this.current=In.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Mf=new Float32Array(16),Cf=new Float32Array(9),Pf=new Float32Array(4);function Nc(t){return[Sh(255*t.r,255*t.g),Sh(255*t.b,255*t.a)]}class Nu{constructor(e,r,i){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=i}setUniform(e,r,i){e.set(i.constantOr(this.value))}getBinding(e,r,i){return this.type==="color"?new Pd(e,r):new Yl(e,r)}}class ho{constructor(e,r){this.uniformNames=r.map(i=>`u_${i}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,i,u){const f=u==="u_pattern_to"||u==="u_dash_to"?this.patternTo:u==="u_pattern_from"||u==="u_dash_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,r,i){return i==="u_pattern_from"||i==="u_pattern_to"||i==="u_dash_from"||i==="u_dash_to"?new Cd(e,r):new Yl(e,r)}}class qs{constructor(e,r,i,u){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:i==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,i,u,f,_){const x=this.paintVertexArray.length,E=this.expression.evaluate(new Ht(0),r,{},f,u,_);this.paintVertexArray.resize(e),this._setPaintValue(x,e,E)}updatePaintArray(e,r,i,u,f){const _=this.expression.evaluate({zoom:0},i,u,void 0,f);this._setPaintValue(e,r,_)}_setPaintValue(e,r,i){if(this.type==="color"){const u=Nc(i);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Co{constructor(e,r,i,u,f,_){this.expression=e,this.uniformNames=r.map(x=>`u_${x}_t`),this.type=i,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map(x=>({name:`a_${x}`,type:"Float32",components:i==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,r,i,u,f,_){const x=this.expression.evaluate(new Ht(this.zoom),r,{},f,u,_),E=this.expression.evaluate(new Ht(this.zoom+1),r,{},f,u,_),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,x,E)}updatePaintArray(e,r,i,u,f){const _=this.expression.evaluate({zoom:this.zoom},i,u,void 0,f),x=this.expression.evaluate({zoom:this.zoom+1},i,u,void 0,f);this._setPaintValue(e,r,_,x)}_setPaintValue(e,r,i,u){if(this.type==="color"){const f=Nc(i),_=Nc(u);for(let x=e;x<r;x++)this.paintVertexArray.emplace(x,f[0],f[1],_[0],_[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,i,u);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const i=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=rn(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,r,i){return new Yl(e,r)}}class Ma{constructor(e,r,i,u,f,_,x){this.expression=e,this.type=i,this.useIntegerZoom=u,this.zoom=f,this.layerId=x,this.paintVertexAttributes=(i==="array"?co:Es).members;for(let E=0;E<r.length;++E);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,r,i){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,r.patterns&&r.patterns[this.layerId],i)}updatePaintArray(e,r,i,u,f,_){this._setPaintValues(e,r,i.patterns&&i.patterns[this.layerId],_)}_setPaintValues(e,r,i,u){if(!u||!i)return;const{min:f,mid:_,max:x}=i,E=u[f],S=u[_],I=u[x];if(E&&S&&I)for(let A=e;A<r;A++)this._setPaintValue(this.zoomInPaintVertexArray,A,S,E),this._setPaintValue(this.zoomOutPaintVertexArray,A,S,I)}_setPaintValue(e,r,i,u){e.emplace(r,i.tl[0],i.tl[1],i.br[0],i.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],i.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ws{constructor(e,r,i=()=>!0){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!i(f))continue;const _=e.paint.get(f);if(!(_ instanceof yr&&Go(_.property.specification)))continue;const x=Op(f,e.type),E=_.value,S=_.property.specification.type,I=_.property.useIntegerZoom,A=_.property.specification["property-type"],z=A==="cross-faded"||A==="cross-faded-data-driven",N=String(f)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(E.kind!=="constant"||N)if(E.kind==="source"||N||z){const V=If(f,S,"source");this.binders[f]=z?new Ma(E,x,S,I,r,V,e.id):new qs(E,x,S,V),u.push(`/a_${f}`)}else{const V=If(f,S,"composite");this.binders[f]=new Co(E,x,S,I,r,V),u.push(`/z_${f}`)}else this.binders[f]=z?new ho(E.value,x):new Nu(E.value,x,S),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof qs||r instanceof Co?r.maxValue:0}populatePaintArrays(e,r,i,u,f,_){for(const x in this.binders){const E=this.binders[x];(E instanceof qs||E instanceof Co||E instanceof Ma)&&E.populatePaintArray(e,r,i,u,f,_)}}setConstantPatternPositions(e,r){for(const i in this.binders){const u=this.binders[i];u instanceof ho&&u.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,i,u,f,_){let x=!1;for(const E in e){const S=r.getPositions(E);for(const I of S){const A=i.feature(I.index);for(const z in this.binders){const N=this.binders[z];if((N instanceof qs||N instanceof Co||N instanceof Ma)&&N.expression.isStateDependent===!0){const V=u.paint.get(z);N.expression=V.value,N.updatePaintArray(I.start,I.end,A,e[E],f,_),x=!0}}}}return x}defines(){const e=[];for(const r in this.binders){const i=this.binders[r];(i instanceof Nu||i instanceof ho)&&e.push(...i.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof qs||i instanceof Co||i instanceof Ma)for(let u=0;u<i.paintVertexAttributes.length;u++)e.push(i.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof Nu||i instanceof ho||i instanceof Co)for(const u of i.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const i=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Nu||f instanceof ho||f instanceof Co){for(const _ of f.uniformNames)if(r[_]){const x=f.getBinding(e,r[_],_);i.push({name:_,property:u,binding:x})}}}return i}setUniforms(e,r,i,u){for(const{name:f,property:_,binding:x}of r)this.binders[_].setUniform(x,u,i.get(_),f)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const i=this.binders[r];if(e&&i instanceof Ma){const u=e.fromScale===2?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(i instanceof qs||i instanceof Co)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const r in this.binders){const i=this.binders[r];(i instanceof qs||i instanceof Co||i instanceof Ma)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof qs||r instanceof Co||r instanceof Ma)&&r.destroy()}}}class Ts{constructor(e,r,i=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Ws(u,r,i);this.needsUpload=!1,this._featureMap=new Fc,this._bufferOffset=0}populatePaintArrays(e,r,i,u,f,_,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(e,r,u,f,_,x);r.id!==void 0&&this._featureMap.add(r.id,i,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,i,u,f){for(const _ of i)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,r,_,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Rp={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Op(t,e){return Rp[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Id={"line-pattern":{source:$s,composite:$s},"fill-pattern":{source:$s,composite:$s},"fill-extrusion-pattern":{source:$s,composite:$s},"line-dasharray":{source:Ou,composite:Ou}},Ad={color:{source:Hl,composite:Ih},number:{source:Xl,composite:Hl}};function If(t,e,r){const i=Id[t];return i&&i[r]||Ad[e][r]}Tt("ConstantBinder",Nu),Tt("CrossFadedConstantBinder",ho),Tt("SourceExpressionBinder",qs),Tt("CrossFadedCompositeBinder",Ma),Tt("CompositeExpressionBinder",Co),Tt("ProgramConfiguration",Ws,{omit:["_buffers"]}),Tt("ProgramConfigurationSet",Ts);const Uc="-transition";class Ko extends xe{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new lo(r.layout)),r.paint)){this._transitionablePaint=new Bn(r.paint);for(const i in e.paint)this.setPaintProperty(i,e.paint[i],{validate:!1});for(const i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vs(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,i={}){r!=null&&this._validate(bd,`layers.${this.id}.layout.${e}`,e,r,i)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return No(e,Uc)?this._transitionablePaint.getTransition(e.slice(0,-Uc.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,i={}){if(r!=null&&this._validate($l,`layers.${this.id}.paint.${e}`,e,r,i))return!1;if(No(e,Uc))return this._transitionablePaint.setTransition(e.slice(0,-Uc.length),r||void 0),!1;{const u=this._transitionablePaint._values[e],f=u.property.specification["property-type"]==="cross-faded-data-driven",_=u.value.isDataDriven(),x=u.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const E=this._transitionablePaint._values[e].value;return E.isDataDriven()||_||f||this._handleOverridablePaintPropertyUpdate(e,x,E)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ls(e,(r,i)=>!(r===void 0||i==="layout"&&!Object.keys(r).length||i==="paint"&&!Object.keys(r).length))}_validate(e,r,i,u,f={}){return(!f||f.validate!==!1)&&Dc(this,e.call(ao,{key:r,layerType:this.type,objectKey:i,value:u,styleSpec:le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof yr&&Go(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=jl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Bp=un([{name:"a_pos",components:2,type:"Int16"}],4),{members:Af}=Bp;class Cr{constructor(e=[]){this.segments=e}prepareSegment(e,r,i,u){let f=this.segments[this.segments.length-1];return e>Cr.MAX_VERTEX_ARRAY_LENGTH&&Kn(`Max vertices per segment is ${Cr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Cr.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:r.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,i,u){return new Cr([{vertexOffset:e,primitiveOffset:r,vertexLength:i,primitiveLength:u,vaos:{},sortKey:0}])}}Cr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tt("SegmentVector",Cr);var wn=8192;class hl{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Gn?new Gn(e.lng,e.lat):Gn.convert(e),this}setSouthWest(e){return this._sw=e instanceof Gn?new Gn(e.lng,e.lat):Gn.convert(e),this}extend(e){const r=this._sw,i=this._ne;let u,f;if(e instanceof Gn)u=e,f=e;else{if(!(e instanceof hl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(hl.convert(e)):this.extend(Gn.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return r||i?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),i.lng=Math.max(f.lng,i.lng),i.lat=Math.max(f.lat,i.lat)):(this._sw=new Gn(u.lng,u.lat),this._ne=new Gn(f.lng,f.lat)),this}getCenter(){return new Gn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Gn(this.getWest(),this.getNorth())}getSouthEast(){return new Gn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:i}=Gn.convert(e);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&u}static convert(e){return!e||e instanceof hl?e:new hl(e)}}const kd=63710088e-1;class Gn{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Gn(Ni(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,i=this.lat*r,u=e.lat*r,f=Math.sin(i)*Math.sin(u)+Math.cos(i)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return kd*Math.acos(Math.min(f,1))}toBounds(e=0){const r=360*e/40075017,i=r/Math.cos(Math.PI/180*this.lat);return new hl(new Gn(this.lng-i,this.lat-r),new Gn(this.lng+i,this.lat+r))}static convert(e){if(e instanceof Gn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Gn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Gn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const zd=2*Math.PI*kd;function Dd(t){return zd*Math.cos(t*Math.PI/180)}function dl(t){return(180+t)/360}function fl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Jo(t,e){return t/Dd(e)}function Ss(t){return 360*t-180}function Po(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function kf(t,e){return t*Dd(Po(e))}const Xs=85.051129;class Kl{constructor(e,r,i=0){this.x=+e,this.y=+r,this.z=+i}static fromLngLat(e,r=0){const i=Gn.convert(e);return new Kl(dl(i.lng),fl(i.lat),Jo(r,i.lat))}toLngLat(){return new Gn(Ss(this.x),Po(this.y))}toAltitude(){return kf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/zd*(e=Po(this.y),1/Math.cos(e*Math.PI/180));var e}}function jc(t,e,r,i,u,f,_,x,E){const S=(e+i)/2,I=(r+u)/2,A=new $(S,I);x(A),function(z,N,V,W,ee,ae){const ge=V-ee,be=W-ae;return Math.abs((W-N)*ge-(V-z)*be)/Math.hypot(ge,be)}(A.x,A.y,f.x,f.y,_.x,_.y)>=E?(jc(t,e,r,S,I,f,A,x,E),jc(t,S,I,i,u,A,_,x,E)):t.push(_)}function cn(t,e,r){const i=[];let u,f,_;for(const x of t){const{x:E,y:S}=x;e(x),_?jc(i,u,f,E,S,_,x,e,r):i.push(x),u=E,f=S,_=x}return i}const Pi=Math.pow(2,14)-1,Yr=-Pi-1;function Oi(t,e){const r=Math.round(t.x*e),i=Math.round(t.y*e);return t.x=rn(r,Yr,Pi),t.y=rn(i,Yr,Pi),(r<t.x||r>t.x+1||i<t.y||i>t.y+1)&&Kn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Ji(t,e,r){const i=t.loadGeometry(),u=t.extent,f=wn/u;if(e&&r&&r.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:x,x:E,y:S,projection:I}=r,A=z=>{const N=Ss((e.x+z.x/u)/_),V=Po((e.y+z.y/u)/_),W=I.project(N,V);z.x=(W.x*x-E)*u,z.y=(W.y*x-S)*u};for(let z=0;z<i.length;z++)if(t.type!==1)i[z]=cn(i[z],A,1);else{const N=[];for(const V of i[z])V.x<0||V.x>=u||V.y<0||V.y>=u||(A(V),N.push(V));i[z]=N}}for(const _ of i)for(const x of _)Oi(x,f);return i}function Ca(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ji(t):[]}}function Kr(t,e,r,i,u){t.emplaceBack(2*e+(i+1)/2,2*r+(u+1)/2)}class Uu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new kr,this.indexArray=new uo,this.segments=new Cr,this.programConfigurations=new Ts(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,i,u){const f=this.layers[0],_=[];let x=null;f.type==="circle"&&(x=f.layout.get("circle-sort-key"));for(const{feature:E,id:S,index:I,sourceLayerIndex:A}of e){const z=this.layers[0]._featureFilter.needGeometry,N=Ca(E,z);if(!this.layers[0]._featureFilter.filter(new Ht(this.zoom),N,i))continue;const V=x?x.evaluate(N,{},i):void 0,W={id:S,properties:E.properties,type:E.type,sourceLayerIndex:A,index:I,geometry:z?N.geometry:Ji(E,i,u),patterns:{},sortKey:V};_.push(W)}x&&_.sort((E,S)=>E.sortKey-S.sortKey);for(const E of _){const{geometry:S,index:I,sourceLayerIndex:A}=E,z=e[I].feature;this.addFeature(E,S,I,r.availableImages,i),r.featureIndex.insert(z,S,I,A,this.index)}}update(e,r,i,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,i,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Af),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,i,u,f){for(const _ of r)for(const x of _){const E=x.x,S=x.y;if(E<0||E>=wn||S<0||S>=wn)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),A=I.vertexLength;Kr(this.layoutVertexArray,E,S,-1,-1),Kr(this.layoutVertexArray,E,S,1,-1),Kr(this.layoutVertexArray,E,S,1,1),Kr(this.layoutVertexArray,E,S,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},u,f)}}function Jl(t,e){for(let r=0;r<t.length;r++)if(Pa(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(Pa(t,e[r]))return!0;return!!$c(t,e)}function Vc(t,e,r){return!!Pa(t,e)||!!Zc(e,t,r)}function Ql(t,e){if(t.length===1)return Vt(e,t[0]);for(let r=0;r<e.length;r++){const i=e[r];for(let u=0;u<i.length;u++)if(Pa(t,i[u]))return!0}for(let r=0;r<t.length;r++)if(Vt(e,t[r]))return!0;for(let r=0;r<e.length;r++)if($c(t,e[r]))return!0;return!1}function Ld(t,e,r){if(t.length>1){if($c(t,e))return!0;for(let i=0;i<e.length;i++)if(Zc(e[i],t,r))return!0}for(let i=0;i<t.length;i++)if(Zc(t[i],e,r))return!0;return!1}function $c(t,e){if(t.length===0||e.length===0)return!1;for(let r=0;r<t.length-1;r++){const i=t[r],u=t[r+1];for(let f=0;f<e.length-1;f++)if(Rd(i,u,e[f],e[f+1]))return!0}return!1}function Rd(t,e,r,i){return yi(t,r,i)!==yi(e,r,i)&&yi(t,e,r)!==yi(t,e,i)}function Zc(t,e,r){const i=r*r;if(e.length===1)return t.distSqr(e[0])<i;for(let u=1;u<e.length;u++)if(eu(t,e[u-1],e[u])<i)return!0;return!1}function eu(t,e,r){const i=e.distSqr(r);if(i===0)return t.distSqr(e);const u=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/i;return t.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function Vt(t,e){let r,i,u,f=!1;for(let _=0;_<t.length;_++){r=t[_];for(let x=0,E=r.length-1;x<r.length;E=x++)i=r[x],u=r[E],i.y>e.y!=u.y>e.y&&e.x<(u.x-i.x)*(e.y-i.y)/(u.y-i.y)+i.x&&(f=!f)}return f}function Pa(t,e){let r=!1;for(let i=0,u=t.length-1;i<t.length;u=i++){const f=t[i],_=t[u];f.y>e.y!=_.y>e.y&&e.x<(_.x-f.x)*(e.y-f.y)/(_.y-f.y)+f.x&&(r=!r)}return r}function Rh(t,e,r,i,u){for(const _ of t)if(e<=_.x&&r<=_.y&&i>=_.x&&u>=_.y)return!0;const f=[new $(e,r),new $(e,u),new $(i,u),new $(i,r)];if(t.length>2){for(const _ of f)if(Pa(t,_))return!0}for(let _=0;_<t.length-1;_++)if(Hs(t[_],t[_+1],f))return!0;return!1}function Hs(t,e,r){const i=r[0],u=r[2];if(t.x<i.x&&e.x<i.x||t.x>u.x&&e.x>u.x||t.y<i.y&&e.y<i.y||t.y>u.y&&e.y>u.y)return!1;const f=yi(t,e,r[0]);return f!==yi(t,e,r[1])||f!==yi(t,e,r[2])||f!==yi(t,e,r[3])}function Io(t,e,r){const i=e.paint.get(t).value;return i.kind==="constant"?i.value:r.programConfigurations.get(e.id).getMaxValue(t)}function pl(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ju(t,e,r,i,u){if(!e[0]&&!e[1])return t;const f=$.convert(e)._mult(u);r==="viewport"&&f._rotate(-i);const _=[];for(let x=0;x<t.length;x++)_.push(t[x].sub(f));return _}function Oh(t,e,r,i){const u=$.convert(t)._mult(i);return e==="viewport"&&u._rotate(-r),u}Tt("CircleBucket",Uu,{omit:["layers"]});const Od=new Er({"circle-sort-key":new jt(le.layout_circle["circle-sort-key"])});var Ia={paint:new Er({"circle-radius":new jt(le.paint_circle["circle-radius"]),"circle-color":new jt(le.paint_circle["circle-color"]),"circle-blur":new jt(le.paint_circle["circle-blur"]),"circle-opacity":new jt(le.paint_circle["circle-opacity"]),"circle-translate":new Ct(le.paint_circle["circle-translate"]),"circle-translate-anchor":new Ct(le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ct(le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ct(le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new jt(le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new jt(le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new jt(le.paint_circle["circle-stroke-opacity"])}),layout:Od};class tu{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,i,u){const f=Math.pow(2,i),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const S=ar([],E,e),I=1/S[3]/r*f;return function(A,z,N){return A[0]=z[0]*N[0],A[1]=z[1]*N[1],A[2]=z[2]*N[2],A[3]=z[3]*N[3],A}(S,S,[I,I,u?1/S[3]:I,I])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const S=Qt([],ut([],Jt([],_[E[0]],_[E[1]]),Jt([],_[E[2]],_[E[1]]))),I=-vn(S,_[E[1]]);return S.concat(I)});return new tu(_,x)}}class Ao{constructor(e,r){this.min=e,this.max=r,this.center=Fe([],$t([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],i=Ot(this.min),u=Ot(this.max);for(let f=0;f<r.length;f++)i[f]=r[f]?this.min[f]:this.center[f],u[f]=r[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Ao(i,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let i=!0;for(let u=0;u<e.planes.length;u++){const f=e.planes[u];let _=0;for(let x=0;x<r.length;x++)_+=vn(f,r[x])+f[3]>=0;if(_===0)return 0;_!==r.length&&(i=!1)}if(i)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<e.points.length;x++){const E=e.points[x][u]-this.min[u];f=Math.min(f,E),_=Math.max(_,E)}if(_<0||f>this.max[u]-this.min[u])return 0}return 1}}function Gc(t,e,r,i,u,f,_,x,E){if(f&&t.queryGeometry.isAboveHorizon)return!1;f&&(E*=t.pixelToTileUnitsFactor);for(const S of e)for(const I of S){const A=I.add(x),z=u&&r.elevation?r.elevation.exaggeration()*u.getElevationAt(A.x,A.y,!0):0,N=f?A:Aa(A,z,i),V=f?t.tilespaceRays.map(ee=>Bh(ee,z)):t.queryGeometry.screenGeometry,W=ar([],[I.x,I.y,z,1],i);if(!_&&f?E*=W[3]/r.cameraToCenterDistance:_&&!f&&(E*=r.cameraToCenterDistance/W[3]),Vc(V,N,E))return!0}return!1}function Aa(t,e,r){const i=ar([],[t.x,t.y,e,1],r);return new $(i[0]/i[3],i[1]/i[3])}const qc=Nt(0,0,0),Wc=Nt(0,0,1);function Bh(t,e){const r=Pt();return qc[2]=e,t.intersectsPlane(qc,Wc,r),new $(r[0],r[1])}class fo extends Uu{}function Ys(t,{width:e,height:r},i,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*i)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*r*i);return t.width=e,t.height=r,t.data=u,t}function ka(t,{width:e,height:r},i){if(e===t.width&&r===t.height)return;const u=Ys({},{width:e,height:r},i);Vu(t,u,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,r)},i),t.width=e,t.height=r,t.data=u.data}function Vu(t,e,r,i,u,f){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||r.x>t.width-u.width||r.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||i.x>e.width-u.width||i.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const _=t.data,x=e.data;for(let E=0;E<u.height;E++){const S=((r.y+E)*t.width+r.x)*f,I=((i.y+E)*e.width+i.x)*f;for(let A=0;A<u.width*f;A++)x[I+A]=_[S+A]}return e}Tt("HeatmapBucket",fo,{omit:["layers"]});class ri{constructor(e,r){Ys(this,e,1,r)}resize(e){ka(this,e,1)}clone(){return new ri({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,i,u,f){Vu(e,r,i,u,f,1)}}class po{constructor(e,r){Ys(this,e,4,r)}resize(e){ka(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new po({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,i,u,f){Vu(e,r,i,u,f,4)}}Tt("AlphaImage",ri),Tt("RGBAImage",po);var $u={paint:new Er({"heatmap-radius":new jt(le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new jt(le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ct(le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ho(le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ct(le.paint_heatmap["heatmap-opacity"])})};function Xc(t){const e={},r=t.resolution||256,i=t.clips?t.clips.length:1,u=t.image||new po({width:r,height:i}),f=(_,x,E)=>{e[t.evaluationKey]=E;const S=t.expression.evaluate(e);u.data[_+x+0]=Math.floor(255*S.r/S.a),u.data[_+x+1]=Math.floor(255*S.g/S.a),u.data[_+x+2]=Math.floor(255*S.b/S.a),u.data[_+x+3]=Math.floor(255*S.a)};if(t.clips)for(let _=0,x=0;_<i;++_,x+=4*r)for(let E=0,S=0;E<r;E++,S+=4){const I=E/(r-1),{start:A,end:z}=t.clips[_];f(x,S,A*(1-I)+z*I)}else for(let _=0,x=0;_<r;_++,x+=4)f(0,x,_/(r-1));return u}var Fp={paint:new Er({"hillshade-illumination-direction":new Ct(le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ct(le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ct(le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ct(le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ct(le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ct(le.paint_hillshade["hillshade-accent-color"])})};const zf=un([{name:"a_pos",components:2,type:"Int16"}],4),{members:Df}=zf;var nu=za,Bd=za;function za(t,e,r){r=r||2;var i,u,f,_,x,E,S,I=e&&e.length,A=I?e[0]*r:t.length,z=Fd(t,0,A,r,!0),N=[];if(!z||z.next===z.prev)return N;if(I&&(z=function(W,ee,ae,ge){var be,Se,Ae,ze=[];for(be=0,Se=ee.length;be<Se;be++)(Ae=Fd(W,ee[be]*ge,be<Se-1?ee[be+1]*ge:W.length,ge,!1))===Ae.next&&(Ae.steiner=!0),ze.push($p(Ae));for(ze.sort(ru),be=0;be<ze.length;be++)ae=Da(ae=jp(ze[be],ae),ae.next);return ae}(t,e,z,r)),t.length>80*r){i=f=t[0],u=_=t[1];for(var V=r;V<A;V+=r)(x=t[V])<i&&(i=x),(E=t[V+1])<u&&(u=E),x>f&&(f=x),E>_&&(_=E);S=(S=Math.max(f-i,_-u))!==0?1/S:0}return La(z,N,r,i,u,S),N}function Fd(t,e,r,i,u){var f,_;if(u===Zu(t,e,r,i)>0)for(f=e;f<r;f+=i)_=Nh(f,t[f],t[f+1],_);else for(f=r-i;f>=e;f-=i)_=Nh(f,t[f],t[f+1],_);return _&&Ms(_,_.next)&&(Kc(_),_=_.next),_}function Da(t,e){if(!t)return t;e||(e=t);var r,i=t;do if(r=!1,i.steiner||!Ms(i,i.next)&&Tr(i.prev,i,i.next)!==0)i=i.next;else{if(Kc(i),(i=e=i.prev)===i.next)break;r=!0}while(r||i!==e);return e}function La(t,e,r,i,u,f,_){if(t){!_&&f&&function(I,A,z,N){var V=I;do V.z===null&&(V.z=Ks(V.x,V.y,A,z,N)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==I);V.prevZ.nextZ=null,V.prevZ=null,function(W){var ee,ae,ge,be,Se,Ae,ze,Qe,Ke=1;do{for(ae=W,W=null,Se=null,Ae=0;ae;){for(Ae++,ge=ae,ze=0,ee=0;ee<Ke&&(ze++,ge=ge.nextZ);ee++);for(Qe=Ke;ze>0||Qe>0&&ge;)ze!==0&&(Qe===0||!ge||ae.z<=ge.z)?(be=ae,ae=ae.nextZ,ze--):(be=ge,ge=ge.nextZ,Qe--),Se?Se.nextZ=be:W=be,be.prevZ=Se,Se=be;ae=ge}Se.nextZ=null,Ke*=2}while(Ae>1)}(V)}(t,i,u,f);for(var x,E,S=t;t.prev!==t.next;)if(x=t.prev,E=t.next,f?Up(t,i,u,f):Np(t))e.push(x.i/r),e.push(t.i/r),e.push(E.i/r),Kc(t),t=E.next,S=E.next;else if((t=E)===S){_?_===1?La(t=Lf(Da(t),e,r),e,r,i,u,f,2):_===2&&Rf(t,e,r,i,u,f):La(Da(t),e,r,i,u,f,1);break}}}function Np(t){var e=t.prev,r=t,i=t.next;if(Tr(e,r,i)>=0)return!1;for(var u=t.next.next;u!==t.prev;){if(iu(e.x,e.y,r.x,r.y,i.x,i.y,u.x,u.y)&&Tr(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function Up(t,e,r,i){var u=t.prev,f=t,_=t.next;if(Tr(u,f,_)>=0)return!1;for(var x=u.x>f.x?u.x>_.x?u.x:_.x:f.x>_.x?f.x:_.x,E=u.y>f.y?u.y>_.y?u.y:_.y:f.y>_.y?f.y:_.y,S=Ks(u.x<f.x?u.x<_.x?u.x:_.x:f.x<_.x?f.x:_.x,u.y<f.y?u.y<_.y?u.y:_.y:f.y<_.y?f.y:_.y,e,r,i),I=Ks(x,E,e,r,i),A=t.prevZ,z=t.nextZ;A&&A.z>=S&&z&&z.z<=I;){if(A!==t.prev&&A!==t.next&&iu(u.x,u.y,f.x,f.y,_.x,_.y,A.x,A.y)&&Tr(A.prev,A,A.next)>=0||(A=A.prevZ,z!==t.prev&&z!==t.next&&iu(u.x,u.y,f.x,f.y,_.x,_.y,z.x,z.y)&&Tr(z.prev,z,z.next)>=0))return!1;z=z.nextZ}for(;A&&A.z>=S;){if(A!==t.prev&&A!==t.next&&iu(u.x,u.y,f.x,f.y,_.x,_.y,A.x,A.y)&&Tr(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;z&&z.z<=I;){if(z!==t.prev&&z!==t.next&&iu(u.x,u.y,f.x,f.y,_.x,_.y,z.x,z.y)&&Tr(z.prev,z,z.next)>=0)return!1;z=z.nextZ}return!0}function Lf(t,e,r){var i=t;do{var u=i.prev,f=i.next.next;!Ms(u,f)&&Of(u,i,i.next,f)&&Yc(u,f)&&Yc(f,u)&&(e.push(u.i/r),e.push(i.i/r),e.push(f.i/r),Kc(i),Kc(i.next),i=t=f),i=i.next}while(i!==t);return Da(i)}function Rf(t,e,r,i,u,f){var _=t;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&Zp(_,x)){var E=ko(_,x);return _=Da(_,_.next),E=Da(E,E.next),La(_,e,r,i,u,f),void La(E,e,r,i,u,f)}x=x.next}_=_.next}while(_!==t)}function ru(t,e){return t.x-e.x}function jp(t,e){var r=function(f,_){var x,E=_,S=f.x,I=f.y,A=-1/0;do{if(I<=E.y&&I>=E.next.y&&E.next.y!==E.y){var z=E.x+(I-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(z<=S&&z>A){if(A=z,z===S){if(I===E.y)return E;if(I===E.next.y)return E.next}x=E.x<E.next.x?E:E.next}}E=E.next}while(E!==_);if(!x)return null;if(S===A)return x;var N,V=x,W=x.x,ee=x.y,ae=1/0;E=x;do S>=E.x&&E.x>=W&&S!==E.x&&iu(I<ee?S:A,I,W,ee,I<ee?A:S,I,E.x,E.y)&&(N=Math.abs(I-E.y)/(S-E.x),Yc(E,f)&&(N<ae||N===ae&&(E.x>x.x||E.x===x.x&&Vp(x,E)))&&(x=E,ae=N)),E=E.next;while(E!==V);return x}(t,e);if(!r)return e;var i=ko(r,t),u=Da(r,r.next);return Da(i,i.next),e===r?u:e}function Vp(t,e){return Tr(t.prev,t,e.prev)<0&&Tr(e.next,t,t.next)<0}function Ks(t,e,r,i,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*u)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*u)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $p(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function iu(t,e,r,i,u,f,_,x){return(u-_)*(e-x)-(t-_)*(f-x)>=0&&(t-_)*(i-x)-(r-_)*(e-x)>=0&&(r-_)*(f-x)-(u-_)*(i-x)>=0}function Zp(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,i){var u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==i.i&&u.next.i!==i.i&&Of(u,u.next,r,i))return!0;u=u.next}while(u!==r);return!1}(t,e)&&(Yc(t,e)&&Yc(e,t)&&function(r,i){var u=r,f=!1,_=(r.x+i.x)/2,x=(r.y+i.y)/2;do u.y>x!=u.next.y>x&&u.next.y!==u.y&&_<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==r);return f}(t,e)&&(Tr(t.prev,t,e.prev)||Tr(t,e.prev,e))||Ms(t,e)&&Tr(t.prev,t,t.next)>0&&Tr(e.prev,e,e.next)>0)}function Tr(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Ms(t,e){return t.x===e.x&&t.y===e.y}function Of(t,e,r,i){var u=Hc(Tr(t,e,r)),f=Hc(Tr(t,e,i)),_=Hc(Tr(r,i,t)),x=Hc(Tr(r,i,e));return u!==f&&_!==x||!(u!==0||!Fh(t,r,e))||!(f!==0||!Fh(t,i,e))||!(_!==0||!Fh(r,t,i))||!(x!==0||!Fh(r,e,i))}function Fh(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Hc(t){return t>0?1:t<0?-1:0}function Yc(t,e){return Tr(t.prev,t,t.next)<0?Tr(t,e,t.next)>=0&&Tr(t,t.prev,e)>=0:Tr(t,e,t.prev)<0||Tr(t,t.next,e)<0}function ko(t,e){var r=new Js(t.i,t.x,t.y),i=new Js(e.i,e.x,e.y),u=t.next,f=e.prev;return t.next=e,e.prev=t,r.next=u,u.prev=r,i.next=r,r.prev=i,f.next=i,i.prev=f,i}function Nh(t,e,r,i){var u=new Js(t,e,r);return i?(u.next=i.next,u.prev=i,i.next.prev=u,i.next=u):(u.prev=u,u.next=u),u}function Kc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Js(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zu(t,e,r,i){for(var u=0,f=e,_=r-i;f<r;f+=i)u+=(t[_]-t[f])*(t[f+1]+t[_+1]),_=f;return u}function Gu(t,e,r,i,u){Uh(t,e,r,i||t.length-1,u)}function Uh(t,e,r,i,u){for(;i>r;){if(i-r>600){var f=i-r+1,_=e-r+1,x=Math.log(f),E=.5*Math.exp(2*x/3),S=.5*Math.sqrt(x*E*(f-E)/f)*(_-f/2<0?-1:1);Uh(t,e,Math.max(r,Math.floor(e-_*E/f+S)),Math.min(i,Math.floor(e+(f-_)*E/f+S)),u)}var I=t[e],A=r,z=i;for(ou(t,r,e),u(t[i],I)>0&&ou(t,r,i);A<z;){for(ou(t,A,z),A++,z--;u(t[A],I)<0;)A++;for(;u(t[z],I)>0;)z--}u(t[r],I)===0?ou(t,r,z):ou(t,++z,i),z<=e&&(r=z+1),e<=z&&(i=z-1)}}function ou(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function Jc(t,e){const r=t.length;if(r<=1)return[t];const i=[];let u,f;for(let _=0;_<r;_++){const x=us(t[_]);x!==0&&(t[_].area=Math.abs(x),f===void 0&&(f=x<0),f===x<0?(u&&i.push(u),u=[t[_]]):u.push(t[_]))}if(u&&i.push(u),e>1)for(let _=0;_<i.length;_++)i[_].length<=e||(Gu(i[_],e,1,i[_].length-1,Gp),i[_]=i[_].slice(0,e));return i}function Gp(t,e){return e.area-t.area}function Nd(t,e,r){const i=r.patternDependencies;let u=!1;for(const f of e){const _=f.paint.get(`${t}-pattern`);_.isConstant()||(u=!0);const x=_.constantOr(null);x&&(u=!0,i[x.to]=!0,i[x.from]=!0)}return u}function qu(t,e,r,i,u){const f=u.patternDependencies;for(const _ of e){const x=_.paint.get(`${t}-pattern`).value;if(x.kind!=="constant"){let E=x.evaluate({zoom:i-1},r,{},u.availableImages),S=x.evaluate({zoom:i},r,{},u.availableImages),I=x.evaluate({zoom:i+1},r,{},u.availableImages);E=E&&E.name?E.name:E,S=S&&S.name?S.name:S,I=I&&I.name?I.name:I,f[E]=!0,f[S]=!0,f[I]=!0,r.patterns[_.id]={min:E,mid:S,max:I}}}return r}za.deviation=function(t,e,r,i){var u=e&&e.length,f=Math.abs(Zu(t,0,u?e[0]*r:t.length,r));if(u)for(var _=0,x=e.length;_<x;_++)f-=Math.abs(Zu(t,e[_]*r,_<x-1?e[_+1]*r:t.length,r));var E=0;for(_=0;_<i.length;_+=3){var S=i[_]*r,I=i[_+1]*r,A=i[_+2]*r;E+=Math.abs((t[S]-t[A])*(t[I+1]-t[S+1])-(t[S]-t[I])*(t[A+1]-t[S+1]))}return f===0&&E===0?0:Math.abs((E-f)/f)},za.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,u=0;u<t.length;u++){for(var f=0;f<t[u].length;f++)for(var _=0;_<e;_++)r.vertices.push(t[u][f][_]);u>0&&r.holes.push(i+=t[u-1].length)}return r},nu.default=Bd;class Wu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new kr,this.indexArray=new uo,this.indexArray2=new Zs,this.programConfigurations=new Ts(e.layers,e.zoom),this.segments=new Cr,this.segments2=new Cr,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,i,u){this.hasPattern=Nd("fill",this.layers,r);const f=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:E,index:S,sourceLayerIndex:I}of e){const A=this.layers[0]._featureFilter.needGeometry,z=Ca(x,A);if(!this.layers[0]._featureFilter.filter(new Ht(this.zoom),z,i))continue;const N=f?f.evaluate(z,{},i,r.availableImages):void 0,V={id:E,properties:x.properties,type:x.type,sourceLayerIndex:I,index:S,geometry:A?z.geometry:Ji(x,i,u),patterns:{},sortKey:N};_.push(V)}f&&_.sort((x,E)=>x.sortKey-E.sortKey);for(const x of _){const{geometry:E,index:S,sourceLayerIndex:I}=x;if(this.hasPattern){const A=qu("fill",this.layers,x,this.zoom,r);this.patternFeatures.push(A)}else this.addFeature(x,E,S,i,{},r.availableImages);r.featureIndex.insert(e[S].feature,E,S,I,this.index)}}update(e,r,i,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,i,u)}addFeatures(e,r,i,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,r,i,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Df),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,i,u,f,_=[]){for(const x of Jc(r,500)){let E=0;for(const V of x)E+=V.length;const S=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),I=S.vertexLength,A=[],z=[];for(const V of x){if(V.length===0)continue;V!==x[0]&&z.push(A.length/2);const W=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),ee=W.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(ee+V.length-1,ee),A.push(V[0].x),A.push(V[0].y);for(let ae=1;ae<V.length;ae++)this.layoutVertexArray.emplaceBack(V[ae].x,V[ae].y),this.indexArray2.emplaceBack(ee+ae-1,ee+ae),A.push(V[ae].x),A.push(V[ae].y);W.vertexLength+=V.length,W.primitiveLength+=V.length}const N=nu(A,z);for(let V=0;V<N.length;V+=3)this.indexArray.emplaceBack(I+N[V],I+N[V+1],I+N[V+2]);S.vertexLength+=E,S.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,f,_,u)}}Tt("FillBucket",Wu,{omit:["layers","patternFeatures"]});const Bf=new Er({"fill-sort-key":new jt(le.layout_fill["fill-sort-key"])});var Ud={paint:new Er({"fill-antialias":new Ct(le.paint_fill["fill-antialias"]),"fill-opacity":new jt(le.paint_fill["fill-opacity"]),"fill-color":new jt(le.paint_fill["fill-color"]),"fill-outline-color":new jt(le.paint_fill["fill-outline-color"]),"fill-translate":new Ct(le.paint_fill["fill-translate"]),"fill-translate-anchor":new Ct(le.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nr(le.paint_fill["fill-pattern"])}),layout:Bf};const jd=un([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Qc=un([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:qp}=jd;var eh=su;function su(t,e,r,i,u){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=u,t.readFields(Wp,this,e)}function Wp(t,e,r){t==1?e.id=r.readVarint():t==2?function(i,u){for(var f=i.readVarint()+i.pos;i.pos<f;){var _=u._keys[i.readVarint()],x=u._values[i.readVarint()];u.properties[_]=x}}(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function th(t){for(var e,r,i=0,u=0,f=t.length,_=f-1;u<f;_=u++)i+=((r=t[_]).x-(e=t[u]).x)*(e.y+r.y);return i}su.types=["Unknown","Point","LineString","Polygon"],su.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,u=0,f=0,_=0,x=[];t.pos<r;){if(u<=0){var E=t.readVarint();i=7&E,u=E>>3}if(u--,i===1||i===2)f+=t.readSVarint(),_+=t.readSVarint(),i===1&&(e&&x.push(e),e=[]),e.push(new $(f,_));else{if(i!==7)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&x.push(e),x},su.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,u=0,f=0,_=1/0,x=-1/0,E=1/0,S=-1/0;t.pos<e;){if(i<=0){var I=t.readVarint();r=7&I,i=I>>3}if(i--,r===1||r===2)(u+=t.readSVarint())<_&&(_=u),u>x&&(x=u),(f+=t.readSVarint())<E&&(E=f),f>S&&(S=f);else if(r!==7)throw new Error("unknown command "+r)}return[_,E,x,S]},su.prototype.toGeoJSON=function(t,e,r){var i,u,f=this.extent*Math.pow(2,r),_=this.extent*t,x=this.extent*e,E=this.loadGeometry(),S=su.types[this.type];function I(N){for(var V=0;V<N.length;V++){var W=N[V];N[V]=[360*(W.x+_)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+x)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(i=0;i<E.length;i++)A[i]=E[i][0];I(E=A);break;case 2:for(i=0;i<E.length;i++)I(E[i]);break;case 3:for(E=function(N){var V=N.length;if(V<=1)return[N];for(var W,ee,ae=[],ge=0;ge<V;ge++){var be=th(N[ge]);be!==0&&(ee===void 0&&(ee=be<0),ee===be<0?(W&&ae.push(W),W=[N[ge]]):W.push(N[ge]))}return W&&ae.push(W),ae}(E),i=0;i<E.length;i++)for(u=0;u<E[i].length;u++)I(E[i][u])}E.length===1?E=E[0]:S="Multi"+S;var z={type:"Feature",geometry:{type:S,coordinates:E},properties:this.properties};return"id"in this&&(z.id=this.id),z};var Ff=nh;function nh(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(a,this,e),this.length=this._features.length}function a(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(function(i){for(var u=null,f=i.readVarint()+i.pos;i.pos<f;){var _=i.readVarint()>>3;u=_===1?i.readString():_===2?i.readFloat():_===3?i.readDouble():_===4?i.readVarint64():_===5?i.readVarint():_===6?i.readSVarint():_===7?i.readBoolean():null}return u}(r))}function d(t,e,r){if(t===3){var i=new Ff(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}nh.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new eh(this._pbf,e,this.extent,this._keys,this._values)};var y={VectorTile:function(t,e){this.layers=t.readFields(d,{},e)},VectorTileFeature:eh,VectorTileLayer:Ff};const C=y.VectorTileFeature.types,L=Math.pow(2,13);function j(t,e,r,i,u,f,_,x){t.emplaceBack((e<<1)+_,(r<<1)+f,(Math.floor(i*L)<<1)+u,Math.round(x))}class Y{constructor(){this.acc=new $(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new $(e.x,e.y),this.max=new $(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);let i=!!this.borders;const u=this.min,f=this.max;e.x<u.x?(u.x=e.x,i=!0):e.x>f.x&&(f.x=e.x,i=!0),e.y<u.y?(u.y=e.y,i=!0):e.y>f.y&&(f.y=e.y,i=!0),((e.x===0||e.x===wn)&&e.x===r.x)!=((e.y===0||e.y===wn)&&e.y===r.y)&&this.processBorderOverlap(e,r),i&&this.checkBorderIntersection(e,r)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,Nn(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>wn!=e.x>wn&&this.addBorderIntersection(1,Nn(r.y,e.y,(wn-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Nn(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>wn!=e.y>wn&&this.addBorderIntersection(3,Nn(r.x,e.x,(wn-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];r<i[0]&&(i[0]=r),r>i[1]&&(i[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const i=e.x===0?0:1;this.addBorderIntersection(i,r.y),this.addBorderIntersection(i,e.y)}else{const i=e.y===0?2:3;this.addBorderIntersection(i,r.x),this.addBorderIntersection(i,e.x)}}centroid(){const e=this.polyCount.reduce((r,i)=>r+i.edges,0);return e!==0?this.acc.div(e)._round():new $(0,0)}span(){return new $(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class ce{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ea,this.centroidVertexArray=new Tf,this.indexArray=new uo,this.programConfigurations=new Ts(e.layers,e.zoom),this.segments=new Cr,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,i,u){this.features=[],this.hasPattern=Nd("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(f){const _=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*_/(_*_+1)/wn/(1<<f.z)}(i);for(const{feature:f,id:_,index:x,sourceLayerIndex:E}of e){const S=this.layers[0]._featureFilter.needGeometry,I=Ca(f,S);if(!this.layers[0]._featureFilter.filter(new Ht(this.zoom),I,i))continue;const A={id:_,sourceLayerIndex:E,index:x,geometry:S?I.geometry:Ji(f,i,u),properties:f.properties,type:f.type,patterns:{}},z=this.layoutVertexArray.length;this.hasPattern?this.features.push(qu("fill-extrusion",this.layers,A,this.zoom,r)):this.addFeature(A,A.geometry,x,i,{},r.availableImages),r.featureIndex.insert(f,A.geometry,x,E,this.index,z)}this.sortBorders()}addFeatures(e,r,i,u){for(const f of this.features){const{geometry:_}=f;this.addFeature(f,_,f.index,r,i,u)}this.sortBorders()}update(e,r,i,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,i,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Qc.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,i,u,f,_){const x=this.enableTerrain?new Y:null;for(const S of Jc(r,500)){let I=0,A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(S.length===0||(E=S[0]).every(ee=>ee.x<=0)||E.every(ee=>ee.x>=wn)||E.every(ee=>ee.y<=0)||E.every(ee=>ee.y>=wn))continue;for(let ee=0;ee<S.length;ee++){const ae=S[ee];if(ae.length===0)continue;I+=ae.length;let ge=0;x&&x.startRing(ae[0]);for(let be=0;be<ae.length;be++){const Se=ae[be];if(be>=1){const Ae=ae[be-1];if(!Ee(Se,Ae)){x&&x.append(Se,Ae),A.vertexLength+4>Cr.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ze=Se.sub(Ae)._perp(),Qe=ze.x/(Math.abs(ze.x)+Math.abs(ze.y)),Ke=ze.y>0?1:0,yt=Ae.dist(Se);ge+yt>32768&&(ge=0),j(this.layoutVertexArray,Se.x,Se.y,Qe,Ke,0,0,ge),j(this.layoutVertexArray,Se.x,Se.y,Qe,Ke,0,1,ge),ge+=yt,j(this.layoutVertexArray,Ae.x,Ae.y,Qe,Ke,0,0,ge),j(this.layoutVertexArray,Ae.x,Ae.y,Qe,Ke,0,1,ge);const pt=A.vertexLength;this.indexArray.emplaceBack(pt,pt+2,pt+1),this.indexArray.emplaceBack(pt+1,pt+2,pt+3),A.vertexLength+=4,A.primitiveLength+=2}}}}if(A.vertexLength+I>Cr.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),C[e.type]!=="Polygon")continue;const z=[],N=[],V=A.vertexLength;for(let ee=0;ee<S.length;ee++){const ae=S[ee];if(ae.length!==0){ae!==S[0]&&N.push(z.length/2);for(let ge=0;ge<ae.length;ge++){const be=ae[ge];j(this.layoutVertexArray,be.x,be.y,0,0,1,1,0),z.push(be.x),z.push(be.y),x&&x.currentPolyCount.top++}}}const W=nu(z,N);for(let ee=0;ee<W.length;ee+=3)this.indexArray.emplaceBack(V+W[ee],V+W[ee+2],V+W[ee+1]);A.primitiveLength+=W.length/3,A.vertexLength+=I}var E;if(x&&x.polyCount.length>0){if(x.borders){x.vertexArrayOffset=this.centroidVertexArray.length;const S=x.borders,I=this.featuresOnBorder.push(x)-1;for(let A=0;A<4;A++)S[A][0]!==Number.MAX_VALUE&&this.borders[A].push(I)}this.encodeCentroid(x.borders?void 0:x.centroid(),x)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,f,_,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,i)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[i].borders[e][0])}encodeCentroid(e,r,i=!0){let u,f;if(e)if(e.y!==0){const x=r.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+i;let _=i?this.centroidVertexArray.length:r.vertexArrayOffset;for(const x of r.polyCount){i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let E=0;E<2*x.edges;E++)this.centroidVertexArray.emplace(_++,0,f),this.centroidVertexArray.emplace(_++,u,f);for(let E=0;E<x.top;E++)this.centroidVertexArray.emplace(_++,u,f)}}}function Ee(t,e){return t.x===e.x&&(t.x<0||t.x>wn)||t.y===e.y&&(t.y<0||t.y>wn)}Tt("FillExtrusionBucket",ce,{omit:["layers","features"]}),Tt("PartMetadata",Y);var Ge={paint:new Er({"fill-extrusion-opacity":new Ct(le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new jt(le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ct(le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ct(le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nr(le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new jt(le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new jt(le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ct(le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function zt(t,e){return t.x*e.x+t.y*e.y}function hn(t,e){if(t.length===1){let r=0;const i=e[r++];let u;for(;!u||i.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const f=e[r],_=t[0],x=u.sub(i),E=f.sub(i),S=_.sub(i),I=zt(x,x),A=zt(x,E),z=zt(E,E),N=zt(S,x),V=zt(S,E),W=I*z-A*A,ee=(z*N-A*V)/W,ae=(I*V-A*N)/W,ge=i.z*(1-ee-ae)+u.z*ee+f.z*ae;if(isFinite(ge))return ge}return 1/0}{let r=1/0;for(const i of e)r=Math.min(r,i.z);return r}}function _t(t){const e=new $(t[0],t[1]);return e.z=t[2],e}function qt(t,e,r,i,u,f,_,x){const E=_*u.getElevationAt(t,e,!0,!0),S=f[0]!==0,I=S?f[1]===0?_*(f[0]/7-450):_*function(A,z,N){const V=Math.floor(z[0]/8),W=Math.floor(z[1]/8),ee=10*(z[0]-8*V),ae=10*(z[1]-8*W),ge=A.getElevationAt(V,W,!0,!0),be=A.getMeterToDEM(N),Se=Math.floor(.5*(ee*be-1)),Ae=Math.floor(.5*(ae*be-1)),ze=A.tileCoordToPixel(V,W),Qe=2*Se+1,Ke=2*Ae+1,yt=function(St,Dt,An,sr,Dn){return[St.getElevationAtPixel(Dt,An,!0),St.getElevationAtPixel(Dt+Dn,An,!0),St.getElevationAtPixel(Dt,An+Dn,!0),St.getElevationAtPixel(Dt+sr,An+Dn,!0)]}(A,ze.x-Se,ze.y-Ae,Qe,Ke),pt=Math.abs(yt[0]-yt[1]),Je=Math.abs(yt[2]-yt[3]),mt=Math.abs(yt[0]-yt[2])+Math.abs(yt[1]-yt[3]),vt=Math.min(.25,.5*be*(pt+Je)/Qe),rt=Math.min(.25,.5*be*mt/Ke);return ge+Math.max(vt*ee,rt*ae)}(u,f,x):E;return{base:E+(r===0)?-1:r,top:S?Math.max(I+i,E+r+2):E+i}}const dn=un([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:nn}=dn,Be=un([{name:"a_packed",components:3,type:"Float32"}]),{members:Pe}=Be,Re=y.VectorTileFeature.types,at=Math.cos(Math.PI/180*37.5);class ct{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Gl,this.layoutVertexArray2=new ni,this.indexArray=new uo,this.programConfigurations=new Ts(e.layers,e.zoom),this.segments=new Cr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,i,u){this.hasPattern=Nd("line",this.layers,r);const f=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:I,id:A,index:z,sourceLayerIndex:N}of e){const V=this.layers[0]._featureFilter.needGeometry,W=Ca(I,V);if(!this.layers[0]._featureFilter.filter(new Ht(this.zoom),W,i))continue;const ee=f?f.evaluate(W,{},i):void 0,ae={id:A,properties:I.properties,type:I.type,sourceLayerIndex:N,index:z,geometry:V?W.geometry:Ji(I,i,u),patterns:{},sortKey:ee};_.push(ae)}f&&_.sort((I,A)=>I.sortKey-A.sortKey);const{lineAtlas:x,featureIndex:E}=r,S=this.addConstantDashes(x);for(const I of _){const{geometry:A,index:z,sourceLayerIndex:N}=I;if(S&&this.addFeatureDashes(I,x),this.hasPattern){const V=qu("line",this.layers,I,this.zoom,r);this.patternFeatures.push(V)}else this.addFeature(I,A,z,i,x.positions,r.availableImages);E.insert(e[z].feature,A,z,N,this.index)}}addConstantDashes(e){let r=!1;for(const i of this.layers){const u=i.paint.get("line-dasharray").value,f=i.layout.get("line-cap").value;if(u.kind!=="constant"||f.kind!=="constant")r=!0;else{const _=f.value,x=u.value;if(!x)continue;e.addDash(x.from,_),e.addDash(x.to,_),x.other&&e.addDash(x.other,_)}}return r}addFeatureDashes(e,r){const i=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,_=u.layout.get("line-cap").value;if(f.kind==="constant"&&_.kind==="constant")continue;let x,E,S,I,A,z;if(f.kind==="constant"){const ee=f.value;if(!ee)continue;x=ee.other||ee.to,E=ee.to,S=ee.from}else x=f.evaluate({zoom:i-1},e),E=f.evaluate({zoom:i},e),S=f.evaluate({zoom:i+1},e);_.kind==="constant"?I=A=z=_.value:(I=_.evaluate({zoom:i-1},e),A=_.evaluate({zoom:i},e),z=_.evaluate({zoom:i+1},e)),r.addDash(x,I),r.addDash(E,A),r.addDash(S,z);const N=r.getKey(x,I),V=r.getKey(E,A),W=r.getKey(S,z);e.patterns[u.id]={min:N,mid:V,max:W}}}update(e,r,i,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,i,u)}addFeatures(e,r,i,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,r,i,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Pe)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,i,u,f,_){const x=this.layers[0].layout,E=x.get("line-join").evaluate(e,{}),S=x.get("line-cap").evaluate(e,{}),I=x.get("line-miter-limit"),A=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of r)this.addLine(z,e,E,S,I,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,f,_,u)}addLine(e,r,i,u,f,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ae=0;ae<e.length-1;ae++)this.totalDistance+=e[ae].dist(e[ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=Re[r.type]==="Polygon";let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let S=0;for(;S<E-1&&e[S].equals(e[S+1]);)S++;if(E<(x?3:2))return;i==="bevel"&&(f=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,A=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let z,N,V,W,ee;this.e1=this.e2=-1,x&&(z=e[E-2],ee=e[S].sub(z)._unit()._perp());for(let ae=S;ae<E;ae++){if(V=ae===E-1?x?e[S+1]:void 0:e[ae+1],V&&e[ae].equals(V))continue;ee&&(W=ee),z&&(N=z),z=e[ae],ee=V?V.sub(z)._unit()._perp():W,W=W||ee;let ge=W.add(ee);ge.x===0&&ge.y===0||ge._unit();const be=W.x*ee.x+W.y*ee.y,Se=ge.x*ee.x+ge.y*ee.y,Ae=Se!==0?1/Se:1/0,ze=2*Math.sqrt(2-2*Se),Qe=Se<at&&N&&V,Ke=W.x*ee.y-W.y*ee.x>0;if(Qe&&ae>S){const Je=z.dist(N);if(Je>2*I){const mt=z.sub(z.sub(N)._mult(I/Je)._round());this.updateDistance(N,mt),this.addCurrentVertex(mt,W,0,0,A),N=mt}}const yt=N&&V;let pt=yt?i:x?"butt":u;if(yt&&pt==="round"&&(Ae<_?pt="miter":Ae<=2&&(pt="fakeround")),pt==="miter"&&Ae>f&&(pt="bevel"),pt==="bevel"&&(Ae>2&&(pt="flipbevel"),Ae<f&&(pt="miter")),N&&this.updateDistance(N,z),pt==="miter")ge._mult(Ae),this.addCurrentVertex(z,ge,0,0,A);else if(pt==="flipbevel"){if(Ae>100)ge=ee.mult(-1);else{const Je=Ae*W.add(ee).mag()/W.sub(ee).mag();ge._perp()._mult(Je*(Ke?-1:1))}this.addCurrentVertex(z,ge,0,0,A),this.addCurrentVertex(z,ge.mult(-1),0,0,A)}else if(pt==="bevel"||pt==="fakeround"){const Je=-Math.sqrt(Ae*Ae-1),mt=Ke?Je:0,vt=Ke?0:Je;if(N&&this.addCurrentVertex(z,W,mt,vt,A),pt==="fakeround"){const rt=Math.round(180*ze/Math.PI/20);for(let St=1;St<rt;St++){let Dt=St/rt;if(Dt!==.5){const sr=Dt-.5;Dt+=Dt*sr*(Dt-1)*((1.0904+be*(be*(3.55645-1.43519*be)-3.2452))*sr*sr+(.848013+be*(.215638*be-1.06021)))}const An=ee.sub(W)._mult(Dt)._add(W)._unit()._mult(Ke?-1:1);this.addHalfVertex(z,An.x,An.y,!1,Ke,0,A)}}V&&this.addCurrentVertex(z,ee,-mt,-vt,A)}else if(pt==="butt")this.addCurrentVertex(z,ge,0,0,A);else if(pt==="square"){const Je=N?1:-1;N||this.addCurrentVertex(z,ge,Je,Je,A),this.addCurrentVertex(z,ge,0,0,A),N&&this.addCurrentVertex(z,ge,Je,Je,A)}else pt==="round"&&(N&&(this.addCurrentVertex(z,W,0,0,A),this.addCurrentVertex(z,W,1,1,A,!0)),V&&(this.addCurrentVertex(z,ee,-1,-1,A,!0),this.addCurrentVertex(z,ee,0,0,A)));if(Qe&&ae<E-1){const Je=z.dist(V);if(Je>2*I){const mt=z.add(V.sub(z)._mult(I/Je)._round());this.updateDistance(z,mt),this.addCurrentVertex(mt,ee,0,0,A),z=mt}}}}addCurrentVertex(e,r,i,u,f,_=!1){const x=r.y*u-r.x,E=-r.y-r.x*u;this.addHalfVertex(e,r.x+r.y*i,r.y-r.x*i,_,!1,i,f),this.addHalfVertex(e,x,E,_,!0,-u,f)}addHalfVertex({x:e,y:r},i,u,f,_,x,E){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(r<<1)+(_?1:0),Math.round(63*i)+128,Math.round(63*u)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const S=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),E.primitiveLength++),_?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Tt("LineBucket",ct,{omit:["layers","patternFeatures"]});const _n=new Er({"line-cap":new jt(le.layout_line["line-cap"]),"line-join":new jt(le.layout_line["line-join"]),"line-miter-limit":new Ct(le.layout_line["line-miter-limit"]),"line-round-limit":new Ct(le.layout_line["line-round-limit"]),"line-sort-key":new jt(le.layout_line["line-sort-key"])});var Zt={paint:new Er({"line-opacity":new jt(le.paint_line["line-opacity"]),"line-color":new jt(le.paint_line["line-color"]),"line-translate":new Ct(le.paint_line["line-translate"]),"line-translate-anchor":new Ct(le.paint_line["line-translate-anchor"]),"line-width":new jt(le.paint_line["line-width"]),"line-gap-width":new jt(le.paint_line["line-gap-width"]),"line-offset":new jt(le.paint_line["line-offset"]),"line-blur":new jt(le.paint_line["line-blur"]),"line-dasharray":new Nr(le.paint_line["line-dasharray"]),"line-pattern":new Nr(le.paint_line["line-pattern"]),"line-gradient":new Ho(le.paint_line["line-gradient"])}),layout:_n};const pn=new class extends jt{possiblyEvaluate(t,e){return e=new Ht(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,i){return e=qn({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,i)}}(Zt.paint.properties["line-width"].specification);function Mn(t,e){return e>0?e+2*t:t}pn.useIntegerZoom=!0;const En=un([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),ml=un([{name:"a_projected_pos",components:3,type:"Float32"}],4);un([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Xp=un([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),$x=un([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);un([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gg=un([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Zx=un([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);un([{name:"triangle",components:3,type:"Uint16"}]),un([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),un([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),un([{type:"Float32",name:"offsetX"}]),un([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Bi=24;const gl=128;function Hp(t,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ht(t+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:i,interpolationType:u}=r;let f=0;for(;f<i.length&&i[f]<=t;)f++;f=Math.max(0,f-1);let _=f;for(;_<i.length&&i[_]<t+1;)_++;_=Math.min(i.length-1,_);const x=i[f],E=i[_];return r.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:E,minSize:r.evaluate(new Ht(x)),maxSize:r.evaluate(new Ht(E)),interpolationType:u}}}function Nf(t,{uSize:e,uSizeT:r},{lowerSize:i,upperSize:u}){return t.kind==="source"?i/gl:t.kind==="composite"?Nn(i/gl,u/gl,r):e}function jh(t,e){let r=0,i=0;if(t.kind==="constant")i=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:_}=t,x=u?rn(Ti.interpolationFactor(u,e,f,_),0,1):0;t.kind==="camera"?i=Nn(t.minSize,t.maxSize,x):r=x}return{uSizeT:r,uSize:i}}var Gx=Object.freeze({__proto__:null,getSizeData:Hp,evaluateSizeForFeature:Nf,evaluateSizeForZoom:jh,SIZE_PACK_FACTOR:gl});function qx(t,e,r){return t.sections.forEach(i=>{i.text=function(u,f,_){const x=f.layout.get("text-transform").evaluate(_,{});return x==="uppercase"?u=u.toLocaleUpperCase():x==="lowercase"&&(u=u.toLocaleLowerCase()),Tn.applyArabicShaping&&(u=Tn.applyArabicShaping(u)),u}(i.text,e,r)}),t}const Vd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Wx(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}function Xx(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}var qg=function(t,e,r,i,u){var f,_,x=8*u-i-1,E=(1<<x)-1,S=E>>1,I=-7,A=u-1,z=-1,N=t[e+A];for(A+=z,f=N&(1<<-I)-1,N>>=-I,I+=x;I>0;f=256*f+t[e+A],A+=z,I-=8);for(_=f&(1<<-I)-1,f>>=-I,I+=i;I>0;_=256*_+t[e+A],A+=z,I-=8);if(f===0)f=1-S;else{if(f===E)return _?NaN:1/0*(N?-1:1);_+=Math.pow(2,i),f-=S}return(N?-1:1)*_*Math.pow(2,f-i)},Wg=function(t,e,r,i,u,f){var _,x,E,S=8*f-u-1,I=(1<<S)-1,A=I>>1,z=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=0,V=1,W=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,_=I):(_=Math.floor(Math.log(e)/Math.LN2),e*(E=Math.pow(2,-_))<1&&(_--,E*=2),(e+=_+A>=1?z/E:z*Math.pow(2,1-A))*E>=2&&(_++,E/=2),_+A>=I?(x=0,_=I):_+A>=1?(x=(e*E-1)*Math.pow(2,u),_+=A):(x=e*Math.pow(2,A-1)*Math.pow(2,u),_=0));u>=8;t[r+N]=255&x,N+=V,x/=256,u-=8);for(_=_<<u|x,S+=u;S>0;t[r+N]=255&_,N+=V,_/=256,S-=8);t[r+N-V]|=128*W},$d=or;function or(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}or.Varint=0,or.Fixed64=1,or.Bytes=2,or.Fixed32=5;var Yp=4294967296,Xg=1/Yp,Hg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function au(t){return t.type===or.Bytes?t.readVarint()+t.pos:t.pos+1}function Vh(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Yg(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var u=r.pos-1;u>=t;u--)r.buf[u+i]=r.buf[u]}function Hx(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Yx(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function Kx(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Jx(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Qx(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function e0(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function t0(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function n0(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function r0(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function Uf(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function $h(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function Kg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function i0(t,e,r){e.glyphs=[],t===1&&r.readMessage(o0,e)}function o0(t,e,r){if(t===3){const{id:i,bitmap:u,width:f,height:_,left:x,top:E,advance:S}=r.readMessage(s0,{});e.glyphs.push({id:i,bitmap:new ri({width:f+6,height:_+6},u),metrics:{width:f,height:_,left:x,top:E,advance:S}})}else t===4?e.ascender=r.readSVarint():t===5&&(e.descender=r.readSVarint())}function s0(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}function Kp(t){let e=0,r=0;for(const _ of t)e+=_.w*_.h,r=Math.max(r,_.w);t.sort((_,x)=>x.h-_.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,f=0;for(const _ of t)for(let x=i.length-1;x>=0;x--){const E=i[x];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,f=Math.max(f,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===E.w&&_.h===E.h){const S=i.pop();x<i.length&&(i[x]=S)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(i.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}or.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),u=i>>3,f=this.pos;this.type=7&i,t(u,e,this),this.pos===f&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Uf(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Kg(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Uf(this.buf,this.pos)+Uf(this.buf,this.pos+4)*Yp;return this.pos+=8,t},readSFixed64:function(){var t=Uf(this.buf,this.pos)+Kg(this.buf,this.pos+4)*Yp;return this.pos+=8,t},readFloat:function(){var t=qg(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=qg(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return e=127&(r=i[this.pos++]),r<128?e:(e|=(127&(r=i[this.pos++]))<<7,r<128?e:(e|=(127&(r=i[this.pos++]))<<14,r<128?e:(e|=(127&(r=i[this.pos++]))<<21,r<128?e:function(u,f,_){var x,E,S=_.buf;if(x=(112&(E=S[_.pos++]))>>4,E<128||(x|=(127&(E=S[_.pos++]))<<3,E<128)||(x|=(127&(E=S[_.pos++]))<<10,E<128)||(x|=(127&(E=S[_.pos++]))<<17,E<128)||(x|=(127&(E=S[_.pos++]))<<24,E<128)||(x|=(1&(E=S[_.pos++]))<<31,E<128))return Vh(u,x,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Hg?function(r,i,u){return Hg.decode(r.subarray(i,u))}(this.buf,e,t):function(r,i,u){for(var f="",_=i;_<u;){var x,E,S,I=r[_],A=null,z=I>239?4:I>223?3:I>191?2:1;if(_+z>u)break;z===1?I<128&&(A=I):z===2?(192&(x=r[_+1]))==128&&(A=(31&I)<<6|63&x)<=127&&(A=null):z===3?(E=r[_+2],(192&(x=r[_+1]))==128&&(192&E)==128&&((A=(15&I)<<12|(63&x)<<6|63&E)<=2047||A>=55296&&A<=57343)&&(A=null)):z===4&&(E=r[_+2],S=r[_+3],(192&(x=r[_+1]))==128&&(192&E)==128&&(192&S)==128&&((A=(15&I)<<18|(63&x)<<12|(63&E)<<6|63&S)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,z=1):A>65535&&(A-=65536,f+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),f+=String.fromCharCode(A),_+=z}return f}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==or.Bytes)return t.push(this.readVarint(e));var r=au(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==or.Bytes)return t.push(this.readSVarint());var e=au(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==or.Bytes)return t.push(this.readBoolean());var e=au(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==or.Bytes)return t.push(this.readFloat());var e=au(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==or.Bytes)return t.push(this.readDouble());var e=au(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==or.Bytes)return t.push(this.readFixed32());var e=au(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==or.Bytes)return t.push(this.readSFixed32());var e=au(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==or.Bytes)return t.push(this.readFixed64());var e=au(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==or.Bytes)return t.push(this.readSFixed64());var e=au(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===or.Varint)for(;this.buf[this.pos++]>127;);else if(e===or.Bytes)this.pos=this.readVarint()+this.pos;else if(e===or.Fixed32)this.pos+=4;else{if(e!==or.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),$h(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),$h(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),$h(this.buf,-1&t,this.pos),$h(this.buf,Math.floor(t*Xg),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),$h(this.buf,-1&t,this.pos),$h(this.buf,Math.floor(t*Xg),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var i,u;if(e>=0?(i=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(f,_,x){x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,x.buf[x.pos]=127&(f>>>=7)}(i,0,r),function(f,_){var x=(7&f)<<4;_.buf[_.pos++]|=x|((f>>>=3)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f)))))}(u,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(i,u,f){for(var _,x,E=0;E<u.length;E++){if((_=u.charCodeAt(E))>55295&&_<57344){if(!x){_>56319||E+1===u.length?(i[f++]=239,i[f++]=191,i[f++]=189):x=_;continue}if(_<56320){i[f++]=239,i[f++]=191,i[f++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(i[f++]=239,i[f++]=191,i[f++]=189,x=null);_<128?i[f++]=_:(_<2048?i[f++]=_>>6|192:(_<65536?i[f++]=_>>12|224:(i[f++]=_>>18|240,i[f++]=_>>12&63|128),i[f++]=_>>6&63|128),i[f++]=63&_|128)}return f}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&Yg(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Wg(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Wg(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&Yg(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,or.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Hx,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Yx,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Qx,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Kx,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Jx,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,e0,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,t0,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,n0,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,r0,e)},writeBytesField:function(t,e){this.writeTag(t,or.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,or.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,or.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,or.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,or.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,or.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,or.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,or.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,or.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,or.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};class Jp{constructor(e,{pixelRatio:r,version:i,stretchX:u,stretchY:f,content:_}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=f,this.content=_,this.version=i}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Jg{constructor(e,r){const i={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,i,f),this.addImages(r,u,f);const{w:_,h:x}=Kp(f),E=new po({width:_||1,height:x||1});for(const S in e){const I=e[S],A=i[S].paddedRect;po.copy(I.data,E,{x:0,y:0},{x:A.x+1,y:A.y+1},I.data)}for(const S in r){const I=r[S],A=u[S].paddedRect,z=A.x+1,N=A.y+1,V=I.data.width,W=I.data.height;po.copy(I.data,E,{x:0,y:0},{x:z,y:N},I.data),po.copy(I.data,E,{x:0,y:W-1},{x:z,y:N-1},{width:V,height:1}),po.copy(I.data,E,{x:0,y:0},{x:z,y:N+W},{width:V,height:1}),po.copy(I.data,E,{x:V-1,y:0},{x:z-1,y:N},{width:1,height:W}),po.copy(I.data,E,{x:0,y:0},{x:z+V,y:N},{width:1,height:W})}this.image=E,this.iconPositions=i,this.patternPositions=u}addImages(e,r,i){for(const u in e){const f=e[u],_={x:0,y:0,w:f.data.width+2,h:f.data.height+2};i.push(_),r[u]=new Jp(_,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in e.updatedImages)this.patchUpdatedImage(this.iconPositions[i],e.getImage(i),r),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i),r)}patchUpdatedImage(e,r,i){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,f]=e.tl;i.update(r.data,void 0,{x:u,y:f})}}Tt("ImagePosition",Jp),Tt("ImageAtlas",Jg);const Cs={horizontal:1,vertical:2,horizontalOnly:3};class Zd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const i=new Zd;return i.scale=e||1,i.fontStack=r,i}static forImage(e){const r=new Zd;return r.imageName=e,r}}class Zh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const i=new Zh;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?i.addImageSection(f):i.addTextSection(f,r)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,i){let u="";for(let f=0;f<r.length;f++){const _=r.charCodeAt(f+1)||null,x=r.charCodeAt(f-1)||null;u+=!i&&(_&&Rt(_)&&!Vd[r[f+1]]||x&&Rt(x)&&!Vd[r[f-1]])||!Vd[r[f]]?r[f]:Vd[r[f]]}return u}(this.text,e)}trim(){let e=0;for(let i=0;i<this.text.length&&jf[this.text.charCodeAt(i)];i++)e++;let r=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&jf[this.text.charCodeAt(i)];i--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const i=new Zh;return i.text=this.text.substring(e,r),i.sectionIndex=this.sectionIndex.slice(e,r),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Zd.forText(e.scale,e.fontStack||r));const i=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(i)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Kn("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(Zd.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Kn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Qp(t,e,r,i,u,f,_,x,E,S,I,A,z,N,V,W){const ee=Zh.fromFeature(t,u);let ae;A===Cs.vertical&&ee.verticalizePunctuation(z);const{processBidirectionalText:ge,processStyledBidirectionalText:be}=Tn;if(ge&&ee.sections.length===1){ae=[];const ze=ge(ee.toString(),em(ee,S,f,e,i,N,V));for(const Qe of ze){const Ke=new Zh;Ke.text=Qe,Ke.sections=ee.sections;for(let yt=0;yt<Qe.length;yt++)Ke.sectionIndex.push(0);ae.push(Ke)}}else if(be){ae=[];const ze=be(ee.text,ee.sectionIndex,em(ee,S,f,e,i,N,V));for(const Qe of ze){const Ke=new Zh;Ke.text=Qe[0],Ke.sectionIndex=Qe[1],Ke.sections=ee.sections,ae.push(Ke)}}else ae=function(ze,Qe){const Ke=[],yt=ze.text;let pt=0;for(const Je of Qe)Ke.push(ze.substring(pt,Je)),pt=Je;return pt<yt.length&&Ke.push(ze.substring(pt,yt.length)),Ke}(ee,em(ee,S,f,e,i,N,V));const Se=[],Ae={positionedLines:Se,text:ee.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ze,Qe,Ke,yt,pt,Je,mt,vt,rt,St,Dt,An){let sr=0,Dn=0,Ln=0;const dt=vt==="right"?1:vt==="left"?0:.5;let $n=!1;for(const Zn of pt){const Cn=Zn.getSections();for(const vr of Cn){if(vr.imageName)continue;const jr=Qe[vr.fontStack];if(jr&&($n=jr.ascender!==void 0&&jr.descender!==void 0,!$n))break}if(!$n)break}let Fn=0;for(const Zn of pt){Zn.trim();const Cn=Zn.getMaxScale(),vr=(Cn-1)*Bi,jr={positionedGlyphs:[],lineOffset:0};ze.positionedLines[Fn]=jr;const zr=jr.positionedGlyphs;let Jr=0;if(!Zn.length()){Dn+=Je,++Fn;continue}let Fi=0,Do=0;for(let mr=0;mr<Zn.length();mr++){const pi=Zn.getSection(mr),ea=Zn.getSectionIndex(mr),Ii=Zn.getCharCode(mr);let tr=pi.scale,mi=null,xr=null,eo=null,ii=Bi,to=0;const mo=!(rt===Cs.horizontal||!Dt&&!Ye(Ii)||Dt&&(jf[Ii]||(Ur=Ii,n(Ur)||l(Ur)||m(Ur)||ye(Ur)||ot(Ur))));if(pi.imageName){const go=yt[pi.imageName];if(!go)continue;eo=pi.imageName,ze.iconsInText=ze.iconsInText||!0,xr=go.paddedRect;const gi=go.displaySize;tr=tr*Bi/An,mi={width:gi[0],height:gi[1],left:1,top:-3,advance:mo?gi[1]:gi[0],localGlyph:!1},to=$n?-mi.height*tr:Cn*Bi-17-gi[1]*tr,ii=mi.advance;const Oa=(mo?gi[0]:gi[1])*tr-Bi*Cn;Oa>0&&Oa>Jr&&(Jr=Oa)}else{const go=Ke[pi.fontStack];if(!go)continue;go[Ii]&&(xr=go[Ii]);const gi=Qe[pi.fontStack];if(!gi)continue;const Oa=gi.glyphs[Ii];if(!Oa)continue;if(mi=Oa.metrics,ii=Ii!==8203?Bi:0,$n){const Yh=gi.ascender!==void 0?Math.abs(gi.ascender):0,Yd=gi.descender!==void 0?Math.abs(gi.descender):0,Kd=(Yh+Yd)*tr;Fi<Kd&&(Fi=Kd,Do=(Yh-Yd)/2*tr),to=-Yh*tr}else to=(Cn-tr)*Bi-17}mo?(ze.verticalizable=!0,zr.push({glyph:Ii,imageName:eo,x:sr,y:Dn+to,vertical:mo,scale:tr,localGlyph:mi.localGlyph,fontStack:pi.fontStack,sectionIndex:ea,metrics:mi,rect:xr}),sr+=ii*tr+St):(zr.push({glyph:Ii,imageName:eo,x:sr,y:Dn+to,vertical:mo,scale:tr,localGlyph:mi.localGlyph,fontStack:pi.fontStack,sectionIndex:ea,metrics:mi,rect:xr}),sr+=mi.advance*tr+St)}zr.length!==0&&(Ln=Math.max(sr-St,Ln),$n?r_(zr,dt,Jr,Do,Je*Cn/2):r_(zr,dt,Jr,0,Je/2)),sr=0;const Lo=Je*Cn+Jr;jr.lineOffset=Math.max(Jr,vr),Dn+=Lo,++Fn}var Ur;const Pr=Dn,{horizontalAlign:fi,verticalAlign:Qi}=tm(mt);(function(Zn,Cn,vr,jr,zr,Jr){const Fi=(Cn-vr)*zr,Do=-Jr*jr;for(const Lo of Zn)for(const mr of Lo.positionedGlyphs)mr.x+=Fi,mr.y+=Do})(ze.positionedLines,dt,fi,Qi,Ln,Pr),ze.top+=-Qi*Pr,ze.bottom=ze.top+Pr,ze.left+=-fi*Ln,ze.right=ze.left+Ln,ze.hasBaseline=$n}(Ae,e,r,i,ae,_,x,E,A,S,z,W),!function(ze){for(const Qe of ze)if(Qe.positionedGlyphs.length!==0)return!1;return!0}(Se)&&Ae}const jf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},a0={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Qg(t,e,r,i,u,f){if(e.imageName){const _=i[e.imageName];return _?_.displaySize[0]*e.scale*Bi/f+u:0}{const _=r[e.fontStack],x=_&&_.glyphs[t];return x?x.metrics.advance*e.scale+u:0}}function e_(t,e,r,i){const u=Math.pow(t-e,2);return i?t<e?u/2:2*u:u+Math.abs(r)*r}function l0(t,e,r){let i=0;return t===10&&(i-=1e4),r&&(i+=150),t!==40&&t!==65288||(i+=50),e!==41&&e!==65289||(i+=50),i}function t_(t,e,r,i,u,f){let _=null,x=e_(e,r,u,f);for(const E of i){const S=e_(e-E.x,r,u,f)+E.badness;S<=x&&(_=E,x=S)}return{index:t,x:e,priorBreak:_,badness:x}}function n_(t){return t?n_(t.priorBreak).concat(t.index):[]}function em(t,e,r,i,u,f,_){if(f!=="point")return[];if(!t)return[];const x=[],E=function(z,N,V,W,ee,ae){let ge=0;for(let be=0;be<z.length();be++){const Se=z.getSection(be);ge+=Qg(z.getCharCode(be),Se,W,ee,N,ae)}return ge/Math.max(1,Math.ceil(ge/V))}(t,e,r,i,u,_),S=t.text.indexOf("")>=0;let I=0;for(let z=0;z<t.length();z++){const N=t.getSection(z),V=t.getCharCode(z);if(jf[V]||(I+=Qg(V,N,i,u,e,_)),z<t.length()-1){const W=!((A=V)<11904||!(U(A)||B(A)||Ue(A)||fe(A)||te(A)||v(A)||q(A)||P(A)||_e(A)||J(A)||K(A)||nt(A)||D(A)||T(A)||b(A)||Q(A)||O(A)||Le(A)||pe(A)||me(A)));(a0[V]||W||N.imageName)&&x.push(t_(z+1,I,E,x,l0(V,t.getCharCode(z+1),W&&S),!1))}}var A;return n_(t_(t.length(),I,E,x,0,!0))}function tm(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function r_(t,e,r,i,u){if(!(e||r||i||u))return;const f=t.length-1,_=t[f],x=(_.x+_.metrics.advance*_.scale)*e;for(let E=0;E<=f;E++)t[E].x-=x,t[E].y+=r+i+u}function u0(t,e,r){const{horizontalAlign:i,verticalAlign:u}=tm(r),f=e[0]-t.displaySize[0]*i,_=e[1]-t.displaySize[1]*u;return{image:t,top:_,bottom:_+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function i_(t,e,r,i,u,f){const _=t.image;let x;if(_.content){const ee=_.content,ae=_.pixelRatio||1;x=[ee[0]/ae,ee[1]/ae,_.displaySize[0]-ee[2]/ae,_.displaySize[1]-ee[3]/ae]}const E=e.left*f,S=e.right*f;let I,A,z,N;r==="width"||r==="both"?(N=u[0]+E-i[3],A=u[0]+S+i[1]):(N=u[0]+(E+S-_.displaySize[0])/2,A=N+_.displaySize[0]);const V=e.top*f,W=e.bottom*f;return r==="height"||r==="both"?(I=u[1]+V-i[0],z=u[1]+W+i[2]):(I=u[1]+(V+W-_.displaySize[1])/2,z=I+_.displaySize[1]),{image:_,top:I,right:A,bottom:z,left:N,collisionPadding:x}}class lu extends ${constructor(e,r,i,u,f){super(e,r),this.angle=u,this.z=i,f!==void 0&&(this.segment=f)}clone(){return new lu(this.x,this.y,this.z,this.angle,this.segment)}}function o_(t,e,r,i,u){if(e.segment===void 0)return!0;let f=e,_=e.segment+1,x=0;for(;x>-r/2;){if(_--,_<0)return!1;x-=t[_].dist(f),f=t[_]}x+=t[_].dist(t[_+1]),_++;const E=[];let S=0;for(;x<r/2;){const I=t[_],A=t[_+1];if(!A)return!1;let z=t[_-1].angleTo(I)-I.angleTo(A);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:z}),S+=z;x-E[0].distance>i;)S-=E.shift().angleDelta;if(S>u)return!1;_++,x+=I.dist(A)}return!0}function s_(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function a_(t,e,r){return t?.6*e*r:0}function l_(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function c0(t,e,r,i,u,f){const _=a_(r,u,f),x=l_(r,i)*f;let E=0;const S=s_(t)/2;for(let I=0;I<t.length-1;I++){const A=t[I],z=t[I+1],N=A.dist(z);if(E+N>S){const V=(S-E)/N,W=Nn(A.x,z.x,V),ee=Nn(A.y,z.y,V),ae=new lu(W,ee,0,z.angleTo(A),I);return!_||o_(t,ae,x,_,e)?ae:void 0}E+=N}}function h0(t,e,r,i,u,f,_,x,E){const S=a_(i,f,_),I=l_(i,u),A=I*_,z=t[0].x===0||t[0].x===E||t[0].y===0||t[0].y===E;return e-A<e/4&&(e=A+e/4),u_(t,z?e/2*x%e:(I/2+2*f)*_*x%e,e,S,r,A,z,!1,E)}function u_(t,e,r,i,u,f,_,x,E){const S=f/2,I=s_(t);let A=0,z=e-r,N=[];for(let V=0;V<t.length-1;V++){const W=t[V],ee=t[V+1],ae=W.dist(ee),ge=ee.angleTo(W);for(;z+r<A+ae;){z+=r;const be=(z-A)/ae,Se=Nn(W.x,ee.x,be),Ae=Nn(W.y,ee.y,be);if(Se>=0&&Se<E&&Ae>=0&&Ae<E&&z-S>=0&&z+S<=I){const ze=new lu(Se,Ae,0,ge,V);ze._round(),i&&!o_(t,ze,f,i,u)||N.push(ze)}}A+=ae}return x||N.length||_||(N=u_(t,A/2,r,i,u,f,_,!0,E)),N}function c_(t,e,r,i,u){const f=[];for(let _=0;_<t.length;_++){const x=t[_];let E;for(let S=0;S<x.length-1;S++){let I=x[S],A=x[S+1];I.x<e&&A.x<e||(I.x<e?I=new $(e,I.y+(e-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x<e&&(A=new $(e,I.y+(e-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y<r&&A.y<r||(I.y<r?I=new $(I.x+(r-I.y)/(A.y-I.y)*(A.x-I.x),r)._round():A.y<r&&(A=new $(I.x+(r-I.y)/(A.y-I.y)*(A.x-I.x),r)._round()),I.x>=i&&A.x>=i||(I.x>=i?I=new $(i,I.y+(i-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x>=i&&(A=new $(i,I.y+(i-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y>=u&&A.y>=u||(I.y>=u?I=new $(I.x+(u-I.y)/(A.y-I.y)*(A.x-I.x),u)._round():A.y>=u&&(A=new $(I.x+(u-I.y)/(A.y-I.y)*(A.x-I.x),u)._round()),E&&I.equals(E[E.length-1])||(E=[I],f.push(E)),E.push(A)))))}}return f}Tt("Anchor",lu);const Vf=1e20;function h_(t,e,r,i,u,f,_,x,E){for(let S=e;S<e+i;S++)d_(t,r*f+S,f,u,_,x,E);for(let S=r;S<r+u;S++)d_(t,S*f+e,1,i,_,x,E)}function d_(t,e,r,i,u,f,_){f[0]=0,_[0]=-1e20,_[1]=Vf,u[0]=t[e];for(let x=1,E=0,S=0;x<i;x++){u[x]=t[e+x*r];const I=x*x;do{const A=f[E];S=(u[x]-u[A]+I-A*A)/(x-A)/2}while(S<=_[E]&&--E>-1);E++,f[E]=x,_[E]=S,_[E+1]=Vf}for(let x=0,E=0;x<i;x++){for(;_[E+1]<x;)E++;const S=f[E],I=x-S;t[e+x*r]=u[S]+I*I}}const nm={none:0,ideographs:1,all:2};class Gh{constructor(e,r,i){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=i,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const i=[];for(const u in e)for(const f of e[u])i.push({stack:u,id:f});os(i,({stack:u,id:f},_)=>{let x=this.entries[u];x||(x=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[f];if(E!==void 0)return void _(null,{stack:u,id:f,glyph:E});if(E=this._tinySDF(x,u,f),E)return x.glyphs[f]=E,void _(null,{stack:u,id:f,glyph:E});const S=Math.floor(f/256);if(256*S>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[S])return void _(null,{stack:u,id:f,glyph:E});let I=x.requests[S];I||(I=x.requests[S]=[],Gh.loadGlyphRange(u,S,this.url,this.requestManager,(A,z)=>{if(z){x.ascender=z.ascender,x.descender=z.descender;for(const N in z.glyphs)this._doesCharSupportLocalGlyph(+N)||(x.glyphs[+N]=z.glyphs[+N]);x.ranges[S]=!0}for(const N of I)N(A,z);delete x.requests[S]})),I.push((A,z)=>{A?_(A):z&&_(null,{stack:u,id:f,glyph:z.glyphs[f]||null})})},(u,f)=>{if(u)r(u);else if(f){const _={};for(const{stack:x,id:E,glyph:S}of f)_[x]===void 0&&(_[x]={}),_[x].glyphs===void 0&&(_[x].glyphs={}),_[x].glyphs[E]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;r(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==nm.none&&(this.localGlyphMode===nm.all?!!this.localFontFamily:!!this.localFontFamily&&(J(e)||he(e)||D(e)||O(e))||P(e))}_tinySDF(e,r,i){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(i))return;let f=e.tinySDF;if(!f){let W="400";/bold/i.test(r)?W="900":/medium/i.test(r)?W="500":/light/i.test(r)&&(W="200"),f=e.tinySDF=new Gh.TinySDF({fontFamily:u,fontWeight:W,fontSize:48,buffer:6,radius:16}),f.fontWeight=W}if(this.localGlyphs[f.fontWeight][i])return this.localGlyphs[f.fontWeight][i];const _=String.fromCharCode(i),{data:x,width:E,height:S,glyphWidth:I,glyphHeight:A,glyphLeft:z,glyphTop:N,glyphAdvance:V}=f.draw(_);return this.localGlyphs[f.fontWeight][i]={id:i,bitmap:new ri({width:E,height:S},x),metrics:{width:I/2,height:A/2,left:z/2,top:N/2-27,advance:V/2,localGlyph:!0}}}}function f_(t,e,r,i){const u=[],f=t.image,_=f.pixelRatio,x=f.paddedRect.w-2,E=f.paddedRect.h-2,S=t.right-t.left,I=t.bottom-t.top,A=f.stretchX||[[0,x]],z=f.stretchY||[[0,E]],N=(Je,mt)=>Je+mt[1]-mt[0],V=A.reduce(N,0),W=z.reduce(N,0),ee=x-V,ae=E-W;let ge=0,be=V,Se=0,Ae=W,ze=0,Qe=ee,Ke=0,yt=ae;if(f.content&&i){const Je=f.content;ge=$f(A,0,Je[0]),Se=$f(z,0,Je[1]),be=$f(A,Je[0],Je[2]),Ae=$f(z,Je[1],Je[3]),ze=Je[0]-ge,Ke=Je[1]-Se,Qe=Je[2]-Je[0]-be,yt=Je[3]-Je[1]-Ae}const pt=(Je,mt,vt,rt)=>{const St=Zf(Je.stretch-ge,be,S,t.left),Dt=Gf(Je.fixed-ze,Qe,Je.stretch,V),An=Zf(mt.stretch-Se,Ae,I,t.top),sr=Gf(mt.fixed-Ke,yt,mt.stretch,W),Dn=Zf(vt.stretch-ge,be,S,t.left),Ln=Gf(vt.fixed-ze,Qe,vt.stretch,V),dt=Zf(rt.stretch-Se,Ae,I,t.top),$n=Gf(rt.fixed-Ke,yt,rt.stretch,W),Fn=new $(St,An),Ur=new $(Dn,An),Pr=new $(Dn,dt),fi=new $(St,dt),Qi=new $(Dt/_,sr/_),Zn=new $(Ln/_,$n/_),Cn=e*Math.PI/180;if(Cn){const zr=Math.sin(Cn),Jr=Math.cos(Cn),Fi=[Jr,-zr,zr,Jr];Fn._matMult(Fi),Ur._matMult(Fi),fi._matMult(Fi),Pr._matMult(Fi)}const vr=Je.stretch+Je.fixed,jr=mt.stretch+mt.fixed;return{tl:Fn,tr:Ur,bl:fi,br:Pr,tex:{x:f.paddedRect.x+1+vr,y:f.paddedRect.y+1+jr,w:vt.stretch+vt.fixed-vr,h:rt.stretch+rt.fixed-jr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qi,pixelOffsetBR:Zn,minFontScaleX:Qe/_/S,minFontScaleY:yt/_/I,isSDF:r}};if(i&&(f.stretchX||f.stretchY)){const Je=p_(A,ee,V),mt=p_(z,ae,W);for(let vt=0;vt<Je.length-1;vt++){const rt=Je[vt],St=Je[vt+1];for(let Dt=0;Dt<mt.length-1;Dt++)u.push(pt(rt,mt[Dt],St,mt[Dt+1]))}}else u.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return u}function $f(t,e,r){let i=0;for(const u of t)i+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return i}function p_(t,e,r){const i=[{fixed:-1,stretch:0}];for(const[u,f]of t){const _=i[i.length-1];i.push({fixed:u-_.stretch,stretch:_.stretch}),i.push({fixed:u-_.stretch,stretch:_.stretch+(f-u)})}return i.push({fixed:e+1,stretch:r}),i}function Zf(t,e,r,i){return t/e*r+i}function Gf(t,e,r,i){return t-e*r/i}function d0(t,e,r,i){const u=e+t.positionedLines[i].lineOffset;return i===0?r+u/2:r+(u+(e+t.positionedLines[i-1].lineOffset))/2}Gh.loadGlyphRange=function(t,e,r,i,u){const f=256*e,_=f+255,x=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${f}-${_}`),gr.Glyphs);Zi(x,(E,S)=>{if(E)u(E);else if(S){const I={},A=function(z){return new $d(z).readFields(i0,{})}(S);for(const z of A.glyphs)I[z.id]=z;u(null,{glyphs:I,ascender:A.ascender,descender:A.descender})}})},Gh.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:i=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:_="normal"}){this.buffer=e,this.cutoff=i,this.radius=r;const x=this.size=t+4*e,E=this._createCanvas(x),S=this.ctx=E.getContext("2d",{willReadFrequently:!0});S.font=`${_} ${f} ${t}px ${u}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(t),_=Math.floor(r),x=Math.min(this.size-this.buffer,Math.ceil(f-u)),E=Math.min(this.size-this.buffer,Math.ceil(r)+Math.ceil(i)),S=x+2*this.buffer,I=E+2*this.buffer,A=S*I,z=new Uint8ClampedArray(A),N={data:z,width:S,height:I,glyphWidth:x,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(x===0||E===0)return N;const{ctx:V,buffer:W,gridInner:ee,gridOuter:ae}=this;V.clearRect(W,W,x,E),V.fillText(t,W,W+_+1);const ge=V.getImageData(W,W,x,E);ae.fill(Vf,0,A),ee.fill(0,0,A);for(let be=0;be<E;be++)for(let Se=0;Se<x;Se++){const Ae=ge.data[4*(be*x+Se)+3]/255;if(Ae===0)continue;const ze=(be+W)*S+Se+W;if(Ae===1)ae[ze]=0,ee[ze]=Vf;else{const Qe=.5-Ae;ae[ze]=Qe>0?Qe*Qe:0,ee[ze]=Qe<0?Qe*Qe:0}}h_(ae,0,0,S,I,S,this.f,this.v,this.z),h_(ee,W,W,x,E,S,this.f,this.v,this.z);for(let be=0;be<A;be++){const Se=Math.sqrt(ae[be])-Math.sqrt(ee[be]);z[be]=Math.round(255-255*(Se/this.radius+this.cutoff))}return N}};class f0{constructor(e=[],r=p0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:i}=this,u=r[e];for(;e>0;){const f=e-1>>1,_=r[f];if(i(u,_)>=0)break;r[e]=_,e=f}r[e]=u}_down(e){const{data:r,compare:i}=this,u=this.length>>1,f=r[e];for(;e<u;){let _=1+(e<<1),x=r[_];const E=_+1;if(E<this.length&&i(r[E],x)<0&&(_=E,x=r[E]),i(x,f)>=0)break;r[e]=x,e=_}r[e]=f}}function p0(t,e){return t<e?-1:t>e?1:0}function m0(t,e=1,r=!1){let i=1/0,u=1/0,f=-1/0,_=-1/0;const x=t[0];for(let N=0;N<x.length;N++){const V=x[N];(!N||V.x<i)&&(i=V.x),(!N||V.y<u)&&(u=V.y),(!N||V.x>f)&&(f=V.x),(!N||V.y>_)&&(_=V.y)}const E=Math.min(f-i,_-u);let S=E/2;const I=new f0([],g0);if(E===0)return new $(i,u);for(let N=i;N<f;N+=E)for(let V=u;V<_;V+=E)I.push(new qh(N+S,V+S,S,t));let A=function(N){let V=0,W=0,ee=0;const ae=N[0];for(let ge=0,be=ae.length,Se=be-1;ge<be;Se=ge++){const Ae=ae[ge],ze=ae[Se],Qe=Ae.x*ze.y-ze.x*Ae.y;W+=(Ae.x+ze.x)*Qe,ee+=(Ae.y+ze.y)*Qe,V+=3*Qe}return new qh(W/V,ee/V,0,N)}(t),z=I.length;for(;I.length;){const N=I.pop();(N.d>A.d||!A.d)&&(A=N,r&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,z)),N.max-A.d<=e||(S=N.h/2,I.push(new qh(N.p.x-S,N.p.y-S,S,t)),I.push(new qh(N.p.x+S,N.p.y-S,S,t)),I.push(new qh(N.p.x-S,N.p.y+S,S,t)),I.push(new qh(N.p.x+S,N.p.y+S,S,t)),z+=4)}return r&&(console.log(`num probes: ${z}`),console.log(`best distance: ${A.d}`)),A.p}function g0(t,e){return e.max-t.max}function qh(t,e,r,i){this.p=new $(t,e),this.h=r,this.d=function(u,f){let _=!1,x=1/0;for(let E=0;E<f.length;E++){const S=f[E];for(let I=0,A=S.length,z=A-1;I<A;z=I++){const N=S[I],V=S[z];N.y>u.y!=V.y>u.y&&u.x<(V.x-N.x)*(u.y-N.y)/(V.y-N.y)+N.x&&(_=!_),x=Math.min(x,eu(u,N,V))}}return(_?1:-1)*Math.sqrt(x)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}const rm=Number.POSITIVE_INFINITY,_0=Math.sqrt(2);function m_(t,e){return e[1]!==rm?function(r,i,u){let f=0,_=0;switch(i=Math.abs(i),u=Math.abs(u),r){case"top-right":case"top-left":case"top":_=u-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-u}switch(r){case"top-right":case"bottom-right":case"right":f=-i;break;case"top-left":case"bottom-left":case"left":f=i}return[f,_]}(t,e[0],e[1]):function(r,i){let u=0,f=0;i<0&&(i=0);const _=i/_0;switch(r){case"top-right":case"top-left":f=_-7;break;case"bottom-right":case"bottom-left":f=7-_;break;case"bottom":f=7-i;break;case"top":f=i-7}switch(r){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=i;break;case"right":u=-i}return[u,f]}(t,e[0])}function y0(t,e,r,i,u,f,_,x,E,S){t.createArrays(),t.tilePixelRatio=wn/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const I=t.layers[0].layout,A=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){const{minZoom:W,maxZoom:ee}=t.textSizeData;z.compositeTextSizes=[A["text-size"].possiblyEvaluate(new Ht(W),x),A["text-size"].possiblyEvaluate(new Ht(ee),x)]}if(t.iconSizeData.kind==="composite"){const{minZoom:W,maxZoom:ee}=t.iconSizeData;z.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new Ht(W),x),A["icon-size"].possiblyEvaluate(new Ht(ee),x)]}z.layoutTextSize=A["text-size"].possiblyEvaluate(new Ht(E+1),x),z.layoutIconSize=A["icon-size"].possiblyEvaluate(new Ht(E+1),x),z.textMaxSize=A["text-size"].possiblyEvaluate(new Ht(18),x);const N=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",V=I.get("text-size");for(const W of t.features){const ee=I.get("text-font").evaluate(W,{},x).join(","),ae=V.evaluate(W,{},x),ge=z.layoutTextSize.evaluate(W,{},x),be=(z.layoutIconSize.evaluate(W,{},x),{horizontal:{},vertical:void 0}),Se=W.text;let Ae,ze=[0,0];if(Se){const yt=Se.toString(),pt=I.get("text-letter-spacing").evaluate(W,{},x)*Bi,Je=I.get("text-line-height").evaluate(W,{},x)*Bi,mt=Ne(yt)?pt:0,vt=I.get("text-anchor").evaluate(W,{},x),rt=I.get("text-variable-anchor");if(!rt){const Ln=I.get("text-radial-offset").evaluate(W,{},x);ze=Ln?m_(vt,[Ln*Bi,rm]):I.get("text-offset").evaluate(W,{},x).map(dt=>dt*Bi)}let St=N?"center":I.get("text-justify").evaluate(W,{},x);const Dt=I.get("symbol-placement"),An=Dt==="point",sr=Dt==="point"?I.get("text-max-width").evaluate(W,{},x)*Bi:0,Dn=Ln=>{t.allowVerticalPlacement&&qe(yt)&&(be.vertical=Qp(Se,e,r,u,ee,sr,Je,vt,Ln,mt,ze,Cs.vertical,!0,Dt,ge,ae))};if(!N&&rt){const Ln=St==="auto"?rt.map($n=>im($n)):[St];let dt=!1;for(let $n=0;$n<Ln.length;$n++){const Fn=Ln[$n];if(!be.horizontal[Fn])if(dt)be.horizontal[Fn]=be.horizontal[0];else{const Ur=Qp(Se,e,r,u,ee,sr,Je,"center",Fn,mt,ze,Cs.horizontal,!1,Dt,ge,ae);Ur&&(be.horizontal[Fn]=Ur,dt=Ur.positionedLines.length===1)}}Dn("left")}else{if(St==="auto"&&(St=im(vt)),An||I.get("text-writing-mode").indexOf("horizontal")>=0||!qe(yt)){const Ln=Qp(Se,e,r,u,ee,sr,Je,vt,St,mt,ze,Cs.horizontal,!1,Dt,ge,ae);Ln&&(be.horizontal[St]=Ln)}Dn(Dt==="point"?"left":St)}}let Qe=!1;if(W.icon&&W.icon.name){const yt=i[W.icon.name];yt&&(Ae=u0(u[W.icon.name],I.get("icon-offset").evaluate(W,{},x),I.get("icon-anchor").evaluate(W,{},x)),Qe=yt.sdf,t.sdfIcons===void 0?t.sdfIcons=yt.sdf:t.sdfIcons!==yt.sdf&&Kn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(yt.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Ke=__(be.horizontal)||be.vertical;t.iconsInText||(t.iconsInText=!!Ke&&Ke.iconsInText),(Ke||Ae)&&v0(t,W,be,Ae,i,z,ge,0,ze,Qe,_,x,S)}f&&t.generateCollisionDebugBuffers(E,t.collisionBoxArray)}function im(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function v0(t,e,r,i,u,f,_,x,E,S,I,A,z){let N=f.textMaxSize.evaluate(e,{},A);N===void 0&&(N=_);const V=t.layers[0].layout,W=V.get("icon-offset").evaluate(e,{},A),ee=__(r.horizontal)||r.vertical,ae=_/24,ge=t.tilePixelRatio*N/24,be=t.tilePixelRatio*V.get("symbol-spacing"),Se=V.get("text-padding")*t.tilePixelRatio,Ae=V.get("icon-padding")*t.tilePixelRatio,ze=en(V.get("text-max-angle")),Qe=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Ke=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",yt=V.get("symbol-placement"),pt=be/2,Je=V.get("icon-text-fit");let mt;i&&Je!=="none"&&(t.allowVerticalPlacement&&r.vertical&&(mt=i_(i,r.vertical,Je,V.get("icon-text-fit-padding"),W,ae)),ee&&(i=i_(i,ee,Je,V.get("icon-text-fit-padding"),W,ae)));const vt=(rt,St,Dt)=>{if(St.x<0||St.x>=wn||St.y<0||St.y>=wn)return;const{x:An,y:sr,z:Dn}=z.projectTilePoint(St.x,St.y,Dt),Ln=new lu(An,sr,Dn,0,void 0);(function(dt,$n,Fn,Ur,Pr,fi,Qi,Zn,Cn,vr,jr,zr,Jr,Fi,Do,Lo,mr,pi,ea,Ii,tr,mi,xr,eo,ii){const to=dt.addToLineVertexArray($n,Ur);let mo,go,gi,Oa,Yh,Yd,Kd,J_=0,Q_=0,ey=0,ty=0,Em=-1,Tm=-1;const xl={};let ny=Bu(""),Sm=0,Mm=0;if(Cn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Sm,Mm]=Cn.layout.get("text-offset").evaluate(tr,{},ii).map(ts=>ts*Bi):(Sm=Cn.layout.get("text-radial-offset").evaluate(tr,{},ii)*Bi,Mm=rm),dt.allowVerticalPlacement&&Pr.vertical){const ts=Pr.vertical;if(Do)Yd=om(ts),Zn&&(Kd=om(Zn));else{const ns=Cn.layout.get("text-rotate").evaluate(tr,{},ii)+90;gi=qf(vr,Fn,$n,jr,zr,Jr,ts,Fi,ns,Lo),Zn&&(Oa=qf(vr,Fn,$n,jr,zr,Jr,Zn,pi,ns))}}if(fi){const ts=Cn.layout.get("icon-rotate").evaluate(tr,{},ii),ns=Cn.layout.get("icon-text-fit")!=="none",Jd=f_(fi,ts,xr,ns),Pm=Zn?f_(Zn,ts,xr,ns):void 0;go=qf(vr,Fn,$n,jr,zr,Jr,fi,pi,ts),J_=4*Jd.length;const ry=dt.iconSizeData;let sh=null;ry.kind==="source"?(sh=[gl*Cn.layout.get("icon-size").evaluate(tr,{},ii)],sh[0]>Xu&&Kn(`${dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ry.kind==="composite"&&(sh=[gl*mi.compositeIconSizes[0].evaluate(tr,{},ii),gl*mi.compositeIconSizes[1].evaluate(tr,{},ii)],(sh[0]>Xu||sh[1]>Xu)&&Kn(`${dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),dt.addSymbols(dt.icon,Jd,sh,Ii,ea,tr,!1,Fn,$n,to.lineStartIndex,to.lineLength,-1,eo,ii),Em=dt.icon.placedSymbolArray.length-1,Pm&&(Q_=4*Pm.length,dt.addSymbols(dt.icon,Pm,sh,Ii,ea,tr,Cs.vertical,Fn,$n,to.lineStartIndex,to.lineLength,-1,eo,ii),Tm=dt.icon.placedSymbolArray.length-1)}for(const ts in Pr.horizontal){const ns=Pr.horizontal[ts];mo||(ny=Bu(ns.text),Do?Yh=om(ns):mo=qf(vr,Fn,$n,jr,zr,Jr,ns,Fi,Cn.layout.get("text-rotate").evaluate(tr,{},ii),Lo));const Jd=ns.positionedLines.length===1;if(ey+=g_(dt,Fn,$n,ns,Qi,Cn,Do,tr,Lo,to,Pr.vertical?Cs.horizontal:Cs.horizontalOnly,Jd?Object.keys(Pr.horizontal):[ts],xl,Em,mi,eo,ii),Jd)break}Pr.vertical&&(ty+=g_(dt,Fn,$n,Pr.vertical,Qi,Cn,Do,tr,Lo,to,Cs.vertical,["vertical"],xl,Tm,mi,eo,ii));let Qu=-1;const Cm=(ts,ns)=>ts?Math.max(ts,ns):ns;Qu=Cm(Yh,Qu),Qu=Cm(Yd,Qu),Qu=Cm(Kd,Qu);const X0=Qu>-1?1:0;dt.glyphOffsetArray.length>=Hu.MAX_GLYPHS&&Kn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tr.sortKey!==void 0&&dt.addToSortKeyRanges(dt.symbolInstances.length,tr.sortKey),dt.symbolInstances.emplaceBack(Fn.x,Fn.y,Fn.z,$n.x,$n.y,xl.right>=0?xl.right:-1,xl.center>=0?xl.center:-1,xl.left>=0?xl.left:-1,xl.vertical>=0?xl.vertical:-1,Em,Tm,ny,mo!==void 0?mo:dt.collisionBoxArray.length,mo!==void 0?mo+1:dt.collisionBoxArray.length,gi!==void 0?gi:dt.collisionBoxArray.length,gi!==void 0?gi+1:dt.collisionBoxArray.length,go!==void 0?go:dt.collisionBoxArray.length,go!==void 0?go+1:dt.collisionBoxArray.length,Oa||dt.collisionBoxArray.length,Oa?Oa+1:dt.collisionBoxArray.length,jr,ey,ty,J_,Q_,X0,0,Sm,Mm,Qu)})(t,St,Ln,rt,r,i,u,mt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Se,Qe,E,0,Ae,Ke,W,e,f,S,I,A)};if(yt==="line")for(const rt of c_(e.geometry,0,0,wn,wn)){const St=h0(rt,be,ze,r.vertical||ee,i,24,ge,t.overscaling,wn);for(const Dt of St){const An=ee;An&&x0(t,An.text,pt,Dt)||vt(rt,Dt,A)}}else if(yt==="line-center"){for(const rt of e.geometry)if(rt.length>1){const St=c0(rt,ze,r.vertical||ee,i,24,ge);St&&vt(rt,St,A)}}else if(e.type==="Polygon")for(const rt of Jc(e.geometry,0)){const St=m0(rt,16);vt(rt[0],new lu(St.x,St.y,0,0,void 0),A)}else if(e.type==="LineString")for(const rt of e.geometry)vt(rt,new lu(rt[0].x,rt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const rt of e.geometry)for(const St of rt)vt([St],new lu(St.x,St.y,0,0,void 0),A)}const Xu=32640;function g_(t,e,r,i,u,f,_,x,E,S,I,A,z,N,V,W,ee){const ae=function(Se,Ae,ze,Qe,Ke,yt,pt,Je){const mt=[];if(Ae.positionedLines.length===0)return mt;const vt=Qe.layout.get("text-rotate").evaluate(yt,{})*Math.PI/180,rt=function(Dn){const Ln=Dn[0],dt=Dn[1],$n=Ln*dt;return $n>0?[Ln,-dt]:$n<0?[-Ln,dt]:Ln===0?[dt,Ln]:[dt,-Ln]}(ze);let St=Math.abs(Ae.top-Ae.bottom);for(const Dn of Ae.positionedLines)St-=Dn.lineOffset;const Dt=Ae.positionedLines.length,An=St/Dt;let sr=Ae.top-ze[1];for(let Dn=0;Dn<Dt;++Dn){const Ln=Ae.positionedLines[Dn];sr=d0(Ae,An,sr,Dn);for(const dt of Ln.positionedGlyphs){if(!dt.rect)continue;const $n=dt.rect||{};let Fn=4,Ur=!0,Pr=1,fi=0;if(dt.imageName){const xr=pt[dt.imageName];if(!xr)continue;if(xr.sdf){Kn("SDF images are not supported in formatted text and will be ignored.");continue}Ur=!1,Pr=xr.pixelRatio,Fn=1/Pr}const Qi=(Ke||Je)&&dt.vertical,Zn=dt.metrics.advance*dt.scale/2,Cn=dt.metrics,vr=dt.rect;if(vr===null)continue;Je&&Ae.verticalizable&&(fi=dt.imageName?Zn-dt.metrics.width*dt.scale/2:0);const jr=Ke?[dt.x+Zn,dt.y]:[0,0];let zr=[0,0],Jr=[0,0],Fi=!1;Ke||(Qi?(Jr=[dt.x+Zn+rt[0],dt.y+rt[1]-fi],Fi=!0):zr=[dt.x+Zn+ze[0],dt.y+ze[1]-fi]);const Do=vr.w*dt.scale/(Pr*(dt.localGlyph?2:1)),Lo=vr.h*dt.scale/(Pr*(dt.localGlyph?2:1));let mr,pi,ea,Ii;if(Qi){const xr=dt.y-sr,eo=new $(-Zn,Zn-xr),ii=-Math.PI/2,to=new $(...Jr);mr=new $(-Zn+zr[0],zr[1]),mr._rotateAround(ii,eo)._add(to),mr.x+=-xr+Zn,mr.y-=(Cn.left-Fn)*dt.scale;const mo=dt.imageName?Cn.advance*dt.scale:Bi*dt.scale,go=String.fromCharCode(dt.glyph);Wx(go)?mr.x+=(1-Fn)*dt.scale:Xx(go)?mr.x+=mo-Cn.height*dt.scale+(-Fn-1)*dt.scale:mr.x+=dt.imageName||Cn.width+2*Fn===vr.w&&Cn.height+2*Fn===vr.h?(mo-Lo)/2:(mo-(Cn.height+2*Fn)*dt.scale)/2,pi=new $(mr.x,mr.y-Do),ea=new $(mr.x+Lo,mr.y),Ii=new $(mr.x+Lo,mr.y-Do)}else{const xr=(Cn.left-Fn)*dt.scale-Zn+zr[0],eo=(-Cn.top-Fn)*dt.scale+zr[1],ii=xr+Do,to=eo+Lo;mr=new $(xr,eo),pi=new $(ii,eo),ea=new $(xr,to),Ii=new $(ii,to)}if(vt){let xr;xr=Ke?new $(0,0):Fi?new $(rt[0],rt[1]):new $(ze[0],ze[1]),mr._rotateAround(vt,xr),pi._rotateAround(vt,xr),ea._rotateAround(vt,xr),Ii._rotateAround(vt,xr)}const tr=new $(0,0),mi=new $(0,0);mt.push({tl:mr,tr:pi,bl:ea,br:Ii,tex:$n,writingMode:Ae.writingMode,glyphOffset:jr,sectionIndex:dt.sectionIndex,isSDF:Ur,pixelOffsetTL:tr,pixelOffsetBR:mi,minFontScaleX:0,minFontScaleY:0})}}return mt}(0,i,E,f,_,x,u,t.allowVerticalPlacement),ge=t.textSizeData;let be=null;ge.kind==="source"?(be=[gl*f.layout.get("text-size").evaluate(x,{},ee)],be[0]>Xu&&Kn(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ge.kind==="composite"&&(be=[gl*V.compositeTextSizes[0].evaluate(x,{},ee),gl*V.compositeTextSizes[1].evaluate(x,{},ee)],(be[0]>Xu||be[1]>Xu)&&Kn(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,ae,be,E,_,x,I,e,r,S.lineStartIndex,S.lineLength,N,W,ee);for(const Se of A)z[Se]=t.text.placedSymbolArray.length-1;return 4*ae.length}function __(t){for(const e in t)return t[e];return null}function qf(t,e,r,i,u,f,_,x,E,S){let I=_.top,A=_.bottom,z=_.left,N=_.right;const V=_.collisionPadding;if(V&&(z-=V[0],I-=V[1],N+=V[2],A+=V[3]),E){const W=new $(z,I),ee=new $(N,I),ae=new $(z,A),ge=new $(N,A),be=en(E);let Se=new $(0,0);S&&(Se=new $(S[0],S[1])),W._rotateAround(be,Se),ee._rotateAround(be,Se),ae._rotateAround(be,Se),ge._rotateAround(be,Se),z=Math.min(W.x,ee.x,ae.x,ge.x),N=Math.max(W.x,ee.x,ae.x,ge.x),I=Math.min(W.y,ee.y,ae.y,ge.y),A=Math.max(W.y,ee.y,ae.y,ge.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,z,I,N,A,x,i,u,f),t.length-1}function om(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function x0(t,e,r,i){const u=t.compareText;if(e in u){const f=u[e];for(let _=f.length-1;_>=0;_--)if(i.dist(f[_])<r)return!0}else u[e]=[];return u[e].push(i),!1}const b0=y.VectorTileFeature.types,w0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wf(t,e,r,i,u,f,_,x,E,S,I,A,z,N,V,W){const ee=I?Math.min(Xu,Math.round(I[0])):0,ae=I?Math.min(Xu,Math.round(I[1])):0;t.emplaceBack(e,r,Math.round(32*_),Math.round(32*x),E,S,(ee<<1)+(A?1:0),ae,16*z,16*N,256*V,256*W,i,u,f,0)}function sm(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}function E0(t){for(const e of t.sections)if(ft(e.text))return!0;return!1}class am{constructor(e){this.layoutVertexArray=new Ta,this.indexArray=new uo,this.programConfigurations=e,this.segments=new Cr,this.dynamicLayoutVertexArray=new ni,this.opacityVertexArray=new Sa,this.placedSymbolArray=new Ed}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,i,u){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,En.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ml.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,w0,!0),this.opacityVertexBuffer.itemSize=1),(i||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Tt("SymbolBuffers",am);class lm{constructor(e,r,i){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new i,this.segments=new Cr,this.collisionVertexArray=new Mh,this.collisionVertexArrayExt=new ni}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Xp.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,$x.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Tt("CollisionBuffers",lm);class Hu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=He([]),this.placementViewportMatrix=He([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Hp(this.zoom,r["text-size"]),this.iconSizeData=Hp(this.zoom,r["icon-size"]);const i=this.layers[0].layout,u=i.get("symbol-sort-key"),f=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map(_=>Cs[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new am(new Ts(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new am(new Ts(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new zh,this.lineVertexArray=new Bc,this.symbolInstances=new xf}calculateGlyphDependencies(e,r,i,u,f){for(let _=0;_<e.length;_++)if(r[e.charCodeAt(_)]=!0,u&&f){const x=Vd[e.charAt(_)];x&&(r[x.charCodeAt(0)]=!0)}}populate(e,r,i,u){const f=this.layers[0],_=f.layout,x=_.get("text-font"),E=_.get("text-field"),S=_.get("icon-image"),I=(E.value.kind!=="constant"||E.value.value instanceof sn&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),A=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,z=_.get("symbol-sort-key");if(this.features=[],!I&&!A)return;const N=r.iconDependencies,V=r.glyphDependencies,W=r.availableImages,ee=new Ht(this.zoom);for(const{feature:ae,id:ge,index:be,sourceLayerIndex:Se}of e){const Ae=f._featureFilter.needGeometry,ze=Ca(ae,Ae);if(!f._featureFilter.filter(ee,ze,i))continue;let Qe,Ke;if(Ae||(ze.geometry=Ji(ae,i,u)),I){const pt=f.getValueAndResolveTokens("text-field",ze,i,W),Je=sn.factory(pt);E0(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||di()==="unavailable"||this.hasRTLText&&Tn.isParsed())&&(Qe=qx(Je,f,ze))}if(A){const pt=f.getValueAndResolveTokens("icon-image",ze,i,W);Ke=pt instanceof wi?pt:wi.fromString(pt)}if(!Qe&&!Ke)continue;const yt=this.sortFeaturesByKey?z.evaluate(ze,{},i):void 0;if(this.features.push({id:ge,text:Qe,icon:Ke,index:be,sourceLayerIndex:Se,geometry:ze.geometry,properties:ae.properties,type:b0[ae.type],sortKey:yt}),Ke&&(N[Ke.name]=!0),Qe){const pt=x.evaluate(ze,{},i).join(","),Je=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Cs.vertical)>=0;for(const mt of Qe.sections)if(mt.image)N[mt.image.name]=!0;else{const vt=qe(Qe.toString()),rt=mt.fontStack||pt,St=V[rt]=V[rt]||{};this.calculateGlyphDependencies(mt.text,St,Je,this.allowVerticalPlacement,vt)}}}_.get("symbol-placement")==="line"&&(this.features=function(ae){const ge={},be={},Se=[];let Ae=0;function ze(pt){Se.push(ae[pt]),Ae++}function Qe(pt,Je,mt){const vt=be[pt];return delete be[pt],be[Je]=vt,Se[vt].geometry[0].pop(),Se[vt].geometry[0]=Se[vt].geometry[0].concat(mt[0]),vt}function Ke(pt,Je,mt){const vt=ge[Je];return delete ge[Je],ge[pt]=vt,Se[vt].geometry[0].shift(),Se[vt].geometry[0]=mt[0].concat(Se[vt].geometry[0]),vt}function yt(pt,Je,mt){const vt=mt?Je[0][Je[0].length-1]:Je[0][0];return`${pt}:${vt.x}:${vt.y}`}for(let pt=0;pt<ae.length;pt++){const Je=ae[pt],mt=Je.geometry,vt=Je.text?Je.text.toString():null;if(!vt){ze(pt);continue}const rt=yt(vt,mt),St=yt(vt,mt,!0);if(rt in be&&St in ge&&be[rt]!==ge[St]){const Dt=Ke(rt,St,mt),An=Qe(rt,St,Se[Dt].geometry);delete ge[rt],delete be[St],be[yt(vt,Se[An].geometry,!0)]=An,Se[Dt].geometry=null}else rt in be?Qe(rt,St,mt):St in ge?Ke(rt,St,mt):(ze(pt),ge[rt]=Ae-1,be[St]=Ae-1)}return Se.filter(pt=>pt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ae,ge)=>ae.sortKey-ge.sortKey)}update(e,r,i,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,i,u),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,i,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const i=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(r[e.segment+1]),f=e.dist(r[e.segment]);const _={};for(let x=e.segment+1;x<r.length;x++)_[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:u},x<r.length-1&&(u+=r[x+1].dist(r[x]));for(let x=e.segment||0;x>=0;x--)_[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:f},x>0&&(f+=r[x-1].dist(r[x]));for(let x=0;x<r.length;x++){const E=_[x];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,r,i,u,f,_,x,E,S,I,A,z,N,V){const W=e.indexArray,ee=e.layoutVertexArray,ae=e.segments.prepareSegment(4*r.length,ee,W,this.canOverlap?_.sortKey:void 0),ge=this.glyphOffsetArray.length,be=ae.vertexLength,Se=this.allowVerticalPlacement&&x===Cs.vertical?Math.PI/2:0,Ae=_.text&&_.text.sections;for(let ze=0;ze<r.length;ze++){const{tl:Qe,tr:Ke,bl:yt,br:pt,tex:Je,pixelOffsetTL:mt,pixelOffsetBR:vt,minFontScaleX:rt,minFontScaleY:St,glyphOffset:Dt,isSDF:An,sectionIndex:sr}=r[ze],Dn=ae.vertexLength,Ln=Dt[1];Wf(ee,E.x,E.y,E.z,S.x,S.y,Qe.x,Ln+Qe.y,Je.x,Je.y,i,An,mt.x,mt.y,rt,St),Wf(ee,E.x,E.y,E.z,S.x,S.y,Ke.x,Ln+Ke.y,Je.x+Je.w,Je.y,i,An,vt.x,mt.y,rt,St),Wf(ee,E.x,E.y,E.z,S.x,S.y,yt.x,Ln+yt.y,Je.x,Je.y+Je.h,i,An,mt.x,vt.y,rt,St),Wf(ee,E.x,E.y,E.z,S.x,S.y,pt.x,Ln+pt.y,Je.x+Je.w,Je.y+Je.h,i,An,vt.x,vt.y,rt,St),sm(e.dynamicLayoutVertexArray,E,Se),W.emplaceBack(Dn,Dn+1,Dn+2),W.emplaceBack(Dn+1,Dn+2,Dn+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dt[0]),ze!==r.length-1&&sr===r[ze+1].sectionIndex||e.programConfigurations.populatePaintArrays(ee.length,_,_.index,{},N,V,Ae&&Ae[sr])}e.placedSymbolArray.emplaceBack(E.x,E.y,E.z,S.x,S.y,ge,this.glyphOffsetArray.length-ge,be,I,A,S.segment,i?i[0]:0,i?i[1]:0,u[0],u[1],x,0,!1,0,z,0)}_commitLayoutVertex(e,r,i,u,f,_,x){e.emplaceBack(r,i,u,f,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,r,i,u,f,_,x){const E=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),S=E.vertexLength,I=x.tileAnchorX,A=x.tileAnchorY;for(let N=0;N<4;N++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),i.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(i.layoutVertexArray,u,f,_,I,A,new $(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,u,f,_,I,A,new $(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,u,f,_,I,A,new $(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,u,f,_,I,A,new $(e.x1,e.y2)),E.vertexLength+=4;const z=i.indexArray;z.emplaceBack(S,S+1),z.emplaceBack(S+1,S+2),z.emplaceBack(S+2,S+3),z.emplaceBack(S+3,S),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,i,u,f,_){for(let x=u;x<f;x++){const E=i.get(x),S=this.getSymbolInstanceTextSize(e,_,r,x);this._addCollisionDebugVertices(E,S,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,r,i,u,f,_){for(let x=u;x<f;x++){const E=i.get(x),S=this.getSymbolInstanceIconSize(e,r,x);this._addCollisionDebugVertices(E,S,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lm(ul,Gg.members,Zs),this.iconCollisionBox=new lm(ul,Gg.members,Zs);const i=jh(this.iconSizeData,e),u=jh(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,r,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(u,e,r,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(i,e,r,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(i,e,r,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,r,i,u){const f=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:u),_=Nf(this.textSizeData,e,f)/Bi;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,r,i){const u=this.icon.placedSymbolArray.get(i),f=Nf(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,r,i){e.emplaceBack(r,-i,-i),e.emplaceBack(r,i,-i),e.emplaceBack(r,i,i),e.emplaceBack(r,-i,i)}_updateTextDebugCollisionBoxes(e,r,i,u,f,_){for(let x=u;x<f;x++){const E=i.get(x),S=this.getSymbolInstanceTextSize(e,_,r,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,E.padding)}}_updateIconDebugCollisionBoxes(e,r,i,u,f){for(let _=u;_<f;_++){const x=i.get(_),E=this.getSymbolInstanceIconSize(e,r,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,x.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=jh(this.iconSizeData,e),u=jh(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,r,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(u,e,r,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(i,e,r,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(i,e,r,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,i,u,f,_,x,E,S){const I={};for(let A=r;A<i;A++){const z=e.get(A);I.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},I.textFeatureIndex=z.featureIndex;break}for(let A=u;A<f;A++){const z=e.get(A);I.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},I.verticalTextFeatureIndex=z.featureIndex;break}for(let A=_;A<x;A++){const z=e.get(A);I.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},I.iconFeatureIndex=z.featureIndex;break}for(let A=E;A<S;A++){const z=e.get(A);I.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},I.verticalIconFeatureIndex=z.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const i=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const i=e.placedSymbolArray.get(r),u=i.vertexStartIndex+4*i.numGlyphs;for(let f=i.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),i=Math.cos(e),u=[],f=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const E=this.symbolInstances.get(x);u.push(0|Math.round(r*E.tileAnchorX+i*E.tileAnchorY)),f.push(E.featureIndex)}return _.sort((x,E)=>u[x]-u[E]||f[E]-f[x]),_}addToSortKeyRanges(e,r){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===r?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const i=this.symbolInstances.get(r);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((u,f,_)=>{u>=0&&_.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)}),i.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),i.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),i.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Tt("SymbolBucket",Hu,{omit:["layers","collisionBoxArray","features","compareText"]}),Hu.MAX_GLYPHS=65535,Hu.addDynamicAttributes=sm;const T0=new Er({"symbol-placement":new Ct(le.layout_symbol["symbol-placement"]),"symbol-spacing":new Ct(le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ct(le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new jt(le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ct(le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ct(le.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ct(le.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ct(le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ct(le.layout_symbol["icon-rotation-alignment"]),"icon-size":new jt(le.layout_symbol["icon-size"]),"icon-text-fit":new Ct(le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ct(le.layout_symbol["icon-text-fit-padding"]),"icon-image":new jt(le.layout_symbol["icon-image"]),"icon-rotate":new jt(le.layout_symbol["icon-rotate"]),"icon-padding":new Ct(le.layout_symbol["icon-padding"]),"icon-keep-upright":new Ct(le.layout_symbol["icon-keep-upright"]),"icon-offset":new jt(le.layout_symbol["icon-offset"]),"icon-anchor":new jt(le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ct(le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ct(le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ct(le.layout_symbol["text-rotation-alignment"]),"text-field":new jt(le.layout_symbol["text-field"]),"text-font":new jt(le.layout_symbol["text-font"]),"text-size":new jt(le.layout_symbol["text-size"]),"text-max-width":new jt(le.layout_symbol["text-max-width"]),"text-line-height":new jt(le.layout_symbol["text-line-height"]),"text-letter-spacing":new jt(le.layout_symbol["text-letter-spacing"]),"text-justify":new jt(le.layout_symbol["text-justify"]),"text-radial-offset":new jt(le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ct(le.layout_symbol["text-variable-anchor"]),"text-anchor":new jt(le.layout_symbol["text-anchor"]),"text-max-angle":new Ct(le.layout_symbol["text-max-angle"]),"text-writing-mode":new Ct(le.layout_symbol["text-writing-mode"]),"text-rotate":new jt(le.layout_symbol["text-rotate"]),"text-padding":new Ct(le.layout_symbol["text-padding"]),"text-keep-upright":new Ct(le.layout_symbol["text-keep-upright"]),"text-transform":new jt(le.layout_symbol["text-transform"]),"text-offset":new jt(le.layout_symbol["text-offset"]),"text-allow-overlap":new Ct(le.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ct(le.layout_symbol["text-ignore-placement"]),"text-optional":new Ct(le.layout_symbol["text-optional"])});var um={paint:new Er({"icon-opacity":new jt(le.paint_symbol["icon-opacity"]),"icon-color":new jt(le.paint_symbol["icon-color"]),"icon-halo-color":new jt(le.paint_symbol["icon-halo-color"]),"icon-halo-width":new jt(le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new jt(le.paint_symbol["icon-halo-blur"]),"icon-translate":new Ct(le.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ct(le.paint_symbol["icon-translate-anchor"]),"text-opacity":new jt(le.paint_symbol["text-opacity"]),"text-color":new jt(le.paint_symbol["text-color"],{runtimeType:ro,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new jt(le.paint_symbol["text-halo-color"]),"text-halo-width":new jt(le.paint_symbol["text-halo-width"]),"text-halo-blur":new jt(le.paint_symbol["text-halo-blur"]),"text-translate":new Ct(le.paint_symbol["text-translate"]),"text-translate-anchor":new Ct(le.paint_symbol["text-translate-anchor"])}),layout:T0};class y_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ps,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tt("FormatSectionOverride",y_,{omit:["defaultValue"]});class Xf extends Ko{constructor(e){super(e,um)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const u=[];for(const f of i)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,i,u){const f=this.layout.get(e).evaluate(r,{},i,u),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||pa(_.value)||!f?f:function(x,E){return E.replace(/{([^{}]+)}/g,(S,I)=>I in x?String(x[I]):"")}(r.properties,f)}createBucket(e){return new Hu(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of um.paint.overridableProperties){if(!Xf.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),i=new y_(r),u=new Au(i,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new _s("source",u):new tl("composite",u,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new yr(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,i){return!(!this.layout||r.isDataDriven()||i.isDataDriven())&&Xf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const i=e.get("text-field"),u=um.paint.properties[r];let f=!1;const _=x=>{for(const E of x)if(u.overrides&&u.overrides.hasOverride(E))return void(f=!0)};if(i.value.kind==="constant"&&i.value.value instanceof sn)_(i.value.value.sections);else if(i.value.kind==="source"){const x=S=>{f||(S instanceof Ei&&_r(S.value)===zs?_(S.value.sections):S instanceof Hi?_(S.sections):S.eachChild(x))},E=i.value;E._styleExpression&&x(E._styleExpression.expression)}return f}getProgramConfiguration(e){return new Ws(this,e)}}var S0={paint:new Er({"background-color":new Ct(le.paint_background["background-color"]),"background-pattern":new Xo(le.paint_background["background-pattern"]),"background-opacity":new Ct(le.paint_background["background-opacity"])})},M0={paint:new Er({"raster-opacity":new Ct(le.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ct(le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ct(le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ct(le.paint_raster["raster-brightness-max"]),"raster-saturation":new Ct(le.paint_raster["raster-saturation"]),"raster-contrast":new Ct(le.paint_raster["raster-contrast"]),"raster-resampling":new Ct(le.paint_raster["raster-resampling"]),"raster-fade-duration":new Ct(le.paint_raster["raster-fade-duration"])})};class C0 extends Ko{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var P0={paint:new Er({"sky-type":new Ct(le.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ct(le.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ct(le.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ct(le.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ct(le.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ho(le.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ct(le.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ct(le.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ct(le.paint_sky["sky-opacity"])})};function cm(t,e,r){const i=Nt(0,0,1),u=Lr(Pn());return function(f,_,x){x*=.5;var E=_[0],S=_[1],I=_[2],A=_[3],z=Math.sin(x),N=Math.cos(x);f[0]=E*N-I*z,f[1]=S*N+A*z,f[2]=I*N+E*z,f[3]=A*N-S*z}(u,u,r?-en(t)+Math.PI:en(t)),Ai(u,u,-en(e)),wt(i,i,u),Qt(i,i)}const I0={circle:class extends Ko{constructor(t){super(t,Ia)}createBucket(t){return new Uu(t)}queryRadius(t){const e=t;return Io("circle-radius",this,e)+Io("circle-stroke-width",this,e)+pl(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,i,u,f,_,x){const E=Oh(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Gc(t,i,f,_,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,S)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Ws(this,t)}},heatmap:class extends Ko{createBucket(t){return new fo(t)}constructor(t){super(t,$u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Io("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,i,u,f,_,x){const E=this.paint.get("heatmap-radius").evaluate(e,r);return Gc(t,i,f,_,x,!0,!0,new $(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Ws(this,t)}},hillshade:class extends Ko{constructor(t){super(t,Fp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new Ws(this,t)}},fill:class extends Ko{constructor(t){super(t,Ud)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(t){return new Ws(this,t)}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Wu(t)}queryRadius(){return pl(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,i,u,f){return!t.queryGeometry.isAboveHorizon&&Ql(ju(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends Ko{constructor(t){super(t,Ge)}createBucket(t){return new ce(t)}queryRadius(){return pl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Ws(this,t)}queryIntersectsFeature(t,e,r,i,u,f,_,x,E){const S=Oh(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,r),A=this.paint.get("fill-extrusion-base").evaluate(e,r),z=[0,0],N=x&&f.elevation,V=f.elevation?f.elevation.exaggeration():1;if(N){const ae=t.tile.getBucket(this).centroidVertexArray,ge=E+1;if(ge<ae.length){const be=ae.get(ge);z[0]=be.a_centroid_pos0,z[1]=be.a_centroid_pos1}}if(z[0]===0&&z[1]===1)return!1;const W=function(ae,ge,be,Se,Ae,ze,Qe,Ke,yt){return ze?function(pt,Je,mt,vt,rt,St,Dt,An,sr){const Dn=[],Ln=[],dt=[0,0,0,1];for(const $n of pt){const Fn=[],Ur=[];for(const Pr of $n){const fi=Pr.x+vt.x,Qi=Pr.y+vt.y,Zn=qt(fi,Qi,Je,mt,St,Dt,An,sr);dt[0]=fi,dt[1]=Qi,dt[2]=Zn.base,dt[3]=1,ar(dt,dt,rt),dt[3]=Math.max(dt[3],1e-5);const Cn=_t([dt[0]/dt[3],dt[1]/dt[3],dt[2]/dt[3]]);dt[0]=fi,dt[1]=Qi,dt[2]=Zn.top,dt[3]=1,ar(dt,dt,rt),dt[3]=Math.max(dt[3],1e-5);const vr=_t([dt[0]/dt[3],dt[1]/dt[3],dt[2]/dt[3]]);Fn.push(Cn),Ur.push(vr)}Dn.push(Fn),Ln.push(Ur)}return[Dn,Ln]}(ae,ge,be,Se,Ae,ze,Qe,Ke,yt):function(pt,Je,mt,vt,rt){const St=[],Dt=[],An=rt[8]*Je,sr=rt[9]*Je,Dn=rt[10]*Je,Ln=rt[11]*Je,dt=rt[8]*mt,$n=rt[9]*mt,Fn=rt[10]*mt,Ur=rt[11]*mt;for(const Pr of pt){const fi=[],Qi=[];for(const Zn of Pr){const Cn=Zn.x+vt.x,vr=Zn.y+vt.y,jr=rt[0]*Cn+rt[4]*vr+rt[12],zr=rt[1]*Cn+rt[5]*vr+rt[13],Jr=rt[2]*Cn+rt[6]*vr+rt[14],Fi=rt[3]*Cn+rt[7]*vr+rt[15],Do=jr+An,Lo=zr+sr,mr=Jr+Dn,pi=Math.max(Fi+Ln,1e-5),ea=jr+dt,Ii=zr+$n,tr=Jr+Fn,mi=Math.max(Fi+Ur,1e-5),xr=new $(Do/pi,Lo/pi);xr.z=mr/pi,fi.push(xr);const eo=new $(ea/mi,Ii/mi);eo.z=tr/mi,Qi.push(eo)}St.push(fi),Dt.push(Qi)}return[St,Dt]}(ae,ge,be,Se,Ae)}(i,A,I,S,_,N?x:null,z,V,f.center.lat),ee=t.queryGeometry;return function(ae,ge,be){let Se=1/0;Ql(be,ge)&&(Se=hn(be,ge[0]));for(let Ae=0;Ae<ge.length;Ae++){const ze=ge[Ae],Qe=ae[Ae];for(let Ke=0;Ke<ze.length-1;Ke++){const yt=ze[Ke],pt=[yt,ze[Ke+1],Qe[Ke+1],Qe[Ke],yt];Jl(be,pt)&&(Se=Math.min(Se,hn(be,pt)))}}return Se!==1/0&&Se}(W[0],W[1],ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends Ko{constructor(t){super(t,Zt),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Pl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=pn.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new ct(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Ws(this,t)}queryRadius(t){const e=t,r=Mn(Io("line-width",this,e),Io("line-gap-width",this,e)),i=Io("line-offset",this,e);return r/2+Math.abs(i)+pl(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,i,u,f){if(t.queryGeometry.isAboveHorizon)return!1;const _=ju(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),x=t.pixelToTileUnitsFactor/2*Mn(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),E=this.paint.get("line-offset").evaluate(e,r);return E&&(i=function(S,I){const A=[],z=new $(0,0);for(let N=0;N<S.length;N++){const V=S[N],W=[];for(let ee=0;ee<V.length;ee++){const ae=V[ee-1],ge=V[ee],be=V[ee+1],Se=ee===0?z:ge.sub(ae)._unit()._perp(),Ae=ee===V.length-1?z:be.sub(ge)._unit()._perp(),ze=Se._add(Ae)._unit();ze._mult(1/(ze.x*Ae.x+ze.y*Ae.y)),W.push(ze._mult(I)._add(ge))}A.push(W)}return A}(i,E*t.pixelToTileUnitsFactor)),function(S,I,A){for(let z=0;z<I.length;z++){const N=I[z];if(S.length>=3){for(let V=0;V<N.length;V++)if(Pa(S,N[V]))return!0}if(Ld(S,N,A))return!0}return!1}(_,i,x)}isTileClipped(){return!0}},symbol:Xf,background:class extends Ko{constructor(t){super(t,S0)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ko{constructor(t){super(t,M0)}getProgramIds(){return["raster"]}},sky:class extends Ko{constructor(t){super(t,P0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Xc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){const r=this.paint.get("sky-type");if(r==="atmosphere"){const i=this.paint.get("sky-atmosphere-sun"),u=!i,f=t.style.light,_=f.properties.get("position");return u&&f.properties.get("anchor")==="viewport"&&Kn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?cm(_.azimuthal,90-_.polar,e):cm(i[0],90-i[1],e)}if(r==="gradient"){const i=this.paint.get("sky-gradient-center");return cm(i[0],90-i[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:v_,HTMLCanvasElement:x_,HTMLVideoElement:b_,ImageData:w_,ImageBitmap:Hf}=H;class Yf{constructor(e,r,i,u){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(r,u)}update(e,r,i){const{width:u,height:f}=e,{context:_}=this,{gl:x}=_;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!r||r.premultiply!==!1)),i||this.size&&this.size[0]===u&&this.size[1]===f){const{x:E,y:S}=i||{x:0,y:0};e instanceof v_||e instanceof x_||e instanceof b_||e instanceof w_||Hf&&e instanceof Hf?x.texSubImage2D(x.TEXTURE_2D,0,E,S,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,E,S,u,f,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof v_||e instanceof x_||e instanceof b_||e instanceof w_||Hf&&e instanceof Hf?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,f,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=!!(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,r){const{context:i}=this,{gl:u}=i;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class hm{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new ri({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const i=this.getKey(e,r);return this.positions[i]}trim(){const e=this.width,r=this.height=oi(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,i){const u=[];let f=e.length%2==1?-e[e.length-1]*i:0,_=e[0]*i,x=!0;u.push({left:f,right:_,isDash:x,zeroLength:e[0]===0});let E=e[0];for(let S=1;S<e.length;S++){x=!x;const I=e[S];f=E*i,E+=I,_=E*i,u.push({left:f,right:_,isDash:x,zeroLength:I===0})}return u}addRoundDash(e,r,i){const u=r/2;for(let f=-i;f<=i;f++){const _=this.width*(this.nextRow+i+f);let x=0,E=e[x];for(let S=0;S<this.width;S++){S/E.right>1&&(E=e[++x]);const I=Math.abs(S-E.left),A=Math.abs(S-E.right),z=Math.min(I,A);let N;const V=f/i*(u+1);if(E.isDash){const W=u-Math.abs(V);N=Math.sqrt(z*z+W*W)}else N=u-Math.sqrt(z*z+V*V);this.image.data[_+S]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(e,r){for(let E=e.length-1;E>=0;--E){const S=e[E],I=e[E+1];S.zeroLength?e.splice(E,1):I&&I.isDash===S.isDash&&(I.left=S.left,e.splice(E,1))}const i=e[0],u=e[e.length-1];i.isDash===u.isDash&&(i.left=u.left-this.width,u.right=i.right+this.width);const f=this.width*this.nextRow;let _=0,x=e[_];for(let E=0;E<this.width;E++){E/x.right>1&&(x=e[++_]);const S=Math.abs(E-x.left),I=Math.abs(E-x.right),A=Math.min(S,I);this.image.data[f+E]=Math.max(0,Math.min(255,(x.isDash?A:-A)+r+128))}}addDash(e,r){const i=this.getKey(e,r);if(this.positions[i])return this.positions[i];const u=r==="round",f=u?7:0,_=2*f+1;if(this.nextRow+_>this.height)return Kn("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let I=0;I<e.length;I++)e[I]<0&&(Kn("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),x+=e[I];if(x!==0){const I=this.width/x,A=this.getDashRanges(e,this.width,I);u?this.addRoundDash(A,I,f):this.addRegularDash(A,r==="square"?.5*I:0)}const E=this.nextRow+f;this.nextRow+=_;const S={tl:[E,f],br:[x,0]};return this.positions[i]=S,S}}Tt("LineAtlas",hm);class A0{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const k0=H.performance;function E_(t){const e=t?t.url.toString():void 0;return k0.getEntriesByName(e)}class z0{constructor(){this.tasks={},this.taskQueue=[],wo(["process"],this),this.invoker=new A0(this.process),this.nextId=0}add(e,r){const i=this.nextId++,u=function({type:f,isSymbolTile:_,zoom:x}){return x=x||0,f==="message"?0:f!=="maybePrepare"||_?f!=="parseTile"||_?f==="parseTile"&&_?300-x:f==="maybePrepare"&&_?400-x:500:200-x:100-x}(r);if(u===0){ji();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:e,metadata:r,priority:u,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){ji();try{if(this.taskQueue=this.taskQueue.filter(i=>!!this.tasks[i]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<r&&(r=f.priority,e=u)}if(e===null)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}function T_(t,e,r){var i=2*Math.PI*6378137/256/Math.pow(2,r);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}class Kf{constructor(e,r,i){this.z=e,this.x=r,this.y=i,this.key=Gd(0,e,e,r,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const i=function(f,_,x){var E=T_(256*f,256*(_=Math.pow(2,x)-_-1),x),S=T_(256*(f+1),256*(_+1),x);return E[0]+","+E[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),u=function(f,_,x){let E,S="";for(let I=f;I>0;I--)E=1<<I-1,S+=(_&E?1:0)+(x&E?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dm{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Gd(e,r.z,r.z,r.x,r.y)}}class zo{constructor(e,r,i,u,f){this.overscaledZ=e,this.wrap=r,this.canonical=new Kf(i,+u,+f),this.key=r===0&&e===i?this.canonical.key:Gd(r,e,i,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new zo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zo(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Gd(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return Gd(this.wrap*+r,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new zo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,i=2*this.canonical.x,u=2*this.canonical.y;return[new zo(r,this.wrap,r,i,u),new zo(r,this.wrap,r,i+1,u),new zo(r,this.wrap,r,i,u+1),new zo(r,this.wrap,r,i+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new zo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new zo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Gd(t,e,r,i,u){const f=1<<Math.min(r,22);let _=f*(u%f)+i%f;return t&&r<22&&(_+=f*f*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*_+r)+(e-r)}Tt("CanonicalTileID",Kf),Tt("OverscaledTileID",zo,{omit:["projMatrix"]});class Wh{constructor(e,r,i){this.func=e,this.mask=r,this.range=i}}Wh.ReadOnly=!1,Wh.ReadWrite=!0,Wh.disabled=new Wh(519,Wh.ReadOnly,[0,1]);const fm=7680;class pm{constructor(e,r,i,u,f,_){this.test=e,this.ref=r,this.mask=i,this.fail=u,this.depthFail=f,this.pass=_}}pm.disabled=new pm({func:519,mask:0},0,0,fm,fm,fm);class _l{constructor(e,r,i){this.blendFunction=e,this.blendColor=r,this.mask=i}}_l.Replace=[1,0],_l.disabled=new _l(_l.Replace,In.transparent,[!1,!1,!1,!1]),_l.unblended=new _l(_l.Replace,In.transparent,[!0,!0,!0,!0]),_l.alphaBlended=new _l([1,771],In.transparent,[!0,!0,!0,!0]);const mm=1029,gm=2305;class Ra{constructor(e,r,i){this.enable=e,this.mode=r,this.frontFace=i}}Ra.disabled=new Ra(!1,mm,gm),Ra.backCCW=new Ra(!0,mm,gm),Ra.backCW=new Ra(!0,mm,2304),Ra.frontCW=new Ra(!0,1028,2304),Ra.frontCCW=new Ra(!0,1028,gm);class S_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const i=e[r];this._stringToNumber[i]=r,this._numberToString[r]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class M_{constructor(e,r,i,u,f){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=i,e._y=u,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class D0{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,i){const u=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},qn(this.stateChanges[e][u],i),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const f in this.state[e][u])i[f]||(this.deletedStates[e][u][f]=null)}else for(const f in i)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][f]===null&&delete this.deletedStates[e][u][f]}removeFeatureState(e,r,i){if(this.deletedStates[e]===null)return;const u=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&r!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][i]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(i in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][i]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,r){const i=String(r),u=qn({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][r];if(f===null)return{};for(const _ in f)delete u[_]}return u}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const i={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const _ in this.stateChanges[u])this.state[u][_]||(this.state[u][_]={}),qn(this.state[u][_],this.stateChanges[u][_]),f[_]=this.state[u][_];i[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(this.deletedStates[u]===null)for(const _ in this.state[u])f[_]={},this.state[u][_]={};else for(const _ in this.deletedStates[u]){if(this.deletedStates[u][_]===null)this.state[u][_]={};else for(const x of Object.keys(this.deletedStates[u][_]))delete this.state[u][_][x];f[_]=this.state[u][_]}i[u]=i[u]||{},qn(i[u],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(i).length!==0)for(const u in e)e[u].setFeatureState(i,r)}}class C_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const i=this.toIdx(e,r);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function P_(t,e,r,i){let u=0,f=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(i[_])<1e-15){if(r[_]<t[_]||r[_]>e[_])return null}else{const x=1/i[_];let E=(t[_]-r[_])*x,S=(e[_]-r[_])*x;if(E>S){const I=E;E=S,S=I}if(E>u&&(u=E),S<f&&(f=S),u>f)return null}return u}function I_(t,e,r,i,u,f,_,x,E,S,I){const A=i-t,z=u-e,N=f-r,V=_-t,W=x-e,ee=E-r,ae=I[1]*ee-I[2]*W,ge=I[2]*V-I[0]*ee,be=I[0]*W-I[1]*V,Se=A*ae+z*ge+N*be;if(Math.abs(Se)<1e-15)return null;const Ae=1/Se,ze=S[0]-t,Qe=S[1]-e,Ke=S[2]-r,yt=(ze*ae+Qe*ge+Ke*be)*Ae;if(yt<0||yt>1)return null;const pt=Qe*N-Ke*z,Je=Ke*A-ze*N,mt=ze*z-Qe*A,vt=(I[0]*pt+I[1]*Je+I[2]*mt)*Ae;return vt<0||yt+vt>1?null:(V*pt+W*Je+ee*mt)*Ae}function A_(t,e,r){return(t-e)/(r-e)}function k_(t,e,r,i,u,f,_,x,E){const S=1<<r,I=f-i,A=_-u,z=(t+1)/S*I+i,N=(e+0)/S*A+u,V=(e+1)/S*A+u;x[0]=(t+0)/S*I+i,x[1]=N,E[0]=z,E[1]=V}class z_{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(f){const _=Math.ceil(Math.log2(f.dim/8)),x=[];let E=Math.ceil(Math.pow(2,_));const S=1/E,I=(N,V,W,ee,ae)=>{const ge=ee?1:0,be=(N+1)*W-ge,Se=V*W,Ae=(V+1)*W-ge;ae[0]=N*W,ae[1]=Se,ae[2]=be,ae[3]=Ae};let A=new C_(E);const z=[];for(let N=0;N<E*E;N++){I(N%E,Math.floor(N/E),S,!1,z);const V=Yu(z[0],z[1],f),W=Yu(z[2],z[1],f),ee=Yu(z[2],z[3],f),ae=Yu(z[0],z[3],f);A.minimums.push(Math.min(V,W,ee,ae)),A.maximums.push(Math.max(V,W,ee,ae)),A.leaves.push(1)}for(x.push(A),E/=2;E>=1;E/=2){const N=x[x.length-1];A=new C_(E);for(let V=0;V<E*E;V++){I(V%E,Math.floor(V/E),2,!0,z);const W=N.getElevation(z[0],z[1]),ee=N.getElevation(z[2],z[1]),ae=N.getElevation(z[2],z[3]),ge=N.getElevation(z[0],z[3]),be=N.isLeaf(z[0],z[1]),Se=N.isLeaf(z[2],z[1]),Ae=N.isLeaf(z[2],z[3]),ze=N.isLeaf(z[0],z[3]),Qe=Math.min(W.min,ee.min,ae.min,ge.min),Ke=Math.max(W.max,ee.max,ae.max,ge.max),yt=be&&Se&&Ae&&ze;A.maximums.push(Ke),A.minimums.push(Qe),A.leaves.push(Ke-Qe<=5&&yt?1:0)}x.push(A)}return x}(this.dem),i=r.length-1,u=r[i];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(r,0,0,i,0)}raycastRoot(e,r,i,u,f,_,x=1){return P_([e,r,-100],[i,u,this.maximums[0]*x],f,_)}raycast(e,r,i,u,f,_,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,r,i,u,f,_,x);if(E==null)return null;const S=[],I=[],A=[],z=[],N=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:V,t:W,nodex:ee,nodey:ae,depth:ge}=N.pop();if(this.leaves[V]){k_(ee,ae,ge,e,r,i,u,A,z);const Se=1<<ge,Ae=(ee+0)/Se,ze=(ee+1)/Se,Qe=(ae+0)/Se,Ke=(ae+1)/Se,yt=Yu(Ae,Qe,this.dem)*x,pt=Yu(ze,Qe,this.dem)*x,Je=Yu(ze,Ke,this.dem)*x,mt=Yu(Ae,Ke,this.dem)*x,vt=I_(A[0],A[1],yt,z[0],A[1],pt,z[0],z[1],Je,f,_),rt=I_(z[0],z[1],Je,A[0],z[1],mt,A[0],A[1],yt,f,_),St=Math.min(vt!==null?vt:Number.MAX_VALUE,rt!==null?rt:Number.MAX_VALUE);if(St!==Number.MAX_VALUE)return St;{const Dt=gt([],f,_,W);if(D_(yt,pt,mt,Je,A_(Dt[0],A[0],z[0]),A_(Dt[1],A[1],z[1]))>=Dt[2])return W}continue}let be=0;for(let Se=0;Se<this._siblingOffset.length;Se++){k_((ee<<1)+this._siblingOffset[Se][0],(ae<<1)+this._siblingOffset[Se][1],ge+1,e,r,i,u,A,z),A[2]=-100,z[2]=this.maximums[this.childOffsets[V]+Se]*x;const Ae=P_(A,z,f,_);if(Ae!=null){const ze=Ae;S[Se]=ze;let Qe=!1;for(let Ke=0;Ke<be&&!Qe;Ke++)ze>=S[I[Ke]]&&(I.splice(Ke,0,Se),Qe=!0);Qe||(I[be]=Se),be++}}for(let Se=0;Se<be;Se++){const Ae=I[Se];N.push({idx:this.childOffsets[V]+Ae,t:S[Ae],nodex:(ee<<1)+this._siblingOffset[Ae][0],nodey:(ae<<1)+this._siblingOffset[Ae][1],depth:ge+1})}}return null}_addNode(e,r,i){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,i,u,f){if(e[u].isLeaf(r,i)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const _=u-1,x=e[_];let E,S=0;for(let I=0;I<this._siblingOffset.length;I++){const A=2*r+this._siblingOffset[I][0],z=2*i+this._siblingOffset[I][1],N=x.getElevation(A,z),V=x.isLeaf(A,z),W=this._addNode(N.min,N.max,V);V&&(S|=1<<I),E||(E=W)}for(let I=0;I<this._siblingOffset.length;I++)S&1<<I||this._construct(e,2*r+this._siblingOffset[I][0],2*i+this._siblingOffset[I][1],_,E+I)}}function D_(t,e,r,i,u,f){return Nn(Nn(t,r,f),Nn(e,i,f),u)}function Yu(t,e,r){const i=r.dim,u=rn(t*i-.5,0,i-1),f=rn(e*i-.5,0,i-1),_=Math.floor(u),x=Math.floor(f),E=Math.min(_+1,i-1),S=Math.min(x+1,i-1);return D_(r.get(_,x),r.get(E,x),r.get(_,S),r.get(E,S),u-_,f-x)}const L_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Jf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,i,u=!1,f=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(i&&i!=="mapbox"&&i!=="terrarium")return Kn(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const _=this.dim=r.height-2;if(this.data=new Uint32Array(r.data.buffer),this.encoding=i||"mapbox",this.borderReady=u,!u){for(let x=0;x<_;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(_,x)]=this.data[this._idx(_-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,_)]=this.data[this._idx(x,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new z_(this)}get(e,r,i=!1){const u=new Uint8Array(this.data.buffer);i&&(e=rn(e,-1,this.dim),r=rn(r,-1,this.dim));const f=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[f],u[f+1],u[f+2])}static getUnpackVector(e){return L_[e]}get unpackVector(){return L_[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,i){return(256*e*256+256*r+i)/10-1e4}_unpackTerrarium(e,r,i){return 256*e+r+i/256-32768}static pack(e,r){const i=[0,0,0,0],u=Jf.getUnpackVector(r);let f=Math.floor((e+u[3])/u[2]);return i[2]=f%256,f=Math.floor(f/256),i[1]=f%256,f=Math.floor(f/256),i[0]=f,i}getPixels(){return new po({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,f=r*this.dim+this.dim,_=i*this.dim,x=i*this.dim+this.dim;switch(r){case-1:u=f-1;break;case 1:f=u+1}switch(i){case-1:_=x-1;break;case 1:x=_+1}const E=-r*this.dim,S=-i*this.dim;for(let I=_;I<x;I++)for(let A=u;A<f;A++)this.data[this._idx(A,I)]=e.data[this._idx(A+E,I+S)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Tt("DEMData",Jf),Tt("DemMinMaxQuadTree",z_,{omit:["dem"]});class L0{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,i){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const f={value:r,timeout:void 0};if(i!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},i)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const i=e.wrapped().key,u=r===void 0?0:this.data[i].indexOf(r),f=this.data[i][u];return this.data[i].splice(u,1),f.timeout&&clearTimeout(f.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(f.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const i in this.data)for(const u of this.data[i])e(u.value)||r.push(u);for(const i of r)this.remove(i.value.tileID,i)}}class rh extends xe{constructor(e,r,i){super(),this.id=e,this._onlySymbols=i,r.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new L0(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new D0}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const i=this._tiles[r];i.upload(e),i.prepare(this.map.style.imageManager)}}getIds(){return Bo(this._tiles).map(e=>e.tileID).sort(R_).map(e=>e.key)}getRenderableIds(e){const r=[];for(const i in this._tiles)this._isIdRenderable(+i,e)&&r.push(this._tiles[i]);return e?r.sort((i,u)=>{const f=i.tileID,_=u.tileID,x=new $(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),E=new $(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-_.overscaledZ||E.y-x.y||E.x-x.x}).map(i=>i.tileID.key):r.map(i=>i.tileID).sort(R_).map(i=>i.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const i=this._tiles[e];i&&(i.state!=="loading"&&(i.state=r),this._loadTile(i,this._tileLoaded.bind(this,i,e,r)))}_tileLoaded(e,r,i,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new ie(u,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=si.now(),i==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new X("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let u=0;u<r.length;u++){const f=r[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const _=this.getTileByID(f);i(e,_),i(_,e)}}function i(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let _=f.tileID.canonical.x-u.tileID.canonical.x;const x=f.tileID.canonical.y-u.tileID.canonical.y,E=Math.pow(2,u.tileID.canonical.z),S=f.tileID.key;_===0&&x===0||Math.abs(x)>1||(Math.abs(_)>1&&(Math.abs(_+E)===1?_+=E:Math.abs(_-E)===1&&(_-=E)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,_,x),u.neighboringTiles&&u.neighboringTiles[S]&&(u.neighboringTiles[S].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,i,u){for(const f in this._tiles){let _=this._tiles[f];if(u[f]||!_.hasData()||_.tileID.overscaledZ<=r||_.tileID.overscaledZ>i)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>r+1;){const S=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[S.key],_&&_.hasData()&&(x=S)}let E=x;for(;E.overscaledZ>r;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]){u[x.key]=x;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=r?i:null}for(let i=e.overscaledZ-1;i>=r;i--){const u=e.scaledTo(i),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const i=Math.ceil(e.width/r)+1,u=Math.ceil(e.height/r)+1,f=Math.floor(i*u*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const i={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+r),i[f.tileID.key]=f}this._tiles=i;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,r,i){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!i)return;let u;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new zo(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(u=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(x=>this._source.hasTile(x)))):u=[];const f=this._updateRetainedTiles(u);if(O_(this._source.type)&&u.length!==0){const x={},E={},S=Object.keys(f);for(const A of S){const z=f[A],N=this._tiles[A];if(!N||N.fadeEndTime&&N.fadeEndTime<=si.now())continue;const V=this.findLoadedParent(z,Math.max(z.overscaledZ-rh.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),x[V.tileID.key]=V.tileID),E[A]=z}const I=u[u.length-1].overscaledZ;for(const A in this._tiles){const z=this._tiles[A];if(f[A]||!z.hasData())continue;let N=z.tileID;for(;N.overscaledZ>I;){N=N.scaledTo(N.overscaledZ-1);const V=this._tiles[N.key];if(V&&V.hasData()&&E[N.key]){f[A]=z.tileID;break}}}for(const A in x)f[A]||(this._coveredTiles[A]=!0,f[A]=x[A])}for(const x in f)this._tiles[x].clearFadeHold();const _=function(x,E){const S=[];for(const I in x)I in E||S.push(I);return S}(this._tiles,f);for(const x of _){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const i={},u=e.reduce((S,I)=>Math.min(S,I.overscaledZ),1/0),f=e[0].overscaledZ,_=Math.max(f-rh.maxOverzooming,this._source.minzoom),x=Math.max(f+rh.maxUnderzooming,this._source.minzoom),E={};for(const S of e){const I=this._addTile(S);r[S.key]=S,I.hasData()||u<this._source.maxzoom&&(E[S.key]=S)}this._retainLoadedChildren(E,u,x,r);for(const S of e){let I=this._tiles[S.key];if(I.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const z=S.children(this._source.maxzoom)[0],N=this.getTile(z);if(N&&N.hasData()){r[z.key]=z;continue}}else{const z=S.children(this._source.maxzoom);if(r[z[0].key]&&r[z[1].key]&&r[z[2].key]&&r[z[3].key])continue}let A=I.wasRequested();for(let z=S.overscaledZ-1;z>=_;--z){const N=S.scaledTo(z);if(i[N.key]||(i[N.key]=!0,I=this.getTile(N),!I&&A&&(I=this._addTile(N)),I&&(r[N.key]=N,A=I.wasRequested(),I.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let i,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){i=this._loadedParentTiles[u.key];break}r.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(i=this._getLoadedTile(f),i)break;u=f}for(const f of r)this._loadedParentTiles[f]=i}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const i=!!r;if(!i){const u=this.map?this.map.painter:null,f=this._source.type==="raster"||this._source.type==="raster-dem";r=new ym(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,f),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,i||this._source.fire(new X("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=r.getExpiryTimeout();i&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},i))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,r,i){const u=[],f=this.transform;if(!f)return u;for(const _ in this._tiles){const x=this._tiles[_];if(i&&x.clearQueryDebugViz(),x.holdingForFade())continue;const E=e.containsTile(x,f,r);E&&u.push(E)}return u}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(i=>this._tiles[i].tileID);for(const i of r)i.projMatrix=this.transform.calculateProjMatrix(i.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(O_(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=si.now())return!0}return!1}setFeatureState(e,r,i){this._state.updateState(e=e||"_geojsonTileLayer",r,i)}removeFeatureState(e,r,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,i)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,i){const u=this._tiles[e];u&&u.setDependencies(r,i)}reloadTilesForDependencies(e,r){for(const i in this._tiles)this._tiles[i].hasDependency(e,r)&&this._reloadTile(+i,"reloading");this._cache.filter(i=>!i.hasDependency(e,r))}_preloadTiles(e,r){const i=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,_=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const S of u){const I=S.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const A of I)i.set(A.key,A);this.usedForTerrain&&S.updateElevation(!1)}const x=Array.from(i.values()),E=this._source.type==="raster"||this._source.type==="raster-dem";os(x,(S,I)=>{const A=new ym(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,E);this._loadTile(A,z=>{this._source.type==="raster-dem"&&A.dem&&this._backfillDEM(A),I(z,A)})},r)}}function R_(t,e){const r=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function O_(t){return t==="raster"||t==="image"||t==="video"}rh.maxOverzooming=10,rh.maxUnderzooming=3;class Qf{constructor(e,r,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=i}static create(e,r,i){const u=i||e.findDEMTileFor(r);if(!u||!u.dem)return;const f=u.dem,_=u.tileID,x=1<<r.canonical.z-_.canonical.z;return new Qf(u,u.tileSize/wn/x,[(r.canonical.x/x-_.canonical.x)*f.dim,(r.canonical.y/x-_.canonical.y)*f.dim])}tileCoordToPixel(e,r){const i=r*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(i);return new $(u,f)}getElevationAt(e,r,i,u){const f=e*this._scale+this._offset[0],_=r*this._scale+this._offset[1],x=Math.floor(f),E=Math.floor(_),S=this._dem;return u=!!u,i?Nn(Nn(S.get(x,E,u),S.get(x,E+1,u),_-E),Nn(S.get(x+1,E,u),S.get(x+1,E+1,u),_-E),f-x):S.get(x,E,u)}getElevationAtPixel(e,r,i){return this._dem.get(e,r,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Jo(1,e)*this._dem.stride}}class B_{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new xa(wn,16,0),this.featureIndexArray=new wf,this.promoteId=r}insert(e,r,i,u,f,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,u,f,_);const E=this.grid;for(let S=0;S<r.length;S++){const I=r[S],A=[1/0,1/0,-1/0,-1/0];for(let z=0;z<I.length;z++){const N=I[z];A[0]=Math.min(A[0],N.x),A[1]=Math.min(A[1],N.y),A[2]=Math.max(A[2],N.x),A[3]=Math.max(A[3],N.y)}A[0]<wn&&A[1]<wn&&A[2]>=0&&A[3]>=0&&E.insert(x,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new y.VectorTile(new $d(this.rawTileData)).layers,this.sourceLayerCoder=new S_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,i,u){this.loadVTLayers();const f=e.params||{},_=jl(f.filter),x=e.tileResult,E=e.transform,S=x.bufferedTilespaceBounds,I=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(V,W,ee,ae)=>Rh(x.bufferedTilespaceGeometry,V,W,ee,ae));I.sort(R0);let A=null;E.elevation&&I.length>0&&(A=Qf.create(E.elevation,this.tileID));const z={};let N;for(let V=0;V<I.length;V++){const W=I[V];if(W===N)continue;N=W;const ee=this.featureIndexArray.get(W);let ae=null;this.loadMatchingFeature(z,ee,_,f.layers,f.availableImages,r,i,u,(ge,be,Se,Ae=0)=>(ae||(ae=Ji(ge,this.tileID.canonical,e.tileTransform)),be.queryIntersectsFeature(x,ge,Se,ae,this.z,e.transform,e.pixelPosMatrix,A,Ae)))}return z}loadMatchingFeature(e,r,i,u,f,_,x,E,S){const{featureIndex:I,bucketIndex:A,sourceLayerIndex:z,layoutVertexArrayOffset:N}=r,V=this.bucketLayerIDs[A];if(u&&!function(ge,be){for(let Se=0;Se<ge.length;Se++)if(be.indexOf(ge[Se])>=0)return!0;return!1}(u,V))return;const W=this.sourceLayerCoder.decode(z),ee=this.vtLayers[W].feature(I);if(i.needGeometry){const ge=Ca(ee,!0);if(!i.filter(new Ht(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!i.filter(new Ht(this.tileID.overscaledZ),ee))return;const ae=this.getId(ee,W);for(let ge=0;ge<V.length;ge++){const be=V[ge];if(u&&u.indexOf(be)<0)continue;const Se=_[be];if(!Se)continue;let Ae={};ae!==void 0&&E&&(Ae=E.getState(Se.sourceLayer||"_geojsonTileLayer",ae));const ze=qn({},x[be]);ze.paint=F_(ze.paint,Se.paint,ee,Ae,f),ze.layout=F_(ze.layout,Se.layout,ee,Ae,f);const Qe=!S||S(ee,Se,Ae,N);if(!Qe)continue;const Ke=new M_(ee,this.z,this.x,this.y,ae);Ke.layer=ze;let yt=e[be];yt===void 0&&(yt=e[be]=[]),yt.push({featureIndex:I,feature:Ke,intersectionZ:Qe})}}lookupSymbolFeatures(e,r,i,u,f,_,x,E){const S={};this.loadVTLayers();const I=jl(f);for(const A of e)this.loadMatchingFeature(S,{bucketIndex:i,sourceLayerIndex:u,featureIndex:A,layoutVertexArrayOffset:0},I,_,x,E,r);return S}loadFeature(e){const{featureIndex:r,sourceLayerIndex:i}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(i),f=this.vtFeatures[u];if(f[r])return f[r];const _=this.vtLayers[u].feature(r);return f[r]=_,_}hasLayer(e){for(const r of this.bucketLayerIDs)for(const i of r)if(e===i)return!0;return!1}getId(e,r){let i=e.id;return this.promoteId&&(i=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof i=="boolean"&&(i=Number(i))),i}}function F_(t,e,r,i,u){return Ui(t,(f,_)=>{const x=e instanceof Vs?e.get(_):null;return x&&x.evaluate?x.evaluate(r,i,u):x})}function R0(t,e){return e-t}Tt("FeatureIndex",B_,{omit:["rawTileData","sourceLayerCoder"]});var O0=un([{name:"a_pos",type:"Int16",components:2}]);const Qs=32,yl=33,Ku=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,r=0,i=0,u=0,f=0,_=0,x=0;for(1&e?u=f=_=Qs:r=i=x=Qs;(e>>=1)>1;){const S=r+u>>1,I=i+f>>1;1&e?(u=r,f=i,r=_,i=x):(r=u,i=f,u=_,f=x),_=S,x=I}const E=4*t;Ku[E+0]=r,Ku[E+1]=i,Ku[E+2]=u,Ku[E+3]=f}const vl=new Uint16Array(2178),Ju=new Uint8Array(1089),ep=new Uint16Array(1089);function N_(t){return t===0?-.03125:t===32?.03125:0}var _m=un([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const U_={type:2,extent:wn,loadGeometry:()=>[[new $(0,0),new $(8193,0),new $(8193,8193),new $(0,8193),new $(0,0)]]};class ym{constructor(e,r,i,u,f){this.tileID=e,this.uid=ss(),this.uses=0,this.tileSize=r,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<si.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Xh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const _={};if(!f)return _;for(const x of u){const E=x.layerIds.map(S=>f.getLayer(S)).filter(Boolean);if(E.length!==0){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(S=>E.filter(I=>I.id===S)[0]));for(const S of E)_[S.id]=x}}return _}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Hu){if(this.hasSymbolBuckets=!0,!i)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Hu&&f.hasRTLText){this.hasRTLText=!0,Tn.isLoading()||Tn.isLoaded()||di()!=="deferred"||ti();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ah}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const i in this.buckets){const u=this.buckets[i];u.uploadPending()&&u.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Yf(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Yf(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Yf(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,i,u,f,_,x,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:x,transform:_,params:f,tileTransform:this.tileTransform},e,r,i):{}}querySourceFeatures(e,r){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const u=i.loadVTLayers(),f=r?r.sourceLayer:"",_=u._geojsonTileLayer||u[f];if(!_)return;const x=jl(r&&r.filter),{z:E,x:S,y:I}=this.tileID.canonical,A={z:E,x:S,y:I};for(let z=0;z<_.length;z++){const N=_.feature(z);if(x.needGeometry){const ee=Ca(N,!0);if(!x.filter(new Ht(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!x.filter(new Ht(this.tileID.overscaledZ),N))continue;const V=i.getId(N,f),W=new M_(N,E,S,I,V);W.tile=A,e.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const i=Eo(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const i=Date.now();let u=!1;if(this.expirationTime>i)u=!1;else if(r)if(this.expirationTime<r)u=!0;else{const f=this.expirationTime-r;f?this.expirationTime=i+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const i=this.latestFeatureIndex.loadVTLayers(),u=r.style.listImages();for(const f in this.buckets){if(!r.style.hasLayer(f))continue;const _=this.buckets[f],x=_.layers[0].sourceLayer||"_geojsonTileLayer",E=i[x],S=e[x];if(!E||!S||Object.keys(S).length===0)continue;if(_.update(S,E,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof ct||_ instanceof Wu){const A=r.style._getSourceCache(_.layers[0].source);r._terrain&&r._terrain.enabled&&A&&_.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(A.id,this.tileID)}const I=r&&r.style&&r.style.getLayer(f);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<si.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=si.now()+e}setDependencies(e,r){const i={};for(const u of r)i[u]=!0;this.dependencies[e]=i}hasDependency(e,r){for(const i of e){const u=this.dependencies[i];if(u){for(const f of r)if(u[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const i=Ji(U_,this.tileID.canonical,this.tileTransform)[0],u=new kr,f=new Oc;for(let _=0;_<i.length;_++){const{x,y:E}=i[_];u.emplaceBack(x,E),f.emplaceBack(_)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,_m.members),this._tileDebugSegments=Cr.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const i=Ji(U_,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const _=function(x,E){const S=Xh(x,E),I=Math.pow(2,x.z);for(let ee=0;ee<yl;ee++)for(let ae=0;ae<yl;ae++){const ge=Ss((x.x+(ae+N_(ae))/Qs)/I),be=Po((x.y+(ee+N_(ee))/Qs)/I),Se=E.project(ge,be),Ae=ee*yl+ae;vl[2*Ae+0]=Math.round((Se.x*S.scale-S.x)*wn),vl[2*Ae+1]=Math.round((Se.y*S.scale-S.y)*wn)}Ju.fill(0),ep.fill(0);for(let ee=2045;ee>=0;ee--){const ae=4*ee,ge=Ku[ae+0],be=Ku[ae+1],Se=Ku[ae+2],Ae=Ku[ae+3],ze=ge+Se>>1,Qe=be+Ae>>1,Ke=ze+Qe-be,yt=Qe+ge-ze,pt=be*yl+ge,Je=Ae*yl+Se,mt=Qe*yl+ze,vt=Math.hypot((vl[2*pt+0]+vl[2*Je+0])/2-vl[2*mt+0],(vl[2*pt+1]+vl[2*Je+1])/2-vl[2*mt+1])>=16;if(Ju[mt]=Ju[mt]||(vt?1:0),ee<1022){const rt=(be+yt>>1)*yl+(ge+Ke>>1),St=(Ae+yt>>1)*yl+(Se+Ke>>1);Ju[mt]=Ju[mt]||Ju[rt]||Ju[St]}}const A=new Ea,z=new uo;let N=0;function V(ee,ae){const ge=ae*yl+ee;return ep[ge]===0&&(A.emplaceBack(vl[2*ge+0],vl[2*ge+1],ee*wn/Qs,ae*wn/Qs),ep[ge]=++N),ep[ge]-1}function W(ee,ae,ge,be,Se,Ae){const ze=ee+ge>>1,Qe=ae+be>>1;if(Math.abs(ee-Se)+Math.abs(ae-Ae)>1&&Ju[Qe*yl+ze])W(Se,Ae,ee,ae,ze,Qe),W(ge,be,Se,Ae,ze,Qe);else{const Ke=V(ee,ae),yt=V(ge,be),pt=V(Se,Ae);z.emplaceBack(Ke,yt,pt)}}return W(0,0,Qs,Qs,Qs,0),W(Qs,Qs,0,0,0,Qs),{vertices:A,indices:z}}(this.tileID.canonical,r);u=_.vertices,f=_.indices}else{u=new Ea,f=new uo;for(const{x,y:E}of i)u.emplaceBack(x,E,0,0);const _=nu(u.int16,void 0,4);for(let x=0;x<_.length;x+=3)f.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,_m.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=Cr.simpleSegment(0,0,u.length,f.length)}}const B0=un([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),F0=un([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:j_}=B0;function ih(t,e){const r=t.fovAboveCenter,i=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-i)/Math.cos(t._pitch),f=Math.sin(r)*u/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),_=Math.sin(t._pitch)*f+u;return Math.min(1.01*_,u*(1/t._horizonShift))}const vm=wn/Math.PI/2,Qo=-vm,es=vm,N0=[new Ao([Qo,Qo,Qo],[es,es,es]),new Ao([Qo,Qo,Qo],[0,0,es]),new Ao([0,Qo,Qo],[es,0,es]),new Ao([Qo,0,Qo],[0,es,es]),new Ao([0,0,Qo],[es,es,es])];function tp(t){if(t.z<=1)return N0[t.z+2*t.y+t.x];const[e,r]=V_(t),i=[np(e[0],e[1]),np(e[0],r[1]),np(r[0],e[1]),np(r[0],r[1])],u=[es,es,es],f=[Qo,Qo,Qo];for(const _ of i)u[0]=Math.min(u[0],_[0]),u[1]=Math.min(u[1],_[1]),u[2]=Math.min(u[2],_[2]),f[0]=Math.max(f[0],_[0]),f[1]=Math.max(f[1],_[1]),f[2]=Math.max(f[2],_[2]);return new Ao(u,f)}function V_(t){const e=Math.pow(2,t.z),r=t.x/e,i=(t.x+1)/e,u=(t.y+1)/e;return[[Po(t.y/e),Ss(r)],[Po(u),Ss(i)]]}function xm(t,e,r,i){return r=en(r),i||(i=vm),[t*Math.sin(r)*i,-e*i,t*Math.cos(r)*i]}function np(t,e,r){return xm(Math.cos(en(t)),Math.sin(en(t)),e,r)}function $_(t){return 16383/Math.max(...Jt([],t.max,t.min))}function Z_(t){const e=He(new Float64Array(16)),r=1/$_(t);return Xe(e,e,t.min),$e(e,e,[r,r,r]),e}function G_(t,e,r){const i=e/(2*Math.PI),u=function(_){const x=wn/(2*Math.PI);return _/(2*Math.PI)/x}(e);if(!r){const _=rn(t.center.lat,-85.051129,Xs);r=[dl(t.center.lng)*e,fl(_)*e]}const f=He(new Float64Array(16));return Xe(f,f,[r[0],r[1],-i]),$e(f,f,[u,u,u]),Ze(f,f,en(-t._center.lat)),xt(f,f,en(-t._center.lng)),f}class bm{constructor(e){const r=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(r,!0),this.gridSegments=Cr.simpleSegment(0,0,4225,8192);const i=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(i,!0),this.poleSegments=Cr.simpleSegment(0,0,66,64);const u=new cl;u.emplaceBack(-1,1,1,0,0,0,0),u.emplaceBack(1,1,1,0,0,1,0),u.emplaceBack(1,-1,1,0,0,1,1),u.emplaceBack(-1,-1,1,0,0,0,1);const f=new uo;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(u,F0.members),this.atmosphereIndexBuffer=e.createIndexBuffer(f),this.atmosphereSegments=Cr.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,r,i){const u=new cl,f=r/Math.PI/2;u.emplaceBack(0,-f,0,0,0,.5,i?0:1);const _=360/e,x=Math.cos(en(85)),E=Math.sin(en(85));for(let I=0;I<=64;I++){const A=I/64,z=xm(x,E,0*(1-(S=A))+_*S,f);u.emplaceBack(z[0],z[1],z[2],0,0,A,i?0:1)}var S;return u}_createPoleTriangleIndices(){const e=new uo;for(let r=0;r<=64;r++)e.emplaceBack(0,r+1,r+2);return e}static createGridVertices(e){const r=Math.pow(2,e.z),i=(E,S,I)=>E*(1-I)+S*I,[u,f]=V_(e),_=new cl,x=function(E){const S=He(new Float64Array(16)),I=$_(E);var A,z;return $e(S,S,[I,I,I]),Xe(S,S,((A=[])[0]=-(z=E.min)[0],A[1]=-z[1],A[2]=-z[2],A)),S}(tp(e));_.reserve(4096);for(let E=0;E<65;E++){const S=i(u[0],f[0],E/64),I=fl(S),A=I*r-e.y,z=Math.sin(en(S)),N=Math.cos(en(S));for(let V=0;V<65;V++){const W=V/64,ee=i(u[1],f[1],W),ae=xm(N,z,ee);st(ae,ae,x);const ge=dl(ee);_.emplaceBack(ae[0],ae[1],ae[2],ge,I,W,A)}}return _}_createGridIndices(){const e=new uo,r=(i,u)=>{const f=65*u+i;e.emplaceBack(f+1,f,f+65),e.emplaceBack(f+65,f+65+1,f+1)};for(let i=0;i<64;i++)for(let u=0;u<64;u++)r(u,i);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const r=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(r),this.wireframeSegments=Cr.simpleSegment(0,0,4096,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new Zs,r=(i,u)=>{const f=65*u+i;e.emplaceBack(f,f+1),e.emplaceBack(f,f+65),e.emplaceBack(f,f+65+1)};for(let i=0;i<64;i++)for(let u=0;u<64;u++)r(u,i);return e}}function Xh(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),i=t.x*r,u=(t.x+1)*r,f=t.y*r,_=(t.y+1)*r,x=Ss(i),E=Ss(u),S=Po(f),I=Po(_),A=e.project(x,S),z=e.project(E,S),N=e.project(E,I),V=e.project(x,I);let W=Math.min(A.x,z.x,N.x,V.x),ee=Math.min(A.y,z.y,N.y,V.y),ae=Math.max(A.x,z.x,N.x,V.x),ge=Math.max(A.y,z.y,N.y,V.y);const be=r/16;function Se(ze,Qe,Ke,yt,pt,Je){const mt=(Ke+pt)/2,vt=(yt+Je)/2,rt=e.project(Ss(mt),Po(vt)),St=Math.max(0,W-rt.x,ee-rt.y,rt.x-ae,rt.y-ge);W=Math.min(W,rt.x),ae=Math.max(ae,rt.x),ee=Math.min(ee,rt.y),ge=Math.max(ge,rt.y),St>be&&(Se(ze,rt,Ke,yt,mt,vt),Se(rt,Qe,mt,vt,pt,Je))}Se(A,z,i,f,u,f),Se(z,N,u,f,u,_),Se(N,V,u,_,i,_),Se(V,A,i,_,i,f),W-=be,ee-=be,ae+=be,ge+=be;const Ae=1/Math.max(ae-W,ge-ee);return{scale:Ae,x:W*Ae,y:ee*Ae,x2:ae*Ae,y2:ge*Ae,projection:e}}class q_{constructor(e){const r={},i=[];for(const x in e){const E=e[x],S=r[x]={};for(const I in E.glyphs){const A=E.glyphs[+I];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const z=A.metrics.localGlyph?2:1,N={x:0,y:0,w:A.bitmap.width+2*z,h:A.bitmap.height+2*z};i.push(N),S[I]=N}}const{w:u,h:f}=Kp(i),_=new ri({width:u||1,height:f||1});for(const x in e){const E=e[x];for(const S in E.glyphs){const I=E.glyphs[+S];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const A=r[x][S],z=I.metrics.localGlyph?2:1;ri.copy(I.bitmap,_,{x:0,y:0},{x:A.x+z,y:A.y+z},I.bitmap)}}this.image=_,this.positions=r}}Tt("GlyphAtlas",q_);class U0{constructor(e){this.tileID=new zo(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Xh(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,i,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new Ah;const _=new S_(Object.keys(e.layers).sort()),x=new B_(this.tileID,this.promoteId);x.bucketLayerIDs=[];const E={},S=new hm(256,256),I={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:i},A=r.familiesBySource[this.source];for(const Ae in A){const ze=e.layers[Ae];if(!ze)continue;let Qe=!1,Ke=!1;for(const Je of A[Ae])Je[0].type==="symbol"?Qe=!0:Ke=!0;if(this.isSymbolTile===!0&&!Qe||this.isSymbolTile===!1&&!Ke)continue;ze.version===1&&Kn(`Vector tile source "${this.source}" layer "${Ae}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yt=_.encode(Ae),pt=[];for(let Je=0;Je<ze.length;Je++){const mt=ze.feature(Je),vt=x.getId(mt,Ae);pt.push({feature:mt,id:vt,index:Je,sourceLayerIndex:yt})}for(const Je of A[Ae]){const mt=Je[0];this.isSymbolTile!==void 0&&mt.type==="symbol"!==this.isSymbolTile||mt.minzoom&&this.zoom<Math.floor(mt.minzoom)||mt.maxzoom&&this.zoom>=mt.maxzoom||mt.visibility!=="none"&&(wm(Je,this.zoom,i),(E[mt.id]=mt.createBucket({index:x.bucketLayerIDs.length,layers:Je,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yt,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:i})).populate(pt,I,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Je.map(vt=>vt.id)))}}let z,N,V,W;S.trim();const ee={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ae=Ui(I.glyphDependencies,Ae=>Object.keys(Ae).map(Number));Object.keys(ae).length?u.send("getGlyphs",{uid:this.uid,stacks:ae},(Ae,ze)=>{z||(z=Ae,N=ze,Se.call(this))},void 0,!1,ee):N={};const ge=Object.keys(I.iconDependencies);ge.length?u.send("getImages",{icons:ge,source:this.source,tileID:this.tileID,type:"icons"},(Ae,ze)=>{z||(z=Ae,V=ze,Se.call(this))},void 0,!1,ee):V={};const be=Object.keys(I.patternDependencies);function Se(){if(z)return f(z);if(N&&V&&W){const Ae=new q_(N),ze=new Jg(V,W);for(const Qe in E){const Ke=E[Qe];Ke instanceof Hu?(wm(Ke.layers,this.zoom,i),y0(Ke,N,Ae.positions,V,ze.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection),Ke.projection=this.projection.name):Ke.hasPattern&&(Ke instanceof ct||Ke instanceof Wu||Ke instanceof ce)&&(wm(Ke.layers,this.zoom,i),Ke.addFeatures(I,this.tileID.canonical,ze.patternPositions,i))}this.status="done",f(null,{buckets:Bo(E).filter(Qe=>!Qe.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ae.image,lineAtlas:S,imageAtlas:ze,glyphMap:this.returnDependencies?N:null,iconMap:this.returnDependencies?V:null,glyphPositions:this.returnDependencies?Ae.positions:null})}}be.length?u.send("getImages",{icons:be,source:this.source,tileID:this.tileID,type:"patterns"},(Ae,ze)=>{z||(z=Ae,W=ze,Se.call(this))},void 0,!1,ee):W={},Se.call(this)}}function wm(t,e,r){const i=new Ht(e);for(const u of t)u.recalculate(i,r)}class W_{constructor(e){this.entries={},this.scheduler=e}request(e,r,i,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[_,x]=f.result;return this.scheduler?this.scheduler.add(()=>{u(_,x)},r):u(_,x),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=i((_,x)=>{f.result=[_,x];for(const E of f.callbacks)this.scheduler?this.scheduler.add(()=>{E(_,x)},r):E(_,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(_=>_!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function X_(t,e,r){const i=JSON.stringify(t.request);return t.data&&(this.deduped.entries[i]={result:[null,t.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{const f=Zi(t.request,(_,x,E,S)=>{_?u(_):x&&u(null,{vectorTile:r?void 0:new y.VectorTile(new $d(x)),rawData:x,cacheControl:E,expires:S})});return()=>{f.cancel(),u()}},e)}const j0=He(new Float64Array(16));class oh{constructor(e,r){this._tr=e,this._worldSize=r}createInversionMatrix(){return j0}createTileMatrix(e){let r,i,u;const f=e.canonical,_=He(new Float64Array(16)),x=this._tr.projection;if(x.isReprojectedInTileSpace){const E=Xh(f,x);r=1,i=E.x+e.wrap*E.scale,u=E.y,$e(_,_,[r/E.scale,r/E.scale,this._tr.pixelsPerMeter/this._worldSize])}else r=this._worldSize/this._tr.zoomScale(f.z),i=(f.x+Math.pow(2,f.z)*e.wrap)*r,u=f.y*r;return Xe(_,_,[i,u,0]),$e(_,_,[r/wn,r/wn,1]),_}pointCoordinate(e,r,i){const u=this._tr.horizonLineFromTop(!1),f=new $(e,Math.max(u,r));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(f,i))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var V0={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Vr(this.parallels,this.constants.parallels))return;const t=Math.sin(en(this.parallels[0])),e=(t+Math.sin(en(this.parallels[1])))/2,r=1+t*(2*e-t),i=Math.sqrt(r)/e;this.constants={n:e,c:r,r0:i,parallels:this.parallels}},project(t,e){this.initializeConstants();const r=en(t-this.center[0]),i=en(e),{n:u,c:f,r0:_}=this.constants,x=Math.sqrt(f-2*u*Math.sin(i))/u;return{x:x*Math.sin(r*u),y:x*Math.cos(r*u)-_,z:0}},unproject(t,e){this.initializeConstants();const{n:r,c:i,r0:u}=this.constants,f=u+e;let _=Math.atan2(t,Math.abs(f))*Math.sign(f);f*r<0&&(_-=Math.PI*Math.sign(t)*Math.sign(f));const x=en(this.center[0])*r;_=Ni(_,-Math.PI-x,Math.PI-x);const E=cr(_/r)+this.center[0],S=Math.asin(rn((i-(t*t+f*f)*r*r)/(2*r),-1,1)),I=rn(cr(S),-85.051129,Xs);return new Gn(E,I)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jo(1,t)*e,farthestPixelDistance(t){return ih(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new oh(t,e)};const qd=1.340264,Wd=-.081106,Xd=893e-6,Hd=.003796,rp=Math.sqrt(3)/2;var $0={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const r=Math.asin(rp*Math.sin(e)),i=r*r,u=i*i*i;return{x:.5*(t*Math.cos(r)/(rp*(qd+3*Wd*i+u*(7*Xd+9*Hd*i)))/Math.PI+.5),y:1-.5*(r*(qd+Wd*i+u*(Xd+Hd*i))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,i=r*r,u=i*i*i;for(let S,I,A,z=0;z<12&&(I=r*(qd+Wd*i+u*(Xd+Hd*i))-e,A=qd+3*Wd*i+u*(7*Xd+9*Hd*i),S=I/A,r=rn(r-S,-Math.PI/3,Math.PI/3),i=r*r,u=i*i*i,!(Math.abs(S)<1e-12));++z);const f=rp*t*(qd+3*Wd*i+u*(7*Xd+9*Hd*i))/Math.cos(r),_=Math.asin(Math.sin(r)/rp),x=rn(180*f/Math.PI,-180,180),E=rn(180*_/Math.PI,-85.051129,Xs);return new Gn(x,E)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jo(1,t)*e,farthestPixelDistance(t){return ih(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new oh(t,e)},Z0={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(t,e)=>({x:.5+t/360,y:.5-e/360,z:0}),unproject(t,e){const r=360*(t-.5),i=rn(360*(.5-e),-85.051129,Xs);return new Gn(r,i)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jo(1,t)*e,farthestPixelDistance(t){return ih(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new oh(t,e)};const Hh=Math.PI/2;function ip(t){return Math.tan((Hh+t)/2)}var G0={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Vr(this.parallels,this.constants.parallels))return;const t=en(this.parallels[0]),e=en(this.parallels[1]),r=Math.cos(t),i=t===e?Math.sin(t):Math.log(r/Math.cos(e))/Math.log(ip(e)/ip(t)),u=r*Math.pow(ip(t),i)/i;this.constants={n:i,f:u,parallels:this.parallels}},project(t,e){this.initializeConstants(),e=en(e),t=en(t-this.center[0]);const r=1e-6,{n:i,f:u}=this.constants;u>0?e<-Hh+r&&(e=-Hh+r):e>Hh-r&&(e=Hh-r);const f=u/Math.pow(ip(e),i),_=f*Math.sin(i*t),x=u-f*Math.cos(i*t);return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+.5),z:0}},unproject(t,e){this.initializeConstants(),t=(2*t-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:r,f:i}=this.constants,u=i-e,f=Math.sign(u),_=Math.sign(r)*Math.sqrt(t*t+u*u);let x=Math.atan2(t,Math.abs(u))*f;u*r<0&&(x-=Math.PI*Math.sign(t)*f);const E=rn(cr(x/r)+this.center[0],-180,180),S=rn(cr(2*Math.atan(Math.pow(i/_,1/r))-Hh),-85.051129,Xs);return new Gn(E,S)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jo(1,t)*e,farthestPixelDistance(t){return ih(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new oh(t,e)},q0={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(t,e)=>({x:dl(t),y:fl(e),z:0}),unproject(t,e){const r=Ss(t),i=Po(e);return new Gn(r,i)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jo(1,t)*e,farthestPixelDistance(t){return ih(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new oh(t,e)};const H_=en(Xs);var W0={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(t,e){const r=(e=en(e))*e,i=r*r;return{x:.5*((t=en(t))*(.8707-.131979*r+i*(i*(.003971*r-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+r*(.015085+i*(.028874*r-.044475-.005916*i)))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,i=25,u=0,f=r*r;do{f=r*r;const E=f*f;u=(r*(1.007226+f*(.015085+E*(.028874*f-.044475-.005916*E)))-e)/(1.007226+f*(.045255+E*(.259866*f-.311325-.005916*11*E))),r=rn(r-u,-H_,H_)}while(Math.abs(u)>1e-6&&--i>0);f=r*r;const _=rn(cr(t/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=cr(r);return new Gn(_,x)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jo(1,t)*e,farthestPixelDistance(t){return ih(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new oh(t,e)};const Y_=en(Xs),K_={albers:V0,equalEarth:$0,equirectangular:Z0,lambertConformalConic:G0,mercator:q0,naturalEarth:W0,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=en(e),t=en(t);const r=Math.cos(e),i=2/Math.PI,u=Math.acos(r*Math.cos(t/2)),f=Math.sin(u)/u,_=.5*(t*i+2*r*Math.sin(t/2)/f)||0,x=.5*(e+Math.sin(e)/f)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}},unproject(t,e){let r=t=(2*t-.5)*Math.PI,i=e=(2*(1-e)-1)*Math.PI,u=25;const f=1e-6;let _=0,x=0;do{const E=Math.cos(i),S=Math.sin(i),I=2*S*E,A=S*S,z=E*E,N=Math.cos(r/2),V=Math.sin(r/2),W=2*N*V,ee=V*V,ae=1-z*N*N,ge=ae?1/ae:0,be=ae?Math.acos(E*N)*Math.sqrt(1/ae):0,Se=.5*(2*be*E*V+2*r/Math.PI)-t,Ae=.5*(be*S+i)-e,ze=.5*ge*(z*ee+be*E*N*A)+1/Math.PI,Qe=ge*(W*I/4-be*S*V),Ke=.125*ge*(I*V-be*S*z*W),yt=.5*ge*(A*N+be*ee*E)+.5,pt=Qe*Ke-yt*ze;_=(Ae*Qe-Se*yt)/pt,x=(Se*Ke-Ae*ze)/pt,r=rn(r-_,-Math.PI,Math.PI),i=rn(i-x,-Y_,Y_)}while((Math.abs(_)>f||Math.abs(x)>f)&&--u>0);return new Gn(cr(r),cr(i))},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jo(1,t)*e,farthestPixelDistance(t){return ih(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new oh(t,e)}};o.ARRAY_TYPE=Me,o.AUTH_ERR_MSG=De,o.Aabb=Ao,o.Actor=class{constructor(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},wo(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ji()?t:H,this.scheduler=new z0}send(t,e,r,i,u=!1,f){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=f,this.callbacks[_]=r);const x=Rr(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:t,hasCallback:!!r,targetMapId:i,mustQueue:u,sourceMapId:this.mapId,data:Zl(e,x)},x),{cancel:()=>{r&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(t){const e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const i=this.cancelCallbacks[r];delete this.cancelCallbacks[r],i&&i.cancel()}else if(e.mustQueue||ji()){const i=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),i&&i.metadata||{type:"message"})}else this.processTask(r,e)}processTask(t,e){if(e.type==="<response>"){const r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(hi(e.error)):r(null,hi(e.data)))}else{const r=Rr(this.globalScope)?void 0:[],i=e.hasCallback?(f,_)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:f?Zl(f):null,data:Zl(_,r)},r)}:f=>{},u=hi(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,i);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,i)}else i(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=Kf,o.Color=In,o.ColorMode=_l,o.CullFaceMode=Ra,o.DEMData=Jf,o.DataConstantProperty=Ct,o.DedupedRequest=W_,o.DepthMode=Wh,o.EXTENT=wn,o.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){e==null&&(e=null);const i=this._source();if(!i||t.y<0||t.y>1)return e;const u=i.getSource().maxzoom,f=1<<u,_=Math.floor(t.x),x=t.x-_,E=new zo(u,_,u,Math.floor(x*f),Math.floor(t.y*f)),S=this.findDEMTileFor(E);if(!S||!S.dem)return e;const I=S.dem,A=1<<S.tileID.canonical.z,z=(x*A-S.tileID.canonical.x)*I.dim,N=(t.y*A-S.tileID.canonical.y)*I.dim,V=Math.floor(z),W=Math.floor(N);return(r?this.exaggeration():1)*Nn(Nn(I.get(V,W),I.get(V,W+1),N-W),Nn(I.get(V+1,W),I.get(V+1,W+1),N-W),z-V)}getAtTileOffset(t,e,r){const i=1<<t.canonical.z;return this.getAtPointOrZero(new Kl(t.wrap+(t.canonical.x+e/wn)/i,(t.canonical.y+r/wn)/i))}getAtTileOffsetFunc(t,e){return r=>{const i=this.getAtTileOffset(t,r.x,r.y),u=e.upVector(t.canonical,r.x,r.y);return Fe(u,u,i*e.upVectorScale(t.canonical)),u}}getForTilePoints(t,e,r,i){const u=Qf.create(this,t,i);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],r)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,i=e.tileID,u=1<<t.canonical.z-i.canonical.z;let f=t.canonical.x/u-i.canonical.x,_=t.canonical.y/u-i.canonical.y,x=0;for(let E=0;E<t.canonical.z-i.canonical.z&&!r.leaves[x];E++){f*=2,_*=2;const S=2*Math.floor(_)+Math.floor(f);x=r.childOffsets[x]+S,f%=1,_%=1}return{min:this.exaggeration()*r.minimums[x],max:this.exaggeration()*r.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=ie,o.EvaluationParameters=Ht,o.Event=X,o.Evented=xe,o.Frustum=tu,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GlobeSharedBuffers=bm,o.GlyphManager=Gh,o.ImagePosition=Jp,o.LineAtlas=hm,o.LngLat=Gn,o.LngLatBounds=hl,o.LocalGlyphMode=nm,o.MAX_MERCATOR_LATITUDE=Xs,o.MercatorCoordinate=Kl,o.ONE_EM=Bi,o.OverscaledTileID=zo,o.Properties=Er,o.RGBAImage=po,o.Ray=class{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,r){const i=vn(e,this.dir);if(Math.abs(i)<1e-6)return!1;const u=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/i;return r[0]=this.pos[0]+this.dir[0]*u,r[1]=this.pos[1]+this.dir[1]*u,r[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(t,e,r){if(function(z,N){var V=z[0],W=z[1],ee=z[2],ae=N[0],ge=N[1],be=N[2];return Math.abs(V-ae)<=Te*Math.max(1,Math.abs(V),Math.abs(ae))&&Math.abs(W-ge)<=Te*Math.max(1,Math.abs(W),Math.abs(ge))&&Math.abs(ee-be)<=Te*Math.max(1,Math.abs(ee),Math.abs(be))}(this.pos,t)||e===0)return r[0]=r[1]=r[2]=0,!1;const[i,u,f]=this.dir,_=this.pos[0]-t[0],x=this.pos[1]-t[1],E=this.pos[2]-t[2],S=i*i+u*u+f*f,I=2*(_*i+x*u+E*f),A=I*I-4*S*(_*_+x*x+E*E-e*e);if(A<0){const z=Math.max(-I/2,0),N=_+i*z,V=x+u*z,W=E+f*z,ee=Math.hypot(N,V,W);return r[0]=N*e/ee,r[1]=V*e/ee,r[2]=W*e/ee,!1}{const z=(-I-Math.sqrt(A))/(2*S);if(z<0){const N=Math.hypot(_,x,E);return r[0]=_*e/N,r[1]=x*e/N,r[2]=E*e/N,!1}return r[0]=_+i*z,r[1]=x+u*z,r[2]=E+f*z,!0}}},o.RequestManager=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",we,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!We(t))return t;const r=Mt(t);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!We(t))return t;const r=Mt(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!We(t))return t;const r=Mt(t);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,i){const u=Mt(t);return We(t)?(u.path=`/styles/v1${u.path}/sprite${e}${r}`,this._makeAPIURL(u,this._customAccessToken||i)):(u.path+=`${e}${r}`,At(u))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!We(t))return t;const i=Mt(t);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&i.authority!=="raster"&&r===512?"@2x":""}${Z.supported?".webp":"$1"}`),i.authority==="raster"?i.path=`/${F.RASTER_URL_PREFIX}${i.path}`:(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path=`/${F.TILE_URL_VERSION}${i.path}`);const u=this._customAccessToken||function(f){for(const _ of f){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(i.params)||F.ACCESS_TOKEN;return F.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&i.params.push(`sku=${this._skuToken}`),this._makeAPIURL(i,u)}canonicalizeTileURL(t,e){const r=Mt(t);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let i="mapbox://";r.path.match(/^\/raster\/v1\//)?i+=`raster/${r.path.replace(`/${F.RASTER_URL_PREFIX}/`,"")}`:i+=`tiles/${r.path.replace(`/${F.TILE_URL_VERSION}/`,"")}`;let u=r.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(i+=`?${u.join("&")}`),i}canonicalizeTileset(t,e){const r=!!e&&We(e),i=[];for(const u of t.tiles||[])et(u)?i.push(this.canonicalizeTileURL(u,r)):i.push(u);return i}_makeAPIURL(t,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",i=Mt(F.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,t.protocol==="http"){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(i.path!=="/"&&(t.path=`${i.path}${t.path}`),!F.REQUIRE_ACCESS_TOKEN)return At(t);if(e=e||F.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),At(t)}},o.ResourceType=gr,o.SegmentVector=Cr,o.SourceCache=rh,o.StencilMode=pm,o.StructArrayLayout1ui2=Oc,o.StructArrayLayout2f1f2i16=ql,o.StructArrayLayout2i4=kr,o.StructArrayLayout2ui4=Zs,o.StructArrayLayout3f12=ni,o.StructArrayLayout3ui6=uo,o.StructArrayLayout4i8=Ea,o.Texture=Yf,o.Tile=ym,o.Transitionable=Bn,o.Uniform1f=Yl,o.Uniform1i=class extends Gs{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},o.Uniform2f=class extends Gs{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},o.Uniform3f=class extends Gs{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},o.Uniform4f=Cd,o.UniformColor=Pd,o.UniformMatrix2f=class extends Gs{constructor(t,e){super(t,e),this.current=Pf}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},o.UniformMatrix3f=class extends Gs{constructor(t,e){super(t,e),this.current=Cf}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},o.UniformMatrix4f=class extends Gs{constructor(t,e){super(t,e),this.current=Mf}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},o.UnwrappedTileID=dm,o.ValidationError=ke,o.VectorTileWorkerSource=class extends xe{constructor(t,e,r,i,u){super(),this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=u||X_,this.loading={},this.loaded={},this.deduped=new W_(t.scheduler),this.isSpriteLoaded=i,this.scheduler=t.scheduler}loadTile(t,e){const r=t.uid,i=t&&t.request,u=i&&i.collectResourceTiming,f=this.loading[r]=new U0(t);f.abort=this.loadVectorData(t,(_,x)=>{const E=!this.loading[r];if(delete this.loading[r],E||_||!x)return f.status="done",E||(this.loaded[r]=f),e(_);const S=x.rawData,I={};x.expires&&(I.expires=x.expires),x.cacheControl&&(I.cacheControl=x.cacheControl),f.vectorTile=x.vectorTile||new y.VectorTile(new $d(S));const A=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(z,N)=>{if(z||!N)return e(z);const V={};if(u){const W=E_(i);W.length>0&&(V.resourceTiming=JSON.parse(JSON.stringify(W)))}e(null,qn({rawTileData:S.slice(0)},N,I,V))})};this.isSpriteLoaded?A():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(A,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):A()}),this.loaded=this.loaded||{},this.loaded[r]=f})}reloadTile(t,e){const r=this.loaded,i=t.uid,u=this;if(r&&r[i]){const f=r[i];f.showCollisionBoxes=t.showCollisionBoxes,f.enableTerrain=!!t.enableTerrain,f.projection=t.projection;const _=(x,E)=>{const S=f.reloadCallback;S&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,S)),e(x,E)};f.status==="parsing"?f.reloadCallback=_:f.status==="done"&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(t,e){const r=t.uid,i=this.loading[r];i&&(i.abort&&i.abort(),delete this.loading[r]),e()}removeTile(t,e){const r=this.loaded,i=t.uid;r&&r[i]&&delete r[i],e()}},o.WritingMode=Cs,o.ZoomHistory=p,o.add=$t,o.addDynamicAttributes=sm,o.adjoint=function(t,e){var r=e[0],i=e[1],u=e[2],f=e[3],_=e[4],x=e[5],E=e[6],S=e[7],I=e[8];return t[0]=_*I-x*S,t[1]=u*S-i*I,t[2]=i*x-u*_,t[3]=x*E-f*I,t[4]=r*I-u*E,t[5]=u*f-r*x,t[6]=f*S-_*E,t[7]=i*E-r*S,t[8]=r*_-i*f,t},o.asyncAll=os,o.bezier=is,o.bindAll=wo,o.boundsAttributes=_m,o.bufferConvexPolygon=function(t,e){const r=[];for(let i=0;i<t.length;i++){const u=Ni(i-1,-1,t.length-1),f=Ni(i+1,-1,t.length-1),_=t[i],x=t[f],E=t[u].sub(_).unit(),S=x.sub(_).unit(),I=S.angleWithSep(E.x,E.y),A=E.add(S).unit().mult(-1*e/Math.sin(I/2));r.push(_.add(A))}return r},o.cacheEntryPossiblyAdded=function(t){Gr++,Gr>ki&&(t.getActor().send("enforceCacheSizeLimit",bi),Gr=0)},o.calculateGlobeMatrix=G_,o.calculateGlobeMercatorMatrix=function(t){const e=t.worldSize,r=rn(t.center.lat,-85.051129,Xs),i=new $(dl(t.center.lng)*e,fl(r)*e),u=Jo(1,t.center.lat)*e,f=t.pixelsPerMeter,_=e/(u/t.pixelsPerMeter),x=He(new Float64Array(16));return Xe(x,x,[i.x,i.y,0]),$e(x,x,[_,_,f]),x},o.clamp=rn,o.clearTileCache=function(t){const e=H.caches.delete(rr);t&&e.catch(t).then(()=>t())},o.clipLine=c_,o.clone=function(t){var e=new Me(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.clone$1=Zr,o.collisionCircleLayout=Zx,o.config=F,o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.create=function(){var t=new Me(16);return Me!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},o.create$1=je,o.createExpression=el,o.createLayout=un,o.createStyleLayer=function(t){return t.type==="custom"?new C0(t):new I0[t.type](t)},o.cross=ut,o.degToRad=en,o.div=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},o.dot=vn,o.ease=vo,o.easeCubicInOut=Oo,o.emitValidationErrors=Dc,o.endsWith=No,o.enforceCacheSizeLimit=function(t){hs(),Sr&&Sr.then(e=>{e.keys().then(r=>{for(let i=0;i<r.length-t;i++)e.delete(r[i])})})},o.evaluateSizeForFeature=Nf,o.evaluateSizeForZoom=jh,o.evaluateVariableOffset=m_,o.evented=Hr,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.exported=si,o.exported$1=Z,o.extend=qn,o.extend$1=tn,o.filterObject=ls,o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.fromQuat=function(t,e){var r=e[0],i=e[1],u=e[2],f=e[3],_=r+r,x=i+i,E=u+u,S=r*_,I=i*_,A=i*x,z=u*_,N=u*x,V=u*E,W=f*_,ee=f*x,ae=f*E;return t[0]=1-A-V,t[1]=I+ae,t[2]=z-ee,t[3]=0,t[4]=I-ae,t[5]=1-S-V,t[6]=N+W,t[7]=0,t[8]=z+ee,t[9]=N-W,t[10]=1-S-A,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return $r[e]},o.getAABBPointSquareDist=function(t,e,r){let i=0;for(let u=0;u<2;++u){const f=r?r[u]:0;t[u]>f&&(i+=(t[u]-f)*(t[u]-f)),e[u]<f&&(i+=(f-e[u])*(f-e[u]))}return i},o.getAnchorAlignment=tm,o.getAnchorJustification=im,o.getBounds=function(t){let e=1/0,r=1/0,i=-1/0,u=-1/0;for(const f of t)e=Math.min(e,f.x),r=Math.min(r,f.y),i=Math.max(i,f.x),u=Math.max(u,f.y);return{min:new $(e,r),max:new $(i,u)}},o.getColumn=function(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]},o.getImage=El,o.getJSON=function(t,e){return Or(qn(t,{type:"json"}),e)},o.getMapSessionAPI=br,o.getPerformanceMeasurement=E_,o.getProjection=function(t){const e=K_[t.name];if(!e)throw new Error(`Invalid projection name: ${t.name}`);return e.conic?function(r,i){if(i.parallels&&Math.abs(i.parallels[0]+i.parallels[1])<.01){let u=function(f){const _=Math.max(.01,Math.cos(en(f))),x=1/(2*Math.max(Math.PI*_,1/_));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(E,S){const I=en(E)*_,A=Math.sin(en(S))/_;return{x:I*x+.5,y:-A*x+.5,z:0}},unproject(E,S){const I=-(S-.5)/x,A=rn(cr((E-.5)/x)/_,-180,180),z=Math.asin(rn(I*_,-1,1)),N=rn(cr(z),-85.051129,Xs);return new Gn(A,N)}}}(i.parallels[0]);if(i.name==="lambertConformalConic"){const{project:f,unproject:_}=K_.mercator;u={wrap:!0,supportsWorldCopies:!0,project:f,unproject:_}}return qn({},r,i,u)}return qn({},r,i)}(e,t):e},o.getRTLTextPluginStatus=di,o.getReferrer=zi,o.getTilePoint=function(t,{x:e,y:r},i=0){return new $(((e-i)*t.scale-t.x)*wn,(r*t.scale-t.y)*wn)},o.getTileVec3=function(t,e,r=0){return Nt(((e.x-r)*t.scale-t.x)*wn,(e.y*t.scale-t.y)*wn,kf(e.z,e.y))},o.getVideo=function(t,e){const r=H.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let i=0;i<t.length;i++){const u=H.document.createElement("source");Gi(t[i])||(r.crossOrigin="Anonymous"),u.src=t[i],r.appendChild(u)}return{cancel:()=>{}}},o.globeBuffersForTileMesh=function(t,e,r,i){const u=t.context,f=t.transform;let _=e.globeGridBuffer,x=e.globePoleBuffer;if(!_){const E=bm.createGridVertices(r.canonical);_=e.globeGridBuffer=u.createVertexBuffer(E,j_,!1)}if(!x){const E=bm.createPoleTriangleVertices(i,f.tileSize*i,r.canonical.y===0);x=e.globePoleBuffer=u.createVertexBuffer(E,j_,!1)}return[_,x]},o.globeDenormalizeECEF=Z_,o.globeMatrixForTile=function(t,e){const r=Z_(tp(t)),i=((u=new Float64Array(16))[0]=(f=e)[0],u[1]=f[1],u[2]=f[2],u[3]=f[3],u[4]=f[4],u[5]=f[5],u[6]=f[6],u[7]=f[7],u[8]=f[8],u[9]=f[9],u[10]=f[10],u[11]=f[11],u[12]=f[12],u[13]=f[13],u[14]=f[14],u[15]=f[15],u);var u,f;return It(i,i,r),i},o.globePoleMatrixForTile=function(t,e,r){const i=He(new Float64Array(16)),u=Math.pow(2,t.z),f=(t.x-u/2)/u*Math.PI*2,_=r.point,x=r.worldSize/(r.tileSize*u);return Xe(i,i,[_.x,_.y,-r.worldSize/Math.PI/2]),$e(i,i,[x,x,x]),Ze(i,i,en(-r._center.lat)),xt(i,i,en(-r._center.lng)),xt(i,i,f),e&&$e(i,i,[1,-1,1]),i},o.globeTileBounds=tp,o.globeToMercatorTransition=function(t){return xo(5,6,t)},o.identity=He,o.identity$1=Lr,o.invert=function(t,e){var r=e[0],i=e[1],u=e[2],f=e[3],_=e[4],x=e[5],E=e[6],S=e[7],I=e[8],A=e[9],z=e[10],N=e[11],V=e[12],W=e[13],ee=e[14],ae=e[15],ge=r*x-i*_,be=r*E-u*_,Se=r*S-f*_,Ae=i*E-u*x,ze=i*S-f*x,Qe=u*S-f*E,Ke=I*W-A*V,yt=I*ee-z*V,pt=I*ae-N*V,Je=A*ee-z*W,mt=A*ae-N*W,vt=z*ae-N*ee,rt=ge*vt-be*mt+Se*Je+Ae*pt-ze*yt+Qe*Ke;return rt?(t[0]=(x*vt-E*mt+S*Je)*(rt=1/rt),t[1]=(u*mt-i*vt-f*Je)*rt,t[2]=(W*Qe-ee*ze+ae*Ae)*rt,t[3]=(z*ze-A*Qe-N*Ae)*rt,t[4]=(E*pt-_*vt-S*yt)*rt,t[5]=(r*vt-u*pt+f*yt)*rt,t[6]=(ee*Se-V*Qe-ae*be)*rt,t[7]=(I*Qe-z*Se+N*be)*rt,t[8]=(_*mt-x*pt+S*Ke)*rt,t[9]=(i*pt-r*mt-f*Ke)*rt,t[10]=(V*ze-W*Se+ae*ge)*rt,t[11]=(A*Se-I*ze-N*ge)*rt,t[12]=(x*yt-_*Je-E*Ke)*rt,t[13]=(r*Je-i*yt+u*Ke)*rt,t[14]=(W*be-V*Ae-ee*ge)*rt,t[15]=(I*Ae-A*be+z*ge)*rt,t):null},o.isMapAuthenticated=function(t){return ai.has(t)},o.isMapboxURL=We,o.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Rr(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Po,o.len=On,o.length=Yt,o.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},o.loadVectorTile=X_,o.makeRequest=Or,o.mercatorXfromLng=dl,o.mercatorYfromLat=fl,o.mercatorZfromAltitude=Jo,o.mul=It,o.mul$1=nr,o.multiply=function(t,e,r){var i=e[0],u=e[1],f=e[2],_=e[3],x=e[4],E=e[5],S=e[6],I=e[7],A=e[8],z=r[0],N=r[1],V=r[2],W=r[3],ee=r[4],ae=r[5],ge=r[6],be=r[7],Se=r[8];return t[0]=z*i+N*_+V*S,t[1]=z*u+N*x+V*I,t[2]=z*f+N*E+V*A,t[3]=W*i+ee*_+ae*S,t[4]=W*u+ee*x+ae*I,t[5]=W*f+ee*E+ae*A,t[6]=ge*i+be*_+Se*S,t[7]=ge*u+be*x+Se*I,t[8]=ge*f+be*E+Se*A,t},o.multiply$1=Ve,o.multiply$2=yn,o.nextPowerOfTwo=oi,o.normalize=Qt,o.normalize$1=function(t,e){var r=e[0],i=e[1],u=e[2],f=e[3],_=r*r+i*i+u*u+f*f;return _>0&&(_=1/Math.sqrt(_)),t[0]=r*_,t[1]=i*_,t[2]=u*_,t[3]=f*_,t},o.number=Nn,o.ortho=function(t,e,r,i,u,f,_){var x=1/(e-r),E=1/(i-u),S=1/(f-_);return t[0]=-2*x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*E,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*S,t[11]=0,t[12]=(e+r)*x,t[13]=(u+i)*E,t[14]=(_+f)*S,t[15]=1,t},o.pbf=$d,o.perspective=function(t,e,r,i,u){var f,_=1/Math.tan(e/2);return t[0]=_/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+i)*(f=1/(i-u)),t[14]=2*u*i*f):(t[10]=-1,t[14]=-2*i),t},o.pick=function(t,e){const r={};for(let i=0;i<e.length;i++){const u=e[i];u in t&&(r[u]=t[u])}return r},o.plugin=Tn,o.pointGeometry=$,o.polygonIntersectsBox=Rh,o.polygonIntersectsPolygon=Jl,o.polygonizeBounds=function(t,e,r=0,i=!0){const u=new $(r,r),f=t.sub(u),_=e.add(u),x=[f,new $(_.x,f.y),_,new $(f.x,_.y)];return i&&x.push(f),x},o.posAttributes=O0,o.postMapLoadEvent=Sn,o.postTurnstileEvent=jn,o.potpack=Kp,o.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.radToDeg=cr,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(t){return t({pluginStatus:Xt,pluginURL:gn}),Hr.on("pluginStateChange",t),t},o.removeAuthState=function(t){ai.delete(t)},o.renderColorRamp=Xc,o.rotateX=Ze,o.rotateX$1=Ai,o.rotateY=xt,o.rotateZ=function(t,e,r){var i=Math.sin(r),u=Math.cos(r),f=e[0],_=e[1],x=e[2],E=e[3],S=e[4],I=e[5],A=e[6],z=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u+S*i,t[1]=_*u+I*i,t[2]=x*u+A*i,t[3]=E*u+z*i,t[4]=S*u-f*i,t[5]=I*u-_*i,t[6]=A*u-x*i,t[7]=z*u-E*i,t},o.rotateZ$1=function(t,e,r){r*=.5;var i=e[0],u=e[1],f=e[2],_=e[3],x=Math.sin(r),E=Math.cos(r);return t[0]=i*E+u*x,t[1]=u*E-i*x,t[2]=f*E+_*x,t[3]=_*E-f*x,t},o.scale=$e,o.scale$1=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},o.scale$2=Fe,o.scaleAndAdd=gt,o.setCacheLimits=function(t,e){bi=t,ki=e},o.setColumn=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},o.setRTLTextPlugin=function(t,e,r=!1){if(Xt===Ft||Xt===Kt||Xt===zn)throw new Error("setRTLTextPlugin cannot be called multiple times.");gn=si.resolveURL(t),Xt=Ft,Wn=e,Jn(),r||ti()},o.smoothstep=xo,o.spec=le,o.storeAuthState=function(t,e){e?ai.add(t):ai.delete(t)},o.sub=Jt,o.subtract=Et,o.symbolSize=Gx,o.tileAABB=function(t,e,r,i,u,f,_,x,E){if(E.name==="globe"){const N=tp(new dm(f,new Kf(r,i,u)).canonical).getCorners(),V=Number.MAX_VALUE,W=[-V,-V,-V],ee=[V,V,V],ae=G_(t,e);for(let ge=0;ge<N.length;ge++)st(N[ge],N[ge],ae),I=ee,A=N[ge],(S=ee)[0]=Math.min(I[0],A[0]),S[1]=Math.min(I[1],A[1]),S[2]=Math.min(I[2],A[2]),Dr(W,W,N[ge]);return new Ao(ee,W)}var S,I,A;const z=Xh({z:r,x:i,y:u},E);return new Ao([(f+z.x/z.scale)*e,e*(z.y/z.scale),_],[(f+z.x2/z.scale)*e,e*(z.y2/z.scale),x])},o.tileTransform=Xh,o.transformMat3=function(t,e,r){var i=e[0],u=e[1],f=e[2];return t[0]=i*r[0]+u*r[3]+f*r[6],t[1]=i*r[1]+u*r[4]+f*r[7],t[2]=i*r[2]+u*r[5]+f*r[8],t},o.transformMat4=st,o.transformMat4$1=ar,o.transformQuat=wt,o.translate=Xe,o.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.triggerPluginCompletionEvent=Xn,o.uniqueId=ss,o.validateCustomStyleLayer=function(t){const e=[],r=t.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFog=zc,o.validateLight=al,o.validateStyle=ao,o.values=Bo,o.vectorTile=y,o.version=G,o.warnOnce=Kn,o.window=H,o.wrap=Ni}),k(["./shared"],function(o){function G(se){const F=typeof se;if(F==="number"||F==="boolean"||F==="string"||se==null)return JSON.stringify(se);if(Array.isArray(se)){let ue="[";for(const ve of se)ue+=`${G(ve)},`;return`${ue}]`}const Z=Object.keys(se).sort();let re="{";for(let ue=0;ue<Z.length;ue++)re+=`${JSON.stringify(Z[ue])}:${G(se[Z[ue]])},`;return`${re}}`}function ne(se){let F="";for(const Z of o.refProperties)F+=`/${G(se[Z])}`;return F}class oe{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,Z){for(const ue of F)this._layerConfigs[ue.id]=ue,(this._layers[ue.id]=o.createStyleLayer(ue)).compileFilter(),this.keyCache[ue.id]&&delete this.keyCache[ue.id];for(const ue of Z)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const re=function(ue,ve){const Ie={};for(let we=0;we<ue.length;we++){const De=ve&&ve[ue[we].id]||ne(ue[we]);ve&&(ve[ue[we].id]=De);let We=Ie[De];We||(We=Ie[De]=[]),We.push(ue[we])}const Ce=[];for(const we in Ie)Ce.push(Ie[we]);return Ce}(o.values(this._layerConfigs),this.keyCache);for(const ue of re){const ve=ue.map(et=>this._layers[et.id]),Ie=ve[0];if(Ie.visibility==="none")continue;const Ce=Ie.source||"";let we=this.familiesBySource[Ce];we||(we=this.familiesBySource[Ce]={});const De=Ie.sourceLayer||"_geojsonTileLayer";let We=we[De];We||(We=we[De]=[]),We.push(ve)}}}const{ImageBitmap:$}=o.window;class de{loadTile(F,Z){const{uid:re,encoding:ue,rawImageData:ve,padding:Ie,buildQuadTree:Ce}=F,we=$&&ve instanceof $?this.getImageData(ve,Ie):ve;Z(null,new o.DEMData(re,we,ue,Ie<1,Ce))}getImageData(F,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(F.width,F.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=F.width,this.offscreenCanvas.height=F.height,this.offscreenCanvasContext.drawImage(F,0,0,F.width,F.height);const re=this.offscreenCanvasContext.getImageData(-Z,-Z,F.width+2*Z,F.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:re.width,height:re.height},re.data)}}var H=function se(F,Z){var re,ue=F&&F.type;if(ue==="FeatureCollection")for(re=0;re<F.features.length;re++)se(F.features[re],Z);else if(ue==="GeometryCollection")for(re=0;re<F.geometries.length;re++)se(F.geometries[re],Z);else if(ue==="Feature")se(F.geometry,Z);else if(ue==="Polygon")Te(F.coordinates,Z);else if(ue==="MultiPolygon")for(re=0;re<F.coordinates.length;re++)Te(F.coordinates[re],Z);return F};function Te(se,F){if(se.length!==0){Me(se[0],F);for(var Z=1;Z<se.length;Z++)Me(se[Z],!1)}}function Me(se,F){for(var Z=0,re=0,ue=0,ve=se.length,Ie=ve-1;ue<ve;Ie=ue++){var Ce=(se[ue][0]-se[Ie][0])*(se[Ie][1]+se[ue][1]),we=Z+Ce;re+=Math.abs(Z)>=Math.abs(Ce)?Z-we+Ce:Ce-we+Z,Z=we}Z+re>=0!=!!F&&se.reverse()}const je=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class He{constructor(F){this._feature=F,this.extent=o.EXTENT,this.type=F.type,this.properties=F.tags,"id"in F&&!isNaN(F.id)&&(this.id=parseInt(F.id,10))}loadGeometry(){if(this._feature.type===1){const F=[];for(const Z of this._feature.geometry)F.push([new o.pointGeometry(Z[0],Z[1])]);return F}{const F=[];for(const Z of this._feature.geometry){const re=[];for(const ue of Z)re.push(new o.pointGeometry(ue[0],ue[1]));F.push(re)}return F}}toGeoJSON(F,Z,re){return je.call(this,F,Z,re)}}class Ve{constructor(F){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=F.length,this._features=F}feature(F){return new He(this._features[F])}}var Xe=o.vectorTile.VectorTileFeature,$e=Ze;function Ze(se,F){this.options=F||{},this.features=se,this.length=se.length}function xt(se,F){this.id=typeof se.id=="number"?se.id:void 0,this.type=se.type,this.rawGeometry=se.type===1?[se.geometry]:se.geometry,this.properties=se.tags,this.extent=F||4096}Ze.prototype.feature=function(se){return new xt(this.features[se],this.options.extent)},xt.prototype.loadGeometry=function(){var se=this.rawGeometry;this.geometry=[];for(var F=0;F<se.length;F++){for(var Z=se[F],re=[],ue=0;ue<Z.length;ue++)re.push(new o.pointGeometry(Z[ue][0],Z[ue][1]));this.geometry.push(re)}return this.geometry},xt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var se=this.geometry,F=1/0,Z=-1/0,re=1/0,ue=-1/0,ve=0;ve<se.length;ve++)for(var Ie=se[ve],Ce=0;Ce<Ie.length;Ce++){var we=Ie[Ce];F=Math.min(F,we.x),Z=Math.max(Z,we.x),re=Math.min(re,we.y),ue=Math.max(ue,we.y)}return[F,re,Z,ue]},xt.prototype.toGeoJSON=Xe.prototype.toGeoJSON;var It=Ot,Pt=$e;function Ot(se){var F=new o.pbf;return function(Z,re){for(var ue in Z.layers)re.writeMessage(3,Yt,Z.layers[ue])}(se,F),F.finish()}function Yt(se,F){var Z;F.writeVarintField(15,se.version||1),F.writeStringField(1,se.name||""),F.writeVarintField(5,se.extent||4096);var re={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<se.length;Z++)re.feature=se.feature(Z),F.writeMessage(2,Nt,re);var ue=re.keys;for(Z=0;Z<ue.length;Z++)F.writeStringField(3,ue[Z]);var ve=re.values;for(Z=0;Z<ve.length;Z++)F.writeMessage(4,Fe,ve[Z])}function Nt(se,F){var Z=se.feature;Z.id!==void 0&&F.writeVarintField(1,Z.id),F.writeMessage(2,$t,se),F.writeVarintField(3,Z.type),F.writeMessage(4,Dr,Z)}function $t(se,F){var Z=se.feature,re=se.keys,ue=se.values,ve=se.keycache,Ie=se.valuecache;for(var Ce in Z.properties){var we=Z.properties[Ce],De=ve[Ce];if(we!==null){De===void 0&&(re.push(Ce),ve[Ce]=De=re.length-1),F.writeVarint(De);var We=typeof we;We!=="string"&&We!=="boolean"&&We!=="number"&&(we=JSON.stringify(we));var et=We+":"+we,it=Ie[et];it===void 0&&(ue.push(we),Ie[et]=it=ue.length-1),F.writeVarint(it)}}}function Et(se,F){return(F<<3)+(7&se)}function yn(se){return se<<1^se>>31}function Dr(se,F){for(var Z=se.loadGeometry(),re=se.type,ue=0,ve=0,Ie=Z.length,Ce=0;Ce<Ie;Ce++){var we=Z[Ce],De=1;re===1&&(De=we.length),F.writeVarint(Et(1,De));for(var We=re===3?we.length-1:we.length,et=0;et<We;et++){et===1&&re!==1&&F.writeVarint(Et(2,We-1));var it=we[et].x-ue,Mt=we[et].y-ve;F.writeVarint(yn(it)),F.writeVarint(yn(Mt)),ue+=it,ve+=Mt}re===3&&F.writeVarint(Et(7,1))}}function Fe(se,F){var Z=typeof se;Z==="string"?F.writeStringField(1,se):Z==="boolean"?F.writeBooleanField(7,se):Z==="number"&&(se%1!=0?F.writeDoubleField(3,se):se<0?F.writeSVarintField(6,se):F.writeVarintField(5,se))}function gt(se,F,Z,re,ue,ve){if(ue-re<=Z)return;const Ie=re+ue>>1;Qt(se,F,Ie,re,ue,ve%2),gt(se,F,Z,re,Ie-1,ve+1),gt(se,F,Z,Ie+1,ue,ve+1)}function Qt(se,F,Z,re,ue,ve){for(;ue>re;){if(ue-re>600){const De=ue-re+1,We=Z-re+1,et=Math.log(De),it=.5*Math.exp(2*et/3),Mt=.5*Math.sqrt(et*it*(De-it)/De)*(We-De/2<0?-1:1);Qt(se,F,Z,Math.max(re,Math.floor(Z-We*it/De+Mt)),Math.min(ue,Math.floor(Z+(De-We)*it/De+Mt)),ve)}const Ie=F[2*Z+ve];let Ce=re,we=ue;for(vn(se,F,re,Z),F[2*ue+ve]>Ie&&vn(se,F,re,ue);Ce<we;){for(vn(se,F,Ce,we),Ce++,we--;F[2*Ce+ve]<Ie;)Ce++;for(;F[2*we+ve]>Ie;)we--}F[2*re+ve]===Ie?vn(se,F,re,we):(we++,vn(se,F,we,ue)),we<=Z&&(re=we+1),Z<=we&&(ue=we-1)}}function vn(se,F,Z,re){ut(se,Z,re),ut(F,2*Z,2*re),ut(F,2*Z+1,2*re+1)}function ut(se,F,Z){const re=se[F];se[F]=se[Z],se[Z]=re}function st(se,F,Z,re){const ue=se-Z,ve=F-re;return ue*ue+ve*ve}It.fromVectorTileJs=Ot,It.fromGeojsonVt=function(se,F){F=F||{};var Z={};for(var re in se)Z[re]=new $e(se[re].features,F),Z[re].name=re,Z[re].version=F.version,Z[re].extent=F.extent;return Ot({layers:Z})},It.GeoJSONWrapper=Pt;const wt=se=>se[0],Wt=se=>se[1];class Jt{constructor(F,Z=wt,re=Wt,ue=64,ve=Float64Array){this.nodeSize=ue,this.points=F;const Ie=F.length<65536?Uint16Array:Uint32Array,Ce=this.ids=new Ie(F.length),we=this.coords=new ve(2*F.length);for(let De=0;De<F.length;De++)Ce[De]=De,we[2*De]=Z(F[De]),we[2*De+1]=re(F[De]);gt(Ce,we,ue,0,Ce.length-1,0)}range(F,Z,re,ue){return function(ve,Ie,Ce,we,De,We,et){const it=[0,ve.length-1,0],Mt=[];let At,Lt;for(;it.length;){const Ut=it.pop(),on=it.pop(),jn=it.pop();if(on-jn<=et){for(let Vn=jn;Vn<=on;Vn++)At=Ie[2*Vn],Lt=Ie[2*Vn+1],At>=Ce&&At<=De&&Lt>=we&&Lt<=We&&Mt.push(ve[Vn]);continue}const Qn=Math.floor((jn+on)/2);At=Ie[2*Qn],Lt=Ie[2*Qn+1],At>=Ce&&At<=De&&Lt>=we&&Lt<=We&&Mt.push(ve[Qn]);const Sn=(Ut+1)%2;(Ut===0?Ce<=At:we<=Lt)&&(it.push(jn),it.push(Qn-1),it.push(Sn)),(Ut===0?De>=At:We>=Lt)&&(it.push(Qn+1),it.push(on),it.push(Sn))}return Mt}(this.ids,this.coords,F,Z,re,ue,this.nodeSize)}within(F,Z,re){return function(ue,ve,Ie,Ce,we,De){const We=[0,ue.length-1,0],et=[],it=we*we;for(;We.length;){const Mt=We.pop(),At=We.pop(),Lt=We.pop();if(At-Lt<=De){for(let Sn=Lt;Sn<=At;Sn++)st(ve[2*Sn],ve[2*Sn+1],Ie,Ce)<=it&&et.push(ue[Sn]);continue}const Ut=Math.floor((Lt+At)/2),on=ve[2*Ut],jn=ve[2*Ut+1];st(on,jn,Ie,Ce)<=it&&et.push(ue[Ut]);const Qn=(Mt+1)%2;(Mt===0?Ie-we<=on:Ce-we<=jn)&&(We.push(Lt),We.push(Ut-1),We.push(Qn)),(Mt===0?Ie+we>=on:Ce+we>=jn)&&(We.push(Ut+1),We.push(At),We.push(Qn))}return et}(this.ids,this.coords,F,Z,re,this.nodeSize)}}const nr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:se=>se},On=Math.fround||(ar=new Float32Array(1),se=>(ar[0]=+se,ar[0]));var ar;class Pn{constructor(F){this.options=$r(Object.create(nr),F),this.trees=new Array(this.options.maxZoom+1)}load(F){const{log:Z,minZoom:re,maxZoom:ue,nodeSize:ve}=this.options;Z&&console.time("total time");const Ie=`prepare ${F.length} points`;Z&&console.time(Ie),this.points=F;let Ce=[];for(let we=0;we<F.length;we++)F[we].geometry&&Ce.push(Ai(F[we],we));this.trees[ue+1]=new Jt(Ce,Oo,is,ve,Float32Array),Z&&console.timeEnd(Ie);for(let we=ue;we>=re;we--){const De=+Date.now();Ce=this._cluster(Ce,we),this.trees[we]=new Jt(Ce,Oo,is,ve,Float32Array),Z&&console.log("z%d: %d clusters in %dms",we,Ce.length,+Date.now()-De)}return Z&&console.timeEnd("total time"),this}getClusters(F,Z){let re=((F[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,F[1]));let ve=F[2]===180?180:((F[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)re=-180,ve=180;else if(re>ve){const We=this.getClusters([re,ue,180,Ie],Z),et=this.getClusters([-180,ue,ve,Ie],Z);return We.concat(et)}const Ce=this.trees[this._limitZoom(Z)],we=Ce.range(no(re),en(Ie),no(ve),en(ue)),De=[];for(const We of we){const et=Ce.points[We];De.push(et.numPoints?Vr(et):this.points[et.index])}return De}getChildren(F){const Z=this._getOriginId(F),re=this._getOriginZoom(F),ue="No cluster with the specified id.",ve=this.trees[re];if(!ve)throw new Error(ue);const Ie=ve.points[Z];if(!Ie)throw new Error(ue);const Ce=this.options.radius/(this.options.extent*Math.pow(2,re-1)),we=ve.within(Ie.x,Ie.y,Ce),De=[];for(const We of we){const et=ve.points[We];et.parentId===F&&De.push(et.numPoints?Vr(et):this.points[et.index])}if(De.length===0)throw new Error(ue);return De}getLeaves(F,Z,re){const ue=[];return this._appendLeaves(ue,F,Z=Z||10,re=re||0,0),ue}getTile(F,Z,re){const ue=this.trees[this._limitZoom(F)],ve=Math.pow(2,F),{extent:Ie,radius:Ce}=this.options,we=Ce/Ie,De=(re-we)/ve,We=(re+1+we)/ve,et={features:[]};return this._addTileFeatures(ue.range((Z-we)/ve,De,(Z+1+we)/ve,We),ue.points,Z,re,ve,et),Z===0&&this._addTileFeatures(ue.range(1-we/ve,De,1,We),ue.points,ve,re,ve,et),Z===ve-1&&this._addTileFeatures(ue.range(0,De,we/ve,We),ue.points,-1,re,ve,et),et.features.length?et:null}getClusterExpansionZoom(F){let Z=this._getOriginZoom(F)-1;for(;Z<=this.options.maxZoom;){const re=this.getChildren(F);if(Z++,re.length!==1)break;F=re[0].properties.cluster_id}return Z}_appendLeaves(F,Z,re,ue,ve){const Ie=this.getChildren(Z);for(const Ce of Ie){const we=Ce.properties;if(we&&we.cluster?ve+we.point_count<=ue?ve+=we.point_count:ve=this._appendLeaves(F,we.cluster_id,re,ue,ve):ve<ue?ve++:F.push(Ce),F.length===re)break}return ve}_addTileFeatures(F,Z,re,ue,ve,Ie){for(const Ce of F){const we=Z[Ce],De=we.numPoints;let We,et,it;if(De)We=yo(we),et=we.x,it=we.y;else{const Lt=this.points[we.index];We=Lt.properties,et=no(Lt.geometry.coordinates[0]),it=en(Lt.geometry.coordinates[1])}const Mt={type:1,geometry:[[Math.round(this.options.extent*(et*ve-re)),Math.round(this.options.extent*(it*ve-ue))]],tags:We};let At;De?At=we.id:this.options.generateId?At=we.index:this.points[we.index].id&&(At=this.points[we.index].id),At!==void 0&&(Mt.id=At),Ie.features.push(Mt)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(+F,this.options.maxZoom+1))}_cluster(F,Z){const re=[],{radius:ue,extent:ve,reduce:Ie,minPoints:Ce}=this.options,we=ue/(ve*Math.pow(2,Z));for(let De=0;De<F.length;De++){const We=F[De];if(We.zoom<=Z)continue;We.zoom=Z;const et=this.trees[Z+1],it=et.within(We.x,We.y,we),Mt=We.numPoints||1;let At=Mt;for(const Lt of it){const Ut=et.points[Lt];Ut.zoom>Z&&(At+=Ut.numPoints||1)}if(At>Mt&&At>=Ce){let Lt=We.x*Mt,Ut=We.y*Mt,on=Ie&&Mt>1?this._map(We,!0):null;const jn=(De<<5)+(Z+1)+this.points.length;for(const Qn of it){const Sn=et.points[Qn];if(Sn.zoom<=Z)continue;Sn.zoom=Z;const Vn=Sn.numPoints||1;Lt+=Sn.x*Vn,Ut+=Sn.y*Vn,Sn.parentId=jn,Ie&&(on||(on=this._map(We,!0)),Ie(on,this._map(Sn)))}We.parentId=jn,re.push(Lr(Lt/At,Ut/At,jn,At,on))}else if(re.push(We),At>1)for(const Lt of it){const Ut=et.points[Lt];Ut.zoom<=Z||(Ut.zoom=Z,re.push(Ut))}}return re}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,Z){if(F.numPoints)return Z?$r({},F.properties):F.properties;const re=this.points[F.index].properties,ue=this.options.map(re);return Z&&ue===re?$r({},ue):ue}}function Lr(se,F,Z,re,ue){return{x:On(se),y:On(F),zoom:1/0,id:Z,parentId:-1,numPoints:re,properties:ue}}function Ai(se,F){const[Z,re]=se.geometry.coordinates;return{x:On(no(Z)),y:On(en(re)),zoom:1/0,index:F,parentId:-1}}function Vr(se){return{type:"Feature",id:se.id,properties:yo(se),geometry:{type:"Point",coordinates:[(F=se.x,360*(F-.5)),cr(se.y)]}};var F}function yo(se){const F=se.numPoints,Z=F>=1e4?`${Math.round(F/1e3)}k`:F>=1e3?Math.round(F/100)/10+"k":F;return $r($r({},se.properties),{cluster:!0,cluster_id:se.id,point_count:F,point_count_abbreviated:Z})}function no(se){return se/360+.5}function en(se){const F=Math.sin(se*Math.PI/180),Z=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return Z<0?0:Z>1?1:Z}function cr(se){const F=(180-360*se)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function $r(se,F){for(const Z in F)se[Z]=F[Z];return se}function Oo(se){return se.x}function is(se){return se.y}function vo(se,F,Z,re){for(var ue,ve=re,Ie=Z-F>>1,Ce=Z-F,we=se[F],De=se[F+1],We=se[Z],et=se[Z+1],it=F+3;it<Z;it+=3){var Mt=rn(se[it],se[it+1],we,De,We,et);if(Mt>ve)ue=it,ve=Mt;else if(Mt===ve){var At=Math.abs(it-Ie);At<Ce&&(ue=it,Ce=At)}}ve>re&&(ue-F>3&&vo(se,F,ue,re),se[ue+2]=ve,Z-ue>3&&vo(se,ue,Z,re))}function rn(se,F,Z,re,ue,ve){var Ie=ue-Z,Ce=ve-re;if(Ie!==0||Ce!==0){var we=((se-Z)*Ie+(F-re)*Ce)/(Ie*Ie+Ce*Ce);we>1?(Z=ue,re=ve):we>0&&(Z+=Ie*we,re+=Ce*we)}return(Ie=se-Z)*Ie+(Ce=F-re)*Ce}function xo(se,F,Z,re){var ue={id:se===void 0?null:se,type:F,geometry:Z,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ve){var Ie=ve.geometry,Ce=ve.type;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")Ni(ve,Ie);else if(Ce==="Polygon"||Ce==="MultiLineString")for(var we=0;we<Ie.length;we++)Ni(ve,Ie[we]);else if(Ce==="MultiPolygon")for(we=0;we<Ie.length;we++)for(var De=0;De<Ie[we].length;De++)Ni(ve,Ie[we][De])}(ue),ue}function Ni(se,F){for(var Z=0;Z<F.length;Z+=3)se.minX=Math.min(se.minX,F[Z]),se.minY=Math.min(se.minY,F[Z+1]),se.maxX=Math.max(se.maxX,F[Z]),se.maxY=Math.max(se.maxY,F[Z+1])}function os(se,F,Z,re){if(F.geometry){var ue=F.geometry.coordinates,ve=F.geometry.type,Ie=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Ce=[],we=F.id;if(Z.promoteId?we=F.properties[Z.promoteId]:Z.generateId&&(we=re||0),ve==="Point")Bo(ue,Ce);else if(ve==="MultiPoint")for(var De=0;De<ue.length;De++)Bo(ue[De],Ce);else if(ve==="LineString")qn(ue,Ce,Ie,!1);else if(ve==="MultiLineString"){if(Z.lineMetrics){for(De=0;De<ue.length;De++)qn(ue[De],Ce=[],Ie,!1),se.push(xo(we,"LineString",Ce,F.properties));return}Fo(ue,Ce,Ie,!1)}else if(ve==="Polygon")Fo(ue,Ce,Ie,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(De=0;De<F.geometry.geometries.length;De++)os(se,{id:we,geometry:F.geometry.geometries[De],properties:F.properties},Z,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(De=0;De<ue.length;De++){var We=[];Fo(ue[De],We,Ie,!0),Ce.push(We)}}se.push(xo(we,ve,Ce,F.properties))}}function Bo(se,F){F.push(ss(se[0])),F.push(as(se[1])),F.push(0)}function qn(se,F,Z,re){for(var ue,ve,Ie=0,Ce=0;Ce<se.length;Ce++){var we=ss(se[Ce][0]),De=as(se[Ce][1]);F.push(we),F.push(De),F.push(0),Ce>0&&(Ie+=re?(ue*De-we*ve)/2:Math.sqrt(Math.pow(we-ue,2)+Math.pow(De-ve,2))),ue=we,ve=De}var We=F.length-3;F[2]=1,vo(F,0,We,Z),F[We+2]=1,F.size=Math.abs(Ie),F.start=0,F.end=F.size}function Fo(se,F,Z,re){for(var ue=0;ue<se.length;ue++){var ve=[];qn(se[ue],ve,Z,re),F.push(ve)}}function ss(se){return se/360+.5}function as(se){var F=Math.sin(se*Math.PI/180),Z=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return Z<0?0:Z>1?1:Z}function oi(se,F,Z,re,ue,ve,Ie,Ce){if(re/=F,ve>=(Z/=F)&&Ie<re)return se;if(Ie<Z||ve>=re)return null;for(var we=[],De=0;De<se.length;De++){var We=se[De],et=We.geometry,it=We.type,Mt=ue===0?We.minX:We.minY,At=ue===0?We.maxX:We.maxY;if(Mt>=Z&&At<re)we.push(We);else if(!(At<Z||Mt>=re)){var Lt=[];if(it==="Point"||it==="MultiPoint")bo(et,Lt,Z,re,ue);else if(it==="LineString")wo(et,Lt,Z,re,ue,!1,Ce.lineMetrics);else if(it==="MultiLineString")Ui(et,Lt,Z,re,ue,!1);else if(it==="Polygon")Ui(et,Lt,Z,re,ue,!0);else if(it==="MultiPolygon")for(var Ut=0;Ut<et.length;Ut++){var on=[];Ui(et[Ut],on,Z,re,ue,!0),on.length&&Lt.push(on)}if(Lt.length){if(Ce.lineMetrics&&it==="LineString"){for(Ut=0;Ut<Lt.length;Ut++)we.push(xo(We.id,it,Lt[Ut],We.tags));continue}it!=="LineString"&&it!=="MultiLineString"||(Lt.length===1?(it="LineString",Lt=Lt[0]):it="MultiLineString"),it!=="Point"&&it!=="MultiPoint"||(it=Lt.length===3?"Point":"MultiPoint"),we.push(xo(We.id,it,Lt,We.tags))}}}return we.length?we:null}function bo(se,F,Z,re,ue){for(var ve=0;ve<se.length;ve+=3){var Ie=se[ve+ue];Ie>=Z&&Ie<=re&&(F.push(se[ve]),F.push(se[ve+1]),F.push(se[ve+2]))}}function wo(se,F,Z,re,ue,ve,Ie){for(var Ce,we,De=No(se),We=ue===0?Zr:Uo,et=se.start,it=0;it<se.length-3;it+=3){var Mt=se[it],At=se[it+1],Lt=se[it+2],Ut=se[it+3],on=se[it+4],jn=ue===0?Mt:At,Qn=ue===0?Ut:on,Sn=!1;Ie&&(Ce=Math.sqrt(Math.pow(Mt-Ut,2)+Math.pow(At-on,2))),jn<Z?Qn>Z&&(we=We(De,Mt,At,Ut,on,Z),Ie&&(De.start=et+Ce*we)):jn>re?Qn<re&&(we=We(De,Mt,At,Ut,on,re),Ie&&(De.start=et+Ce*we)):ls(De,Mt,At,Lt),Qn<Z&&jn>=Z&&(we=We(De,Mt,At,Ut,on,Z),Sn=!0),Qn>re&&jn<=re&&(we=We(De,Mt,At,Ut,on,re),Sn=!0),!ve&&Sn&&(Ie&&(De.end=et+Ce*we),F.push(De),De=No(se)),Ie&&(et+=Ce)}var Vn=se.length-3;Mt=se[Vn],At=se[Vn+1],Lt=se[Vn+2],(jn=ue===0?Mt:At)>=Z&&jn<=re&&ls(De,Mt,At,Lt),Vn=De.length-3,ve&&Vn>=3&&(De[Vn]!==De[0]||De[Vn+1]!==De[1])&&ls(De,De[0],De[1],De[2]),De.length&&F.push(De)}function No(se){var F=[];return F.size=se.size,F.start=se.start,F.end=se.end,F}function Ui(se,F,Z,re,ue,ve){for(var Ie=0;Ie<se.length;Ie++)wo(se[Ie],F,Z,re,ue,ve,!1)}function ls(se,F,Z,re){se.push(F),se.push(Z),se.push(re)}function Zr(se,F,Z,re,ue,ve){var Ie=(ve-F)/(re-F);return se.push(ve),se.push(Z+(ue-Z)*Ie),se.push(1),Ie}function Uo(se,F,Z,re,ue,ve){var Ie=(ve-Z)/(ue-Z);return se.push(F+(re-F)*Ie),se.push(ve),se.push(1),Ie}function Kn(se,F){for(var Z=[],re=0;re<se.length;re++){var ue,ve=se[re],Ie=ve.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")ue=yi(ve.geometry,F);else if(Ie==="MultiLineString"||Ie==="Polygon"){ue=[];for(var Ce=0;Ce<ve.geometry.length;Ce++)ue.push(yi(ve.geometry[Ce],F))}else if(Ie==="MultiPolygon")for(ue=[],Ce=0;Ce<ve.geometry.length;Ce++){for(var we=[],De=0;De<ve.geometry[Ce].length;De++)we.push(yi(ve.geometry[Ce][De],F));ue.push(we)}Z.push(xo(ve.id,Ie,ue,ve.tags))}return Z}function yi(se,F){var Z=[];Z.size=se.size,se.start!==void 0&&(Z.start=se.start,Z.end=se.end);for(var re=0;re<se.length;re+=3)Z.push(se[re]+F,se[re+1],se[re+2]);return Z}function us(se,F){if(se.transformed)return se;var Z,re,ue,ve=1<<se.z,Ie=se.x,Ce=se.y;for(Z=0;Z<se.features.length;Z++){var we=se.features[Z],De=we.geometry,We=we.type;if(we.geometry=[],We===1)for(re=0;re<De.length;re+=2)we.geometry.push(ji(De[re],De[re+1],F,ve,Ie,Ce));else for(re=0;re<De.length;re++){var et=[];for(ue=0;ue<De[re].length;ue+=2)et.push(ji(De[re][ue],De[re][ue+1],F,ve,Ie,Ce));we.geometry.push(et)}}return se.transformed=!0,se}function ji(se,F,Z,re,ue,ve){return[Math.round(Z*(se*re-ue)),Math.round(Z*(F*re-ve))]}function Eo(se,F,Z,re,ue){for(var ve=F===ue.maxZoom?0:ue.tolerance/((1<<F)*ue.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:re,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ce=0;Ce<se.length;Ce++){Ie.numFeatures++,Vi(Ie,se[Ce],ve,ue);var we=se[Ce].minX,De=se[Ce].minY,We=se[Ce].maxX,et=se[Ce].maxY;we<Ie.minX&&(Ie.minX=we),De<Ie.minY&&(Ie.minY=De),We>Ie.maxX&&(Ie.maxX=We),et>Ie.maxY&&(Ie.maxY=et)}return Ie}function Vi(se,F,Z,re){var ue=F.geometry,ve=F.type,Ie=[];if(ve==="Point"||ve==="MultiPoint")for(var Ce=0;Ce<ue.length;Ce+=3)Ie.push(ue[Ce]),Ie.push(ue[Ce+1]),se.numPoints++,se.numSimplified++;else if(ve==="LineString")$i(Ie,ue,se,Z,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(Ce=0;Ce<ue.length;Ce++)$i(Ie,ue[Ce],se,Z,ve==="Polygon",Ce===0);else if(ve==="MultiPolygon")for(var we=0;we<ue.length;we++){var De=ue[we];for(Ce=0;Ce<De.length;Ce++)$i(Ie,De[Ce],se,Z,!0,Ce===0)}if(Ie.length){var We=F.tags||null;if(ve==="LineString"&&re.lineMetrics){for(var et in We={},F.tags)We[et]=F.tags[et];We.mapbox_clip_start=ue.start/ue.size,We.mapbox_clip_end=ue.end/ue.size}var it={geometry:Ie,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:We};F.id!==null&&(it.id=F.id),se.features.push(it)}}function $i(se,F,Z,re,ue,ve){var Ie=re*re;if(re>0&&F.size<(ue?Ie:re))Z.numPoints+=F.length/3;else{for(var Ce=[],we=0;we<F.length;we+=3)(re===0||F[we+2]>Ie)&&(Z.numSimplified++,Ce.push(F[we]),Ce.push(F[we+1])),Z.numPoints++;ue&&function(De,We){for(var et=0,it=0,Mt=De.length,At=Mt-2;it<Mt;At=it,it+=2)et+=(De[it]-De[At])*(De[it+1]+De[At+1]);if(et>0===We)for(it=0,Mt=De.length;it<Mt/2;it+=2){var Lt=De[it],Ut=De[it+1];De[it]=De[Mt-2-it],De[it+1]=De[Mt-1-it],De[Mt-2-it]=Lt,De[Mt-1-it]=Ut}}(Ce,ve),se.push(Ce)}}function vi(se,F){var Z=(F=this.options=function(ue,ve){for(var Ie in ve)ue[Ie]=ve[Ie];return ue}(Object.create(this.options),F)).debug;if(Z&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var re=function(ue,ve){var Ie=[];if(ue.type==="FeatureCollection")for(var Ce=0;Ce<ue.features.length;Ce++)os(Ie,ue.features[Ce],ve,Ce);else os(Ie,ue.type==="Feature"?ue:{geometry:ue},ve);return Ie}(se,F);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(re=function(ue,ve){var Ie=ve.buffer/ve.extent,Ce=ue,we=oi(ue,1,-1-Ie,Ie,0,-1,2,ve),De=oi(ue,1,1-Ie,2+Ie,0,-1,2,ve);return(we||De)&&(Ce=oi(ue,1,-Ie,1+Ie,0,-1,2,ve)||[],we&&(Ce=Kn(we,1).concat(Ce)),De&&(Ce=Ce.concat(Kn(De,-1)))),Ce}(re,F)).length&&this.splitTile(re,0,0,0),Z&&(re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function xi(se,F,Z){return 32*((1<<se)*Z+F)+se}function Rr(se,F){const Z=se.tileID.canonical;if(!this._geoJSONIndex)return F(null,null);const re=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!re)return F(null,null);const ue=new Ve(re.features);let ve=It(ue);ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),F(null,{vectorTile:ue,rawData:ve.buffer})}vi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vi.prototype.splitTile=function(se,F,Z,re,ue,ve,Ie){for(var Ce=[se,F,Z,re],we=this.options,De=we.debug;Ce.length;){re=Ce.pop(),Z=Ce.pop(),F=Ce.pop(),se=Ce.pop();var We=1<<F,et=xi(F,Z,re),it=this.tiles[et];if(!it&&(De>1&&console.time("creation"),it=this.tiles[et]=Eo(se,F,Z,re,we),this.tileCoords.push({z:F,x:Z,y:re}),De)){De>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,Z,re,it.numFeatures,it.numPoints,it.numSimplified),console.timeEnd("creation"));var Mt="z"+F;this.stats[Mt]=(this.stats[Mt]||0)+1,this.total++}if(it.source=se,ue){if(F===we.maxZoom||F===ue)continue;var At=1<<ue-F;if(Z!==Math.floor(ve/At)||re!==Math.floor(Ie/At))continue}else if(F===we.indexMaxZoom||it.numPoints<=we.indexMaxPoints)continue;if(it.source=null,se.length!==0){De>1&&console.time("clipping");var Lt,Ut,on,jn,Qn,Sn,Vn=.5*we.buffer/we.extent,br=.5-Vn,ai=.5+Vn,rr=1+Vn;Lt=Ut=on=jn=null,Qn=oi(se,We,Z-Vn,Z+ai,0,it.minX,it.maxX,we),Sn=oi(se,We,Z+br,Z+rr,0,it.minX,it.maxX,we),se=null,Qn&&(Lt=oi(Qn,We,re-Vn,re+ai,1,it.minY,it.maxY,we),Ut=oi(Qn,We,re+br,re+rr,1,it.minY,it.maxY,we),Qn=null),Sn&&(on=oi(Sn,We,re-Vn,re+ai,1,it.minY,it.maxY,we),jn=oi(Sn,We,re+br,re+rr,1,it.minY,it.maxY,we),Sn=null),De>1&&console.timeEnd("clipping"),Ce.push(Lt||[],F+1,2*Z,2*re),Ce.push(Ut||[],F+1,2*Z,2*re+1),Ce.push(on||[],F+1,2*Z+1,2*re),Ce.push(jn||[],F+1,2*Z+1,2*re+1)}}},vi.prototype.getTile=function(se,F,Z){var re=this.options,ue=re.extent,ve=re.debug;if(se<0||se>24)return null;var Ie=1<<se,Ce=xi(se,F=(F%Ie+Ie)%Ie,Z);if(this.tiles[Ce])return us(this.tiles[Ce],ue);ve>1&&console.log("drilling down to z%d-%d-%d",se,F,Z);for(var we,De=se,We=F,et=Z;!we&&De>0;)De--,We=Math.floor(We/2),et=Math.floor(et/2),we=this.tiles[xi(De,We,et)];return we&&we.source?(ve>1&&console.log("found parent tile z%d-%d-%d",De,We,et),ve>1&&console.time("drilling down"),this.splitTile(we.source,De,We,et,se,F,Z),ve>1&&console.timeEnd("drilling down"),this.tiles[Ce]?us(this.tiles[Ce],ue):null):null};class cs extends o.VectorTileWorkerSource{constructor(F,Z,re,ue,ve){super(F,Z,re,ue,Rr),ve&&(this.loadGeoJSON=ve)}loadData(F,Z){const re=F&&F.request,ue=re&&re.collectResourceTiming;this.loadGeoJSON(F,(ve,Ie)=>{if(ve||!Ie)return Z(ve);if(typeof Ie!="object")return Z(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));{H(Ie,!0);try{if(F.filter){const we=o.createExpression(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(we.result==="error")throw new Error(we.value.map(We=>`${We.key}: ${We.message}`).join(", "));Ie={type:"FeatureCollection",features:Ie.features.filter(We=>we.value.evaluate({zoom:0},We))}}this._geoJSONIndex=F.cluster?new Pn(function({superclusterOptions:we,clusterProperties:De}){if(!De||!we)return we;const We={},et={},it={accumulated:null,zoom:0},Mt={properties:null},At=Object.keys(De);for(const Lt of At){const[Ut,on]=De[Lt],jn=o.createExpression(on),Qn=o.createExpression(typeof Ut=="string"?[Ut,["accumulated"],["get",Lt]]:Ut);We[Lt]=jn.value,et[Lt]=Qn.value}return we.map=Lt=>{Mt.properties=Lt;const Ut={};for(const on of At)Ut[on]=We[on].evaluate(it,Mt);return Ut},we.reduce=(Lt,Ut)=>{Mt.properties=Ut;for(const on of At)it.accumulated=Lt[on],Lt[on]=et[on].evaluate(it,Mt)},we}(F)).load(Ie.features):function(we,De){return new vi(we,De)}(Ie,F.geojsonVtOptions)}catch(we){return Z(we)}this.loaded={};const Ce={};if(ue){const we=o.getPerformanceMeasurement(re);we&&(Ce.resourceTiming={},Ce.resourceTiming[F.source]=JSON.parse(JSON.stringify(we)))}Z(null,Ce)}})}reloadTile(F,Z){const re=this.loaded;return re&&re[F.uid]?super.reloadTile(F,Z):this.loadTile(F,Z)}loadGeoJSON(F,Z){if(F.request)o.getJSON(F.request,Z);else{if(typeof F.data!="string")return Z(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(F.data))}catch{return Z(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(F,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(F.clusterId))}catch(re){Z(re)}}getClusterChildren(F,Z){try{Z(null,this._geoJSONIndex.getChildren(F.clusterId))}catch(re){Z(re)}}getClusterLeaves(F,Z){try{Z(null,this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset))}catch(re){Z(re)}}}class si{constructor(F){this.self=F,this.actor=new o.Actor(F,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:cs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,re)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=re},this.self.registerRTLTextPlugin=Z=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=Z.applyArabicShaping,o.plugin.processBidirectionalText=Z.processBidirectionalText,o.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(F,Z,re){delete this.layerIndexes[F],delete this.availableImages[F],delete this.workerSources[F],delete this.demWorkerSources[F],re()}checkIfReady(F,Z,re){re()}setReferrer(F,Z){this.referrer=Z}spriteLoaded(F,Z){this.isSpriteLoaded[F]=Z;for(const re in this.workerSources[F]){const ue=this.workerSources[F][re];for(const ve in ue)ue[ve]instanceof o.VectorTileWorkerSource&&(ue[ve].isSpriteLoaded=Z,ue[ve].fire(new o.Event("isSpriteLoaded")))}}setImages(F,Z,re){this.availableImages[F]=Z;for(const ue in this.workerSources[F]){const ve=this.workerSources[F][ue];for(const Ie in ve)ve[Ie].availableImages=Z}re()}enableTerrain(F,Z,re){this.terrain=Z,re()}setProjection(F,Z){this.projections[F]=o.getProjection(Z)}setLayers(F,Z,re){this.getLayerIndex(F).replace(Z),re()}updateLayers(F,Z,re){this.getLayerIndex(F).update(Z.layers,Z.removedIds),re()}loadTile(F,Z,re){const ue=this.enableTerrain?o.extend({enableTerrain:this.terrain},Z):Z;ue.projection=this.projections[F]||this.defaultProjection,this.getWorkerSource(F,Z.type,Z.source).loadTile(ue,re)}loadDEMTile(F,Z,re){const ue=this.enableTerrain?o.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(F,Z.source).loadTile(ue,re)}reloadTile(F,Z,re){const ue=this.enableTerrain?o.extend({enableTerrain:this.terrain},Z):Z;ue.projection=this.projections[F]||this.defaultProjection,this.getWorkerSource(F,Z.type,Z.source).reloadTile(ue,re)}abortTile(F,Z,re){this.getWorkerSource(F,Z.type,Z.source).abortTile(Z,re)}removeTile(F,Z,re){this.getWorkerSource(F,Z.type,Z.source).removeTile(Z,re)}removeSource(F,Z,re){if(!this.workerSources[F]||!this.workerSources[F][Z.type]||!this.workerSources[F][Z.type][Z.source])return;const ue=this.workerSources[F][Z.type][Z.source];delete this.workerSources[F][Z.type][Z.source],ue.removeSource!==void 0?ue.removeSource(Z,re):re()}loadWorkerSource(F,Z,re){try{this.self.importScripts(Z.url),re()}catch(ue){re(ue.toString())}}syncRTLPluginState(F,Z,re){try{o.plugin.setState(Z);const ue=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ue!=null){this.self.importScripts(ue);const ve=o.plugin.isParsed();re(ve?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ue}`),ve)}}catch(ue){re(ue.toString())}}getAvailableImages(F){let Z=this.availableImages[F];return Z||(Z=[]),Z}getLayerIndex(F){let Z=this.layerIndexes[F];return Z||(Z=this.layerIndexes[F]=new oe),Z}getWorkerSource(F,Z,re){return this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][Z]||(this.workerSources[F][Z]={}),this.workerSources[F][Z][re]||(this.workerSources[F][Z][re]=new this.workerSourceTypes[Z]({send:(ue,ve,Ie,Ce,we,De)=>{this.actor.send(ue,ve,Ie,F,we,De)},scheduler:this.actor.scheduler},this.getLayerIndex(F),this.getAvailableImages(F),this.isSpriteLoaded[F])),this.workerSources[F][Z][re]}getDEMWorkerSource(F,Z){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][Z]||(this.demWorkerSources[F][Z]=new de),this.demWorkerSources[F][Z]}enforceCacheSizeLimit(F,Z){o.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(F,Z,re){re(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new si(self)),si}),k(["./shared"],function(o){var G=ne;function ne(p){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,v,b=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(b);try{v=new Worker(T),m=!0}catch{m=!1}return v&&v.terminate(),URL.revokeObjectURL(T),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var v=m.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===m.width}()?(oe[l=n&&n.failIfMajorPerformanceCaveat]===void 0&&(oe[l]=function(m){var v,b=function(T){var P=document.createElement("canvas"),D=Object.create(ne.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=T,P.getContext("webgl",D)||P.getContext("experimental-webgl",D)}(m);if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),b.getShaderParameter(v,b.COMPILE_STATUS)===!0)}(l)),oe[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(p)}var oe={};function $(p,n){var l=n[0],m=n[1],v=n[2],b=n[3],T=l*b-v*m;return T?(p[0]=b*(T=1/T),p[1]=-m*T,p[2]=-v*T,p[3]=l*T,p):null}function de(p,n){if(Array.isArray(p)){if(!Array.isArray(n)||p.length!==n.length)return!1;for(let l=0;l<p.length;l++)if(!de(p[l],n[l]))return!1;return!0}if(typeof p=="object"&&p!==null&&n!==null){if(typeof n!="object"||Object.keys(p).length!==Object.keys(n).length)return!1;for(const l in p)if(!de(p[l],n[l]))return!1;return!0}return p===n}ne.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const H={create:function(p,n,l){const m=o.window.document.createElement(p);return n!==void 0&&(m.className=n),l&&l.appendChild(m),m},createSVG:function(p,n,l){const m=o.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const v of Object.keys(n))m.setAttributeNS(null,v,n[v]);return l&&l.appendChild(m),m}},Te=o.window.document&&o.window.document.documentElement.style,Me=Te&&Te.userSelect!==void 0?"userSelect":"WebkitUserSelect";let je;H.disableDrag=function(){Te&&Me&&(je=Te[Me],Te[Me]="none")},H.enableDrag=function(){Te&&Me&&(Te[Me]=je)};const He=function(p){p.preventDefault(),p.stopPropagation(),o.window.removeEventListener("click",He,!0)};function Ve(p,n,l){const m=p.offsetWidth===n.width?1:p.offsetWidth/n.width;return new o.pointGeometry((l.clientX-n.left)*m,(l.clientY-n.top)*m)}function Xe(p){const{userImage:n}=p;return!!(n&&n.render&&n.render())&&(p.data.replace(new Uint8Array(n.data.buffer)),!0)}H.suppressClick=function(){o.window.addEventListener("click",He,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",He,!0)},0)},H.mousePos=function(p,n){const l=p.getBoundingClientRect();return Ve(p,l,n)},H.touchPos=function(p,n){const l=p.getBoundingClientRect(),m=[];for(let v=0;v<n.length;v++)m.push(Ve(p,l,n[v]));return m},H.mouseButton=function(p){return o.window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button};class $e extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:l,callback:m}of this.requestors)this._notify(l,m);this.requestors=[]}}getImage(n){return this.images[n]}addImage(n,l){this._validate(n,l)&&(this.images[n]=l)}_validate(n,l){let m=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),m=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),m=!1),this._validateContent(l.content,l)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),m=!1),m}_validateStretch(n,l){if(!n)return!0;let m=0;for(const v of n){if(v[0]<m||v[1]<v[0]||l<v[1])return!1;m=v[1]}return!0}_validateContent(n,l){return!(n&&(n.length!==4||n[0]<0||l.data.width<n[0]||n[1]<0||l.data.height<n[1]||n[2]<0||l.data.width<n[2]||n[3]<0||l.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,l){l.version=this.images[n].version+1,this.images[n]=l,this.updatedImages[n]=!0}removeImage(n){const l=this.images[n];delete this.images[n],delete this.patterns[n],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,l){let m=!0;if(!this.isLoaded())for(const v of n)this.images[v]||(m=!1);this.isLoaded()||m?this._notify(n,l):this.requestors.push({ids:n,callback:l})}_notify(n,l){const m={};for(const v of n){this.images[v]||this.fire(new o.Event("styleimagemissing",{id:v}));const b=this.images[v];b?m[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:o.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,m)}getPixelSize(){const{width:n,height:l}=this.atlasImage;return{width:n,height:l}}getPattern(n){const l=this.patterns[n],m=this.getImage(n);if(!m)return null;if(l&&l.position.version===m.version)return l.position;if(l)l.position.version=m.version;else{const v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new o.ImagePosition(v,m);this.patterns[n]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const l=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(n,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const b in this.patterns)n.push(this.patterns[b].bin);const{w:l,h:m}=o.potpack(n),v=this.atlasImage;v.resize({width:l||1,height:m||1});for(const b in this.patterns){const{bin:T}=this.patterns[b],P=T.x+1,D=T.y+1,O=this.images[b].data,B=O.width,U=O.height;o.RGBAImage.copy(O,v,{x:0,y:0},{x:P,y:D},{width:B,height:U}),o.RGBAImage.copy(O,v,{x:0,y:U-1},{x:P,y:D-1},{width:B,height:1}),o.RGBAImage.copy(O,v,{x:0,y:0},{x:P,y:D+U},{width:B,height:1}),o.RGBAImage.copy(O,v,{x:B-1,y:0},{x:P-1,y:D},{width:1,height:U}),o.RGBAImage.copy(O,v,{x:0,y:0},{x:P+B,y:D},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const l of n){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const m=this.images[l];Xe(m)&&this.updateImage(l,m)}}}const Ze=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(p,n){return function([l,m,v]){const b=o.degToRad(m+90),T=o.degToRad(v);return{x:l*Math.cos(b)*Math.sin(T),y:l*Math.sin(b)*Math.sin(T),z:l*Math.cos(T),azimuthal:m,polar:v}}(p.expression.evaluate(n))}interpolate(p,n,l){return{x:o.number(p.x,n.x,l),y:o.number(p.y,n.y,l),z:o.number(p.z,n.z,l),azimuthal:o.number(p.azimuthal,n.azimuthal,l),polar:o.number(p.polar,n.polar,l)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),xt="-transition";class It extends o.Evented{constructor(n){super(),this._transitionable=new o.Transitionable(Ze),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l={}){if(!this._validate(o.validateLight,n,l))for(const m in n){const v=n[m];o.endsWith(m,xt)?this._transitionable.setTransition(m.slice(0,-xt.length),v):this._transitionable.setValue(m,v)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,m){return(!m||m.validate!==!1)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Pt=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),Ot="-transition";class Yt extends o.Evented{constructor(n,l){super(),this._transitionable=new o.Transitionable(Pt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(n){for(const l in n){const m=n[l];o.endsWith(l,Ot)?this._transitionable.setTransition(l.slice(0,-Ot.length),m):this._transitionable.setValue(l,m)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function Nt(p,n,l,m){const v=o.smoothstep(45,65,l),[b,T]=$t(p,m),P=o.length(n);let D=1-Math.min(1,Math.exp((P-b)/(T-b)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*v*p.alpha}function $t(p,n){const l=.5/Math.tan(.5*n);return[p.range[0]+l,p.range[1]+l]}const Et=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"])}),yn="-transition";class Dr extends o.Evented{constructor(n,l){super(),this._transitionable=new o.Transitionable(Et),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,l={}){if(!this._validate(o.validateFog,n,l))for(const m in n){const v=n[m];o.endsWith(m,yn)?this._transitionable.setTransition(m.slice(0,-yn.length),v):this._transitionable.setValue(m,v)}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return o.smoothstep(45,65,n)*l.a}getOpacityAtLatLng(n,l){return this._transform.projection.supportsFog?function(m,v,b){const T=o.MercatorCoordinate.fromLngLat(v),P=b.elevation?b.elevation.getAtPointOrZero(T):0,D=[T.x,T.y,P];return o.transformMat4(D,D,b.mercatorFogMatrix),Nt(m,D,b.pitch,b._fov)}(this.state,n,l):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?$t(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,m){return(!m||m.validate!==!1)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Fe{constructor(n,l){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const m=this.workerPool.acquire(this.id);for(let v=0;v<m.length;v++){const b=new Fe.Actor(m[v],l,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,l,m){o.asyncAll(this.actors,(v,b)=>{v.send(n,l,b)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function gt(p,n,l){return n*(o.EXTENT/(p.tileSize*Math.pow(2,l-p.tileID.overscaledZ)))}Fe.Actor=o.Actor;class Qt{constructor(n,l,m){this.context=n;const v=n.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ut{constructor(n,l,m,v){this.length=l.length,this.attributes=m,this.itemSize=l.bytesPerElement,this.dynamicDraw=v,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),n.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let m=0;m<this.attributes.length;m++){const v=l.attributes[this.attributes[m].name];v!==void 0&&n.enableVertexAttribArray(v)}}setVertexAttribPointers(n,l,m){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],T=l.attributes[b.name];T!==void 0&&n.vertexAttribPointer(T,b.components,n[vn[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class st{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wt extends st{getDefault(){return o.Color.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Wt extends st{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Jt extends st{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class nr extends st{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class On extends st{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class ar extends st{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Pn extends st{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Lr extends st{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Ai extends st{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class Vr extends st{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class yo extends st{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class no extends st{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class en extends st{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class cr extends st{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class $r extends st{getDefault(){return o.Color.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Oo extends st{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class is extends st{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class vo extends st{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class rn extends st{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class xo extends st{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class Ni extends st{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class os extends st{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Bo extends st{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class qn extends st{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Fo extends st{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class ss extends st{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class as extends st{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class oi extends st{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class bo extends st{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class wo extends st{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class No extends st{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Ui extends st{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class ls extends Ui{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Zr extends Ui{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Uo extends Zr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Kn{constructor(n,l,m,v){this.context=n,this.width=l,this.height=m;const b=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new ls(n,b),v&&(this.depthAttachment=new Zr(n,b))}destroy(){const n=this.context.gl,l=this.colorAttachment.get();if(l&&n.deleteTexture(l),this.depthAttachment){const m=this.depthAttachment.get();m&&n.deleteRenderbuffer(m)}n.deleteFramebuffer(this.framebuffer)}}class yi{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new wt(this),this.clearDepth=new Wt(this),this.clearStencil=new Jt(this),this.colorMask=new nr(this),this.depthMask=new On(this),this.stencilMask=new ar(this),this.stencilFunc=new Pn(this),this.stencilOp=new Lr(this),this.stencilTest=new Ai(this),this.depthRange=new Vr(this),this.depthTest=new yo(this),this.depthFunc=new no(this),this.blend=new en(this),this.blendFunc=new cr(this),this.blendColor=new $r(this),this.blendEquation=new Oo(this),this.cullFace=new is(this),this.cullFaceSide=new vo(this),this.frontFace=new rn(this),this.program=new xo(this),this.activeTexture=new Ni(this),this.viewport=new os(this),this.bindFramebuffer=new Bo(this),this.bindRenderbuffer=new qn(this),this.bindTexture=new Fo(this),this.bindVertexBuffer=new ss(this),this.bindElementBuffer=new as(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new oi(this),this.pixelStoreUnpack=new bo(this),this.pixelStoreUnpackPremultiplyAlpha=new wo(this),this.pixelStoreUnpackFlipY=new No(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l){return new Qt(this,n,l)}createVertexBuffer(n,l,m){return new ut(this,n,l,m)}createRenderbuffer(n,l,m){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,n,l,m),this.bindRenderbuffer.set(null),b}createFramebuffer(n,l,m){return new Kn(this,n,l,m)}clear({color:n,depth:l,stencil:m}){const v=this.gl;let b=0;n&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),m!==void 0&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),v.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){de(n.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class us{constructor(n,l,m,v){this.screenBounds=n,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(b=>v.pointCoordinate3D(b)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(n,l){let m,v;if(n instanceof o.pointGeometry||typeof n[0]=="number"){const b=o.pointGeometry.convert(n);m=[o.pointGeometry.convert(n)],v=l.isPointAboveHorizon(b)}else{const b=o.pointGeometry.convert(n[0]),T=o.pointGeometry.convert(n[1]);m=[b,T],v=o.polygonizeBounds(b,T).every(P=>l.isPointAboveHorizon(P))}return new us(m,l.getCameraPoint(),v,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const l=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],v=o.polygonizeBounds(l,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(v[3]=this.cameraPoint)),o.bufferConvexPolygon(v,n)}containsTile(n,l,m){const v=n.queryPadding+1,b=n.tileID.wrap,T=m?this._bufferedCameraMercator(v,l).map(K=>o.getTilePoint(n.tileTransform,K,b)):this._bufferedScreenMercator(v,l).map(K=>o.getTilePoint(n.tileTransform,K,b)),P=this.screenGeometryMercator.map(K=>o.getTileVec3(n.tileTransform,K,b)),D=P.map(K=>new o.pointGeometry(K[0],K[1])),O=l.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),B=o.getTileVec3(n.tileTransform,O,b),U=P.map(K=>{const te=o.sub(K,K,B);return o.normalize(te,te),new o.Ray(B,te)}),q=gt(n,1,l.zoom);if(o.polygonIntersectsBox(T,0,0,o.EXTENT,o.EXTENT))return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:U,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(Q=o.getBounds(T),Q.min.x=o.clamp(Q.min.x,0,o.EXTENT),Q.min.y=o.clamp(Q.min.y,0,o.EXTENT),Q.max.x=o.clamp(Q.max.x,0,o.EXTENT),Q.max.y=o.clamp(Q.max.y,0,o.EXTENT),Q),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:q};var Q}_bufferedScreenMercator(n,l){const m=ji(n);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{const v=this.bufferedScreenGeometry(n).map(b=>l.pointCoordinate3D(b));return this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(n,l){const m=ji(n);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{const v=this.bufferedCameraGeometry(n).map(b=>l.pointCoordinate3D(b));return this._cameraRaycastCache[m]=v,v}}}function ji(p){return 100*p|0}function Eo(p,n,l){const m=function(v,b){if(v)return l(v);if(b){const T=o.pick(o.extend(b,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(T.vectorLayers=b.vector_layers,T.vectorLayerIds=T.vectorLayers.map(P=>P.id)),T.tiles=n.canonicalizeTileset(T,p.url),l(null,T)}};return p.url?o.getJSON(n.transformRequest(n.normalizeSourceURL(p.url),o.ResourceType.Source),m):o.exported.frame(()=>m(null,p))}class Vi{constructor(n,l,m){this.bounds=o.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=l||0,this.maxzoom=m||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const l=Math.pow(2,n.z),m=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*l),v=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*l),b=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*l),T=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*l);return n.x>=m&&n.x<b&&n.y>=v&&n.y<T}}class $i extends o.Evented{constructor(n,l,m,v){super(),this.id=n,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},l),o.extend(this,o.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Eo(this._options,this.map._requestManager,(n,l)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new o.ErrorEvent(n)):l&&(o.extend(this,l),l.bounds&&(this.tileBounds=new Vi(l.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(l.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,l){const m=o.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);n.request=o.getImage(this.map._requestManager.transformRequest(v,o.ResourceType.Tile),(b,T,P,D)=>{if(delete n.request,n.aborted)n.state="unloaded",l(null);else if(b)n.state="errored",l(b);else if(T){this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:P,expires:D});const O=this.map.painter.context,B=O.gl;n.texture=this.map.painter.getTileTexture(T.width),n.texture?n.texture.update(T,{useMipmap:!0}):(n.texture=new o.Texture(O,T,B.RGBA,{useMipmap:!0}),n.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE),O.extTextureFilterAnisotropic&&B.texParameterf(B.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax)),n.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),l(null)}})}abortTile(n,l){n.request&&(n.request.cancel(),delete n.request),l()}unloadTile(n,l){n.texture&&this.map.painter.saveTileTexture(n.texture),l()}hasTransition(){return!1}}let vi;function xi(p,n,l,m,v,b,T,P){const D=[p,l,v,n,m,b,1,1,1],O=[T,P,1],B=o.adjoint([],D),[U,q,Q]=o.transformMat3(O,O,o.transpose(B,B));return o.multiply(D,[U,0,0,0,q,0,0,0,Q],D)}class Rr extends o.Evented{constructor(n,l,m,v){super(),this.id=n,this.dispatcher=m,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=l}load(n,l){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(m,v)=>{this._loaded=!0,m?this.fire(new o.ErrorEvent(m)):v&&(this.image=o.exported.getImageData(v),this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),l&&l(),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}setCoordinates(n){this.coordinates=n,delete this._boundsArray;const l=n.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let v=1/0,b=1/0,T=-1/0,P=-1/0;for(const U of m)v=Math.min(v,U.x),b=Math.min(b,U.y),T=Math.max(T,U.x),P=Math.max(P,U.y);const D=Math.max(T-v,P-b),O=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),B=Math.pow(2,O);return new o.CanonicalTileID(O,Math.floor((v+T)/2*B),Math.floor((b+P)/2*B))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const n=o.tileTransform(this.tileID,this.map.transform.projection),[l,m,v,b]=this.coordinates.map(T=>{const P=n.projection.project(T[0],T[1]);return o.getTilePoint(n,P)._round()});return this.perspectiveTransform=function(T,P,D,O,B,U,q,Q,K,te){const _e=xi(0,0,T,0,0,P,T,P),J=xi(D,O,B,U,q,Q,K,te);return o.multiply(J,o.adjoint(_e,_e),J),[J[6]/J[8]*T/o.EXTENT,J[7]/J[8]*P/o.EXTENT]}(this.width,this.height,l.x,l.y,m.x,m.y,b.x,b.y,v.x,v.y),this._boundsArray=new o.StructArrayLayout4i8,this._boundsArray.emplaceBack(l.x,l.y,0,0),this._boundsArray.emplaceBack(m.x,m.y,o.EXTENT,0),this._boundsArray.emplaceBack(b.x,b.y,0,o.EXTENT),this._boundsArray.emplaceBack(v.x,v.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,l=n.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new o.Texture(n,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture)}}loadTile(n,l){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},l(null)):(n.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const cs={vector:class extends o.Evented{constructor(p,n,l,m){if(super(),this.id=p,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(n,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Eo(this._options,this.map._requestManager,(p,n)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new o.ErrorEvent(p)):n&&(o.extend(this,n),n.bounds&&(this.tileBounds=new Vi(n.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p();const n=this.map.style._getSourceCaches(this.id);for(const l of n)l.clearTiles();this.load()}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(p,n){const l=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(l,o.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired")p.state==="loading"?p.reloadCallback=n:p.request=p.actor.send("reloadTile",m,v.bind(this));else if(p.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",m,v.bind(this),void 0,!0);else{const b=o.loadVectorTile.call({deduped:this._deduped},m,(T,P)=>{T||!P?v.call(this,T):(m.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},p.actor&&p.actor.send("loadTile",m,v.bind(this),void 0,!0))},!0);p.request={cancel:b}}function v(b,T){return delete p.request,p.aborted?n(null):b&&b.status!==404?n(b):(T&&T.resourceTiming&&(p.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&p.setExpiryData(T),p.loadVectorData(T,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:$i,"raster-dem":class extends $i{constructor(p,n,l,m){super(p,n,l,m),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(p,n){const l=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,b){v&&(p.state="errored",n(v)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",n(null))}p.request=o.getImage(this.map._requestManager.transformRequest(l,o.ResourceType.Tile),(function(v,b,T,P){if(delete p.request,p.aborted)p.state="unloaded",n(null);else if(v)p.state="errored",n(v);else if(b){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:T,expires:P});const D=o.window.ImageBitmap&&b instanceof o.window.ImageBitmap&&(vi==null&&(vi=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),vi),O=1-(b.width-o.prevPowerOfTwo(b.width))/2;O<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const B=D?b:o.exported.getImageData(b,O),U={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:B,encoding:this.encoding,padding:O};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",U,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const n=p.canonical,l=Math.pow(2,n.z),m=(n.x-1+l)%l,v=n.x===0?p.wrap-1:p.wrap,b=(n.x+1+l)%l,T=n.x+1===l?p.wrap+1:p.wrap,P={};return P[new o.OverscaledTileID(p.overscaledZ,v,n.z,m,n.y).key]={backfilled:!1},P[new o.OverscaledTileID(p.overscaledZ,T,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(P[new o.OverscaledTileID(p.overscaledZ,v,n.z,m,n.y-1).key]={backfilled:!1},P[new o.OverscaledTileID(p.overscaledZ,p.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},P[new o.OverscaledTileID(p.overscaledZ,T,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<l&&(P[new o.OverscaledTileID(p.overscaledZ,v,n.z,m,n.y+1).key]={backfilled:!1},P[new o.OverscaledTileID(p.overscaledZ,p.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},P[new o.OverscaledTileID(p.overscaledZ,T,n.z,b,n.y+1).key]={backfilled:!1}),P}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends o.Evented{constructor(p,n,l,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(m),this._data=n.data,this._options=o.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const v=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*v,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*v,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*v,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},n),this}getClusterChildren(p,n){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},n),this}getClusterLeaves(p,n,l,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:n,offset:l},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=o.extend({},this.workerOptions),n=this._data;typeof n=="string"?(p.request=this.map._requestManager.transformRequest(o.exported.resolveURL(n),o.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(l,m)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new o.ErrorEvent(l));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(v.resourceTiming=m.resourceTiming[this.id]),this.fire(new o.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,n){const l=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(l,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,v)=>(delete p.request,p.unloadVectorData(),p.aborted?n(null):m?n(m):(p.loadVectorData(v,this.map.painter,l==="reloadTile"),n(null))),void 0,l==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Rr{constructor(p,n,l,m){super(p,n,l,m),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const n of p.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.ResourceType.Source).url);o.getVideo(this.urls,(n,l)=>{this._loaded=!0,n?this.fire(new o.ErrorEvent(n)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const n=this.video.seekable;p<n.start(0)||p>n.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,n=p.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(p,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2));for(const l in this.tiles){const m=this.tiles[l];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Rr,canvas:class extends Rr{constructor(p,n,l,m){super(p,n,l,m),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(b=>typeof b!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,l=n.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(n,this.canvas,l.RGBA,{premultiply:!0});for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}}},si=function(p,n,l,m){const v=new cs[n.type](p,n,l,m);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],v),v};function se(p,n){const l=o.identity([]);return o.scale(l,l,[.5*p.width,.5*-p.height,1]),o.translate(l,l,[1,-1,0]),o.multiply$1(l,l,p.calculateProjMatrix(n.toUnwrapped()))}function F(p,n,l,m,v,b,T,P=!1){const D=p.tilesIn(m,T,P);D.sort(re);const O=[];for(const U of D)O.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(n,l,p._state,U,v,b,se(p.transform,U.tile.tileID),P)});const B=function(U){const q={},Q={};for(const K of U){const te=K.queryResults,_e=K.wrappedTileID,J=Q[_e]=Q[_e]||{};for(const me in te){const pe=te[me],he=J[me]=J[me]||{},fe=q[me]=q[me]||[];for(const ye of pe)he[ye.featureIndex]||(he[ye.featureIndex]=!0,fe.push(ye))}}return q}(O);for(const U in B)B[U].forEach(q=>{const Q=q.feature,K=p.getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=K});return B}function Z(p,n){const l=p.getRenderableIds().map(b=>p.getTileByID(b)),m=[],v={};for(let b=0;b<l.length;b++){const T=l[b],P=T.tileID.canonical.key;v[P]||(v[P]=!0,T.querySourceFeatures(m,n))}return m}function re(p,n){const l=p.tileID,m=n.tileID;return l.overscaledZ-m.overscaledZ||l.canonical.y-m.canonical.y||l.wrap-m.wrap||l.canonical.x-m.canonical.x}function ue(){return hi.workerClass!=null?new hi.workerClass:new o.window.Worker(hi.workerUrl)}const ve="mapboxgl_preloaded_worker_pool";class Ie{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Ie.workerCount;)this.workers.push(new ue);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ve]}numActive(){return Object.keys(this.active).length}}let Ce;function we(){return Ce||(Ce=new Ie),Ce}function De(p,n){const l={};for(const m in p)m!=="ref"&&(l[m]=p[m]);return o.refProperties.forEach(m=>{m in n&&(l[m]=n[m])}),l}function We(p){p=p.slice();const n=Object.create(null);for(let l=0;l<p.length;l++)n[p[l].id]=p[l];for(let l=0;l<p.length;l++)"ref"in p[l]&&(p[l]=De(p[l],n[p[l].ref]));return p}Ie.workerCount=2;const et={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function it(p,n,l){l.push({command:et.addSource,args:[p,n[p]]})}function Mt(p,n,l){n.push({command:et.removeSource,args:[p]}),l[p]=!0}function At(p,n,l,m){Mt(p,l,m),it(p,n,l)}function Lt(p,n,l){let m;for(m in p[l])if(p[l].hasOwnProperty(m)&&m!=="data"&&!de(p[l][m],n[l][m]))return!1;for(m in n[l])if(n[l].hasOwnProperty(m)&&m!=="data"&&!de(p[l][m],n[l][m]))return!1;return!0}function Ut(p,n,l,m,v,b){let T;for(T in n=n||{},p=p||{})p.hasOwnProperty(T)&&(de(p[T],n[T])||l.push({command:b,args:[m,T,n[T],v]}));for(T in n)n.hasOwnProperty(T)&&!p.hasOwnProperty(T)&&(de(p[T],n[T])||l.push({command:b,args:[m,T,n[T],v]}))}function on(p){return p.id}function jn(p,n){return p[n.id]=n,p}class Qn{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=o.clamp(n,0,1);let l=1,m=this._distances[l];const v=n*this.paddedLength+this.padding;for(;m<v&&l<this._distances.length;)m=this._distances[++l];const b=l-1,T=this._distances[b],P=m-T,D=P>0?(v-T)/P:0;return this.points[b].mult(1-D).add(this.points[l].mult(D))}}class Sn{constructor(n,l,m){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/m),this.yCellCount=Math.ceil(l/m);for(let T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,m,v,b){this._forEachCell(l,m,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(n,l,m,v){this._forEachCell(l-v,m-v,l+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(m),this.circles.push(v)}_insertBoxCell(n,l,m,v,b,T){this.boxCells[b].push(T)}_insertCircleCell(n,l,m,v,b,T){this.circleCells[b].push(T)}_query(n,l,m,v,b,T){if(m<0||n>this.width||v<0||l>this.height)return!b&&[];const P=[];if(n<=0&&l<=0&&this.width<=m&&this.height<=v){if(b)return!0;for(let D=0;D<this.boxKeys.length;D++)P.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const O=this.circles[3*D],B=this.circles[3*D+1],U=this.circles[3*D+2];P.push({key:this.circleKeys[D],x1:O-U,y1:B-U,x2:O+U,y2:B+U})}return T?P.filter(T):P}return this._forEachCell(n,l,m,v,this._queryCell,P,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?P.length>0:P}_queryCircle(n,l,m,v,b){const T=n-m,P=n+m,D=l-m,O=l+m;if(P<0||T>this.width||O<0||D>this.height)return!v&&[];const B=[];return this._forEachCell(T,D,P,O,this._queryCellCircle,B,{hitTest:v,circle:{x:n,y:l,radius:m},seenUids:{box:{},circle:{}}},b),v?B.length>0:B}query(n,l,m,v,b){return this._query(n,l,m,v,!1,b)}hitTest(n,l,m,v,b){return this._query(n,l,m,v,!0,b)}hitTestCircle(n,l,m,v){return this._queryCircle(n,l,m,!0,v)}_queryCell(n,l,m,v,b,T,P,D){const O=P.seenUids,B=this.boxCells[b];if(B!==null){const q=this.bboxes;for(const Q of B)if(!O.box[Q]){O.box[Q]=!0;const K=4*Q;if(n<=q[K+2]&&l<=q[K+3]&&m>=q[K+0]&&v>=q[K+1]&&(!D||D(this.boxKeys[Q]))){if(P.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Q],x1:q[K],y1:q[K+1],x2:q[K+2],y2:q[K+3]})}}}const U=this.circleCells[b];if(U!==null){const q=this.circles;for(const Q of U)if(!O.circle[Q]){O.circle[Q]=!0;const K=3*Q;if(this._circleAndRectCollide(q[K],q[K+1],q[K+2],n,l,m,v)&&(!D||D(this.circleKeys[Q]))){if(P.hitTest)return T.push(!0),!0;{const te=q[K],_e=q[K+1],J=q[K+2];T.push({key:this.circleKeys[Q],x1:te-J,y1:_e-J,x2:te+J,y2:_e+J})}}}}}_queryCellCircle(n,l,m,v,b,T,P,D){const O=P.circle,B=P.seenUids,U=this.boxCells[b];if(U!==null){const Q=this.bboxes;for(const K of U)if(!B.box[K]){B.box[K]=!0;const te=4*K;if(this._circleAndRectCollide(O.x,O.y,O.radius,Q[te+0],Q[te+1],Q[te+2],Q[te+3])&&(!D||D(this.boxKeys[K])))return T.push(!0),!0}}const q=this.circleCells[b];if(q!==null){const Q=this.circles;for(const K of q)if(!B.circle[K]){B.circle[K]=!0;const te=3*K;if(this._circlesCollide(Q[te],Q[te+1],Q[te+2],O.x,O.y,O.radius)&&(!D||D(this.circleKeys[K])))return T.push(!0),!0}}}_forEachCell(n,l,m,v,b,T,P,D){const O=this._convertToXCellCoord(n),B=this._convertToYCellCoord(l),U=this._convertToXCellCoord(m),q=this._convertToYCellCoord(v);for(let Q=O;Q<=U;Q++)for(let K=B;K<=q;K++)if(b.call(this,n,l,m,v,this.xCellCount*K+Q,T,P,D))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,m,v,b,T){const P=v-n,D=b-l,O=m+T;return O*O>P*P+D*D}_circleAndRectCollide(n,l,m,v,b,T,P){const D=(T-v)/2,O=Math.abs(n-(v+D));if(O>D+m)return!1;const B=(P-b)/2,U=Math.abs(l-(b+B));if(U>B+m)return!1;if(O<=D||U<=B)return!0;const q=O-D,Q=U-B;return q*q+Q*Q<=m*m}}const Vn=Math.tan(85*Math.PI/180);function br(p,n,l,m,v,b){let T=o.create();if(l){if(v.projection.name==="globe")T=o.calculateGlobeMatrix(v,v.worldSize/v._projectionScaler,[0,0]),o.multiply$1(T,T,o.globeDenormalizeECEF(o.globeTileBounds(n)));else{const P=$([],b);T[0]=P[0],T[1]=P[1],T[4]=P[2],T[5]=P[3]}m||o.rotateZ(T,T,v.angle)}else o.multiply$1(T,v.labelPlaneMatrix,p);return T}function ai(p,n,l,m,v,b){if(l){if(v.projection.name==="globe"){const T=br(p,n,l,m,v,b);return o.invert(T,T),o.multiply$1(T,p,T),T}{const T=o.clone(p),P=o.identity([]);return P[0]=b[0],P[1]=b[1],P[4]=b[2],P[5]=b[3],o.multiply$1(T,T,P),m||o.rotateZ(T,T,-v.angle),T}}return v.glCoordMatrix}function rr(p,n,l=0){const m=[p.x,p.y,l,1];l?o.transformMat4$1(m,m,n):Zi(m,m,n);const v=m[3];return{point:new o.pointGeometry(m[0]/v,m[1]/v),signedDistanceFromCamera:v}}function Sr(p,n){return Math.min(.5+p/n*.5,1.5)}function To(p,n){const l=p[0]/p[3],m=p[1]/p[3];return l>=-n[0]&&l<=n[0]&&m>=-n[1]&&m<=n[1]}function bi(p,n,l,m,v,b,T,P,D,O){const B=l.transform,U=m?p.textSizeData:p.iconSizeData,q=o.evaluateSizeForZoom(U,l.transform.zoom),Q=[256/l.width*2+1,256/l.height*2+1],K=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;K.clear();const te=p.lineVertexArray,_e=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,J=l.transform.width/l.transform.height;let me=!1;for(let pe=0;pe<_e.length;pe++){const he=_e.get(pe);if(he.writingMode!==o.WritingMode.vertical||me||pe!==0&&_e.get(pe-1).writingMode===o.WritingMode.horizontal||(me=!0),he.hidden||he.writingMode===o.WritingMode.vertical&&!me){Or(he.numGlyphs,K);continue}me=!1;const fe=new o.pointGeometry(he.tileAnchorX,he.tileAnchorY),ye=D?D(fe):[0,0,0],Le=B.projection.projectTilePoint(fe.x,fe.y,O.canonical),Ue=[Le.x+ye[0],Le.y+ye[1],Le.z+ye[2]],ht=[...Ue,1];if(o.transformMat4$1(ht,ht,n),!To(ht,Q)){Or(he.numGlyphs,K);continue}const ot=Sr(l.transform.cameraToCenterDistance,ht[3]),nt=o.evaluateSizeForFeature(U,q,he),qe=T?nt/ot:nt*ot,Ne=rr(new o.pointGeometry(Ue[0],Ue[1]),v,Ue[2]);if(Ne.signedDistanceFromCamera<=0){Or(he.numGlyphs,K);continue}let tt={};const Ye=T?null:D,Rt=ks(he,qe,!1,P,n,v,b,p.glyphOffsetArray,te,K,Ne.point,fe,tt,J,Ye,B.projection,O);me=Rt.useVertical,Ye&&Rt.needsFlipping&&(tt={}),(Rt.notEnoughRoom||me||Rt.needsFlipping&&ks(he,qe,!0,P,n,v,b,p.glyphOffsetArray,te,K,Ne.point,fe,tt,J,Ye,B.projection,O).notEnoughRoom)&&Or(he.numGlyphs,K)}m?p.text.dynamicLayoutVertexBuffer.updateData(K):p.icon.dynamicLayoutVertexBuffer.updateData(K)}function ki(p,n,l,m,v,b,T,P,D,O,B,U,q,Q,K){const te=P.glyphStartIndex+P.numGlyphs,_e=P.lineStartIndex,J=P.lineStartIndex+P.lineLength,me=n.getoffsetX(P.glyphStartIndex),pe=n.getoffsetX(te-1),he=Qr(p*me,l,m,v,b,T,P.segment,_e,J,D,O,B,U,q,!0,Q,K);if(!he)return null;const fe=Qr(p*pe,l,m,v,b,T,P.segment,_e,J,D,O,B,U,q,!0,Q,K);return fe?{first:he,last:fe}:null}function hs(p,n,l,m){return p.writingMode===o.WritingMode.horizontal&&Math.abs(l.y-n.y)>Math.abs(l.x-n.x)*m?{useVertical:!0}:p.writingMode===o.WritingMode.vertical?n.y<l.y?{needsFlipping:!0}:null:p.flipState!==0&&function(v,b,T){const P=(b.x-v.x)*T;return P===0||Math.abs((b.y-v.y)/P)>Vn}(n,l,m)?p.flipState===1?{needsFlipping:!0}:null:n.x>l.x?{needsFlipping:!0}:null}function ks(p,n,l,m,v,b,T,P,D,O,B,U,q,Q,K,te,_e){const J=n/24,me=p.lineOffsetX*J,pe=p.lineOffsetY*J;let he;if(p.numGlyphs>1){const fe=p.glyphStartIndex+p.numGlyphs,ye=p.lineStartIndex,Le=p.lineStartIndex+p.lineLength,Ue=ki(J,P,me,pe,l,B,U,p,D,b,q,K,!1,te,_e);if(!Ue)return{notEnoughRoom:!0};const ht=rr(Ue.first.point,T).point,ot=rr(Ue.last.point,T).point;if(m&&!l){const nt=hs(p,ht,ot,Q);if(p.flipState=nt&&nt.needsFlipping?1:2,nt)return nt}he=[Ue.first];for(let nt=p.glyphStartIndex+1;nt<fe-1;nt++)he.push(Qr(J*P.getoffsetX(nt),me,pe,l,B,U,p.segment,ye,Le,D,b,q,K,!1,!1,te,_e));he.push(Ue.last)}else{if(m&&!l){const ye=rr(U,v).point,Le=p.lineStartIndex+p.segment+1,Ue=new o.pointGeometry(D.getx(Le),D.gety(Le)),ht=rr(Ue,v),ot=hs(p,ye,ht.signedDistanceFromCamera>0?ht.point:gr(U,Ue,ye,1,v,void 0,te,_e.canonical),Q);if(p.flipState=ot&&ot.needsFlipping?1:2,ot)return ot}const fe=Qr(J*P.getoffsetX(p.glyphStartIndex),me,pe,l,B,U,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,D,b,q,K,!1,!1,te,_e);if(!fe)return{notEnoughRoom:!0};he=[fe]}for(const fe of he)o.addDynamicAttributes(O,fe.point,fe.angle);return{}}function Gr(p,n,l,m,v){const b=m.projectTilePoint(p.x,p.y,n);if(!v)return rr(b,l,b.z);const T=v(p);return rr(new o.pointGeometry(b.x+T[0],b.y+T[1]),l,b.z+T[2])}function gr(p,n,l,m,v,b,T,P){const D=Gr(p.add(p.sub(n)._unit()),P,v,T,b).point,O=l.sub(D);return l.add(O._mult(m/O.mag()))}function Qr(p,n,l,m,v,b,T,P,D,O,B,U,q,Q,K,te,_e){const J=m?p-n:p+n;let me=J>0?1:-1,pe=0;m&&(me*=-1,pe=Math.PI),me<0&&(pe+=Math.PI);let he=me>0?P+T:P+T+1,fe=v,ye=v,Le=0,Ue=0;const ht=Math.abs(J),ot=[],nt=[];let qe=b;const Ne=()=>{const ft=he-me;return Le===0?b:new o.pointGeometry(O.getx(ft),O.gety(ft))},tt=()=>gr(Ne(),qe,ye,ht-Le+1,B,q,te,_e.canonical);for(;Le+Ue<=ht;){if(he+=me,he<P||he>=D)return null;if(ye=fe,ot.push(fe),Q&&nt.push(qe||Ne()),fe=U[he],fe===void 0){qe=new o.pointGeometry(O.getx(he),O.gety(he));const ft=Gr(qe,_e.canonical,B,te,q);fe=ft.signedDistanceFromCamera>0?U[he]=ft.point:tt()}else qe=null;Le+=Ue,Ue=ye.dist(fe)}K&&q&&(qe=qe||new o.pointGeometry(O.getx(he),O.gety(he)),U[he]=fe=U[he]===void 0?fe:tt(),Ue=ye.dist(fe));const Ye=(ht-Le)/Ue,Rt=fe.sub(ye),Gt=Rt.mult(Ye)._add(ye);l&&Gt._add(Rt._unit()._perp()._mult(l*me));const ln=pe+Math.atan2(fe.y-ye.y,fe.x-ye.x);return ot.push(Gt),Q&&(qe=qe||new o.pointGeometry(O.getx(he),O.gety(he)),nt.push(function(ft,Ft,Kt){const zn=1-Kt;return new o.pointGeometry(ft.x*zn+Ft.x*Kt,ft.y*zn+Ft.y*Kt)}(nt.length>0?nt[nt.length-1]:qe,qe,Ye))),{point:Gt,angle:ln,path:ot,tilePath:nt}}const zi=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Or(p,n){for(let l=0;l<p;l++){const m=n.length;n.resize(m+4),n.float32.set(zi,3*m)}}function Zi(p,n,l){const m=n[0],v=n[1];return p[0]=l[0]*m+l[4]*v+l[12],p[1]=l[1]*m+l[5]*v+l[13],p[3]=l[3]*m+l[7]*v+l[15],p}const qr=100;class ra{constructor(n,l,m=new Sn(n.width+200,n.height+200,25),v=new Sn(n.width+200,n.height+200,25)){this.transform=n,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+qr,this.screenBottomBoundary=n.height+qr,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=l}placeCollisionBox(n,l,m,v,b,T,P){let D=l.projectedAnchorX,O=l.projectedAnchorY,B=l.projectedAnchorZ;const U=l.elevation,q=l.tileID;if(U&&q){const he=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),fe=he.upVector(q.canonical,l.tileAnchorX,l.tileAnchorY),ye=he.upVectorScale(q.canonical);D+=fe[0]*U*ye,O+=fe[1]*U*ye,B+=fe[2]*U*ye}const Q=this.projectAndGetPerspectiveRatio(T,D,O,B,l.tileID),K=b*Q.perspectiveRatio,te=(l.x1*n+m.x-l.padding)*K+Q.point.x,_e=(l.y1*n+m.y-l.padding)*K+Q.point.y,J=(l.x2*n+m.x+l.padding)*K+Q.point.x,me=(l.y2*n+m.y+l.padding)*K+Q.point.y,pe=Q.perspectiveRatio<=.55||Q.aboveHorizon;return!this.isInsideGrid(te,_e,J,me)||!v&&this.grid.hitTest(te,_e,J,me,P)||pe?{box:[],offscreen:!1}:{box:[te,_e,J,me],offscreen:this.isOffscreen(te,_e,J,me)}}placeCollisionCircles(n,l,m,v,b,T,P,D,O,B,U,q,Q,K){const te=[],_e=this.transform.elevation,J=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),me=_e?_e.getAtTileOffsetFunc(K,J):Ye=>[0,0,0],pe=new o.pointGeometry(l.tileAnchorX,l.tileAnchorY),he=this.transform.projection.projectTilePoint(l.tileAnchorX,l.tileAnchorY,K.canonical),fe=me(pe),ye=[he.x+fe[0],he.y+fe[1],he.z+fe[2]],Le=this.projectAndGetPerspectiveRatio(T,ye[0],ye[1],ye[2],K),{perspectiveRatio:Ue}=Le,ht=(B?b/Ue:b*Ue)/o.ONE_EM,ot=rr(new o.pointGeometry(ye[0],ye[1]),P,ye[2]).point,nt=Le.signedDistanceFromCamera>0?ki(ht,v,l.lineOffsetX*ht,l.lineOffsetY*ht,!1,ot,pe,l,m,P,{},_e&&!B?me:null,B&&!!_e,this.transform.projection,K):null;let qe=!1,Ne=!1,tt=!0;if(nt&&!Le.aboveHorizon){const Ye=.5*q*Ue+Q,Rt=new o.pointGeometry(-100,-100),Gt=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ln=new Qn,ft=nt.first,Ft=nt.last;let Kt=[];for(let Xt=ft.path.length-1;Xt>=1;Xt--)Kt.push(ft.path[Xt]);for(let Xt=1;Xt<Ft.path.length;Xt++)Kt.push(Ft.path[Xt]);const zn=2.5*Ye;if(D){const Xt=Kt.map(_e?(gn,Xn)=>{const Jn=me(Xn<ft.path.length-1?ft.tilePath[ft.path.length-1-Xn]:Ft.tilePath[Xn-ft.path.length+2]);return rr(gn,D,Jn[2])}:gn=>rr(gn,D));Kt=Xt.some(gn=>gn.signedDistanceFromCamera<=0)?[]:Xt.map(gn=>gn.point)}let Wn=[];if(Kt.length>0){const Xt=Kt[0].clone(),gn=Kt[0].clone();for(let Xn=1;Xn<Kt.length;Xn++)Xt.x=Math.min(Xt.x,Kt[Xn].x),Xt.y=Math.min(Xt.y,Kt[Xn].y),gn.x=Math.max(gn.x,Kt[Xn].x),gn.y=Math.max(gn.y,Kt[Xn].y);Wn=Xt.x>=Rt.x&&gn.x<=Gt.x&&Xt.y>=Rt.y&&gn.y<=Gt.y?[Kt]:gn.x<Rt.x||Xt.x>Gt.x||gn.y<Rt.y||Xt.y>Gt.y?[]:o.clipLine([Kt],Rt.x,Rt.y,Gt.x,Gt.y)}for(const Xt of Wn){ln.reset(Xt,.25*Ye);let gn=0;gn=ln.length<=.5*Ye?1:Math.ceil(ln.paddedLength/zn)+1;for(let Xn=0;Xn<gn;Xn++){const Jn=Xn/Math.max(gn-1,1),Hr=ln.lerp(Jn),di=Hr.x+qr,ti=Hr.y+qr;te.push(di,ti,Ye,0);const Tn=di-Ye,Ht=ti-Ye,bn=di+Ye,fr=ti+Ye;if(tt=tt&&this.isOffscreen(Tn,Ht,bn,fr),Ne=Ne||this.isInsideGrid(Tn,Ht,bn,fr),!n&&this.grid.hitTestCircle(di,ti,Ye,U)&&(qe=!0,!O))return{circles:[],offscreen:!1,collisionDetected:qe}}}}return{circles:!O&&qe||!Ne?[]:te,offscreen:tt,collisionDetected:qe}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let m=1/0,v=1/0,b=-1/0,T=-1/0;for(const B of n){const U=new o.pointGeometry(B.x+qr,B.y+qr);m=Math.min(m,U.x),v=Math.min(v,U.y),b=Math.max(b,U.x),T=Math.max(T,U.y),l.push(U)}const P=this.grid.query(m,v,b,T).concat(this.ignoredGrid.query(m,v,b,T)),D={},O={};for(const B of P){const U=B.key;if(D[U.bucketInstanceId]===void 0&&(D[U.bucketInstanceId]={}),D[U.bucketInstanceId][U.featureIndex])continue;const q=[new o.pointGeometry(B.x1,B.y1),new o.pointGeometry(B.x2,B.y1),new o.pointGeometry(B.x2,B.y2),new o.pointGeometry(B.x1,B.y2)];o.polygonIntersectsPolygon(l,q)&&(D[U.bucketInstanceId][U.featureIndex]=!0,O[U.bucketInstanceId]===void 0&&(O[U.bucketInstanceId]=[]),O[U.bucketInstanceId].push(U.featureIndex))}return O}insertCollisionBox(n,l,m,v,b){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,m,v,b){const T=l?this.ignoredGrid:this.grid,P={bucketInstanceId:m,featureIndex:v,collisionGroupID:b};for(let D=0;D<n.length;D+=4)T.insertCircle(P,n[D],n[D+1],n[D+2])}projectAndGetPerspectiveRatio(n,l,m,v,b){const T=[l,m,v||0,1];let P=!1;if(v||this.transform.pitch>0){o.transformMat4$1(T,T,n);let D=!1;this.fogState&&b&&(D=function(O,B,U,q,Q,K){const te=K.calculateFogTileMatrix(Q),_e=[B,U,q];return o.transformMat4(_e,_e,te),Nt(O,_e,K.pitch,K._fov)}(this.fogState,l,m,v||0,b.toUnwrapped(),this.transform)>.9),P=T[2]>T[3]||D}else Zi(T,T,n);return{point:new o.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+qr,(-T[1]/T[3]+1)/2*this.transform.height+qr),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/T[3]*.5,1.5),signedDistanceFromCamera:T[3],aboveHorizon:P}}isOffscreen(n,l,m,v){return m<qr||n>=this.screenRightBoundary||v<qr||l>this.screenBottomBoundary}isInsideGrid(n,l,m,v){return m>=0&&n<this.gridRightBoundary&&v>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=o.identity([]);return o.translate(n,n,[-100,-100,0]),n}}class Gi{constructor(n,l,m,v){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class ds{constructor(n,l,m,v,b,T=!1){this.text=new Gi(n?n.text:null,l,m,b),this.icon=new Gi(n?n.icon:null,l,v,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class qi{constructor(n,l,m,v=!1){this.text=n,this.icon=l,this.skipFade=m,this.clipped=v}}class fs{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class El{constructor(n,l,m,v,b){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=b}}class ia{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:m=>m.collisionGroupID===l}}return this.collisionGroups[n]}}function oa(p,n,l,m,v){const{horizontalAlign:b,verticalAlign:T}=o.getAnchorAlignment(p),P=-(b-.5)*n,D=-(T-.5)*l,O=o.evaluateVariableOffset(p,m);return new o.pointGeometry(P+O[0]*v,D+O[1]*v)}function X(p,n,l,m,v){const b=new o.pointGeometry(p,n);return l&&b._rotate(m?v:-v),b}class ie{constructor(n,l,m,v,b){this.transform=n.clone(),this.collisionIndex=new ra(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ia(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,l,m,v){const b=m.getBucket(l),T=m.latestFeatureIndex;if(!b||!T||l.id!==b.layerIds[0])return;const P=b.layers[0].layout,D=m.collisionBoxArray,O=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),B=m.tileSize/o.EXTENT,U=m.tileID.toUnwrapped(),q=this.transform.calculateProjMatrix(U),Q=P.get("text-pitch-alignment")==="map",K=P.get("text-rotation-alignment")==="map";l.compileFilter();const te=l.dynamicFilter(),_e=l.dynamicFilterNeedsFeature(),J=this.transform.calculatePixelsToTileUnitsMatrix(m),me=br(q,m.tileID.canonical,Q,K,this.transform,J);let pe=null;if(Q){const ye=ai(q,m.tileID.canonical,Q,K,this.transform,J);pe=o.multiply$1([],this.transform.labelPlaneMatrix,ye)}let he=null;te&&m.latestFeatureIndex&&(he={unwrappedTileID:U,dynamicFilter:te,dynamicFilterNeedsFeature:_e,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new El(b.bucketInstanceId,T,b.sourceLayerIndex,b.index,m.tileID);const fe={bucket:b,layout:P,posMatrix:q,textLabelPlaneMatrix:me,labelToScreenMatrix:pe,clippingData:he,scale:O,textPixelRatio:B,holdingForFade:m.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const ye of b.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:Ue,symbolInstanceEnd:ht}=ye;n.push({sortKey:Le,symbolInstanceStart:Ue,symbolInstanceEnd:ht,parameters:fe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:fe})}attemptAnchorPlacement(n,l,m,v,b,T,P,D,O,B,U,q,Q,K,te,_e,J,me){const pe=[q.textOffset0,q.textOffset1],he=oa(n,m,v,pe,b),fe=this.collisionIndex.placeCollisionBox(b,l,X(he.x,he.y,T,P,this.transform.angle),U,D,O,B.predicate);if((!_e||this.collisionIndex.placeCollisionBox(K.getSymbolInstanceIconSize(me,this.transform.zoom,Q),_e,X(he.x,he.y,T,P,this.transform.angle),U,D,O,B.predicate).box.length!==0)&&fe.box.length>0){let ye;return this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(ye=this.prevPlacement.variableOffsets[q.crossTileID].anchor),this.variableOffsets[q.crossTileID]={textOffset:pe,width:m,height:v,anchor:n,textScale:b,prevAnchor:ye},this.markUsedJustification(K,n,q,te),K.allowVerticalPlacement&&(this.markUsedOrientation(K,te,q),this.placedOrientations[q.crossTileID]=te),{shift:he,placedGlyphBoxes:fe}}}placeLayerBucketPart(n,l,m,v){const{bucket:b,layout:T,posMatrix:P,textLabelPlaneMatrix:D,labelToScreenMatrix:O,clippingData:B,textPixelRatio:U,holdingForFade:q,collisionBoxArray:Q,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:te,collisionGroup:_e}=n.parameters,J=T.get("text-optional"),me=T.get("icon-optional"),pe=T.get("text-allow-overlap"),he=T.get("icon-allow-overlap"),fe=T.get("text-rotation-alignment")==="map",ye=T.get("text-pitch-alignment")==="map",Le=T.get("icon-text-fit")!=="none",Ue=T.get("symbol-z-order")==="viewport-y",ht=pe&&(he||!b.hasIconData()||me),ot=he&&(pe||!b.hasTextData()||J);!b.collisionArrays&&Q&&b.deserializeCollisionBoxes(Q),m&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,Q);const nt=(qe,Ne,tt)=>{if(B){const Tn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ht=null;if(B.dynamicFilterNeedsFeature){const bn=this.retainedQueryData[b.bucketInstanceId];Ht=B.featureIndex.loadFeature({featureIndex:qe.featureIndex,bucketIndex:bn.bucketIndex,sourceLayerIndex:bn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,B.dynamicFilter)(Tn,Ht,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new o.pointGeometry(qe.tileAnchorX,qe.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[qe.crossTileID]=new qi(!1,!1,!1,!0),void(l[qe.crossTileID]=!0)}if(l[qe.crossTileID])return;if(q)return void(this.placements[qe.crossTileID]=new qi(!1,!1,!1));let Ye=!1,Rt=!1,Gt=!0,ln=null,ft={box:null,offscreen:null},Ft={box:null,offscreen:null},Kt=null,zn=null,Wn=null,Xt=0,gn=0,Xn=0;tt.textFeatureIndex?Xt=tt.textFeatureIndex:qe.useRuntimeCollisionCircles&&(Xt=qe.featureIndex),tt.verticalTextFeatureIndex&&(gn=tt.verticalTextFeatureIndex);const Jn=Tn=>{Tn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||Tn.elevation)&&(Tn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,Tn.tileAnchorX,Tn.tileAnchorY):0)},Hr=tt.textBox;if(Hr){Jn(Hr);const Tn=bn=>{let fr=o.WritingMode.horizontal;if(b.allowVerticalPlacement&&!bn&&this.prevPlacement){const Bn=this.prevPlacement.placedOrientations[qe.crossTileID];Bn&&(this.placedOrientations[qe.crossTileID]=Bn,fr=Bn,this.markUsedOrientation(b,fr,qe))}return fr},Ht=(bn,fr)=>{if(b.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&tt.verticalTextBox){for(const Bn of b.writingModes)if(Bn===o.WritingMode.vertical?(ft=fr(),Ft=ft):ft=bn(),ft&&ft.box&&ft.box.length)break}else ft=bn()};if(T.get("text-variable-anchor")){let bn=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[qe.crossTileID]){const Hn=this.prevPlacement.variableOffsets[qe.crossTileID];bn.indexOf(Hn.anchor)>0&&(bn=bn.filter(Mr=>Mr!==Hn.anchor),bn.unshift(Hn.anchor))}const fr=(Hn,Mr,lo)=>{const yr=b.getSymbolInstanceTextSize(K,qe,this.transform.zoom,Ne),Vs=(Hn.x2-Hn.x1)*yr+2*Hn.padding,Ct=(Hn.y2-Hn.y1)*yr+2*Hn.padding,jt=Le&&!he?Mr:null;jt&&Jn(jt);let Nr={box:[],offscreen:!1};const Xo=pe?2*bn.length:bn.length;for(let Ho=0;Ho<Xo;++Ho){const Er=this.attemptAnchorPlacement(bn[Ho%bn.length],Hn,Vs,Ct,yr,fe,ye,U,P,_e,Ho>=bn.length,qe,Ne,b,lo,jt,K,te);if(Er&&(Nr=Er.placedGlyphBoxes,Nr&&Nr.box&&Nr.box.length)){Ye=!0,ln=Er.shift;break}}return Nr};Ht(()=>fr(Hr,tt.iconBox,o.WritingMode.horizontal),()=>{const Hn=tt.verticalTextBox;return Hn&&Jn(Hn),b.allowVerticalPlacement&&!(ft&&ft.box&&ft.box.length)&&qe.numVerticalGlyphVertices>0&&Hn?fr(Hn,tt.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),ft&&(Ye=ft.box,Gt=ft.offscreen);const Bn=Tn(ft&&ft.box);if(!Ye&&this.prevPlacement){const Hn=this.prevPlacement.variableOffsets[qe.crossTileID];Hn&&(this.variableOffsets[qe.crossTileID]=Hn,this.markUsedJustification(b,Hn.anchor,qe,Bn))}}else{const bn=(fr,Bn)=>{const Hn=b.getSymbolInstanceTextSize(K,qe,this.transform.zoom,Ne),Mr=this.collisionIndex.placeCollisionBox(Hn,fr,new o.pointGeometry(0,0),pe,U,P,_e.predicate);return Mr&&Mr.box&&Mr.box.length&&(this.markUsedOrientation(b,Bn,qe),this.placedOrientations[qe.crossTileID]=Bn),Mr};Ht(()=>bn(Hr,o.WritingMode.horizontal),()=>{const fr=tt.verticalTextBox;return b.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&fr?(Jn(fr),bn(fr,o.WritingMode.vertical)):{box:null,offscreen:null}}),Tn(ft&&ft.box&&ft.box.length)}}if(Kt=ft,Ye=Kt&&Kt.box&&Kt.box.length>0,Gt=Kt&&Kt.offscreen,qe.useRuntimeCollisionCircles){const Tn=b.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex>=0?qe.centerJustifiedTextSymbolIndex:qe.verticalPlacedTextSymbolIndex),Ht=o.evaluateSizeForFeature(b.textSizeData,K,Tn),bn=T.get("text-padding");zn=this.collisionIndex.placeCollisionCircles(pe,Tn,b.lineVertexArray,b.glyphOffsetArray,Ht,P,D,O,m,ye,_e.predicate,qe.collisionCircleDiameter*Ht/o.ONE_EM,bn,this.retainedQueryData[b.bucketInstanceId].tileID),Ye=pe||zn.circles.length>0&&!zn.collisionDetected,Gt=Gt&&zn.offscreen}if(tt.iconFeatureIndex&&(Xn=tt.iconFeatureIndex),tt.iconBox){const Tn=Ht=>{Jn(Ht);const bn=Le&&ln?X(ln.x,ln.y,fe,ye,this.transform.angle):new o.pointGeometry(0,0),fr=b.getSymbolInstanceIconSize(te,this.transform.zoom,Ne);return this.collisionIndex.placeCollisionBox(fr,Ht,bn,he,U,P,_e.predicate)};Ft&&Ft.box&&Ft.box.length&&tt.verticalIconBox?(Wn=Tn(tt.verticalIconBox),Rt=Wn.box.length>0):(Wn=Tn(tt.iconBox),Rt=Wn.box.length>0),Gt=Gt&&Wn.offscreen}const di=J||qe.numHorizontalGlyphVertices===0&&qe.numVerticalGlyphVertices===0,ti=me||qe.numIconVertices===0;if(di||ti?ti?di||(Rt=Rt&&Ye):Ye=Rt&&Ye:Rt=Ye=Rt&&Ye,Ye&&Kt&&Kt.box&&this.collisionIndex.insertCollisionBox(Kt.box,T.get("text-ignore-placement"),b.bucketInstanceId,Ft&&Ft.box&&gn?gn:Xt,_e.ID),Rt&&Wn&&this.collisionIndex.insertCollisionBox(Wn.box,T.get("icon-ignore-placement"),b.bucketInstanceId,Xn,_e.ID),zn&&(Ye&&this.collisionIndex.insertCollisionCircles(zn.circles,T.get("text-ignore-placement"),b.bucketInstanceId,Xt,_e.ID),m)){const Tn=b.bucketInstanceId;let Ht=this.collisionCircleArrays[Tn];Ht===void 0&&(Ht=this.collisionCircleArrays[Tn]=new fs);for(let bn=0;bn<zn.circles.length;bn+=4)Ht.circles.push(zn.circles[bn+0]),Ht.circles.push(zn.circles[bn+1]),Ht.circles.push(zn.circles[bn+2]),Ht.circles.push(zn.collisionDetected?1:0)}this.placements[qe.crossTileID]=new qi(Ye||ht,Rt||ot,Gt||b.justReloaded),l[qe.crossTileID]=!0};if(Ue){const qe=b.getSortedSymbolIndexes(this.transform.angle);for(let Ne=qe.length-1;Ne>=0;--Ne){const tt=qe[Ne];nt(b.symbolInstances.get(tt),tt,b.collisionArrays[tt])}}else for(let qe=n.symbolInstanceStart;qe<n.symbolInstanceEnd;qe++)nt(b.symbolInstances.get(qe),qe,b.collisionArrays[qe]);if(m&&b.bucketInstanceId in this.collisionCircleArrays){const qe=this.collisionCircleArrays[b.bucketInstanceId];o.invert(qe.invProjMatrix,P),qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(n,l,m,v){let b;b=v===o.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(l)];const T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const P of T)P>=0&&(n.text.placedSymbolArray.get(P).crossTileID=b>=0&&P!==b?0:m.crossTileID)}markUsedOrientation(n,l,m){const v=l===o.WritingMode.horizontal||l===o.WritingMode.horizontalOnly?l:0,b=l===o.WritingMode.vertical?l:0,T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const P of T)n.text.placedSymbolArray.get(P).placedOrientation=v;m.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let m=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const v=l?l.symbolFadeChange(n):1,b=l?l.opacities:{},T=l?l.variableOffsets:{},P=l?l.placedOrientations:{};for(const D in this.placements){const O=this.placements[D],B=b[D];B?(this.opacities[D]=new ds(B,v,O.text,O.icon,null,O.clipped),m=m||O.text!==B.text.placed||O.icon!==B.icon.placed):(this.opacities[D]=new ds(null,v,O.text,O.icon,O.skipFade,O.clipped),m=m||O.text||O.icon)}for(const D in b){const O=b[D];if(!this.opacities[D]){const B=new ds(O,v,!1,!1);B.isHidden()||(this.opacities[D]=B,m=m||O.text.placed||O.icon.placed)}}for(const D in T)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=T[D]);for(const D in P)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=P[D]);m?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l){const m={};for(const v of l){const b=v.getBucket(n);b&&v.latestFeatureIndex&&n.id===b.layerIds[0]&&this.updateBucketOpacities(b,m,v.collisionBoxArray)}}updateBucketOpacities(n,l,m){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const v=n.layers[0].layout,b=!!n.layers[0].dynamicFilter(),T=new ds(null,0,!1,!1,!0),P=v.get("text-allow-overlap"),D=v.get("icon-allow-overlap"),O=v.get("text-variable-anchor"),B=v.get("text-rotation-alignment")==="map",U=v.get("text-pitch-alignment")==="map",q=v.get("icon-text-fit")!=="none",Q=new ds(null,0,P&&(D||!n.hasIconData()||v.get("icon-optional")),D&&(P||!n.hasTextData()||v.get("text-optional")),!0);!n.collisionArrays&&m&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(m);const K=(_e,J,me)=>{for(let pe=0;pe<J/4;pe++)_e.opacityVertexArray.emplaceBack(me)};let te=0;for(let _e=0;_e<n.symbolInstances.length;_e++){const J=n.symbolInstances.get(_e),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:pe,crossTileID:he}=J;let fe=this.opacities[he];l[he]?fe=T:fe||(fe=Q,this.opacities[he]=fe),l[he]=!0;const ye=me>0||pe>0,Le=J.numIconVertices>0,Ue=this.placedOrientations[J.crossTileID],ht=Ue===o.WritingMode.vertical,ot=Ue===o.WritingMode.horizontal||Ue===o.WritingMode.horizontalOnly;if(!ye&&!Le||fe.isHidden()||te++,ye){const nt=li(fe.text);K(n.text,me,ht?ps:nt),K(n.text,pe,ot?ps:nt);const qe=fe.text.isHidden();[J.rightJustifiedTextSymbolIndex,J.centerJustifiedTextSymbolIndex,J.leftJustifiedTextSymbolIndex].forEach(Ye=>{Ye>=0&&(n.text.placedSymbolArray.get(Ye).hidden=qe||ht?1:0)}),J.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(J.verticalPlacedTextSymbolIndex).hidden=qe||ot?1:0);const Ne=this.variableOffsets[J.crossTileID];Ne&&this.markUsedJustification(n,Ne.anchor,J,Ue);const tt=this.placedOrientations[J.crossTileID];tt&&(this.markUsedJustification(n,"left",J,tt),this.markUsedOrientation(n,tt,J))}if(Le){const nt=li(fe.icon);J.placedIconSymbolIndex>=0&&(K(n.icon,J.numIconVertices,ht?ps:nt),n.icon.placedSymbolArray.get(J.placedIconSymbolIndex).hidden=fe.icon.isHidden()),J.verticalPlacedIconSymbolIndex>=0&&(K(n.icon,J.numVerticalIconVertices,ot?ps:nt),n.icon.placedSymbolArray.get(J.verticalPlacedIconSymbolIndex).hidden=fe.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const nt=n.collisionArrays[_e];if(nt){let qe=new o.pointGeometry(0,0),Ne=!0;if(nt.textBox||nt.verticalTextBox){if(O){const Ye=this.variableOffsets[he];Ye?(qe=oa(Ye.anchor,Ye.width,Ye.height,Ye.textOffset,Ye.textScale),B&&qe._rotate(U?this.transform.angle:-this.transform.angle)):Ne=!1}b&&(Ne=!fe.clipped),nt.textBox&&xe(n.textCollisionBox.collisionVertexArray,fe.text.placed,!Ne||ht,qe.x,qe.y),nt.verticalTextBox&&xe(n.textCollisionBox.collisionVertexArray,fe.text.placed,!Ne||ot,qe.x,qe.y)}const tt=Ne&&!!(!ot&&nt.verticalIconBox);nt.iconBox&&xe(n.iconCollisionBox.collisionVertexArray,fe.icon.placed,tt,q?qe.x:0,q?qe.y:0),nt.verticalIconBox&&xe(n.iconCollisionBox.collisionVertexArray,fe.icon.placed,!tt,q?qe.x:0,q?qe.y:0)}}}if(n.fullyClipped=te===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=_e.invProjMatrix,n.placementViewportMatrix=_e.viewportMatrix,n.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const m=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*m>n}setStale(){this.stale=!0}}function xe(p,n,l,m,v){p.emplaceBack(n?1:0,l?1:0,m||0,v||0),p.emplaceBack(n?1:0,l?1:0,m||0,v||0),p.emplaceBack(n?1:0,l?1:0,m||0,v||0),p.emplaceBack(n?1:0,l?1:0,m||0,v||0)}const le=Math.pow(2,25),ke=Math.pow(2,24),kt=Math.pow(2,17),tn=Math.pow(2,16),an=Math.pow(2,9),er=Math.pow(2,8),ir=Math.pow(2,1);function li(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const n=p.placed?1:0,l=Math.floor(127*p.opacity);return l*le+n*ke+l*kt+n*tn+l*an+n*er+l*ir+n}const ps=0;class bt{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,l,m,v,b){const T=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(T,v,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((P,D)=>P.sortKey-D.sortKey));this._currentPartIndex<T.length;){const P=T[this._currentPartIndex];if(l.placeLayerBucketPart(P,this._seenCrossTileIDs,m,P.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class xn{constructor(n,l,m,v,b,T,P,D){this.placement=new ie(n,b,T,P,D),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(n,l,m){const v=o.exported.now(),b=()=>{const T=o.exported.now()-v;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=l[n[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=P)&&(!T.maxzoom||T.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new bt(T)),this._inProgressLayer.continuePlacement(m[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const mn=512/o.EXTENT/2;class ro{constructor(n,l,m){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let v=0;v<l.length;v++){const b=l.get(v),T=b.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,n)})}}getScaledCoordinates(n,l){const m=mn/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*o.EXTENT+n.tileAnchorX)*m),y:Math.floor((l.canonical.y*o.EXTENT+n.tileAnchorY)*m)}}findMatches(n,l,m){const v=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let b=0;b<n.length;b++){const T=n.get(b);if(T.crossTileID)continue;const P=this.indexedSymbolInstances[T.key];if(!P)continue;const D=this.getScaledCoordinates(T,l);for(const O of P)if(Math.abs(O.coord.x-D.x)<=v&&Math.abs(O.coord.y-D.y)<=v&&!m[O.crossTileID]){m[O.crossTileID]=!0,T.crossTileID=O.crossTileID;break}}}}class $a{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Bt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(l!==0)for(const m in this.indexes){const v=this.indexes[m],b={};for(const T in v){const P=v[T];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+l),b[P.tileID.key]=P}this.indexes[m]=b}this.lng=n}addBucket(n,l,m){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<l.symbolInstances.length;b++)l.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const v=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>n.overscaledZ)for(const P in T){const D=T[P];D.tileID.isChildOf(n)&&D.findMatches(l.symbolInstances,n,v)}else{const P=T[n.scaledTo(Number(b)).key];P&&P.findMatches(l.symbolInstances,n,v)}}for(let b=0;b<l.symbolInstances.length;b++){const T=l.symbolInstances.get(b);T.crossTileID||(T.crossTileID=m.generate(),v[T.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new ro(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const m in l.indexedSymbolInstances)for(const v of l.indexedSymbolInstances[m])delete this.usedCrossTileIDs[n][v.crossTileID]}removeStaleBuckets(n){let l=!1;for(const m in this.indexes){const v=this.indexes[m];for(const b in v)n[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[b]),delete v[b],l=!0)}return l}}class jo{constructor(){this.layerIndexes={},this.crossTileIDs=new $a,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,m,v){let b=this.layerIndexes[n.id];b===void 0&&(b=this.layerIndexes[n.id]=new Bt);let T=!1;const P={};v.name!=="globe"&&b.handleWrapJump(m);for(const D of l){const O=D.getBucket(n);O&&n.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(D.tileID,O,this.crossTileIDs)&&(T=!0),P[O.bucketInstanceId]=!0)}return b.removeStaleBuckets(P)&&(T=!0),T}pruneUnusedLayers(n){const l={};n.forEach(m=>{l[m]=!0});for(const m in this.layerIndexes)l[m]||delete this.layerIndexes[m]}}const zs=(p,n)=>o.emitValidationErrors(p,n&&n.filter(l=>l.identifier!=="source.canvas")),Tl=o.pick(et,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ui=o.pick(et,["setCenter","setZoom","setBearing","setPitch"]),hr=function(){const p={},n=o.spec.$version;for(const l in o.spec.$root){const m=o.spec.$root[l];if(m.required){let v=null;v=l==="version"?n:m.type==="array"?[]:{},v!=null&&(p[l]=v)}}return p}(),mu={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Br extends o.Evented{constructor(n,l={}){super(),this.map=n,this.dispatcher=new Fe(we(),this),this.imageManager=new $e,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(n._requestManager,l.localFontFamily?o.LocalGlyphMode.all:l.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new jo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const m=this;this._rtlTextPluginCallback=Br.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,T)=>{if(o.triggerPluginCompletionEvent(b),T&&T.every(P=>P))for(const P in m._sourceCaches){const D=m._sourceCaches[P],O=D.getSource().type;O!=="vector"&&O!=="geojson"||D.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const P=this._layers[T];P.source===b.id&&this._validateLayer(P)}})}loadURL(n,l={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const m=typeof l.validate=="boolean"?l.validate:!o.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,l.accessToken);const v=this.map._requestManager.transformRequest(n,o.ResourceType.Style);this._request=o.getJSON(v,(b,T)=>{this._request=null,b?this.fire(new o.ErrorEvent(b)):T&&this._load(T,m)})}loadJSON(n,l={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(n,l.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(hr,!1)}_updateLayerCount(n,l){const m=l?1:-1;n.is3D()&&(this._num3DLayers+=m),n.type==="circle"&&(this._numCircleLayers+=m),n.type==="symbol"&&(this._numSymbolLayers+=m)}_load(n,l){if(l&&zs(this,o.validateStyle(n)))return;this._loaded=!0,this.stylesheet=n,this.updateProjection();for(const v in n.sources)this.addSource(v,n.sources[v],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const m=We(this.stylesheet.layers);this._order=m.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of m)v=o.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new It(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const n=this.map.transform.projection,l=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),m=this.map.transform.projection;if(this._loaded&&(m.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),l){if(m.isReprojectedInTileSpace||n.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(n){this._spriteRequest=function(l,m,v){let b,T,P;const D=o.exported.devicePixelRatio>1?"@2x":"";let O=o.getJSON(m.transformRequest(m.normalizeSpriteURL(l,D,".json"),o.ResourceType.SpriteJSON),(q,Q)=>{O=null,P||(P=q,b=Q,U())}),B=o.getImage(m.transformRequest(m.normalizeSpriteURL(l,D,".png"),o.ResourceType.SpriteImage),(q,Q)=>{B=null,P||(P=q,T=Q,U())});function U(){if(P)v(P);else if(b&&T){const q=o.exported.getImageData(T),Q={};for(const K in b){const{width:te,height:_e,x:J,y:me,sdf:pe,pixelRatio:he,stretchX:fe,stretchY:ye,content:Le}=b[K],Ue=new o.RGBAImage({width:te,height:_e});o.RGBAImage.copy(q,Ue,{x:J,y:me},{x:0,y:0},{width:te,height:_e}),Q[K]={data:Ue,pixelRatio:he,sdf:pe,stretchX:fe,stretchY:ye,content:Le}}v(null,Q)}}return{cancel(){O&&(O.cancel(),O=null),B&&(B.cancel(),B=null)}}}(n,this.map._requestManager,(l,m)=>{if(this._spriteRequest=null,l)this.fire(new o.ErrorEvent(l));else if(m)for(const v in m)this.imageManager.addImage(v,m[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(n){const l=this.getSource(n.source);if(!l)return;const m=n.sourceLayer;m&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(m)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${l.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const l=[];for(const m of n){const v=this._layers[m];v.type!=="custom"&&l.push(v.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&mu[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const l=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const T in this._updatedSources){const P=this._updatedSources[T];P==="reload"?this._reloadSource(T):P==="clear"&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const m={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];m[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)){const P=this._getLayerSourceCache(b);P&&(P.used=!0)}const T=this.map.painter;if(T){const P=b.getProgramIds();if(!P)continue;const D=b.getProgramConfiguration(n.zoom);for(const O of P)T.useProgram(O,D)}}for(const v in m){const b=this._sourceCaches[v];m[v]!==b.used&&b.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),zs(this,o.validateStyle(n)))return!1;(n=o.clone$1(n)).layers=We(n.layers);const l=function(v,b){if(!v)return[{command:et.setStyle,args:[b]}];let T=[];try{if(!de(v.version,b.version))return[{command:et.setStyle,args:[b]}];de(v.center,b.center)||T.push({command:et.setCenter,args:[b.center]}),de(v.zoom,b.zoom)||T.push({command:et.setZoom,args:[b.zoom]}),de(v.bearing,b.bearing)||T.push({command:et.setBearing,args:[b.bearing]}),de(v.pitch,b.pitch)||T.push({command:et.setPitch,args:[b.pitch]}),de(v.sprite,b.sprite)||T.push({command:et.setSprite,args:[b.sprite]}),de(v.glyphs,b.glyphs)||T.push({command:et.setGlyphs,args:[b.glyphs]}),de(v.transition,b.transition)||T.push({command:et.setTransition,args:[b.transition]}),de(v.light,b.light)||T.push({command:et.setLight,args:[b.light]}),de(v.fog,b.fog)||T.push({command:et.setFog,args:[b.fog]}),de(v.projection,b.projection)||T.push({command:et.setProjection,args:[b.projection]});const P={},D=[];(function(U,q,Q,K){let te;for(te in q=q||{},U=U||{})U.hasOwnProperty(te)&&(q.hasOwnProperty(te)||Mt(te,Q,K));for(te in q)q.hasOwnProperty(te)&&(U.hasOwnProperty(te)?de(U[te],q[te])||(U[te].type==="geojson"&&q[te].type==="geojson"&&Lt(U,q,te)?Q.push({command:et.setGeoJSONSourceData,args:[te,q[te].data]}):At(te,q,Q,K)):it(te,q,Q))})(v.sources,b.sources,D,P);const O=[];v.layers&&v.layers.forEach(U=>{P[U.source]?T.push({command:et.removeLayer,args:[U.id]}):O.push(U)});let B=v.terrain;B&&P[B.source]&&(T.push({command:et.setTerrain,args:[void 0]}),B=void 0),T=T.concat(D),de(B,b.terrain)||T.push({command:et.setTerrain,args:[b.terrain]}),function(U,q,Q){q=q||[];const K=(U=U||[]).map(on),te=q.map(on),_e=U.reduce(jn,{}),J=q.reduce(jn,{}),me=K.slice(),pe=Object.create(null);let he,fe,ye,Le,Ue,ht,ot;for(he=0,fe=0;he<K.length;he++)ye=K[he],J.hasOwnProperty(ye)?fe++:(Q.push({command:et.removeLayer,args:[ye]}),me.splice(me.indexOf(ye,fe),1));for(he=0,fe=0;he<te.length;he++)ye=te[te.length-1-he],me[me.length-1-he]!==ye&&(_e.hasOwnProperty(ye)?(Q.push({command:et.removeLayer,args:[ye]}),me.splice(me.lastIndexOf(ye,me.length-fe),1)):fe++,ht=me[me.length-he],Q.push({command:et.addLayer,args:[J[ye],ht]}),me.splice(me.length-he,0,ye),pe[ye]=!0);for(he=0;he<te.length;he++)if(ye=te[he],Le=_e[ye],Ue=J[ye],!pe[ye]&&!de(Le,Ue))if(de(Le.source,Ue.source)&&de(Le["source-layer"],Ue["source-layer"])&&de(Le.type,Ue.type)){for(ot in Ut(Le.layout,Ue.layout,Q,ye,null,et.setLayoutProperty),Ut(Le.paint,Ue.paint,Q,ye,null,et.setPaintProperty),de(Le.filter,Ue.filter)||Q.push({command:et.setFilter,args:[ye,Ue.filter]}),de(Le.minzoom,Ue.minzoom)&&de(Le.maxzoom,Ue.maxzoom)||Q.push({command:et.setLayerZoomRange,args:[ye,Ue.minzoom,Ue.maxzoom]}),Le)Le.hasOwnProperty(ot)&&ot!=="layout"&&ot!=="paint"&&ot!=="filter"&&ot!=="metadata"&&ot!=="minzoom"&&ot!=="maxzoom"&&(ot.indexOf("paint.")===0?Ut(Le[ot],Ue[ot],Q,ye,ot.slice(6),et.setPaintProperty):de(Le[ot],Ue[ot])||Q.push({command:et.setLayerProperty,args:[ye,ot,Ue[ot]]}));for(ot in Ue)Ue.hasOwnProperty(ot)&&!Le.hasOwnProperty(ot)&&ot!=="layout"&&ot!=="paint"&&ot!=="filter"&&ot!=="metadata"&&ot!=="minzoom"&&ot!=="maxzoom"&&(ot.indexOf("paint.")===0?Ut(Le[ot],Ue[ot],Q,ye,ot.slice(6),et.setPaintProperty):de(Le[ot],Ue[ot])||Q.push({command:et.setLayerProperty,args:[ye,ot,Ue[ot]]}))}else Q.push({command:et.removeLayer,args:[ye]}),ht=me[me.lastIndexOf(ye)+1],Q.push({command:et.addLayer,args:[Ue,ht]})}(O,b.layers,T)}catch(P){console.warn("Unable to compute style diff:",P),T=[{command:et.setStyle,args:[b]}]}return T}(this.serialize(),n).filter(v=>!(v.command in ui));if(l.length===0)return!1;const m=l.filter(v=>!(v.command in Tl));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);return l.forEach(v=>{v.command!=="setTransition"&&this[v.command].apply(this,v.args)}),this.stylesheet=n,this.updateProjection(),!0}addImage(n,l){if(this.getImage(n))return this.fire(new o.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(n,l),this._afterImageUpdated(n)}updateImage(n,l){this.imageManager.updateImage(n,l)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new o.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,l,m={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(o.validateStyle.source,`sources.${n}`,l,null,m))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const v=si(n,l,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:v.serialize(),sourceId:n}));const b=T=>{const P=(T?"symbol:":"other:")+n,D=this._sourceCaches[P]=new o.SourceCache(P,v,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[n]=D,D.style=this,D.onAdd(this.map)};b(!1),l.type!=="vector"&&l.type!=="geojson"||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const l=this.getSource(n);if(l===void 0)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(n);for(const v of m)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,l){this._checkLoaded(),this.getSource(n).setData(l),this._changed=!0}getSource(n){const l=this._getSourceCache(n);return l&&l.getSource()}addLayer(n,l,m={}){this._checkLoaded();const v=n.id;if(this.getLayer(v))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if(n.type==="custom"){if(zs(this,o.validateCustomStyleLayer(n)))return;b=o.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(v,n.source),n=o.clone$1(n),n=o.extend(n,{source:v})),this._validate(o.validateStyle.layer,`layers.${v}`,n,{arrayIndex:-1},m))return;b=o.createStyleLayer(n),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const T=l?this._order.indexOf(l):this._order.length;if(l&&T===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(T,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const P=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&P&&b.type!=="custom"){const D=this._removedLayers[v];delete this._removedLayers[v],D.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",P.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,l){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===l)return;const m=this._order.indexOf(n);this._order.splice(m,1);const v=l?this._order.indexOf(l):this._order.length;l&&v===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(v,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const l=this._layers[n];if(!l)return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const m=this._order.indexOf(n);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=l,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const l in this._layers)if(this._layers[l].type===n)return!0;return!1}setLayerZoomRange(n,l,m){this._checkLoaded();const v=this.getLayer(n);v?v.minzoom===l&&v.maxzoom===m||(l!=null&&(v.minzoom=l),m!=null&&(v.maxzoom=m),this._updateLayer(v)):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,l,m={}){this._checkLoaded();const v=this.getLayer(n);if(v){if(!de(v.filter,l))return l==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(o.validateStyle.filter,`layers.${v.id}.filter`,l,{layerType:v.type},m)||(v.filter=o.clone$1(l),this._updateLayer(v)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){return o.clone$1(this.getLayer(n).filter)}setLayoutProperty(n,l,m,v={}){this._checkLoaded();const b=this.getLayer(n);b?de(b.getLayoutProperty(l),m)||(b.setLayoutProperty(l,m,v),this._updateLayer(b)):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,l){const m=this.getLayer(n);if(m)return m.getLayoutProperty(l);this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,l,m,v={}){this._checkLoaded();const b=this.getLayer(n);b?de(b.getPaintProperty(l),m)||(b.setPaintProperty(l,m,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,l){return this.getLayer(n).getPaintProperty(l)}setFeatureState(n,l){this._checkLoaded();const m=n.source,v=n.sourceLayer,b=this.getSource(m);if(b===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const T=b.type;if(T==="geojson"&&v)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!v)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const P=this._getSourceCaches(m);for(const D of P)D.setFeatureState(v,n.id,l)}removeFeatureState(n,l){this._checkLoaded();const m=n.source,v=this.getSource(m);if(v===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const b=v.type,T=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!T)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const P=this._getSourceCaches(m);for(const D of P)D.removeFeatureState(T,n.id,l)}getFeatureState(n){this._checkLoaded();const l=n.source,m=n.sourceLayer,v=this.getSource(l);if(v!==void 0){if(v.type!=="vector"||m)return n.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(m,n.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const l in this._sourceCaches){const m=this._sourceCaches[l].getSource();n[m.id]||(n[m.id]=m.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const l=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",l.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const l=T=>this._layers[T].type==="fill-extrusion",m={},v=[];for(let T=this._order.length-1;T>=0;T--){const P=this._order[T];if(l(P)){m[P]=T;for(const D of n){const O=D[P];if(O)for(const B of O)v.push(B)}}}v.sort((T,P)=>P.intersectionZ-T.intersectionZ);const b=[];for(let T=this._order.length-1;T>=0;T--){const P=this._order[T];if(l(P))for(let D=v.length-1;D>=0;D--){const O=v[D].feature;if(m[O.layer.id]<T)break;b.push(O),v.pop()}else for(const D of n){const O=D[P];if(O)for(const B of O)b.push(B.feature)}}return b}queryRenderedFeatures(n,l,m){l&&l.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",l.filter,null,l);const v={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const D of l.layers){const O=this._layers[D];if(!O)return this.fire(new o.ErrorEvent(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];v[O.source]=!0}}const b=[];l.availableImages=this._availableImages;const T=l&&l.layers?l.layers.some(D=>{const O=this.getLayer(D);return O&&O.is3D()}):this.has3DLayers(),P=us.createFromScreenPoints(n,m);for(const D in this._sourceCaches){const O=this._sourceCaches[D].getSource().id;l.layers&&!v[O]||b.push(F(this._sourceCaches[D],this._layers,this._serializedLayers,P,l,m,T,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(D,O,B,U,q,Q,K){const te={},_e=Q.queryRenderedSymbols(U),J=[];for(const me of Object.keys(_e).map(Number))J.push(K[me]);J.sort(re);for(const me of J){const pe=me.featureIndex.lookupSymbolFeatures(_e[me.bucketInstanceId],O,me.bucketIndex,me.sourceLayerIndex,q.filter,q.layers,q.availableImages,D);for(const he in pe){const fe=te[he]=te[he]||[],ye=pe[he];ye.sort((Le,Ue)=>{const ht=me.featureSortOrder;if(ht){const ot=ht.indexOf(Le.featureIndex);return ht.indexOf(Ue.featureIndex)-ot}return Ue.featureIndex-Le.featureIndex});for(const Le of ye)fe.push(Le)}}for(const me in te)te[me].forEach(pe=>{const he=pe.feature,fe=B(D[me]).getFeatureState(he.layer["source-layer"],he.id);he.source=he.layer.source,he.layer["source-layer"]&&(he.sourceLayer=he.layer["source-layer"]),he.state=fe});return te}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),P.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(n,l){l&&l.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",l.filter,null,l);const m=this._getSourceCaches(n);let v=[];for(const b of m)v=v.concat(Z(b,l));return v}addSourceType(n,l,m){return Br.getSourceType(n)?m(new Error(`A source type called "${n}" already exists.`)):(Br.setSourceType(n,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:l.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(n,l={}){this._checkLoaded();const m=this.light.getLight();let v=!1;for(const T in n)if(!de(n[T],m[T])){v=!0;break}if(!v)return;const b={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,l),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,l=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(l===1){if(typeof n.source=="object"){const m="terrain-dem-src";this.addSource(m,n.source),n=o.clone$1(n),n=o.extend(n,{source:m})}if(this._validate(o.validateStyle.terrain,"terrain",n))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(n,l);else{const m=this.terrain,v=m.get();for(const b in n)if(!de(n[b],v[b])){m.set(n),this.stylesheet.terrain=n;const T={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const l=this.fog=new Dr(n,this.map.transform);this.stylesheet.fog=n;const m={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,m=l.get();for(const v in n)if(!de(n[v],m[v])){l.set(n),this.stylesheet.fog=n;const b={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(b);break}}else this._createFog(n);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(m=>this.isLayerDraped(this._layers[m])),l=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...l)}_createTerrain(n,l){const m=this.terrain=new Yt(n,l);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const v={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(v)}_force3DLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="symbol"&&this._updateLayer(l)}}_validate(n,l,m,v,b={}){return(!b||b.validate!==!1)&&zs(this,n.call(o.validateStyle,o.extend({key:l,style:this.serialize(),value:m,styleSpec:o.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const l=this._getSourceCaches(n);for(const m of l)m.clearTiles()}_reloadSource(n){const l=this._getSourceCaches(n);for(const m of l)m.resume(),m.reload()}_updateSources(n){for(const l in this._sourceCaches)this._sourceCaches[l].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const l=this._sourceCaches[n];l.resume(),l.reload()}}_updatePlacement(n,l,m,v,b=!1){let T=!1,P=!1;const D={};for(const O of this._order){const B=this._layers[O];if(B.type!=="symbol")continue;if(!D[B.source]){const q=this._getLayerSourceCache(B);if(!q)continue;D[B.source]=q.getRenderableIds(!0).map(Q=>q.getTileByID(Q)).sort((Q,K)=>K.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(K.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(B,D[B.source],n.center.lng,n.projection);T=T||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),n.zoom))&&(this.pauseablePlacement=new xn(n,this._order,b,l,m,v,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),P=!0),T&&this.pauseablePlacement.placement.setStale()),P||T)for(const O of this._order){const B=this._layers[O];B.type==="symbol"&&this.placement.updateLayerOpacities(B,D[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,l,m){this.imageManager.getImages(l.icons,m),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(l.tileID.key,l.type,l.icons)};v(this._otherSourceCaches[l.source]),v(this._symbolSourceCaches[l.source])}getGlyphs(n,l,m){this.glyphManager.getGlyphs(l.stacks,m)}getResource(n,l,m){return o.makeRequest(l,m)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const l=[];return this._otherSourceCaches[n]&&l.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&l.push(this._symbolSourceCaches[n]),l}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Br.getSourceType=function(p){return cs[p]},Br.setSourceType=function(p,n){cs[p]=n},Br.registerForPluginStateChange=o.registerForPluginStateChange;var Za=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,ms="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Wi={},Ga={};Wi=sn("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),Ga=sn(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const In=sn(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}
#ifdef PROJECTION_GLOBE_VIEW
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),gu=Za;var fc={background:sn(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:sn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:sn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:sn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:sn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:sn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:sn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:sn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:sn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:sn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:sn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:sn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:sn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:sn(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:sn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:sn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:sn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:sn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:sn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:sn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:sn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:sn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:sn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:sn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:sn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:sn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ms),skyboxGradient:sn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ms),skyboxCapture:sn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:sn(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:sn(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function sn(p,n,l){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T=p.match(v),P=n.match(v),D=Za.match(v);let O=P?P.concat(T):T;l||(Wi.staticUniforms&&(O=Wi.staticUniforms.concat(O)),Ga.staticUniforms&&(O=Ga.staticUniforms.concat(O))),O&&(O=O.concat(D));const B={};return{fragmentSource:p=p.replace(m,(U,q,Q,K,te)=>(B[te]=!0,q==="define"?`
#ifndef HAS_UNIFORM_u_${te}
varying ${Q} ${K} ${te};
#else
uniform ${Q} ${K} u_${te};
#endif
`:`
#ifdef HAS_UNIFORM_u_${te}
    ${Q} ${K} ${te} = u_${te};
#endif
`)),vertexSource:n=n.replace(m,(U,q,Q,K,te)=>{const _e=K==="float"?"vec2":"vec4",J=te.match(/color/)?"color":_e;return B[te]?q==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${Q} ${_e} a_${te};
varying ${Q} ${K} ${te};
#else
uniform ${Q} ${K} u_${te};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = a_${te};
#else
    ${Q} ${K} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = unpack_mix_${J}(a_${te}, u_${te}_t);
#else
    ${Q} ${K} ${te} = u_${te};
#endif
`:q==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${Q} ${_e} a_${te};
#else
uniform ${Q} ${K} u_${te};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${Q} ${K} ${te} = a_${te};
#else
    ${Q} ${K} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${Q} ${K} ${te} = unpack_mix_${J}(a_${te}, u_${te}_t);
#else
    ${Q} ${K} ${te} = u_${te};
#endif
`}),staticAttributes:b,staticUniforms:O}}class wi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,l,m,v,b,T,P,D){this.context=n;let O=this.boundPaintVertexBuffers.length!==v.length;for(let B=0;!O&&B<v.length;B++)this.boundPaintVertexBuffers[B]!==v[B]&&(O=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===m&&!O&&this.boundIndexBuffer===b&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===D?(n.bindVertexArrayOES.set(this.vao),P&&P.bind(),b&&b.dynamicDraw&&b.bind(),D&&D.bind()):this.freshBind(l,m,v,b,T,P,D)}freshBind(n,l,m,v,b,T,P){let D;const O=n.numAttributes,B=this.context,U=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),D=0,this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=P;else{D=B.currentNumAttributes||0;for(let q=O;q<D;q++)U.disableVertexAttribArray(q)}l.enableAttributes(U,n);for(const q of m)q.enableAttributes(U,n);T&&T.enableAttributes(U,n),P&&P.enableAttributes(U,n),l.bind(),l.setVertexAttribPointers(U,n,b);for(const q of m)q.bind(),q.setVertexAttribPointers(U,n,b);T&&(T.bind(),T.setVertexAttribPointers(U,n,b)),v&&v.bind(),P&&(P.bind(),P.setVertexAttribPointers(U,n,b)),B.currentNumAttributes=O}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function fh(p,n){const l=Math.pow(2,n.canonical.z),m=n.canonical.y;return[new o.MercatorCoordinate(0,m/l).toLngLat().lat,new o.MercatorCoordinate(0,(m+1)/l).toLngLat().lat]}function _u(p,n,l,m,v,b,T){const P=p.context,D=P.gl,O=l.fbo;if(!O)return;p.prepareDrawTile(n);const B=p.useProgram("hillshade");P.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,O.colorAttachment.get());const U=((te,_e,J,me)=>{const pe=J.paint.get("hillshade-shadow-color"),he=J.paint.get("hillshade-highlight-color"),fe=J.paint.get("hillshade-accent-color");let ye=J.paint.get("hillshade-illumination-direction")*(Math.PI/180);J.paint.get("hillshade-illumination-anchor")==="viewport"&&(ye-=te.transform.angle);const Le=!te.options.moving;return{u_matrix:me||te.transform.calculateProjMatrix(_e.tileID.toUnwrapped(),Le),u_image:0,u_latrange:fh(0,_e.tileID),u_light:[J.paint.get("hillshade-exaggeration"),ye],u_shadow:pe,u_highlight:he,u_accent:fe}})(p,l,m,p.terrain?n.projMatrix:null);p.prepareDrawProgram(P,B,n.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:Q,tileBoundsSegments:K}=p.getTileBoundsBuffers(l);B.draw(P,D.TRIANGLES,v,b,T,o.CullFaceMode.disabled,U,m.id,q,Q,K)}function _r(p,n,l){if(!n.needsDEMTextureUpload)return;const m=p.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||p.getTileTexture(l.stride);const b=l.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new o.Texture(m,b,v.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function sa(p,n,l,m,v,b){const T=p.context,P=T.gl;if(!n.dem)return;const D=n.dem;if(T.activeTexture.set(P.TEXTURE1),_r(p,n,D),!n.demTexture)return;n.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);const O=D.dim;T.activeTexture.set(P.TEXTURE0);let B=n.fbo;if(!B){const K=new o.Texture(T,{width:O,height:O,data:null},P.RGBA);K.bind(P.LINEAR,P.CLAMP_TO_EDGE),B=n.fbo=T.createFramebuffer(O,O,!0),B.colorAttachment.set(K.texture)}T.bindFramebuffer.set(B.framebuffer),T.viewport.set([0,0,O,O]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:q,tileBoundsSegments:Q}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(T,P.TRIANGLES,m,v,b,o.CullFaceMode.disabled,((K,te)=>{const _e=te.stride,J=o.create();return o.ortho(J,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(J,J,[0,-o.EXTENT,0]),{u_matrix:J,u_image:1,u_dimension:[_e,_e],u_zoom:K.overscaledZ,u_unpack:te.unpackVector}})(n.tileID,D),l.id,U,q,Q),n.needsHillshadePrepare=!1}const Ei=(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_image0:new o.Uniform1i(p,n.u_image0),u_skirt_height:new o.Uniform1f(p,n.u_skirt_height)}),Ar=(p,n)=>({u_matrix:p,u_image0:0,u_skirt_height:n}),aa=(p,n,l,m,v)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:n,u_merc_matrix:l,u_zoom_transition:m,u_merc_center:v,u_image0:0});function Xi(p,n){return p!=null&&n!=null&&!(!p.hasData()||!n.hasData())&&p.demTexture!=null&&n.demTexture!=null&&p.tileID.key!==n.tileID.key}const Hi=new class{constructor(){this.operations={}}newMorphing(p,n,l,m,v){if(p in this.operations){const b=this.operations[p];b.to.tileID.key!==l.tileID.key&&(b.queued=l)}else this.operations[p]={startTime:m,phase:0,duration:v,from:n,to:l,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const n=this.operations[p];return{from:n.from,to:n.to,phase:n.phase}}update(p){for(const n in this.operations){const l=this.operations[n];for(l.phase=(p-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,p)){delete this.operations[n];break}}}_nextOp(p,n){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=n,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Vo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ph(p,n){const l=1<<p.z;return!n&&(p.x===0||p.x===l-1)||p.y===0||p.y===l-1}const wr=p=>({u_matrix:p});function la(p,n,l,m,v){if(v>0){const b=o.exported.now(),T=(b-p.timeAdded)/v,P=n?(b-n.timeAdded)/v:-1,D=l.getSource(),O=m.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),B=!n||Math.abs(n.tileID.overscaledZ-O)>Math.abs(p.tileID.overscaledZ-O),U=B&&p.refreshedUponExpiration?1:o.clamp(B?T:1-P,0,1);return p.refreshedUponExpiration&&T>=1&&(p.refreshedUponExpiration=!1),n?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class yu extends o.SourceCache{constructor(n){const l={type:"raster-dem",maxzoom:n.transform.maxZoom},m=new Fe(we(),null),v=si("mock-dem",l,m,n.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,l){n.state="loaded",l(null)}}class ei extends o.SourceCache{constructor(n){const l=si("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new Fe(we(),null),n.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,l,m){if(n.freezeTileCoverage)return;this.transform=n;const v=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const P=new o.Tile(T,this._source.tileSize*T.overscaleFactor(),n.tileZoom);P.state="loaded",this._tiles[T.key]=P}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const l=this.proxyCachedFBO[n];if(l!==void 0){const m=Object.values(l);this.renderCachePool.push(...m),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Sl extends o.OverscaledTileID{constructor(n,l,m){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=l,this.projMatrix=m}}class $o extends o.Elevation{constructor(n,l){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,v,b]=function(D){const O=new o.StructArrayLayout4i8,B=new o.StructArrayLayout3ui6,U=131;O.reserve(17161),B.reserve(33800);const q=o.EXTENT/128,Q=o.EXTENT+q/2,K=Q+q;for(let _e=-q;_e<K;_e+=q)for(let J=-q;J<K;J+=q){const me=J<0||J>Q||_e<0||_e>Q?24575:0,pe=o.clamp(Math.round(J),0,o.EXTENT),he=o.clamp(Math.round(_e),0,o.EXTENT);O.emplaceBack(pe+me,he,pe,he)}const te=(_e,J)=>{const me=J*U+_e;B.emplaceBack(me+1,me,me+U),B.emplaceBack(me+U,me+U+1,me+1)};for(let _e=1;_e<129;_e++)for(let J=1;J<129;J++)te(J,_e);return[0,129].forEach(_e=>{for(let J=0;J<130;J++)te(J,_e),te(_e,J)}),[O,B,32768]}(),T=n.context;this.gridBuffer=T.createVertexBuffer(m,o.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(v),this.gridSegments=o.SegmentVector.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,m.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ei(l.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);const P=T.gl;this._overlapStencilMode=new o.StencilMode({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new yu(l.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,l,m){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const v=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(l,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),l.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=l.getIds().map(D=>{const O=l.getTileByID(D).tileID;return O.projMatrix=m.calculateProjMatrix(O.toUnwrapped()),O});(function(D,O){const B=O.transform.pointCoordinate(O.transform.getCameraPoint()),U=new o.pointGeometry(B.x,B.y);D.sort((q,Q)=>{if(Q.overscaledZ-q.overscaledZ)return Q.overscaledZ-q.overscaledZ;const K=new o.pointGeometry(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),te=new o.pointGeometry(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),_e=U.mult(1<<q.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(K)-_e.distSqr(te)})})(v,this.painter),this._previousZoom=m.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const D in T){const O=T[D];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,n[D],b),O.usedForTerrain))continue;const B=n[D];O.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[l.id]=v.map(D=>new Sl(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const P={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const O=this.terrainTileForTile[D.key];if(!O)continue;const B=O.tileID.key;B in P||(this._visibleDemTiles.push(O),P[B]=B)}}_assignTerrainTiles(n){this._initializing||n.forEach(l=>{if(this.terrainTileForTile[l.key])return;const m=this._findTileCoveringTileID(l,this.sourceCache);m&&(this.terrainTileForTile[l.key]=m)})}_prepareDEMTextures(){const n=this.painter.context,l=n.gl;for(const m in this.terrainTileForTile){const v=this.terrainTileForTile[m],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(n.activeTexture.set(l.TEXTURE1),_r(this.painter,v,b))}}_prepareDemTileUniforms(n,l,m,v){if(!l||l.demTexture==null)return!1;const b=n.tileID.canonical,T=Math.pow(2,l.tileID.canonical.z-b.z),P=v||"";return m[`u_dem_tl${P}`]=[b.x*T%1,b.y*T%1],m[`u_dem_scale${P}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,l=n.gl;if(!this._emptyDepthBufferTexture){const m={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new o.Texture(n,m,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const l=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;const b=v.dem.tree.minimums[0];return b>0&&n++,m+b},0);return n?l/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,l=n.gl;n.activeTexture.set(l.TEXTURE2);const m=this._getLoadedAreaMinimum(),v={width:1,height:1,data:new Uint8Array(o.DEMData.pack(m,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new o.Texture(n,v,l.RGBA,{premultiply:!1}),b}setupElevationDraw(n,l,m){const v=this.painter.context,b=v.gl,T=(P=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(P),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var P;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();const D=this.painter.transform,O=D.projection.createTileTransform(D,D.worldSize),B=n.tileID.canonical;T.u_tile_tl_up=O.upVector(B,0,0),T.u_tile_tr_up=O.upVector(B,o.EXTENT,0),T.u_tile_br_up=O.upVector(B,o.EXTENT,o.EXTENT),T.u_tile_bl_up=O.upVector(B,0,o.EXTENT),T.u_tile_up_scale=O.upVectorScale(B);let U=null,q=null,Q=1;if(m&&m.morphing&&this._useVertexMorphing){const K=m.morphing.srcDemTile,te=m.morphing.dstDemTile;Q=m.morphing.phase,K&&te&&(this._prepareDemTileUniforms(n,K,T,"_prev")&&(q=K),this._prepareDemTileUniforms(n,te,T)&&(U=te))}if(q&&U?(v.activeTexture.set(b.TEXTURE2),U.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),q.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),T.u_dem_lerp=Q):(U=this.terrainTileForTile[n.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(n,U,T)?U.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&U){const K=(1<<U.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=K}m&&m.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),l.setTerrainUniformValues(v,T)}renderToBackBuffer(n){const l=this.painter,m=this.painter.context;n.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),this.renderingToTexture=!1,function(v,b,T,P,D){if(v.transform.projection.name==="globe")(function(O,B,U,q,Q){const K=O.context,te=K.gl;let _e,J;const me=O.options.showTerrainWireframe?2:0,pe=(nt,qe)=>{if(J===nt)return;const Ne=[];qe&&Ne.push(Vo[me]),Ne.push(Vo[nt]),Ne.push("PROJECTION_GLOBE_VIEW"),_e=O.useProgram("globeRaster",null,Ne),J=nt},he=O.colorModeForRenderPass(),fe=new o.DepthMode(te.LEQUAL,o.DepthMode.ReadWrite,O.depthRangeFor3D);Hi.update(Q);const ye=O.transform,Le=o.calculateGlobeMatrix(ye,ye.worldSize),Ue=o.calculateGlobeMercatorMatrix(ye),ht=[o.mercatorXfromLng(ye.center.lng),o.mercatorYfromLat(ye.center.lat)],ot=O.globeSharedBuffers;(me?[!1,!0]:[!1]).forEach(nt=>{J=-1;const qe=nt?te.LINES:te.TRIANGLES;for(const Ne of q){const tt=U.getTile(Ne),Ye=Math.pow(2,Ne.canonical.z),[Rt,Gt]=o.globeBuffersForTileMesh(O,tt,Ne,Ye),ln=o.StencilMode.disabled,ft=B.prevTerrainTileForTile[Ne.key],Ft=B.terrainTileForTile[Ne.key];Xi(ft,Ft)&&Hi.newMorphing(Ne.key,ft,Ft,Q,250),K.activeTexture.set(te.TEXTURE0),tt.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);const Kt=Hi.getMorphValuesForProxy(Ne.key),zn=Kt?1:0,Wn={};Kt&&o.extend$1(Wn,{morphing:{srcDemTile:Kt.from,dstDemTile:Kt.to,phase:o.easeCubicInOut(Kt.phase)}});const Xt=o.globeMatrixForTile(Ne.canonical,Le),gn=aa(ye.projMatrix,Xt,Ue,o.globeToMercatorTransition(ye.zoom),ht);if(pe(zn,nt),B.setupElevationDraw(tt,_e,Wn),O.prepareDrawProgram(K,_e,Ne.toUnwrapped()),ot){const[Xn,Jn]=nt?ot.getWirefameBuffer(O.context):[ot.gridIndexBuffer,ot.gridSegments];_e.draw(K,qe,fe,ln,he,o.CullFaceMode.backCCW,gn,"globe_raster",Rt,Xn,Jn)}if(!nt){const Xn=[Ne.canonical.y===0?o.globePoleMatrixForTile(Ne.canonical,!1,ye):null,Ne.canonical.y===Ye-1?o.globePoleMatrixForTile(Ne.canonical,!0,ye):null];for(const Jn of Xn){if(!Jn)continue;const Hr=aa(ye.projMatrix,Jn,Jn,0,ht);ot&&_e.draw(K,qe,fe,ln,he,o.CullFaceMode.disabled,Hr,"globe_pole_raster",Gt,ot.poleIndexBuffer,ot.poleSegments)}}}})})(v,b,T,P,D);else{const O=v.context,B=O.gl;let U,q;const Q=v.options.showTerrainWireframe?2:0,K=(pe,he)=>{if(q===pe)return;const fe=[Vo[pe]];he&&fe.push(Vo[Q]),U=v.useProgram("terrainRaster",null,fe),q=pe},te=v.colorModeForRenderPass(),_e=new o.DepthMode(B.LEQUAL,o.DepthMode.ReadWrite,v.depthRangeFor3D);Hi.update(D);const J=v.transform,me=6*Math.pow(1.5,22-J.zoom)*b.exaggeration();(Q?[!1,!0]:[!1]).forEach(pe=>{q=-1;const he=pe?B.LINES:B.TRIANGLES,[fe,ye]=pe?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const Le of P){const Ue=T.getTile(Le),ht=o.StencilMode.disabled,ot=b.prevTerrainTileForTile[Le.key],nt=b.terrainTileForTile[Le.key];Xi(ot,nt)&&Hi.newMorphing(Le.key,ot,nt,D,250),O.activeTexture.set(B.TEXTURE0),Ue.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST);const qe=Hi.getMorphValuesForProxy(Le.key),Ne=qe?1:0;let tt;qe&&(tt={morphing:{srcDemTile:qe.from,dstDemTile:qe.to,phase:o.easeCubicInOut(qe.phase)}});const Ye=Ar(Le.projMatrix,ph(Le.canonical,J.renderWorldCopies)?me/10:me);K(Ne,pe),b.setupElevationDraw(Ue,U,tt),v.prepareDrawProgram(O,U,Le.toUnwrapped()),U.draw(O,he,_e,ht,te,o.CullFaceMode.backCCW,Ye,"terrain_raster",b.gridBuffer,fe,ye)}})}}(l,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const l=this.painter,m=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],T=this._drapedRenderBatches.shift(),P=[],D=l.style.order;let O=0;for(const B of b){const U=v.getTileByID(B.proxyTileKey),q=v.proxyCachedFBO[B.key]?v.proxyCachedFBO[B.key][n]:void 0,Q=q!==void 0?v.renderCache[q]:this.pool[O++],K=q!==void 0;if(U.texture=Q.tex,K&&!Q.dirty){P.push(U.tileID);continue}let te;m.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(m.clear({color:o.Color.transparent,stencil:0}),Q.dirty=!1);for(let _e=T.start;_e<=T.end;++_e){const J=l.style._layers[D[_e]];if(J.isHidden(l.transform.zoom))continue;const me=l.style._getLayerSourceCache(J),pe=me?this.proxyToSource[B.key][me.id]:[B];if(!pe)continue;const he=pe;m.viewport.set([0,0,Q.fb.width,Q.fb.height]),te!==(me?me.id:null)&&(this._setupStencil(Q,pe,J,me),te=me?me.id:null),l.renderLayer(l,me,J,he)}this.renderedToTile?(Q.dirty=!0,P.push(U.tileID)):K||--O,O===5&&(O=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),T.end+1}postRender(){}renderCacheEfficiency(n){const l=n.order.length;if(l===0)return{efficiency:100};let m,v=0,b=0,T=!1;for(let P=0;P<l;++P){const D=n._layers[n.order[P]];this._style.isLayerDraped(D)?(T&&++v,++b):T||(T=!0,m=D.id)}return b===0?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{n=Math.min(n,l.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,l,m){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,P=Math.pow(2,T.overscaledZ),{x:D,y:O}=T.canonical,B=D/P,U=(D+1)/P,q=O/P,Q=(O+1)/P;return{minx:B,miny:q,maxx:U,maxy:Q,t:b.dem.tree.raycastRoot(B,q,U,Q,n,l,m),tile:b}});v.sort((b,T)=>(b.t!==null?b.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const b of v){if(b.t==null)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,l,m);if(T!=null)return T}return null}_createFBO(){const n=this.painter.context,l=n.gl,m=this.drapeBufferSize;n.activeTexture.set(l.TEXTURE0);const v=new o.Texture(n,{width:m[0],height:m[1],data:null},l.RGBA);v.bind(l.LINEAR,l.CLAMP_TO_EDGE);const b=n.createFramebuffer(m[0],m[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new Uo(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const l=this._style._layers[n],m=l.isHidden(this.painter.transform.zoom),v=l.getCrossfadeParameters(),b=!!v&&v.t!==1,T=l.hasTransition();return l.type!=="custom"&&!m&&(b||T)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof $i){n=!0;break}if(n)for(let l=0;l<this._style.order.length;++l){const m=this._style._layers[this._style.order[l]],v=m.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(m);if(m.type!=="raster"||v||!b)continue;const T=m.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const D=this.proxyToSource[P.key][b.id];if(D)for(const O of D){const B=la(b.getTile(O),b.findLoadedParent(O,0),b,this.painter.transform,T);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(b.id,O)}}}}_setupDrapedRenderBatches(){const n=this._style.order,l=n.length;if(l===0)return;const m=[];let v,b=0,T=this._style._layers[n[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<l;)T=this._style._layers[n[b]];for(;b<l;++b){const P=this._style._layers[n[b]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?v===void 0&&(v=b):v!==void 0&&(m.push({start:v,end:b-1}),v=void 0))}v!==void 0&&m.push({start:v,end:b-1}),this._drapedRenderBatches=m}_setupRenderCache(n){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const T=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let P=0;P<T.length;++P){const D=Object.values(T[P]);l.renderCachePool.push(...D)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,v=this._tilesDirty;for(let T=m.length-1;T>=0;T--){const P=m[T];if(l.getTileByID(P.key),l.proxyCachedFBO[P.key]!==void 0){const D=n[P.key],O=this.proxyToSource[P.key];let B=0;for(const U in O){const q=O[U],Q=D[U];if(!Q||Q.length!==q.length||q.some((K,te)=>K!==Q[te]||v[U]&&v[U].hasOwnProperty(K.key))){B=-1;break}++B}for(const U in l.proxyCachedFBO[P.key])l.renderCache[l.proxyCachedFBO[P.key][U]].dirty=B<0||B!==Object.values(D).length}}const b=[...this._drapedRenderBatches];b.sort((T,P)=>P.end-P.start-(T.end-T.start));for(const T of b)for(const P of m){if(l.proxyCachedFBO[P.key])continue;let D=l.renderCachePool.pop();D===void 0&&l.renderCache.length<50&&(D=l.renderCache.length,l.renderCache.push(this._createFBO())),D!==void 0&&(l.proxyCachedFBO[P.key]={},l.proxyCachedFBO[P.key][T.start]=D,l.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(n,l,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let P;if(m.isTileClipped())P=l.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(n,l){const m=this.painter,v=this.painter.context,b=v.gl;m._tileClippingMaskIDs={},v.setColorMode(o.ColorMode.disabled),v.setDepthMode(o.DepthMode.disabled);const T=m.useProgram("clippingMask");for(const P of n){const D=m._tileClippingMaskIDs[P.key]=--l;T.draw(v,b.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:b.ALWAYS,mask:0},D,255,b.KEEP,b.KEEP,b.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,wr(P.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(n){const l=this.painter.transform;if(n.x<0||n.x>l.width||n.y<0||n.y>l.height)return null;const m=[n.x,n.y,1,1];o.transformMat4$1(m,m,l.pixelMatrixInverse),o.scale$1(m,m,1/m[3]),m[0]/=l.worldSize,m[1]/=l.worldSize;const v=l._camera.position,b=o.mercatorZfromAltitude(1,l.center.lat),T=[v[0],v[1],v[2]/b,0],P=o.subtract([],m.slice(0,3),T);o.normalize(P,P);const D=this.raycast(T,P,this._exaggeration);return D!==null&&D?(o.scaleAndAdd(T,T,P,D),T[3]=T[2],T[2]*=b,T):null}drawDepth(){const n=this.painter,l=n.context,m=this.proxySourceCache,v=Math.ceil(n.width),b=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const T=l.gl,P=l.createFramebuffer(v,b,!0);l.activeTexture.set(T.TEXTURE0);const D=new o.Texture(l,{width:v,height:b,data:null},T.RGBA);D.bind(T.NEAREST,T.CLAMP_TO_EDGE),P.colorAttachment.set(D.texture);const O=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,v,b);P.depthAttachment.set(O),this._depthFBO=P,this._depthTexture=D}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,v,b]),function(T,P,D,O){if(T.transform.projection.name==="globe")return;const B=T.context,U=B.gl;B.clear({depth:1});const q=T.useProgram("terrainDepth"),Q=new o.DepthMode(U.LESS,o.DepthMode.ReadWrite,T.depthRangeFor3D);for(const K of O){const te=D.getTile(K),_e=Ar(K.projMatrix,0);P.setupElevationDraw(te,q),q.draw(B,U.TRIANGLES,Q,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,_e,"terrain_depth",P.gridBuffer,P.gridIndexBuffer,P.gridNoSkirtSegments)}}(n,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,l,m){if(n.getSource()instanceof Rr)return this._setupProxiedCoordsForImageSource(n,l,m);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const v=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let P=0;P<b.length;P++){const D=b[P],O=this._findTileCoveringTileID(D,n);if(O){const B=this._createProxiedId(D,O,m[D.key]&&m[D.key][n.id]);v.push(B),this.proxyToSource[D.key][n.id]=[B]}}let T=!1;for(let P=0;P<l.length;P++){const D=n.getTile(l[P]);if(!D||!D.hasData())continue;const O=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==D.tileID.canonical.z){const B=this.proxyToSource[O.tileID.key][n.id],U=this._createProxiedId(O.tileID,D,m[O.tileID.key]&&m[O.tileID.key][n.id]);B?B.splice(B.length-1,0,U):this.proxyToSource[O.tileID.key][n.id]=[U],v.push(U),T=!0}}this._sourceTilesOverlap[n.id]=T}_setupProxiedCoordsForImageSource(n,l,m){if(!n.getSource().loaded())return;const v=this.proxiedCoords[n.id]=[],b=this.proxyCoords,T=n.getSource(),P=new o.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),D=T.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((B,U)=>(B.min.x=Math.min(B.min.x,U.x-P.x),B.min.y=Math.min(B.min.y,U.y-P.y),B.max.x=Math.max(B.max.x,U.x-P.x),B.max.y=Math.max(B.max.y,U.y-P.y),B),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(B,U)=>{const q=B.wrap+B.canonical.x/(1<<B.canonical.z),Q=B.canonical.y/(1<<B.canonical.z),K=o.EXTENT/(1<<B.canonical.z),te=U.wrap+U.canonical.x/(1<<U.canonical.z),_e=U.canonical.y/(1<<U.canonical.z);return q+K<te+D.min.x||q>te+D.max.x||Q+K<_e+D.min.y||Q>_e+D.max.y};for(let B=0;B<b.length;B++){const U=b[B];for(let q=0;q<l.length;q++){const Q=n.getTile(l[q]);if(!Q||!Q.hasData()||O(U,Q.tileID))continue;const K=this._createProxiedId(U,Q,m[U.key]&&m[U.key][n.id]),te=this.proxyToSource[U.key][n.id];te?te.push(K):this.proxyToSource[U.key][n.id]=[K],v.push(K)}}}_createProxiedId(n,l,m){let v=this.orthoMatrix;if(m){const b=m.find(T=>T.key===l.tileID.key);if(b)return b}if(l.tileID.key!==n.key){const b=n.canonical.z-l.tileID.canonical.z;let T,P,D;v=o.create();const O=l.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(T=o.EXTENT>>b,P=T*((l.tileID.canonical.x<<b)-n.canonical.x+O),D=T*((l.tileID.canonical.y<<b)-n.canonical.y)):(T=o.EXTENT<<-b,P=o.EXTENT*(l.tileID.canonical.x-(n.canonical.x+O<<-b)),D=o.EXTENT*(l.tileID.canonical.y-(n.canonical.y<<-b))),o.ortho(v,0,T,0,T,0,1),o.translate(v,v,[P,D,0])}return new Sl(l.tileID,n.key,v)}_findTileCoveringTileID(n,l){let m=l.getTile(n);if(m&&m.hasData())return m;const v=this._findCoveringTileCache[l.id],b=v[n.key];if(m=b?l.getTileByID(b):null,m&&m.hasData()||b===null)return m;let T=m?m.tileID:n,P=T.overscaledZ;const D=l.getSource().minzoom,O=[];if(!b){const U=l.getSource().maxzoom;if(n.canonical.z>=U){const q=n.canonical.z-U;l.getSource().reparseOverscaled?(P=Math.max(n.canonical.z+2,l.transform.tileZoom),T=new o.OverscaledTileID(P,n.wrap,U,n.canonical.x>>q,n.canonical.y>>q)):q!==0&&(P=U,T=new o.OverscaledTileID(P,n.wrap,U,n.canonical.x>>q,n.canonical.y>>q))}T.key!==n.key&&(O.push(T.key),m=l.getTile(T))}const B=U=>{O.forEach(q=>{v[q]=U}),O.length=0};for(P-=1;P>=D&&(!m||!m.hasData());P--){m&&B(m.tileID.key);const U=T.calculateScaledKey(P);if(m=l.getTileByID(U),m&&m.hasData())break;const q=v[U];if(q===null)break;q===void 0?O.push(U):m=l.getTileByID(q)}return B(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(n){this.renderedToTile=!0}_clearRenderCacheForTile(n,l){let m=this._tilesDirty[n];m||(m=this._tilesDirty[n]={}),m[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(l){let m,v,b;const T=new o.StructArrayLayout2ui4,P=131;for(v=1;v<129;v++){for(m=1;m<129;m++)b=v*P+m,T.emplaceBack(b,b+1),T.emplaceBack(b,b+P),T.emplaceBack(b+1,b+P),v===128&&T.emplaceBack(b+P,b+P+1);T.emplaceBack(b+1,b+1+P)}return T}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function qa(p){const n=[];for(let l=0;l<p.length;l++){if(p[l]===null)continue;const m=p[l].split(" ");n.push(m.pop())}return n}class gs{static cacheKey(n,l,m){let v=`${n}${m?m.cacheKey:""}`;for(const b of l)v+=`/${b}`;return v}constructor(n,l,m,v,b,T){const P=n.gl;this.program=P.createProgram();const D=qa(m.staticAttributes),O=v?v.getBinderAttributes():[],B=D.concat(O),U=m.staticUniforms?qa(m.staticUniforms):[],q=v?v.getBinderUniforms():[],Q=U.concat(q),K=[];for(const fe of Q)K.indexOf(fe)<0&&K.push(fe);let te=v?v.defines():[];te=te.concat(T.map(fe=>`#define ${fe}`));const _e=te.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,gu,In.fragmentSource,Ga.fragmentSource,m.fragmentSource).join(`
`),J=te.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,gu,In.vertexSource,Ga.vertexSource,Wi.vertexSource,m.vertexSource).join(`
`),me=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(me,_e),P.compileShader(me),P.attachShader(this.program,me);const pe=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(pe,J),P.compileShader(pe),P.attachShader(this.program,pe),this.attributes={};const he={};this.numAttributes=B.length;for(let fe=0;fe<this.numAttributes;fe++)B[fe]&&(P.bindAttribLocation(this.program,fe,B[fe]),this.attributes[B[fe]]=fe);P.linkProgram(this.program),P.deleteShader(pe),P.deleteShader(me);for(let fe=0;fe<K.length;fe++){const ye=K[fe];if(ye&&!he[ye]){const Le=P.getUniformLocation(this.program,ye);Le&&(he[ye]=Le)}}this.fixedUniforms=b(n,he),this.binderUniforms=v?v.getUniforms(n,he):[],T.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((fe,ye)=>({u_dem:new o.Uniform1i(fe,ye.u_dem),u_dem_prev:new o.Uniform1i(fe,ye.u_dem_prev),u_dem_unpack:new o.Uniform4f(fe,ye.u_dem_unpack),u_dem_tl:new o.Uniform2f(fe,ye.u_dem_tl),u_dem_scale:new o.Uniform1f(fe,ye.u_dem_scale),u_dem_tl_prev:new o.Uniform2f(fe,ye.u_dem_tl_prev),u_dem_scale_prev:new o.Uniform1f(fe,ye.u_dem_scale_prev),u_dem_size:new o.Uniform1f(fe,ye.u_dem_size),u_dem_lerp:new o.Uniform1f(fe,ye.u_dem_lerp),u_exaggeration:new o.Uniform1f(fe,ye.u_exaggeration),u_depth:new o.Uniform1i(fe,ye.u_depth),u_depth_size_inv:new o.Uniform2f(fe,ye.u_depth_size_inv),u_meter_to_dem:new o.Uniform1f(fe,ye.u_meter_to_dem),u_label_plane_matrix_inv:new o.UniformMatrix4f(fe,ye.u_label_plane_matrix_inv),u_tile_tl_up:new o.Uniform3f(fe,ye.u_tile_tl_up),u_tile_tr_up:new o.Uniform3f(fe,ye.u_tile_tr_up),u_tile_br_up:new o.Uniform3f(fe,ye.u_tile_br_up),u_tile_bl_up:new o.Uniform3f(fe,ye.u_tile_bl_up),u_tile_up_scale:new o.Uniform1f(fe,ye.u_tile_up_scale)}))(n,he)),T.indexOf("FOG")!==-1&&(this.fogUniforms=((fe,ye)=>({u_fog_matrix:new o.UniformMatrix4f(fe,ye.u_fog_matrix),u_fog_range:new o.Uniform2f(fe,ye.u_fog_range),u_fog_color:new o.Uniform4f(fe,ye.u_fog_color),u_fog_horizon_blend:new o.Uniform1f(fe,ye.u_fog_horizon_blend),u_fog_temporal_offset:new o.Uniform1f(fe,ye.u_fog_temporal_offset)}))(n,he))}setTerrainUniformValues(n,l){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in l)m[v].set(l[v])}}setFogUniformValues(n,l){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in l)m[v].location&&m[v].set(l[v])}}draw(n,l,m,v,b,T,P,D,O,B,U,q,Q,K,te,_e){const J=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(m),n.setStencilMode(v),n.setColorMode(b),n.setCullFace(T);for(const pe of Object.keys(this.fixedUniforms))this.fixedUniforms[pe].set(P[pe]);K&&K.setUniforms(n,this.binderUniforms,q,{zoom:Q});const me={[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[l];for(const pe of U.get()){const he=pe.vaos||(pe.vaos={});(he[D]||(he[D]=new wi)).bind(n,this,O,K?K.getPaintVertexBuffers():[],B,pe.vertexOffset,te,_e),J.drawElements(l,pe.primitiveLength*me,J.UNSIGNED_SHORT,pe.primitiveOffset*me*2)}}}function Ml(p,n,l){const m=1/gt(l,1,n.transform.tileZoom),v=Math.pow(2,l.tileID.overscaledZ),b=l.tileSize*Math.pow(2,n.transform.tileZoom)/v,T=b*(l.tileID.canonical.x+l.tileID.wrap*v),P=b*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[m,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[T>>16,P>>16],u_pixel_coord_lower:[65535&T,65535&P]}}const pc=(p,n,l,m)=>{const v=n.style.light,b=v.properties.get("position"),T=[b.x,b.y,b.z],P=o.create$1();v.properties.get("anchor")==="viewport"&&(o.fromRotation(P,-n.transform.angle),o.transformMat3(T,T,P));const D=v.properties.get("color");return{u_matrix:p,u_lightpos:T,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+l,u_opacity:m}},mc=(p,n,l,m,v,b,T)=>o.extend(pc(p,n,l,m),Ml(b,n,T),{u_height_factor:-Math.pow(2,v.overscaledZ)/T.tileSize/8}),mh=p=>({u_matrix:p}),gc=(p,n,l,m)=>o.extend(mh(p),Ml(l,n,m)),_c=(p,n)=>({u_matrix:p,u_world:n}),gh=(p,n,l,m,v)=>o.extend(gc(p,n,l,m),{u_world:v}),yd=(p,n,l,m)=>{const v=p.transform;let b;return b=m.paint.get("circle-pitch-alignment")==="map"?v.calculatePixelsToTileUnitsMatrix(l):new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]),{u_camera_to_center_distance:v.cameraToCenterDistance,u_matrix:p.translatePosMatrix(n.projMatrix,l,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:b}},yc=p=>{const n=[];return p.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),p.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},_h=(p,n,l)=>{const m=o.EXTENT/l.tileSize;return{u_matrix:p,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/m,n.pixelsToGLUnits[1]/m]}},vc=(p,n,l=1)=>({u_matrix:p,u_color:n,u_overlay:0,u_overlay_scale:l}),xc=(p,n,l,m)=>({u_matrix:p,u_extrude_scale:gt(n,1,l),u_intensity:m}),yh=(p,n,l,m,v,b)=>{const T=p.transform,P=T.calculatePixelsToTileUnitsMatrix(n),D={u_matrix:Cl(p,n,l,v),u_pixels_to_tile_units:P,u_device_pixel_ratio:o.exported.devicePixelRatio,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(ca(l)){const O=Wa(n,p.transform);D.u_texsize=n.lineAtlasTexture.size,D.u_scale=[O,m.fromScale,m.toScale],D.u_mix=m.t}return D},ua=(p,n,l,m,v)=>{const b=p.transform,T=Wa(n,b);return{u_matrix:Cl(p,n,l,v),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:o.exported.devicePixelRatio,u_image:0,u_scale:[T,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Wa(p,n){return 1/gt(p,1,n.tileZoom)}function Cl(p,n,l,m){return p.translatePosMatrix(m||n.tileID.projMatrix,n,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function ca(p){const n=p.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const vu=(p,n,l,m,v,b)=>{return{u_matrix:p,u_tl_parent:n,u_scale_parent:l,u_fade_t:m.mix,u_opacity:m.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(P=v.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(T=v.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:xu(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var T,P};function xu(p){p*=Math.PI/180;const n=Math.sin(p),l=Math.cos(p);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const bu=(p,n,l,m,v,b,T,P,D,O,B,U,q,Q)=>{const K=v.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:K.cameraToCenterDistance,u_pitch:K.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:K.width/K.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:P,u_is_text:+D,u_pitch_with_map:+m,u_texsize:O,u_tile_id:B,u_zoom_transition:U,u_inv_rot_matrix:q,u_merc_center:Q,u_texture:0}},Xa=(p,n,l,m,v,b,T,P,D,O,B,U,q,Q,K)=>{const{cameraToCenterDistance:te,_pitch:_e}=v.transform;return o.extend(bu(p,n,l,m,v,b,T,P,D,O,U,q,Q,K),{u_gamma_scale:m?te*Math.cos(v.terrain?0:_e):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:1})},Pl=(p,n,l,m,v,b,T,P,D,O,B,U,q,Q)=>o.extend(Xa(p,n,l,m,v,b,T,P,!0,D,!0,B,U,q,Q),{u_texsize_icon:O,u_texture_icon:1}),Nn=(p,n,l)=>({u_matrix:p,u_opacity:n,u_color:l}),wu=(p,n,l,m,v,b)=>o.extend(function(T,P,D,O){const B=D.imageManager.getPattern(T.from.toString()),U=D.imageManager.getPattern(T.to.toString()),{width:q,height:Q}=D.imageManager.getPixelSize(),K=Math.pow(2,O.tileID.overscaledZ),te=O.tileSize*Math.pow(2,D.transform.tileZoom)/K,_e=te*(O.tileID.canonical.x+O.tileID.wrap*K),J=te*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[q,Q],u_mix:P.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/gt(O,1,D.transform.tileZoom),u_pixel_coord_upper:[_e>>16,J>>16],u_pixel_coord_lower:[65535&_e,65535&J]}}(m,b,l,v),{u_matrix:p,u_opacity:n}),vh={fillExtrusion:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_lightpos:new o.Uniform3f(p,n.u_lightpos),u_lightintensity:new o.Uniform1f(p,n.u_lightintensity),u_lightcolor:new o.Uniform3f(p,n.u_lightcolor),u_vertical_gradient:new o.Uniform1f(p,n.u_vertical_gradient),u_opacity:new o.Uniform1f(p,n.u_opacity)}),fillExtrusionPattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_lightpos:new o.Uniform3f(p,n.u_lightpos),u_lightintensity:new o.Uniform1f(p,n.u_lightintensity),u_lightcolor:new o.Uniform3f(p,n.u_lightcolor),u_vertical_gradient:new o.Uniform1f(p,n.u_vertical_gradient),u_height_factor:new o.Uniform1f(p,n.u_height_factor),u_image:new o.Uniform1i(p,n.u_image),u_texsize:new o.Uniform2f(p,n.u_texsize),u_pixel_coord_upper:new o.Uniform2f(p,n.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,n.u_pixel_coord_lower),u_scale:new o.Uniform3f(p,n.u_scale),u_fade:new o.Uniform1f(p,n.u_fade),u_opacity:new o.Uniform1f(p,n.u_opacity)}),fill:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),fillPattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_image:new o.Uniform1i(p,n.u_image),u_texsize:new o.Uniform2f(p,n.u_texsize),u_pixel_coord_upper:new o.Uniform2f(p,n.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,n.u_pixel_coord_lower),u_scale:new o.Uniform3f(p,n.u_scale),u_fade:new o.Uniform1f(p,n.u_fade)}),fillOutline:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_world:new o.Uniform2f(p,n.u_world)}),fillOutlinePattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_world:new o.Uniform2f(p,n.u_world),u_image:new o.Uniform1i(p,n.u_image),u_texsize:new o.Uniform2f(p,n.u_texsize),u_pixel_coord_upper:new o.Uniform2f(p,n.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,n.u_pixel_coord_lower),u_scale:new o.Uniform3f(p,n.u_scale),u_fade:new o.Uniform1f(p,n.u_fade)}),circle:(p,n)=>({u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_extrude_scale:new o.UniformMatrix2f(p,n.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),collisionBox:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_extrude_scale:new o.Uniform2f(p,n.u_extrude_scale)}),collisionCircle:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_inv_matrix:new o.UniformMatrix4f(p,n.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(p,n.u_viewport_size)}),debug:(p,n)=>({u_color:new o.UniformColor(p,n.u_color),u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_overlay:new o.Uniform1i(p,n.u_overlay),u_overlay_scale:new o.Uniform1f(p,n.u_overlay_scale)}),clippingMask:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),heatmap:(p,n)=>({u_extrude_scale:new o.Uniform1f(p,n.u_extrude_scale),u_intensity:new o.Uniform1f(p,n.u_intensity),u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),heatmapTexture:(p,n)=>({u_image:new o.Uniform1i(p,n.u_image),u_color_ramp:new o.Uniform1i(p,n.u_color_ramp),u_opacity:new o.Uniform1f(p,n.u_opacity)}),hillshade:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_image:new o.Uniform1i(p,n.u_image),u_latrange:new o.Uniform2f(p,n.u_latrange),u_light:new o.Uniform2f(p,n.u_light),u_shadow:new o.UniformColor(p,n.u_shadow),u_highlight:new o.UniformColor(p,n.u_highlight),u_accent:new o.UniformColor(p,n.u_accent)}),hillshadePrepare:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_image:new o.Uniform1i(p,n.u_image),u_dimension:new o.Uniform2f(p,n.u_dimension),u_zoom:new o.Uniform1f(p,n.u_zoom),u_unpack:new o.Uniform4f(p,n.u_unpack)}),line:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_pixels_to_tile_units:new o.UniformMatrix2f(p,n.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(p,n.u_units_to_pixels),u_dash_image:new o.Uniform1i(p,n.u_dash_image),u_gradient_image:new o.Uniform1i(p,n.u_gradient_image),u_image_height:new o.Uniform1f(p,n.u_image_height),u_texsize:new o.Uniform2f(p,n.u_texsize),u_scale:new o.Uniform3f(p,n.u_scale),u_mix:new o.Uniform1f(p,n.u_mix),u_alpha_discard_threshold:new o.Uniform1f(p,n.u_alpha_discard_threshold)}),linePattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_texsize:new o.Uniform2f(p,n.u_texsize),u_pixels_to_tile_units:new o.UniformMatrix2f(p,n.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_image:new o.Uniform1i(p,n.u_image),u_units_to_pixels:new o.Uniform2f(p,n.u_units_to_pixels),u_scale:new o.Uniform3f(p,n.u_scale),u_fade:new o.Uniform1f(p,n.u_fade),u_alpha_discard_threshold:new o.Uniform1f(p,n.u_alpha_discard_threshold)}),raster:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_tl_parent:new o.Uniform2f(p,n.u_tl_parent),u_scale_parent:new o.Uniform1f(p,n.u_scale_parent),u_fade_t:new o.Uniform1f(p,n.u_fade_t),u_opacity:new o.Uniform1f(p,n.u_opacity),u_image0:new o.Uniform1i(p,n.u_image0),u_image1:new o.Uniform1i(p,n.u_image1),u_brightness_low:new o.Uniform1f(p,n.u_brightness_low),u_brightness_high:new o.Uniform1f(p,n.u_brightness_high),u_saturation_factor:new o.Uniform1f(p,n.u_saturation_factor),u_contrast_factor:new o.Uniform1f(p,n.u_contrast_factor),u_spin_weights:new o.Uniform3f(p,n.u_spin_weights),u_perspective_transform:new o.Uniform2f(p,n.u_perspective_transform)}),symbolIcon:(p,n)=>({u_is_size_zoom_constant:new o.Uniform1i(p,n.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(p,n.u_is_size_feature_constant),u_size_t:new o.Uniform1f(p,n.u_size_t),u_size:new o.Uniform1f(p,n.u_size),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_pitch:new o.Uniform1f(p,n.u_pitch),u_rotate_symbol:new o.Uniform1i(p,n.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(p,n.u_aspect_ratio),u_fade_change:new o.Uniform1f(p,n.u_fade_change),u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(p,n.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(p,n.u_coord_matrix),u_is_text:new o.Uniform1i(p,n.u_is_text),u_pitch_with_map:new o.Uniform1i(p,n.u_pitch_with_map),u_texsize:new o.Uniform2f(p,n.u_texsize),u_tile_id:new o.Uniform3f(p,n.u_tile_id),u_zoom_transition:new o.Uniform1f(p,n.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(p,n.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(p,n.u_merc_center),u_texture:new o.Uniform1i(p,n.u_texture)}),symbolSDF:(p,n)=>({u_is_size_zoom_constant:new o.Uniform1i(p,n.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(p,n.u_is_size_feature_constant),u_size_t:new o.Uniform1f(p,n.u_size_t),u_size:new o.Uniform1f(p,n.u_size),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_pitch:new o.Uniform1f(p,n.u_pitch),u_rotate_symbol:new o.Uniform1i(p,n.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(p,n.u_aspect_ratio),u_fade_change:new o.Uniform1f(p,n.u_fade_change),u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(p,n.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(p,n.u_coord_matrix),u_is_text:new o.Uniform1i(p,n.u_is_text),u_pitch_with_map:new o.Uniform1i(p,n.u_pitch_with_map),u_texsize:new o.Uniform2f(p,n.u_texsize),u_texture:new o.Uniform1i(p,n.u_texture),u_gamma_scale:new o.Uniform1f(p,n.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_tile_id:new o.Uniform3f(p,n.u_tile_id),u_zoom_transition:new o.Uniform1f(p,n.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(p,n.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(p,n.u_merc_center),u_is_halo:new o.Uniform1i(p,n.u_is_halo)}),symbolTextAndIcon:(p,n)=>({u_is_size_zoom_constant:new o.Uniform1i(p,n.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(p,n.u_is_size_feature_constant),u_size_t:new o.Uniform1f(p,n.u_size_t),u_size:new o.Uniform1f(p,n.u_size),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_pitch:new o.Uniform1f(p,n.u_pitch),u_rotate_symbol:new o.Uniform1i(p,n.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(p,n.u_aspect_ratio),u_fade_change:new o.Uniform1f(p,n.u_fade_change),u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(p,n.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(p,n.u_coord_matrix),u_is_text:new o.Uniform1i(p,n.u_is_text),u_pitch_with_map:new o.Uniform1i(p,n.u_pitch_with_map),u_texsize:new o.Uniform2f(p,n.u_texsize),u_texsize_icon:new o.Uniform2f(p,n.u_texsize_icon),u_texture:new o.Uniform1i(p,n.u_texture),u_texture_icon:new o.Uniform1i(p,n.u_texture_icon),u_gamma_scale:new o.Uniform1f(p,n.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(p,n.u_is_halo)}),background:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_opacity:new o.Uniform1f(p,n.u_opacity),u_color:new o.UniformColor(p,n.u_color)}),backgroundPattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_opacity:new o.Uniform1f(p,n.u_opacity),u_image:new o.Uniform1i(p,n.u_image),u_pattern_tl_a:new o.Uniform2f(p,n.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(p,n.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(p,n.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(p,n.u_pattern_br_b),u_texsize:new o.Uniform2f(p,n.u_texsize),u_mix:new o.Uniform1f(p,n.u_mix),u_pattern_size_a:new o.Uniform2f(p,n.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(p,n.u_pattern_size_b),u_scale_a:new o.Uniform1f(p,n.u_scale_a),u_scale_b:new o.Uniform1f(p,n.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(p,n.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,n.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(p,n.u_tile_units_to_pixels)}),terrainRaster:Ei,terrainDepth:Ei,skybox:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_sun_direction:new o.Uniform3f(p,n.u_sun_direction),u_cubemap:new o.Uniform1i(p,n.u_cubemap),u_opacity:new o.Uniform1f(p,n.u_opacity),u_temporal_offset:new o.Uniform1f(p,n.u_temporal_offset)}),skyboxGradient:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_color_ramp:new o.Uniform1i(p,n.u_color_ramp),u_center_direction:new o.Uniform3f(p,n.u_center_direction),u_radius:new o.Uniform1f(p,n.u_radius),u_opacity:new o.Uniform1f(p,n.u_opacity),u_temporal_offset:new o.Uniform1f(p,n.u_temporal_offset)}),skyboxCapture:(p,n)=>({u_matrix_3f:new o.UniformMatrix3f(p,n.u_matrix_3f),u_sun_direction:new o.Uniform3f(p,n.u_sun_direction),u_sun_intensity:new o.Uniform1f(p,n.u_sun_intensity),u_color_tint_r:new o.Uniform4f(p,n.u_color_tint_r),u_color_tint_m:new o.Uniform4f(p,n.u_color_tint_m),u_luminance:new o.Uniform1f(p,n.u_luminance)}),globeRaster:(p,n)=>({u_proj_matrix:new o.UniformMatrix4f(p,n.u_proj_matrix),u_globe_matrix:new o.UniformMatrix4f(p,n.u_globe_matrix),u_merc_matrix:new o.UniformMatrix4f(p,n.u_merc_matrix),u_zoom_transition:new o.Uniform1f(p,n.u_zoom_transition),u_merc_center:new o.Uniform2f(p,n.u_merc_center),u_image0:new o.Uniform1i(p,n.u_image0)}),globeAtmosphere:(p,n)=>({u_center:new o.Uniform2f(p,n.u_center),u_radius:new o.Uniform1f(p,n.u_radius),u_screen_size:new o.Uniform2f(p,n.u_screen_size),u_pixel_ratio:new o.Uniform1f(p,n.u_pixel_ratio),u_opacity:new o.Uniform1f(p,n.u_opacity),u_fadeout_range:new o.Uniform1f(p,n.u_fadeout_range),u_start_color:new o.Uniform3f(p,n.u_start_color),u_end_color:new o.Uniform3f(p,n.u_end_color)})};let Il;function bc(p,n,l,m,v,b,T){const P=p.context,D=P.gl,O=p.useProgram("collisionBox"),B=[];let U=0,q=0;for(let pe=0;pe<m.length;pe++){const he=m[pe],fe=n.getTile(he),ye=fe.getBucket(l);if(!ye)continue;let Le=he.projMatrix;v[0]===0&&v[1]===0||(Le=p.translatePosMatrix(he.projMatrix,fe,v,b));const Ue=T?ye.textCollisionBox:ye.iconCollisionBox,ht=ye.collisionCircleArray;if(ht.length>0){const ot=o.create(),nt=Le;o.mul(ot,ye.placementInvProjMatrix,p.transform.glCoordMatrix),o.mul(ot,ot,ye.placementViewportMatrix),B.push({circleArray:ht,circleOffset:q,transform:nt,invTransform:ot}),U+=ht.length/4,q=U}Ue&&(p.terrain&&p.terrain.setupElevationDraw(fe,O),O.draw(P,D.LINES,o.DepthMode.disabled,o.StencilMode.disabled,p.colorModeForRenderPass(),o.CullFaceMode.disabled,_h(Le,p.transform,fe),l.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,null,p.transform.zoom,null,Ue.collisionVertexBuffer,Ue.collisionVertexBufferExt))}if(!T||!B.length)return;const Q=p.useProgram("collisionCircle"),K=new o.StructArrayLayout2f1f2i16;K.resize(4*U),K._trim();let te=0;for(const pe of B)for(let he=0;he<pe.circleArray.length/4;he++){const fe=4*he,ye=pe.circleArray[fe+0],Le=pe.circleArray[fe+1],Ue=pe.circleArray[fe+2],ht=pe.circleArray[fe+3];K.emplace(te++,ye,Le,Ue,ht,0),K.emplace(te++,ye,Le,Ue,ht,1),K.emplace(te++,ye,Le,Ue,ht,2),K.emplace(te++,ye,Le,Ue,ht,3)}(!Il||Il.length<2*U)&&(Il=function(pe){const he=2*pe,fe=new o.StructArrayLayout3ui6;fe.resize(he),fe._trim();for(let ye=0;ye<he;ye++){const Le=6*ye;fe.uint16[Le+0]=4*ye+0,fe.uint16[Le+1]=4*ye+1,fe.uint16[Le+2]=4*ye+2,fe.uint16[Le+3]=4*ye+2,fe.uint16[Le+4]=4*ye+3,fe.uint16[Le+5]=4*ye+0}return fe}(U));const _e=P.createIndexBuffer(Il,!0),J=P.createVertexBuffer(K,o.collisionCircleLayout.members,!0);for(const pe of B){const he={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(me=p.transform).cameraToCenterDistance,u_viewport_size:[me.width,me.height]};Q.draw(P,D.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,p.colorModeForRenderPass(),o.CullFaceMode.disabled,he,l.id,J,_e,o.SegmentVector.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,p.transform.zoom,null,null,null)}var me;J.destroy(),_e.destroy()}const Eu=o.identity(new Float32Array(16));function Tu(p,n,l,m,v,b){const{horizontalAlign:T,verticalAlign:P}=o.getAnchorAlignment(p),D=-(T-.5)*n,O=-(P-.5)*l,B=o.evaluateVariableOffset(p,m);return new o.pointGeometry((D/v+B[0])*b,(O/v+B[1])*b)}function Al(p,n,l,m,v,b,T,P,D,O,B,U){const q=p.text.placedSymbolArray,Q=p.text.dynamicLayoutVertexArray,K=p.icon.dynamicLayoutVertexArray,te={},_e=P.projMatrix,J=b.elevation,me=J?J.getAtTileOffsetFunc(P,U):pe=>[0,0,0];Q.clear();for(let pe=0;pe<q.length;pe++){const he=q.get(pe),fe=p.allowVerticalPlacement&&!he.placedOrientation,ye=he.hidden||!he.crossTileID||fe?null:m[he.crossTileID];if(ye){const Le=new o.pointGeometry(he.tileAnchorX,he.tileAnchorY),Ue=me(Le),ht=rr(Le,l?_e:T,Ue[2]),ot=Sr(b.cameraToCenterDistance,ht.signedDistanceFromCamera);let nt=v.evaluateSizeForFeature(p.textSizeData,O,he)*ot/o.ONE_EM;l&&(nt*=p.tilePixelRatio/D);const{width:qe,height:Ne,anchor:tt,textOffset:Ye,textScale:Rt}=ye,Gt=Tu(tt,qe,Ne,Ye,Rt,nt),ln=l?rr(Le.add(Gt),T,Ue[2]).point:ht.point.add(n?Gt.rotate(-b.angle):Gt),ft=p.allowVerticalPlacement&&he.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Ft=0;Ft<he.numGlyphs;Ft++)o.addDynamicAttributes(Q,ln,ft);B&&he.associatedIconIndex>=0&&(te[he.associatedIconIndex]={shiftedAnchor:ln,angle:ft})}else Or(he.numGlyphs,Q)}if(B){K.clear();const pe=p.icon.placedSymbolArray;for(let he=0;he<pe.length;he++){const fe=pe.get(he);if(fe.hidden)Or(fe.numGlyphs,K);else{const ye=te[he];if(ye)for(let Le=0;Le<fe.numGlyphs;Le++)o.addDynamicAttributes(K,ye.shiftedAnchor,ye.angle);else Or(fe.numGlyphs,K)}}p.icon.dynamicLayoutVertexBuffer.updateData(K)}p.text.dynamicLayoutVertexBuffer.updateData(Q)}function vd(p,n,l){return l.iconsInText&&n?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function kl(p,n,l,m,v,b,T,P,D,O,B,U){const q=p.context,Q=q.gl,K=p.transform,te=K.projection.createTileTransform(K,K.worldSize),_e=P==="map",J=D==="map",me=_e&&l.layout.get("symbol-placement")!=="point",pe=_e&&!J&&!me,he=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let fe=!1;const ye=p.depthModeForSublayer(0,o.DepthMode.ReadOnly),Le=[o.mercatorXfromLng(K.center.lng),o.mercatorYfromLat(K.center.lat)],Ue=l.layout.get("text-variable-anchor"),ht=K.projection.name==="globe",ot=ht?o.globeToMercatorTransition(K.zoom):0,nt=[],qe=[];p.terrain&&J&&qe.push("PITCH_WITH_MAP_TERRAIN"),ht&&qe.push("PROJECTION_GLOBE_VIEW"),me&&qe.push("PROJECTED_POS_ON_VIEWPORT");for(const Ne of m){const tt=n.getTile(Ne),Ye=tt.getBucket(l);if(!Ye||Ye.projection!==K.projection.name)continue;const Rt=v?Ye.text:Ye.icon;if(!Rt||Ye.fullyClipped||!Rt.segments.get().length)continue;const Gt=Rt.programConfigurations.get(l.id),ln=v||Ye.sdfIcons,ft=v?Ye.textSizeData:Ye.iconSizeData,Ft=J||K.pitch!==0,Kt=p.useProgram(vd(ln,v,Ye),Gt,qe),zn=o.evaluateSizeForZoom(ft,K.zoom),Wn=[Ne.canonical.x,Ne.canonical.y,1<<Ne.canonical.z];let Xt,gn,Xn,Jn,Hr=[0,0],di=null;if(v){if(gn=tt.glyphAtlasTexture,Xn=Q.LINEAR,Xt=tt.glyphAtlasTexture.size,Ye.iconsInText){Hr=tt.imageAtlasTexture.size,di=tt.imageAtlasTexture;const Nr=ft.kind==="composite"||ft.kind==="camera";Jn=Ft||p.options.rotating||p.options.zooming||Nr?Q.LINEAR:Q.NEAREST}}else{const Nr=l.layout.get("icon-size").constantOr(0)!==1||Ye.iconsNeedLinear;gn=tt.imageAtlasTexture,Xn=ln||p.options.rotating||p.options.zooming||Nr||Ft?Q.LINEAR:Q.NEAREST,Xt=tt.imageAtlasTexture.size}const ti=p.transform.calculatePixelsToTileUnitsMatrix(tt),Tn=br(Ne.projMatrix,tt.tileID.canonical,J,_e,p.transform,ti),Ht=p.terrain&&J&&me?o.invert(new Float32Array(16),Tn):Eu,bn=ai(Ne.projMatrix,tt.tileID.canonical,J,_e,p.transform,ti),fr=Ue&&Ye.hasTextData(),Bn=l.layout.get("icon-text-fit")!=="none"&&fr&&Ye.hasIconData();if(me){const Nr=K.elevation,Xo=Nr?Nr.getAtTileOffsetFunc(Ne,te):Ho=>[0,0,0];bi(Ye,Ne.projMatrix,p,v,Tn,bn,J,O,Xo,Ne)}const Hn=p.translatePosMatrix(Ne.projMatrix,tt,b,T),Mr=me||v&&Ue||Bn?Eu:Tn,lo=p.translatePosMatrix(bn,tt,b,T,!0),yr=ln&&l.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vs;const Ct=te.createInversionMatrix(Ne.toUnwrapped());Vs=ln?Ye.iconsInText?Pl(ft.kind,zn,pe,J,p,Hn,Mr,lo,Xt,Hr,Wn,ot,Ct,Le):Xa(ft.kind,zn,pe,J,p,Hn,Mr,lo,v,Xt,!0,Wn,ot,Ct,Le):bu(ft.kind,zn,pe,J,p,Hn,Mr,lo,v,Xt,Wn,ot,Ct,Le);const jt={program:Kt,buffers:Rt,uniformValues:Vs,atlasTexture:gn,atlasTextureIcon:di,atlasInterpolation:Xn,atlasInterpolationIcon:Jn,isSDF:ln,hasHalo:yr,tile:tt,labelPlaneMatrixInv:Ht};if(he&&Ye.canOverlap){fe=!0;const Nr=Rt.segments.get();for(const Xo of Nr)nt.push({segments:new o.SegmentVector([Xo]),sortKey:Xo.sortKey,state:jt})}else nt.push({segments:Rt.segments,sortKey:0,state:jt})}fe&&nt.sort((Ne,tt)=>Ne.sortKey-tt.sortKey);for(const Ne of nt){const tt=Ne.state;if(p.terrain&&p.terrain.setupElevationDraw(tt.tile,tt.program,{useDepthForOcclusion:!ht,labelPlaneMatrixInv:tt.labelPlaneMatrixInv}),q.activeTexture.set(Q.TEXTURE0),tt.atlasTexture.bind(tt.atlasInterpolation,Q.CLAMP_TO_EDGE),tt.atlasTextureIcon&&(q.activeTexture.set(Q.TEXTURE1),tt.atlasTextureIcon&&tt.atlasTextureIcon.bind(tt.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),tt.isSDF){const Ye=tt.uniformValues;tt.hasHalo&&(Ye.u_is_halo=1,zl(tt.buffers,Ne.segments,l,p,tt.program,ye,B,U,Ye)),Ye.u_is_halo=0}zl(tt.buffers,Ne.segments,l,p,tt.program,ye,B,U,tt.uniformValues)}}function zl(p,n,l,m,v,b,T,P,D){const O=m.context;v.draw(O,O.gl.TRIANGLES,b,T,P,o.CullFaceMode.disabled,D,l.id,p.layoutVertexBuffer,p.indexBuffer,n,l.paint,m.transform.zoom,p.programConfigurations.get(l.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Dl(p,n,l,m,v,b,T){const P=p.context.gl,D=l.paint.get("fill-pattern"),O=D&&D.constantOr(1),B=l.getCrossfadeParameters();let U,q,Q,K,te;T?(q=O&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=P.LINES):(q=O?"fillPattern":"fill",U=P.TRIANGLES);for(const _e of m){const J=n.getTile(_e);if(O&&!J.patternsLoaded())continue;const me=J.getBucket(l);if(!me)continue;p.prepareDrawTile(_e);const pe=me.programConfigurations.get(l.id),he=p.useProgram(q,pe);O&&(p.context.activeTexture.set(P.TEXTURE0),J.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),pe.updatePaintBuffers(B));const fe=D.constantOr(null);if(fe&&J.imageAtlas){const Le=J.imageAtlas,Ue=Le.patternPositions[fe.to.toString()],ht=Le.patternPositions[fe.from.toString()];Ue&&ht&&pe.setConstantPatternPositions(Ue,ht)}const ye=p.translatePosMatrix(_e.projMatrix,J,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(T){K=me.indexBuffer2,te=me.segments2;const Le=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[P.drawingBufferWidth,P.drawingBufferHeight];Q=q==="fillOutlinePattern"&&O?gh(ye,p,B,J,Le):_c(ye,Le)}else K=me.indexBuffer,te=me.segments,Q=O?gc(ye,p,B,J):mh(ye);p.prepareDrawProgram(p.context,he,_e.toUnwrapped()),he.draw(p.context,U,v,p.stencilModeForClipping(_e),b,o.CullFaceMode.disabled,Q,l.id,me.layoutVertexBuffer,K,te,l.paint,p.transform.zoom,pe)}}function Ha(p,n,l,m,v,b,T){const P=p.context,D=P.gl,O=l.paint.get("fill-extrusion-pattern"),B=O.constantOr(1),U=l.getCrossfadeParameters(),q=l.paint.get("fill-extrusion-opacity");for(const Q of m){const K=n.getTile(Q),te=K.getBucket(l);if(!te)continue;const _e=te.programConfigurations.get(l.id),J=p.useProgram(B?"fillExtrusionPattern":"fillExtrusion",_e);if(p.terrain){const ye=p.terrain;if(!te.enableTerrain)continue;if(ye.setupElevationDraw(K,J,{useMeterToDem:!0}),wc(P,n,Q,te,l,ye),!te.centroidVertexBuffer){const Le=J.attributes.a_centroid_pos;Le!==void 0&&D.vertexAttrib2f(Le,0,0)}}B&&(p.context.activeTexture.set(D.TEXTURE0),K.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),_e.updatePaintBuffers(U));const me=O.constantOr(null);if(me&&K.imageAtlas){const ye=K.imageAtlas,Le=ye.patternPositions[me.to.toString()],Ue=ye.patternPositions[me.from.toString()];Le&&Ue&&_e.setConstantPatternPositions(Le,Ue)}const pe=p.translatePosMatrix(Q.projMatrix,K,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),he=l.paint.get("fill-extrusion-vertical-gradient"),fe=B?mc(pe,p,he,q,Q,U,K):pc(pe,p,he,q);p.prepareDrawProgram(P,J,Q.toUnwrapped()),J.draw(P,P.gl.TRIANGLES,v,b,T,o.CullFaceMode.backCCW,fe,l.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,l.paint,p.transform.zoom,_e,p.terrain?te.centroidVertexBuffer:null)}}function wc(p,n,l,m,v,b){const T=[J=>{let me=J.canonical.x-1,pe=J.wrap;return me<0&&(me=(1<<J.canonical.z)-1,pe--),new o.OverscaledTileID(J.overscaledZ,pe,J.canonical.z,me,J.canonical.y)},J=>{let me=J.canonical.x+1,pe=J.wrap;return me===1<<J.canonical.z&&(me=0,pe++),new o.OverscaledTileID(J.overscaledZ,pe,J.canonical.z,me,J.canonical.y)},J=>new o.OverscaledTileID(J.overscaledZ,J.wrap,J.canonical.z,J.canonical.x,(J.canonical.y===0?1<<J.canonical.z:J.canonical.y)-1),J=>new o.OverscaledTileID(J.overscaledZ,J.wrap,J.canonical.z,J.canonical.x,J.canonical.y===(1<<J.canonical.z)-1?0:J.canonical.y+1)],P=J=>{const me=n.getSource().maxzoom,pe=Le=>{const Ue=n.getTileByID(Le);if(Ue&&Ue.hasData())return Ue.getBucket(v)};let he,fe,ye;return(J.overscaledZ===J.canonical.z||J.overscaledZ>=me)&&(he=pe(J.key)),J.overscaledZ>=me&&(fe=pe(J.calculateScaledKey(J.overscaledZ+1))),J.overscaledZ>me&&(ye=pe(J.calculateScaledKey(J.overscaledZ-1))),he||fe||ye},D=[0,0,0],O=(J,me)=>(D[0]=Math.min(J.min.y,me.min.y),D[1]=Math.max(J.max.y,me.max.y),D[2]=o.EXTENT-me.min.x>J.max.x?me.min.x-o.EXTENT:J.max.x,D),B=(J,me)=>(D[0]=Math.min(J.min.x,me.min.x),D[1]=Math.max(J.max.x,me.max.x),D[2]=o.EXTENT-me.min.y>J.max.y?me.min.y-o.EXTENT:J.max.y,D),U=[(J,me)=>O(J,me),(J,me)=>O(me,J),(J,me)=>B(J,me),(J,me)=>B(me,J)],q=new o.pointGeometry(0,0);let Q,K,te;const _e=(J,me,pe,he,fe)=>{const ye=[[he?pe:J,he?J:pe,0],[he?pe:me,he?me:pe,0]],Le=fe<0?o.EXTENT+fe:fe,Ue=[he?Le:(J+me)/2,he?(J+me)/2:Le,0];return pe===0&&fe<0||pe!==0&&fe>0?b.getForTilePoints(te,[Ue],!0,K):ye.push(Ue),b.getForTilePoints(l,ye,!0,Q),Math.max(ye[0][2],ye[1][2],Ue[2])/b.exaggeration()};for(let J=0;J<4;J++){const me=m.borders[J];if(me.length===0&&(m.borderDone[J]=!0),m.borderDone[J])continue;const pe=te=T[J](l),he=P(pe);if(!he||!he.enableTerrain||(K=b.findDEMTileFor(pe),!K||!K.dem))continue;if(!Q){const Ue=b.findDEMTileFor(l);if(!Ue||!Ue.dem)return;Q=Ue}const fe=(J<2?1:5)-J,ye=he.borders[fe];let Le=0;for(let Ue=0;Ue<me.length;Ue++){const ht=m.featuresOnBorder[me[Ue]],ot=ht.borders[J];let nt;for(;Le<ye.length&&(nt=he.featuresOnBorder[ye[Le]],!(nt.borders[fe][1]>ot[0]+3));)he.borderDone[fe]||he.encodeCentroid(void 0,nt,!1),Le++;if(nt&&Le<ye.length){const qe=Le;let Ne=0;for(;!(nt.borders[fe][0]>ot[1]-3)&&(Ne++,++Le!==ye.length);)nt=he.featuresOnBorder[ye[Le]];if(nt=he.featuresOnBorder[ye[qe]],ht.intersectsCount()>1||nt.intersectsCount()>1||Ne!==1){Ne!==1&&(Le=qe),m.encodeCentroid(void 0,ht,!1),he.borderDone[fe]||he.encodeCentroid(void 0,nt,!1);continue}const tt=U[J](ht,nt),Ye=J%2?o.EXTENT-1:0;q.x=_e(tt[0],Math.min(o.EXTENT-1,tt[1]),Ye,J<2,tt[2]),q.y=0,m.encodeCentroid(q,ht,!1),he.borderDone[fe]||he.encodeCentroid(q,nt,!1)}else m.encodeCentroid(void 0,ht,!1)}m.borderDone[J]=m.needsCentroidUpdate=!0,he.borderDone[fe]||(he.borderDone[fe]=he.needsCentroidUpdate=!0)}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(p)}const ha=new o.Color(1,0,0,1),xd=new o.Color(0,1,0,1),Ll=new o.Color(0,0,1,1),Rl=new o.Color(1,0,1,1),Ec=new o.Color(0,1,1,1);function Ti(p,n,l,m){So(p,0,n+l/2,p.transform.width,l,m)}function Ds(p,n,l,m){So(p,n-l/2,0,l,p.transform.height,m)}function So(p,n,l,m,v,b){const T=p.context,P=T.gl;P.enable(P.SCISSOR_TEST),P.scissor(n*o.exported.devicePixelRatio,l*o.exported.devicePixelRatio,m*o.exported.devicePixelRatio,v*o.exported.devicePixelRatio),T.clear({color:b}),P.disable(P.SCISSOR_TEST)}function Su(p,n,l){const m=p.context,v=m.gl,b=l.projMatrix,T=p.useProgram("debug"),P=n.getTileByID(l.key);p.terrain&&p.terrain.setupElevationDraw(P,T);const D=o.DepthMode.disabled,O=o.StencilMode.disabled,B=p.colorModeForRenderPass(),U="$debug";m.activeTexture.set(v.TEXTURE0),p.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),P._makeDebugTileBoundsBuffers(p.context,p.transform.projection);const q=P._tileDebugBuffer||p.debugBuffer,Q=P._tileDebugIndexBuffer||p.debugIndexBuffer,K=P._tileDebugSegments||p.debugSegments;T.draw(m,v.LINE_STRIP,D,O,B,o.CullFaceMode.disabled,vc(b,o.Color.red),U,q,Q,K);const te=P.latestRawTileData,_e=Math.floor((te&&te.byteLength||0)/1024),J=n.getTile(l).tileSize,me=512/Math.min(J,512)*(l.overscaledZ/p.transform.zoom)*.5;let pe=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(pe+=` => ${l.overscaledZ}`),function(he,fe){he.initDebugOverlayCanvas();const ye=he.debugOverlayCanvas,Le=he.context.gl,Ue=he.debugOverlayCanvas.getContext("2d");Ue.clearRect(0,0,ye.width,ye.height),Ue.shadowColor="white",Ue.shadowBlur=2,Ue.lineWidth=1.5,Ue.strokeStyle="white",Ue.textBaseline="top",Ue.font="bold 36px Open Sans, sans-serif",Ue.fillText(fe,5,5),Ue.strokeText(fe,5,5),he.debugOverlayTexture.update(ye),he.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(p,`${pe} ${_e}kb`),T.draw(m,v.TRIANGLES,D,O,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,vc(b,o.Color.transparent,me),U,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments)}const Ya=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Tc}=Ya;function io(p,n,l,m){p.emplaceBack(n,l,m)}class Ka{constructor(n){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,io(this.vertexArray,-1,-1,1),io(this.vertexArray,1,-1,1),io(this.vertexArray,-1,1,1),io(this.vertexArray,1,1,1),io(this.vertexArray,-1,-1,-1),io(this.vertexArray,1,-1,-1),io(this.vertexArray,-1,1,-1),io(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Tc),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function Zo(p,n,l,m,v,b){const T=p.gl,P=n.paint.get("sky-atmosphere-color"),D=n.paint.get("sky-atmosphere-halo-color"),O=n.paint.get("sky-atmosphere-sun-intensity"),B=((U,q,Q,K,te)=>({u_matrix_3f:U,u_sun_direction:q,u_sun_intensity:Q,u_color_tint_r:[K.r,K.g,K.b,K.a],u_color_tint_m:[te.r,te.g,te.b,te.a],u_luminance:5e-5}))(o.fromMat4([],m),v,O,P,D);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),l.draw(p,T.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,B,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Ja={symbol:function(p,n,l,m,v){if(p.renderPass!=="translucent")return;const b=o.StencilMode.disabled,T=p.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(P,D,O,B,U,q,Q){const K=D.transform,te=U==="map",_e=q==="map",J=K.projection.createTileTransform(K,K.worldSize);for(const me of P){const pe=B.getTile(me),he=pe.getBucket(O);if(!he||he.projection!==K.projection.name||!he.text||!he.text.segments.get().length)continue;const fe=o.evaluateSizeForZoom(he.textSizeData,K.zoom),ye=D.transform.calculatePixelsToTileUnitsMatrix(pe),Le=br(me.projMatrix,pe.tileID.canonical,_e,te,D.transform,ye),Ue=O.layout.get("icon-text-fit")!=="none"&&he.hasIconData();if(fe){const ht=Math.pow(2,K.zoom-pe.tileID.overscaledZ);Al(he,te,_e,Q,o.symbolSize,K,Le,me,ht,fe,Ue,J)}}}(m,p,l,n,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),v),l.paint.get("icon-opacity").constantOr(1)!==0&&kl(p,n,l,m,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),b,T),l.paint.get("text-opacity").constantOr(1)!==0&&kl(p,n,l,m,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),b,T),n.map.showCollisionBoxes&&(bc(p,n,l,m,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),bc(p,n,l,m,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(p,n,l,m){if(p.renderPass!=="translucent")return;const v=l.paint.get("circle-opacity"),b=l.paint.get("circle-stroke-width"),T=l.paint.get("circle-stroke-opacity"),P=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(v.constantOr(1)===0&&(b.constantOr(1)===0||T.constantOr(1)===0))return;const D=p.context,O=D.gl,B=p.depthModeForSublayer(0,o.DepthMode.ReadOnly),U=o.StencilMode.disabled,q=p.colorModeForRenderPass(),Q=[];for(let te=0;te<m.length;te++){const _e=m[te],J=n.getTile(_e),me=J.getBucket(l);if(!me)continue;const pe=me.programConfigurations.get(l.id),he=yc(l),fe={programConfiguration:pe,program:p.useProgram("circle",pe,he),layoutVertexBuffer:me.layoutVertexBuffer,indexBuffer:me.indexBuffer,uniformValues:yd(p,_e,J,l),tile:J};if(P){const ye=me.segments.get();for(const Le of ye)Q.push({segments:new o.SegmentVector([Le]),sortKey:Le.sortKey,state:fe})}else Q.push({segments:me.segments,sortKey:0,state:fe})}P&&Q.sort((te,_e)=>te.sortKey-_e.sortKey);const K={useDepthForOcclusion:p.transform.projection.name!=="globe"};for(const te of Q){const{programConfiguration:_e,program:J,layoutVertexBuffer:me,indexBuffer:pe,uniformValues:he,tile:fe}=te.state,ye=te.segments;p.terrain&&p.terrain.setupElevationDraw(fe,J,K),p.prepareDrawProgram(D,J,fe.tileID.toUnwrapped()),J.draw(D,O.TRIANGLES,B,U,q,o.CullFaceMode.disabled,he,l.id,me,pe,ye,l.paint,p.transform.zoom,_e)}},heatmap:function(p,n,l,m){if(l.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const v=p.context,b=v.gl,T=o.StencilMode.disabled,P=new o.ColorMode([b.ONE,b.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(D,O,B){const U=D.gl;D.activeTexture.set(U.TEXTURE1),D.viewport.set([0,0,O.width/4,O.height/4]);let q=B.heatmapFbo;if(q)U.bindTexture(U.TEXTURE_2D,q.colorAttachment.get()),D.bindFramebuffer.set(q.framebuffer);else{const Q=U.createTexture();U.bindTexture(U.TEXTURE_2D,Q),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),q=B.heatmapFbo=D.createFramebuffer(O.width/4,O.height/4,!1),function(K,te,_e,J){const me=K.gl;me.texImage2D(me.TEXTURE_2D,0,me.RGBA,te.width/4,te.height/4,0,me.RGBA,K.extRenderToTextureHalfFloat?K.extTextureHalfFloat.HALF_FLOAT_OES:me.UNSIGNED_BYTE,null),J.colorAttachment.set(_e)}(D,O,Q,q)}})(v,p,l),v.clear({color:o.Color.transparent});for(let D=0;D<m.length;D++){const O=m[D];if(n.hasRenderableParent(O))continue;const B=n.getTile(O),U=B.getBucket(l);if(!U)continue;const q=U.programConfigurations.get(l.id),Q=p.useProgram("heatmap",q),{zoom:K}=p.transform;p.terrain&&p.terrain.setupElevationDraw(B,Q),p.prepareDrawProgram(v,Q,O.toUnwrapped()),Q.draw(v,b.TRIANGLES,o.DepthMode.disabled,T,P,o.CullFaceMode.disabled,xc(O.projMatrix,B,K,l.paint.get("heatmap-intensity")),l.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,l.paint,p.transform.zoom,q)}v.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,b){const T=v.context,P=T.gl,D=b.heatmapFbo;if(!D)return;T.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,D.colorAttachment.get()),T.activeTexture.set(P.TEXTURE1);let O=b.colorRampTexture;O||(O=b.colorRampTexture=new o.Texture(T,b.colorRamp,P.RGBA)),O.bind(P.LINEAR,P.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(T,P.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,v.colorModeForRenderPass(),o.CullFaceMode.disabled,((B,U,q,Q)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,b),b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(p,l))},line:function(p,n,l,m){if(p.renderPass!=="translucent")return;const v=l.paint.get("line-opacity"),b=l.paint.get("line-width");if(v.constantOr(1)===0||b.constantOr(1)===0)return;const T=p.depthModeForSublayer(0,o.DepthMode.ReadOnly),P=p.colorModeForRenderPass(),D=l.paint.get("line-dasharray"),O=D.constantOr(1),B=l.layout.get("line-cap"),U=l.paint.get("line-pattern"),q=U.constantOr(1),Q=l.paint.get("line-gradient"),K=l.getCrossfadeParameters(),te=q?"linePattern":"line",_e=p.context,J=_e.gl,me=(he=>{const fe=[];ca(he)&&fe.push("RENDER_LINE_DASH"),he.paint.get("line-gradient")&&fe.push("RENDER_LINE_GRADIENT");const ye=he.paint.get("line-pattern").constantOr(1),Le=he.paint.get("line-opacity").constantOr(1)!==1;return!ye&&Le&&fe.push("RENDER_LINE_ALPHA_DISCARD"),fe})(l);let pe=me.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(pe=!1);for(const he of m){const fe=n.getTile(he);if(q&&!fe.patternsLoaded())continue;const ye=fe.getBucket(l);if(!ye)continue;p.prepareDrawTile(he);const Le=ye.programConfigurations.get(l.id),Ue=p.useProgram(te,Le,me),ht=U.constantOr(null);if(ht&&fe.imageAtlas){const Ye=fe.imageAtlas,Rt=Ye.patternPositions[ht.to.toString()],Gt=Ye.patternPositions[ht.from.toString()];Rt&&Gt&&Le.setConstantPatternPositions(Rt,Gt)}const ot=D.constantOr(null),nt=B.constantOr(null);if(!q&&ot&&nt&&fe.lineAtlas){const Ye=fe.lineAtlas,Rt=Ye.getDash(ot.to,nt),Gt=Ye.getDash(ot.from,nt);Rt&&Gt&&Le.setConstantPatternPositions(Rt,Gt)}const qe=p.terrain?he.projMatrix:null,Ne=q?ua(p,fe,l,K,qe):yh(p,fe,l,K,qe,ye.lineClipsArray.length);if(Q){const Ye=ye.gradients[l.id];let Rt=Ye.texture;if(l.gradientVersion!==Ye.version){let Gt=256;if(l.stepInterpolant){const ln=n.getSource().maxzoom,ft=he.canonical.z===ln?Math.ceil(1<<p.transform.maxZoom-he.canonical.z):1;Gt=o.clamp(o.nextPowerOfTwo(ye.maxLineLength/o.EXTENT*1024*ft),256,_e.maxTextureSize)}Ye.gradient=o.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Gt,image:Ye.gradient||void 0,clips:ye.lineClipsArray}),Ye.texture?Ye.texture.update(Ye.gradient):Ye.texture=new o.Texture(_e,Ye.gradient,J.RGBA),Ye.version=l.gradientVersion,Rt=Ye.texture}_e.activeTexture.set(J.TEXTURE1),Rt.bind(l.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}O&&(_e.activeTexture.set(J.TEXTURE0),fe.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),Le.updatePaintBuffers(K)),q&&(_e.activeTexture.set(J.TEXTURE0),fe.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Le.updatePaintBuffers(K)),p.prepareDrawProgram(_e,Ue,he.toUnwrapped());const tt=Ye=>{Ue.draw(_e,J.TRIANGLES,T,Ye,P,o.CullFaceMode.disabled,Ne,l.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,l.paint,p.transform.zoom,Le,ye.layoutVertexBuffer2)};if(pe){const Ye=p.stencilModeForClipping(he).ref;Ye===0&&p.terrain&&_e.clear({stencil:0});const Rt={func:J.EQUAL,mask:255};Ne.u_alpha_discard_threshold=.8,tt(new o.StencilMode(Rt,Ye,255,J.KEEP,J.KEEP,J.INVERT)),Ne.u_alpha_discard_threshold=0,tt(new o.StencilMode(Rt,Ye,255,J.KEEP,J.KEEP,J.KEEP))}else tt(p.stencilModeForClipping(he))}pe&&(p.resetStencilClippingMasks(),p.terrain&&_e.clear({stencil:0}))},fill:function(p,n,l,m){const v=l.paint.get("fill-color"),b=l.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const T=p.colorModeForRenderPass(),P=l.paint.get("fill-pattern"),D=p.opaquePassEnabledForLayer()&&!P.constantOr(1)&&v.constantOr(o.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===D){const O=p.depthModeForSublayer(1,p.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);Dl(p,n,l,m,O,T,!1)}if(p.renderPass==="translucent"&&l.paint.get("fill-antialias")){const O=p.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);Dl(p,n,l,m,O,T,!0)}},"fill-extrusion":function(p,n,l,m){const v=l.paint.get("fill-extrusion-opacity");if(v!==0&&p.renderPass==="translucent"){const b=new o.DepthMode(p.context.gl.LEQUAL,o.DepthMode.ReadWrite,p.depthRangeFor3D);if(v!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))Ha(p,n,l,m,b,o.StencilMode.disabled,o.ColorMode.disabled),Ha(p,n,l,m,b,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const T=p.colorModeForRenderPass();Ha(p,n,l,m,b,o.StencilMode.disabled,T)}}},hillshade:function(p,n,l,m){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const v=p.context,b=p.depthModeForSublayer(0,o.DepthMode.ReadOnly),T=p.colorModeForRenderPass(),P=p.terrain&&p.terrain.renderingToTexture,[D,O]=p.renderPass!=="translucent"||P?[{},m]:p.stencilConfigForOverlap(m);for(const B of O){const U=n.getTile(B);if(U.needsHillshadePrepare&&p.renderPass==="offscreen")sa(p,U,l,b,o.StencilMode.disabled,T);else if(p.renderPass==="translucent"){const q=P&&p.terrain?p.terrain.stencilModeForRTTOverlap(B):D[B.overscaledZ];_u(p,B,U,l,b,q,T)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,n,l,m,v,b){if(p.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!m.length)return;const T=p.context,P=T.gl,D=n.getSource(),O=p.useProgram("raster"),B=p.colorModeForRenderPass(),U=p.terrain&&p.terrain.renderingToTexture,[q,Q]=D instanceof Rr||U?[{},m]:p.stencilConfigForOverlap(m),K=Q[Q.length-1].overscaledZ,te=!p.options.moving;for(const _e of Q){const J=U?o.DepthMode.disabled:p.depthModeForSublayer(_e.overscaledZ-K,l.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,P.LESS),me=_e.toUnwrapped(),pe=n.getTile(_e);if(U&&(!pe||!pe.hasData()))continue;const he=U?_e.projMatrix:p.transform.calculateProjMatrix(me,te),fe=p.terrain&&U?p.terrain.stencilModeForRTTOverlap(_e):q[_e.overscaledZ],ye=b?0:l.paint.get("raster-fade-duration");pe.registerFadeDuration(ye);const Le=n.findLoadedParent(_e,0),Ue=la(pe,Le,n,p.transform,ye);let ht,ot;p.terrain&&p.terrain.prepareDrawTile(_e);const nt=l.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;T.activeTexture.set(P.TEXTURE0),pe.texture.bind(nt,P.CLAMP_TO_EDGE),T.activeTexture.set(P.TEXTURE1),Le?(Le.texture.bind(nt,P.CLAMP_TO_EDGE),ht=Math.pow(2,Le.tileID.overscaledZ-pe.tileID.overscaledZ),ot=[pe.tileID.canonical.x*ht%1,pe.tileID.canonical.y*ht%1]):pe.texture.bind(nt,P.CLAMP_TO_EDGE);const qe=vu(he,ot||[0,0],ht||1,Ue,l,D instanceof Rr?D.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(T,O,me),D instanceof Rr)O.draw(T,P.TRIANGLES,J,o.StencilMode.disabled,B,o.CullFaceMode.disabled,qe,l.id,D.boundsBuffer,p.quadTriangleIndexBuffer,D.boundsSegments);else{const{tileBoundsBuffer:Ne,tileBoundsIndexBuffer:tt,tileBoundsSegments:Ye}=p.getTileBoundsBuffers(pe);O.draw(T,P.TRIANGLES,J,fe,B,o.CullFaceMode.disabled,qe,l.id,Ne,tt,Ye)}}p.resetStencilClippingMasks()},background:function(p,n,l,m){const v=l.paint.get("background-color"),b=l.paint.get("background-opacity");if(b===0)return;const T=p.context,P=T.gl,D=p.transform,O=D.tileSize,B=l.paint.get("background-pattern");if(p.isPatternMissing(B))return;const U=!B&&v.a===1&&b===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==U)return;const q=o.StencilMode.disabled,Q=p.depthModeForSublayer(0,U==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),K=p.colorModeForRenderPass(),te=p.useProgram(B?"backgroundPattern":"background");let _e,J=m;J||(_e=p.getBackgroundTiles(),J=Object.values(_e).map(pe=>pe.tileID)),B&&(T.activeTexture.set(P.TEXTURE0),p.imageManager.bind(p.context));const me=l.getCrossfadeParameters();for(const pe of J){const he=pe.toUnwrapped(),fe=m?pe.projMatrix:p.transform.calculateProjMatrix(he);p.prepareDrawTile(pe);const ye=n?n.getTile(pe):_e?_e[pe.key]:new o.Tile(pe,O,D.zoom,p),Le=B?wu(fe,b,p,B,{tileID:pe,tileSize:O},me):Nn(fe,b,v);p.prepareDrawProgram(T,te,he);const{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:ht,tileBoundsSegments:ot}=p.getTileBoundsBuffers(ye);te.draw(T,P.TRIANGLES,Q,q,K,o.CullFaceMode.disabled,Le,l.id,Ue,ht,ot)}},sky:function(p,n,l){const m=p.transform,v=m.projection.name==="mercator"||m.projection.name==="globe"?1:o.smoothstep(7,8,m.zoom),b=l.paint.get("sky-opacity")*v;if(b===0)return;const T=p.context,P=l.paint.get("sky-type"),D=new o.DepthMode(T.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),O=p.frameCounter/1e3%1;P==="atmosphere"?p.renderPass==="offscreen"?l.needsSkyboxCapture(p)&&(function(B,U,q,Q){const K=B.context,te=K.gl;let _e=U.skyboxFbo;if(!_e){_e=U.skyboxFbo=K.createFramebuffer(32,32,!1),U.skyboxGeometry=new Ka(K),U.skyboxTexture=K.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,U.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let he=0;he<6;++he)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(_e.framebuffer),K.viewport.set([0,0,32,32]);const J=U.getCenter(B,!0),me=B.useProgram("skyboxCapture"),pe=new Float64Array(16);o.identity(pe),o.rotateY(pe,pe,.5*-Math.PI),Zo(K,U,me,pe,J,0),o.identity(pe),o.rotateY(pe,pe,.5*Math.PI),Zo(K,U,me,pe,J,1),o.identity(pe),o.rotateX(pe,pe,.5*-Math.PI),Zo(K,U,me,pe,J,2),o.identity(pe),o.rotateX(pe,pe,.5*Math.PI),Zo(K,U,me,pe,J,3),o.identity(pe),Zo(K,U,me,pe,J,4),o.identity(pe),o.rotateY(pe,pe,Math.PI),Zo(K,U,me,pe,J,5),K.viewport.set([0,0,B.width,B.height])}(p,l),l.markSkyboxValid(p)):p.renderPass==="sky"&&function(B,U,q,Q,K){const te=B.context,_e=te.gl,J=B.transform,me=B.useProgram("skybox");te.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_CUBE_MAP,U.skyboxTexture);const pe=((he,fe,ye,Le,Ue)=>({u_matrix:he,u_sun_direction:fe,u_cubemap:0,u_opacity:Le,u_temporal_offset:Ue}))(J.skyboxMatrix,U.getCenter(B,!1),0,Q,K);B.prepareDrawProgram(te,me),me.draw(te,_e.TRIANGLES,q,o.StencilMode.disabled,B.colorModeForRenderPass(),o.CullFaceMode.backCW,pe,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(p,l,D,b,O):P==="gradient"&&p.renderPass==="sky"&&function(B,U,q,Q,K){const te=B.context,_e=te.gl,J=B.transform,me=B.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new Ka(te)),te.activeTexture.set(_e.TEXTURE0);let pe=U.colorRampTexture;pe||(pe=U.colorRampTexture=new o.Texture(te,U.colorRamp,_e.RGBA)),pe.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);const he=((fe,ye,Le,Ue,ht)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:ye,u_radius:o.degToRad(Le),u_opacity:Ue,u_temporal_offset:ht}))(J.skyboxMatrix,U.getCenter(B,!1),U.paint.get("sky-gradient-radius"),Q,K);B.prepareDrawProgram(te,me),me.draw(te,_e.TRIANGLES,q,o.StencilMode.disabled,B.colorModeForRenderPass(),o.CullFaceMode.backCW,he,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(p,l,D,b,O)},debug:function(p,n,l){for(let m=0;m<l.length;m++)Su(p,n,l[m])},custom:function(p,n,l){const m=p.context,v=l.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(p.renderPass==="offscreen"){const b=v.prerender;b&&(p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),b.call(v,m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),m.setStencilMode(o.StencilMode.disabled);const b=v.renderingMode==="3d"?new o.DepthMode(p.context.gl.LEQUAL,o.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,o.DepthMode.ReadOnly);m.setDepthMode(b),v.render(m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState(),m.bindFramebuffer.set(null)}}};class Sc{constructor(n,l){this.context=new yi(n),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new jo,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,l){const m=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new $o(this,n));const v=this._terrain;this.transform.elevation=m?v:null,v.update(n,this.transform,l)}_updateFog(n){const l=n.fog;if(!l||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,v]=l.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);const b=m+.78*(v-m);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,l){if(this.width=n*o.exported.devicePixelRatio,this.height=l*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const n=this.context,l=new o.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(o.EXTENT,0),l.emplaceBack(0,o.EXTENT),l.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(l,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const m=new o.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(o.EXTENT,0),m.emplaceBack(0,o.EXTENT),m.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=n.createVertexBuffer(m,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const v=new o.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(v,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const b=new o.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(o.EXTENT,0,o.EXTENT,0),b.emplaceBack(0,o.EXTENT,0,o.EXTENT),b.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(b,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const T=new o.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(T);const P=new o.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])P.emplaceBack(O);this.debugIndexBuffer=n.createIndexBuffer(P),this.emptyTexture=new o.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA),this.identityMat=o.create();const D=this.context.gl;this.stencilClearMode=new o.StencilMode({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(o.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,l=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,l.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,wr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,l,m){if(!l||this.currentStencilSource===l.id||!n.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const D of m)if(this._tileClippingMaskIDs[D.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=l.id;const v=this.context,b=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(o.ColorMode.disabled),v.setDepthMode(o.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of m){const D=l.getTile(P),O=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:U,tileBoundsSegments:q}=this.getTileBoundsBuffers(D);T.draw(v,b.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:b.ALWAYS,mask:0},O,255,b.KEEP,b.KEEP,b.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,wr(P.projMatrix),"$clipping",B,U,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new o.StencilMode({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const l=this.context.gl;return new o.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(n){const l=this.context.gl,m=n.sort((T,P)=>P.overscaledZ-T.overscaledZ),v=m[m.length-1].overscaledZ,b=m[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let P=0;P<b;P++)T[P+v]=new o.StencilMode({func:l.GEQUAL,mask:255},P+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=b,[T,m]}return[{[v]:o.StencilMode.disabled},m]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([n.CONSTANT_COLOR,n.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(n,l,m){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new o.DepthMode(m||this.context.gl.LEQUAL,l,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,l){this.style=n,this.options=l,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const m=this.style.order,v=this.style._sourceCaches;for(const O in v){const B=v[O];B.used&&B.prepare(this.context)}const b={},T={},P={};for(const O in v){const B=v[O];b[O]=B.getVisibleCoordinates(),T[O]=b[O].slice().reverse(),P[O]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<m.length;O++)if(this.style._layers[m[O]].is3D()){this.opaquePassCutoff=O;break}if(this.terrain&&(this.terrain.updateTileBinding(P),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const O of m){const B=this.style._layers[O],U=n._getLayerSourceCache(B);if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const q=U?T[U.id]:void 0;(B.type==="custom"||B.isSky()||q&&q.length)&&this.renderLayer(this,U,B,q)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let D=o.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(D=this.style.fog.properties.get("color")),this.context.clear({color:l.showOverdrawInspector?o.Color.black:D,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[m[this.currentLayer]],B=n._getLayerSourceCache(O);if(O.isSky())continue;const U=B?T[B.id]:void 0;this._renderTileClippingMasks(O,B,U),this.renderLayer(this,B,O,U)}if(this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const O=this.style._layers[m[this.currentLayer]],B=n._getLayerSourceCache(O);O.isSky()&&this.renderLayer(this,B,O,B?T[B.id]:void 0)}for(this.transform.projection.name==="globe"&&function(O){const B=O.context,U=B.gl,q=O.transform,Q=new o.DepthMode(U.LEQUAL,o.DepthMode.ReadOnly,[0,1]),K=O.useProgram("globeAtmosphere"),te=q._camera.getWorldToCamera(q.worldSize,1),_e=q._camera.getCameraToClipPerspective(q._fov,q.width/q.height,q._nearZ,q._farZ),J=o.mul([],te,o.calculateGlobeMatrix(q,q.worldSize)),me=o.mul([],q.labelPlaneMatrix,_e),pe=o.transformMat4([],[0,0,0],J),he=o.add([],pe,[q.worldSize/Math.PI/2,0,0]),fe=o.transformMat4([],pe,me),ye=o.transformMat4([],he,me),Le=o.length(o.sub([],ye,fe)),Ue=1-o.globeToMercatorTransition(q.zoom),ht={u_center:fe,u_radius:Le,u_screen_size:[q.width,q.height],u_pixel_ratio:o.exported.devicePixelRatio,u_opacity:Ue,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};O.prepareDrawProgram(B,K);const ot=O.globeSharedBuffers;ot&&K.draw(B,U.TRIANGLES,Q,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,ht,"skybox",ot.atmosphereVertexBuffer,ot.atmosphereIndexBuffer,ot.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const O=this.style._layers[m[this.currentLayer]],B=n._getLayerSourceCache(O);if(O.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(O)){if(O.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const U=B?(O.type==="symbol"?P:T)[B.id]:void 0;this._renderTileClippingMasks(O,B,B?b[B.id]:void 0),this.renderLayer(this,B,O,U),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let O=null;o.values(this.style._layers).forEach(B=>{const U=n._getLayerSourceCache(B);U&&!B.isHidden(this.transform.zoom)&&(!O||O.getSource().maxzoom<U.getSource().maxzoom)&&(O=U)}),O&&this.options.showTileBoundaries&&Ja.debug(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const B=O.transform.padding;Ti(O,O.transform.height-(B.top||0),3,ha),Ti(O,B.bottom||0,3,xd),Ds(O,B.left||0,3,Ll),Ds(O,O.transform.width-(B.right||0),3,Rl);const U=O.transform.centerPoint;(function(q,Q,K,te){So(q,Q-1,K-10,2,20,te),So(q,Q-10,K-1,20,2,te)})(O,U.x,O.transform.height-U.y,Ec)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,l,m,v){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(m.type)||Ja[m.type](n,l,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let m=this.gpuTimers[n.id];m||(m=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),m.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,m.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}queryGpuTimers(n){const l={};for(const m in n){const v=n[m],b=this.context.extTimerQuery,T=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),l[m]=T}return l}translatePosMatrix(n,l,m,v,b){if(!m[0]&&!m[1])return n;const T=b?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(T){const O=Math.sin(T),B=Math.cos(T);m=[m[0]*B-m[1]*O,m[0]*O+m[1]*B]}const P=[b?m[0]:gt(l,m[0],this.transform.zoom),b?m[1]:gt(l,m[1],this.transform.zoom),0],D=new Float32Array(16);return o.translate(D,n,P),D}saveTileTexture(n){const l=this._tileTextures[n.size[0]];l?l.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const l=this.imageManager.getPattern(n.from.toString()),m=this.imageManager.getPattern(n.to.toString());return!l||!m}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),l&&!n&&l.getOpacity(this.transform.pitch)!==0&&m.push("FOG"),n&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(n,l,m){this.cache=this.cache||{};const v=m||[],b=this.currentGlobalDefines().concat(v),T=gs.cacheKey(n,b,l);return this.cache[T]||(this.cache[T]=new gs(this.context,n,fc[n],l,vh[n],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(n){this.terrain&&this.terrain.prepareDrawTile(n)}prepareDrawProgram(n,l,m){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch);b!==0&&l.setFogUniformValues(n,((T,P,D,O)=>{const B=P.properties.get("color"),U=T.frameCounter/1e3%1,q=[B.r/B.a,B.g/B.a,B.b/B.a,O];return{u_fog_matrix:D?T.transform.calculateFogTileMatrix(D):T.identityMat,u_fog_range:P.getFovAdjustedRange(T.transform._fov),u_fog_color:q,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_temporal_offset:U}})(this,v,m,b))}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,l=n.createTexture();return n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,l=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const v of m)l[v.key]=n[v.key]||new o.Tile(v,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class Ol{constructor(n=0,l=0,m=0,v=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=m,this.right=v}interpolate(n,l,m){return l.top!=null&&n.top!=null&&(this.top=o.number(n.top,l.top,m)),l.bottom!=null&&n.bottom!=null&&(this.bottom=o.number(n.bottom,l.bottom,m)),l.left!=null&&n.left!=null&&(this.left=o.number(n.left,l.left,m)),l.right!=null&&n.right!=null&&(this.right=o.number(n.right,l.right,m)),this}getCenter(n,l){const m=o.clamp((this.left+n-this.right)/2,0,n),v=o.clamp((this.top+l-this.bottom)/2,0,l);return new o.pointGeometry(m,v)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Ol(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ls(p,n){const l=o.getColumn(p,3);o.fromQuat(p,n),o.setColumn(p,3,l)}function xh(p,n){o.setColumn(p,3,[n[0],n[1],n[2],1])}function Mc(p,n){const l=o.identity$1([]);return o.rotateZ$1(l,l,-n),o.rotateX$1(l,l,-p),l}function Cc(p,n){const l=[p[0],p[1],0],m=[n[0],n[1],0];if(o.length(l)>=1e-15){const T=o.normalize([],l);o.scale$2(m,T,o.dot(m,T)),n[0]=m[0],n[1]=m[1]}const v=o.cross([],n,p);if(o.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return Mc(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}class bh{constructor(n,l){this.position=n,this.orientation=l}get position(){return this._position}set position(n){this._position=this._renderWorldCopies?function(l){if(!l)return;const m=Array.isArray(l)?new o.MercatorCoordinate(l[0],l[1],l[2]):l;return m.x=o.wrap(m.x,0,1),m}(n):n}lookAtPoint(n,l){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(n)):0,v=this.position,b=o.MercatorCoordinate.fromLngLat(n,m),T=[b.x-v.x,b.y-v.y,b.z-v.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Cc(T,l)}setPitchBearing(n,l){this.orientation=Mc(o.degToRad(n),o.degToRad(-l))}}class Di{constructor(n,l){this._transform=o.identity([]),this._orientation=o.identity$1([]),l&&(this._orientation=l,Ls(this._transform,this._orientation)),n&&xh(this._transform,n)}get mercatorPosition(){const n=this.position;return new o.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=o.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){xh(this._transform,n)}get orientation(){return this._orientation}set orientation(n){this._orientation=n,Ls(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,l){this._orientation=Mc(n,l),Ls(this._transform,this._orientation)}forward(){const n=o.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,l){const m=new Float64Array(16);return o.invert(m,this.getWorldToCamera(n,l)),m}getWorldToCameraPosition(n,l,m){const v=this.position;o.scale$2(v,v,-n);const b=new Float64Array(16);return o.fromScaling(b,[m,m,m]),o.translate(b,b,v),b[10]*=l,b}getWorldToCamera(n,l){const m=new Float64Array(16),v=new Float64Array(4),b=this.position;return o.conjugate(v,this._orientation),o.scale$2(b,b,-n),o.fromQuat(m,v),o.translate(m,m,b),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=l,m[9]*=l,m[10]*=l,m[11]*=l,m}getCameraToClipPerspective(n,l,m,v){const b=new Float64Array(16);return o.perspective(b,n,l,m,v),b}getDistanceToElevation(n){const l=n===0?0:o.mercatorZfromAltitude(n,this.position[1]),m=this.forward();return(l-this.position[2])/m[2]}clone(){return new Di([...this.position],[...this.orientation])}}function wh(p,n){const l=Bl(p),m=function(b,T,P,D,O){const B=new o.LngLat(P.lng-180*oo,P.lat),U=new o.LngLat(P.lng+180*oo,P.lat),q=b.project(B.lng,B.lat),Q=b.project(U.lng,U.lat),K=-Math.atan2(Q.y-q.y,Q.x-q.x),te=o.MercatorCoordinate.fromLngLat(P);te.y=o.clamp(te.y,-.999975,.999975);const _e=te.toLngLat(),J=b.project(_e.lng,_e.lat),me=o.MercatorCoordinate.fromLngLat(_e);me.x+=oo;const pe=me.toLngLat(),he=b.project(pe.lng,pe.lat),fe=Cu(he.x-J.x,he.y-J.y,K),ye=o.MercatorCoordinate.fromLngLat(_e);ye.y+=oo;const Le=ye.toLngLat(),Ue=b.project(Le.lng,Le.lat),ht=Cu(Ue.x-J.x,Ue.y-J.y,K),ot=Math.abs(fe.x)/Math.abs(ht.y),nt=o.identity([]);o.rotateZ(nt,nt,-K*(1-(O?0:D)));const qe=o.identity([]);return o.scale(qe,qe,[1,1-(1-ot)*D,1]),qe[4]=-ht.x/ht.y*D,o.rotateZ(qe,qe,K),o.multiply$1(qe,nt,qe),qe}(p.projection,0,p.center,l,n),v=Rs(p);return o.scale(m,m,[v,v,1]),m}function Rs(p){const n=p.projection,l=Bl(p),m=Mu(n,p.center),v=Mu(n,o.LngLat.convert(n.center));return Math.pow(2,m*l+(1-l)*v)}function Bl(p){const n=p.projection.range;if(!n)return 0;const l=Math.max(p.width,p.height),m=Math.log(l/1024)/Math.LN2;return o.smoothstep(n[0]+m,n[1]+m,p.zoom)}const oo=1/4e4;function Mu(p,n){const l=o.clamp(n.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),m=new o.LngLat(n.lng-180*oo,l),v=new o.LngLat(n.lng+180*oo,l),b=p.project(m.lng,l),T=p.project(v.lng,l),P=o.MercatorCoordinate.fromLngLat(m),D=o.MercatorCoordinate.fromLngLat(v),O=T.x-b.x,B=T.y-b.y,U=D.x-P.x,q=D.y-P.y,Q=Math.sqrt((U*U+q*q)/(O*O+B*B));return Math.log(Q)/Math.LN2}function Cu(p,n,l){const m=Math.cos(l),v=Math.sin(l);return{x:p*m-n*v,y:p*v+n*m}}class da{constructor(n,l,m,v,b){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=m??0,this._maxPitch=v??60,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ol,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Di,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const n=new da(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.setProjection(this.getProjection()),n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n.tileSize=this.tileSize,n.setMaxBounds(this.getMaxBounds()),n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._cameraZoom=this._cameraZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,n?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(n){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),n&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(n){n==null&&(n={name:"mercator"}),this.projectionOptions=n;const l=this.projection?this.getProjection():void 0;return this.projection=o.getProjection(n),!de(l,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const l=-n*Math.PI/180;var m;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(m=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(v,b,T){var P=b[0],D=b[1],O=b[2],B=b[3],U=Math.sin(T),q=Math.cos(T);v[0]=P*q+O*U,v[1]=D*q+B*U,v[2]=P*-U+O*q,v[3]=D*-U+B*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const l=o.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(n){const l=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return n===-1?(this._cameraZoom=null,!1):(this._centerAltitude=n,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let v=0,b=0;for(let T=0;T<l.length;T++){const P=new o.pointGeometry(l[T][0]*this.width,m+l[T][1]*(this.height-m)),D=n.pointCoordinate(P);if(!D)continue;const O=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);v+=D[3]*O,b+=O}return b===0?NaN:v/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const n=this._cameraZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*l,v=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(v-m,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let m;m=n.z<this._camera.position[2]?[l.x,l.y,l.z]:[n.x,n.y,n.z];const v=o.length(o.sub([],this._camera.position,m));return o.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let l=!1;if(n.orientation&&!o.exactEquals(n.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(n.orientation)),n.position){const m=[n.position.x,n.position.y,n.position.z];o.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,l=new bh;return l.position=new o.MercatorCoordinate(n[0],n[1],n[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(n){if(!o.length$1(n))return!1;o.normalize$1(n,n);const l=o.transformQuat([],[0,0,-1],n),m=o.transformQuat([],[0,-1,0],n);if(m[2]<0)return!1;const v=Cc(l,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(n){const l=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;n[2]=o.clamp(n[2],v/m,v/l),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,m){this._unmodified=!1,this._edgeInsets.interpolate(n,l,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const l=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(n){const l=[new o.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const m=this.pointCoordinate(new o.pointGeometry(0,0)),v=this.pointCoordinate(new o.pointGeometry(this.width,0)),b=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new o.pointGeometry(0,this.height)),P=Math.floor(Math.min(m.x,v.x,b.x,T.x)),D=Math.floor(Math.max(m.x,v.x,b.x,T.x)),O=1;for(let B=P-O;B<=D+O;B++)B!==0&&l.push(new o.UnwrappedTileID(B,n))}return l}coveringTiles(n){let l=this.coveringZoomLevel(n);const m=l,v=this.elevation&&!n.isTerrainDEM,b=this.projection.name==="mercator";if(n.minzoom!==void 0&&l<n.minzoom)return[];n.maxzoom!==void 0&&l>n.maxzoom&&(l=n.maxzoom);const T=this.locationCoordinate(this.center),P=1<<l,D=[P*T.x,P*T.y,0],O=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.name!=="globe"),B=this.pointCoordinate(this.getCameraPoint()),U=P*o.mercatorZfromAltitude(1,this.center.lat),q=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),Q=[P*B.x,P*B.y,q],K=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,_e=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,J=n.isTerrainDEM?-_e:this._elevation?this._elevation.getMinElevationBelowMSL():0,me=this.projection.isReprojectedInTileSpace?Rs(this):1,pe=Ne=>{const Ye=new o.MercatorCoordinate(Ne.x+25e-6,Ne.y,Ne.z),Rt=new o.MercatorCoordinate(Ne.x,Ne.y+25e-6,Ne.z),Gt=Ne.toLngLat(),ln=Ye.toLngLat(),ft=Rt.toLngLat(),Ft=this.locationCoordinate(Gt),Kt=this.locationCoordinate(ln),zn=this.locationCoordinate(ft),Wn=Math.hypot(Kt.x-Ft.x,Kt.y-Ft.y),Xt=Math.hypot(zn.x-Ft.x,zn.y-Ft.y);return Math.sqrt(Wn*Xt)*me/25e-6},he=Ne=>{const tt=_e,Ye=J;return{aabb:o.tileAABB(this,P,0,0,0,Ne,Ye,tt,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:tt,wrap:Ne,fullyVisible:!1}},fe=[];let ye=[];const Le=l,Ue=n.reparseOverscaled?m:l,ht=Ne=>Ne*Ne,ot=ht((q-this._centerAltitude)*U),nt=Ne=>{if(!this._elevation||!Ne.tileID||!b)return;const tt=this._elevation.getMinMaxForTile(Ne.tileID),Ye=Ne.aabb;tt?(Ye.min[2]=tt.min,Ye.max[2]=tt.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(Ne.shouldSplit=qe(Ne),Ne.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},qe=Ne=>{if(Ne.zoom<te)return!0;if(Ne.zoom===Le)return!1;if(Ne.shouldSplit!=null)return Ne.shouldSplit;const tt=Ne.aabb.distanceX(Q),Ye=Ne.aabb.distanceY(Q);let Rt=ot;v&&(Rt=ht(Ne.aabb.distanceZ(Q)*U));let Gt=1;if(this.projection.isReprojectedInTileSpace&&m<=5){const ft=Math.pow(2,Ne.zoom),Ft=pe(new o.MercatorCoordinate((Ne.x+.5)/ft,(Ne.y+.5)/ft));Gt=Ft>.85?1:Ft}const ln=tt*tt+Ye*Ye+Rt;return ln<ht((1<<Le-Ne.zoom)*K*Gt*((ft,Ft)=>{if(Ft*ht(.707)<ft)return 1;const Kt=Math.sqrt(Ft/ft);return Kt/(1.4144271570014144+(Math.pow(1.1,Kt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Rt,ot),ln))};if(this.renderWorldCopies)for(let Ne=1;Ne<=3;Ne++)fe.push(he(-Ne)),fe.push(he(Ne));for(fe.push(he(0));fe.length>0;){const Ne=fe.pop(),tt=Ne.x,Ye=Ne.y;let Rt=Ne.fullyVisible;if(!Rt){const Gt=Ne.aabb.intersects(O);if(Gt===0)continue;Rt=Gt===2}if(Ne.zoom!==Le&&qe(Ne))for(let Gt=0;Gt<4;Gt++){const ln=(tt<<1)+Gt%2,ft=(Ye<<1)+(Gt>>1),Ft={aabb:b?Ne.aabb.quadrant(Gt):o.tileAABB(this,P,Ne.zoom+1,ln,ft,Ne.wrap,Ne.minZ,Ne.maxZ,this.projection),zoom:Ne.zoom+1,x:ln,y:ft,wrap:Ne.wrap,fullyVisible:Rt,tileID:void 0,shouldSplit:void 0,minZ:Ne.minZ,maxZ:Ne.maxZ};v&&(Ft.tileID=new o.OverscaledTileID(Ne.zoom+1===Le?Ue:Ne.zoom+1,Ne.wrap,Ne.zoom+1,ln,ft),nt(Ft)),fe.push(Ft)}else{const Gt=Ne.zoom===Le?Ue:Ne.zoom;if(n.minzoom&&n.minzoom>Gt)continue;const ln=D[0]-(.5+tt+(Ne.wrap<<Ne.zoom))*(1<<l-Ne.zoom),ft=D[1]-.5-Ye,Ft=Ne.tileID?Ne.tileID:new o.OverscaledTileID(Gt,Ne.wrap,Ne.zoom,tt,Ye);ye.push({tileID:Ft,distanceSq:ln*ln+ft*ft})}}if(this.fogCullDistSq){const Ne=this.fogCullDistSq,tt=this.horizonLineFromTop();ye=ye.filter(Ye=>{const Rt=[0,0,0,1],Gt=[o.EXTENT,o.EXTENT,0,1],ln=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());o.transformMat4$1(Rt,Rt,ln),o.transformMat4$1(Gt,Gt,ln);const ft=o.getAABBPointSquareDist(Rt,Gt);if(ft===0)return!0;let Ft=!1;const Kt=this._elevation;if(Kt&&ft>Ne&&tt!==0){const zn=this.calculateProjMatrix(Ye.tileID.toUnwrapped());let Wn;n.isTerrainDEM||(Wn=Kt.getMinMaxForTile(Ye.tileID)),Wn||(Wn={min:J,max:_e});const Xt=o.furthestTileCorner(this.rotation),gn=[Xt[0]*o.EXTENT,Xt[1]*o.EXTENT,Wn.max];o.transformMat4(gn,gn,zn),Ft=(1-gn[1])*this.height*.5<tt}return ft<Ne||Ft})}return ye.sort((Ne,tt)=>Ne.distanceSq-tt.distanceSq).map(Ne=>Ne.tileID)}resize(n,l){this.width=n,this.height=l,this.pixelsToGLUnits=[2/n,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const l=o.clamp(n.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),m=this.projection.project(n.lng,l);return new o.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,l){const m=this.pointCoordinate(l),v=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(n);this.setLocation(new o.MercatorCoordinate(b.x-(m.x-v.x),b.y-(m.y-v.y)))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this._coordinatePoint(this.locationCoordinate(n),!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,l){const m=l?o.mercatorZfromAltitude(l,n.lat):void 0,v=this.projection.project(n.lng,n.lat);return new o.MercatorCoordinate(v.x,v.y,m)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,l){const m=l??this._centerAltitude,v=[n.x,n.y,0,1],b=[n.x,n.y,1,1];o.transformMat4$1(v,v,this.pixelMatrixInverse),o.transformMat4$1(b,b,this.pixelMatrixInverse);const T=b[3];o.scale$1(v,v,1/v[3]),o.scale$1(b,b,1/T);const P=v[2],D=b[2];return{p0:v,p1:b,t:P===D?0:(m-P)/(D-P)}}screenPointToMercatorRay(n){const l=[n.x,n.y,0,1],m=[n.x,n.y,1,1];return o.transformMat4$1(l,l,this.pixelMatrixInverse),o.transformMat4$1(m,m,this.pixelMatrixInverse),o.scale$1(l,l,1/l[3]),o.scale$1(m,m,1/m[3]),l[2]=o.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,m[2]=o.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,o.scale$1(l,l,1/this.worldSize),o.scale$1(m,m,1/this.worldSize),new o.Ray([l[0],l[1],l[2]],o.normalize([],o.sub([],m,l)))}rayIntersectionCoordinate(n){const{p0:l,p1:m,t:v}=n,b=o.mercatorZfromAltitude(l[2],this._center.lat),T=o.mercatorZfromAltitude(m[2],this._center.lat);return new o.MercatorCoordinate(o.number(l[0],m[0],v)/this.worldSize,o.number(l[1],m[1],v)/this.worldSize,o.number(b,T,v))}pointCoordinate(n,l=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(n.x,n.y,l)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);const l=this.elevation;let m=this.elevation.pointCoordinate(n);if(m)return new o.MercatorCoordinate(m[0],m[1],m[2]);let v=0,b=this.horizonLineFromTop();if(n.y>b)return this.pointCoordinate(n);const T=.02*b,P=n.clone();for(let D=0;D<10&&b-v>T;D++){P.y=o.number(v,b,.66);const O=l.pointCoordinate(P);O?(b=P.y,m=O):v=P.y}return m?new o.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){if(this.elevation)return!this.elevation.pointCoordinate(n);{const l=this.horizonLineFromTop();return n.y<l}}_coordinatePoint(n,l){const m=l&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,v=[n.x*this.worldSize,n.y*this.worldSize,m+n.toAltitude(),1];return o.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new o.pointGeometry(v[0]/v[3],v[1]/v[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(n,l){const m=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let P=this.pointCoordinate(m,n),D=this.pointCoordinate(v,n);const O=this.pointCoordinate(b,l),B=this.pointCoordinate(T,l),U=(q,Q)=>(Q.y-q.y)/(Q.x-q.x);return P.y>1&&D.y>=0?P=new o.MercatorCoordinate((1-B.y)/U(B,P)+B.x,1):P.y<0&&D.y<=1&&(P=new o.MercatorCoordinate(-B.y/U(B,P)+B.x,0)),D.y>1&&P.y>=0?D=new o.MercatorCoordinate((1-O.y)/U(O,D)+O.x,1):D.y<0&&P.y<=1&&(D=new o.MercatorCoordinate(-O.y/U(O,D)+O.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(P)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(O))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length)return this._getBounds(0,0);const l=n.visibleDemTiles.reduce((m,v)=>{if(v.dem){const b=v.dem.tree;m.min=Math.min(m.min,b.minimums[0]),m.max=Math.max(m.max,b.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*n.exaggeration(),l.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-l*(1-this._horizonShift);return n?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,l){return this.projection.createTileTransform(this,l).createTileMatrix(n)}calculateDistanceTileData(n){const l=n.key,m=this._distanceTileDataCache;if(m[l])return m[l];const v=n.canonical,b=1/this.height,T=this.cameraWorldSize/this.zoomScale(v.z),P=(v.x+Math.pow(2,v.z)*n.wrap)*T,D=v.y*T,O=this.point,B=this.angle,U=Math.sin(-B),q=-Math.cos(-B);return m[l]={bearing:[U,q],center:[(O.x-P)*b,(O.y-D)*b],scale:T/o.EXTENT*b},m[l]}calculateFogTileMatrix(n){const l=n.key,m=this._fogTileMatrixCache;if(m[l])return m[l];const v=this.calculatePosMatrix(n,this.cameraWorldSize);return o.multiply$1(v,this.worldToFogMatrix,v),m[l]=new Float32Array(v),m[l]}calculateProjMatrix(n,l=!1){const m=n.key,v=l?this._alignedProjMatrixCache:this._projMatrixCache;if(v[m])return v[m];const b=this.calculatePosMatrix(n,this.worldSize);return o.multiply$1(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,b),v[m]=new Float32Array(b),v[m]}calculatePixelsToTileUnitsMatrix(n){const l=n.tileID.key,m=this._pixelsToTileUnitsCache;if(m[l])return m[l];const v=function(b,T){const{scale:P}=b.tileTransform,D=P*o.EXTENT/(b.tileSize*Math.pow(2,T.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return O=new Float32Array(4),q=(B=T.inverseAdjustmentMatrix)[1],Q=B[2],K=B[3],_e=(U=[D,D])[1],O[0]=B[0]*(te=U[0]),O[1]=q*te,O[2]=Q*_e,O[3]=K*_e,O;var O,B,U,q,Q,K,te,_e}(n,this);return m[l]=v,m[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const l=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(l),v=this._camera.forward(),b=o.mercatorZfromAltitude(1,this._center.lat);m[2]/=b,v[2]/=b,o.normalize(v,v);const T=n.raycast(m,v,n.exaggeration());if(T){const P=o.scaleAndAdd([],m,v,T),D=new o.MercatorCoordinate(P[0],P[1],o.mercatorZfromAltitude(P[2],o.latFromMercatorY(P[1]))),O=(D.z+o.length([D.x-m[0],D.y-m[1],D.z-m[2]*b]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(O),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const l=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(l),v=n.getAtPointOrZero(new o.MercatorCoordinate(...m)),b=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),T=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*v;if(T<b){const P=this.locationCoordinate(this._center,this._centerAltitude),D=[P.x-m[0],P.y-m[1],P.z-m[2]],O=o.length(D);D[2]-=(b-T)/this._projectionScaler;const B=o.length(D);if(B===0)return;o.scale$2(D,D,O/B*this._projectionScaler),this._camera.position=[P.x-D[0],P.y-D[1],P.z*this._projectionScaler-D[2]],this._camera.orientation=Cc(D,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const U=this.center;return U.lat=o.clamp(U.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(U.lng=o.clamp(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const n=this._unmodified,{x:l,y:m}=this.point;let v=0,b=l,T=m;const P=this.width/2,D=this.height/2,O=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(m-D<O&&(T=O+D),m+D>B&&(T=B-D),B-O<this.height&&(v=Math.max(v,this.height/(B-O)),T=(B+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,Q=this.worldSize/2-(U+q)/2;b=(l+Q+this.worldSize)%this.worldSize-Q,b-P<U&&(b=U+P),b+P>q&&(b=q-P),q-U<this.width&&(v=Math.max(v,this.width/(q-U)),b=(q+U)/2)}b===l&&T===m||(this.center=this.unproject(new o.pointGeometry(b,T))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this._fov/2,l=this.centerOffset,m=this.pixelsPerMeter;this._projectionScaler=m/(o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(n)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?m:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-l.x/this.width,b[9]=2*l.y/this.height;let T=o.mul([],b,v);if(this.projection.isReprojectedInTileSpace){const he=this.locationCoordinate(this.center),fe=o.identity([]);o.translate(fe,fe,[he.x*this.worldSize,he.y*this.worldSize,0]),o.multiply$1(fe,fe,wh(this)),o.translate(fe,fe,[-he.x*this.worldSize,-he.y*this.worldSize,0]),o.multiply$1(T,T,fe),this.inverseAdjustmentMatrix=function(ye){const Le=wh(ye,!0);return $([],[Le[0],Le[1],Le[4],Le[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],T,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=T,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const P=new Float32Array(16);o.identity(P),o.scale(P,P,[1,-1,1]),o.rotateX(P,P,this._pitch),o.rotateZ(P,P,this.angle);const D=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;D[8]=2*-l.x/this.width,D[9]=2*(l.y+O)/this.height,this.skyboxMatrix=o.multiply$1(P,D,P);const B=this.point,U=B.x,q=B.y,Q=this.width%2/2,K=this.height%2/2,te=Math.cos(this.angle),_e=Math.sin(this.angle),J=U-Math.round(U)+te*Q+_e*K,me=q-Math.round(q)+te*K+_e*Q,pe=new Float64Array(T);if(o.translate(pe,pe,[J>.5?J-1:J,me>.5?me-1:me,0]),this.alignedProjMatrix=pe,T=o.create(),o.scale(T,T,[this.width/2,-this.height/2,1]),o.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=o.create(),o.scale(T,T,[1,-1,1]),o.translate(T,T,[-1,-1,0]),o.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=o.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=o.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");this.pixelMatrixInverse=T,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,l=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height,b=[n,n,l];o.scale$2(b,b,v),o.scale$2(m,m,-1),o.multiply$2(m,m,b);const T=o.create();o.translate(T,T,m),o.scale(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,l,v)}_computeCameraPosition(n){const l=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*l-n/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*b,v.y/this.worldSize-m[1]*b,n/this.worldSize*this._centerAltitude-m[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=n[2];let v=1;m>0&&(v=Math.min((l-this._camera.position[2])/m,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,n,v),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,l=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),b=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),P=Math.max((n[2]-b)/Math.cos(m),T),D=this._zoomFromMercatorZ(P);o.scaleAndAdd(n,n,l,P),this._pitch=o.clamp(m,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(v,-Math.PI,Math.PI),this._setZoom(o.clamp(D,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new o.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(n,l){const m=Math.min(n.x,l.x),v=Math.max(n.x,l.x),b=Math.min(n.y,l.y),T=Math.max(n.y,l.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const P=[new o.pointGeometry(m,b),new o.pointGeometry(v,T),new o.pointGeometry(m,T),new o.pointGeometry(v,b)],D=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const B of P){const U=this.pointRayIntersection(B);if(U.t<0)return!0;const q=this.rayIntersectionCoordinate(U);if(q.x<D||q.y<0||q.x>O||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,l){const m=o.length(o.sub([],this._camera.position,n)),v=this._zoomFromMercatorZ(m)+l;return m-this._mercatorZfromZoom(v)}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,n))}}function Os(p,n){let l=!1,m=null;const v=()=>{m=null,l&&(p(),m=setTimeout(v,n),l=!1)};return()=>(l=!0,m||v(),m)}class fa{constructor(n){this._hashName=n&&encodeURIComponent(n),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Os(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,o.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return o.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(n){const l=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),T=Math.round(l.lng*b)/b,P=Math.round(l.lat*b)/b,D=this._map.getBearing(),O=this._map.getPitch();let B="";if(B+=n?`/${T}/${P}/${m}`:`${m}/${P}/${T}`,(D||O)&&(B+="/"+Math.round(10*D)/10),O&&(B+=`/${Math.round(O)}`),this._hashName){const U=this._hashName;let q=!1;const Q=o.window.location.hash.slice(1).split("&").map(K=>{const te=K.split("=")[0];return te===U?(q=!0,`${te}=${B}`):K}).filter(K=>K);return q||Q.push(`${U}=${B}`),`#${Q.join("&")}`}return`#${B}`}_getCurrentHash(){const n=o.window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(l=m)}),(l&&l[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._getCurrentHash();if(n.length>=3&&!n.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:l,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,n)}}const Mo={linearity:.3,easing:o.bezier(0,0,.3,1)},Go=o.extend({deceleration:2500,maxSpeed:1400},Mo),Pu=o.extend({deceleration:20,maxSpeed:1400},Mo),Iu=o.extend({deceleration:1e3,maxSpeed:360},Mo),kn=o.extend({deceleration:1e3,maxSpeed:90},Mo);class Qa{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=o.exported.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)l.zoom+=b.zoomDelta||0,l.bearing+=b.bearingDelta||0,l.pitch+=b.pitchDelta||0,b.panDelta&&l.pan._add(b.panDelta),b.around&&(l.around=b.around),b.pinchAround&&(l.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(l.pan.mag()){const b=Fl(l.pan.mag(),m,o.extend({},Go,n||{}));v.offset=l.pan.mult(b.amount/l.pan.mag()),v.center=this._map.transform.center,Bs(v,b)}if(l.zoom){const b=Fl(l.zoom,m,Pu);v.zoom=this._map.transform.zoom+b.amount,Bs(v,b)}if(l.bearing){const b=Fl(l.bearing,m,Iu);v.bearing=this._map.transform.bearing+o.clamp(b.amount,-179,179),Bs(v,b)}if(l.pitch){const b=Fl(l.pitch,m,kn);v.pitch=this._map.transform.pitch+b.amount,Bs(v,b)}if(v.zoom||v.bearing){const b=l.pinchAround===void 0?l.around:l.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),o.extend(v,{noMoveStart:!0})}}function Bs(p,n){(!p.duration||p.duration<n.duration)&&(p.duration=n.duration,p.easing=n.easing)}function Fl(p,n,l){const{maxSpeed:m,linearity:v,deceleration:b}=l,T=o.clamp(p*v/(n/1e3),-m,m),P=Math.abs(T)/(b*v);return{easing:l.easing,duration:1e3*P,amount:T*(P/2)}}class Wr extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,m,v={}){const b=H.mousePos(l.getCanvasContainer(),m),T=l.unproject(b);super(n,o.extend({point:b,lngLat:T,originalEvent:m},v)),this._defaultPrevented=!1,this.target=l}}class Nl extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,m){const v=n==="touchend"?m.changedTouches:m.touches,b=H.touchPos(l.getCanvasContainer(),v),T=b.map(D=>l.unproject(D)),P=b.reduce((D,O,B,U)=>D.add(O.div(U.length)),new o.pointGeometry(0,0));super(n,{points:b,point:P,lngLats:T,lngLat:l.unproject(P),originalEvent:m}),this._defaultPrevented=!1}}class dr extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,m){super(n,{originalEvent:m}),this._defaultPrevented=!1}}class Pc{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new dr(n.type,this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new Wr(n.type,this._map,n))}mouseup(n){this._map.fire(new Wr(n.type,this._map,n))}preclick(n){const l=o.extend({},n);l.type="preclick",this._map.fire(new Wr(l.type,this._map,l))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Wr(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Wr(n.type,this._map,n))}mouseover(n){this._map.fire(new Wr(n.type,this._map,n))}mouseout(n){this._map.fire(new Wr(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Nl(n.type,this._map,n))}touchmove(n){this._map.fire(new Nl(n.type,this._map,n))}touchend(n){this._map.fire(new Nl(n.type,this._map,n))}touchcancel(n){this._map.fire(new Nl(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eh{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(n){this._map.fire(new Wr(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Wr(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Au{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&n.button===0&&(H.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const m=l;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=m,this._box||(this._box=H.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const b=Math.min(v.x,m.x),T=Math.max(v.x,m.x),P=Math.min(v.y,m.y),D=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${P}px)`,this._box.style.width=T-b+"px",this._box.style.height=D-P+"px")})}mouseupWindow(n,l){if(!this._active||n.button!==0)return;const m=this._startPos,v=l;if(this.reset(),H.suppressClick(),m.x!==v.x||m.y!==v.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),H.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new o.Event(n,{originalEvent:l}))}}function pa(p,n){const l={};for(let m=0;m<p.length;m++)l[p[m].identifier]=n[m];return l}class el{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,l,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const b=new o.pointGeometry(0,0);for(const T of v)b._add(T);return b.div(v.length)}(l),this.touches=pa(m,l)))}touchmove(n,l,m){if(this.aborted||!this.centroid)return;const v=pa(m,l);for(const b in this.touches){const T=this.touches[b],P=v[b];(!P||P.dist(T)>30)&&(this.aborted=!0)}}touchend(n,l,m){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class _s{constructor(n){this.singleTap=new el(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,l,m){this.singleTap.touchstart(n,l,m)}touchmove(n,l,m){this.singleTap.touchmove(n,l,m)}touchend(n,l,m){const v=this.singleTap.touchend(n,l,m);if(v){const b=n.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(b&&T||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class tl{constructor(){this._zoomIn=new _s({numTouches:1,numTaps:2}),this._zoomOut=new _s({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,m){this._zoomIn.touchstart(n,l,m),this._zoomOut.touchstart(n,l,m)}touchmove(n,l,m){this._zoomIn.touchmove(n,l,m),this._zoomOut.touchmove(n,l,m)}touchend(n,l,m){const v=this._zoomIn.touchend(n,l,m),b=this._zoomOut.touchend(n,l,m);return v?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(v)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ma={0:1,2:2};class ga{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(n,l){return!1}_move(n,l){return{}}mousedown(n,l){if(this._lastPoint)return;const m=H.mouseButton(n);this._correctButton(n,m)&&(this._lastPoint=l,this._eventButton=m)}mousemoveWindow(n,l){const m=this._lastPoint;if(m){if(n.preventDefault(),function(v,b){const T=ma[b];return v.buttons===void 0||(v.buttons&T)!==T}(n,this._eventButton))this.reset();else if(this._moved||!(l.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(m,l)}}mouseupWindow(n){this._lastPoint&&H.mouseButton(n)===this._eventButton&&(this._moved&&H.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _a extends ga{mousedown(n,l){super.mousedown(n,l),this._lastPoint&&(this._active=!0)}_correctButton(n,l){return l===0&&!n.ctrlKey}_move(n,l){return{around:l,panDelta:l.sub(n)}}}class Li extends ga{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const m=.8*(l.x-n.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(n){n.preventDefault()}}class Ul extends ga{_correctButton(n,l){return l===0&&n.ctrlKey||l===2}_move(n,l){const m=-.5*(l.y-n.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(n){n.preventDefault()}}class Ic{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(n,l,m){return this._calculateTransform(n,l,m)}touchmove(n,l,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.preventDefault(),this._calculateTransform(n,l,m)}}touchend(n,l,m){this._calculateTransform(n,l,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,m){m.length>0&&(this._active=!0);const v=pa(m,l),b=new o.pointGeometry(0,0),T=new o.pointGeometry(0,0);let P=0;for(const O in v){const B=v[O],U=this._touches[O];U&&(b._add(B),T._add(B.sub(U)),P++,v[O]=B)}if(this._touches=v,P<this._minTouches||!T.mag())return;const D=T.div(P);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(P),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class nl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(n){}_move(n,l,m){return{}}touchstart(n,l,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,m){if(!this._firstTwoTouches)return;n.preventDefault();const[v,b]=this._firstTwoTouches,T=qo(m,l,v),P=qo(m,l,b);if(!T||!P)return;const D=this._aroundCenter?null:T.add(P).div(2);return this._move([T,P],D,n)}touchend(n,l,m){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,T=qo(m,l,v),P=qo(m,l,b);T&&P||(this._active&&H.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function qo(p,n,l){for(let m=0;m<p.length;m++)if(p[m].identifier===l)return n[m]}function Ac(p,n){return Math.log(p/n)/Math.LN2}class rl extends nl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const m=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Ac(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ac(this._distance,m),pinchAround:l}}}function ys(p,n){return 180*p.angleWith(n)/Math.PI}class jl extends nl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l){const m=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ys(this._vector,m),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,m=ys(n,this._startVector);return Math.abs(m)<l}}function il(p){return Math.abs(p.y)>Math.abs(p.x)}class Th extends nl{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(n){this._lastPoints=n,il(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,m){const v=n[0].sub(this._lastPoints[0]),b=n[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&m.touches.length<3)&&(this._valid=this.gestureBeginsVertically(v,b,m.timeStamp),this._valid))return this._lastPoints=n,this._active=!0,{pitchDelta:(v.y+b.y)/2*-.5}}gestureBeginsVertically(n,l,m){if(this._valid!==void 0)return this._valid;const v=n.mag()>=2,b=l.mag()>=2;if(!v&&!b)return;if(!v||!b)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const T=n.y>0==l.y>0;return il(n)&&il(l)&&T}}const vs={panStep:100,bearingStep:15,pitchStep:10};class Fs{constructor(){const n=vs;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,m=0,v=0,b=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?m=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?m=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?v=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?v=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:P=>{const D=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:ku,zoom:l?Math.round(D)+l*(n.shiftKey?2:1):D,bearing:P.getBearing()+m*this._bearingStep,pitch:P.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:P.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ku(p){return p*(2-p)}const Ns=4.000244140625;class Vl{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=n.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const m=o.exported.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,l!==0&&l%Ns==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(v*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=H.mousePos(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,l=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>Ns?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&O!==0&&(O=1/O);const B=l(),U=Math.pow(2,B),q=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(q*O))),this._type==="wheel"&&(this._startZoom=l(),this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:l(),v=this._startZoom,b=this._easing;let T,P=!1;if(this._type==="wheel"&&v&&b){const D=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),O=b(D);T=o.number(v,m,O),D<1?this._frameId||(this._frameId=!0):P=!0}else T=m,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:T-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=o.ease;if(this._prevEase){const m=this._prevEase,v=(o.exported.now()-m.start)/m.duration,b=m.easing(v+.01)-m.easing(v),T=.27/Math.sqrt(b*b+1e-4)*.01,P=Math.sqrt(.0729-T*T);l=o.bezier(T,P,.25,1)}return this._prevEase={start:o.exported.now(),duration:n,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!o.window.document.fullscreenElement||!!o.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class xs{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ol{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,l){return n.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(n.shiftKey?-1:1),around:m.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ya{constructor(){this._tap=new _s({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(n,l,m){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=l[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(n,l,m))}touchmove(n,l,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=l[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,l,m)}touchend(n,l,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(n,l,m)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class va{constructor(n,l,m){this._el=n,this._mousePan=l,this._touchPan=m}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class zu{constructor(n,l,m){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=l,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Du{constructor(n,l,m,v){this._el=n,this._touchZoom=l,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Wo=p=>p.zoom||p.drag||p.pitch||p.rotate;class bs extends o.Event{}class lr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,l){const m=o.sub([],l,n);this.radius=o.length(m[2]<0?o.div([],m,this.constants):[m[0],m[1],0])}projectRay(n){o.div(n,n,this.constants),o.normalize(n,n),o.mul$1(n,n,this.constants);const l=o.scale$2([],n,this.radius);if(l[2]>0){const m=o.scale$2([],[0,0,1],o.dot(l,[0,0,1])),v=o.scale$2([],o.normalize([],[l[0],l[1],0]),this.radius),b=o.add([],l,o.scale$2([],o.sub([],o.add([],v,m),l),2));l[0]=b[0],l[1]=b[1]}return l}}function ur(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Yi{constructor(n,l){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qa(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new lr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[v,b,T]of this._listeners)v.addEventListener(b,v===o.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[n,l,m]of this._listeners)n.removeEventListener(l,n===o.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(n){const l=this._map,m=l.getCanvasContainer();this._add("mapEvent",new Pc(l,n));const v=l.boxZoom=new Au(l,n);this._add("boxZoom",v);const b=new tl,T=new ol;l.doubleClickZoom=new xs(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const P=new ya;this._add("tapDragZoom",P);const D=l.touchPitch=new Th(l);this._add("touchPitch",D);const O=new Li(n),B=new Ul(n);l.dragRotate=new zu(n,O,B),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const U=new _a(n),q=new Ic(l,n);l.dragPan=new va(m,U,q),this._add("mousePan",U),this._add("touchPan",q,["touchZoom","touchRotate"]);const Q=new jl,K=new rl;l.touchZoomRotate=new Du(m,K,Q,P),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Eh(l));const te=l.scrollZoom=new Vl(l,this);this._add("scrollZoom",te,["mousePan"]);const _e=l.keyboard=new Fs;this._add("keyboard",_e);for(const J of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[J]&&l[J].enable(n[J])}_add(n,l,m){this._handlers.push({handlerName:n,handler:l,allowed:m}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Wo(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,l,m){for(const v in n)if(v!==m&&(!l||l.indexOf(v)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const l=[];for(const m of n)this._el.contains(m.target)&&l.push(m);return l}handleEvent(n,l){this._updatingCamera=!0;const m=n.type==="renderFrame",v=m?void 0:n,b={needsRenderFrame:!1},T={},P={},D=n.touches?this._getMapTouches(n.touches):void 0,O=D?H.touchPos(this._el,D):m?void 0:H.mousePos(this._el,n);for(const{handlerName:q,handler:Q,allowed:K}of this._handlers){if(!Q.isEnabled())continue;let te;this._blockedByActive(P,K,q)?Q.reset():Q[l||n.type]&&(te=Q[l||n.type](n,O,D),this.mergeHandlerResult(b,T,te,q,v),te&&te.needsRenderFrame&&this._triggerRenderFrame()),(te||Q.isActive())&&(P[q]=Q)}const B={};for(const q in this._previousActiveHandlers)P[q]||(B[q]=v);this._previousActiveHandlers=P,(Object.keys(B).length||ur(b))&&(this._changes.push([b,T,B]),this._triggerRenderFrame()),(Object.keys(P).length||ur(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=b;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(n,l,m,v,b){if(!m)return;o.extend(n,m);const T={handlerName:v,originalEvent:m.originalEvent||b};m.zoomDelta!==void 0&&(l.zoom=T),m.panDelta!==void 0&&(l.drag=T),m.pitchDelta!==void 0&&(l.pitch=T),m.bearingDelta!==void 0&&(l.rotate=T)}_applyChanges(){const n={},l={},m={};for(const[v,b,T]of this._changes)v.panDelta&&(n.panDelta=(n.panDelta||new o.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(n.around=v.around),v.aroundCoord!==void 0&&(n.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(n.pinchAround=v.pinchAround),v.noInertia&&(n.noInertia=v.noInertia),o.extend(l,b),o.extend(m,T);this._updateMapTransform(n,l,m),this._changes=[]}_updateMapTransform(n,l,m){const v=this._map,b=v.transform,T=me=>[me.x,me.y,me.z];if((me=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!ur(n)){const me=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",me!==b.zoom&&this._map._update(!0)}if(!ur(n))return this._fireEvents(l,m,!0);let{panDelta:P,zoomDelta:D,bearingDelta:O,pitchDelta:B,around:U,aroundCoord:q,pinchAround:Q}=n;Q!==void 0&&(U=Q),(me=>l.drag&&!this._eventsInProgress.drag)()&&U&&(this._dragOrigin=T(b.pointCoordinate3D(U)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),U=U||v.transform.centerPoint,O&&(b.bearing+=O),B&&(b.pitch+=B),b._updateCameraState();const K=[0,0,0];if(P){const me=b.pointCoordinate(U),pe=b.pointCoordinate(U.sub(P));me&&pe&&(K[0]=pe.x-me.x,K[1]=pe.y-me.y)}const te=b.zoom,_e=[0,0,0];if(D){const me=T(q||b.pointCoordinate3D(U)),pe={dir:o.normalize([],o.sub([],me,b._camera.position))};if(pe.dir[2]<0){const he=b.zoomDeltaToMovement(me,D);o.scale$2(_e,pe.dir,he)}}const J=o.add(K,K,_e);b._translateCameraConstrained(J),D&&Math.abs(b.zoom-te)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,m,!0)}_fireEvents(n,l,m){const v=Wo(this._eventsInProgress),b=Wo(n),T={};for(const B in n){const{originalEvent:U}=n[B];this._eventsInProgress[B]||(T[`${B}start`]=U),this._eventsInProgress[B]=n[B]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const B in T)this._fireEvent(B,T[B]);b&&this._fireEvent("move",b.originalEvent);for(const B in n){const{originalEvent:U}=n[B];this._fireEvent(B,U)}const P={};let D;for(const B in this._eventsInProgress){const{handlerName:U,originalEvent:q}=this._eventsInProgress[B];this._handlersById[U].isActive()||(delete this._eventsInProgress[B],D=l[U]||q,P[`${B}end`]=D)}for(const B in P)this._fireEvent(B,P[B]);const O=Wo(this._eventsInProgress);if(m&&(v||b)&&!O){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;B?(U(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:D})):(this._map.fire(new o.Event("moveend",{originalEvent:D})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new o.Event(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new bs("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Xr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Si extends o.Evented{constructor(n,l){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=l.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}panBy(n,l,m){return n=o.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,o.extend({offset:n},l),m)}panTo(n,l,m){return this.easeTo(o.extend({center:n},l),m)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,m){return this.easeTo(o.extend({zoom:n},l),m)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,m){return this.easeTo(o.extend({bearing:n},l),m)}resetNorth(n,l){return this.rotateTo(0,o.extend({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}cameraForBounds(n,l){n=o.LngLatBounds.convert(n);const m=l&&l.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),m,l)}_extendCameraOptions(n){const l={top:0,bottom:0,right:0,left:0};if(typeof(n=o.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const m=n.padding;n.padding={top:m,bottom:m,right:m,left:m}}return n.padding=o.extend(l,n.padding),n}_cameraForBoxAndBearing(n,l,m,v){const b=this._extendCameraOptions(v),T=this.transform,P=T.padding,D=T.project(o.LngLat.convert(n)),O=T.project(o.LngLat.convert(l)),B=D.rotate(-o.degToRad(m)),U=O.rotate(-o.degToRad(m)),q=new o.pointGeometry(Math.max(B.x,U.x),Math.max(B.y,U.y)),Q=new o.pointGeometry(Math.min(B.x,U.x),Math.min(B.y,U.y)),K=q.sub(Q),te=(T.width-(P.left+P.right+b.padding.left+b.padding.right))/K.x,_e=(T.height-(P.top+P.bottom+b.padding.top+b.padding.bottom))/K.y;if(_e<0||te<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const J=Math.min(T.scaleZoom(T.scale*Math.min(te,_e)),b.maxZoom),me=typeof b.offset.x=="number"?new o.pointGeometry(b.offset.x,b.offset.y):o.pointGeometry.convert(b.offset),pe=new o.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(m*Math.PI/180),he=me.add(pe).mult(T.scale/T.zoomScale(J));return{center:T.unproject(D.add(O).div(2).sub(he)),zoom:J,bearing:m}}_cameraForBox(n,l,m,v,b){const T=this._extendCameraOptions(b);m=m||0,v=v||0,n=o.LngLat.convert(n),l=o.LngLat.convert(l);const P=this.transform.clone();P.padding=T.padding;const D=this.getFreeCameraOptions(),O=new o.LngLat(.5*(n.lng+l.lng),.5*(n.lat+l.lat)),B=.5*(m+v);if(P._camera.position[2]<o.mercatorZfromAltitude(B,O.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");D.lookAtPoint(O),P.setFreeCameraOptions(D);const U=o.MercatorCoordinate.fromLngLat(n),q=o.MercatorCoordinate.fromLngLat(l),Q=P.pointRayIntersection(P.centerPoint,B),K=[(te=P.rayIntersectionCoordinate(Q)).x,te.y,te.z];var te;const _e=P.screenPointToMercatorRay(P.centerPoint),J=P.projection.name!=="globe";let me,pe=0;do{const he=Math.floor(P.zoom),fe=1<<he,ye=Math.min(fe*U.x,fe*q.x),Le=Math.min(fe*U.y,fe*q.y),Ue=Math.max(fe*U.x,fe*q.x),ht=Math.max(fe*U.y,fe*q.y),ot=new o.Aabb([ye,Le,m],[Ue,ht,v]),nt=o.Frustum.fromInvProjectionMatrix(P.invProjMatrix,P.worldSize,he,J);if(ot.intersects(nt)!==2){me&&(P._camera.position=o.scaleAndAdd([],P._camera.position,_e.dir,-me),P._updateStateFromCamera());break}const qe=o.sub([],P._camera.position,K);me=.5*o.length(qe),P._camera.position=o.scaleAndAdd([],P._camera.position,_e.dir,me);try{P._updateStateFromCamera()}catch{return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++pe<10);return{center:P.center,zoom:P.zoom,bearing:P.bearing,pitch:P.pitch}}fitBounds(n,l,m){return this._fitInternal(this.cameraForBounds(n,l),l,m)}_raycastElevationBox(n,l){const m=this.transform.elevation;if(!m)return;const v=new o.pointGeometry(n.x,l.y),b=new o.pointGeometry(l.x,n.y),T=m.pointCoordinate(n);if(!T)return;const P=m.pointCoordinate(l);if(!P)return;const D=m.pointCoordinate(v);if(!D)return;const O=m.pointCoordinate(b);if(!O)return;const B=new o.MercatorCoordinate(T[0],T[1]).toLngLat(),U=new o.MercatorCoordinate(P[0],P[1]).toLngLat(),q=new o.MercatorCoordinate(D[0],D[1]).toLngLat(),Q=new o.MercatorCoordinate(O[0],O[1]).toLngLat(),K=Math.min(B.lng,Math.min(U.lng,Math.min(q.lng,Q.lng))),te=Math.min(B.lat,Math.min(U.lat,Math.min(q.lat,Q.lat))),_e=Math.max(B.lng,Math.max(U.lng,Math.max(q.lng,Q.lng))),J=Math.max(B.lat,Math.max(U.lat,Math.max(q.lat,Q.lat))),me=Math.min(T[3],Math.min(P[3],Math.min(D[3],O[3]))),pe=Math.max(T[3],Math.max(P[3],Math.max(D[3],O[3])));return{minLngLat:new o.LngLat(K,te),maxLngLat:new o.LngLat(_e,J),minAltitude:me,maxAltitude:pe}}fitScreenCoordinates(n,l,m,v,b){let T,P,D,O;const B=o.pointGeometry.convert(n),U=o.pointGeometry.convert(l),q=this._raycastElevationBox(B,U);if(q)T=q.minLngLat,P=q.maxLngLat,D=q.minAltitude,O=q.maxAltitude;else{if(this.transform.anyCornerOffEdge(B,U))return this;T=this.transform.pointLocation(B),P=this.transform.pointLocation(U)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(n)),this.transform.pointLocation(o.pointGeometry.convert(l)),m,v):this._cameraForBox(T,P,D,O,v),v,b)}_fitInternal(n,l,m){return n?(delete(l=o.extend(n,l)).padding,l.linear?this.easeTo(l,m):this.flyTo(l,m)):this}jumpTo(n,l){this.stop();const m=n.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,T=!1;return"zoom"in n&&m.zoom!==+n.zoom&&(v=!0,m.zoom=+n.zoom),n.center!==void 0&&(m.center=o.LngLat.convert(n.center)),"bearing"in n&&m.bearing!==+n.bearing&&(b=!0,m.bearing=+n.bearing),"pitch"in n&&m.pitch!==+n.pitch&&(T=!0,m.pitch=+n.pitch),n.padding==null||m.isPaddingEqual(n.padding)||(m.padding=n.padding),n.preloadOnly?(this._preloadTiles(m),this):(this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),v&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),b&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),T&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Xr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,l){const m=this.transform;if(!m.projection.supportsFreeCamera)return void o.warnOnce(Xr);this.stop();const v=m.zoom,b=m.pitch,T=m.bearing;m.setFreeCameraOptions(n);const P=v!==m.zoom,D=b!==m.pitch,O=T!==m.bearing;return this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),P&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),O&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),D&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l)),this}easeTo(n,l){this._stop(!1,n.easeId),((n=o.extend({offset:[0,0],duration:500,easing:o.ease},n)).animate===!1||!n.essential&&o.exported.prefersReducedMotion)&&(n.duration=0);const m=this.transform,v=this.getZoom(),b=this.getBearing(),T=this.getPitch(),P=this.getPadding(),D="zoom"in n?+n.zoom:v,O="bearing"in n?this._normalizeBearing(n.bearing,b):b,B="pitch"in n?+n.pitch:T,U="padding"in n?n.padding:m.padding,q=o.pointGeometry.convert(n.offset);let Q=m.centerPoint.add(q);const K=m.projection.name==="globe"?m.pointCoordinate(Q).toLngLat():m.pointLocation(Q),te=o.LngLat.convert(n.center||K);this._normalizeCenter(te);const _e=m.project(K),J=m.project(te).sub(_e),me=m.zoomScale(D-v);let pe,he;n.around&&(pe=o.LngLat.convert(n.around),he=m.locationPoint(pe));const fe=this._zooming||D!==v,ye=this._rotating||b!==O,Le=this._pitching||B!==T,Ue=!m.isPaddingEqual(U),ht=nt=>qe=>{if(fe&&(nt.zoom=o.number(v,D,qe)),ye&&(nt.bearing=o.number(b,O,qe)),Le&&(nt.pitch=o.number(T,B,qe)),Ue&&(nt.interpolatePadding(P,U,qe),Q=nt.centerPoint.add(q)),pe)nt.setLocationAtPoint(pe,he);else{const Ne=nt.zoomScale(nt.zoom-v),tt=D>v?Math.min(2,me):Math.max(.5,me),Ye=Math.pow(tt,1-qe),Rt=nt.unproject(_e.add(J.mult(qe*Ye)).mult(Ne));nt.setLocationAtPoint(nt.renderWorldCopies?Rt.wrap():Rt,Q)}return n.preloadOnly||this._fireMoveEvents(l),nt};if(n.preloadOnly){const nt=this._emulate(ht,n.duration,m);return this._preloadTiles(nt),this}const ot={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=ye,this._pitching=Le,this._padding=Ue,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,ot),this._ease(ht(m),nt=>{m.recenterOnTerrain(),this._afterEase(l,nt)},n),this}_prepareEase(n,l,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||m.moving||this.fire(new o.Event("movestart",n)),this._zooming&&!m.zooming&&this.fire(new o.Event("zoomstart",n)),this._rotating&&!m.rotating&&this.fire(new o.Event("rotatestart",n)),this._pitching&&!m.pitching&&this.fire(new o.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.Event("move",n)),this._zooming&&this.fire(new o.Event("zoom",n)),this._rotating&&this.fire(new o.Event("rotate",n)),this._pitching&&this.fire(new o.Event("pitch",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId,this.transform.cameraElevationReference="ground";const m=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new o.Event("zoomend",n)),v&&this.fire(new o.Event("rotateend",n)),b&&this.fire(new o.Event("pitchend",n)),this.fire(new o.Event("moveend",n))}flyTo(n,l){if(!n.essential&&o.exported.prefersReducedMotion){const ft=o.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ft,l)}this.stop(),n=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},n);const m=this.transform,v=this.getZoom(),b=this.getBearing(),T=this.getPitch(),P=this.getPadding(),D="zoom"in n?o.clamp(+n.zoom,m.minZoom,m.maxZoom):v,O="bearing"in n?this._normalizeBearing(n.bearing,b):b,B="pitch"in n?+n.pitch:T,U="padding"in n?n.padding:m.padding,q=m.zoomScale(D-v),Q=o.pointGeometry.convert(n.offset);let K=m.centerPoint.add(Q);const te=m.pointLocation(K),_e=o.LngLat.convert(n.center||te);this._normalizeCenter(_e);const J=m.project(te),me=m.project(_e).sub(J);let pe=n.curve;const he=Math.max(m.width,m.height),fe=he/q,ye=me.mag();if("minZoom"in n){const ft=o.clamp(Math.min(n.minZoom,v,D),m.minZoom,m.maxZoom),Ft=he/m.zoomScale(ft-v);pe=Math.sqrt(Ft/ye*2)}const Le=pe*pe;function Ue(ft){const Ft=(fe*fe-he*he+(ft?-1:1)*Le*Le*ye*ye)/(2*(ft?fe:he)*Le*ye);return Math.log(Math.sqrt(Ft*Ft+1)-Ft)}function ht(ft){return(Math.exp(ft)-Math.exp(-ft))/2}function ot(ft){return(Math.exp(ft)+Math.exp(-ft))/2}const nt=Ue(0);let qe=function(ft){return ot(nt)/ot(nt+pe*ft)},Ne=function(ft){return he*((ot(nt)*(ht(Ft=nt+pe*ft)/ot(Ft))-ht(nt))/Le)/ye;var Ft},tt=(Ue(1)-nt)/pe;if(Math.abs(ye)<1e-6||!isFinite(tt)){if(Math.abs(he-fe)<1e-6)return this.easeTo(n,l);const ft=fe<he?-1:1;tt=Math.abs(Math.log(fe/he))/pe,Ne=function(){return 0},qe=function(Ft){return Math.exp(ft*pe*Ft)}}n.duration="duration"in n?+n.duration:1e3*tt/("screenSpeed"in n?+n.screenSpeed/pe:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Ye=b!==O,Rt=B!==T,Gt=!m.isPaddingEqual(U),ln=ft=>Ft=>{const Kt=Ft*tt,zn=1/qe(Kt);ft.zoom=Ft===1?D:v+ft.scaleZoom(zn),Ye&&(ft.bearing=o.number(b,O,Ft)),Rt&&(ft.pitch=o.number(T,B,Ft)),Gt&&(ft.interpolatePadding(P,U,Ft),K=ft.centerPoint.add(Q));const Wn=Ft===1?_e:ft.unproject(J.add(me.mult(Ne(Kt))).mult(zn));return ft.setLocationAtPoint(ft.renderWorldCopies?Wn.wrap():Wn,K),ft._updateCenterElevation(),n.preloadOnly||this._fireMoveEvents(l),ft};if(n.preloadOnly){const ft=this._emulate(ln,n.duration,m);return this._preloadTiles(ft),this}return this._zooming=!0,this._rotating=Ye,this._pitching=Rt,this._padding=Gt,this._prepareEase(l,!1),this._ease(ln(m),()=>this._afterEase(l),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,l)}if(!n){const m=this.handlers;m&&m.stop(!1)}return this}_ease(n,l,m){m.animate===!1||m.duration===0?(n(1),l()):(this._easeStart=o.exported.now(),this._easeOptions=m,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,l){n=o.wrap(n,-180,180);const m=Math.abs(n-l);return Math.abs(n-360-l)<m&&(n-=360),Math.abs(n+360-l)<m&&(n+=360),n}_normalizeCenter(n){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const m=n.lng-l.center.lng;n.lng+=m>180?-360:m<-180?360:0}_emulate(n,l,m){const v=Math.ceil(15*l/1e3),b=[],T=n(m.clone());for(let P=0;P<=v;P++){const D=T(P/v);b.push(D.clone())}return b}}class ws{constructor(n={}){this.options=n,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const l=this.options&&this.options.compact;return this._map=n,this._container=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=H.create("button","mapboxgl-ctrl-attrib-button",this._container),H.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=H.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,l){const m=this._map._getUIString(`AttributionControl.${l}`);n.setAttribute("aria-label",m),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(n){const m=l.reduce((v,b,T)=>(b.value&&(v+=`${b.key}=${b.value}${T<l.length-1?"&":""}`),v),"?");n.href=`${o.config.FEEDBACK_URL}/${m}${this._map._hash?this._map._hash.getHashString(!0):""}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const l=this._map.style._sourceCaches;for(const v in l){const b=l[v];if(b.used){const T=b.getSource();T.attribution&&n.indexOf(T.attribution)<0&&n.push(T.attribution)}}n.sort((v,b)=>v.length-b.length),n=n.filter((v,b)=>{for(let T=b+1;T<n.length;T++)if(n[T].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const m=n.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,n.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Us{constructor(){o.bindAll(["_updateLogo"],this),o.bindAll(["_updateCompact"],this)}onAdd(n){this._map=n,this._container=H.create("div","mapboxgl-ctrl");const l=H.create("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const l in n){const m=n[l].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class ci{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,m=l?this._queue.concat(l):this._queue;for(const v of m)if(v.id===n)return void(v.cancelled=!0)}run(n=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const m of l)if(!m.cancelled&&(m.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function sl(p,n,l){if(p=new o.LngLat(p.lng,p.lat),n){const m=new o.LngLat(p.lng-360,p.lat),v=new o.LngLat(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-l.center.lng)/360),T=l.locationPoint(p).distSqr(n),P=n.x<0||n.y<0||n.x>l.width||n.y>l.height;l.locationPoint(m).distSqr(n)<T&&(P||Math.abs(m.lng-l.center.lng)<b)?p=m:l.locationPoint(v).distSqr(n)<T&&(P||Math.abs(v.lng-l.center.lng)<b)&&(p=v)}for(;Math.abs(p.lng-l.center.lng)>180;){const m=l.locationPoint(p);if(m.x>=0&&m.y>=0&&m.x<=l.width&&m.y<=l.height)break;p.lng>l.center.lng?p.lng-=360:p.lng+=360}return p}const Fr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Lu extends o.Evented{constructor(n,l){if(super(),(n instanceof o.window.HTMLElement||l)&&(n=o.extend({element:n},l)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),n&&n.element)this._element=n.element,this._offset=o.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=H.create("div");const v=41,b=27,T=H.createSVG("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),P=H.createSVG("radialGradient",{id:"shadowGradient"},H.createSVG("defs",{},T));H.createSVG("stop",{offset:"10%","stop-opacity":.4},P),H.createSVG("stop",{offset:"100%","stop-opacity":.05},P),H.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),H.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),H.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),H.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=o.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const m=this._element.classList;for(const v in Fr)m.remove(`mapboxgl-marker-anchor-${v}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const l=n.code,m=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(n){const l=n.originalEvent.target,m=this._element;this._popup&&(l===m||m.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const n=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(n))return void this._clearFadeTimer();const l=this._map.unproject(n);let m=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const b=this._map.getFreeCameraOptions();if(b.position){const T=b.position.toLngLat();m=T.distanceTo(l)<.9*T.distanceTo(this._lngLat)}}const v=(1-this._map._queryFogOpacity(l))*(m?.2:1);this._element.style.opacity=`${v}`,this._popup&&this._popup._setOpacity(`${v}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(n){const l=this._map.transform;return!!n&&n.x>=0&&n.x<l.width&&n.y>=0&&n.y<l.height}_updateDOM(){const n=this._pos||new o.pointGeometry(0,0),l=this._calculatePitch(),m=this._calculateRotation();this._element.style.transform=`${Fr[this._anchor]} translate(${n.x}px, ${n.y}px) rotateX(${l}deg) rotateZ(${m}deg)`}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(n){o.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=sl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),n===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const n=this._map.transform,l=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&l._rotate(n.angle),this._pitchAlignment==="map"&&(l.y*=Math.cos(n._pitch)),l}getOffset(){return this._offset}setOffset(n){return this._offset=o.pointGeometry.convert(n),this._update(),this}_onMove(n){if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(n){this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class so{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const l=o.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,l,m){this._start=this.getValue(l),this._end=n,this._startTime=l,this._endTime=l+m}}const kc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Ki,HTMLElement:ao,ImageBitmap:al}=o.window,zc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function $l(p){p.parentNode&&p.parentNode.removeChild(p)}const bd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Dc{constructor(n,l,m=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Li({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,m&&(this.mousePitch=new Ul({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(n,l){this.mouseRotate.mousedown(n,l),this.mousePitch&&this.mousePitch.mousedown(n,l),H.disableDrag()}move(n,l){const m=this.map,v=this.mouseRotate.mousemoveWindow(n,l);if(v&&v.bearingDelta&&m.setBearing(m.getBearing()+v.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(n,l);b&&b.pitchDelta&&m.setPitch(m.getPitch()+b.pitchDelta)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){H.enableDrag(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(o.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),H.mousePos(this.element,n)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,H.mousePos(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=H.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=H.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const xa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Mi,js=0,ba=!1;const ll={maxWidth:100,unit:"metric"};function Tt(p,n,l){const m=l&&l.maxWidth||100,v=p._containerHeight/2,b=p.unproject([0,v]),T=p.unproject([m,v]),P=b.distanceTo(T);if(l&&l.unit==="imperial"){const D=3.2808*P;D>5280?wa(n,m,D/5280,p._getUIString("ScaleControl.Miles"),p):wa(n,m,D,p._getUIString("ScaleControl.Feet"),p)}else l&&l.unit==="nautical"?wa(n,m,P/1852,p._getUIString("ScaleControl.NauticalMiles"),p):P>=1e3?wa(n,m,P/1e3,p._getUIString("ScaleControl.Kilometers"),p):wa(n,m,P,p._getUIString("ScaleControl.Meters"),p)}function wa(p,n,l,m,v){const b=function(P){const D=Math.pow(10,`${Math.floor(P)}`.length-1);let O=P/D;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(B){const U=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*U)/U}(O),D*O}(l),T=b/l;v._requestDomTask(()=>{p.style.width=n*T+"px",p.innerHTML=`${b}&nbsp;${m}`})}const Ru={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),hi={version:o.version,supported:G,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Si{constructor(p){if((p=o.extend({},zc,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(p.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new da(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._renderTaskQueue=new ci,this._domRenderTaskQueue=new ci,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},kc,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new so(0),this._requestManager=new o.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,typeof p.container=="string"){if(this._container=o.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof ao))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Yi(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new fa(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,o.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new ws({customAttribution:p.customAttribution})),this._logoControl=new Us,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new o.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new o.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(p,n){if(n===void 0&&(n=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[n];return n.indexOf("bottom")!==-1?m.insertBefore(l,m.firstChild):m.appendChild(l),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(p);return n>-1&&this._controls.splice(n,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.Event("movestart",p)).fire(new o.Event("move",p)),this.fire(new o.Event("resize",p)),n&&this.fire(new o.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(o.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getProjection(){return this.transform.getProjection()}setProjection(p){return this._lazyInitEmptyStyle(),typeof p=="string"&&(p={name:p}),this._runtimeProjection=p,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(p){return this.transform.locationPoint3D(o.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(o.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(p,n,l){if(p==="mouseenter"||p==="mouseover"){let m=!1;const v=T=>{const P=n.filter(O=>this.getLayer(O)),D=P.length?this.queryRenderedFeatures(T.point,{layers:P}):[];D.length?m||(m=!0,l.call(this,new Wr(p,this,T.originalEvent,{features:D}))):m=!1},b=()=>{m=!1};return{layers:new Set(n),listener:l,delegates:{mousemove:v,mouseout:b}}}if(p==="mouseleave"||p==="mouseout"){let m=!1;const v=T=>{const P=n.filter(D=>this.getLayer(D));(P.length?this.queryRenderedFeatures(T.point,{layers:P}):[]).length?m=!0:m&&(m=!1,l.call(this,new Wr(p,this,T.originalEvent)))},b=T=>{m&&(m=!1,l.call(this,new Wr(p,this,T.originalEvent)))};return{layers:new Set(n),listener:l,delegates:{mousemove:v,mouseout:b}}}{const m=v=>{const b=n.filter(P=>this.getLayer(P)),T=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];T.length&&(v.features=T,l.call(this,v),delete v.features)};return{layers:new Set(n),listener:l,delegates:{[p]:m}}}}on(p,n,l){if(l===void 0)return super.on(p,n);Array.isArray(n)||(n=[n]);const m=this._createDelegatedListener(p,n,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(p,n,l){if(l===void 0)return super.once(p,n);Array.isArray(n)||(n=[n]);const m=this._createDelegatedListener(p,n,l);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(p,n,l){if(l===void 0)return super.off(p,n);n=new Set(Array.isArray(n)?n:[n]);const m=(b,T)=>{if(b.size!==T.size)return!1;for(const P of b)if(!T.has(P))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[p]:void 0;return v&&(b=>{for(let T=0;T<b.length;T++){const P=b[T];if(P.listener===l&&m(P.layers,n)){for(const D in P.delegates)this.off(D,P.delegates[D]);return b.splice(T,1),this}}})(v),this}queryRenderedFeatures(p,n){return this.style?(n!==void 0||p===void 0||p instanceof o.pointGeometry||Array.isArray(p)||(n=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(p,n){return this.style.querySourceFeatures(p,n)}queryTerrainElevation(p,n){const l=this.transform.elevation;return l?(n=o.extend({},{exaggerated:!0},n),l.getAtPoint(o.MercatorCoordinate.fromLngLat(p),null,n.exaggerated)):null}setStyle(p,n){return(n=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(p,n))}_getUIString(p){const n=this._locale[p];if(n==null)throw new Error(`Missing UI string '${p}'`);return n}_updateStyle(p,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),p&&(this.style=new Br(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Br(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,n){if(typeof p=="string"){const l=this._requestManager.normalizeStyleURL(p),m=this._requestManager.transformRequest(l,o.ResourceType.Style);o.getJSON(m,(v,b)=>{v?this.fire(new o.ErrorEvent(v)):b&&this._updateDiff(b,n)})}else typeof p=="object"&&this._updateDiff(p,n)}_updateDiff(p,n){try{this.style.setState(p)&&this._update(!0)}catch(l){o.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(p,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(p,n){return this._lazyInitEmptyStyle(),this.style.addSource(p,n),this._update(!0)}isSourceLoaded(p){const n=this.style&&this.style._getSourceCaches(p);if(n.length!==0)return n.every(l=>l.loaded());this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${p}'`)))}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const n in p){const l=p[n]._tiles;for(const m in l){const v=l[m];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}addSourceType(p,n,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,n,l)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,n,{pixelRatio:l=1,sdf:m=!1,stretchX:v,stretchY:b,content:T}={}){if(this._lazyInitEmptyStyle(),n instanceof Ki||al&&n instanceof al){const{width:P,height:D,data:O}=o.exported.getImageData(n);this.style.addImage(p,{data:new o.RGBAImage({width:P,height:D},O),pixelRatio:l,stretchX:v,stretchY:b,content:T,sdf:m,version:0})}else{if(n.width===void 0||n.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:P,height:D,data:O}=n,B=n;this.style.addImage(p,{data:new o.RGBAImage({width:P,height:D},new Uint8Array(O)),pixelRatio:l,stretchX:v,stretchY:b,content:T,sdf:m,version:0,userImage:B}),B.onAdd&&B.onAdd(this,p)}}}updateImage(p,n){const l=this.style.getImage(p);if(!l)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=n instanceof Ki||al&&n instanceof al?o.exported.getImageData(n):n,{width:v,height:b,data:T}=m;return v===void 0||b===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):v!==l.data.width||b!==l.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(l.data.replace(T,!(n instanceof Ki||al&&n instanceof al)),void this.style.updateImage(p,l))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,n){o.getImage(this._requestManager.transformRequest(p,o.ResourceType.Image),(l,m)=>{n(l,m instanceof Ki?o.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(p,n){return this._lazyInitEmptyStyle(),this.style.addLayer(p,n),this._update(!0)}moveLayer(p,n){return this.style.moveLayer(p,n),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,n,l){return this.style.setLayerZoomRange(p,n,l),this._update(!0)}setFilter(p,n,l={}){return this.style.setFilter(p,n,l),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,n,l,m={}){return this.style.setPaintProperty(p,n,l,m),this._update(!0)}getPaintProperty(p,n){return this.style.getPaintProperty(p,n)}setLayoutProperty(p,n,l,m={}){return this.style.setLayoutProperty(p,n,l,m),this._update(!0)}getLayoutProperty(p,n){return this.style.getLayoutProperty(p,n)}setLight(p,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){this.transform.projection.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(p),this.transform):0}setFeatureState(p,n){return this.style.setFeatureState(p,n),this._update()}removeFeatureState(p,n){return this.style.removeFeatureState(p,n),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let l,m=this._container;for(;m&&!l;){const v=o.window.getComputedStyle(m).transform;v&&v!=="none"&&(l=v.match(/matrix.*\((.+)\)/)[1].split(", ")),m=m.parentElement}l?(this._containerWidth=l[0]&&l[0]!=="0"?Math.abs(p/l[0]):p,this._containerHeight=l[3]&&l[3]!=="0"?Math.abs(n/l[3]):n):(this._containerWidth=p,this._containerHeight=n)}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=H.create("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=H.create("div","mapboxgl-canvas-container",p);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=H.create("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=H.create("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=H.create("div",`mapboxgl-ctrl-${v}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,n){const l=o.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(p),this._canvas.height=l*Math.ceil(n),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${n}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const n=this._markers.indexOf(p);n!==-1&&this._markers.splice(n,1)}_setupPainter(){const p=o.extend({},G.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);n?(o.storeAuthState(n,!0),this.painter=new Sc(n,this.transform),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(n)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let n;const l=this.painter.context.extTimerQuery,m=o.exported.now();this.listens("gpu-timing-frame")&&(n=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,n));let v=this._updateAverageElevation(m);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjection();let b=!1;const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,O=this.transform.pitch,B=o.exported.now();this.style.zoomHistory.update(D,B);const U=new o.EvaluationParameters(D,{now:B,fadeDuration:T,pitch:O,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),q=U.crossFadingFactor();q===1&&q===this._crossFadingFactor||(b=!0,this._crossFadingFactor=q),this.style.update(U)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const D=o.exported.now()-m;l.endQueryEXT(l.TIME_ELAPSED_EXT,n),setTimeout(()=>{const O=l.getQueryObjectEXT(n,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(n),this.fire(new o.Event("gpu-timing-frame",{cpuTime:D,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(D);this.fire(new o.Event("gpu-timing-layer",{layerTimes:O}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(P||this._repaint)this.triggerRepaint();else{const D=!this.isMoving()&&this.loaded();if(D&&(v=this._updateAverageElevation(m,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,n=!1){const l=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((n||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const m=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();isNaN(v)?v=0:this._averageElevationLastSampledAt=p;const b=Math.abs(m-v);if(b>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(v),l(v);this._averageElevation.easeTo(v,p,300)}else if(b>1e-4)return this._averageElevation.jumpTo(v),l(v)}return!!this._averageElevation.isEasing(p)&&l(this._averageElevation.getValue(p))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===o.AUTH_ERR_MSG||p.status===401)){const n=this.painter.context.gl;o.storeAuthState(n,!1),this._logoControl instanceof Us&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const l=this.painter.context.gl,m=l.createFramebuffer();function v(b){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,b,0);const T=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,T),T}return l.bindFramebuffer(l.FRAMEBUFFER,m),this._canvasPixelComparison(v(p),n.canvasCopies.map(v),n.timeStamps)}_canvasPixelComparison(p,n,l){let m=l[1]-l[0];const v=p.length/4;for(let b=0;b<n.length;b++){const T=n[b];let P=0;for(let D=0;D<T.length;D+=4)T[D]===p[D]&&T[D+1]===p[D+1]&&T[D+2]===p[D+2]&&T[D+3]===p[D+3]&&(P+=1);m+=(l[b+2]-l[b+1])*(1-P/v)}return m}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),$l(this._canvasContainer),$l(this._controlContainer),$l(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=o.exported.frame(n=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(n)}))}_preloadTiles(p){const n=this.style&&Object.values(this.style._sourceCaches)||[];return o.asyncAll(n,(l,m)=>l._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,n){o.setCacheLimits(p,n)}get version(){return o.version}},NavigationControl:class{constructor(p){this.options=o.extend({},bd,p),this._container=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),H.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),H.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=H.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const p=this._map.getZoom(),n=p===this._map.getMaxZoom(),l=p===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())}_rotateCompassArrow(){const p=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=p)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Dc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,n){const l=H.create("button",p,this._container);return l.type="button",l.addEventListener("click",n),l}_setButtonTitle(p,n){const l=this._map._getUIString(`NavigationControl.${n}`);p.setAttribute("aria-label",l),p.firstElementChild&&p.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.Evented{constructor(p){super(),this.options=o.extend({},xa,p),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Os(this._updateMarkerRotation,20)}onAdd(p){var n;return this._map=p,this._container=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,Mi!==void 0?n(Mi):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(l=>{Mi=l.state!=="denied",n(Mi)}):(Mi=!!o.window.navigator.geolocation,n(Mi)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,js=0,ba=!1}_isOutOfMapMaxBounds(p){const n=this._map.getMaxBounds(),l=p.coords;return n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",p)),this._finish()}}_updateCamera(p){const n=new o.LngLat(p.coords.longitude,p.coords.latitude),l=p.coords.accuracy,m=this._map.getBearing(),v=o.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(l),v,{geolocateSource:!0})}_updateMarker(p){if(p){const n=new o.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map._containerHeight/2,n=this._map.unproject([0,p]),l=this._map.unproject([100,p]),m=n.distanceTo(l)/100,v=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&ba)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=H.create("button","mapboxgl-ctrl-geolocate",this._container),H.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",p===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H.create("div","mapboxgl-user-location"),this._dotElement.appendChild(H.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(H.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Lu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=H.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Lu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":js--,ba=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),js++,js>1?(p={maximumAge:6e5,timeout:0},ba=!0):(p=this.options.positionOptions,ba=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&p()}).catch(console.error):p()}_clearWatch(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ws,ScaleControl:class{constructor(p){this.options=o.extend({},ll,p),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Tt(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,Tt(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof o.window.HTMLElement?this._container=p.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=H.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);H.create("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden",!0),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(p){super(),this.options=o.extend(Object.create(Ru),p),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=o.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(o.window.document.createTextNode(p))}setHTML(p){const n=o.window.document.createDocumentFragment(),l=o.window.document.createElement("body");let m;for(l.innerHTML=p;m=l.firstChild,m;)n.appendChild(m);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=H.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._container&&this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._container&&this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let n;return this._classList.delete(p)?n=!1:(this._classList.add(p),n=!0),this._container&&this._updateClassList(),n}_createCloseButton(){this.options.closeButton&&(this._closeButton=H.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(p){this._update(p.point)}_onMouseMove(p){this._update(p.point)}_onDrag(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const n=this._pos,l=this._container.offsetWidth,m=this._container.offsetHeight;let v;return v=n.y+p.bottom.y<m?["top"]:n.y>this._map.transform.height-m?["bottom"]:[],n.x<l/2?v.push("left"):n.x>this._map.transform.width-l/2&&v.push("right"),v.length===0?"bottom":v.join("-")}_updateClassList(){const p=[...this._classList];p.push("mapboxgl-popup"),this._anchor&&p.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&p.push("mapboxgl-popup-track-pointer"),this._container.className=p.join(" ")}_update(p){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=H.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=H.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||p){const n=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),l=function(b){if(b||(b=new o.pointGeometry(0,0)),typeof b=="number"){const T=Math.round(Math.sqrt(.5*Math.pow(b,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,b),"top-left":new o.pointGeometry(T,T),"top-right":new o.pointGeometry(-T,T),bottom:new o.pointGeometry(0,-b),"bottom-left":new o.pointGeometry(T,-T),"bottom-right":new o.pointGeometry(-T,-T),left:new o.pointGeometry(b,0),right:new o.pointGeometry(-b,0)}}if(b instanceof o.pointGeometry||Array.isArray(b)){const T=o.pointGeometry.convert(b);return{center:T,top:T,"top-left":T,"top-right":T,bottom:T,"bottom-left":T,"bottom-right":T,left:T,right:T}}return{center:o.pointGeometry.convert(b.center||[0,0]),top:o.pointGeometry.convert(b.top||[0,0]),"top-left":o.pointGeometry.convert(b["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(b["top-right"]||[0,0]),bottom:o.pointGeometry.convert(b.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(b["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(b["bottom-right"]||[0,0]),left:o.pointGeometry.convert(b.left||[0,0]),right:o.pointGeometry.convert(b.right||[0,0])}}(this.options.offset),m=this._anchor=this._getAnchor(l),v=n.add(l[m]).round();this._map._requestDomTask(()=>{this._container&&m&&(this._container.style.transform=`${Fr[m]} translate(${v.x}px,${v.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Zl);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._content&&(this._content.style.opacity=p),this._tip&&(this._tip.style.opacity=p)}},Marker:Lu,Style:Br,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:bh,Evented:o.Evented,config:o.config,prewarm:function(){we().acquire(ve)},clearPrewarmedResources:function(){const p=Ce;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(ve),Ce=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(p){o.config.ACCESS_TOKEN=p},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(p){o.config.API_URL=p},get workerCount(){return Ie.workerCount},set workerCount(p){Ie.workerCount=p},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){o.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){o.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return hi});var R=M;return R})}(gp)),gp.exports}var jb=Ub();const wl=kp(jb);var Vb=1e-7;function ag(c){return Array.isArray(c)||ArrayBuffer.isView(c)}function mx(c,s){if(c===s)return!0;if(ag(c)&&ag(s)){if(c.length!==s.length)return!1;for(var h=0;h<c.length;++h)if(!mx(c[h],s[h]))return!1;return!0}return Math.abs(c-s)<=Vb}function sp(c,s,h){return Math.max(s,Math.min(h,c))}function Ep(c,s,h){return ag(c)?c.map(function(g,w){return Ep(g,s[w],h)}):h*s+(1-h)*c}function Fa(c,s){if(!c)throw new Error(s||"react-map-gl: assertion failed.")}function $y(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function Zy(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?$y(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):$y(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}var uh={minZoom:0,maxZoom:24,minPitch:0,maxPitch:85},jm={pitch:0,bearing:0,altitude:1.5},Gy=5,$b=1.2,ld=function(){function c(s){var h=s.width,g=s.height,w=s.latitude,M=s.longitude,k=s.zoom,R=s.bearing,o=R===void 0?jm.bearing:R,G=s.pitch,ne=G===void 0?jm.pitch:G,oe=s.altitude,$=oe===void 0?jm.altitude:oe,de=s.maxZoom,H=de===void 0?uh.maxZoom:de,Te=s.minZoom,Me=Te===void 0?uh.minZoom:Te,je=s.maxPitch,He=je===void 0?uh.maxPitch:je,Ve=s.minPitch,Xe=Ve===void 0?uh.minPitch:Ve,$e=s.transitionDuration,Ze=s.transitionEasing,xt=s.transitionInterpolator,It=s.transitionInterruption,Pt=s.startPanLngLat,Ot=s.startZoomLngLat,Yt=s.startRotatePos,Nt=s.startBearing,$t=s.startPitch,Et=s.startZoom;lc(this,c),Fa(Number.isFinite(h),"`width` must be supplied"),Fa(Number.isFinite(g),"`height` must be supplied"),Fa(Number.isFinite(M),"`longitude` must be supplied"),Fa(Number.isFinite(w),"`latitude` must be supplied"),Fa(Number.isFinite(k),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:h,height:g,latitude:w,longitude:M,zoom:k,bearing:o,pitch:ne,altitude:$,maxZoom:H,minZoom:Me,maxPitch:He,minPitch:Xe,transitionDuration:$e,transitionEasing:Ze,transitionInterpolator:xt,transitionInterruption:It}),this._state={startPanLngLat:Pt,startZoomLngLat:Ot,startRotatePos:Yt,startBearing:Nt,startPitch:$t,startZoom:Et}}return uc(c,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(h){var g=h.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(g)})}},{key:"pan",value:function(h){var g=h.pos,w=h.startPos,M=this._state.startPanLngLat||this._unproject(w);if(!M)return this;var k=this._calculateNewLngLat({startPanLngLat:M,pos:g}),R=_i(k,2),o=R[0],G=R[1];return this._getUpdatedMapState({longitude:o,latitude:G})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(h){var g=h.pos;return this._getUpdatedMapState({startRotatePos:g,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(h){var g=h.pos,w=h.deltaAngleX,M=w===void 0?0:w,k=h.deltaAngleY,R=k===void 0?0:k,o=this._state,G=o.startRotatePos,ne=o.startBearing,oe=o.startPitch;if(!Number.isFinite(ne)||!Number.isFinite(oe))return this;var $;return g?$=this._calculateNewPitchAndBearing(Zy(Zy({},this._getRotationParams(g,G)),{},{startBearing:ne,startPitch:oe})):$={bearing:ne+M,pitch:oe+R},this._getUpdatedMapState($)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(h){var g=h.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(g),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(h){var g=h.pos,w=h.startPos,M=h.scale;Fa(M>0,"`scale` must be a positive number");var k=this._state,R=k.startZoom,o=k.startZoomLngLat;Number.isFinite(R)||(R=this._viewportProps.zoom,o=this._unproject(w)||this._unproject(g)),Fa(o,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var G=this._calculateNewZoom({scale:M,startZoom:R||0}),ne=new ch(Object.assign({},this._viewportProps,{zoom:G})),oe=ne.getMapCenterByLngLatPosition({lngLat:o,pos:g}),$=_i(oe,2),de=$[0],H=$[1];return this._getUpdatedMapState({zoom:G,longitude:de,latitude:H})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(h){return new c(Object.assign({},this._viewportProps,this._state,h))}},{key:"_applyConstraints",value:function(h){var g=h.maxZoom,w=h.minZoom,M=h.zoom;h.zoom=sp(M,w,g);var k=h.maxPitch,R=h.minPitch,o=h.pitch;return h.pitch=sp(o,R,k),Object.assign(h,hb(h)),h}},{key:"_unproject",value:function(h){var g=new ch(this._viewportProps);return h&&g.unproject(h)}},{key:"_calculateNewLngLat",value:function(h){var g=h.startPanLngLat,w=h.pos,M=new ch(this._viewportProps);return M.getMapCenterByLngLatPosition({lngLat:g,pos:w})}},{key:"_calculateNewZoom",value:function(h){var g=h.scale,w=h.startZoom,M=this._viewportProps,k=M.maxZoom,R=M.minZoom,o=w+Math.log2(g);return sp(o,R,k)}},{key:"_calculateNewPitchAndBearing",value:function(h){var g=h.deltaScaleX,w=h.deltaScaleY,M=h.startBearing,k=h.startPitch;w=sp(w,-1,1);var R=this._viewportProps,o=R.minPitch,G=R.maxPitch,ne=M+180*g,oe=k;return w>0?oe=k+w*(G-k):w<0&&(oe=k-w*(o-k)),{pitch:oe,bearing:ne}}},{key:"_getRotationParams",value:function(h,g){var w=h[0]-g[0],M=h[1]-g[1],k=h[1],R=g[1],o=this._viewportProps,G=o.width,ne=o.height,oe=w/G,$=0;return M>0?Math.abs(ne-R)>Gy&&($=M/(R-ne)*$b):M<0&&R>Gy&&($=1-k/R),$=Math.min(1,Math.max(-1,$)),{deltaScaleX:oe,deltaScaleY:$}}}]),c}();function Zb(c){return c[0].toLowerCase()+c.slice(1)}function Gb(c){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:uh;for(var h in s){var g=h.slice(0,3),w=Zb(h.slice(3));if(g==="min"&&c[w]<s[h]||g==="max"&&c[w]>s[h])return!1}return!0}function qy(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function Wy(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?qy(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):qy(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}var _d=lt.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),Mg=_d.Provider;function qb(c){var s=c.value,h=c.children,g=lt.useState(null),w=_i(g,2),M=w[0],k=w[1],R=lt.useContext(_d);return s=Wy(Wy({setMap:k},R),{},{map:R&&R.map||M},s),lt.createElement(Mg,{value:s},h)}_d.Provider=qb;var lg=typeof window<"u"?lt.useLayoutEffect:lt.useEffect;function Dp(c,s){var h=s.longitude,g=s.latitude;return c&&c.queryTerrainElevation&&c.queryTerrainElevation([h,g])||0}function Xy(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function Ba(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?Xy(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):Xy(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}var Wb="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",gx="A valid API access token is required to use Mapbox data";function Xb(){}function _x(c){var s=c.map,h=c.props,g=c.width,w=c.height,M=Ba(Ba(Ba({},h),h.viewState),{},{width:g,height:w});return M.position=[0,0,Dp(s,M)],new ch(M)}var Hb=401,Hy={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},Yb=Object.assign({},dh.propTypes,{width:Oe.oneOfType([Oe.number,Oe.string]),height:Oe.oneOfType([Oe.number,Oe.string]),onResize:Oe.func,disableTokenWarning:Oe.bool,visible:Oe.bool,className:Oe.string,style:Oe.object,visibilityConstraints:Oe.object}),Kb=Object.assign({},dh.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:Xb,className:"",style:null,visibilityConstraints:uh});function Jb(){var c={position:"absolute",left:0,top:0};return lt.createElement("div",{key:"warning",id:"no-token-warning",style:c},lt.createElement("h3",{key:"header"},gx),lt.createElement("div",{key:"text"},"For information on setting up your basemap, read"),lt.createElement("a",{key:"link",href:Wb},"Note on Map Tokens"))}function Qb(c){return{getMap:function(){return c.current&&c.current.getMap()},queryRenderedFeatures:function(h){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},w=c.current&&c.current.getMap();return w&&w.queryRenderedFeatures(h,g)}}}var cc=lt.forwardRef(function(c,s){var h=lt.useState(!0),g=_i(h,2),w=g[0],M=g[1],k=lt.useState({width:0,height:0}),R=_i(k,2),o=R[0],G=R[1],ne=lt.useRef(null),oe=lt.useRef(null),$=lt.useRef(null),de=lt.useRef(null),H=lt.useContext(_d);lg(function(){if(cc.supported()){var Ot=new dh(Ba(Ba(Ba({},c),o),{},{mapboxgl:wl,container:oe.current,onError:function($t){var Et=$t.error&&$t.error.status||$t.status;Et===Hb&&w&&(console.error(gx),M(!1)),c.onError($t)}}));ne.current=Ot,H&&H.setMap&&H.setMap(Ot.getMap());var Yt=new zb(function(Nt){if(Nt[0].contentRect){var $t=Nt[0].contentRect,Et=$t.width,yn=$t.height;G({width:Et,height:yn}),c.onResize({width:Et,height:yn})}});return Yt.observe($.current),function(){Ot.finalize(),ne.current=null,Yt.disconnect()}}},[]),lg(function(){ne.current&&ne.current.setProps(Ba(Ba({},c),o))});var Te=ne.current&&ne.current.getMap();lt.useImperativeHandle(s,function(){return Qb(ne)},[]);var Me=lt.useCallback(function(Ot){var Yt=Ot.target;Yt===de.current&&Yt.scrollTo(0,0)},[]),je=Te&&lt.createElement(Mg,{value:Ba(Ba({},H),{},{viewport:H.viewport||_x(Ba({map:Te,props:c},o)),map:Te,container:H.container||$.current})},lt.createElement("div",{key:"map-overlays",className:"overlays",ref:de,style:Hy,onScroll:Me},c.children)),He=c.className,Ve=c.width,Xe=c.height,$e=c.style,Ze=c.visibilityConstraints,xt=Object.assign({position:"relative"},$e,{width:Ve,height:Xe}),It=c.visible&&Gb(c.viewState||c,Ze),Pt=Object.assign({},Hy,{visibility:It?"inherit":"hidden"});return lt.createElement("div",{key:"map-container",ref:$,style:xt},lt.createElement("div",{key:"map-mapbox",ref:oe,style:Pt,className:He}),je,!w&&!c.disableTokenWarning&&lt.createElement(Jb,null))});cc.supported=function(){return wl&&wl.supported()};cc.propTypes=Yb;cc.defaultProps=Kb;function ew(c,s){var h;if(typeof Symbol>"u"||c[Symbol.iterator]==null){if(Array.isArray(c)||(h=tw(c))||s){h&&(c=h);var g=0,w=function(){};return{s:w,n:function(){return g>=c.length?{done:!0}:{done:!1,value:c[g++]}},e:function(G){throw G},f:w}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var M=!0,k=!1,R;return{s:function(){h=c[Symbol.iterator]()},n:function(){var G=h.next();return M=G.done,G},e:function(G){k=!0,R=G},f:function(){try{!M&&h.return!=null&&h.return()}finally{if(k)throw R}}}}function tw(c,s){if(c){if(typeof c=="string")return Yy(c,s);var h=Object.prototype.toString.call(c).slice(8,-1);if(h==="Object"&&c.constructor&&(h=c.constructor.name),h==="Map"||h==="Set")return Array.from(c);if(h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return Yy(c,s)}}function Yy(c,s){(s==null||s>c.length)&&(s=c.length);for(var h=0,g=new Array(s);h<s;h++)g[h]=c[h];return g}var yx=function(){function c(){lc(this,c),fn(this,"propNames",[])}return uc(c,[{key:"arePropsEqual",value:function(h,g){var w=ew(this.propNames||[]),M;try{for(w.s();!(M=w.n()).done;){var k=M.value;if(!mx(h[k],g[k]))return!1}}catch(R){w.e(R)}finally{w.f()}return!0}},{key:"initializeProps",value:function(h,g){return{start:h,end:g}}},{key:"interpolateProps",value:function(h,g,w){Fa(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(h,g){return g.transitionDuration}}]),c}();function cu(c){if(c===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}function ug(c,s){return ug=Object.setPrototypeOf||function(g,w){return g.__proto__=w,g},ug(c,s)}function Cg(c,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(s&&s.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),Object.defineProperty(c,"prototype",{writable:!1}),s&&ug(c,s)}function cg(c){"@babel/helpers - typeof";return cg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},cg(c)}function Pg(c,s){if(s&&(cg(s)==="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cu(c)}function ac(c){return ac=Object.setPrototypeOf?Object.getPrototypeOf:function(h){return h.__proto__||Object.getPrototypeOf(h)},ac(c)}var nw={longitude:1,bearing:1};function Tp(c){return Number.isFinite(c)||Array.isArray(c)}function rw(c){return c in nw}function hg(c,s,h){return rw(c)&&Math.abs(h-s)>180&&(h=h<0?h+360:h-360),h}function Vm(c,s){var h;if(typeof Symbol>"u"||c[Symbol.iterator]==null){if(Array.isArray(c)||(h=iw(c))||s){h&&(c=h);var g=0,w=function(){};return{s:w,n:function(){return g>=c.length?{done:!0}:{done:!1,value:c[g++]}},e:function(G){throw G},f:w}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var M=!0,k=!1,R;return{s:function(){h=c[Symbol.iterator]()},n:function(){var G=h.next();return M=G.done,G},e:function(G){k=!0,R=G},f:function(){try{!M&&h.return!=null&&h.return()}finally{if(k)throw R}}}}function iw(c,s){if(c){if(typeof c=="string")return Ky(c,s);var h=Object.prototype.toString.call(c).slice(8,-1);if(h==="Object"&&c.constructor&&(h=c.constructor.name),h==="Map"||h==="Set")return Array.from(c);if(h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return Ky(c,s)}}function Ky(c,s){(s==null||s>c.length)&&(s=c.length);for(var h=0,g=new Array(s);h<s;h++)g[h]=c[h];return g}function ow(c){var s=sw();return function(){var g=ac(c),w;if(s){var M=ac(this).constructor;w=Reflect.construct(g,arguments,M)}else w=g.apply(this,arguments);return Pg(this,w)}}function sw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var aw=["longitude","latitude","zoom","bearing","pitch"],lw=["latitude","longitude","zoom","width","height"],Jy=["bearing","pitch"],uw={speed:1.2,curve:1.414};(function(c){Cg(h,c);var s=ow(h);function h(){var g,w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return lc(this,h),g=s.call(this),fn(cu(g),"propNames",aw),g.props=Object.assign({},uw,w),g}return uc(h,[{key:"initializeProps",value:function(w,M){var k={},R={},o=Vm(lw),G;try{for(o.s();!(G=o.n()).done;){var ne=G.value,oe=w[ne],$=M[ne];Fa(Tp(oe)&&Tp($),"".concat(ne," must be supplied for transition")),k[ne]=oe,R[ne]=hg(ne,oe,$)}}catch(He){o.e(He)}finally{o.f()}var de=Vm(Jy),H;try{for(de.s();!(H=de.n()).done;){var Te=H.value,Me=w[Te]||0,je=M[Te]||0;k[Te]=Me,R[Te]=hg(Te,Me,je)}}catch(He){de.e(He)}finally{de.f()}return{start:k,end:R}}},{key:"interpolateProps",value:function(w,M,k){var R=fb(w,M,k,this.props),o=Vm(Jy),G;try{for(o.s();!(G=o.n()).done;){var ne=G.value;R[ne]=Ep(w[ne],M[ne],k)}}catch(oe){o.e(oe)}finally{o.f()}return R}},{key:"getDuration",value:function(w,M){var k=M.transitionDuration;return k==="auto"&&(k=pb(w,M,this.props)),k}}]),h})(yx);function Qy(c,s){var h;if(typeof Symbol>"u"||c[Symbol.iterator]==null){if(Array.isArray(c)||(h=cw(c))||s){h&&(c=h);var g=0,w=function(){};return{s:w,n:function(){return g>=c.length?{done:!0}:{done:!1,value:c[g++]}},e:function(G){throw G},f:w}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var M=!0,k=!1,R;return{s:function(){h=c[Symbol.iterator]()},n:function(){var G=h.next();return M=G.done,G},e:function(G){k=!0,R=G},f:function(){try{!M&&h.return!=null&&h.return()}finally{if(k)throw R}}}}function cw(c,s){if(c){if(typeof c=="string")return ev(c,s);var h=Object.prototype.toString.call(c).slice(8,-1);if(h==="Object"&&c.constructor&&(h=c.constructor.name),h==="Map"||h==="Set")return Array.from(c);if(h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return ev(c,s)}}function ev(c,s){(s==null||s>c.length)&&(s=c.length);for(var h=0,g=new Array(s);h<s;h++)g[h]=c[h];return g}function hw(c){var s=dw();return function(){var g=ac(c),w;if(s){var M=ac(this).constructor;w=Reflect.construct(g,arguments,M)}else w=g.apply(this,arguments);return Pg(this,w)}}function dw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var fw=["longitude","latitude","zoom","bearing","pitch"],cf=function(c){Cg(h,c);var s=hw(h);function h(){var g,w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return lc(this,h),g=s.call(this),Array.isArray(w)&&(w={transitionProps:w}),g.propNames=w.transitionProps||fw,w.around&&(g.around=w.around),g}return uc(h,[{key:"initializeProps",value:function(w,M){var k={},R={};if(this.around){k.around=this.around;var o=new ch(w).unproject(this.around);Object.assign(R,M,{around:new ch(M).project(o),aroundLngLat:o})}var G=Qy(this.propNames),ne;try{for(G.s();!(ne=G.n()).done;){var oe=ne.value,$=w[oe],de=M[oe];Fa(Tp($)&&Tp(de),"".concat(oe," must be supplied for transition")),k[oe]=$,R[oe]=hg(oe,$,de)}}catch(H){G.e(H)}finally{G.f()}return{start:k,end:R}}},{key:"interpolateProps",value:function(w,M,k){var R={},o=Qy(this.propNames),G;try{for(o.s();!(G=o.n()).done;){var ne=G.value;R[ne]=Ep(w[ne],M[ne],k)}}catch(Te){o.e(Te)}finally{o.f()}if(M.around){var oe=new ch(Object.assign({},M,R)).getMapCenterByLngLatPosition({lngLat:M.aroundLngLat,pos:Ep(w.around,M.around,k)}),$=_i(oe,2),de=$[0],H=$[1];R.longitude=de,R.latitude=H}return R}}]),h}(yx),hf=function(){};function pw(c,s){var h=c(s);return function(g){return 1/(1-h)*(c(g*(1-s)+s)-h)}}var df={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},mw={transitionDuration:0,transitionEasing:function(s){return s},transitionInterpolator:new cf,transitionInterruption:df.BREAK,onTransitionStart:hf,onTransitionInterrupt:hf,onTransitionEnd:hf},Ig=function(){function c(){var s=this,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};lc(this,c),fn(this,"_animationFrame",null),fn(this,"_onTransitionFrame",function(){s._animationFrame=requestAnimationFrame(s._onTransitionFrame),s._updateViewport()}),this.props=null,this.onViewportChange=h.onViewportChange||hf,this.onStateChange=h.onStateChange||hf,this.time=h.getTime||Date.now}return uc(c,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(h){var g=this.props;if(this.props=h,!g||this._shouldIgnoreViewportChange(g,h))return!1;if(this._isTransitionEnabled(h)){var w=Object.assign({},g),M=Object.assign({},h);if(this._isTransitionInProgress()&&(g.onTransitionInterrupt(),this.state.interruption===df.SNAP_TO_END?Object.assign(w,this.state.endProps):Object.assign(w,this.state.propsInTransition),this.state.interruption===df.UPDATE)){var k=this.time(),R=(k-this.state.startTime)/this.state.duration;M.transitionDuration=this.state.duration-(k-this.state.startTime),M.transitionEasing=pw(this.state.easing,R),M.transitionInterpolator=w.transitionInterpolator}return M.onTransitionStart(),this._triggerTransition(w,M),!0}return this._isTransitionInProgress()&&(g.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return!!this._animationFrame}},{key:"_isTransitionEnabled",value:function(h){var g=h.transitionDuration,w=h.transitionInterpolator;return(g>0||g==="auto")&&!!w}},{key:"_isUpdateDueToCurrentTransition",value:function(h){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(h,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(h,g){return h?this._isTransitionInProgress()?this.state.interruption===df.IGNORE||this._isUpdateDueToCurrentTransition(g):this._isTransitionEnabled(g)?g.transitionInterpolator.arePropsEqual(h,g):!0:!0}},{key:"_triggerTransition",value:function(h,g){Fa(this._isTransitionEnabled(g)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var w=g.transitionInterpolator,M=w.getDuration?w.getDuration(h,g):g.transitionDuration;if(M!==0){var k=g.transitionInterpolator.initializeProps(h,g),R={inTransition:!0,isZooming:h.zoom!==g.zoom,isPanning:h.longitude!==g.longitude||h.latitude!==g.latitude,isRotating:h.bearing!==g.bearing||h.pitch!==g.pitch};this.state={duration:M,easing:g.transitionEasing,interpolator:g.transitionInterpolator,interruption:g.transitionInterruption,startTime:this.time(),startProps:k.start,endProps:k.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(R)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var h=this.time(),g=this.state,w=g.startTime,M=g.duration,k=g.easing,R=g.interpolator,o=g.startProps,G=g.endProps,ne=!1,oe=(h-w)/M;oe>=1&&(oe=1,ne=!0),oe=k(oe);var $=R.interpolateProps(o,G,oe),de=new ld(Object.assign({},this.props,$));this.state.propsInTransition=de.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),ne&&(this._endTransition(),this.props.onTransitionEnd())}}]),c}();fn(Ig,"defaultProps",mw);var $m={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var tv;function gw(){return tv||(tv=1,function(c){(function(s,h,g,w){var M=["","webkit","Moz","MS","ms","o"],k=h.createElement("div"),R="function",o=Math.round,G=Math.abs,ne=Date.now;function oe(X,ie,xe){return setTimeout(Ve(X,xe),ie)}function $(X,ie,xe){return Array.isArray(X)?(de(X,xe[ie],xe),!0):!1}function de(X,ie,xe){var le;if(X)if(X.forEach)X.forEach(ie,xe);else if(X.length!==w)for(le=0;le<X.length;)ie.call(xe,X[le],le,X),le++;else for(le in X)X.hasOwnProperty(le)&&ie.call(xe,X[le],le,X)}function H(X,ie,xe){var le="DEPRECATED METHOD: "+ie+`
`+xe+` AT 
`;return function(){var ke=new Error("get-stack-trace"),kt=ke&&ke.stack?ke.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",tn=s.console&&(s.console.warn||s.console.log);return tn&&tn.call(s.console,le,kt),X.apply(this,arguments)}}var Te;typeof Object.assign!="function"?Te=function(ie){if(ie===w||ie===null)throw new TypeError("Cannot convert undefined or null to object");for(var xe=Object(ie),le=1;le<arguments.length;le++){var ke=arguments[le];if(ke!==w&&ke!==null)for(var kt in ke)ke.hasOwnProperty(kt)&&(xe[kt]=ke[kt])}return xe}:Te=Object.assign;var Me=H(function(ie,xe,le){for(var ke=Object.keys(xe),kt=0;kt<ke.length;)(!le||le&&ie[ke[kt]]===w)&&(ie[ke[kt]]=xe[ke[kt]]),kt++;return ie},"extend","Use `assign`."),je=H(function(ie,xe){return Me(ie,xe,!0)},"merge","Use `assign`.");function He(X,ie,xe){var le=ie.prototype,ke;ke=X.prototype=Object.create(le),ke.constructor=X,ke._super=le,xe&&Te(ke,xe)}function Ve(X,ie){return function(){return X.apply(ie,arguments)}}function Xe(X,ie){return typeof X==R?X.apply(ie&&ie[0]||w,ie):X}function $e(X,ie){return X===w?ie:X}function Ze(X,ie,xe){de(Ot(ie),function(le){X.addEventListener(le,xe,!1)})}function xt(X,ie,xe){de(Ot(ie),function(le){X.removeEventListener(le,xe,!1)})}function It(X,ie){for(;X;){if(X==ie)return!0;X=X.parentNode}return!1}function Pt(X,ie){return X.indexOf(ie)>-1}function Ot(X){return X.trim().split(/\s+/g)}function Yt(X,ie,xe){if(X.indexOf&&!xe)return X.indexOf(ie);for(var le=0;le<X.length;){if(xe&&X[le][xe]==ie||!xe&&X[le]===ie)return le;le++}return-1}function Nt(X){return Array.prototype.slice.call(X,0)}function $t(X,ie,xe){for(var le=[],ke=[],kt=0;kt<X.length;){var tn=X[kt][ie];Yt(ke,tn)<0&&le.push(X[kt]),ke[kt]=tn,kt++}return le=le.sort(function(er,ir){return er[ie]>ir[ie]}),le}function Et(X,ie){for(var xe,le,ke=ie[0].toUpperCase()+ie.slice(1),kt=0;kt<M.length;){if(xe=M[kt],le=xe?xe+ke:ie,le in X)return le;kt++}return w}var yn=1;function Dr(){return yn++}function Fe(X){var ie=X.ownerDocument||X;return ie.defaultView||ie.parentWindow||s}var gt=/mobile|tablet|ip(ad|hone|od)|android/i,Qt="ontouchstart"in s,vn=Et(s,"PointerEvent")!==w,ut=Qt&&gt.test(navigator.userAgent),st="touch",wt="pen",Wt="mouse",Jt="kinect",nr=25,On=1,ar=2,Pn=4,Lr=8,Ai=1,Vr=2,yo=4,no=8,en=16,cr=Vr|yo,$r=no|en,Oo=cr|$r,is=["x","y"],vo=["clientX","clientY"];function rn(X,ie){var xe=this;this.manager=X,this.callback=ie,this.element=X.element,this.target=X.options.inputTarget,this.domHandler=function(le){Xe(X.options.enable,[X])&&xe.handler(le)},this.init()}rn.prototype={handler:function(){},init:function(){this.evEl&&Ze(this.element,this.evEl,this.domHandler),this.evTarget&&Ze(this.target,this.evTarget,this.domHandler),this.evWin&&Ze(Fe(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&xt(this.element,this.evEl,this.domHandler),this.evTarget&&xt(this.target,this.evTarget,this.domHandler),this.evWin&&xt(Fe(this.element),this.evWin,this.domHandler)}};function xo(X){var ie,xe=X.options.inputClass;return xe?ie=xe:vn?ie=Vi:ut?ie=F:Qt?ie=ve:ie=Kn,new ie(X,Ni)}function Ni(X,ie,xe){var le=xe.pointers.length,ke=xe.changedPointers.length,kt=ie&On&&le-ke===0,tn=ie&(Pn|Lr)&&le-ke===0;xe.isFirst=!!kt,xe.isFinal=!!tn,kt&&(X.session={}),xe.eventType=ie,os(X,xe),X.emit("hammer.input",xe),X.recognize(xe),X.session.prevInput=xe}function os(X,ie){var xe=X.session,le=ie.pointers,ke=le.length;xe.firstInput||(xe.firstInput=Fo(ie)),ke>1&&!xe.firstMultiple?xe.firstMultiple=Fo(ie):ke===1&&(xe.firstMultiple=!1);var kt=xe.firstInput,tn=xe.firstMultiple,an=tn?tn.center:kt.center,er=ie.center=ss(le);ie.timeStamp=ne(),ie.deltaTime=ie.timeStamp-kt.timeStamp,ie.angle=wo(an,er),ie.distance=bo(an,er),Bo(xe,ie),ie.offsetDirection=oi(ie.deltaX,ie.deltaY);var ir=as(ie.deltaTime,ie.deltaX,ie.deltaY);ie.overallVelocityX=ir.x,ie.overallVelocityY=ir.y,ie.overallVelocity=G(ir.x)>G(ir.y)?ir.x:ir.y,ie.scale=tn?Ui(tn.pointers,le):1,ie.rotation=tn?No(tn.pointers,le):0,ie.maxPointers=xe.prevInput?ie.pointers.length>xe.prevInput.maxPointers?ie.pointers.length:xe.prevInput.maxPointers:ie.pointers.length,qn(xe,ie);var li=X.element;It(ie.srcEvent.target,li)&&(li=ie.srcEvent.target),ie.target=li}function Bo(X,ie){var xe=ie.center,le=X.offsetDelta||{},ke=X.prevDelta||{},kt=X.prevInput||{};(ie.eventType===On||kt.eventType===Pn)&&(ke=X.prevDelta={x:kt.deltaX||0,y:kt.deltaY||0},le=X.offsetDelta={x:xe.x,y:xe.y}),ie.deltaX=ke.x+(xe.x-le.x),ie.deltaY=ke.y+(xe.y-le.y)}function qn(X,ie){var xe=X.lastInterval||ie,le=ie.timeStamp-xe.timeStamp,ke,kt,tn,an;if(ie.eventType!=Lr&&(le>nr||xe.velocity===w)){var er=ie.deltaX-xe.deltaX,ir=ie.deltaY-xe.deltaY,li=as(le,er,ir);kt=li.x,tn=li.y,ke=G(li.x)>G(li.y)?li.x:li.y,an=oi(er,ir),X.lastInterval=ie}else ke=xe.velocity,kt=xe.velocityX,tn=xe.velocityY,an=xe.direction;ie.velocity=ke,ie.velocityX=kt,ie.velocityY=tn,ie.direction=an}function Fo(X){for(var ie=[],xe=0;xe<X.pointers.length;)ie[xe]={clientX:o(X.pointers[xe].clientX),clientY:o(X.pointers[xe].clientY)},xe++;return{timeStamp:ne(),pointers:ie,center:ss(ie),deltaX:X.deltaX,deltaY:X.deltaY}}function ss(X){var ie=X.length;if(ie===1)return{x:o(X[0].clientX),y:o(X[0].clientY)};for(var xe=0,le=0,ke=0;ke<ie;)xe+=X[ke].clientX,le+=X[ke].clientY,ke++;return{x:o(xe/ie),y:o(le/ie)}}function as(X,ie,xe){return{x:ie/X||0,y:xe/X||0}}function oi(X,ie){return X===ie?Ai:G(X)>=G(ie)?X<0?Vr:yo:ie<0?no:en}function bo(X,ie,xe){xe||(xe=is);var le=ie[xe[0]]-X[xe[0]],ke=ie[xe[1]]-X[xe[1]];return Math.sqrt(le*le+ke*ke)}function wo(X,ie,xe){xe||(xe=is);var le=ie[xe[0]]-X[xe[0]],ke=ie[xe[1]]-X[xe[1]];return Math.atan2(ke,le)*180/Math.PI}function No(X,ie){return wo(ie[1],ie[0],vo)+wo(X[1],X[0],vo)}function Ui(X,ie){return bo(ie[0],ie[1],vo)/bo(X[0],X[1],vo)}var ls={mousedown:On,mousemove:ar,mouseup:Pn},Zr="mousedown",Uo="mousemove mouseup";function Kn(){this.evEl=Zr,this.evWin=Uo,this.pressed=!1,rn.apply(this,arguments)}He(Kn,rn,{handler:function(ie){var xe=ls[ie.type];xe&On&&ie.button===0&&(this.pressed=!0),xe&ar&&ie.which!==1&&(xe=Pn),this.pressed&&(xe&Pn&&(this.pressed=!1),this.callback(this.manager,xe,{pointers:[ie],changedPointers:[ie],pointerType:Wt,srcEvent:ie}))}});var yi={pointerdown:On,pointermove:ar,pointerup:Pn,pointercancel:Lr,pointerout:Lr},us={2:st,3:wt,4:Wt,5:Jt},ji="pointerdown",Eo="pointermove pointerup pointercancel";s.MSPointerEvent&&!s.PointerEvent&&(ji="MSPointerDown",Eo="MSPointerMove MSPointerUp MSPointerCancel");function Vi(){this.evEl=ji,this.evWin=Eo,rn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}He(Vi,rn,{handler:function(ie){var xe=this.store,le=!1,ke=ie.type.toLowerCase().replace("ms",""),kt=yi[ke],tn=us[ie.pointerType]||ie.pointerType,an=tn==st,er=Yt(xe,ie.pointerId,"pointerId");kt&On&&(ie.button===0||an)?er<0&&(xe.push(ie),er=xe.length-1):kt&(Pn|Lr)&&(le=!0),!(er<0)&&(xe[er]=ie,this.callback(this.manager,kt,{pointers:xe,changedPointers:[ie],pointerType:tn,srcEvent:ie}),le&&xe.splice(er,1))}});var $i={touchstart:On,touchmove:ar,touchend:Pn,touchcancel:Lr},vi="touchstart",xi="touchstart touchmove touchend touchcancel";function Rr(){this.evTarget=vi,this.evWin=xi,this.started=!1,rn.apply(this,arguments)}He(Rr,rn,{handler:function(ie){var xe=$i[ie.type];if(xe===On&&(this.started=!0),!!this.started){var le=cs.call(this,ie,xe);xe&(Pn|Lr)&&le[0].length-le[1].length===0&&(this.started=!1),this.callback(this.manager,xe,{pointers:le[0],changedPointers:le[1],pointerType:st,srcEvent:ie})}}});function cs(X,ie){var xe=Nt(X.touches),le=Nt(X.changedTouches);return ie&(Pn|Lr)&&(xe=$t(xe.concat(le),"identifier")),[xe,le]}var si={touchstart:On,touchmove:ar,touchend:Pn,touchcancel:Lr},se="touchstart touchmove touchend touchcancel";function F(){this.evTarget=se,this.targetIds={},rn.apply(this,arguments)}He(F,rn,{handler:function(ie){var xe=si[ie.type],le=Z.call(this,ie,xe);le&&this.callback(this.manager,xe,{pointers:le[0],changedPointers:le[1],pointerType:st,srcEvent:ie})}});function Z(X,ie){var xe=Nt(X.touches),le=this.targetIds;if(ie&(On|ar)&&xe.length===1)return le[xe[0].identifier]=!0,[xe,xe];var ke,kt,tn=Nt(X.changedTouches),an=[],er=this.target;if(kt=xe.filter(function(ir){return It(ir.target,er)}),ie===On)for(ke=0;ke<kt.length;)le[kt[ke].identifier]=!0,ke++;for(ke=0;ke<tn.length;)le[tn[ke].identifier]&&an.push(tn[ke]),ie&(Pn|Lr)&&delete le[tn[ke].identifier],ke++;if(an.length)return[$t(kt.concat(an),"identifier"),an]}var re=2500,ue=25;function ve(){rn.apply(this,arguments);var X=Ve(this.handler,this);this.touch=new F(this.manager,X),this.mouse=new Kn(this.manager,X),this.primaryTouch=null,this.lastTouches=[]}He(ve,rn,{handler:function(ie,xe,le){var ke=le.pointerType==st,kt=le.pointerType==Wt;if(!(kt&&le.sourceCapabilities&&le.sourceCapabilities.firesTouchEvents)){if(ke)Ie.call(this,xe,le);else if(kt&&we.call(this,le))return;this.callback(ie,xe,le)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ie(X,ie){X&On?(this.primaryTouch=ie.changedPointers[0].identifier,Ce.call(this,ie)):X&(Pn|Lr)&&Ce.call(this,ie)}function Ce(X){var ie=X.changedPointers[0];if(ie.identifier===this.primaryTouch){var xe={x:ie.clientX,y:ie.clientY};this.lastTouches.push(xe);var le=this.lastTouches,ke=function(){var kt=le.indexOf(xe);kt>-1&&le.splice(kt,1)};setTimeout(ke,re)}}function we(X){for(var ie=X.srcEvent.clientX,xe=X.srcEvent.clientY,le=0;le<this.lastTouches.length;le++){var ke=this.lastTouches[le],kt=Math.abs(ie-ke.x),tn=Math.abs(xe-ke.y);if(kt<=ue&&tn<=ue)return!0}return!1}var De=Et(k.style,"touchAction"),We=De!==w,et="compute",it="auto",Mt="manipulation",At="none",Lt="pan-x",Ut="pan-y",on=Sn();function jn(X,ie){this.manager=X,this.set(ie)}jn.prototype={set:function(X){X==et&&(X=this.compute()),We&&this.manager.element.style&&on[X]&&(this.manager.element.style[De]=X),this.actions=X.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var X=[];return de(this.manager.recognizers,function(ie){Xe(ie.options.enable,[ie])&&(X=X.concat(ie.getTouchAction()))}),Qn(X.join(" "))},preventDefaults:function(X){var ie=X.srcEvent,xe=X.offsetDirection;if(this.manager.session.prevented){ie.preventDefault();return}var le=this.actions,ke=Pt(le,At)&&!on[At],kt=Pt(le,Ut)&&!on[Ut],tn=Pt(le,Lt)&&!on[Lt];if(ke){var an=X.pointers.length===1,er=X.distance<2,ir=X.deltaTime<250;if(an&&er&&ir)return}if(!(tn&&kt)&&(ke||kt&&xe&cr||tn&&xe&$r))return this.preventSrc(ie)},preventSrc:function(X){this.manager.session.prevented=!0,X.preventDefault()}};function Qn(X){if(Pt(X,At))return At;var ie=Pt(X,Lt),xe=Pt(X,Ut);return ie&&xe?At:ie||xe?ie?Lt:Ut:Pt(X,Mt)?Mt:it}function Sn(){if(!We)return!1;var X={},ie=s.CSS&&s.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(xe){X[xe]=ie?s.CSS.supports("touch-action",xe):!0}),X}var Vn=1,br=2,ai=4,rr=8,Sr=rr,To=16,bi=32;function ki(X){this.options=Te({},this.defaults,X||{}),this.id=Dr(),this.manager=null,this.options.enable=$e(this.options.enable,!0),this.state=Vn,this.simultaneous={},this.requireFail=[]}ki.prototype={defaults:{},set:function(X){return Te(this.options,X),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(X){if($(X,"recognizeWith",this))return this;var ie=this.simultaneous;return X=Gr(X,this),ie[X.id]||(ie[X.id]=X,X.recognizeWith(this)),this},dropRecognizeWith:function(X){return $(X,"dropRecognizeWith",this)?this:(X=Gr(X,this),delete this.simultaneous[X.id],this)},requireFailure:function(X){if($(X,"requireFailure",this))return this;var ie=this.requireFail;return X=Gr(X,this),Yt(ie,X)===-1&&(ie.push(X),X.requireFailure(this)),this},dropRequireFailure:function(X){if($(X,"dropRequireFailure",this))return this;X=Gr(X,this);var ie=Yt(this.requireFail,X);return ie>-1&&this.requireFail.splice(ie,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(X){return!!this.simultaneous[X.id]},emit:function(X){var ie=this,xe=this.state;function le(ke){ie.manager.emit(ke,X)}xe<rr&&le(ie.options.event+hs(xe)),le(ie.options.event),X.additionalEvent&&le(X.additionalEvent),xe>=rr&&le(ie.options.event+hs(xe))},tryEmit:function(X){if(this.canEmit())return this.emit(X);this.state=bi},canEmit:function(){for(var X=0;X<this.requireFail.length;){if(!(this.requireFail[X].state&(bi|Vn)))return!1;X++}return!0},recognize:function(X){var ie=Te({},X);if(!Xe(this.options.enable,[this,ie])){this.reset(),this.state=bi;return}this.state&(Sr|To|bi)&&(this.state=Vn),this.state=this.process(ie),this.state&(br|ai|rr|To)&&this.tryEmit(ie)},process:function(X){},getTouchAction:function(){},reset:function(){}};function hs(X){return X&To?"cancel":X&rr?"end":X&ai?"move":X&br?"start":""}function ks(X){return X==en?"down":X==no?"up":X==Vr?"left":X==yo?"right":""}function Gr(X,ie){var xe=ie.manager;return xe?xe.get(X):X}function gr(){ki.apply(this,arguments)}He(gr,ki,{defaults:{pointers:1},attrTest:function(X){var ie=this.options.pointers;return ie===0||X.pointers.length===ie},process:function(X){var ie=this.state,xe=X.eventType,le=ie&(br|ai),ke=this.attrTest(X);return le&&(xe&Lr||!ke)?ie|To:le||ke?xe&Pn?ie|rr:ie&br?ie|ai:br:bi}});function Qr(){gr.apply(this,arguments),this.pX=null,this.pY=null}He(Qr,gr,{defaults:{event:"pan",threshold:10,pointers:1,direction:Oo},getTouchAction:function(){var X=this.options.direction,ie=[];return X&cr&&ie.push(Ut),X&$r&&ie.push(Lt),ie},directionTest:function(X){var ie=this.options,xe=!0,le=X.distance,ke=X.direction,kt=X.deltaX,tn=X.deltaY;return ke&ie.direction||(ie.direction&cr?(ke=kt===0?Ai:kt<0?Vr:yo,xe=kt!=this.pX,le=Math.abs(X.deltaX)):(ke=tn===0?Ai:tn<0?no:en,xe=tn!=this.pY,le=Math.abs(X.deltaY))),X.direction=ke,xe&&le>ie.threshold&&ke&ie.direction},attrTest:function(X){return gr.prototype.attrTest.call(this,X)&&(this.state&br||!(this.state&br)&&this.directionTest(X))},emit:function(X){this.pX=X.deltaX,this.pY=X.deltaY;var ie=ks(X.direction);ie&&(X.additionalEvent=this.options.event+ie),this._super.emit.call(this,X)}});function zi(){gr.apply(this,arguments)}He(zi,gr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[At]},attrTest:function(X){return this._super.attrTest.call(this,X)&&(Math.abs(X.scale-1)>this.options.threshold||this.state&br)},emit:function(X){if(X.scale!==1){var ie=X.scale<1?"in":"out";X.additionalEvent=this.options.event+ie}this._super.emit.call(this,X)}});function Or(){ki.apply(this,arguments),this._timer=null,this._input=null}He(Or,ki,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[it]},process:function(X){var ie=this.options,xe=X.pointers.length===ie.pointers,le=X.distance<ie.threshold,ke=X.deltaTime>ie.time;if(this._input=X,!le||!xe||X.eventType&(Pn|Lr)&&!ke)this.reset();else if(X.eventType&On)this.reset(),this._timer=oe(function(){this.state=Sr,this.tryEmit()},ie.time,this);else if(X.eventType&Pn)return Sr;return bi},reset:function(){clearTimeout(this._timer)},emit:function(X){this.state===Sr&&(X&&X.eventType&Pn?this.manager.emit(this.options.event+"up",X):(this._input.timeStamp=ne(),this.manager.emit(this.options.event,this._input)))}});function Zi(){gr.apply(this,arguments)}He(Zi,gr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[At]},attrTest:function(X){return this._super.attrTest.call(this,X)&&(Math.abs(X.rotation)>this.options.threshold||this.state&br)}});function qr(){gr.apply(this,arguments)}He(qr,gr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:cr|$r,pointers:1},getTouchAction:function(){return Qr.prototype.getTouchAction.call(this)},attrTest:function(X){var ie=this.options.direction,xe;return ie&(cr|$r)?xe=X.overallVelocity:ie&cr?xe=X.overallVelocityX:ie&$r&&(xe=X.overallVelocityY),this._super.attrTest.call(this,X)&&ie&X.offsetDirection&&X.distance>this.options.threshold&&X.maxPointers==this.options.pointers&&G(xe)>this.options.velocity&&X.eventType&Pn},emit:function(X){var ie=ks(X.offsetDirection);ie&&this.manager.emit(this.options.event+ie,X),this.manager.emit(this.options.event,X)}});function ra(){ki.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}He(ra,ki,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Mt]},process:function(X){var ie=this.options,xe=X.pointers.length===ie.pointers,le=X.distance<ie.threshold,ke=X.deltaTime<ie.time;if(this.reset(),X.eventType&On&&this.count===0)return this.failTimeout();if(le&&ke&&xe){if(X.eventType!=Pn)return this.failTimeout();var kt=this.pTime?X.timeStamp-this.pTime<ie.interval:!0,tn=!this.pCenter||bo(this.pCenter,X.center)<ie.posThreshold;this.pTime=X.timeStamp,this.pCenter=X.center,!tn||!kt?this.count=1:this.count+=1,this._input=X;var an=this.count%ie.taps;if(an===0)return this.hasRequireFailures()?(this._timer=oe(function(){this.state=Sr,this.tryEmit()},ie.interval,this),br):Sr}return bi},failTimeout:function(){return this._timer=oe(function(){this.state=bi},this.options.interval,this),bi},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Sr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Gi(X,ie){return ie=ie||{},ie.recognizers=$e(ie.recognizers,Gi.defaults.preset),new fs(X,ie)}Gi.VERSION="2.0.7",Gi.defaults={domEvents:!1,touchAction:et,enable:!0,inputTarget:null,inputClass:null,preset:[[Zi,{enable:!1}],[zi,{enable:!1},["rotate"]],[qr,{direction:cr}],[Qr,{direction:cr},["swipe"]],[ra],[ra,{event:"doubletap",taps:2},["tap"]],[Or]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ds=1,qi=2;function fs(X,ie){this.options=Te({},Gi.defaults,ie||{}),this.options.inputTarget=this.options.inputTarget||X,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=X,this.input=xo(this),this.touchAction=new jn(this,this.options.touchAction),El(this,!0),de(this.options.recognizers,function(xe){var le=this.add(new xe[0](xe[1]));xe[2]&&le.recognizeWith(xe[2]),xe[3]&&le.requireFailure(xe[3])},this)}fs.prototype={set:function(X){return Te(this.options,X),X.touchAction&&this.touchAction.update(),X.inputTarget&&(this.input.destroy(),this.input.target=X.inputTarget,this.input.init()),this},stop:function(X){this.session.stopped=X?qi:ds},recognize:function(X){var ie=this.session;if(!ie.stopped){this.touchAction.preventDefaults(X);var xe,le=this.recognizers,ke=ie.curRecognizer;(!ke||ke&&ke.state&Sr)&&(ke=ie.curRecognizer=null);for(var kt=0;kt<le.length;)xe=le[kt],ie.stopped!==qi&&(!ke||xe==ke||xe.canRecognizeWith(ke))?xe.recognize(X):xe.reset(),!ke&&xe.state&(br|ai|rr)&&(ke=ie.curRecognizer=xe),kt++}},get:function(X){if(X instanceof ki)return X;for(var ie=this.recognizers,xe=0;xe<ie.length;xe++)if(ie[xe].options.event==X)return ie[xe];return null},add:function(X){if($(X,"add",this))return this;var ie=this.get(X.options.event);return ie&&this.remove(ie),this.recognizers.push(X),X.manager=this,this.touchAction.update(),X},remove:function(X){if($(X,"remove",this))return this;if(X=this.get(X),X){var ie=this.recognizers,xe=Yt(ie,X);xe!==-1&&(ie.splice(xe,1),this.touchAction.update())}return this},on:function(X,ie){if(X!==w&&ie!==w){var xe=this.handlers;return de(Ot(X),function(le){xe[le]=xe[le]||[],xe[le].push(ie)}),this}},off:function(X,ie){if(X!==w){var xe=this.handlers;return de(Ot(X),function(le){ie?xe[le]&&xe[le].splice(Yt(xe[le],ie),1):delete xe[le]}),this}},emit:function(X,ie){this.options.domEvents&&ia(X,ie);var xe=this.handlers[X]&&this.handlers[X].slice();if(!(!xe||!xe.length)){ie.type=X,ie.preventDefault=function(){ie.srcEvent.preventDefault()};for(var le=0;le<xe.length;)xe[le](ie),le++}},destroy:function(){this.element&&El(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function El(X,ie){var xe=X.element;if(xe.style){var le;de(X.options.cssProps,function(ke,kt){le=Et(xe.style,kt),ie?(X.oldCssProps[le]=xe.style[le],xe.style[le]=ke):xe.style[le]=X.oldCssProps[le]||""}),ie||(X.oldCssProps={})}}function ia(X,ie){var xe=h.createEvent("Event");xe.initEvent(X,!0,!0),xe.gesture=ie,ie.target.dispatchEvent(xe)}Te(Gi,{INPUT_START:On,INPUT_MOVE:ar,INPUT_END:Pn,INPUT_CANCEL:Lr,STATE_POSSIBLE:Vn,STATE_BEGAN:br,STATE_CHANGED:ai,STATE_ENDED:rr,STATE_RECOGNIZED:Sr,STATE_CANCELLED:To,STATE_FAILED:bi,DIRECTION_NONE:Ai,DIRECTION_LEFT:Vr,DIRECTION_RIGHT:yo,DIRECTION_UP:no,DIRECTION_DOWN:en,DIRECTION_HORIZONTAL:cr,DIRECTION_VERTICAL:$r,DIRECTION_ALL:Oo,Manager:fs,Input:rn,TouchAction:jn,TouchInput:F,MouseInput:Kn,PointerEventInput:Vi,TouchMouseInput:ve,SingleTouchInput:Rr,Recognizer:ki,AttrRecognizer:gr,Tap:ra,Pan:Qr,Swipe:qr,Pinch:zi,Rotate:Zi,Press:Or,on:Ze,off:xt,each:de,merge:je,extend:Me,assign:Te,inherit:He,bindFn:Ve,prefixed:Et});var oa=typeof s<"u"?s:typeof self<"u"?self:{};oa.Hammer=Gi,c.exports?c.exports=Gi:s[g]=Gi})(window,document,"Hammer")}($m)),$m.exports}var _w=gw();const Is=kp(_w),vx=1,xx=2,dg=4,yw={mousedown:vx,mousemove:xx,mouseup:dg};function vw(c,s){for(let h=0;h<c.length;h++)if(s(c[h]))return!0;return!1}function xw(c){const s=c.prototype.handler;c.prototype.handler=function(g){const w=this.store;g.button>0&&g.type==="pointerdown"&&(vw(w,M=>M.pointerId===g.pointerId)||w.push(g)),s.call(this,g)}}function bw(c){c.prototype.handler=function(h){let g=yw[h.type];g&vx&&h.button>=0&&(this.pressed=!0),g&xx&&h.which===0&&(g=dg),this.pressed&&(g&dg&&(this.pressed=!1),this.callback(this.manager,g,{pointers:[h],changedPointers:[h],pointerType:"mouse",srcEvent:h}))}}xw(Is.PointerEventInput);bw(Is.MouseInput);const ww=Is.Manager,Ew=Is?[[Is.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Is.Rotate,{enable:!1}],[Is.Pinch,{enable:!1}],[Is.Swipe,{enable:!1}],[Is.Pan,{threshold:0,enable:!1}],[Is.Press,{enable:!1}],[Is.Tap,{event:"doubletap",taps:2,enable:!1}],[Is.Tap,{event:"anytap",enable:!1}],[Is.Tap,{enable:!1}]]:null,nv={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Tw={doubletap:["tap"]},Sw={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Ag={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Mw={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},rv={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Cw=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",sd=typeof window<"u"?window:global;let bx=!1;try{const c={get passive(){return bx=!0,!0}};sd.addEventListener("test",c,c),sd.removeEventListener("test",c,c)}catch{}const Pw=Cw.indexOf("firefox")!==-1,{WHEEL_EVENTS:Iw}=Ag,iv="wheel",ov=4.000244140625,Aw=40,kw=.25;class zw{constructor(s,h,g={}){this.element=s,this.callback=h,this.options=Object.assign({enable:!0},g),this.events=Iw.concat(g.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(w=>s.addEventListener(w,this.handleEvent,bx?{passive:!1}:!1))}destroy(){this.events.forEach(s=>this.element.removeEventListener(s,this.handleEvent))}enableEventType(s,h){s===iv&&(this.options.enable=h)}handleEvent(s){if(!this.options.enable)return;let h=s.deltaY;sd.WheelEvent&&(Pw&&s.deltaMode===sd.WheelEvent.DOM_DELTA_PIXEL&&(h/=sd.devicePixelRatio),s.deltaMode===sd.WheelEvent.DOM_DELTA_LINE&&(h*=Aw));const g={x:s.clientX,y:s.clientY};h!==0&&h%ov===0&&(h=Math.floor(h/ov)),s.shiftKey&&h&&(h=h*kw),this._onWheel(s,-h,g)}_onWheel(s,h,g){this.callback({type:iv,center:g,delta:h,srcEvent:s,pointerType:"mouse",target:s.target})}}const{MOUSE_EVENTS:Dw}=Ag,sv="pointermove",av="pointerover",lv="pointerout",uv="pointerleave";class Lw{constructor(s,h,g={}){this.element=s,this.callback=h,this.pressed=!1,this.options=Object.assign({enable:!0},g),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=Dw.concat(g.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(w=>s.addEventListener(w,this.handleEvent))}destroy(){this.events.forEach(s=>this.element.removeEventListener(s,this.handleEvent))}enableEventType(s,h){s===sv&&(this.enableMoveEvent=h),s===av&&(this.enableOverEvent=h),s===lv&&(this.enableOutEvent=h),s===uv&&(this.enableLeaveEvent=h)}handleEvent(s){this.handleOverEvent(s),this.handleOutEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)}handleOverEvent(s){this.enableOverEvent&&s.type==="mouseover"&&this.callback({type:av,srcEvent:s,pointerType:"mouse",target:s.target})}handleOutEvent(s){this.enableOutEvent&&s.type==="mouseout"&&this.callback({type:lv,srcEvent:s,pointerType:"mouse",target:s.target})}handleLeaveEvent(s){this.enableLeaveEvent&&s.type==="mouseleave"&&this.callback({type:uv,srcEvent:s,pointerType:"mouse",target:s.target})}handleMoveEvent(s){if(this.enableMoveEvent)switch(s.type){case"mousedown":s.button>=0&&(this.pressed=!0);break;case"mousemove":s.which===0&&(this.pressed=!1),this.pressed||this.callback({type:sv,srcEvent:s,pointerType:"mouse",target:s.target});break;case"mouseup":this.pressed=!1;break}}}const{KEY_EVENTS:Rw}=Ag,cv="keydown",hv="keyup";class Ow{constructor(s,h,g={}){this.element=s,this.callback=h,this.options=Object.assign({enable:!0},g),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=Rw.concat(g.events||[]),this.handleEvent=this.handleEvent.bind(this),s.tabIndex=g.tabIndex||0,s.style.outline="none",this.events.forEach(w=>s.addEventListener(w,this.handleEvent))}destroy(){this.events.forEach(s=>this.element.removeEventListener(s,this.handleEvent))}enableEventType(s,h){s===cv&&(this.enableDownEvent=h),s===hv&&(this.enableUpEvent=h)}handleEvent(s){const h=s.target||s.srcElement;h.tagName==="INPUT"&&h.type==="text"||h.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:cv,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:hv,srcEvent:s,key:s.key,target:s.target}))}}const dv="contextmenu";class Bw{constructor(s,h,g={}){this.element=s,this.callback=h,this.options=Object.assign({enable:!0},g),this.handleEvent=this.handleEvent.bind(this),s.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(s,h){s===dv&&(this.options.enable=h)}handleEvent(s){this.options.enable&&this.callback({type:dv,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})}}const fg=1,Sp=2,pg=4,Fw={pointerdown:fg,pointermove:Sp,pointerup:pg,mousedown:fg,mousemove:Sp,mouseup:pg},Nw=1,Uw=2,jw=3,Vw=0,$w=1,Zw=2,Gw=1,qw=2,Ww=4;function Xw(c){const s=Fw[c.srcEvent.type];if(!s)return null;const{buttons:h,button:g,which:w}=c.srcEvent;let M=!1,k=!1,R=!1;return s===pg||s===Sp&&!Number.isFinite(h)?(M=w===Nw,k=w===Uw,R=w===jw):s===Sp?(M=!!(h&Gw),k=!!(h&Ww),R=!!(h&qw)):s===fg&&(M=g===Vw,k=g===$w,R=g===Zw),{leftButton:M,middleButton:k,rightButton:R}}function Hw(c,s){const{srcEvent:h}=c;if(!c.center&&!Number.isFinite(h.clientX))return null;const g=c.center||{x:h.clientX,y:h.clientY},w=s.getBoundingClientRect(),M=w.width/s.offsetWidth||1,k=w.height/s.offsetHeight||1,R={x:(g.x-w.left-s.clientLeft)/M,y:(g.y-w.top-s.clientTop)/k};return{center:g,offsetCenter:R}}const fv={srcElement:"root",priority:0};class Yw{constructor(s){this.eventManager=s,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this),this._active=!1}isEmpty(){return!this._active}add(s,h,g,w=!1,M=!1){const{handlers:k,handlersByElement:R}=this;g&&(typeof g!="object"||g.addEventListener)&&(g={srcElement:g}),g=g?Object.assign({},fv,g):fv;let o=R.get(g.srcElement);o||(o=[],R.set(g.srcElement,o));const G={type:s,handler:h,srcElement:g.srcElement,priority:g.priority};w&&(G.once=!0),M&&(G.passive=!0),k.push(G),this._active=this._active||!G.passive;let ne=o.length-1;for(;ne>=0&&!(o[ne].priority>=G.priority);)ne--;o.splice(ne+1,0,G)}remove(s,h){const{handlers:g,handlersByElement:w}=this;for(let M=g.length-1;M>=0;M--){const k=g[M];if(k.type===s&&k.handler===h){g.splice(M,1);const R=w.get(k.srcElement);R.splice(R.indexOf(k),1),R.length===0&&w.delete(k.srcElement)}}this._active=g.some(M=>!M.passive)}handleEvent(s){if(this.isEmpty())return;const h=this._normalizeEvent(s);let g=s.srcEvent.target;for(;g&&g!==h.rootElement;){if(this._emit(h,g),h.handled)return;g=g.parentNode}this._emit(h,"root")}_emit(s,h){const g=this.handlersByElement.get(h);if(g){let w=!1;const M=()=>{s.handled=!0},k=()=>{s.handled=!0,w=!0},R=[];for(let o=0;o<g.length;o++){const{type:G,handler:ne,once:oe}=g[o];if(ne(Object.assign({},s,{type:G,stopPropagation:M,stopImmediatePropagation:k})),oe&&R.push(g[o]),w)break}for(let o=0;o<R.length;o++){const{type:G,handler:ne}=R[o];this.remove(G,ne)}}}_normalizeEvent(s){const h=this.eventManager.element;return Object.assign({},s,Xw(s),Hw(s,h),{handled:!1,rootElement:h})}}const Kw={events:null,recognizers:null,recognizerOptions:{},Manager:ww,touchAction:"none",tabIndex:0};class Jw{constructor(s=null,h={}){this.options=Object.assign({},Kw,h),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(s);const{events:g}=h;g&&this.on(g)}setElement(s){if(this.element&&this.destroy(),this.element=s,!s)return;const{options:h}=this,g=h.Manager;this.manager=new g(s,{touchAction:h.touchAction,recognizers:h.recognizers||Ew}).on("hammer.input",this._onBasicInput),h.recognizers||Object.keys(nv).forEach(w=>{const M=this.manager.get(w);M&&nv[w].forEach(k=>{M.recognizeWith(k)})});for(const w in h.recognizerOptions){const M=this.manager.get(w);if(M){const k=h.recognizerOptions[w];delete k.enable,M.set(k)}}this.wheelInput=new zw(s,this._onOtherEvent,{enable:!1}),this.moveInput=new Lw(s,this._onOtherEvent,{enable:!1}),this.keyInput=new Ow(s,this._onOtherEvent,{enable:!1,tabIndex:h.tabIndex}),this.contextmenuInput=new Bw(s,this._onOtherEvent,{enable:!1});for(const[w,M]of this.events)M.isEmpty()||(this._toggleRecognizer(M.recognizerName,!0),this.manager.on(w,M.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(s,h,g){this._addEventHandler(s,h,g,!1)}once(s,h,g){this._addEventHandler(s,h,g,!0)}watch(s,h,g){this._addEventHandler(s,h,g,!1,!0)}off(s,h){this._removeEventHandler(s,h)}_toggleRecognizer(s,h){const{manager:g}=this;if(!g)return;const w=g.get(s);if(w&&w.options.enable!==h){w.set({enable:h});const M=Tw[s];M&&!this.options.recognizers&&M.forEach(k=>{const R=g.get(k);h?(R.requireFailure(s),w.dropRequireFailure(k)):R.dropRequireFailure(s)})}this.wheelInput.enableEventType(s,h),this.moveInput.enableEventType(s,h),this.keyInput.enableEventType(s,h),this.contextmenuInput.enableEventType(s,h)}_addEventHandler(s,h,g,w,M){if(typeof s!="string"){g=h;for(const ne in s)this._addEventHandler(ne,s[ne],g,w,M);return}const{manager:k,events:R}=this,o=rv[s]||s;let G=R.get(o);G||(G=new Yw(this),R.set(o,G),G.recognizerName=Mw[o]||o,k&&k.on(o,G.handleEvent)),G.add(s,h,g,w,M),G.isEmpty()||this._toggleRecognizer(G.recognizerName,!0)}_removeEventHandler(s,h){if(typeof s!="string"){for(const k in s)this._removeEventHandler(k,s[k]);return}const{events:g}=this,w=rv[s]||s,M=g.get(w);if(M&&(M.remove(s,h),M.isEmpty())){const{recognizerName:k}=M;let R=!1;for(const o of g.values())if(o.recognizerName===k&&!o.isEmpty()){R=!0;break}R||this._toggleRecognizer(k,!1)}}_onBasicInput(s){const{srcEvent:h}=s,g=Sw[h.type];g&&this.manager.emit(g,s)}_onOtherEvent(s){this.manager.emit(s.type,s)}}function pv(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function Ro(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?pv(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):pv(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}var ah={transitionDuration:0},hu={transitionDuration:300,transitionEasing:function(s){return s},transitionInterpolator:new cf,transitionInterruption:df.BREAK},ap=300,lp=function(s){return 1-(1-s)*(1-s)},Jh={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},wx=function(){function c(){var s=this;lc(this,c),fn(this,"events",[]),fn(this,"scrollZoom",!0),fn(this,"dragPan",!0),fn(this,"dragRotate",!0),fn(this,"doubleClickZoom",!0),fn(this,"touchZoom",!0),fn(this,"touchRotate",!1),fn(this,"keyboard",!0),fn(this,"_interactionState",{isDragging:!1}),fn(this,"_events",{}),fn(this,"_setInteractionState",function(h){Object.assign(s._interactionState,h),s.onStateChange&&s.onStateChange(s._interactionState)}),fn(this,"_onTransition",function(h,g){s.onViewportChange(h,s._interactionState,g)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new Ig({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return uc(c,[{key:"handleEvent",value:function(h){this.mapState=this.getMapState();var g=this._eventStartBlocked;switch(h.type){case"panstart":return g?!1:this._onPanStart(h);case"panmove":return this._onPan(h);case"panend":return this._onPanEnd(h);case"pinchstart":return g?!1:this._onPinchStart(h);case"pinchmove":return this._onPinch(h);case"pinchend":return this._onPinchEnd(h);case"tripanstart":return g?!1:this._onTriplePanStart(h);case"tripanmove":return this._onTriplePan(h);case"tripanend":return this._onTriplePanEnd(h);case"doubletap":return this._onDoubleTap(h);case"wheel":return this._onWheel(h);case"keydown":return this._onKeyDown(h);default:return!1}}},{key:"getCenter",value:function(h){var g=h.offsetCenter,w=g.x,M=g.y;return[w,M]}},{key:"isFunctionKeyPressed",value:function(h){var g=h.srcEvent;return!!(g.metaKey||g.altKey||g.ctrlKey||g.shiftKey)}},{key:"blockEvents",value:function(h){var g=this,w=setTimeout(function(){g._eventStartBlocked===w&&(g._eventStartBlocked=null)},h);this._eventStartBlocked=w}},{key:"updateViewport",value:function(h,g,w){var M=this.mapState instanceof ld?this.mapState.getViewportProps():this.mapState,k=Ro(Ro({},h.getViewportProps()),g),R=Object.keys(k).some(function(o){return M[o]!==k[o]});this._state=h.getState(),this._setInteractionState(w),R&&this.onViewportChange(k,this._interactionState,M)}},{key:"getMapState",value:function(h){return new ld(Ro(Ro(Ro({},this.mapStateProps),this._state),h))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(h){var g=h.onViewportChange,w=h.onStateChange,M=h.eventManager,k=M===void 0?this.eventManager:M,R=h.isInteractive,o=R===void 0?!0:R,G=h.scrollZoom,ne=G===void 0?this.scrollZoom:G,oe=h.dragPan,$=oe===void 0?this.dragPan:oe,de=h.dragRotate,H=de===void 0?this.dragRotate:de,Te=h.doubleClickZoom,Me=Te===void 0?this.doubleClickZoom:Te,je=h.touchZoom,He=je===void 0?this.touchZoom:je,Ve=h.touchRotate,Xe=Ve===void 0?this.touchRotate:Ve,$e=h.keyboard,Ze=$e===void 0?this.keyboard:$e;this.onViewportChange=g,this.onStateChange=w;var xt=this.mapStateProps||{},It=xt.height!==h.height||xt.width!==h.width;this.mapStateProps=h,It&&(this.mapState=xt,this.updateViewport(new ld(h))),this._transitionManager.processViewportChange(h),this.eventManager!==k&&(this.eventManager=k,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(Jh.WHEEL,o&&!!ne),this.toggleEvents(Jh.PAN,o&&!!($||H)),this.toggleEvents(Jh.PINCH,o&&!!(He||Xe)),this.toggleEvents(Jh.TRIPLE_PAN,o&&!!Xe),this.toggleEvents(Jh.DOUBLE_TAP,o&&!!Me),this.toggleEvents(Jh.KEYBOARD,o&&!!Ze),this.scrollZoom=ne,this.dragPan=$,this.dragRotate=H,this.doubleClickZoom=Me,this.touchZoom=He,this.touchRotate=Xe,this.keyboard=Ze}},{key:"toggleEvents",value:function(h,g){var w=this;this.eventManager&&h.forEach(function(M){w._events[M]!==g&&(w._events[M]=g,g?w.eventManager.on(M,w.handleEvent):w.eventManager.off(M,w.handleEvent))})}},{key:"_onPanStart",value:function(h){var g=this.getCenter(h);this._panRotate=this.isFunctionKeyPressed(h)||h.rightButton;var w=this._panRotate?this.mapState.rotateStart({pos:g}):this.mapState.panStart({pos:g});return this.updateViewport(w,ah,{isDragging:!0}),!0}},{key:"_onPan",value:function(h){return this.isDragging()?this._panRotate?this._onPanRotate(h):this._onPanMove(h):!1}},{key:"_onPanEnd",value:function(h){return this.isDragging()?this._panRotate?this._onPanRotateEnd(h):this._onPanMoveEnd(h):!1}},{key:"_onPanMove",value:function(h){if(!this.dragPan)return!1;var g=this.getCenter(h),w=this.mapState.pan({pos:g});return this.updateViewport(w,ah,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(h){if(this.dragPan){var g=this.dragPan.inertia,w=g===void 0?ap:g;if(w&&h.velocity){var M=this.getCenter(h),k=[M[0]+h.velocityX*w/2,M[1]+h.velocityY*w/2],R=this.mapState.pan({pos:k}).panEnd();return this.updateViewport(R,Ro(Ro({},hu),{},{transitionDuration:w,transitionEasing:lp}),{isDragging:!1,isPanning:!0}),!0}}var o=this.mapState.panEnd();return this.updateViewport(o,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(h){if(!this.dragRotate)return!1;var g=this.getCenter(h),w=this.mapState.rotate({pos:g});return this.updateViewport(w,ah,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(h){if(this.dragRotate){var g=this.dragRotate.inertia,w=g===void 0?ap:g;if(w&&h.velocity){var M=this.getCenter(h),k=[M[0]+h.velocityX*w/2,M[1]+h.velocityY*w/2],R=this.mapState.rotate({pos:k}).rotateEnd();return this.updateViewport(R,Ro(Ro({},hu),{},{transitionDuration:w,transitionEasing:lp}),{isDragging:!1,isRotating:!0}),!0}}var o=this.mapState.panEnd();return this.updateViewport(o,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(h){if(!this.scrollZoom)return!1;var g=this.scrollZoom,w=g.speed,M=w===void 0?.01:w,k=g.smooth,R=k===void 0?!1:k;h.preventDefault();var o=this.getCenter(h),G=h.delta,ne=2/(1+Math.exp(-Math.abs(G*M)));G<0&&ne!==0&&(ne=1/ne);var oe=this.mapState.zoom({pos:o,scale:ne});return oe.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(oe,Ro(Ro({},hu),{},{transitionInterpolator:new cf({around:o}),transitionDuration:R?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(h){var g=this.getCenter(h),w=this.mapState.zoomStart({pos:g}).rotateStart({pos:g});return this._startPinchRotation=h.rotation,this._lastPinchEvent=h,this.updateViewport(w,ah,{isDragging:!0}),!0}},{key:"_onPinch",value:function(h){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var g=this.mapState;if(this.touchZoom){var w=h.scale,M=this.getCenter(h);g=g.zoom({pos:M,scale:w})}if(this.touchRotate){var k=h.rotation;g=g.rotate({deltaAngleX:this._startPinchRotation-k})}return this.updateViewport(g,ah,{isDragging:!0,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!!this.touchRotate}),this._lastPinchEvent=h,!0}},{key:"_onPinchEnd",value:function(h){if(!this.isDragging())return!1;if(this.touchZoom){var g=this.touchZoom.inertia,w=g===void 0?ap:g,M=this._lastPinchEvent;if(w&&M&&h.scale!==M.scale){var k=this.getCenter(h),R=this.mapState.rotateEnd(),o=Math.log2(h.scale),G=(o-Math.log2(M.scale))/(h.deltaTime-M.deltaTime),ne=Math.pow(2,o+G*w/2);return R=R.zoom({pos:k,scale:ne}).zoomEnd(),this.updateViewport(R,Ro(Ro({},hu),{},{transitionInterpolator:new cf({around:k}),transitionDuration:w,transitionEasing:lp}),{isDragging:!1,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!1}),this.blockEvents(w),!0}}var oe=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(oe,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(h){var g=this.getCenter(h),w=this.mapState.rotateStart({pos:g});return this.updateViewport(w,ah,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(h){if(!this.isDragging()||!this.touchRotate)return!1;var g=this.getCenter(h);g[0]-=h.deltaX;var w=this.mapState.rotate({pos:g});return this.updateViewport(w,ah,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(h){if(!this.isDragging())return!1;if(this.touchRotate){var g=this.touchRotate.inertia,w=g===void 0?ap:g;if(w&&h.velocityY){var M=this.getCenter(h),k=[M[0],M[1]+=h.velocityY*w/2],R=this.mapState.rotate({pos:k});return this.updateViewport(R,Ro(Ro({},hu),{},{transitionDuration:w,transitionEasing:lp}),{isDragging:!1,isRotating:!0}),this.blockEvents(w),!1}}var o=this.mapState.rotateEnd();return this.updateViewport(o,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(h){if(!this.doubleClickZoom)return!1;var g=this.getCenter(h),w=this.isFunctionKeyPressed(h),M=this.mapState.zoom({pos:g,scale:w?.5:2});return this.updateViewport(M,Object.assign({},hu,{transitionInterpolator:new cf({around:g})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(h){if(!this.keyboard)return!1;var g=this.isFunctionKeyPressed(h),w=this.keyboard,M=w.zoomSpeed,k=M===void 0?2:M,R=w.moveSpeed,o=R===void 0?100:R,G=w.rotateSpeedX,ne=G===void 0?15:G,oe=w.rotateSpeedY,$=oe===void 0?10:oe,de=this.mapStateProps,H;switch(h.srcEvent.keyCode){case 189:g?H=this.getMapState({zoom:de.zoom-Math.log2(k)-1}):H=this.getMapState({zoom:de.zoom-Math.log2(k)});break;case 187:g?H=this.getMapState({zoom:de.zoom+Math.log2(k)+1}):H=this.getMapState({zoom:de.zoom+Math.log2(k)});break;case 37:g?H=this.getMapState({bearing:de.bearing-ne}):H=this.mapState.pan({pos:[o,0],startPos:[0,0]});break;case 39:g?H=this.getMapState({bearing:de.bearing+ne}):H=this.mapState.pan({pos:[-o,0],startPos:[0,0]});break;case 38:g?H=this.getMapState({pitch:de.pitch+$}):H=this.mapState.pan({pos:[0,o],startPos:[0,0]});break;case 40:g?H=this.getMapState({pitch:de.pitch-$}):H=this.mapState.pan({pos:[0,-o],startPos:[0,0]});break;default:return!1}return this.updateViewport(H,hu)}}]),c}();function mv(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function uu(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?mv(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):mv(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}var Qw=Object.assign({},cc.propTypes,{maxZoom:Oe.number,minZoom:Oe.number,maxPitch:Oe.number,minPitch:Oe.number,onViewStateChange:Oe.func,onViewportChange:Oe.func,onInteractionStateChange:Oe.func,transitionDuration:Oe.oneOfType([Oe.number,Oe.string]),transitionInterpolator:Oe.object,transitionInterruption:Oe.number,transitionEasing:Oe.func,onTransitionStart:Oe.func,onTransitionInterrupt:Oe.func,onTransitionEnd:Oe.func,scrollZoom:Oe.oneOfType([Oe.bool,Oe.object]),dragPan:Oe.oneOfType([Oe.bool,Oe.object]),dragRotate:Oe.oneOfType([Oe.bool,Oe.object]),doubleClickZoom:Oe.bool,touchZoom:Oe.oneOfType([Oe.bool,Oe.object]),touchRotate:Oe.oneOfType([Oe.bool,Oe.object]),keyboard:Oe.oneOfType([Oe.bool,Oe.object]),onHover:Oe.func,onClick:Oe.func,onDblClick:Oe.func,onContextMenu:Oe.func,onMouseDown:Oe.func,onMouseMove:Oe.func,onMouseUp:Oe.func,onTouchStart:Oe.func,onTouchMove:Oe.func,onTouchEnd:Oe.func,onMouseEnter:Oe.func,onMouseLeave:Oe.func,onMouseOut:Oe.func,onWheel:Oe.func,touchAction:Oe.string,eventRecognizerOptions:Oe.object,clickRadius:Oe.number,interactiveLayerIds:Oe.array,getCursor:Oe.func,controller:Oe.instanceOf(wx)}),eE=function(s){var h=s.isDragging,g=s.isHovering;return h?"grabbing":g?"pointer":"grab"},tE=Object.assign({},cc.defaultProps,uh,Ig.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(s){return s.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:eE});function kg(c){if(c.lngLat||!c.offsetCenter)return c;var s=c.offsetCenter,h=s.x,g=s.y;if(!Number.isFinite(h)||!Number.isFinite(g))return c;var w=[h,g];if(c.point=w,this.map){var M=this.map.unproject(w);c.lngLat=[M.lng,M.lat]}return c}function Ex(c){var s=this.map;if(!s||!c)return null;var h={},g=this.props.clickRadius;this.props.interactiveLayerIds&&(h.layers=this.props.interactiveLayerIds);try{return s.queryRenderedFeatures(g?[[c[0]-g,c[1]+g],[c[0]+g,c[1]-g]]:c,h)}catch{return null}}function fu(c,s){var h=this.props[c];h&&h(kg.call(this,s))}function nE(c){fu.call(this,c.pointerType==="touch"?"onTouchStart":"onMouseDown",c)}function rE(c){fu.call(this,c.pointerType==="touch"?"onTouchEnd":"onMouseUp",c)}function iE(c){if(fu.call(this,c.pointerType==="touch"?"onTouchMove":"onMouseMove",c),!this.state.isDragging){var s=this.props,h=s.onHover,g=s.interactiveLayerIds,w;c=kg.call(this,c),(g||h)&&(w=Ex.call(this,c.point));var M=!!(g&&w&&w.length>0),k=M&&!this.state.isHovering,R=!M&&this.state.isHovering;(h||k)&&(c.features=w,h&&h(c)),k&&fu.call(this,"onMouseEnter",c),R&&fu.call(this,"onMouseLeave",c),(k||R)&&this.setState({isHovering:M})}}function gv(c){var s=this.props,h=s.onClick,g=s.onNativeClick,w=s.onDblClick,M=s.doubleClickZoom,k=[],R=w||M;switch(c.type){case"anyclick":k.push(g),R||k.push(h);break;case"click":R&&k.push(h);break}k=k.filter(Boolean),k.length&&(c=kg.call(this,c),c.features=Ex.call(this,c.point),k.forEach(function(o){return o(c)}))}function oE(c){return{getMap:c.current&&c.current.getMap,queryRenderedFeatures:c.current&&c.current.queryRenderedFeatures}}var zg=lt.forwardRef(function(c,s){var h=lt.useContext(_d),g=lt.useMemo(function(){return c.controller||new wx},[]),w=lt.useMemo(function(){return new Jw(null,{touchAction:c.touchAction,recognizerOptions:c.eventRecognizerOptions})},[]),M=lt.useRef(null),k=lt.useRef(null),R=lt.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),o=R.current;o.props=c,o.map=k.current&&k.current.getMap(),o.setState=function(Ze){o.state=uu(uu({},o.state),Ze),M.current.style.cursor=c.getCursor(o.state)};var G=!0,ne,oe,$=function(xt,It,Pt){if(G){ne=[xt,It,Pt];return}var Ot=o.props,Yt=Ot.onViewStateChange,Nt=Ot.onViewportChange;Object.defineProperty(xt,"position",{get:function(){return[0,0,Dp(o.map,xt)]}}),Yt&&Yt({viewState:xt,interactionState:It,oldViewState:Pt}),Nt&&Nt(xt,It,Pt)};lt.useImperativeHandle(s,function(){return oE(k)},[]);var de=lt.useMemo(function(){return uu(uu({},h),{},{eventManager:w,container:h.container||M.current})},[h,M.current]);de.onViewportChange=$,de.viewport=h.viewport||_x(o),o.viewport=de.viewport;var H=function(xt){var It=xt.isDragging,Pt=It===void 0?!1:It;if(Pt!==o.state.isDragging&&o.setState({isDragging:Pt}),G){oe=xt;return}var Ot=o.props.onInteractionStateChange;Ot&&Ot(xt)},Te=function(){o.width&&o.height&&g.setOptions(uu(uu(uu({},o.props),o.props.viewState),{},{isInteractive:!!(o.props.onViewStateChange||o.props.onViewportChange),onViewportChange:$,onStateChange:H,eventManager:w,width:o.width,height:o.height}))},Me=function(xt){var It=xt.width,Pt=xt.height;o.width=It,o.height=Pt,Te(),o.props.onResize({width:It,height:Pt})};lt.useEffect(function(){return w.setElement(M.current),w.on({pointerdown:nE.bind(o),pointermove:iE.bind(o),pointerup:rE.bind(o),pointerleave:fu.bind(o,"onMouseOut"),click:gv.bind(o),anyclick:gv.bind(o),dblclick:fu.bind(o,"onDblClick"),wheel:fu.bind(o,"onWheel"),contextmenu:fu.bind(o,"onContextMenu")}),function(){w.destroy()}},[]),lg(function(){ne&&$.apply(void 0,A1(ne)),oe&&H(oe)}),Te();var je=c.width,He=c.height,Ve=c.style,Xe=c.getCursor,$e=lt.useMemo(function(){return uu(uu({position:"relative"},Ve),{},{width:je,height:He,cursor:Xe(o.state)})},[Ve,je,He,Xe,o.state]);return(!ne||!o._child)&&(o._child=lt.createElement(Mg,{value:de},lt.createElement("div",{key:"event-canvas",ref:M,style:$e},lt.createElement(cc,vp({},c,{width:"100%",height:"100%",style:null,onResize:Me,ref:k}))))),G=!1,o._child});zg.supported=cc.supported;zg.propTypes=Qw;zg.defaultProps=tE;Oe.string.isRequired,Oe.string;var sE=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade","sky"];Oe.oneOf(sE).isRequired,Oe.string,Oe.string,Oe.string;var hc={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},Va={captureScroll:Oe.bool,captureDrag:Oe.bool,captureClick:Oe.bool,captureDoubleClick:Oe.bool,capturePointerMove:Oe.bool};function aE(c){var s=c.containerRef.current,h=c.context.eventManager;if(!(!s||!h)){var g={wheel:function(M){var k=c.props;k.captureScroll&&M.stopPropagation(),k.onScroll&&k.onScroll(M,c)},panstart:function(M){var k=c.props;k.captureDrag&&M.stopPropagation(),k.onDragStart&&k.onDragStart(M,c)},anyclick:function(M){var k=c.props;k.captureClick&&M.stopPropagation(),k.onNativeClick&&k.onNativeClick(M,c)},click:function(M){var k=c.props;k.captureClick&&M.stopPropagation(),k.onClick&&k.onClick(M,c)},dblclick:function(M){var k=c.props;k.captureDoubleClick&&M.stopPropagation(),k.onDoubleClick&&k.onDoubleClick(M,c)},pointermove:function(M){var k=c.props;k.capturePointerMove&&M.stopPropagation(),k.onPointerMove&&k.onPointerMove(M,c)}};return h.watch(g,s),function(){h.off(g)}}}function dc(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=lt.useContext(_d),h=lt.useRef(null),g=lt.useRef({props:c,state:{},context:s,containerRef:h}),w=g.current;return w.props=c,w.context=s,lt.useEffect(function(){return aE(w)},[s.eventManager]),w}function lE(c){var s=uE();return function(){var g=ac(c),w;if(s){var M=ac(this).constructor;w=Reflect.construct(g,arguments,M)}else w=g.apply(this,arguments);return Pg(this,w)}}function uE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function cE(c){var s=c.instance,h=dc(c),g=h.context,w=h.containerRef;return s._context=g,s._containerRef=w,s._render()}var Tx=function(c){Cg(h,c);var s=lE(h);function h(){var g;lc(this,h);for(var w=arguments.length,M=new Array(w),k=0;k<w;k++)M[k]=arguments[k];return g=s.call.apply(s,[this].concat(M)),fn(cu(g),"_context",{}),fn(cu(g),"_containerRef",lt.createRef()),fn(cu(g),"_onScroll",function(R){}),fn(cu(g),"_onDragStart",function(R){}),fn(cu(g),"_onDblClick",function(R){}),fn(cu(g),"_onClick",function(R){}),fn(cu(g),"_onPointerMove",function(R){}),g}return uc(h,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return lt.createElement(cE,vp({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),h}(lt.PureComponent);fn(Tx,"propTypes",Va);fn(Tx,"defaultProps",hc);function _v(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function yv(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?_v(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):_v(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}var hE=Object.assign({},Va,{draggable:Oe.bool,onDrag:Oe.func,onDragEnd:Oe.func,onDragStart:Oe.func,offsetLeft:Oe.number,offsetTop:Oe.number}),dE=Object.assign({},hc,{draggable:!1,offsetLeft:0,offsetTop:0});function Sx(c){var s=c.offsetCenter,h=s.x,g=s.y;return[h,g]}function fE(c,s){var h=c.center,g=h.x,w=h.y;if(s){var M=s.getBoundingClientRect();return[M.left-g,M.top-w]}return null}function Dg(c,s,h,g){var w=c[0]+s[0]-h.offsetLeft,M=c[1]+s[1]-h.offsetTop;return g.viewport.unproject([w,M])}function pE(c,s){var h=s.props,g=s.callbacks,w=s.state,M=s.context,k=s.containerRef,R=h.draggable;if(R){c.stopPropagation();var o=Sx(c),G=fE(c,k.current);if(w.setDragPos(o),w.setDragOffset(G),g.onDragStart&&G){var ne=Object.assign({},c);ne.lngLat=Dg(o,G,h,M),g.onDragStart(ne)}}}function mE(c,s){var h=s.props,g=s.callbacks,w=s.state,M=s.context;c.stopPropagation();var k=Sx(c);w.setDragPos(k);var R=w.dragOffset;if(g.onDrag&&R){var o=Object.assign({},c);o.lngLat=Dg(k,R,h,M),g.onDrag(o)}}function gE(c,s){var h=s.props,g=s.callbacks,w=s.state,M=s.context;c.stopPropagation();var k=w.dragPos,R=w.dragOffset;if(w.setDragPos(null),w.setDragOffset(null),g.onDragEnd&&k&&R){var o=Object.assign({},c);o.lngLat=Dg(k,R,h,M),g.onDragEnd(o)}}function _E(c,s){var h=s.state;c.stopPropagation(),h.setDragPos(null),h.setDragOffset(null)}function yE(c){var s=c.context.eventManager;if(!(!s||!c.state.dragPos)){var h={panmove:function(w){return mE(w,c)},panend:function(w){return gE(w,c)},pancancel:function(w){return _E(w,c)}};return s.watch(h),function(){s.off(h)}}}function vE(c){var s=lt.useState(null),h=_i(s,2),g=h[0],w=h[1],M=lt.useState(null),k=_i(M,2),R=k[0],o=k[1],G=dc(yv(yv({},c),{},{onDragStart:pE}));return G.callbacks=c,G.state.dragPos=g,G.state.setDragPos=w,G.state.dragOffset=R,G.state.setDragOffset=o,lt.useEffect(function(){return yE(G)},[G.context.eventManager,!!g]),G}var vv=typeof window<"u"&&window.devicePixelRatio||1,mf=function(s){return Math.round(s*vv)/vv},xv=function(s,h){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(s===null)return h;var w=g==="x"?s.offsetWidth:s.offsetHeight;return mf(h/100*w)/w*100};function bv(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function xE(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?bv(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):bv(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}var bE=Object.assign({},hE,{className:Oe.string,longitude:Oe.number.isRequired,latitude:Oe.number.isRequired,style:Oe.object}),wE=Object.assign({},dE,{className:""});function EE(c){var s=c.props,h=c.state,g=c.context,w=s.longitude,M=s.latitude,k=s.offsetLeft,R=s.offsetTop,o=h.dragPos,G=h.dragOffset,ne=g.viewport,oe=g.map;if(o&&G)return[o[0]+G[0],o[1]+G[1]];var $=Dp(oe,{longitude:w,latitude:M}),de=ne.project([w,M,$]),H=_i(de,2),Te=H[0],Me=H[1];return Te+=k,Me+=R,[Te,Me]}function Lg(c){var s=vE(c),h=s.state,g=s.containerRef,w=c.children,M=c.className,k=c.draggable,R=c.style,o=h.dragPos,G=EE(s),ne=_i(G,2),oe=ne[0],$=ne[1],de="translate(".concat(mf(oe),"px, ").concat(mf($),"px)"),H=k?o?"grabbing":"grab":"auto",Te=lt.useMemo(function(){var je=xE({position:"absolute",left:0,top:0,transform:de,cursor:H},R);return lt.createElement("div",{className:"mapboxgl-marker ".concat(M),ref:s.containerRef,style:je},w)},[w,M]),Me=g.current;return Me&&(Me.style.transform=de,Me.style.cursor=H),Te}Lg.defaultProps=wE;Lg.propTypes=bE;lt.memo(Lg);var gf={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},TE=Object.keys(gf);function SE(c){var s=c.x,h=c.y,g=c.width,w=c.height,M=c.selfWidth,k=c.selfHeight,R=c.anchor,o=c.padding,G=o===void 0?0:o,ne=gf[R],oe=ne.x,$=ne.y,de=h-$*k,H=de+k,Te=Math.max(0,G-de)+Math.max(0,H-w+G);if(Te>0){var Me=$,je=Te;for($=0;$<=1;$+=.5)de=h-$*k,H=de+k,Te=Math.max(0,G-de)+Math.max(0,H-w+G),Te<je&&(je=Te,Me=$);$=Me}var He=.5;$===.5&&(oe=Math.floor(oe),He=1);var Ve=s-oe*M,Xe=Ve+M,$e=Math.max(0,G-Ve)+Math.max(0,Xe-g+G);if($e>0){var Ze=oe,xt=$e;for(oe=0;oe<=1;oe+=He)Ve=s-oe*M,Xe=Ve+M,$e=Math.max(0,G-Ve)+Math.max(0,Xe-g+G),$e<xt&&(xt=$e,Ze=oe);oe=Ze}return TE.find(function(It){var Pt=gf[It];return Pt.x===oe&&Pt.y===$})||R}var ME=Object.assign({},Va,{className:Oe.string,longitude:Oe.number.isRequired,latitude:Oe.number.isRequired,altitude:Oe.number,offsetLeft:Oe.number,offsetTop:Oe.number,tipSize:Oe.number,closeButton:Oe.bool,closeOnClick:Oe.bool,anchor:Oe.oneOf(Object.keys(gf)),dynamicPosition:Oe.bool,sortByDepth:Oe.bool,onClose:Oe.func}),CE=Object.assign({},hc,{className:"",offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function PE(c,s,h,g){var w=_i(g,2),M=w[0],k=w[1],R=c.anchor,o=c.dynamicPosition,G=c.tipSize;return h&&o?SE({x:M,y:k,anchor:R,padding:G,width:s.width,height:s.height,selfWidth:h.clientWidth,selfHeight:h.clientHeight}):R}function IE(c,s,h,g,w){var M=_i(g,3),k=M[0],R=M[1],o=M[2],G=c.offsetLeft,ne=c.offsetTop,oe=c.sortByDepth,$=gf[w],de=k+G,H=R+ne,Te=xv(h,-$.x*100),Me=xv(h,-$.y*100,"y"),je={position:"absolute",transform:`
      translate(`.concat(Te,"%, ").concat(Me,`%)
      translate(`).concat(mf(de),"px, ").concat(mf(H),`px)
    `),display:void 0,zIndex:void 0};return oe&&(o>1||o<-1||k<0||k>s.width||R<0||R>s.height?je.display="none":je.zIndex=Math.floor((1-o)/2*1e5)),je}function Rg(c){var s=lt.useRef(null),h=dc(c),g=h.context,w=h.containerRef,M=lt.useState(!1),k=_i(M,2),R=k[1];lt.useEffect(function(){R(!0)},[s.current]),lt.useEffect(function(){if(g.eventManager&&c.closeOnClick){var $e=function(){return h.props.onClose()};return g.eventManager.on("anyclick",$e),function(){g.eventManager.off("anyclick",$e)}}},[g.eventManager,c.closeOnClick]);var o=g.viewport,G=g.map,ne=c.className,oe=c.longitude,$=c.latitude,de=c.tipSize,H=c.closeButton,Te=c.children,Me=c.altitude;Me===void 0&&(Me=Dp(G,{longitude:oe,latitude:$}));var je=o.project([oe,$,Me]),He=PE(c,o,s.current,je),Ve=IE(c,o,w.current,je,He),Xe=lt.useCallback(function($e){h.props.onClose();var Ze=h.context.eventManager;Ze&&Ze.once("click",function(xt){return xt.stopPropagation()},$e.target)},[]);return lt.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(He," ").concat(ne),style:Ve,ref:w},lt.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:de}}),lt.createElement("div",{key:"content",ref:s,className:"mapboxgl-popup-content"},H&&lt.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:Xe},""),Te))}Rg.propTypes=ME;Rg.defaultProps=CE;lt.memo(Rg);function wv(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function AE(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?wv(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):wv(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}var kE=Object.assign({},Va,{toggleLabel:Oe.string,className:Oe.string,style:Oe.object,compact:Oe.bool,customAttribution:Oe.oneOfType([Oe.string,Oe.arrayOf(Oe.string)])}),zE=Object.assign({},hc,{className:"",toggleLabel:"Toggle Attribution"});function DE(c,s,h,g){var w=new wl.AttributionControl(c);return w._map=s,w._container=h,w._innerContainer=g,w._updateAttributions(),w._updateEditLink(),s.on("styledata",w._updateData),s.on("sourcedata",w._updateData),w}function LE(c){c._map.off("styledata",c._updateData),c._map.off("sourcedata",c._updateData)}function Og(c){var s=dc(c),h=s.context,g=s.containerRef,w=lt.useRef(null),M=lt.useState(!1),k=_i(M,2),R=k[0],o=k[1];lt.useEffect(function(){var $;return h.map&&($=DE({customAttribution:c.customAttribution},h.map,g.current,w.current)),function(){return $&&LE($)}},[h.map]);var G=c.compact===void 0?h.viewport.width<=640:c.compact;lt.useEffect(function(){!G&&R&&o(!1)},[G]);var ne=lt.useCallback(function(){return o(function($){return!$})},[]),oe=lt.useMemo(function(){return AE({position:"absolute"},c.style)},[c.style]);return lt.createElement("div",{style:oe,className:c.className},lt.createElement("div",{ref:g,"aria-pressed":R,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(G?"mapboxgl-compact":""," ").concat(R?"mapboxgl-compact-show":"")},lt.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:c.toggleLabel,onClick:ne}),lt.createElement("div",{ref:w,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}Og.propTypes=kE;Og.defaultProps=zE;lt.memo(Og);function Ev(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function RE(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?Ev(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):Ev(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}var OE=Object.assign({},Va,{className:Oe.string,style:Oe.object,container:Oe.object,label:Oe.string}),BE=Object.assign({},hc,{className:"",container:null,label:"Toggle fullscreen"});function Bg(c){var s=dc(c),h=s.context,g=s.containerRef,w=lt.useState(!1),M=_i(w,2),k=M[0],R=M[1],o=lt.useState(!1),G=_i(o,2),ne=G[0],oe=G[1],$=lt.useState(null),de=_i($,2),H=de[0],Te=de[1];lt.useEffect(function(){var $e=new wl.FullscreenControl;Te($e),oe($e._checkFullscreenSupport());var Ze=function(){var It=!$e._fullscreen;$e._fullscreen=It,R(It)};return du.addEventListener($e._fullscreenchange,Ze),function(){du.removeEventListener($e._fullscreenchange,Ze)}},[]);var Me=function(){H&&(H._container=c.container||h.container,H._onClickFullscreen())},je=lt.useMemo(function(){return RE({position:"absolute"},c.style)},[c.style]);if(!ne)return null;var He=c.className,Ve=c.label,Xe=k?"shrink":"fullscreen";return lt.createElement("div",{style:je,className:He},lt.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:g},lt.createElement("button",{key:Xe,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(Xe),type:"button",title:Ve,onClick:Me},lt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}Bg.propTypes=OE;Bg.defaultProps=BE;lt.memo(Bg);var Qh;function FE(){return Qh!==void 0?Promise.resolve(Qh):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(c){return Qh=c.state!=="denied",Qh}):(Qh=!!window.navigator.geolocation,Promise.resolve(Qh))}function Tv(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function NE(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?Tv(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):Tv(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}var Sv=function(){},UE=Object.assign({},Va,{className:Oe.string,style:Oe.object,label:Oe.string,disabledLabel:Oe.string,auto:Oe.bool,positionOptions:Oe.object,fitBoundsOptions:Oe.object,trackUserLocation:Oe.bool,showUserLocation:Oe.bool,showAccuracyCircle:Oe.bool,showUserHeading:Oe.bool,onViewStateChange:Oe.func,onViewportChange:Oe.func,onGeolocate:Oe.func}),jE=Object.assign({},hc,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function VE(c){var s=new wl.LngLat(c.coords.longitude,c.coords.latitude),h=c.coords.accuracy,g=s.toBounds(h);return[[g._ne.lng,g._ne.lat],[g._sw.lng,g._sw.lat]]}function $E(c,s,h){var g=new wl.GeolocateControl(s);g._container=du.createElement("div"),g._map={on:function(){},_getUIString:function(){return""}},g._setupUI(!0),g._map=c.map,g._geolocateButton=h;var w=c.eventManager;return g.options.trackUserLocation&&w&&w.on("panstart",function(){g._watchState==="ACTIVE_LOCK"&&(g._watchState="BACKGROUND",h.classList.add("mapboxgl-ctrl-geolocate-background"),h.classList.remove("mapboxgl-ctrl-geolocate-active"))}),g.on("geolocate",s.onGeolocate),g}function ZE(c,s){var h=s.context,g=s.props,w=VE(c),M=h.viewport.fitBounds(w,g.fitBoundsOptions),k=M.longitude,R=M.latitude,o=M.zoom,G=Object.assign({},h.viewport,{longitude:k,latitude:R,zoom:o}),ne=new ld(G),oe=Object.assign({},ne.getViewportProps(),hu),$=g.onViewportChange||h.onViewportChange||Sv,de=g.onViewStateChange||h.onViewStateChange||Sv;de({viewState:oe}),$(oe)}function Fg(c){var s=dc(c),h=s.context,g=s.containerRef,w=lt.useRef(null),M=lt.useState(null),k=_i(M,2),R=k[0],o=k[1],G=lt.useState(!1),ne=_i(G,2),oe=ne[0],$=ne[1];lt.useEffect(function(){var Ve;return h.map&&FE().then(function(Xe){$(Xe),w.current&&(Ve=$E(h,c,w.current),Ve._updateCamera=function($e){return ZE($e,s)},o(Ve))}),function(){Ve&&Ve._clearWatch()}},[h.map]);var de=lt.useCallback(function(){R&&(R.options=s.props,R.trigger())},[R]);lt.useEffect(function(){c.auto&&de()},[R,c.auto]),lt.useEffect(function(){R&&R._onZoom()},[h.viewport.zoom]);var H=c.className,Te=c.label,Me=c.disabledLabel,je=c.trackUserLocation,He=lt.useMemo(function(){return NE({position:"absolute"},c.style)},[c.style]);return lt.createElement("div",{style:He,className:H},lt.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:g},lt.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:w,disabled:!oe,"aria-pressed":!je,type:"button",title:oe?Te:Me,"aria-label":oe?Te:Me,onClick:de},lt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}Fg.propTypes=UE;Fg.defaultProps=jE;lt.memo(Fg);function GE(c,s){for(var h=(c||"").split(".").map(Number),g=s.split(".").map(Number),w=0;w<3;w++){var M=h[w]||0,k=g[w]||0;if(M<k)return-1;if(M>k)return 1}return 0}function Mv(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function qE(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?Mv(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):Mv(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}var Cv=function(){},WE=Object.assign({},Va,{className:Oe.string,style:Oe.object,onViewStateChange:Oe.func,onViewportChange:Oe.func,showCompass:Oe.bool,showZoom:Oe.bool,zoomInLabel:Oe.string,zoomOutLabel:Oe.string,compassLabel:Oe.string}),XE=Object.assign({},hc,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),HE=1,mg=2;function YE(c){return GE(c,"1.6.0")>=0?mg:HE}function Zm(c,s,h){var g=c.viewport,w=new ld(Object.assign({},g,h)),M=Object.assign({},w.getViewportProps(),hu),k=s.onViewportChange||c.onViewportChange||Cv,R=s.onViewStateChange||c.onViewStateChange||Cv;R({viewState:M}),k(M)}function Gm(c,s,h,g){return lt.createElement("button",{key:c,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(c),type:"button",title:s,onClick:h},g||lt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function KE(c){var s=lt.useMemo(function(){return c.map?YE(c.map.version):mg},[c.map]),h=c.viewport.bearing,g={transform:"rotate(".concat(-h,"deg)")};return s===mg?lt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:g}):lt.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:g})}function Ng(c){var s=dc(c),h=s.context,g=s.containerRef,w=function(){Zm(h,c,{zoom:h.viewport.zoom+1})},M=function(){Zm(h,c,{zoom:h.viewport.zoom-1})},k=function(){Zm(h,c,{bearing:0,pitch:0})},R=c.className,o=c.showCompass,G=c.showZoom,ne=c.zoomInLabel,oe=c.zoomOutLabel,$=c.compassLabel,de=lt.useMemo(function(){return qE({position:"absolute"},c.style)},[c.style]);return lt.createElement("div",{style:de,className:R},lt.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:g},G&&Gm("zoom-in",ne,w),G&&Gm("zoom-out",oe,M),o&&Gm("compass",$,k,KE(h))))}Ng.propTypes=WE;Ng.defaultProps=XE;lt.memo(Ng);function Pv(c,s){var h=Object.keys(c);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(c);s&&(g=g.filter(function(w){return Object.getOwnPropertyDescriptor(c,w).enumerable})),h.push.apply(h,g)}return h}function JE(c){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?Pv(Object(h),!0).forEach(function(g){fn(c,g,h[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(h)):Pv(Object(h)).forEach(function(g){Object.defineProperty(c,g,Object.getOwnPropertyDescriptor(h,g))})}return c}var QE=Object.assign({},Va,{className:Oe.string,style:Oe.object,maxWidth:Oe.number,unit:Oe.oneOf(["imperial","metric","nautical"])}),eT=Object.assign({},hc,{className:"",maxWidth:100,unit:"metric"});function Ug(c){var s=dc(c),h=s.context,g=s.containerRef,w=lt.useState(null),M=_i(w,2),k=M[0],R=M[1];lt.useEffect(function(){if(h.map){var G=new wl.ScaleControl;G._map=h.map,G._container=g.current,R(G)}},[h.map]),k&&(k.options=c,k._onMove());var o=lt.useMemo(function(){return JE({position:"absolute"},c.style)},[c.style]);return lt.createElement("div",{style:o,className:c.className},lt.createElement("div",{ref:g,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}Ug.propTypes=QE;Ug.defaultProps=eT;lt.memo(Ug);Object.assign({},Va,{redraw:Oe.func.isRequired});Object.assign({},Va,{redraw:Oe.func.isRequired,style:Oe.object});Object.assign({},Va,{redraw:Oe.func.isRequired,style:Oe.object});wl&&wl.setRTLTextPlugin;const up=globalThis,ed=globalThis.process||{};function tT(c){var g,w;if(typeof window<"u"&&((g=window.process)==null?void 0:g.type)==="renderer"||typeof process<"u"&&((w=process.versions)!=null&&w.electron))return!0;const h=typeof navigator<"u"&&navigator.userAgent;return!!(h&&h.indexOf("Electron")>=0)}function jg(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||tT()}const Mx="4.1.0";function nT(c){try{const s=window[c],h="__storage_test__";return s.setItem(h,h),s.removeItem(h),s}catch{return null}}class rT{constructor(s,h,g="sessionStorage"){this.storage=nT(g),this.id=s,this.config=h,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(s){if(Object.assign(this.config,s),this.storage){const h=JSON.stringify(this.config);this.storage.setItem(this.id,h)}}_loadConfiguration(){let s={};if(this.storage){const h=this.storage.getItem(this.id);s=h?JSON.parse(h):{}}return Object.assign(this.config,s),this}}function iT(c){let s;return c<10?s=`${c.toFixed(2)}ms`:c<100?s=`${c.toFixed(1)}ms`:c<1e3?s=`${c.toFixed(0)}ms`:s=`${(c/1e3).toFixed(2)}s`,s}function oT(c,s=8){const h=Math.max(s-c.length,0);return`${" ".repeat(h)}${c}`}var Mp;(function(c){c[c.BLACK=30]="BLACK",c[c.RED=31]="RED",c[c.GREEN=32]="GREEN",c[c.YELLOW=33]="YELLOW",c[c.BLUE=34]="BLUE",c[c.MAGENTA=35]="MAGENTA",c[c.CYAN=36]="CYAN",c[c.WHITE=37]="WHITE",c[c.BRIGHT_BLACK=90]="BRIGHT_BLACK",c[c.BRIGHT_RED=91]="BRIGHT_RED",c[c.BRIGHT_GREEN=92]="BRIGHT_GREEN",c[c.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",c[c.BRIGHT_BLUE=94]="BRIGHT_BLUE",c[c.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",c[c.BRIGHT_CYAN=96]="BRIGHT_CYAN",c[c.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Mp||(Mp={}));const sT=10;function Iv(c){return typeof c!="string"?c:(c=c.toUpperCase(),Mp[c]||Mp.WHITE)}function aT(c,s,h){return!jg&&typeof c=="string"&&(s&&(c=`\x1B[${Iv(s)}m${c}\x1B[39m`),h&&(c=`\x1B[${Iv(h)+sT}m${c}\x1B[49m`)),c}function lT(c,s=["constructor"]){const h=Object.getPrototypeOf(c),g=Object.getOwnPropertyNames(h),w=c;for(const M of g){const k=w[M];typeof k=="function"&&(s.find(R=>M===R)||(w[M]=k.bind(c)))}}function Vg(c,s){if(!c)throw new Error("Assertion failed")}function td(){var s,h,g;let c;if(jg()&&up.performance)c=(h=(s=up==null?void 0:up.performance)==null?void 0:s.now)==null?void 0:h.call(s);else if("hrtime"in ed){const w=(g=ed==null?void 0:ed.hrtime)==null?void 0:g.call(ed);c=w[0]*1e3+w[1]/1e6}else c=Date.now();return c}const nd={debug:jg()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},uT={enabled:!0,level:0};function rd(){}const Av={},kv={once:!0};class Cx{constructor({id:s}={id:""}){this.VERSION=Mx,this._startTs=td(),this._deltaTs=td(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=s,this.userData={},this._storage=new rT(`__probe-${this.id}__`,uT),this.timeStamp(`${this.id} started`),lT(this),Object.seal(this)}set level(s){this.setLevel(s)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((td()-this._startTs).toPrecision(10))}getDelta(){return Number((td()-this._deltaTs).toPrecision(10))}set priority(s){this.level=s}get priority(){return this.level}getPriority(){return this.level}enable(s=!0){return this._storage.setConfiguration({enabled:s}),this}setLevel(s){return this._storage.setConfiguration({level:s}),this}get(s){return this._storage.config[s]}set(s,h){this._storage.setConfiguration({[s]:h})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(s,h){if(!s)throw new Error(h||"Assertion failed")}warn(s){return this._getLogFunction(0,s,nd.warn,arguments,kv)}error(s){return this._getLogFunction(0,s,nd.error,arguments)}deprecated(s,h){return this.warn(`\`${s}\` is deprecated and will be removed in a later version. Use \`${h}\` instead`)}removed(s,h){return this.error(`\`${s}\` has been removed. Use \`${h}\` instead`)}probe(s,h){return this._getLogFunction(s,h,nd.log,arguments,{time:!0,once:!0})}log(s,h){return this._getLogFunction(s,h,nd.debug,arguments)}info(s,h){return this._getLogFunction(s,h,console.info,arguments)}once(s,h){return this._getLogFunction(s,h,nd.debug||nd.info,arguments,kv)}table(s,h,g){return h?this._getLogFunction(s,h,console.table||rd,g&&[g],{tag:hT(h)}):rd}time(s,h){return this._getLogFunction(s,h,console.time?console.time:console.info)}timeEnd(s,h){return this._getLogFunction(s,h,console.timeEnd?console.timeEnd:console.info)}timeStamp(s,h){return this._getLogFunction(s,h,console.timeStamp||rd)}group(s,h,g={collapsed:!1}){const w=zv({logLevel:s,message:h,opts:g}),{collapsed:M}=g;return w.method=(M?console.groupCollapsed:console.group)||console.info,this._getLogFunction(w)}groupCollapsed(s,h,g={}){return this.group(s,h,Object.assign({},g,{collapsed:!0}))}groupEnd(s){return this._getLogFunction(s,"",console.groupEnd||rd)}withGroup(s,h,g){this.group(s,h)();try{g()}finally{this.groupEnd(s)()}}trace(){console.trace&&console.trace()}_shouldLog(s){return this.isEnabled()&&this.getLevel()>=Px(s)}_getLogFunction(s,h,g,w,M){if(this._shouldLog(s)){M=zv({logLevel:s,message:h,args:w,opts:M}),g=g||M.method,Vg(g),M.total=this.getTotal(),M.delta=this.getDelta(),this._deltaTs=td();const k=M.tag||M.message;if(M.once&&k)if(!Av[k])Av[k]=td();else return rd;return h=cT(this.id,M.message,M),g.bind(console,h,...M.args)}return rd}}Cx.VERSION=Mx;function Px(c){if(!c)return 0;let s;switch(typeof c){case"number":s=c;break;case"object":s=c.logLevel||c.priority||0;break;default:return 0}return Vg(Number.isFinite(s)&&s>=0),s}function zv(c){const{logLevel:s,message:h}=c;c.logLevel=Px(s);const g=c.args?Array.from(c.args):[];for(;g.length&&g.shift()!==h;);switch(typeof s){case"string":case"function":h!==void 0&&g.unshift(h),c.message=s;break;case"object":Object.assign(c,s);break}typeof c.message=="function"&&(c.message=c.message());const w=typeof c.message;return Vg(w==="string"||w==="object"),Object.assign(c,{args:g},c.opts)}function cT(c,s,h){if(typeof s=="string"){const g=h.time?oT(iT(h.total)):"";s=h.time?`${c}: ${g}  ${s}`:`${c}: ${s}`,s=aT(s,h.color,h.background)}return s}function hT(c){for(const s in c)for(const h in c[s])return h||"untitled";return"empty"}const dT=new Cx({id:"deck"}),fT={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...fT}};const ta=globalThis.mathgl.config;function pT(c,{precision:s=ta.precision}={}){return c=mT(c),`${parseFloat(c.toPrecision(s))}`}function dd(c){return Array.isArray(c)||ArrayBuffer.isView(c)&&!(c instanceof DataView)}function ic(c,s,h){return _T(c,g=>Math.max(s,Math.min(h,g)))}function gg(c,s,h){return dd(c)?c.map((g,w)=>gg(g,s[w],h)):h*s+(1-h)*c}function _f(c,s,h){const g=ta.EPSILON;try{if(c===s)return!0;if(dd(c)&&dd(s)){if(c.length!==s.length)return!1;for(let w=0;w<c.length;++w)if(!_f(c[w],s[w]))return!1;return!0}return c&&c.equals?c.equals(s):s&&s.equals?s.equals(c):typeof c=="number"&&typeof s=="number"?Math.abs(c-s)<=ta.EPSILON*Math.max(1,Math.abs(c),Math.abs(s)):!1}finally{ta.EPSILON=g}}function mT(c){return Math.round(c/ta.EPSILON)*ta.EPSILON}function gT(c){return c.clone?c.clone():new Array(c.length)}function _T(c,s,h){if(dd(c)){const g=c;h=h||gT(g);for(let w=0;w<h.length&&w<g.length;++w){const M=typeof c=="number"?c:c[w];h[w]=s(M,w,h)}return h}return s(c)}class Ix extends Array{clone(){return new this.constructor().copy(this)}fromArray(s,h=0){for(let g=0;g<this.ELEMENTS;++g)this[g]=s[g+h];return this.check()}toArray(s=[],h=0){for(let g=0;g<this.ELEMENTS;++g)s[h+g]=this[g];return s}toObject(s){return s}from(s){return Array.isArray(s)?this.copy(s):this.fromObject(s)}to(s){return s===this?this:dd(s)?this.toArray(s):this.toObject(s)}toTarget(s){return s?this.to(s):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ta)}formatString(s){let h="";for(let g=0;g<this.ELEMENTS;++g)h+=(g>0?", ":"")+pT(this[g],s);return`${s.printTypes?this.constructor.name:""}[${h}]`}equals(s){if(!s||this.length!==s.length)return!1;for(let h=0;h<this.ELEMENTS;++h)if(!_f(this[h],s[h]))return!1;return!0}exactEquals(s){if(!s||this.length!==s.length)return!1;for(let h=0;h<this.ELEMENTS;++h)if(this[h]!==s[h])return!1;return!0}negate(){for(let s=0;s<this.ELEMENTS;++s)this[s]=-this[s];return this.check()}lerp(s,h,g){if(g===void 0)return this.lerp(this,s,h);for(let w=0;w<this.ELEMENTS;++w){const M=s[w],k=typeof h=="number"?h:h[w];this[w]=M+g*(k-M)}return this.check()}min(s){for(let h=0;h<this.ELEMENTS;++h)this[h]=Math.min(s[h],this[h]);return this.check()}max(s){for(let h=0;h<this.ELEMENTS;++h)this[h]=Math.max(s[h],this[h]);return this.check()}clamp(s,h){for(let g=0;g<this.ELEMENTS;++g)this[g]=Math.min(Math.max(this[g],s[g]),h[g]);return this.check()}add(...s){for(const h of s)for(let g=0;g<this.ELEMENTS;++g)this[g]+=h[g];return this.check()}subtract(...s){for(const h of s)for(let g=0;g<this.ELEMENTS;++g)this[g]-=h[g];return this.check()}scale(s){if(typeof s=="number")for(let h=0;h<this.ELEMENTS;++h)this[h]*=s;else for(let h=0;h<this.ELEMENTS&&h<s.length;++h)this[h]*=s[h];return this.check()}multiplyByScalar(s){for(let h=0;h<this.ELEMENTS;++h)this[h]*=s;return this.check()}check(){if(ta.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let s=this.length===this.ELEMENTS;for(let h=0;h<this.ELEMENTS;++h)s=s&&Number.isFinite(this[h]);return s}sub(s){return this.subtract(s)}setScalar(s){for(let h=0;h<this.ELEMENTS;++h)this[h]=s;return this.check()}addScalar(s){for(let h=0;h<this.ELEMENTS;++h)this[h]+=s;return this.check()}subScalar(s){return this.addScalar(-s)}multiplyScalar(s){for(let h=0;h<this.ELEMENTS;++h)this[h]*=s;return this.check()}divideScalar(s){return this.multiplyByScalar(1/s)}clampScalar(s,h){for(let g=0;g<this.ELEMENTS;++g)this[g]=Math.min(Math.max(this[g],s),h);return this.check()}get elements(){return this}}function yT(c,s){if(c.length!==s)return!1;for(let h=0;h<c.length;++h)if(!Number.isFinite(c[h]))return!1;return!0}function As(c){if(!Number.isFinite(c))throw new Error(`Invalid number ${JSON.stringify(c)}`);return c}function qm(c,s,h=""){if(ta.debug&&!yT(c,s))throw new Error(`math.gl: ${h} some fields set to invalid numbers'`);return c}function Dv(c,s){if(!c)throw new Error(`math.gl assertion ${s}`)}class vT extends Ix{get x(){return this[0]}set x(s){this[0]=As(s)}get y(){return this[1]}set y(s){this[1]=As(s)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let s=0;for(let h=0;h<this.ELEMENTS;++h)s+=this[h]*this[h];return s}magnitudeSquared(){return this.lengthSquared()}distance(s){return Math.sqrt(this.distanceSquared(s))}distanceSquared(s){let h=0;for(let g=0;g<this.ELEMENTS;++g){const w=this[g]-s[g];h+=w*w}return As(h)}dot(s){let h=0;for(let g=0;g<this.ELEMENTS;++g)h+=this[g]*s[g];return As(h)}normalize(){const s=this.magnitude();if(s!==0)for(let h=0;h<this.ELEMENTS;++h)this[h]/=s;return this.check()}multiply(...s){for(const h of s)for(let g=0;g<this.ELEMENTS;++g)this[g]*=h[g];return this.check()}divide(...s){for(const h of s)for(let g=0;g<this.ELEMENTS;++g)this[g]/=h[g];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(s){return this.distance(s)}distanceToSquared(s){return this.distanceSquared(s)}getComponent(s){return Dv(s>=0&&s<this.ELEMENTS,"index is out of range"),As(this[s])}setComponent(s,h){return Dv(s>=0&&s<this.ELEMENTS,"index is out of range"),this[s]=h,this.check()}addVectors(s,h){return this.copy(s).add(h)}subVectors(s,h){return this.copy(s).subtract(h)}multiplyVectors(s,h){return this.copy(s).multiply(h)}addScaledVector(s,h){return this.add(new this.constructor(s).multiplyScalar(h))}}const _p=1e-6;let fd=typeof Float32Array<"u"?Float32Array:Array;function xT(){const c=new fd(2);return fd!=Float32Array&&(c[0]=0,c[1]=0),c}function Lv(c,s,h){return c[0]=s[0]+h[0],c[1]=s[1]+h[1],c}function bT(c,s){return c[0]=-s[0],c[1]=-s[1],c}function Ax(c,s,h,g){const w=s[0],M=s[1];return c[0]=w+g*(h[0]-w),c[1]=M+g*(h[1]-M),c}function wT(c,s,h){const g=s[0],w=s[1];return c[0]=h[0]*g+h[4]*w+h[12],c[1]=h[1]*g+h[5]*w+h[13],c}(function(){const c=xT();return function(s,h,g,w,M,k){let R,o;for(h||(h=2),g||(g=0),w?o=Math.min(w*h+g,s.length):o=s.length,R=g;R<o;R+=h)c[0]=s[R],c[1]=s[R+1],M(c,c,k),s[R]=c[0],s[R+1]=c[1];return s}})();function ET(c,s,h){const g=s[0],w=s[1],M=h[3]*g+h[7]*w||1;return c[0]=(h[0]*g+h[4]*w)/M,c[1]=(h[1]*g+h[5]*w)/M,c}function kx(c,s,h){const g=s[0],w=s[1],M=s[2],k=h[3]*g+h[7]*w+h[11]*M||1;return c[0]=(h[0]*g+h[4]*w+h[8]*M)/k,c[1]=(h[1]*g+h[5]*w+h[9]*M)/k,c[2]=(h[2]*g+h[6]*w+h[10]*M)/k,c}function TT(c,s,h){const g=s[0],w=s[1];return c[0]=h[0]*g+h[2]*w,c[1]=h[1]*g+h[3]*w,c[2]=s[2],c}function ST(){const c=new fd(3);return fd!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function MT(c,s){return c[0]=-s[0],c[1]=-s[1],c[2]=-s[2],c}function CT(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]}function PT(c,s,h){const g=s[0],w=s[1],M=s[2],k=h[0],R=h[1],o=h[2];return c[0]=w*o-M*R,c[1]=M*k-g*o,c[2]=g*R-w*k,c}function zx(c,s,h){const g=s[0],w=s[1],M=s[2];let k=h[3]*g+h[7]*w+h[11]*M+h[15];return k=k||1,c[0]=(h[0]*g+h[4]*w+h[8]*M+h[12])/k,c[1]=(h[1]*g+h[5]*w+h[9]*M+h[13])/k,c[2]=(h[2]*g+h[6]*w+h[10]*M+h[14])/k,c}function IT(c,s,h){const g=s[0],w=s[1],M=s[2];return c[0]=g*h[0]+w*h[3]+M*h[6],c[1]=g*h[1]+w*h[4]+M*h[7],c[2]=g*h[2]+w*h[5]+M*h[8],c}function AT(c,s,h){const g=h[0],w=h[1],M=h[2],k=h[3],R=s[0],o=s[1],G=s[2];let ne=w*G-M*o,oe=M*R-g*G,$=g*o-w*R,de=w*$-M*oe,H=M*ne-g*$,Te=g*oe-w*ne;const Me=k*2;return ne*=Me,oe*=Me,$*=Me,de*=2,H*=2,Te*=2,c[0]=R+ne+de,c[1]=o+oe+H,c[2]=G+$+Te,c}function kT(c,s,h,g){const w=[],M=[];return w[0]=s[0]-h[0],w[1]=s[1]-h[1],w[2]=s[2]-h[2],M[0]=w[0],M[1]=w[1]*Math.cos(g)-w[2]*Math.sin(g),M[2]=w[1]*Math.sin(g)+w[2]*Math.cos(g),c[0]=M[0]+h[0],c[1]=M[1]+h[1],c[2]=M[2]+h[2],c}function zT(c,s,h,g){const w=[],M=[];return w[0]=s[0]-h[0],w[1]=s[1]-h[1],w[2]=s[2]-h[2],M[0]=w[2]*Math.sin(g)+w[0]*Math.cos(g),M[1]=w[1],M[2]=w[2]*Math.cos(g)-w[0]*Math.sin(g),c[0]=M[0]+h[0],c[1]=M[1]+h[1],c[2]=M[2]+h[2],c}function DT(c,s,h,g){const w=[],M=[];return w[0]=s[0]-h[0],w[1]=s[1]-h[1],w[2]=s[2]-h[2],M[0]=w[0]*Math.cos(g)-w[1]*Math.sin(g),M[1]=w[0]*Math.sin(g)+w[1]*Math.cos(g),M[2]=w[2],c[0]=M[0]+h[0],c[1]=M[1]+h[1],c[2]=M[2]+h[2],c}function LT(c,s){const h=c[0],g=c[1],w=c[2],M=s[0],k=s[1],R=s[2],o=Math.sqrt((h*h+g*g+w*w)*(M*M+k*k+R*R)),G=o&&CT(c,s)/o;return Math.acos(Math.min(Math.max(G,-1),1))}(function(){const c=ST();return function(s,h,g,w,M,k){let R,o;for(h||(h=3),g||(g=0),w?o=Math.min(w*h+g,s.length):o=s.length,R=g;R<o;R+=h)c[0]=s[R],c[1]=s[R+1],c[2]=s[R+2],M(c,c,k),s[R]=c[0],s[R+1]=c[1],s[R+2]=c[2];return s}})();const Wm=[0,0,0];let cp;class pd extends vT{static get ZERO(){return cp||(cp=new pd(0,0,0),Object.freeze(cp)),cp}constructor(s=0,h=0,g=0){super(-0,-0,-0),arguments.length===1&&dd(s)?this.copy(s):(ta.debug&&(As(s),As(h),As(g)),this[0]=s,this[1]=h,this[2]=g)}set(s,h,g){return this[0]=s,this[1]=h,this[2]=g,this.check()}copy(s){return this[0]=s[0],this[1]=s[1],this[2]=s[2],this.check()}fromObject(s){return ta.debug&&(As(s.x),As(s.y),As(s.z)),this[0]=s.x,this[1]=s.y,this[2]=s.z,this.check()}toObject(s){return s.x=this[0],s.y=this[1],s.z=this[2],s}get ELEMENTS(){return 3}get z(){return this[2]}set z(s){this[2]=As(s)}angle(s){return LT(this,s)}cross(s){return PT(this,this,s),this.check()}rotateX({radians:s,origin:h=Wm}){return kT(this,this,h,s),this.check()}rotateY({radians:s,origin:h=Wm}){return zT(this,this,h,s),this.check()}rotateZ({radians:s,origin:h=Wm}){return DT(this,this,h,s),this.check()}transform(s){return this.transformAsPoint(s)}transformAsPoint(s){return zx(this,this,s),this.check()}transformAsVector(s){return kx(this,this,s),this.check()}transformByMatrix3(s){return IT(this,this,s),this.check()}transformByMatrix2(s){return TT(this,this,s),this.check()}transformByQuaternion(s){return AT(this,this,s),this.check()}}class RT extends Ix{toString(){let s="[";if(ta.printRowMajor){s+="row-major:";for(let h=0;h<this.RANK;++h)for(let g=0;g<this.RANK;++g)s+=` ${this[g*this.RANK+h]}`}else{s+="column-major:";for(let h=0;h<this.ELEMENTS;++h)s+=` ${this[h]}`}return s+="]",s}getElementIndex(s,h){return h*this.RANK+s}getElement(s,h){return this[h*this.RANK+s]}setElement(s,h,g){return this[h*this.RANK+s]=As(g),this}getColumn(s,h=new Array(this.RANK).fill(-0)){const g=s*this.RANK;for(let w=0;w<this.RANK;++w)h[w]=this[g+w];return h}setColumn(s,h){const g=s*this.RANK;for(let w=0;w<this.RANK;++w)this[g+w]=h[w];return this}}function OT(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function BT(c,s){if(c===s){const h=s[1],g=s[2],w=s[3],M=s[6],k=s[7],R=s[11];c[1]=s[4],c[2]=s[8],c[3]=s[12],c[4]=h,c[6]=s[9],c[7]=s[13],c[8]=g,c[9]=M,c[11]=s[14],c[12]=w,c[13]=k,c[14]=R}else c[0]=s[0],c[1]=s[4],c[2]=s[8],c[3]=s[12],c[4]=s[1],c[5]=s[5],c[6]=s[9],c[7]=s[13],c[8]=s[2],c[9]=s[6],c[10]=s[10],c[11]=s[14],c[12]=s[3],c[13]=s[7],c[14]=s[11],c[15]=s[15];return c}function _g(c,s){const h=s[0],g=s[1],w=s[2],M=s[3],k=s[4],R=s[5],o=s[6],G=s[7],ne=s[8],oe=s[9],$=s[10],de=s[11],H=s[12],Te=s[13],Me=s[14],je=s[15],He=h*R-g*k,Ve=h*o-w*k,Xe=h*G-M*k,$e=g*o-w*R,Ze=g*G-M*R,xt=w*G-M*o,It=ne*Te-oe*H,Pt=ne*Me-$*H,Ot=ne*je-de*H,Yt=oe*Me-$*Te,Nt=oe*je-de*Te,$t=$*je-de*Me;let Et=He*$t-Ve*Nt+Xe*Yt+$e*Ot-Ze*Pt+xt*It;return Et?(Et=1/Et,c[0]=(R*$t-o*Nt+G*Yt)*Et,c[1]=(w*Nt-g*$t-M*Yt)*Et,c[2]=(Te*xt-Me*Ze+je*$e)*Et,c[3]=($*Ze-oe*xt-de*$e)*Et,c[4]=(o*Ot-k*$t-G*Pt)*Et,c[5]=(h*$t-w*Ot+M*Pt)*Et,c[6]=(Me*Xe-H*xt-je*Ve)*Et,c[7]=(ne*xt-$*Xe+de*Ve)*Et,c[8]=(k*Nt-R*Ot+G*It)*Et,c[9]=(g*Ot-h*Nt-M*It)*Et,c[10]=(H*Ze-Te*Xe+je*He)*Et,c[11]=(oe*Xe-ne*Ze-de*He)*Et,c[12]=(R*Pt-k*Yt-o*It)*Et,c[13]=(h*Yt-g*Pt+w*It)*Et,c[14]=(Te*Ve-H*$e-Me*He)*Et,c[15]=(ne*$e-oe*Ve+$*He)*Et,c):null}function FT(c){const s=c[0],h=c[1],g=c[2],w=c[3],M=c[4],k=c[5],R=c[6],o=c[7],G=c[8],ne=c[9],oe=c[10],$=c[11],de=c[12],H=c[13],Te=c[14],Me=c[15],je=s*k-h*M,He=s*R-g*M,Ve=h*R-g*k,Xe=G*H-ne*de,$e=G*Te-oe*de,Ze=ne*Te-oe*H,xt=s*Ze-h*$e+g*Xe,It=M*Ze-k*$e+R*Xe,Pt=G*Ve-ne*He+oe*je,Ot=de*Ve-H*He+Te*je;return o*xt-w*It+Me*Pt-$*Ot}function ff(c,s,h){const g=s[0],w=s[1],M=s[2],k=s[3],R=s[4],o=s[5],G=s[6],ne=s[7],oe=s[8],$=s[9],de=s[10],H=s[11],Te=s[12],Me=s[13],je=s[14],He=s[15];let Ve=h[0],Xe=h[1],$e=h[2],Ze=h[3];return c[0]=Ve*g+Xe*R+$e*oe+Ze*Te,c[1]=Ve*w+Xe*o+$e*$+Ze*Me,c[2]=Ve*M+Xe*G+$e*de+Ze*je,c[3]=Ve*k+Xe*ne+$e*H+Ze*He,Ve=h[4],Xe=h[5],$e=h[6],Ze=h[7],c[4]=Ve*g+Xe*R+$e*oe+Ze*Te,c[5]=Ve*w+Xe*o+$e*$+Ze*Me,c[6]=Ve*M+Xe*G+$e*de+Ze*je,c[7]=Ve*k+Xe*ne+$e*H+Ze*He,Ve=h[8],Xe=h[9],$e=h[10],Ze=h[11],c[8]=Ve*g+Xe*R+$e*oe+Ze*Te,c[9]=Ve*w+Xe*o+$e*$+Ze*Me,c[10]=Ve*M+Xe*G+$e*de+Ze*je,c[11]=Ve*k+Xe*ne+$e*H+Ze*He,Ve=h[12],Xe=h[13],$e=h[14],Ze=h[15],c[12]=Ve*g+Xe*R+$e*oe+Ze*Te,c[13]=Ve*w+Xe*o+$e*$+Ze*Me,c[14]=Ve*M+Xe*G+$e*de+Ze*je,c[15]=Ve*k+Xe*ne+$e*H+Ze*He,c}function Cp(c,s,h){const g=h[0],w=h[1],M=h[2];let k,R,o,G,ne,oe,$,de,H,Te,Me,je;return s===c?(c[12]=s[0]*g+s[4]*w+s[8]*M+s[12],c[13]=s[1]*g+s[5]*w+s[9]*M+s[13],c[14]=s[2]*g+s[6]*w+s[10]*M+s[14],c[15]=s[3]*g+s[7]*w+s[11]*M+s[15]):(k=s[0],R=s[1],o=s[2],G=s[3],ne=s[4],oe=s[5],$=s[6],de=s[7],H=s[8],Te=s[9],Me=s[10],je=s[11],c[0]=k,c[1]=R,c[2]=o,c[3]=G,c[4]=ne,c[5]=oe,c[6]=$,c[7]=de,c[8]=H,c[9]=Te,c[10]=Me,c[11]=je,c[12]=k*g+ne*w+H*M+s[12],c[13]=R*g+oe*w+Te*M+s[13],c[14]=o*g+$*w+Me*M+s[14],c[15]=G*g+de*w+je*M+s[15]),c}function $g(c,s,h){const g=h[0],w=h[1],M=h[2];return c[0]=s[0]*g,c[1]=s[1]*g,c[2]=s[2]*g,c[3]=s[3]*g,c[4]=s[4]*w,c[5]=s[5]*w,c[6]=s[6]*w,c[7]=s[7]*w,c[8]=s[8]*M,c[9]=s[9]*M,c[10]=s[10]*M,c[11]=s[11]*M,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c}function NT(c,s,h,g){let w=g[0],M=g[1],k=g[2],R=Math.sqrt(w*w+M*M+k*k),o,G,ne,oe,$,de,H,Te,Me,je,He,Ve,Xe,$e,Ze,xt,It,Pt,Ot,Yt,Nt,$t,Et,yn;return R<_p?null:(R=1/R,w*=R,M*=R,k*=R,G=Math.sin(h),o=Math.cos(h),ne=1-o,oe=s[0],$=s[1],de=s[2],H=s[3],Te=s[4],Me=s[5],je=s[6],He=s[7],Ve=s[8],Xe=s[9],$e=s[10],Ze=s[11],xt=w*w*ne+o,It=M*w*ne+k*G,Pt=k*w*ne-M*G,Ot=w*M*ne-k*G,Yt=M*M*ne+o,Nt=k*M*ne+w*G,$t=w*k*ne+M*G,Et=M*k*ne-w*G,yn=k*k*ne+o,c[0]=oe*xt+Te*It+Ve*Pt,c[1]=$*xt+Me*It+Xe*Pt,c[2]=de*xt+je*It+$e*Pt,c[3]=H*xt+He*It+Ze*Pt,c[4]=oe*Ot+Te*Yt+Ve*Nt,c[5]=$*Ot+Me*Yt+Xe*Nt,c[6]=de*Ot+je*Yt+$e*Nt,c[7]=H*Ot+He*Yt+Ze*Nt,c[8]=oe*$t+Te*Et+Ve*yn,c[9]=$*$t+Me*Et+Xe*yn,c[10]=de*$t+je*Et+$e*yn,c[11]=H*$t+He*Et+Ze*yn,s!==c&&(c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c)}function Dx(c,s,h){const g=Math.sin(h),w=Math.cos(h),M=s[4],k=s[5],R=s[6],o=s[7],G=s[8],ne=s[9],oe=s[10],$=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=M*w+G*g,c[5]=k*w+ne*g,c[6]=R*w+oe*g,c[7]=o*w+$*g,c[8]=G*w-M*g,c[9]=ne*w-k*g,c[10]=oe*w-R*g,c[11]=$*w-o*g,c}function UT(c,s,h){const g=Math.sin(h),w=Math.cos(h),M=s[0],k=s[1],R=s[2],o=s[3],G=s[8],ne=s[9],oe=s[10],$=s[11];return s!==c&&(c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=M*w-G*g,c[1]=k*w-ne*g,c[2]=R*w-oe*g,c[3]=o*w-$*g,c[8]=M*g+G*w,c[9]=k*g+ne*w,c[10]=R*g+oe*w,c[11]=o*g+$*w,c}function Lx(c,s,h){const g=Math.sin(h),w=Math.cos(h),M=s[0],k=s[1],R=s[2],o=s[3],G=s[4],ne=s[5],oe=s[6],$=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=M*w+G*g,c[1]=k*w+ne*g,c[2]=R*w+oe*g,c[3]=o*w+$*g,c[4]=G*w-M*g,c[5]=ne*w-k*g,c[6]=oe*w-R*g,c[7]=$*w-o*g,c}function jT(c,s){const h=s[0],g=s[1],w=s[2],M=s[3],k=h+h,R=g+g,o=w+w,G=h*k,ne=g*k,oe=g*R,$=w*k,de=w*R,H=w*o,Te=M*k,Me=M*R,je=M*o;return c[0]=1-oe-H,c[1]=ne+je,c[2]=$-Me,c[3]=0,c[4]=ne-je,c[5]=1-G-H,c[6]=de+Te,c[7]=0,c[8]=$+Me,c[9]=de-Te,c[10]=1-G-oe,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function VT(c,s,h,g,w,M,k){const R=1/(h-s),o=1/(w-g),G=1/(M-k);return c[0]=M*2*R,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=M*2*o,c[6]=0,c[7]=0,c[8]=(h+s)*R,c[9]=(w+g)*o,c[10]=(k+M)*G,c[11]=-1,c[12]=0,c[13]=0,c[14]=k*M*2*G,c[15]=0,c}function $T(c,s,h,g,w){const M=1/Math.tan(s/2);if(c[0]=M/h,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=M,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,w!=null&&w!==1/0){const k=1/(g-w);c[10]=(w+g)*k,c[14]=2*w*g*k}else c[10]=-1,c[14]=-2*g;return c}const ZT=$T;function GT(c,s,h,g,w,M,k){const R=1/(s-h),o=1/(g-w),G=1/(M-k);return c[0]=-2*R,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*o,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*G,c[11]=0,c[12]=(s+h)*R,c[13]=(w+g)*o,c[14]=(k+M)*G,c[15]=1,c}const qT=GT;function WT(c,s,h,g){let w,M,k,R,o,G,ne,oe,$,de;const H=s[0],Te=s[1],Me=s[2],je=g[0],He=g[1],Ve=g[2],Xe=h[0],$e=h[1],Ze=h[2];return Math.abs(H-Xe)<_p&&Math.abs(Te-$e)<_p&&Math.abs(Me-Ze)<_p?OT(c):(oe=H-Xe,$=Te-$e,de=Me-Ze,w=1/Math.sqrt(oe*oe+$*$+de*de),oe*=w,$*=w,de*=w,M=He*de-Ve*$,k=Ve*oe-je*de,R=je*$-He*oe,w=Math.sqrt(M*M+k*k+R*R),w?(w=1/w,M*=w,k*=w,R*=w):(M=0,k=0,R=0),o=$*R-de*k,G=de*M-oe*R,ne=oe*k-$*M,w=Math.sqrt(o*o+G*G+ne*ne),w?(w=1/w,o*=w,G*=w,ne*=w):(o=0,G=0,ne=0),c[0]=M,c[1]=o,c[2]=oe,c[3]=0,c[4]=k,c[5]=G,c[6]=$,c[7]=0,c[8]=R,c[9]=ne,c[10]=de,c[11]=0,c[12]=-(M*H+k*Te+R*Me),c[13]=-(o*H+G*Te+ne*Me),c[14]=-(oe*H+$*Te+de*Me),c[15]=1,c)}function XT(){const c=new fd(4);return fd!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0,c[3]=0),c}function HT(c,s,h){return c[0]=s[0]*h,c[1]=s[1]*h,c[2]=s[2]*h,c[3]=s[3]*h,c}function Rx(c,s,h){const g=s[0],w=s[1],M=s[2],k=s[3];return c[0]=h[0]*g+h[4]*w+h[8]*M+h[12]*k,c[1]=h[1]*g+h[5]*w+h[9]*M+h[13]*k,c[2]=h[2]*g+h[6]*w+h[10]*M+h[14]*k,c[3]=h[3]*g+h[7]*w+h[11]*M+h[15]*k,c}(function(){const c=XT();return function(s,h,g,w,M,k){let R,o;for(h||(h=4),g||(g=0),w?o=Math.min(w*h+g,s.length):o=s.length,R=g;R<o;R+=h)c[0]=s[R],c[1]=s[R+1],c[2]=s[R+2],c[3]=s[R+3],M(c,c,k),s[R]=c[0],s[R+1]=c[1],s[R+2]=c[2],s[R+3]=c[3];return s}})();var yg;(function(c){c[c.COL0ROW0=0]="COL0ROW0",c[c.COL0ROW1=1]="COL0ROW1",c[c.COL0ROW2=2]="COL0ROW2",c[c.COL0ROW3=3]="COL0ROW3",c[c.COL1ROW0=4]="COL1ROW0",c[c.COL1ROW1=5]="COL1ROW1",c[c.COL1ROW2=6]="COL1ROW2",c[c.COL1ROW3=7]="COL1ROW3",c[c.COL2ROW0=8]="COL2ROW0",c[c.COL2ROW1=9]="COL2ROW1",c[c.COL2ROW2=10]="COL2ROW2",c[c.COL2ROW3=11]="COL2ROW3",c[c.COL3ROW0=12]="COL3ROW0",c[c.COL3ROW1=13]="COL3ROW1",c[c.COL3ROW2=14]="COL3ROW2",c[c.COL3ROW3=15]="COL3ROW3"})(yg||(yg={}));const YT=45*Math.PI/180,KT=1,Xm=.1,Hm=500,JT=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class hh extends RT{static get IDENTITY(){return eS()}static get ZERO(){return QT()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return yg}constructor(s){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(s)?this.copy(s):this.identity()}copy(s){return this[0]=s[0],this[1]=s[1],this[2]=s[2],this[3]=s[3],this[4]=s[4],this[5]=s[5],this[6]=s[6],this[7]=s[7],this[8]=s[8],this[9]=s[9],this[10]=s[10],this[11]=s[11],this[12]=s[12],this[13]=s[13],this[14]=s[14],this[15]=s[15],this.check()}set(s,h,g,w,M,k,R,o,G,ne,oe,$,de,H,Te,Me){return this[0]=s,this[1]=h,this[2]=g,this[3]=w,this[4]=M,this[5]=k,this[6]=R,this[7]=o,this[8]=G,this[9]=ne,this[10]=oe,this[11]=$,this[12]=de,this[13]=H,this[14]=Te,this[15]=Me,this.check()}setRowMajor(s,h,g,w,M,k,R,o,G,ne,oe,$,de,H,Te,Me){return this[0]=s,this[1]=M,this[2]=G,this[3]=de,this[4]=h,this[5]=k,this[6]=ne,this[7]=H,this[8]=g,this[9]=R,this[10]=oe,this[11]=Te,this[12]=w,this[13]=o,this[14]=$,this[15]=Me,this.check()}toRowMajor(s){return s[0]=this[0],s[1]=this[4],s[2]=this[8],s[3]=this[12],s[4]=this[1],s[5]=this[5],s[6]=this[9],s[7]=this[13],s[8]=this[2],s[9]=this[6],s[10]=this[10],s[11]=this[14],s[12]=this[3],s[13]=this[7],s[14]=this[11],s[15]=this[15],s}identity(){return this.copy(JT)}fromObject(s){return this.check()}fromQuaternion(s){return jT(this,s),this.check()}frustum(s){const{left:h,right:g,bottom:w,top:M,near:k=Xm,far:R=Hm}=s;return R===1/0?tS(this,h,g,w,M,k):VT(this,h,g,w,M,k,R),this.check()}lookAt(s){const{eye:h,center:g=[0,0,0],up:w=[0,1,0]}=s;return WT(this,h,g,w),this.check()}ortho(s){const{left:h,right:g,bottom:w,top:M,near:k=Xm,far:R=Hm}=s;return qT(this,h,g,w,M,k,R),this.check()}orthographic(s){const{fovy:h=YT,aspect:g=KT,focalDistance:w=1,near:M=Xm,far:k=Hm}=s;Rv(h);const R=h/2,o=w*Math.tan(R),G=o*g;return this.ortho({left:-G,right:G,bottom:-o,top:o,near:M,far:k})}perspective(s){const{fovy:h=45*Math.PI/180,aspect:g=1,near:w=.1,far:M=500}=s;return Rv(h),ZT(this,h,g,w,M),this.check()}determinant(){return FT(this)}getScale(s=[-0,-0,-0]){return s[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),s[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),s[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),s}getTranslation(s=[-0,-0,-0]){return s[0]=this[12],s[1]=this[13],s[2]=this[14],s}getRotation(s,h){s=s||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],h=h||[-0,-0,-0];const g=this.getScale(h),w=1/g[0],M=1/g[1],k=1/g[2];return s[0]=this[0]*w,s[1]=this[1]*M,s[2]=this[2]*k,s[3]=0,s[4]=this[4]*w,s[5]=this[5]*M,s[6]=this[6]*k,s[7]=0,s[8]=this[8]*w,s[9]=this[9]*M,s[10]=this[10]*k,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}getRotationMatrix3(s,h){s=s||[-0,-0,-0,-0,-0,-0,-0,-0,-0],h=h||[-0,-0,-0];const g=this.getScale(h),w=1/g[0],M=1/g[1],k=1/g[2];return s[0]=this[0]*w,s[1]=this[1]*M,s[2]=this[2]*k,s[3]=this[4]*w,s[4]=this[5]*M,s[5]=this[6]*k,s[6]=this[8]*w,s[7]=this[9]*M,s[8]=this[10]*k,s}transpose(){return BT(this,this),this.check()}invert(){return _g(this,this),this.check()}multiplyLeft(s){return ff(this,s,this),this.check()}multiplyRight(s){return ff(this,this,s),this.check()}rotateX(s){return Dx(this,this,s),this.check()}rotateY(s){return UT(this,this,s),this.check()}rotateZ(s){return Lx(this,this,s),this.check()}rotateXYZ(s){return this.rotateX(s[0]).rotateY(s[1]).rotateZ(s[2])}rotateAxis(s,h){return NT(this,this,s,h),this.check()}scale(s){return $g(this,this,Array.isArray(s)?s:[s,s,s]),this.check()}translate(s){return Cp(this,this,s),this.check()}transform(s,h){return s.length===4?(h=Rx(h||[-0,-0,-0,-0],s,this),qm(h,4),h):this.transformAsPoint(s,h)}transformAsPoint(s,h){const{length:g}=s;let w;switch(g){case 2:w=wT(h||[-0,-0],s,this);break;case 3:w=zx(h||[-0,-0,-0],s,this);break;default:throw new Error("Illegal vector")}return qm(w,s.length),w}transformAsVector(s,h){let g;switch(s.length){case 2:g=ET(h||[-0,-0],s,this);break;case 3:g=kx(h||[-0,-0,-0],s,this);break;default:throw new Error("Illegal vector")}return qm(g,s.length),g}transformPoint(s,h){return this.transformAsPoint(s,h)}transformVector(s,h){return this.transformAsPoint(s,h)}transformDirection(s,h){return this.transformAsVector(s,h)}makeRotationX(s){return this.identity().rotateX(s)}makeTranslation(s,h,g){return this.identity().translate([s,h,g])}}let hp,dp;function QT(){return hp||(hp=new hh([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(hp)),hp}function eS(){return dp||(dp=new hh,Object.freeze(dp)),dp}function Rv(c){if(c>Math.PI*2)throw Error("expected radians")}function tS(c,s,h,g,w,M){const k=2*M/(h-s),R=2*M/(w-g),o=(h+s)/(h-s),G=(w+g)/(w-g),ne=-1,oe=-1,$=-2*M;return c[0]=k,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=R,c[6]=0,c[7]=0,c[8]=o,c[9]=G,c[10]=ne,c[11]=oe,c[12]=0,c[13]=0,c[14]=$,c[15]=0,c}var Na;(function(c){c[c.Start=1]="Start",c[c.Move=2]="Move",c[c.End=4]="End",c[c.Cancel=8]="Cancel"})(Na||(Na={}));var rs;(function(c){c[c.None=0]="None",c[c.Left=1]="Left",c[c.Right=2]="Right",c[c.Up=4]="Up",c[c.Down=8]="Down",c[c.Horizontal=3]="Horizontal",c[c.Vertical=12]="Vertical",c[c.All=15]="All"})(rs||(rs={}));var Rn;(function(c){c[c.Possible=1]="Possible",c[c.Began=2]="Began",c[c.Changed=4]="Changed",c[c.Ended=8]="Ended",c[c.Recognized=8]="Recognized",c[c.Cancelled=16]="Cancelled",c[c.Failed=32]="Failed"})(Rn||(Rn={}));const nS="manipulation",rS="none",iS="pan-x",oS="pan-y";function sS(c,s){const h=s.x-c.x,g=s.y-c.y;return Math.sqrt(h*h+g*g)}Na.Start,Na.Move,Na.End,Na.Cancel,Na.Cancel;let aS=1;function lS(){return aS++}function Ov(c){return c&Rn.Cancelled?"cancel":c&Rn.Ended?"end":c&Rn.Changed?"move":c&Rn.Began?"start":""}class Ox{constructor(s){this.options=s,this.id=lS(),this.state=Rn.Possible,this.simultaneous={},this.requireFail=[]}set(s){return Object.assign(this.options,s),this.manager.touchAction.update(),this}recognizeWith(s){if(Array.isArray(s)){for(const w of s)this.recognizeWith(w);return this}let h;if(typeof s=="string"){if(h=this.manager.get(s),!h)throw new Error(`Cannot find recognizer ${s}`)}else h=s;const{simultaneous:g}=this;return g[h.id]||(g[h.id]=h,h.recognizeWith(this)),this}dropRecognizeWith(s){if(Array.isArray(s)){for(const g of s)this.dropRecognizeWith(g);return this}let h;return typeof s=="string"?h=this.manager.get(s):h=s,h&&delete this.simultaneous[h.id],this}requireFailure(s){if(Array.isArray(s)){for(const w of s)this.requireFailure(w);return this}let h;if(typeof s=="string"){if(h=this.manager.get(s),!h)throw new Error(`Cannot find recognizer ${s}`)}else h=s;const{requireFail:g}=this;return g.indexOf(h)===-1&&(g.push(h),h.requireFailure(this)),this}dropRequireFailure(s){if(Array.isArray(s)){for(const g of s)this.dropRequireFailure(g);return this}let h;if(typeof s=="string"?h=this.manager.get(s):h=s,h){const g=this.requireFail.indexOf(h);g>-1&&this.requireFail.splice(g,1)}return this}hasRequireFailures(){return!!this.requireFail.find(s=>s.options.enable)}canRecognizeWith(s){return!!this.simultaneous[s.id]}emit(s){if(!s)return;const{state:h}=this;h<Rn.Ended&&this.manager.emit(this.options.event+Ov(h),s),this.manager.emit(this.options.event,s),s.additionalEvent&&this.manager.emit(s.additionalEvent,s),h>=Rn.Ended&&this.manager.emit(this.options.event+Ov(h),s)}tryEmit(s){this.canEmit()?this.emit(s):this.state=Rn.Failed}canEmit(){let s=0;for(;s<this.requireFail.length;){if(!(this.requireFail[s].state&(Rn.Failed|Rn.Possible)))return!1;s++}return!0}recognize(s){const h={...s};if(!this.options.enable){this.reset(),this.state=Rn.Failed;return}this.state&(Rn.Recognized|Rn.Cancelled|Rn.Failed)&&(this.state=Rn.Possible),this.state=this.process(h),this.state&(Rn.Began|Rn.Changed|Rn.Ended|Rn.Cancelled)&&this.tryEmit(h)}getEventNames(){return[this.options.event]}reset(){}}class Bx extends Ox{attrTest(s){const h=this.options.pointers;return h===0||s.pointers.length===h}process(s){const{state:h}=this,{eventType:g}=s,w=h&(Rn.Began|Rn.Changed),M=this.attrTest(s);return w&&(g&Na.Cancel||!M)?h|Rn.Cancelled:w||M?g&Na.End?h|Rn.Ended:h&Rn.Began?h|Rn.Changed:Rn.Began:Rn.Failed}}class Bv extends Ox{constructor(s={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...s}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[nS]}process(s){const{options:h}=this,g=s.pointers.length===h.pointers,w=s.distance<h.threshold,M=s.deltaTime<h.time;if(this.reset(),s.eventType&Na.Start&&this.count===0)return this.failTimeout();if(w&&M&&g){if(s.eventType!==Na.End)return this.failTimeout();const k=this.pTime?s.timeStamp-this.pTime<h.interval:!0,R=!this.pCenter||sS(this.pCenter,s.center)<h.posThreshold;if(this.pTime=s.timeStamp,this.pCenter=s.center,!R||!k?this.count=1:this.count+=1,this._input=s,this.count%h.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Rn.Recognized,this.tryEmit(this._input)},h.interval),Rn.Began):Rn.Recognized}return Rn.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Rn.Failed},this.options.interval),Rn.Failed}reset(){clearTimeout(this._timer)}emit(s){this.state===Rn.Recognized&&(s.tapCount=this.count,this.manager.emit(this.options.event,s))}}const uS=["","start","move","end","cancel","up","down","left","right"];class Fv extends Bx{constructor(s={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:rs.All,...s}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:s}}=this,h=[];return s&rs.Horizontal&&h.push(oS),s&rs.Vertical&&h.push(iS),h}getEventNames(){return uS.map(s=>this.options.event+s)}directionTest(s){const{options:h}=this;let g=!0,{distance:w}=s,{direction:M}=s;const k=s.deltaX,R=s.deltaY;return M&h.direction||(h.direction&rs.Horizontal?(M=k===0?rs.None:k<0?rs.Left:rs.Right,g=k!==this.pX,w=Math.abs(s.deltaX)):(M=R===0?rs.None:R<0?rs.Up:rs.Down,g=R!==this.pY,w=Math.abs(s.deltaY))),s.direction=M,g&&w>h.threshold&&!!(M&h.direction)}attrTest(s){return super.attrTest(s)&&(!!(this.state&Rn.Began)||!(this.state&Rn.Began)&&this.directionTest(s))}emit(s){this.pX=s.deltaX,this.pY=s.deltaY;const h=rs[s.direction].toLowerCase();h&&(s.additionalEvent=this.options.event+h),super.emit(s)}}const cS=["","start","move","end","cancel","in","out"];class hS extends Bx{constructor(s={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...s})}getTouchAction(){return[rS]}getEventNames(){return cS.map(s=>this.options.event+s)}attrTest(s){return super.attrTest(s)&&(Math.abs(s.scale-1)>this.options.threshold||!!(this.state&Rn.Began))}emit(s){if(s.scale!==1){const h=s.scale<1?"in":"out";s.additionalEvent=this.options.event+h}super.emit(s)}}const dS=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"";dS.indexOf("firefox");const Ym={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0};rs.Vertical;function fS(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ud(c,s){const h=Rx([],s,c);return HT(h,h,1/h[3]),h}function Nv(c,s){const h=c%s;return h<0?s+h:h}function vg(c,s,h){return c<s?s:c>h?h:c}function pS(c){return Math.log(c)*Math.LOG2E}const Zg=Math.log2||pS;function pu(c,s){if(!c)throw new Error(s||"@math.gl/web-mercator: assertion failed.")}const ja=Math.PI,Fx=ja/4,na=ja/180,xg=180/ja,md=512,Pp=4003e4,Uv=85.051129,mS=1.5;function gS(c){return Zg(c)}function Ip(c){const[s,h]=c;pu(Number.isFinite(s)),pu(Number.isFinite(h)&&h>=-90&&h<=90,"invalid latitude");const g=s*na,w=h*na,M=md*(g+ja)/(2*ja),k=md*(ja+Math.log(Math.tan(Fx+w*.5)))/(2*ja);return[M,k]}function gd(c){const[s,h]=c,g=s/md*(2*ja)-ja,w=2*(Math.atan(Math.exp(h/md*(2*ja)-ja))-Fx);return[g*xg,w*xg]}function _S(c){const{latitude:s}=c;pu(Number.isFinite(s));const h=Math.cos(s*na);return gS(Pp*h)-9}function Km(c){const s=Math.cos(c*na);return md/Pp/s}function bg(c){const{latitude:s,longitude:h,highPrecision:g=!1}=c;pu(Number.isFinite(s)&&Number.isFinite(h));const w=md,M=Math.cos(s*na),k=w/360,R=k/M,o=w/Pp/M,G={unitsPerMeter:[o,o,o],metersPerUnit:[1/o,1/o,1/o],unitsPerDegree:[k,R,o],degreesPerUnit:[1/k,1/R,1/o]};if(g){const ne=na*Math.tan(s*na)/M,oe=k*ne/2,$=w/Pp*ne,de=$/R*o;G.unitsPerDegree2=[0,oe,$],G.unitsPerMeter2=[de,0,de]}return G}function yS(c,s){const[h,g,w]=c,[M,k,R]=s,{unitsPerMeter:o,unitsPerMeter2:G}=bg({longitude:h,latitude:g,highPrecision:!0}),ne=Ip(c);ne[0]+=M*(o[0]+G[0]*k),ne[1]+=k*(o[1]+G[1]*k);const oe=gd(ne),$=(w||0)+(R||0);return Number.isFinite(w)||Number.isFinite(R)?[oe[0],oe[1],$]:oe}function vS(c){const{height:s,pitch:h,bearing:g,altitude:w,scale:M,center:k}=c,R=fS();Cp(R,R,[0,0,-w]),Dx(R,R,-h*na),Lx(R,R,g*na);const o=M/s;return $g(R,R,[o,o,o]),k&&Cp(R,R,MT([],k)),R}function xS(c){const{width:s,height:h,altitude:g,pitch:w=0,offset:M,center:k,scale:R,nearZMultiplier:o=1,farZMultiplier:G=1}=c;let{fovy:ne=Ap(mS)}=c;g!==void 0&&(ne=Ap(g));const oe=ne*na,$=w*na,de=Nx(ne);let H=de;k&&(H+=k[2]*R/Math.cos($)/h);const Te=oe*(.5+(M?M[1]:0)/h),Me=Math.sin(Te)*H/Math.sin(vg(Math.PI/2-$-Te,.01,Math.PI-.01)),je=Math.sin($)*Me+H,He=H*10,Ve=Math.min(je*G,He);return{fov:oe,aspect:s/h,focalDistance:de,near:o,far:Ve}}function Ap(c){return 2*Math.atan(.5/c)*xg}function Nx(c){return .5/Math.tan(.5*c*na)}function bS(c,s){const[h,g,w=0]=c;return pu(Number.isFinite(h)&&Number.isFinite(g)&&Number.isFinite(w)),ud(s,[h,g,w,1])}function Ux(c,s,h=0){const[g,w,M]=c;if(pu(Number.isFinite(g)&&Number.isFinite(w),"invalid pixel coordinate"),Number.isFinite(M))return ud(s,[g,w,M,1]);const k=ud(s,[g,w,0,1]),R=ud(s,[g,w,1,1]),o=k[2],G=R[2],ne=o===G?0:((h||0)-o)/(G-o);return Ax([],k,R,ne)}function wS(c){const{width:s,height:h,bounds:g,minExtent:w=0,maxZoom:M=24,offset:k=[0,0]}=c,[[R,o],[G,ne]]=g,oe=ES(c.padding),$=Ip([R,vg(ne,-85.051129,Uv)]),de=Ip([G,vg(o,-85.051129,Uv)]),H=[Math.max(Math.abs(de[0]-$[0]),w),Math.max(Math.abs(de[1]-$[1]),w)],Te=[s-oe.left-oe.right-Math.abs(k[0])*2,h-oe.top-oe.bottom-Math.abs(k[1])*2];pu(Te[0]>0&&Te[1]>0);const Me=Te[0]/H[0],je=Te[1]/H[1],He=(oe.right-oe.left)/2/Me,Ve=(oe.top-oe.bottom)/2/je,Xe=[(de[0]+$[0])/2+He,(de[1]+$[1])/2+Ve],$e=gd(Xe),Ze=Math.min(M,Zg(Math.abs(Math.min(Me,je))));return pu(Number.isFinite(Ze)),{longitude:$e[0],latitude:$e[1],zoom:Ze}}function ES(c=0){return typeof c=="number"?{top:c,bottom:c,left:c,right:c}:(pu(Number.isFinite(c.top)&&Number.isFinite(c.bottom)&&Number.isFinite(c.left)&&Number.isFinite(c.right)),c)}const jv=Math.PI/180;function TS(c,s=0){const{width:h,height:g,unproject:w}=c,M={targetZ:s},k=w([0,g],M),R=w([h,g],M);let o,G;const ne=c.fovy?.5*c.fovy*jv:Math.atan(.5/c.altitude),oe=(90-c.pitch)*jv;return ne>oe-.01?(o=Vv(c,0,s),G=Vv(c,h,s)):(o=w([0,0],M),G=w([h,0],M)),[k,R,G,o]}function Vv(c,s,h){const{pixelUnprojectionMatrix:g}=c,w=ud(g,[s,0,1,1]),M=ud(g,[s,c.height,1,1]),R=(h*c.distanceScales.unitsPerMeter[2]-w[2])/(M[2]-w[2]),o=Ax([],w,M,R),G=gd(o);return G.push(h),G}const $v=512;function SS(c){const{width:s,height:h,pitch:g=0}=c;let{longitude:w,latitude:M,zoom:k,bearing:R=0}=c;(w<-180||w>180)&&(w=Nv(w+180,360)-180),(R<-180||R>180)&&(R=Nv(R+180,360)-180);const o=Zg(h/$v);if(k<=o)k=o,M=0;else{const G=h/2/Math.pow(2,k),ne=gd([0,G])[1];if(M<ne)M=ne;else{const oe=gd([0,$v-G])[1];M>oe&&(M=oe)}}return{width:s,height:h,longitude:w,latitude:M,zoom:k,pitch:g,bearing:R}}function uf(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function MS(c){return[c[12],c[13],c[14]]}function CS(c){return{left:id(c[3]+c[0],c[7]+c[4],c[11]+c[8],c[15]+c[12]),right:id(c[3]-c[0],c[7]-c[4],c[11]-c[8],c[15]-c[12]),bottom:id(c[3]+c[1],c[7]+c[5],c[11]+c[9],c[15]+c[13]),top:id(c[3]-c[1],c[7]-c[5],c[11]-c[9],c[15]-c[13]),near:id(c[3]+c[2],c[7]+c[6],c[11]+c[10],c[15]+c[14]),far:id(c[3]-c[2],c[7]-c[6],c[11]-c[10],c[15]-c[14])}}const Zv=new pd;function id(c,s,h,g){Zv.set(c,s,h);const w=Zv.len();return{distance:g/w,normal:new pd(-c/w,-s/w,-h/w)}}const PS=Math.PI/180,IS=uf(),Gv=[0,0,0],AS={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function kS({width:c,height:s,orthographic:h,fovyRadians:g,focalDistance:w,padding:M,near:k,far:R}){const o=c/s,G=h?new hh().orthographic({fovy:g,aspect:o,focalDistance:w,near:k,far:R}):new hh().perspective({fovy:g,aspect:o,near:k,far:R});if(M){const{left:ne=0,right:oe=0,top:$=0,bottom:de=0}=M,H=ic((ne+c-oe)/2,0,c)-c/2,Te=ic(($+s-de)/2,0,s)-s/2;G[8]-=H*2/c,G[9]+=Te*2/s}return G}class Lp{constructor(s={}){this._frustumPlanes={},this.id=s.id||this.constructor.displayName||"viewport",this.x=s.x||0,this.y=s.y||0,this.width=s.width||1,this.height=s.height||1,this.zoom=s.zoom||0,this.padding=s.padding,this.distanceScales=s.distanceScales||AS,this.focalDistance=s.focalDistance||1,this.position=s.position||Gv,this.modelMatrix=s.modelMatrix||null;const{longitude:h,latitude:g}=s;this.isGeospatial=Number.isFinite(g)&&Number.isFinite(h),this._initProps(s),this._initMatrices(s),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ym.WEB_MERCATOR:Ym.WEB_MERCATOR_AUTO_OFFSET:Ym.IDENTITY}equals(s){return s instanceof Lp?this===s?!0:s.width===this.width&&s.height===this.height&&s.scale===this.scale&&_f(s.projectionMatrix,this.projectionMatrix)&&_f(s.viewMatrix,this.viewMatrix):!1}project(s,{topLeft:h=!0}={}){const g=this.projectPosition(s),w=bS(g,this.pixelProjectionMatrix),[M,k]=w,R=h?k:this.height-k;return s.length===2?[M,R]:[M,R,w[2]]}unproject(s,{topLeft:h=!0,targetZ:g}={}){const[w,M,k]=s,R=h?M:this.height-M,o=g&&g*this.distanceScales.unitsPerMeter[2],G=Ux([w,R,k],this.pixelUnprojectionMatrix,o),[ne,oe,$]=this.unprojectPosition(G);return Number.isFinite(k)?[ne,oe,$]:Number.isFinite(g)?[ne,oe,g]:[ne,oe]}projectPosition(s){const[h,g]=this.projectFlat(s),w=(s[2]||0)*this.distanceScales.unitsPerMeter[2];return[h,g,w]}unprojectPosition(s){const[h,g]=this.unprojectFlat(s),w=(s[2]||0)*this.distanceScales.metersPerUnit[2];return[h,g,w]}projectFlat(s){if(this.isGeospatial){const h=Ip(s);return h[1]=ic(h[1],-318,830),h}return s}unprojectFlat(s){return this.isGeospatial?gd(s):s}getBounds(s={}){const h={targetZ:s.z||0},g=this.unproject([0,0],h),w=this.unproject([this.width,0],h),M=this.unproject([0,this.height],h),k=this.unproject([this.width,this.height],h);return[Math.min(g[0],w[0],M[0],k[0]),Math.min(g[1],w[1],M[1],k[1]),Math.max(g[0],w[0],M[0],k[0]),Math.max(g[1],w[1],M[1],k[1])]}getDistanceScales(s){return s&&this.isGeospatial?bg({longitude:s[0],latitude:s[1],highPrecision:!0}):this.distanceScales}containsPixel({x:s,y:h,width:g=1,height:w=1}){return s<this.x+this.width&&this.x<s+g&&h<this.y+this.height&&this.y<h+w}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,CS(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(s,h){return null}_initProps(s){const h=s.longitude,g=s.latitude;this.isGeospatial&&(Number.isFinite(s.zoom)||(this.zoom=_S({latitude:g})+Math.log2(this.focalDistance)),this.distanceScales=s.distanceScales||bg({latitude:g,longitude:h}));const w=Math.pow(2,this.zoom);this.scale=w;const{position:M,modelMatrix:k}=s;let R=Gv;if(M&&(R=k?new hh(k).transformAsVector(M,[]):M),this.isGeospatial){const o=this.projectPosition([h,g,0]);this.center=new pd(R).scale(this.distanceScales.unitsPerMeter).add(o)}else this.center=this.projectPosition(R)}_initMatrices(s){const{viewMatrix:h=IS,projectionMatrix:g=null,orthographic:w=!1,fovyRadians:M,fovy:k=75,near:R=.1,far:o=1e3,padding:G=null,focalDistance:ne=1}=s;this.viewMatrixUncentered=h,this.viewMatrix=new hh().multiplyRight(h).translate(new pd(this.center).negate()),this.projectionMatrix=g||kS({width:this.width,height:this.height,orthographic:w,fovyRadians:M||k*PS,focalDistance:ne,padding:G,near:R,far:o});const oe=uf();ff(oe,oe,this.projectionMatrix),ff(oe,oe,this.viewMatrix),this.viewProjectionMatrix=oe,this.viewMatrixInverse=_g([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=MS(this.viewMatrixInverse);const $=uf(),de=uf();$g($,$,[this.width/2,-this.height/2,1]),Cp($,$,[1,-1,0]),ff(de,$,this.viewProjectionMatrix),this.pixelProjectionMatrix=de,this.pixelUnprojectionMatrix=_g(uf(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||dT.warn("Pixel project matrix not invertible")()}}Lp.displayName="Viewport";class yf extends Lp{constructor(s={}){const{latitude:h=0,longitude:g=0,zoom:w=0,pitch:M=0,bearing:k=0,nearZMultiplier:R=.1,farZMultiplier:o=1.01,nearZ:G,farZ:ne,orthographic:oe=!1,projectionMatrix:$,repeat:de=!1,worldOffset:H=0,position:Te,padding:Me,legacyMeterSizes:je=!1}=s;let{width:He,height:Ve,altitude:Xe=1.5}=s;const $e=Math.pow(2,w);He=He||1,Ve=Ve||1;let Ze,xt=null;if($)Xe=$[5]/2,Ze=Ap(Xe);else{s.fovy?(Ze=s.fovy,Xe=Nx(Ze)):Ze=Ap(Xe);let Pt;if(Me){const{top:Ot=0,bottom:Yt=0}=Me;Pt=[0,ic((Ot+Ve-Yt)/2,0,Ve)-Ve/2]}xt=xS({width:He,height:Ve,scale:$e,center:Te&&[0,0,Te[2]*Km(h)],offset:Pt,pitch:M,fovy:Ze,nearZMultiplier:R,farZMultiplier:o}),Number.isFinite(G)&&(xt.near=G),Number.isFinite(ne)&&(xt.far=ne)}let It=vS({height:Ve,pitch:M,bearing:k,scale:$e,altitude:Xe});H&&(It=new hh().translate([512*H,0,0]).multiplyLeft(It)),super({...s,width:He,height:Ve,viewMatrix:It,longitude:g,latitude:h,zoom:w,...xt,fovy:Ze,focalDistance:Xe}),this.latitude=h,this.longitude=g,this.zoom=w,this.pitch=M,this.bearing=k,this.altitude=Xe,this.fovy=Ze,this.orthographic=oe,this._subViewports=de?[]:null,this._pseudoMeters=je,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const s=this.getBounds(),h=Math.floor((s[0]+180)/360),g=Math.ceil((s[2]-180)/360);for(let w=h;w<=g;w++){const M=w?new yf({...this,worldOffset:w}):this;this._subViewports.push(M)}}return this._subViewports}projectPosition(s){if(this._pseudoMeters)return super.projectPosition(s);const[h,g]=this.projectFlat(s),w=(s[2]||0)*Km(s[1]);return[h,g,w]}unprojectPosition(s){if(this._pseudoMeters)return super.unprojectPosition(s);const[h,g]=this.unprojectFlat(s),w=(s[2]||0)/Km(g);return[h,g,w]}addMetersToLngLat(s,h){return yS(s,h)}panByPosition(s,h){const g=Ux(h,this.pixelUnprojectionMatrix),w=this.projectFlat(s),M=Lv([],w,bT([],g)),k=Lv([],this.center,M),[R,o]=this.unprojectFlat(k);return{longitude:R,latitude:o}}getBounds(s={}){const h=TS(this,s.z||0);return[Math.min(h[0][0],h[1][0],h[2][0],h[3][0]),Math.min(h[0][1],h[1][1],h[2][1],h[3][1]),Math.max(h[0][0],h[1][0],h[2][0],h[3][0]),Math.max(h[0][1],h[1][1],h[2][1],h[3][1])]}fitBounds(s,h={}){const{width:g,height:w}=this,{longitude:M,latitude:k,zoom:R}=wS({width:g,height:w,bounds:s,...h});return new yf({width:g,height:w,longitude:M,latitude:k,zoom:R})}}yf.displayName="WebMercatorViewport";function wg(c,s,h){if(c===s)return!0;if(!h||!c||!s)return!1;if(Array.isArray(c)){if(!Array.isArray(s)||c.length!==s.length)return!1;for(let g=0;g<c.length;g++)if(!wg(c[g],s[g],h-1))return!1;return!0}if(Array.isArray(s))return!1;if(typeof c=="object"&&typeof s=="object"){const g=Object.keys(c),w=Object.keys(s);if(g.length!==w.length)return!1;for(const M of g)if(!s.hasOwnProperty(M)||!wg(c[M],s[M],h-1))return!1;return!0}return!1}const zS=/([0-9]+\.?[0-9]*)(%|px)/;function ec(c){switch(typeof c){case"number":return{position:c,relative:!1};case"string":const s=zS.exec(c);if(s&&s.length>=3){const h=s[2]==="%",g=parseFloat(s[1]);return{position:h?g/100:g,relative:h}}default:throw new Error(`Could not parse position string ${c}`)}}function tc(c,s){return c.relative?Math.round(c.position*s):c.position}class DS{constructor(s){const{id:h,x:g=0,y:w=0,width:M="100%",height:k="100%",padding:R=null}=s;this.id=h||this.constructor.displayName||"view",this.props={...s,id:this.id},this._x=ec(g),this._y=ec(w),this._width=ec(M),this._height=ec(k),this._padding=R&&{left:ec(R.left||0),right:ec(R.right||0),top:ec(R.top||0),bottom:ec(R.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(s){return this===s?!0:this.constructor===s.constructor&&wg(this.props,s.props,2)}makeViewport({width:s,height:h,viewState:g}){g=this.filterViewState(g);const w=this.getDimensions({width:s,height:h});if(!w.height||!w.width)return null;const M=this.getViewportType(g);return new M({...g,...this.props,...w})}getViewStateId(){const{viewState:s}=this.props;return typeof s=="string"?s:(s==null?void 0:s.id)||this.id}filterViewState(s){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const h={...s};for(const g in this.props.viewState)g!=="id"&&(h[g]=this.props.viewState[g]);return h}return s}getDimensions({width:s,height:h}){const g={x:tc(this._x,s),y:tc(this._y,h),width:tc(this._width,s),height:tc(this._height,h)};return this._padding&&(g.padding={left:tc(this._padding.left,s),top:tc(this._padding.top,h),right:tc(this._padding.right,s),bottom:tc(this._padding.bottom,h)}),g}get controller(){const s=this.props.controller;return s?s===!0?{type:this.ControllerType}:typeof s=="function"?{type:s}:{type:this.ControllerType,...s}:null}}class LS{constructor(s){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=s}get inProgress(){return this._inProgress}start(s){var h,g;this.cancel(),this.settings=s,this._inProgress=!0,(g=(h=this.settings).onStart)==null||g.call(h,this)}end(){var s,h;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(h=(s=this.settings).onEnd)==null||h.call(s,this))}cancel(){var s,h;this._inProgress&&((h=(s=this.settings).onInterrupt)==null||h.call(s,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var s,h;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:g,settings:w}=this;this._handle=g.addChannel({delay:g.getTime(),duration:w.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(h=(s=this.settings).onUpdate)==null||h.call(s,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const qv=()=>{},Eg={BREAK:1,SNAP_TO_END:2,IGNORE:3},RS=c=>c,OS=Eg.BREAK;class BS{constructor(s){this._onTransitionUpdate=h=>{const{time:g,settings:{interpolator:w,startProps:M,endProps:k,duration:R,easing:o}}=h,G=o(g/R),ne=w.interpolateProps(M,k,G);this.propsInTransition=this.getControllerState({...this.props,...ne}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=s.getControllerState,this.propsInTransition=null,this.transition=new LS(s.timeline),this.onViewStateChange=s.onViewStateChange||qv,this.onStateChange=s.onStateChange||qv}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(s){let h=!1;const g=this.props;if(this.props=s,!g||this._shouldIgnoreViewportChange(g,s))return!1;if(this._isTransitionEnabled(s)){let w=g;if(this.transition.inProgress){const{interruption:M,endProps:k}=this.transition.settings;w={...g,...M===Eg.SNAP_TO_END?k:this.propsInTransition||g}}this._triggerTransition(w,s),h=!0}else this.transition.cancel();return h}updateTransition(){this.transition.update()}_isTransitionEnabled(s){const{transitionDuration:h,transitionInterpolator:g}=s;return(h>0||h==="auto")&&!!g}_isUpdateDueToCurrentTransition(s){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(s,this.propsInTransition):!1}_shouldIgnoreViewportChange(s,h){return this.transition.inProgress?this.transition.settings.interruption===Eg.IGNORE||this._isUpdateDueToCurrentTransition(h):this._isTransitionEnabled(h)?h.transitionInterpolator.arePropsEqual(s,h):!0}_triggerTransition(s,h){const g=this.getControllerState(s),w=this.getControllerState(h).shortestPathFrom(g),M=h.transitionInterpolator,k=M.getDuration?M.getDuration(s,h):h.transitionDuration;if(k===0)return;const R=M.initializeProps(s,w);this.propsInTransition={};const o={duration:k,easing:h.transitionEasing||RS,interpolator:M,interruption:h.transitionInterruption||OS,startProps:R.start,endProps:R.end,onStart:h.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(h.onTransitionInterrupt),onEnd:this._onTransitionEnd(h.onTransitionEnd)};this.transition.start(o),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(s){return h=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),s==null||s(h)}}}function yp(c,s){if(!c)throw new Error(s||"deck.gl: assertion failed.")}class FS{constructor(s){const{compare:h,extract:g,required:w}=s;this._propsToCompare=h,this._propsToExtract=g||h,this._requiredProps=w}arePropsEqual(s,h){for(const g of this._propsToCompare)if(!(g in s)||!(g in h)||!_f(s[g],h[g]))return!1;return!0}initializeProps(s,h){const g={},w={};for(const M of this._propsToExtract)(M in s||M in h)&&(g[M]=s[M],w[M]=h[M]);return this._checkRequiredProps(g),this._checkRequiredProps(w),{start:g,end:w}}getDuration(s,h){return h.transitionDuration}_checkRequiredProps(s){this._requiredProps&&this._requiredProps.forEach(h=>{const g=s[h];yp(Number.isFinite(g)||Array.isArray(g),`${h} is required for transition`)})}}const NS=["longitude","latitude","zoom","bearing","pitch"],US=["longitude","latitude","zoom"];class jx extends FS{constructor(s={}){const h=Array.isArray(s)?s:s.transitionProps,g=Array.isArray(s)?{}:s;g.transitionProps=Array.isArray(h)?{compare:h,required:h}:h||{compare:NS,required:US},super(g.transitionProps),this.opts=g}initializeProps(s,h){const g=super.initializeProps(s,h),{makeViewport:w,around:M}=this.opts;if(w&&M){const k=w(s),R=w(h),o=k.unproject(M);g.start.around=M,Object.assign(g.end,{around:R.project(o),aroundPosition:o,width:h.width,height:h.height})}return g}interpolateProps(s,h,g){const w={};for(const M of this._propsToExtract)w[M]=gg(s[M]||0,h[M]||0,g);if(h.aroundPosition&&this.opts.makeViewport){const M=this.opts.makeViewport({...h,...w});Object.assign(w,M.panByPosition(h.aroundPosition,gg(s.around,h.around,g)))}return w}}const nc={transitionDuration:0},jS=300,fp=c=>1-(1-c)*(1-c),od={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},lh={};class VS{constructor(s){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new BS({...s,getControllerState:h=>new this.ControllerState(h),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=s.eventManager,this.onViewStateChange=s.onViewStateChange||(()=>{}),this.onStateChange=s.onStateChange||(()=>{}),this.makeViewport=s.makeViewport}set events(s){this.toggleEvents(this._customEvents,!1),this.toggleEvents(s,!0),this._customEvents=s,this.props&&this.setProps(this.props)}finalize(){var s;for(const h in this._events)this._events[h]&&((s=this.eventManager)==null||s.off(h,this.handleEvent));this.transitionManager.finalize()}handleEvent(s){this._controllerState=void 0;const h=this._eventStartBlocked;switch(s.type){case"panstart":return h?!1:this._onPanStart(s);case"panmove":return this._onPan(s);case"panend":return this._onPanEnd(s);case"pinchstart":return h?!1:this._onPinchStart(s);case"pinchmove":return this._onPinch(s);case"pinchend":return this._onPinchEnd(s);case"multipanstart":return h?!1:this._onMultiPanStart(s);case"multipanmove":return this._onMultiPan(s);case"multipanend":return this._onMultiPanEnd(s);case"dblclick":return this._onDoubleClick(s);case"wheel":return this._onWheel(s);case"keydown":return this._onKeyDown(s);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(s){const{x:h,y:g}=this.props,{offsetCenter:w}=s;return[w.x-h,w.y-g]}isPointInBounds(s,h){const{width:g,height:w}=this.props;if(h&&h.handled)return!1;const M=s[0]>=0&&s[0]<=g&&s[1]>=0&&s[1]<=w;return M&&h&&h.stopPropagation(),M}isFunctionKeyPressed(s){const{srcEvent:h}=s;return!!(h.metaKey||h.altKey||h.ctrlKey||h.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(s){const h=setTimeout(()=>{this._eventStartBlocked===h&&(this._eventStartBlocked=null)},s);this._eventStartBlocked=h}setProps(s){s.dragMode&&(this.dragMode=s.dragMode),this.props=s,"transitionInterpolator"in s||(s.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(s);const{inertia:h}=s;this.inertia=Number.isFinite(h)?h:h===!0?jS:0;const{scrollZoom:g=!0,dragPan:w=!0,dragRotate:M=!0,doubleClickZoom:k=!0,touchZoom:R=!0,touchRotate:o=!1,keyboard:G=!0}=s,ne=!!this.onViewStateChange;this.toggleEvents(od.WHEEL,ne&&g),this.toggleEvents(od.PAN,ne),this.toggleEvents(od.PINCH,ne&&(R||o)),this.toggleEvents(od.MULTI_PAN,ne&&o),this.toggleEvents(od.DOUBLE_CLICK,ne&&k),this.toggleEvents(od.KEYBOARD,ne&&G),this.scrollZoom=g,this.dragPan=w,this.dragRotate=M,this.doubleClickZoom=k,this.touchZoom=R,this.touchRotate=o,this.keyboard=G}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(s,h){this.eventManager&&s.forEach(g=>{this._events[g]!==h&&(this._events[g]=h,h?this.eventManager.on(g,this.handleEvent):this.eventManager.off(g,this.handleEvent))})}updateViewport(s,h=null,g={}){const w={...s.getViewportProps(),...h},M=this.controllerState!==s;if(this.state=s.getState(),this._setInteractionState(g),M){const k=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:w,interactionState:this._interactionState,oldViewState:k,viewId:this.props.id})}}_onTransition(s){this.onViewStateChange({...s,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(s){Object.assign(this._interactionState,s),this.onStateChange(this._interactionState)}_onPanStart(s){const h=this.getCenter(s);if(!this.isPointInBounds(h,s))return!1;let g=this.isFunctionKeyPressed(s)||s.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(g=!g);const w=this.controllerState[g?"panStart":"rotateStart"]({pos:h});return this._panMove=g,this.updateViewport(w,nc,{isDragging:!0}),!0}_onPan(s){return this.isDragging()?this._panMove?this._onPanMove(s):this._onPanRotate(s):!1}_onPanEnd(s){return this.isDragging()?this._panMove?this._onPanMoveEnd(s):this._onPanRotateEnd(s):!1}_onPanMove(s){if(!this.dragPan)return!1;const h=this.getCenter(s),g=this.controllerState.pan({pos:h});return this.updateViewport(g,nc,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(s){const{inertia:h}=this;if(this.dragPan&&h&&s.velocity){const g=this.getCenter(s),w=[g[0]+s.velocityX*h/2,g[1]+s.velocityY*h/2],M=this.controllerState.pan({pos:w}).panEnd();this.updateViewport(M,{...this._getTransitionProps(),transitionDuration:h,transitionEasing:fp},{isDragging:!1,isPanning:!0})}else{const g=this.controllerState.panEnd();this.updateViewport(g,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(s){if(!this.dragRotate)return!1;const h=this.getCenter(s),g=this.controllerState.rotate({pos:h});return this.updateViewport(g,nc,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(s){const{inertia:h}=this;if(this.dragRotate&&h&&s.velocity){const g=this.getCenter(s),w=[g[0]+s.velocityX*h/2,g[1]+s.velocityY*h/2],M=this.controllerState.rotate({pos:w}).rotateEnd();this.updateViewport(M,{...this._getTransitionProps(),transitionDuration:h,transitionEasing:fp},{isDragging:!1,isRotating:!0})}else{const g=this.controllerState.rotateEnd();this.updateViewport(g,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(s){if(!this.scrollZoom)return!1;const h=this.getCenter(s);if(!this.isPointInBounds(h,s))return!1;s.srcEvent.preventDefault();const{speed:g=.01,smooth:w=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:M}=s;let k=2/(1+Math.exp(-Math.abs(M*g)));M<0&&k!==0&&(k=1/k);const R=this.controllerState.zoom({pos:h,scale:k});return this.updateViewport(R,{...this._getTransitionProps({around:h}),transitionDuration:w?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(s){const h=this.getCenter(s);if(!this.isPointInBounds(h,s))return!1;const g=this.controllerState.rotateStart({pos:h});return this.updateViewport(g,nc,{isDragging:!0}),!0}_onMultiPan(s){if(!this.touchRotate||!this.isDragging())return!1;const h=this.getCenter(s);h[0]-=s.deltaX;const g=this.controllerState.rotate({pos:h});return this.updateViewport(g,nc,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(s){if(!this.isDragging())return!1;const{inertia:h}=this;if(this.touchRotate&&h&&s.velocityY){const g=this.getCenter(s),w=[g[0],g[1]+=s.velocityY*h/2],M=this.controllerState.rotate({pos:w});this.updateViewport(M,{...this._getTransitionProps(),transitionDuration:h,transitionEasing:fp},{isDragging:!1,isRotating:!0}),this.blockEvents(h)}else{const g=this.controllerState.rotateEnd();this.updateViewport(g,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(s){const h=this.getCenter(s);if(!this.isPointInBounds(h,s))return!1;const g=this.controllerState.zoomStart({pos:h}).rotateStart({pos:h});return lh._startPinchRotation=s.rotation,lh._lastPinchEvent=s,this.updateViewport(g,nc,{isDragging:!0}),!0}_onPinch(s){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let h=this.controllerState;if(this.touchZoom){const{scale:g}=s,w=this.getCenter(s);h=h.zoom({pos:w,scale:g})}if(this.touchRotate){const{rotation:g}=s;h=h.rotate({deltaAngleX:lh._startPinchRotation-g})}return this.updateViewport(h,nc,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),lh._lastPinchEvent=s,!0}_onPinchEnd(s){if(!this.isDragging())return!1;const{inertia:h}=this,{_lastPinchEvent:g}=lh;if(this.touchZoom&&h&&g&&s.scale!==g.scale){const w=this.getCenter(s);let M=this.controllerState.rotateEnd();const k=Math.log2(s.scale),R=(k-Math.log2(g.scale))/(s.deltaTime-g.deltaTime),o=Math.pow(2,k+R*h/2);M=M.zoom({pos:w,scale:o}).zoomEnd(),this.updateViewport(M,{...this._getTransitionProps({around:w}),transitionDuration:h,transitionEasing:fp},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(h)}else{const w=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(w,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return lh._startPinchRotation=null,lh._lastPinchEvent=null,!0}_onDoubleClick(s){if(!this.doubleClickZoom)return!1;const h=this.getCenter(s);if(!this.isPointInBounds(h,s))return!1;const g=this.isFunctionKeyPressed(s),w=this.controllerState.zoom({pos:h,scale:g?.5:2});return this.updateViewport(w,this._getTransitionProps({around:h}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(s){if(!this.keyboard)return!1;const h=this.isFunctionKeyPressed(s),{zoomSpeed:g,moveSpeed:w,rotateSpeedX:M,rotateSpeedY:k}=this.keyboard===!0?{}:this.keyboard,{controllerState:R}=this;let o;const G={};switch(s.srcEvent.code){case"Minus":o=h?R.zoomOut(g).zoomOut(g):R.zoomOut(g),G.isZooming=!0;break;case"Equal":o=h?R.zoomIn(g).zoomIn(g):R.zoomIn(g),G.isZooming=!0;break;case"ArrowLeft":h?(o=R.rotateLeft(M),G.isRotating=!0):(o=R.moveLeft(w),G.isPanning=!0);break;case"ArrowRight":h?(o=R.rotateRight(M),G.isRotating=!0):(o=R.moveRight(w),G.isPanning=!0);break;case"ArrowUp":h?(o=R.rotateUp(k),G.isRotating=!0):(o=R.moveUp(w),G.isPanning=!0);break;case"ArrowDown":h?(o=R.rotateDown(k),G.isRotating=!0):(o=R.moveDown(w),G.isPanning=!0);break;default:return!1}return this.updateViewport(o,this._getTransitionProps(),G),!0}_getTransitionProps(s){const{transition:h}=this;return!h||!h.transitionInterpolator?nc:s?{...h,transitionInterpolator:new jx({...s,...h.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:h}}class $S{constructor(s,h){this._viewportProps=this.applyConstraints(s),this._state=h}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Wv=5,ZS=1.2;class GS extends $S{constructor(s){const{width:h,height:g,latitude:w,longitude:M,zoom:k,bearing:R=0,pitch:o=0,altitude:G=1.5,position:ne=[0,0,0],maxZoom:oe=20,minZoom:$=0,maxPitch:de=60,minPitch:H=0,startPanLngLat:Te,startZoomLngLat:Me,startRotatePos:je,startBearing:He,startPitch:Ve,startZoom:Xe,normalize:$e=!0}=s;yp(Number.isFinite(M)),yp(Number.isFinite(w)),yp(Number.isFinite(k)),super({width:h,height:g,latitude:w,longitude:M,zoom:k,bearing:R,pitch:o,altitude:G,maxZoom:oe,minZoom:$,maxPitch:de,minPitch:H,normalize:$e,position:ne},{startPanLngLat:Te,startZoomLngLat:Me,startRotatePos:je,startBearing:He,startPitch:Ve,startZoom:Xe}),this.makeViewport=s.makeViewport}panStart({pos:s}){return this._getUpdatedState({startPanLngLat:this._unproject(s)})}pan({pos:s,startPos:h}){const g=this.getState().startPanLngLat||this._unproject(h);if(!g)return this;const M=this.makeViewport(this.getViewportProps()).panByPosition(g,s);return this._getUpdatedState(M)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:s}){return this._getUpdatedState({startRotatePos:s,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:s,deltaAngleX:h=0,deltaAngleY:g=0}){const{startRotatePos:w,startBearing:M,startPitch:k}=this.getState();if(!w||M===void 0||k===void 0)return this;let R;return s?R=this._getNewRotation(s,w,k,M):R={bearing:M+h,pitch:k+g},this._getUpdatedState(R)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:s}){return this._getUpdatedState({startZoomLngLat:this._unproject(s),startZoom:this.getViewportProps().zoom})}zoom({pos:s,startPos:h,scale:g}){let{startZoom:w,startZoomLngLat:M}=this.getState();if(M||(w=this.getViewportProps().zoom,M=this._unproject(h)||this._unproject(s)),!M)return this;const{maxZoom:k,minZoom:R}=this.getViewportProps();let o=w+Math.log2(g);o=ic(o,R,k);const G=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...G.panByPosition(M,s)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(s=2){return this._zoomFromCenter(s)}zoomOut(s=2){return this._zoomFromCenter(1/s)}moveLeft(s=100){return this._panFromCenter([s,0])}moveRight(s=100){return this._panFromCenter([-s,0])}moveUp(s=100){return this._panFromCenter([0,s])}moveDown(s=100){return this._panFromCenter([0,-s])}rotateLeft(s=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-s})}rotateRight(s=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+s})}rotateUp(s=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+s})}rotateDown(s=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-s})}shortestPathFrom(s){const h=s.getViewportProps(),g={...this.getViewportProps()},{bearing:w,longitude:M}=g;return Math.abs(w-h.bearing)>180&&(g.bearing=w<0?w+360:w-360),Math.abs(M-h.longitude)>180&&(g.longitude=M<0?M+360:M-360),g}applyConstraints(s){const{maxZoom:h,minZoom:g,zoom:w}=s;s.zoom=ic(w,g,h);const{maxPitch:M,minPitch:k,pitch:R}=s;s.pitch=ic(R,k,M);const{normalize:o=!0}=s;return o&&Object.assign(s,SS(s)),s}_zoomFromCenter(s){const{width:h,height:g}=this.getViewportProps();return this.zoom({pos:[h/2,g/2],scale:s})}_panFromCenter(s){const{width:h,height:g}=this.getViewportProps();return this.pan({startPos:[h/2,g/2],pos:[h/2+s[0],g/2+s[1]]})}_getUpdatedState(s){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...s})}_unproject(s){const h=this.makeViewport(this.getViewportProps());return s&&h.unproject(s)}_getNewRotation(s,h,g,w){const M=s[0]-h[0],k=s[1]-h[1],R=s[1],o=h[1],{width:G,height:ne}=this.getViewportProps(),oe=M/G;let $=0;k>0?Math.abs(ne-o)>Wv&&($=k/(o-ne)*ZS):k<0&&o>Wv&&($=1-R/o),$=ic($,-1,1);const{minPitch:de,maxPitch:H}=this.getViewportProps(),Te=w+180*oe;let Me=g;return $>0?Me=g+$*(H-g):$<0&&(Me=g-$*(de-g)),{pitch:Me,bearing:Te}}}class qS extends VS{constructor(){super(...arguments),this.ControllerState=GS,this.transition={transitionDuration:300,transitionInterpolator:new jx({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(s){s.position=s.position||[0,0,0];const h=this.props;super.setProps(s),(!h||h.height!==s.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...s,...this.state}))}}class Vx extends DS{constructor(s={}){super(s)}getViewportType(){return yf}get ControllerType(){return qS}}Vx.displayName="MapView";new Vx({repeat:!0});function WS({index:c,setIndex:s,count:h,kpiLabels:g=[],startColor:w="#d4f9d0",endColor:M="#27e7b8",minValue:k,maxValue:R}){const o=G=>{s(parseInt(G.target.value,10))};return Un.jsxs("header",{className:"header",children:[Un.jsxs("div",{className:"header-left",children:[Un.jsx("h1",{className:"header-title",children:"DMA Heatmap"}),Un.jsx("div",{className:"header-kpi-selector",children:Un.jsx("select",{value:c,onChange:o,className:"header-select",disabled:h<=1,children:g.map((G,ne)=>Un.jsx("option",{value:ne,children:G},ne))})})]}),Un.jsxs("div",{className:"header-gradient-bar",children:[k!==void 0&&Un.jsx("span",{className:"header-min",children:k}),Un.jsx("div",{className:"header-gradient",style:{background:`linear-gradient(90deg, ${w} 0%, ${M} 100%)`}}),R!==void 0&&Un.jsx("span",{className:"header-max",children:R})]})]})}console.log("Starting Sigma plugin initialization...");const Xv=[{name:"source",type:"element"},{name:"dma",type:"column",source:"source",allowMultiple:!1,allowedTypes:["string"]}];try{console.log("Configuring editor panel with initial config:",Xv),Qm.client.config.configureEditorPanel(Xv),console.log("Initial plugin configuration successful")}catch(c){console.error("Error in initial plugin configuration:",c)}function XS(){const[c,s]=lt.useState(null),[h,g]=lt.useState(!0),[w,M]=lt.useState("initializing");let k=null,R=null;try{if(k=Qm.useConfig(),console.log("Config loaded:",k),k&&k.source)try{R=Qm.useElementData(k.source),console.log("Data loaded:",R?"Data present":"No data")}catch(G){console.error("Error loading data:",G),s(G)}}catch(G){console.error("Error loading config:",G),s(G)}lt.useEffect(()=>{c?M("error"):k?R?(M("ready"),g(!1)):M("waiting for data"):M("waiting for config")},[c,k,R]);const o=()=>Un.jsxs("div",{style:{position:"fixed",bottom:10,left:10,background:"rgba(0,0,0,0.8)",color:"white",padding:10,borderRadius:5,fontSize:12,zIndex:9999,maxWidth:"80%",overflow:"auto"},children:[Un.jsxs("div",{children:["Plugin State: ",w]}),Un.jsxs("div",{children:["Loading: ",h?"Yes":"No"]}),Un.jsxs("div",{children:["Error: ",c?c.message:"None"]}),Un.jsxs("div",{children:["Config Present: ",k?"Yes":"No"]}),Un.jsxs("div",{children:["Config Details: ",JSON.stringify(k,null,2)]}),Un.jsxs("div",{children:["Data Present: ",R?"Yes":"No"]}),Un.jsxs("div",{children:["Data Sample: ",R&&k.dma?`${R[k.dma].length} rows`:"No data"]})]});return h?Un.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,textAlign:"center"},children:[Un.jsx("h2",{children:"Loading Plugin..."}),Un.jsxs("div",{children:["Current State: ",w]}),Un.jsx(o,{})]}):c?Un.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,color:"#c62828",background:"#ffebee",textAlign:"center"},children:[Un.jsx("h2",{children:"Error Loading Plugin"}),Un.jsxs("pre",{style:{whiteSpace:"pre-wrap",maxWidth:"80%"},children:[c.message,c.stack]}),Un.jsx(o,{})]}):Un.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[Un.jsx(WS,{}),Un.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:Un.jsx("div",{children:"Plugin loaded successfully!"})}),Un.jsx(o,{})]})}class HS extends Yv.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,h){console.error("Error caught by boundary:",s),console.error("Error info:",h)}render(){var s;return this.state.hasError?Un.jsxs("div",{style:{padding:20,color:"#c62828",background:"#ffebee"},children:[Un.jsx("h2",{children:"Something went wrong"}),Un.jsx("pre",{style:{whiteSpace:"pre-wrap"},children:(s=this.state.error)==null?void 0:s.message})]}):this.props.children}}const Jm=document.getElementById("root");if(!Jm)console.error("Root element not found!");else{console.log("Initializing React app...");try{n1.render(Un.jsx(Yv.StrictMode,{children:Un.jsx(HS,{children:Un.jsx(XS,{})})}),Jm),console.log("React app initialized successfully")}catch(c){console.error("Failed to initialize React app:",c),Jm.innerHTML=`
      <div style="padding: 20px; color: #c62828; background: #ffebee">
        <h2>Failed to initialize application</h2>
        <pre>${c.message}</pre>
      </div>
    `}}
