import{a as x,b as j,g as y,c as v}from"./vendor.CAFDgmtb.js";import{r as u,R as m}from"./mapbox.DCPsyBfg.js";import{M as E}from"./deck.lVF-a0_D.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const t of r)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function l(r){const t={};return r.integrity&&(t.integrity=r.integrity),r.referrerPolicy&&(t.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?t.credentials="include":r.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(r){if(r.ep)return;r.ep=!0;const t=l(r);fetch(r.href,t)}})();var e=x(),b=j();const D=y(b);var f=v();new E({repeat:!0});function N({index:s,setIndex:n,count:l,kpiLabels:c=[],startColor:r="#d4f9d0",endColor:t="#27e7b8",minValue:i,maxValue:o}){const d=a=>{n(parseInt(a.target.value,10))};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{className:"header-title",children:"DMA Heatmap"}),e.jsx("div",{className:"header-kpi-selector",children:e.jsx("select",{value:s,onChange:d,className:"header-select",disabled:l<=1,children:c.map((a,h)=>e.jsx("option",{value:h,children:a},h))})})]}),e.jsxs("div",{className:"header-gradient-bar",children:[i!==void 0&&e.jsx("span",{className:"header-min",children:i}),e.jsx("div",{className:"header-gradient",style:{background:`linear-gradient(90deg, ${r} 0%, ${t} 100%)`}}),o!==void 0&&e.jsx("span",{className:"header-max",children:o})]})]})}console.log("Starting Sigma plugin initialization...");const p=[{name:"source",type:"element"},{name:"dma",type:"column",source:"source",allowMultiple:!1,allowedTypes:["string"]}];try{console.log("Configuring editor panel with initial config:",p),f.client.config.configureEditorPanel(p),console.log("Initial plugin configuration successful")}catch(s){console.error("Error in initial plugin configuration:",s)}function S(){const[s,n]=u.useState(null),[l,c]=u.useState(!0),[r,t]=u.useState("initializing");let i=null,o=null;try{if(i=f.useConfig(),console.log("Config loaded:",i),i&&i.source)try{o=f.useElementData(i.source),console.log("Data loaded:",o?"Data present":"No data")}catch(a){console.error("Error loading data:",a),n(a)}}catch(a){console.error("Error loading config:",a),n(a)}u.useEffect(()=>{s?t("error"):i?o?(t("ready"),c(!1)):t("waiting for data"):t("waiting for config")},[s,i,o]);const d=()=>e.jsxs("div",{style:{position:"fixed",bottom:10,left:10,background:"rgba(0,0,0,0.8)",color:"white",padding:10,borderRadius:5,fontSize:12,zIndex:9999,maxWidth:"80%",overflow:"auto"},children:[e.jsxs("div",{children:["Plugin State: ",r]}),e.jsxs("div",{children:["Loading: ",l?"Yes":"No"]}),e.jsxs("div",{children:["Error: ",s?s.message:"None"]}),e.jsxs("div",{children:["Config Present: ",i?"Yes":"No"]}),e.jsxs("div",{children:["Config Details: ",JSON.stringify(i,null,2)]}),e.jsxs("div",{children:["Data Present: ",o?"Yes":"No"]}),e.jsxs("div",{children:["Data Sample: ",o&&i.dma?`${o[i.dma].length} rows`:"No data"]})]});return l?e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,textAlign:"center"},children:[e.jsx("h2",{children:"Loading Plugin..."}),e.jsxs("div",{children:["Current State: ",r]}),e.jsx(d,{})]}):s?e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,color:"#c62828",background:"#ffebee",textAlign:"center"},children:[e.jsx("h2",{children:"Error Loading Plugin"}),e.jsxs("pre",{style:{whiteSpace:"pre-wrap",maxWidth:"80%"},children:[s.message,s.stack]}),e.jsx(d,{})]}):e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx(N,{}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{children:"Plugin loaded successfully!"})}),e.jsx(d,{})]})}class w extends m.Component{constructor(n){super(n),this.state={hasError:!1,error:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,l){console.error("Error caught by boundary:",n),console.error("Error info:",l)}render(){var n;return this.state.hasError?e.jsxs("div",{style:{padding:20,color:"#c62828",background:"#ffebee"},children:[e.jsx("h2",{children:"Something went wrong"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap"},children:(n=this.state.error)==null?void 0:n.message})]}):this.props.children}}const g=document.getElementById("root");if(!g)console.error("Root element not found!");else{console.log("Initializing React app...");try{D.render(e.jsx(m.StrictMode,{children:e.jsx(w,{children:e.jsx(S,{})})}),g),console.log("React app initialized successfully")}catch(s){console.error("Failed to initialize React app:",s),g.innerHTML=`
      <div style="padding: 20px; color: #c62828; background: #ffebee">
        <h2>Failed to initialize application</h2>
        <pre>${s.message}</pre>
      </div>
    `}}
