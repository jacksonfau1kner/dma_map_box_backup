var bw=Object.defineProperty;var ww=(n,e,t)=>e in n?bw(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ne=(n,e,t)=>ww(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const u of s)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function t(s){const u={};return s.integrity&&(u.integrity=s.integrity),s.referrerPolicy&&(u.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?u.credentials="include":s.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(s){if(s.ep)return;s.ep=!0;const u=t(s);fetch(s.href,u)}})();function L2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var x5={exports:{}},I4={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var b5,Kd;function Oh(){if(Kd)return b5;Kd=1;var n=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;function r(u){if(u==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(u)}function s(){try{if(!Object.assign)return!1;var u=new String("abc");if(u[5]="de",Object.getOwnPropertyNames(u)[0]==="5")return!1;for(var f={},m=0;m<10;m++)f["_"+String.fromCharCode(m)]=m;var o=Object.getOwnPropertyNames(f).map(function(C){return f[C]});if(o.join("")!=="0123456789")return!1;var T={};return"abcdefghijklmnopqrst".split("").forEach(function(C){T[C]=C}),Object.keys(Object.assign({},T)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return b5=s()?Object.assign:function(u,f){for(var m,o=r(u),T,C=1;C<arguments.length;C++){m=Object(arguments[C]);for(var R in m)e.call(m,R)&&(o[R]=m[R]);if(n){T=n(m);for(var O=0;O<T.length;O++)t.call(m,T[O])&&(o[T[O]]=m[T[O]])}}return o},b5}var w5={exports:{}},pr={};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jd;function Tw(){if(Jd)return pr;Jd=1;var n=Oh(),e=60103,t=60106;pr.Fragment=60107,pr.StrictMode=60108,pr.Profiler=60114;var r=60109,s=60110,u=60112;pr.Suspense=60113;var f=60115,m=60116;if(typeof Symbol=="function"&&Symbol.for){var o=Symbol.for;e=o("react.element"),t=o("react.portal"),pr.Fragment=o("react.fragment"),pr.StrictMode=o("react.strict_mode"),pr.Profiler=o("react.profiler"),r=o("react.provider"),s=o("react.context"),u=o("react.forward_ref"),pr.Suspense=o("react.suspense"),f=o("react.memo"),m=o("react.lazy")}var T=typeof Symbol=="function"&&Symbol.iterator;function C(ce){return ce===null||typeof ce!="object"?null:(ce=T&&ce[T]||ce["@@iterator"],typeof ce=="function"?ce:null)}function R(ce){for(var ve="https://reactjs.org/docs/error-decoder.html?invariant="+ce,rt=1;rt<arguments.length;rt++)ve+="&args[]="+encodeURIComponent(arguments[rt]);return"Minified React error #"+ce+"; visit "+ve+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var O={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},U={};function V(ce,ve,rt){this.props=ce,this.context=ve,this.refs=U,this.updater=rt||O}V.prototype.isReactComponent={},V.prototype.setState=function(ce,ve){if(typeof ce!="object"&&typeof ce!="function"&&ce!=null)throw Error(R(85));this.updater.enqueueSetState(this,ce,ve,"setState")},V.prototype.forceUpdate=function(ce){this.updater.enqueueForceUpdate(this,ce,"forceUpdate")};function Y(){}Y.prototype=V.prototype;function ee(ce,ve,rt){this.props=ce,this.context=ve,this.refs=U,this.updater=rt||O}var le=ee.prototype=new Y;le.constructor=ee,n(le,V.prototype),le.isPureReactComponent=!0;var Ee={current:null},ue=Object.prototype.hasOwnProperty,_e={key:!0,ref:!0,__self:!0,__source:!0};function Me(ce,ve,rt){var at,Ne={},Be=null,ot=null;if(ve!=null)for(at in ve.ref!==void 0&&(ot=ve.ref),ve.key!==void 0&&(Be=""+ve.key),ve)ue.call(ve,at)&&!_e.hasOwnProperty(at)&&(Ne[at]=ve[at]);var Ft=arguments.length-2;if(Ft===1)Ne.children=rt;else if(1<Ft){for(var Dt=Array(Ft),vn=0;vn<Ft;vn++)Dt[vn]=arguments[vn+2];Ne.children=Dt}if(ce&&ce.defaultProps)for(at in Ft=ce.defaultProps,Ft)Ne[at]===void 0&&(Ne[at]=Ft[at]);return{$$typeof:e,type:ce,key:Be,ref:ot,props:Ne,_owner:Ee.current}}function Fe(ce,ve){return{$$typeof:e,type:ce.type,key:ve,ref:ce.ref,props:ce.props,_owner:ce._owner}}function yt(ce){return typeof ce=="object"&&ce!==null&&ce.$$typeof===e}function xt(ce){var ve={"=":"=0",":":"=2"};return"$"+ce.replace(/[=:]/g,function(rt){return ve[rt]})}var ht=/\/+/g;function kt(ce,ve){return typeof ce=="object"&&ce!==null&&ce.key!=null?xt(""+ce.key):ve.toString(36)}function Bt(ce,ve,rt,at,Ne){var Be=typeof ce;(Be==="undefined"||Be==="boolean")&&(ce=null);var ot=!1;if(ce===null)ot=!0;else switch(Be){case"string":case"number":ot=!0;break;case"object":switch(ce.$$typeof){case e:case t:ot=!0}}if(ot)return ot=ce,Ne=Ne(ot),ce=at===""?"."+kt(ot,0):at,Array.isArray(Ne)?(rt="",ce!=null&&(rt=ce.replace(ht,"$&/")+"/"),Bt(Ne,ve,rt,"",function(vn){return vn})):Ne!=null&&(yt(Ne)&&(Ne=Fe(Ne,rt+(!Ne.key||ot&&ot.key===Ne.key?"":(""+Ne.key).replace(ht,"$&/")+"/")+ce)),ve.push(Ne)),1;if(ot=0,at=at===""?".":at+":",Array.isArray(ce))for(var Ft=0;Ft<ce.length;Ft++){Be=ce[Ft];var Dt=at+kt(Be,Ft);ot+=Bt(Be,ve,rt,Dt,Ne)}else if(Dt=C(ce),typeof Dt=="function")for(ce=Dt.call(ce),Ft=0;!(Be=ce.next()).done;)Be=Be.value,Dt=at+kt(Be,Ft++),ot+=Bt(Be,ve,rt,Dt,Ne);else if(Be==="object")throw ve=""+ce,Error(R(31,ve==="[object Object]"?"object with keys {"+Object.keys(ce).join(", ")+"}":ve));return ot}function Vt(ce,ve,rt){if(ce==null)return ce;var at=[],Ne=0;return Bt(ce,at,"","",function(Be){return ve.call(rt,Be,Ne++)}),at}function $t(ce){if(ce._status===-1){var ve=ce._result;ve=ve(),ce._status=0,ce._result=ve,ve.then(function(rt){ce._status===0&&(rt=rt.default,ce._status=1,ce._result=rt)},function(rt){ce._status===0&&(ce._status=2,ce._result=rt)})}if(ce._status===1)return ce._result;throw ce._result}var Ct={current:null};function xn(){var ce=Ct.current;if(ce===null)throw Error(R(321));return ce}var Oe={ReactCurrentDispatcher:Ct,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:Ee,IsSomeRendererActing:{current:!1},assign:n};return pr.Children={map:Vt,forEach:function(ce,ve,rt){Vt(ce,function(){ve.apply(this,arguments)},rt)},count:function(ce){var ve=0;return Vt(ce,function(){ve++}),ve},toArray:function(ce){return Vt(ce,function(ve){return ve})||[]},only:function(ce){if(!yt(ce))throw Error(R(143));return ce}},pr.Component=V,pr.PureComponent=ee,pr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Oe,pr.cloneElement=function(ce,ve,rt){if(ce==null)throw Error(R(267,ce));var at=n({},ce.props),Ne=ce.key,Be=ce.ref,ot=ce._owner;if(ve!=null){if(ve.ref!==void 0&&(Be=ve.ref,ot=Ee.current),ve.key!==void 0&&(Ne=""+ve.key),ce.type&&ce.type.defaultProps)var Ft=ce.type.defaultProps;for(Dt in ve)ue.call(ve,Dt)&&!_e.hasOwnProperty(Dt)&&(at[Dt]=ve[Dt]===void 0&&Ft!==void 0?Ft[Dt]:ve[Dt])}var Dt=arguments.length-2;if(Dt===1)at.children=rt;else if(1<Dt){Ft=Array(Dt);for(var vn=0;vn<Dt;vn++)Ft[vn]=arguments[vn+2];at.children=Ft}return{$$typeof:e,type:ce.type,key:Ne,ref:Be,props:at,_owner:ot}},pr.createContext=function(ce,ve){return ve===void 0&&(ve=null),ce={$$typeof:s,_calculateChangedBits:ve,_currentValue:ce,_currentValue2:ce,_threadCount:0,Provider:null,Consumer:null},ce.Provider={$$typeof:r,_context:ce},ce.Consumer=ce},pr.createElement=Me,pr.createFactory=function(ce){var ve=Me.bind(null,ce);return ve.type=ce,ve},pr.createRef=function(){return{current:null}},pr.forwardRef=function(ce){return{$$typeof:u,render:ce}},pr.isValidElement=yt,pr.lazy=function(ce){return{$$typeof:m,_payload:{_status:-1,_result:ce},_init:$t}},pr.memo=function(ce,ve){return{$$typeof:f,type:ce,compare:ve===void 0?null:ve}},pr.useCallback=function(ce,ve){return xn().useCallback(ce,ve)},pr.useContext=function(ce,ve){return xn().useContext(ce,ve)},pr.useDebugValue=function(){},pr.useEffect=function(ce,ve){return xn().useEffect(ce,ve)},pr.useImperativeHandle=function(ce,ve,rt){return xn().useImperativeHandle(ce,ve,rt)},pr.useLayoutEffect=function(ce,ve){return xn().useLayoutEffect(ce,ve)},pr.useMemo=function(ce,ve){return xn().useMemo(ce,ve)},pr.useReducer=function(ce,ve,rt){return xn().useReducer(ce,ve,rt)},pr.useRef=function(ce){return xn().useRef(ce)},pr.useState=function(ce){return xn().useState(ce)},pr.version="17.0.2",pr}var Qd;function F2(){return Qd||(Qd=1,w5.exports=Tw()),w5.exports}/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ep;function Ew(){if(ep)return I4;ep=1,Oh();var n=F2(),e=60103;if(I4.Fragment=60107,typeof Symbol=="function"&&Symbol.for){var t=Symbol.for;e=t("react.element"),I4.Fragment=t("react.fragment")}var r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,u={key:!0,ref:!0,__self:!0,__source:!0};function f(m,o,T){var C,R={},O=null,U=null;T!==void 0&&(O=""+T),o.key!==void 0&&(O=""+o.key),o.ref!==void 0&&(U=o.ref);for(C in o)s.call(o,C)&&!u.hasOwnProperty(C)&&(R[C]=o[C]);if(m&&m.defaultProps)for(C in o=m.defaultProps,o)R[C]===void 0&&(R[C]=o[C]);return{$$typeof:e,type:m,key:O,ref:U,props:R,_owner:r.current}}return I4.jsx=f,I4.jsxs=f,I4}var tp;function ny(){return tp||(tp=1,x5.exports=Ew()),x5.exports}var Wn=ny(),lt=F2();const fc=L2(lt);var T5={exports:{}},ha={},E5={exports:{}},S5={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var np;function Sw(){return np||(np=1,function(n){var e,t,r,s;if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var f=Date,m=f.now();n.unstable_now=function(){return f.now()-m}}if(typeof window>"u"||typeof MessageChannel!="function"){var o=null,T=null,C=function(){if(o!==null)try{var Ne=n.unstable_now();o(!0,Ne),o=null}catch(Be){throw setTimeout(C,0),Be}};e=function(Ne){o!==null?setTimeout(e,0,Ne):(o=Ne,setTimeout(C,0))},t=function(Ne,Be){T=setTimeout(Ne,Be)},r=function(){clearTimeout(T)},n.unstable_shouldYield=function(){return!1},s=n.unstable_forceFrameRate=function(){}}else{var R=window.setTimeout,O=window.clearTimeout;if(typeof console<"u"){var U=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof U!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var V=!1,Y=null,ee=-1,le=5,Ee=0;n.unstable_shouldYield=function(){return n.unstable_now()>=Ee},s=function(){},n.unstable_forceFrameRate=function(Ne){0>Ne||125<Ne?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):le=0<Ne?Math.floor(1e3/Ne):5};var ue=new MessageChannel,_e=ue.port2;ue.port1.onmessage=function(){if(Y!==null){var Ne=n.unstable_now();Ee=Ne+le;try{Y(!0,Ne)?_e.postMessage(null):(V=!1,Y=null)}catch(Be){throw _e.postMessage(null),Be}}else V=!1},e=function(Ne){Y=Ne,V||(V=!0,_e.postMessage(null))},t=function(Ne,Be){ee=R(function(){Ne(n.unstable_now())},Be)},r=function(){O(ee),ee=-1}}function Me(Ne,Be){var ot=Ne.length;Ne.push(Be);e:for(;;){var Ft=ot-1>>>1,Dt=Ne[Ft];if(Dt!==void 0&&0<xt(Dt,Be))Ne[Ft]=Be,Ne[ot]=Dt,ot=Ft;else break e}}function Fe(Ne){return Ne=Ne[0],Ne===void 0?null:Ne}function yt(Ne){var Be=Ne[0];if(Be!==void 0){var ot=Ne.pop();if(ot!==Be){Ne[0]=ot;e:for(var Ft=0,Dt=Ne.length;Ft<Dt;){var vn=2*(Ft+1)-1,un=Ne[vn],fn=vn+1,yn=Ne[fn];if(un!==void 0&&0>xt(un,ot))yn!==void 0&&0>xt(yn,un)?(Ne[Ft]=yn,Ne[fn]=ot,Ft=fn):(Ne[Ft]=un,Ne[vn]=ot,Ft=vn);else if(yn!==void 0&&0>xt(yn,ot))Ne[Ft]=yn,Ne[fn]=ot,Ft=fn;else break e}}return Be}return null}function xt(Ne,Be){var ot=Ne.sortIndex-Be.sortIndex;return ot!==0?ot:Ne.id-Be.id}var ht=[],kt=[],Bt=1,Vt=null,$t=3,Ct=!1,xn=!1,Oe=!1;function ce(Ne){for(var Be=Fe(kt);Be!==null;){if(Be.callback===null)yt(kt);else if(Be.startTime<=Ne)yt(kt),Be.sortIndex=Be.expirationTime,Me(ht,Be);else break;Be=Fe(kt)}}function ve(Ne){if(Oe=!1,ce(Ne),!xn)if(Fe(ht)!==null)xn=!0,e(rt);else{var Be=Fe(kt);Be!==null&&t(ve,Be.startTime-Ne)}}function rt(Ne,Be){xn=!1,Oe&&(Oe=!1,r()),Ct=!0;var ot=$t;try{for(ce(Be),Vt=Fe(ht);Vt!==null&&(!(Vt.expirationTime>Be)||Ne&&!n.unstable_shouldYield());){var Ft=Vt.callback;if(typeof Ft=="function"){Vt.callback=null,$t=Vt.priorityLevel;var Dt=Ft(Vt.expirationTime<=Be);Be=n.unstable_now(),typeof Dt=="function"?Vt.callback=Dt:Vt===Fe(ht)&&yt(ht),ce(Be)}else yt(ht);Vt=Fe(ht)}if(Vt!==null)var vn=!0;else{var un=Fe(kt);un!==null&&t(ve,un.startTime-Be),vn=!1}return vn}finally{Vt=null,$t=ot,Ct=!1}}var at=s;n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ne){Ne.callback=null},n.unstable_continueExecution=function(){xn||Ct||(xn=!0,e(rt))},n.unstable_getCurrentPriorityLevel=function(){return $t},n.unstable_getFirstCallbackNode=function(){return Fe(ht)},n.unstable_next=function(Ne){switch($t){case 1:case 2:case 3:var Be=3;break;default:Be=$t}var ot=$t;$t=Be;try{return Ne()}finally{$t=ot}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=at,n.unstable_runWithPriority=function(Ne,Be){switch(Ne){case 1:case 2:case 3:case 4:case 5:break;default:Ne=3}var ot=$t;$t=Ne;try{return Be()}finally{$t=ot}},n.unstable_scheduleCallback=function(Ne,Be,ot){var Ft=n.unstable_now();switch(typeof ot=="object"&&ot!==null?(ot=ot.delay,ot=typeof ot=="number"&&0<ot?Ft+ot:Ft):ot=Ft,Ne){case 1:var Dt=-1;break;case 2:Dt=250;break;case 5:Dt=1073741823;break;case 4:Dt=1e4;break;default:Dt=5e3}return Dt=ot+Dt,Ne={id:Bt++,callback:Be,priorityLevel:Ne,startTime:ot,expirationTime:Dt,sortIndex:-1},ot>Ft?(Ne.sortIndex=ot,Me(kt,Ne),Fe(ht)===null&&Ne===Fe(kt)&&(Oe?r():Oe=!0,t(ve,ot-Ft))):(Ne.sortIndex=Dt,Me(ht,Ne),xn||Ct||(xn=!0,e(rt))),Ne},n.unstable_wrapCallback=function(Ne){var Be=$t;return function(){var ot=$t;$t=Be;try{return Ne.apply(this,arguments)}finally{$t=ot}}}}(S5)),S5}var rp;function Aw(){return rp||(rp=1,E5.exports=Sw()),E5.exports}/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ip;function Cw(){if(ip)return ha;ip=1;var n=F2(),e=Oh(),t=Aw();function r(d){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+d,w=1;w<arguments.length;w++)_+="&args[]="+encodeURIComponent(arguments[w]);return"Minified React error #"+d+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!n)throw Error(r(227));var s=new Set,u={};function f(d,_){m(d,_),m(d+"Capture",_)}function m(d,_){for(u[d]=_,d=0;d<_.length;d++)s.add(_[d])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),T=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C=Object.prototype.hasOwnProperty,R={},O={};function U(d){return C.call(O,d)?!0:C.call(R,d)?!1:T.test(d)?O[d]=!0:(R[d]=!0,!1)}function V(d,_,w,k){if(w!==null&&w.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return k?!1:w!==null?!w.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function Y(d,_,w,k){if(_===null||typeof _>"u"||V(d,_,w,k))return!0;if(k)return!1;if(w!==null)switch(w.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function ee(d,_,w,k,z,Z,te){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=k,this.attributeNamespace=z,this.mustUseProperty=w,this.propertyName=d,this.type=_,this.sanitizeURL=Z,this.removeEmptyString=te}var le={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){le[d]=new ee(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var _=d[0];le[_]=new ee(_,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){le[d]=new ee(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){le[d]=new ee(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){le[d]=new ee(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){le[d]=new ee(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){le[d]=new ee(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){le[d]=new ee(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){le[d]=new ee(d,5,!1,d.toLowerCase(),null,!1,!1)});var Ee=/[\-:]([a-z])/g;function ue(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var _=d.replace(Ee,ue);le[_]=new ee(_,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var _=d.replace(Ee,ue);le[_]=new ee(_,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var _=d.replace(Ee,ue);le[_]=new ee(_,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){le[d]=new ee(d,1,!1,d.toLowerCase(),null,!1,!1)}),le.xlinkHref=new ee("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){le[d]=new ee(d,1,!1,d.toLowerCase(),null,!0,!0)});function _e(d,_,w,k){var z=le.hasOwnProperty(_)?le[_]:null,Z=z!==null?z.type===0:k?!1:!(!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N");Z||(Y(_,w,z,k)&&(w=null),k||z===null?U(_)&&(w===null?d.removeAttribute(_):d.setAttribute(_,""+w)):z.mustUseProperty?d[z.propertyName]=w===null?z.type===3?!1:"":w:(_=z.attributeName,k=z.attributeNamespace,w===null?d.removeAttribute(_):(z=z.type,w=z===3||z===4&&w===!0?"":""+w,k?d.setAttributeNS(k,_,w):d.setAttribute(_,w))))}var Me=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Fe=60103,yt=60106,xt=60107,ht=60108,kt=60114,Bt=60109,Vt=60110,$t=60112,Ct=60113,xn=60120,Oe=60115,ce=60116,ve=60121,rt=60128,at=60129,Ne=60130,Be=60131;if(typeof Symbol=="function"&&Symbol.for){var ot=Symbol.for;Fe=ot("react.element"),yt=ot("react.portal"),xt=ot("react.fragment"),ht=ot("react.strict_mode"),kt=ot("react.profiler"),Bt=ot("react.provider"),Vt=ot("react.context"),$t=ot("react.forward_ref"),Ct=ot("react.suspense"),xn=ot("react.suspense_list"),Oe=ot("react.memo"),ce=ot("react.lazy"),ve=ot("react.block"),ot("react.scope"),rt=ot("react.opaque.id"),at=ot("react.debug_trace_mode"),Ne=ot("react.offscreen"),Be=ot("react.legacy_hidden")}var Ft=typeof Symbol=="function"&&Symbol.iterator;function Dt(d){return d===null||typeof d!="object"?null:(d=Ft&&d[Ft]||d["@@iterator"],typeof d=="function"?d:null)}var vn;function un(d){if(vn===void 0)try{throw Error()}catch(w){var _=w.stack.trim().match(/\n( *(at )?)/);vn=_&&_[1]||""}return`
`+vn+d}var fn=!1;function yn(d,_){if(!d||fn)return"";fn=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(ze){var k=ze}Reflect.construct(d,[],_)}else{try{_.call()}catch(ze){k=ze}d.call(_.prototype)}else{try{throw Error()}catch(ze){k=ze}d()}}catch(ze){if(ze&&k&&typeof ze.stack=="string"){for(var z=ze.stack.split(`
`),Z=k.stack.split(`
`),te=z.length-1,xe=Z.length-1;1<=te&&0<=xe&&z[te]!==Z[xe];)xe--;for(;1<=te&&0<=xe;te--,xe--)if(z[te]!==Z[xe]){if(te!==1||xe!==1)do if(te--,xe--,0>xe||z[te]!==Z[xe])return`
`+z[te].replace(" at new "," at ");while(1<=te&&0<=xe);break}}}finally{fn=!1,Error.prepareStackTrace=w}return(d=d?d.displayName||d.name:"")?un(d):""}function Tn(d){switch(d.tag){case 5:return un(d.type);case 16:return un("Lazy");case 13:return un("Suspense");case 19:return un("SuspenseList");case 0:case 2:case 15:return d=yn(d.type,!1),d;case 11:return d=yn(d.type.render,!1),d;case 22:return d=yn(d.type._render,!1),d;case 1:return d=yn(d.type,!0),d;default:return""}}function Qr(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case xt:return"Fragment";case yt:return"Portal";case kt:return"Profiler";case ht:return"StrictMode";case Ct:return"Suspense";case xn:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case Vt:return(d.displayName||"Context")+".Consumer";case Bt:return(d._context.displayName||"Context")+".Provider";case $t:var _=d.render;return _=_.displayName||_.name||"",d.displayName||(_!==""?"ForwardRef("+_+")":"ForwardRef");case Oe:return Qr(d.type);case ve:return Qr(d._render);case ce:_=d._payload,d=d._init;try{return Qr(d(_))}catch{}}return null}function Or(d){switch(typeof d){case"boolean":case"number":case"object":case"string":case"undefined":return d;default:return""}}function as(d){var _=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function Xi(d){var _=as(d)?"checked":"value",w=Object.getOwnPropertyDescriptor(d.constructor.prototype,_),k=""+d[_];if(!d.hasOwnProperty(_)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var z=w.get,Z=w.set;return Object.defineProperty(d,_,{configurable:!0,get:function(){return z.call(this)},set:function(te){k=""+te,Z.call(this,te)}}),Object.defineProperty(d,_,{enumerable:w.enumerable}),{getValue:function(){return k},setValue:function(te){k=""+te},stopTracking:function(){d._valueTracker=null,delete d[_]}}}}function Ht(d){d._valueTracker||(d._valueTracker=Xi(d))}function pn(d){if(!d)return!1;var _=d._valueTracker;if(!_)return!0;var w=_.getValue(),k="";return d&&(k=as(d)?d.checked?"true":"false":d.value),d=k,d!==w?(_.setValue(d),!0):!1}function hi(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function xo(d,_){var w=_.checked;return e({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:w??d._wrapperState.initialChecked})}function Vo(d,_){var w=_.defaultValue==null?"":_.defaultValue,k=_.checked!=null?_.checked:_.defaultChecked;w=Or(_.value!=null?_.value:w),d._wrapperState={initialChecked:k,initialValue:w,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function to(d,_){_=_.checked,_!=null&&_e(d,"checked",_,!1)}function En(d,_){to(d,_);var w=Or(_.value),k=_.type;if(w!=null)k==="number"?(w===0&&d.value===""||d.value!=w)&&(d.value=""+w):d.value!==""+w&&(d.value=""+w);else if(k==="submit"||k==="reset"){d.removeAttribute("value");return}_.hasOwnProperty("value")?_s(d,_.type,w):_.hasOwnProperty("defaultValue")&&_s(d,_.type,Or(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(d.defaultChecked=!!_.defaultChecked)}function no(d,_,w){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var k=_.type;if(!(k!=="submit"&&k!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+d._wrapperState.initialValue,w||_===d.value||(d.value=_),d.defaultValue=_}w=d.name,w!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,w!==""&&(d.name=w)}function _s(d,_,w){(_!=="number"||hi(d.ownerDocument)!==d)&&(w==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+w&&(d.defaultValue=""+w))}function jo(d){var _="";return n.Children.forEach(d,function(w){w!=null&&(_+=w)}),_}function bo(d,_){return d=e({children:void 0},_),(_=jo(_.children))&&(d.children=_),d}function ur(d,_,w,k){if(d=d.options,_){_={};for(var z=0;z<w.length;z++)_["$"+w[z]]=!0;for(w=0;w<d.length;w++)z=_.hasOwnProperty("$"+d[w].value),d[w].selected!==z&&(d[w].selected=z),z&&k&&(d[w].defaultSelected=!0)}else{for(w=""+Or(w),_=null,z=0;z<d.length;z++){if(d[z].value===w){d[z].selected=!0,k&&(d[z].defaultSelected=!0);return}_!==null||d[z].disabled||(_=d[z])}_!==null&&(_.selected=!0)}}function wo(d,_){if(_.dangerouslySetInnerHTML!=null)throw Error(r(91));return e({},_,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function $o(d,_){var w=_.value;if(w==null){if(w=_.children,_=_.defaultValue,w!=null){if(_!=null)throw Error(r(92));if(Array.isArray(w)){if(!(1>=w.length))throw Error(r(93));w=w[0]}_=w}_==null&&(_=""),w=_}d._wrapperState={initialValue:Or(w)}}function Wo(d,_){var w=Or(_.value),k=Or(_.defaultValue);w!=null&&(w=""+w,w!==d.value&&(d.value=w),_.defaultValue==null&&d.defaultValue!==w&&(d.defaultValue=w)),k!=null&&(d.defaultValue=""+k)}function Mi(d){var _=d.textContent;_===d._wrapperState.initialValue&&_!==""&&_!==null&&(d.value=_)}var ro={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function io(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function To(d,_){return d==null||d==="http://www.w3.org/1999/xhtml"?io(_):d==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var ys,Ho=function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,w,k,z){MSApp.execUnsafeLocalFunction(function(){return d(_,w,k,z)})}:d}(function(d,_){if(d.namespaceURI!==ro.svg||"innerHTML"in d)d.innerHTML=_;else{for(ys=ys||document.createElement("div"),ys.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=ys.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;_.firstChild;)d.appendChild(_.firstChild)}});function fi(d,_){if(_){var w=d.firstChild;if(w&&w===d.lastChild&&w.nodeType===3){w.nodeValue=_;return}}d.textContent=_}var Eo={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},gr=["Webkit","ms","Moz","O"];Object.keys(Eo).forEach(function(d){gr.forEach(function(_){_=_+d.charAt(0).toUpperCase()+d.substring(1),Eo[_]=Eo[d]})});function Zi(d,_,w){return _==null||typeof _=="boolean"||_===""?"":w||typeof _!="number"||_===0||Eo.hasOwnProperty(d)&&Eo[d]?(""+_).trim():_+"px"}function Xo(d,_){d=d.style;for(var w in _)if(_.hasOwnProperty(w)){var k=w.indexOf("--")===0,z=Zi(w,_[w],k);w==="float"&&(w="cssFloat"),k?d.setProperty(w,z):d[w]=z}}var vs=e({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function so(d,_){if(_){if(vs[d]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(r(137,d));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(r(60));if(!(typeof _.dangerouslySetInnerHTML=="object"&&"__html"in _.dangerouslySetInnerHTML))throw Error(r(61))}if(_.style!=null&&typeof _.style!="object")throw Error(r(62))}}function xs(d,_){if(d.indexOf("-")===-1)return typeof _.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function bs(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var qi=null,Gi=null,ii=null;function Zo(d){if(d=e1(d)){if(typeof qi!="function")throw Error(r(280));var _=d.stateNode;_&&(_=ll(_),qi(d.stateNode,d.type,_))}}function Ri(d){Gi?ii?ii.push(d):ii=[d]:Gi=d}function de(){if(Gi){var d=Gi,_=ii;if(ii=Gi=null,Zo(d),_)for(d=0;d<_.length;d++)Zo(_[d])}}function W(d,_){return d(_)}function G(d,_,w,k,z){return d(_,w,k,z)}function he(){}var ye=W,Re=!1,$e=!1;function Ve(){(Gi!==null||ii!==null)&&(he(),de())}function Le(d,_,w){if($e)return d(_,w);$e=!0;try{return ye(d,_,w)}finally{$e=!1,Ve()}}function Ye(d,_){var w=d.stateNode;if(w===null)return null;var k=ll(w);if(k===null)return null;w=k[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(k=!k.disabled)||(d=d.type,k=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!k;break e;default:d=!1}if(d)return null;if(w&&typeof w!="function")throw Error(r(231,_,typeof w));return w}var ft=!1;if(o)try{var _t={};Object.defineProperty(_t,"passive",{get:function(){ft=!0}}),window.addEventListener("test",_t,_t),window.removeEventListener("test",_t,_t)}catch{ft=!1}function Tt(d,_,w,k,z,Z,te,xe,ze){var ct=Array.prototype.slice.call(arguments,3);try{_.apply(w,ct)}catch(Qt){this.onError(Qt)}}var qt=!1,Kt=null,tn=!1,on=null,Sn={onError:function(d){qt=!0,Kt=d}};function ir(d,_,w,k,z,Z,te,xe,ze){qt=!1,Kt=null,Tt.apply(Sn,arguments)}function yr(d,_,w,k,z,Z,te,xe,ze){if(ir.apply(this,arguments),qt){if(qt){var ct=Kt;qt=!1,Kt=null}else throw Error(r(198));tn||(tn=!0,on=ct)}}function Xn(d){var _=d,w=d;if(d.alternate)for(;_.return;)_=_.return;else{d=_;do _=d,_.flags&1026&&(w=_.return),d=_.return;while(d)}return _.tag===3?w:null}function sr(d){if(d.tag===13){var _=d.memoizedState;if(_===null&&(d=d.alternate,d!==null&&(_=d.memoizedState)),_!==null)return _.dehydrated}return null}function $r(d){if(Xn(d)!==d)throw Error(r(188))}function ki(d){var _=d.alternate;if(!_){if(_=Xn(d),_===null)throw Error(r(188));return _!==d?null:d}for(var w=d,k=_;;){var z=w.return;if(z===null)break;var Z=z.alternate;if(Z===null){if(k=z.return,k!==null){w=k;continue}break}if(z.child===Z.child){for(Z=z.child;Z;){if(Z===w)return $r(z),d;if(Z===k)return $r(z),_;Z=Z.sibling}throw Error(r(188))}if(w.return!==k.return)w=z,k=Z;else{for(var te=!1,xe=z.child;xe;){if(xe===w){te=!0,w=z,k=Z;break}if(xe===k){te=!0,k=z,w=Z;break}xe=xe.sibling}if(!te){for(xe=Z.child;xe;){if(xe===w){te=!0,w=Z,k=z;break}if(xe===k){te=!0,k=Z,w=z;break}xe=xe.sibling}if(!te)throw Error(r(189))}}if(w.alternate!==k)throw Error(r(190))}if(w.tag!==3)throw Error(r(188));return w.stateNode.current===w?d:_}function br(d){if(d=ki(d),!d)return null;for(var _=d;;){if(_.tag===5||_.tag===6)return _;if(_.child)_.child.return=_,_=_.child;else{if(_===d)break;for(;!_.sibling;){if(!_.return||_.return===d)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}}return null}function Zr(d,_){for(var w=d.alternate;_!==null;){if(_===d||_===w)return!0;_=_.return}return!1}var oo,Yi,ls,qo,ga=!1,di=[],Nr=null,Ei=null,cs=null,si=new Map,ws=new Map,pi=[],Xa="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ts(d,_,w,k,z){return{blockedOn:d,domEventName:_,eventSystemFlags:w|16,nativeEvent:z,targetContainers:[k]}}function Go(d,_){switch(d){case"focusin":case"focusout":Nr=null;break;case"dragenter":case"dragleave":Ei=null;break;case"mouseover":case"mouseout":cs=null;break;case"pointerover":case"pointerout":si.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":ws.delete(_.pointerId)}}function Es(d,_,w,k,z,Z){return d===null||d.nativeEvent!==Z?(d=Ts(_,w,k,z,Z),_!==null&&(_=e1(_),_!==null&&Yi(_)),d):(d.eventSystemFlags|=k,_=d.targetContainers,z!==null&&_.indexOf(z)===-1&&_.push(z),d)}function Yo(d,_,w,k,z){switch(_){case"focusin":return Nr=Es(Nr,d,_,w,k,z),!0;case"dragenter":return Ei=Es(Ei,d,_,w,k,z),!0;case"mouseover":return cs=Es(cs,d,_,w,k,z),!0;case"pointerover":var Z=z.pointerId;return si.set(Z,Es(si.get(Z)||null,d,_,w,k,z)),!0;case"gotpointercapture":return Z=z.pointerId,ws.set(Z,Es(ws.get(Z)||null,d,_,w,k,z)),!0}return!1}function S1(d){var _=ra(d.target);if(_!==null){var w=Xn(_);if(w!==null){if(_=w.tag,_===13){if(_=sr(w),_!==null){d.blockedOn=_,qo(d.lanePriority,function(){t.unstable_runWithPriority(d.priority,function(){ls(w)})});return}}else if(_===3&&w.stateNode.hydrate){d.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Za(d){if(d.blockedOn!==null)return!1;for(var _=d.targetContainers;0<_.length;){var w=Ga(d.domEventName,d.eventSystemFlags,_[0],d.nativeEvent);if(w!==null)return _=e1(w),_!==null&&Yi(_),d.blockedOn=w,!1;_.shift()}return!0}function qa(d,_,w){Za(d)&&w.delete(_)}function Q(){for(ga=!1;0<di.length;){var d=di[0];if(d.blockedOn!==null){d=e1(d.blockedOn),d!==null&&oo(d);break}for(var _=d.targetContainers;0<_.length;){var w=Ga(d.domEventName,d.eventSystemFlags,_[0],d.nativeEvent);if(w!==null){d.blockedOn=w;break}_.shift()}d.blockedOn===null&&di.shift()}Nr!==null&&Za(Nr)&&(Nr=null),Ei!==null&&Za(Ei)&&(Ei=null),cs!==null&&Za(cs)&&(cs=null),si.forEach(qa),ws.forEach(qa)}function fe(d,_){d.blockedOn===_&&(d.blockedOn=null,ga||(ga=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Q)))}function ke(d){function _(z){return fe(z,d)}if(0<di.length){fe(di[0],d);for(var w=1;w<di.length;w++){var k=di[w];k.blockedOn===d&&(k.blockedOn=null)}}for(Nr!==null&&fe(Nr,d),Ei!==null&&fe(Ei,d),cs!==null&&fe(cs,d),si.forEach(_),ws.forEach(_),w=0;w<pi.length;w++)k=pi[w],k.blockedOn===d&&(k.blockedOn=null);for(;0<pi.length&&(w=pi[0],w.blockedOn===null);)S1(w),w.blockedOn===null&&pi.shift()}function ge(d,_){var w={};return w[d.toLowerCase()]=_.toLowerCase(),w["Webkit"+d]="webkit"+_,w["Moz"+d]="moz"+_,w}var He={animationend:ge("Animation","AnimationEnd"),animationiteration:ge("Animation","AnimationIteration"),animationstart:ge("Animation","AnimationStart"),transitionend:ge("Transition","TransitionEnd")},Jt={},bn={};o&&(bn=document.createElement("div").style,"AnimationEvent"in window||(delete He.animationend.animation,delete He.animationiteration.animation,delete He.animationstart.animation),"TransitionEvent"in window||delete He.transitionend.transition);function Pn(d){if(Jt[d])return Jt[d];if(!He[d])return d;var _=He[d],w;for(w in _)if(_.hasOwnProperty(w)&&w in bn)return Jt[d]=_[w];return d}var vr=Pn("animationend"),wr=Pn("animationiteration"),Oi=Pn("animationstart"),Ko=Pn("transitionend"),Wt=new Map,zn=new Map,Fn=["abort","abort",vr,"animationEnd",wr,"animationIteration",Oi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Ko,"transitionEnd","waiting","waiting"];function Ns(d,_){for(var w=0;w<d.length;w+=2){var k=d[w],z=d[w+1];z="on"+(z[0].toUpperCase()+z.slice(1)),zn.set(k,_),Wt.set(k,z),f(z,[k])}}var Bl=t.unstable_now;Bl();var rn=8;function So(d){if(1&d)return rn=15,1;if(2&d)return rn=14,2;if(4&d)return rn=13,4;var _=24&d;return _!==0?(rn=12,_):d&32?(rn=11,32):(_=192&d,_!==0?(rn=10,_):d&256?(rn=9,256):(_=3584&d,_!==0?(rn=8,_):d&4096?(rn=7,4096):(_=4186112&d,_!==0?(rn=6,_):(_=62914560&d,_!==0?(rn=5,_):d&67108864?(rn=4,67108864):d&134217728?(rn=3,134217728):(_=805306368&d,_!==0?(rn=2,_):1073741824&d?(rn=1,1073741824):(rn=8,d))))))}function _a(d){switch(d){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function A1(d){switch(d){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(r(358,d))}}function Di(d,_){var w=d.pendingLanes;if(w===0)return rn=0;var k=0,z=0,Z=d.expiredLanes,te=d.suspendedLanes,xe=d.pingedLanes;if(Z!==0)k=Z,z=rn=15;else if(Z=w&134217727,Z!==0){var ze=Z&~te;ze!==0?(k=So(ze),z=rn):(xe&=Z,xe!==0&&(k=So(xe),z=rn))}else Z=w&~te,Z!==0?(k=So(Z),z=rn):xe!==0&&(k=So(xe),z=rn);if(k===0)return 0;if(k=31-Ss(k),k=w&((0>k?0:1<<k)<<1)-1,_!==0&&_!==k&&!(_&te)){if(So(_),z<=rn)return _;rn=z}if(_=d.entangledLanes,_!==0)for(d=d.entanglements,_&=k;0<_;)w=31-Ss(_),z=1<<w,k|=d[w],_&=~z;return k}function Ir(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function Ec(d,_){switch(d){case 15:return 1;case 14:return 2;case 12:return d=oi(24&~_),d===0?Ec(10,_):d;case 10:return d=oi(192&~_),d===0?Ec(8,_):d;case 8:return d=oi(3584&~_),d===0&&(d=oi(4186112&~_),d===0&&(d=512)),d;case 2:return _=oi(805306368&~_),_===0&&(_=268435456),_}throw Error(r(358,d))}function oi(d){return d&-d}function zl(d){for(var _=[],w=0;31>w;w++)_.push(d);return _}function Jo(d,_,w){d.pendingLanes|=_;var k=_-1;d.suspendedLanes&=k,d.pingedLanes&=k,d=d.eventTimes,_=31-Ss(_),d[_]=w}var Ss=Math.clz32?Math.clz32:Sc,Ul=Math.log,Gn=Math.LN2;function Sc(d){return d===0?32:31-(Ul(d)/Gn|0)|0}var k3=t.unstable_UserBlockingPriority,An=t.unstable_runWithPriority,Ki=!0;function H0(d,_,w,k){Re||he();var z=Br,Z=Re;Re=!0;try{G(z,d,_,w,k)}finally{(Re=Z)||Ve()}}function Ac(d,_,w,k){An(k3,Br.bind(null,d,_,w,k))}function Br(d,_,w,k){if(Ki){var z;if((z=(_&4)===0)&&0<di.length&&-1<Xa.indexOf(d))d=Ts(null,d,_,w,k),di.push(d);else{var Z=Ga(d,_,w,k);if(Z===null)z&&Go(d,k);else{if(z){if(-1<Xa.indexOf(d)){d=Ts(Z,d,_,w,k),di.push(d);return}if(Yo(Z,d,_,w,k))return;Go(d,k)}Gl(d,_,k,null,w)}}}}function Ga(d,_,w,k){var z=bs(k);if(z=ra(z),z!==null){var Z=Xn(z);if(Z===null)z=null;else{var te=Z.tag;if(te===13){if(z=sr(Z),z!==null)return z;z=null}else if(te===3){if(Z.stateNode.hydrate)return Z.tag===3?Z.stateNode.containerInfo:null;z=null}else Z!==z&&(z=null)}}return Gl(d,_,k,z,w),null}var Ji=null,ei=null,Ya=null;function As(){if(Ya)return Ya;var d,_=ei,w=_.length,k,z="value"in Ji?Ji.value:Ji.textContent,Z=z.length;for(d=0;d<w&&_[d]===z[d];d++);var te=w-d;for(k=1;k<=te&&_[w-k]===z[Z-k];k++);return Ya=z.slice(d,1<k?1-k:void 0)}function Cs(d){var _=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&_===13&&(d=13)):d=_,d===10&&(d=13),32<=d||d===13?d:0}function Ao(){return!0}function X0(){return!1}function Wr(d){function _(w,k,z,Z,te){this._reactName=w,this._targetInst=z,this.type=k,this.nativeEvent=Z,this.target=te,this.currentTarget=null;for(var xe in d)d.hasOwnProperty(xe)&&(w=d[xe],this[xe]=w?w(Z):Z[xe]);return this.isDefaultPrevented=(Z.defaultPrevented!=null?Z.defaultPrevented:Z.returnValue===!1)?Ao:X0,this.isPropagationStopped=X0,this}return e(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=Ao)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=Ao)},persist:function(){},isPersistent:Ao}),_}var Ka={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cc=Wr(Ka),Si=e({},Ka,{view:0,detail:0}),C1=Wr(Si),Co,Vl,Qo,P1=e({},Si,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qa,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==Qo&&(Qo&&d.type==="mousemove"?(Co=d.screenX-Qo.screenX,Vl=d.screenY-Qo.screenY):Vl=Co=0,Qo=d),Co)},movementY:function(d){return"movementY"in d?d.movementY:Vl}}),O3=Wr(P1),D3=e({},P1,{dataTransfer:0}),Z0=Wr(D3),L3=e({},Si,{relatedTarget:0}),F3=Wr(L3),q0=e({},Ka,{animationName:0,elapsedTime:0,pseudoElement:0}),du=Wr(q0),N3=e({},Ka,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),G0=Wr(N3),B3=e({},Ka,{data:0}),z3=Wr(B3),Y0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ja={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function I1(d){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(d):(d=jl[d])?!!_[d]:!1}function Qa(){return I1}var Pc=e({},Si,{key:function(d){if(d.key){var _=Y0[d.key]||d.key;if(_!=="Unidentified")return _}return d.type==="keypress"?(d=Cs(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Ja[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qa,charCode:function(d){return d.type==="keypress"?Cs(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?Cs(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),Ic=Wr(Pc),Mc=e({},P1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$l=Wr(Mc),M1=e({},Si,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qa}),rr=Wr(M1),Rc=e({},Ka,{propertyName:0,elapsedTime:0,pseudoElement:0}),K0=Wr(Rc),R1=e({},P1,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),U3=Wr(R1),kc=[9,13,27,32],Oc=o&&"CompositionEvent"in window,k1=null;o&&"documentMode"in document&&(k1=document.documentMode);var pu=o&&"TextEvent"in window&&!k1,O1=o&&(!Oc||k1&&8<k1&&11>=k1),D1=" ",L1=!1;function Wl(d,_){switch(d){case"keyup":return kc.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function V3(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var el=!1;function mu(d,_){switch(d){case"compositionend":return V3(_);case"keypress":return _.which!==32?null:(L1=!0,D1);case"textInput":return d=_.data,d===D1&&L1?null:d;default:return null}}function F1(d,_){if(el)return d==="compositionend"||!Oc&&Wl(d,_)?(d=As(),Ya=ei=Ji=null,el=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return O1&&_.locale!=="ko"?null:_.data;default:return null}}var N1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function j3(d){var _=d&&d.nodeName&&d.nodeName.toLowerCase();return _==="input"?!!N1[d.type]:_==="textarea"}function Qi(d,_,w,k){Ri(k),_=Yl(_,"onChange"),0<_.length&&(w=new Cc("onChange","change",null,w,k),d.push({event:w,listeners:_}))}var ya=null,ao=null;function Dc(d){V1(d,0)}function Hl(d){var _=al(d);if(pn(_))return d}function $3(d,_){if(d==="change")return _}var Bs=!1;if(o){var Xl;if(o){var Po="oninput"in document;if(!Po){var Zl=document.createElement("div");Zl.setAttribute("oninput","return;"),Po=typeof Zl.oninput=="function"}Xl=Po}else Xl=!1;Bs=Xl&&(!document.documentMode||9<document.documentMode)}function W3(){ya&&(ya.detachEvent("onpropertychange",B1),ao=ya=null)}function B1(d){if(d.propertyName==="value"&&Hl(ao)){var _=[];if(Qi(_,ao,d,bs(d)),d=Dc,Re)d(_);else{Re=!0;try{W(d,_)}finally{Re=!1,Ve()}}}}function va(d,_,w){d==="focusin"?(W3(),ya=_,ao=w,ya.attachEvent("onpropertychange",B1)):d==="focusout"&&W3()}function J0(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Hl(ao)}function H3(d,_){if(d==="click")return Hl(_)}function X3(d,_){if(d==="input"||d==="change")return Hl(_)}function Q0(d,_){return d===_&&(d!==0||1/d===1/_)||d!==d&&_!==_}var us=typeof Object.is=="function"?Object.is:Q0,e4=Object.prototype.hasOwnProperty;function xa(d,_){if(us(d,_))return!0;if(typeof d!="object"||d===null||typeof _!="object"||_===null)return!1;var w=Object.keys(d),k=Object.keys(_);if(w.length!==k.length)return!1;for(k=0;k<w.length;k++)if(!e4.call(_,w[k])||!us(d[w[k]],_[w[k]]))return!1;return!0}function z1(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function zs(d,_){var w=z1(d);d=0;for(var k;w;){if(w.nodeType===3){if(k=d+w.textContent.length,d<=_&&k>=_)return{node:w,offset:_-d};d=k}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=z1(w)}}function Lc(d,_){return d&&_?d===_?!0:d&&d.nodeType===3?!1:_&&_.nodeType===3?Lc(d,_.parentNode):"contains"in d?d.contains(_):d.compareDocumentPosition?!!(d.compareDocumentPosition(_)&16):!1:!1}function Fc(){for(var d=window,_=hi();_ instanceof d.HTMLIFrameElement;){try{var w=typeof _.contentWindow.location.href=="string"}catch{w=!1}if(w)d=_.contentWindow;else break;_=hi(d.document)}return _}function tl(d){var _=d&&d.nodeName&&d.nodeName.toLowerCase();return _&&(_==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||_==="textarea"||d.contentEditable==="true")}var ba=o&&"documentMode"in document&&11>=document.documentMode,nl=null,lo=null,Io=null,Nc=!1;function Bc(d,_,w){var k=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;Nc||nl==null||nl!==hi(k)||(k=nl,"selectionStart"in k&&tl(k)?k={start:k.selectionStart,end:k.selectionEnd}:(k=(k.ownerDocument&&k.ownerDocument.defaultView||window).getSelection(),k={anchorNode:k.anchorNode,anchorOffset:k.anchorOffset,focusNode:k.focusNode,focusOffset:k.focusOffset}),Io&&xa(Io,k)||(Io=k,k=Yl(lo,"onSelect"),0<k.length&&(_=new Cc("onSelect","select",null,_,w),d.push({event:_,listeners:k}),_.target=nl)))}Ns("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Ns("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Ns(Fn,2);for(var Kn="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),ql=0;ql<Kn.length;ql++)zn.set(Kn[ql],0);m("onMouseEnter",["mouseout","mouseover"]),m("onMouseLeave",["mouseout","mouseover"]),m("onPointerEnter",["pointerout","pointerover"]),m("onPointerLeave",["pointerout","pointerover"]),f("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),f("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),f("onBeforeInput",["compositionend","keypress","textInput","paste"]),f("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),f("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),f("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),U1=new Set("cancel close invalid load scroll toggle".split(" ").concat(wa));function mi(d,_,w){var k=d.type||"unknown-event";d.currentTarget=w,yr(k,_,void 0,d),d.currentTarget=null}function V1(d,_){_=(_&4)!==0;for(var w=0;w<d.length;w++){var k=d[w],z=k.event;k=k.listeners;e:{var Z=void 0;if(_)for(var te=k.length-1;0<=te;te--){var xe=k[te],ze=xe.instance,ct=xe.currentTarget;if(xe=xe.listener,ze!==Z&&z.isPropagationStopped())break e;mi(z,xe,ct),Z=ze}else for(te=0;te<k.length;te++){if(xe=k[te],ze=xe.instance,ct=xe.currentTarget,xe=xe.listener,ze!==Z&&z.isPropagationStopped())break e;mi(z,xe,ct),Z=ze}}}if(tn)throw d=on,tn=!1,on=null,d}function Mr(d,_){var w=Vc(_),k=d+"__bubble";w.has(k)||(rl(_,d,2,!1),w.add(k))}var Z3="_reactListening"+Math.random().toString(36).slice(2);function t4(d){d[Z3]||(d[Z3]=!0,s.forEach(function(_){U1.has(_)||zc(_,!1,d,null),zc(_,!0,d,null)}))}function zc(d,_,w,k){var z=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,Z=w;d==="selectionchange"&&w.nodeType!==9&&(Z=w.ownerDocument);var te=Vc(Z),xe=d+"__"+(_?"capture":"bubble");te.has(xe)||(_&&(z|=4),rl(Z,d,z,_),te.add(xe))}function rl(d,_,w,k){var z=zn.get(_);switch(z===void 0?2:z){case 0:z=H0;break;case 1:z=Ac;break;default:z=Br}w=z.bind(null,_,w,d),z=void 0,!ft||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(z=!0),k?z!==void 0?d.addEventListener(_,w,{capture:!0,passive:z}):d.addEventListener(_,w,!0):z!==void 0?d.addEventListener(_,w,{passive:z}):d.addEventListener(_,w,!1)}function Gl(d,_,w,k,z){var Z=k;if(!(_&1)&&!(_&2)&&k!==null)e:for(;;){if(k===null)return;var te=k.tag;if(te===3||te===4){var xe=k.stateNode.containerInfo;if(xe===z||xe.nodeType===8&&xe.parentNode===z)break;if(te===4)for(te=k.return;te!==null;){var ze=te.tag;if((ze===3||ze===4)&&(ze=te.stateNode.containerInfo,ze===z||ze.nodeType===8&&ze.parentNode===z))return;te=te.return}for(;xe!==null;){if(te=ra(xe),te===null)return;if(ze=te.tag,ze===5||ze===6){k=Z=te;continue e}xe=xe.parentNode}}k=k.return}Le(function(){var ct=Z,Qt=bs(w),kn=[];e:{var Nt=Wt.get(d);if(Nt!==void 0){var dn=Cc,On=d;switch(d){case"keypress":if(Cs(w)===0)break e;case"keydown":case"keyup":dn=Ic;break;case"focusin":On="focus",dn=F3;break;case"focusout":On="blur",dn=F3;break;case"beforeblur":case"afterblur":dn=F3;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":dn=O3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":dn=Z0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":dn=rr;break;case vr:case wr:case Oi:dn=du;break;case Ko:dn=K0;break;case"scroll":dn=C1;break;case"wheel":dn=U3;break;case"copy":case"cut":case"paste":dn=G0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":dn=$l}var wn=(_&4)!==0,tt=!wn&&d==="scroll",je=wn?Nt!==null?Nt+"Capture":null:Nt;wn=[];for(var Qe=ct,St;Qe!==null;){St=Qe;var Pt=St.stateNode;if(St.tag===5&&Pt!==null&&(St=Pt,je!==null&&(Pt=Ye(Qe,je),Pt!=null&&wn.push(ea(Qe,Pt,St)))),tt)break;Qe=Qe.return}0<wn.length&&(Nt=new dn(Nt,On,null,w,Qt),kn.push({event:Nt,listeners:wn}))}}if(!(_&7)){e:{if(Nt=d==="mouseover"||d==="pointerover",dn=d==="mouseout"||d==="pointerout",Nt&&!(_&16)&&(On=w.relatedTarget||w.fromElement)&&(ra(On)||On[Ea]))break e;if((dn||Nt)&&(Nt=Qt.window===Qt?Qt:(Nt=Qt.ownerDocument)?Nt.defaultView||Nt.parentWindow:window,dn?(On=w.relatedTarget||w.toElement,dn=ct,On=On?ra(On):null,On!==null&&(tt=Xn(On),On!==tt||On.tag!==5&&On.tag!==6)&&(On=null)):(dn=null,On=ct),dn!==On)){if(wn=O3,Pt="onMouseLeave",je="onMouseEnter",Qe="mouse",(d==="pointerout"||d==="pointerover")&&(wn=$l,Pt="onPointerLeave",je="onPointerEnter",Qe="pointer"),tt=dn==null?Nt:al(dn),St=On==null?Nt:al(On),Nt=new wn(Pt,Qe+"leave",dn,w,Qt),Nt.target=tt,Nt.relatedTarget=St,Pt=null,ra(Qt)===ct&&(wn=new wn(je,Qe+"enter",On,w,Qt),wn.target=St,wn.relatedTarget=tt,Pt=wn),tt=Pt,dn&&On)t:{for(wn=dn,je=On,Qe=0,St=wn;St;St=il(St))Qe++;for(St=0,Pt=je;Pt;Pt=il(Pt))St++;for(;0<Qe-St;)wn=il(wn),Qe--;for(;0<St-Qe;)je=il(je),St--;for(;Qe--;){if(wn===je||je!==null&&wn===je.alternate)break t;wn=il(wn),je=il(je)}wn=null}else wn=null;dn!==null&&sl(kn,Nt,dn,wn,!1),On!==null&&tt!==null&&sl(kn,tt,On,wn,!0)}}e:{if(Nt=ct?al(ct):window,dn=Nt.nodeName&&Nt.nodeName.toLowerCase(),dn==="select"||dn==="input"&&Nt.type==="file")var Bn=$3;else if(j3(Nt))if(Bs)Bn=X3;else{Bn=J0;var cn=va}else(dn=Nt.nodeName)&&dn.toLowerCase()==="input"&&(Nt.type==="checkbox"||Nt.type==="radio")&&(Bn=H3);if(Bn&&(Bn=Bn(d,ct))){Qi(kn,Bn,w,Qt);break e}cn&&cn(d,Nt,ct),d==="focusout"&&(cn=Nt._wrapperState)&&cn.controlled&&Nt.type==="number"&&_s(Nt,"number",Nt.value)}switch(cn=ct?al(ct):window,d){case"focusin":(j3(cn)||cn.contentEditable==="true")&&(nl=cn,lo=ct,Io=null);break;case"focusout":Io=lo=nl=null;break;case"mousedown":Nc=!0;break;case"contextmenu":case"mouseup":case"dragend":Nc=!1,Bc(kn,w,Qt);break;case"selectionchange":if(ba)break;case"keydown":case"keyup":Bc(kn,w,Qt)}var Ln;if(Oc)e:{switch(d){case"compositionstart":var Zn="onCompositionStart";break e;case"compositionend":Zn="onCompositionEnd";break e;case"compositionupdate":Zn="onCompositionUpdate";break e}Zn=void 0}else el?Wl(d,w)&&(Zn="onCompositionEnd"):d==="keydown"&&w.keyCode===229&&(Zn="onCompositionStart");Zn&&(O1&&w.locale!=="ko"&&(el||Zn!=="onCompositionStart"?Zn==="onCompositionEnd"&&el&&(Ln=As()):(Ji=Qt,ei="value"in Ji?Ji.value:Ji.textContent,el=!0)),cn=Yl(ct,Zn),0<cn.length&&(Zn=new z3(Zn,d,null,w,Qt),kn.push({event:Zn,listeners:cn}),Ln?Zn.data=Ln:(Ln=V3(w),Ln!==null&&(Zn.data=Ln)))),(Ln=pu?mu(d,w):F1(d,w))&&(ct=Yl(ct,"onBeforeInput"),0<ct.length&&(Qt=new z3("onBeforeInput","beforeinput",null,w,Qt),kn.push({event:Qt,listeners:ct}),Qt.data=Ln))}V1(kn,_)})}function ea(d,_,w){return{instance:d,listener:_,currentTarget:w}}function Yl(d,_){for(var w=_+"Capture",k=[];d!==null;){var z=d,Z=z.stateNode;z.tag===5&&Z!==null&&(z=Z,Z=Ye(d,w),Z!=null&&k.unshift(ea(d,Z,z)),Z=Ye(d,_),Z!=null&&k.push(ea(d,Z,z))),d=d.return}return k}function il(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function sl(d,_,w,k,z){for(var Z=_._reactName,te=[];w!==null&&w!==k;){var xe=w,ze=xe.alternate,ct=xe.stateNode;if(ze!==null&&ze===k)break;xe.tag===5&&ct!==null&&(xe=ct,z?(ze=Ye(w,Z),ze!=null&&te.unshift(ea(w,ze,xe))):z||(ze=Ye(w,Z),ze!=null&&te.push(ea(w,ze,xe)))),w=w.return}te.length!==0&&d.push({event:_,listeners:te})}function ol(){}var hs=null,j1=null;function q3(d,_){switch(d){case"button":case"input":case"select":case"textarea":return!!_.autoFocus}return!1}function Kl(d,_){return d==="textarea"||d==="option"||d==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var Mo=typeof setTimeout=="function"?setTimeout:void 0,G3=typeof clearTimeout=="function"?clearTimeout:void 0;function Jl(d){d.nodeType===1?d.textContent="":d.nodeType===9&&(d=d.body,d!=null&&(d.textContent=""))}function ta(d){for(;d!=null;d=d.nextSibling){var _=d.nodeType;if(_===1||_===3)break}return d}function $1(d){d=d.previousSibling;for(var _=0;d;){if(d.nodeType===8){var w=d.data;if(w==="$"||w==="$!"||w==="$?"){if(_===0)return d;_--}else w==="/$"&&_++}d=d.previousSibling}return null}var Ql=0;function n4(d){return{$$typeof:rt,toString:d,valueOf:d}}var na=Math.random().toString(36).slice(2),Ta="__reactFiber$"+na,Uc="__reactProps$"+na,Ea="__reactContainer$"+na,W1="__reactEvents$"+na;function ra(d){var _=d[Ta];if(_)return _;for(var w=d.parentNode;w;){if(_=w[Ea]||w[Ta]){if(w=_.alternate,_.child!==null||w!==null&&w.child!==null)for(d=$1(d);d!==null;){if(w=d[Ta])return w;d=$1(d)}return _}d=w,w=d.parentNode}return null}function e1(d){return d=d[Ta]||d[Ea],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function al(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(r(33))}function ll(d){return d[Uc]||null}function Vc(d){var _=d[W1];return _===void 0&&(_=d[W1]=new Set),_}var jc=[],Ro=-1;function ia(d){return{current:d}}function Ar(d){0>Ro||(d.current=jc[Ro],jc[Ro]=null,Ro--)}function Cr(d,_){Ro++,jc[Ro]=d.current,d.current=_}var Ps={},gi=ia(Ps),es=ia(!1),sa=Ps;function Sa(d,_){var w=d.type.contextTypes;if(!w)return Ps;var k=d.stateNode;if(k&&k.__reactInternalMemoizedUnmaskedChildContext===_)return k.__reactInternalMemoizedMaskedChildContext;var z={},Z;for(Z in w)z[Z]=_[Z];return k&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=_,d.__reactInternalMemoizedMaskedChildContext=z),z}function Li(d){return d=d.childContextTypes,d!=null}function t1(){Ar(es),Ar(gi)}function ai(d,_,w){if(gi.current!==Ps)throw Error(r(168));Cr(gi,_),Cr(es,w)}function $c(d,_,w){var k=d.stateNode;if(d=_.childContextTypes,typeof k.getChildContext!="function")return w;k=k.getChildContext();for(var z in k)if(!(z in d))throw Error(r(108,Qr(_)||"Unknown",z));return e({},w,k)}function Us(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||Ps,sa=gi.current,Cr(gi,d),Cr(es,es.current),!0}function Y3(d,_,w){var k=d.stateNode;if(!k)throw Error(r(169));w?(d=$c(d,_,sa),k.__reactInternalMemoizedMergedChildContext=d,Ar(es),Ar(gi),Cr(gi,d)):Ar(es),Cr(es,w)}var Is=null,Vs=null,n1=t.unstable_runWithPriority,K3=t.unstable_scheduleCallback,H1=t.unstable_cancelCallback,gu=t.unstable_shouldYield,J3=t.unstable_requestPaint,cl=t.unstable_now,ts=t.unstable_getCurrentPriorityLevel,Aa=t.unstable_ImmediatePriority,ul=t.unstable_UserBlockingPriority,r1=t.unstable_NormalPriority,Xt=t.unstable_LowPriority,hl=t.unstable_IdlePriority,Wc={},X1=J3!==void 0?J3:function(){},Fi=null,v=null,l=!1,p=cl(),x=1e4>p?cl:function(){return cl()-p};function E(){switch(ts()){case Aa:return 99;case ul:return 98;case r1:return 97;case Xt:return 96;case hl:return 95;default:throw Error(r(332))}}function A(d){switch(d){case 99:return Aa;case 98:return ul;case 97:return r1;case 96:return Xt;case 95:return hl;default:throw Error(r(332))}}function I(d,_){return d=A(d),n1(d,_)}function D(d,_,w){return d=A(d),K3(d,_,w)}function B(){if(v!==null){var d=v;v=null,H1(d)}j()}function j(){if(!l&&Fi!==null){l=!0;var d=0;try{var _=Fi;I(99,function(){for(;d<_.length;d++){var w=_[d];do w=w(!0);while(w!==null)}}),Fi=null}catch(w){throw Fi!==null&&(Fi=Fi.slice(d+1)),K3(Aa,B),w}finally{l=!1}}}var $=Me.ReactCurrentBatchConfig;function X(d,_){if(d&&d.defaultProps){_=e({},_),d=d.defaultProps;for(var w in d)_[w]===void 0&&(_[w]=d[w]);return _}return _}var K=ia(null),se=null,re=null,ae=null;function Pe(){ae=re=se=null}function ie(d){var _=K.current;Ar(K),d.type._context._currentValue=_}function Ae(d,_){for(;d!==null;){var w=d.alternate;if((d.childLanes&_)===_){if(w===null||(w.childLanes&_)===_)break;w.childLanes|=_}else d.childLanes|=_,w!==null&&(w.childLanes|=_);d=d.return}}function Se(d,_){se=d,ae=re=null,d=d.dependencies,d!==null&&d.firstContext!==null&&(d.lanes&_&&(oa=!0),d.firstContext=null)}function be(d,_){if(ae!==d&&_!==!1&&_!==0)if((typeof _!="number"||_===1073741823)&&(ae=d,_=1073741823),_={context:d,observedBits:_,next:null},re===null){if(se===null)throw Error(r(308));re=_,se.dependencies={lanes:0,firstContext:_,responders:null}}else re=re.next=_;return d._currentValue}var we=!1;function Ie(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function Ke(d,_){d=d.updateQueue,_.updateQueue===d&&(_.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function st(d,_){return{eventTime:d,lane:_,tag:0,payload:null,callback:null,next:null}}function It(d,_){if(d=d.updateQueue,d!==null){d=d.shared;var w=d.pending;w===null?_.next=_:(_.next=w.next,w.next=_),d.pending=_}}function Et(d,_){var w=d.updateQueue,k=d.alternate;if(k!==null&&(k=k.updateQueue,w===k)){var z=null,Z=null;if(w=w.firstBaseUpdate,w!==null){do{var te={eventTime:w.eventTime,lane:w.lane,tag:w.tag,payload:w.payload,callback:w.callback,next:null};Z===null?z=Z=te:Z=Z.next=te,w=w.next}while(w!==null);Z===null?z=Z=_:Z=Z.next=_}else z=Z=_;w={baseState:k.baseState,firstBaseUpdate:z,lastBaseUpdate:Z,shared:k.shared,effects:k.effects},d.updateQueue=w;return}d=w.lastBaseUpdate,d===null?w.firstBaseUpdate=_:d.next=_,w.lastBaseUpdate=_}function bt(d,_,w,k){var z=d.updateQueue;we=!1;var Z=z.firstBaseUpdate,te=z.lastBaseUpdate,xe=z.shared.pending;if(xe!==null){z.shared.pending=null;var ze=xe,ct=ze.next;ze.next=null,te===null?Z=ct:te.next=ct,te=ze;var Qt=d.alternate;if(Qt!==null){Qt=Qt.updateQueue;var kn=Qt.lastBaseUpdate;kn!==te&&(kn===null?Qt.firstBaseUpdate=ct:kn.next=ct,Qt.lastBaseUpdate=ze)}}if(Z!==null){kn=z.baseState,te=0,Qt=ct=ze=null;do{xe=Z.lane;var Nt=Z.eventTime;if((k&xe)===xe){Qt!==null&&(Qt=Qt.next={eventTime:Nt,lane:0,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null});e:{var dn=d,On=Z;switch(xe=_,Nt=w,On.tag){case 1:if(dn=On.payload,typeof dn=="function"){kn=dn.call(Nt,kn,xe);break e}kn=dn;break e;case 3:dn.flags=dn.flags&-4097|64;case 0:if(dn=On.payload,xe=typeof dn=="function"?dn.call(Nt,kn,xe):dn,xe==null)break e;kn=e({},kn,xe);break e;case 2:we=!0}}Z.callback!==null&&(d.flags|=32,xe=z.effects,xe===null?z.effects=[Z]:xe.push(Z))}else Nt={eventTime:Nt,lane:xe,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null},Qt===null?(ct=Qt=Nt,ze=kn):Qt=Qt.next=Nt,te|=xe;if(Z=Z.next,Z===null){if(xe=z.shared.pending,xe===null)break;Z=xe.next,xe.next=null,z.lastBaseUpdate=xe,z.shared.pending=null}}while(!0);Qt===null&&(ze=kn),z.baseState=ze,z.firstBaseUpdate=ct,z.lastBaseUpdate=Qt,a0|=te,d.lanes=te,d.memoizedState=kn}}function ut(d,_,w){if(d=_.effects,_.effects=null,d!==null)for(_=0;_<d.length;_++){var k=d[_],z=k.callback;if(z!==null){if(k.callback=null,k=w,typeof z!="function")throw Error(r(191,z));z.call(k)}}}var it=new n.Component().refs;function vt(d,_,w,k){_=d.memoizedState,w=w(k,_),w=w==null?_:e({},_,w),d.memoizedState=w,d.lanes===0&&(d.updateQueue.baseState=w)}var dt={isMounted:function(d){return(d=d._reactInternals)?Xn(d)===d:!1},enqueueSetState:function(d,_,w){d=d._reactInternals;var k=Xs(),z=La(d),Z=st(k,z);Z.payload=_,w!=null&&(Z.callback=w),It(d,Z),xl(d,z,k)},enqueueReplaceState:function(d,_,w){d=d._reactInternals;var k=Xs(),z=La(d),Z=st(k,z);Z.tag=1,Z.payload=_,w!=null&&(Z.callback=w),It(d,Z),xl(d,z,k)},enqueueForceUpdate:function(d,_){d=d._reactInternals;var w=Xs(),k=La(d),z=st(w,k);z.tag=2,_!=null&&(z.callback=_),It(d,z),xl(d,k,w)}};function nn(d,_,w,k,z,Z,te){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(k,Z,te):_.prototype&&_.prototype.isPureReactComponent?!xa(w,k)||!xa(z,Z):!0}function hn(d,_,w){var k=!1,z=Ps,Z=_.contextType;return typeof Z=="object"&&Z!==null?Z=be(Z):(z=Li(_)?sa:gi.current,k=_.contextTypes,Z=(k=k!=null)?Sa(d,z):Ps),_=new _(w,Z),d.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=dt,d.stateNode=_,_._reactInternals=d,k&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=z,d.__reactInternalMemoizedMaskedChildContext=Z),_}function In(d,_,w,k){d=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(w,k),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(w,k),_.state!==d&&dt.enqueueReplaceState(_,_.state,null)}function Rt(d,_,w,k){var z=d.stateNode;z.props=w,z.state=d.memoizedState,z.refs=it,Ie(d);var Z=_.contextType;typeof Z=="object"&&Z!==null?z.context=be(Z):(Z=Li(_)?sa:gi.current,z.context=Sa(d,Z)),bt(d,w,z,k),z.state=d.memoizedState,Z=_.getDerivedStateFromProps,typeof Z=="function"&&(vt(d,_,Z,w),z.state=d.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof z.getSnapshotBeforeUpdate=="function"||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(_=z.state,typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount(),_!==z.state&&dt.enqueueReplaceState(z,z.state,null),bt(d,w,z,k),z.state=d.memoizedState),typeof z.componentDidMount=="function"&&(d.flags|=4)}var sn=Array.isArray;function _n(d,_,w){if(d=w.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(w._owner){if(w=w._owner,w){if(w.tag!==1)throw Error(r(309));var k=w.stateNode}if(!k)throw Error(r(147,d));var z=""+d;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===z?_.ref:(_=function(Z){var te=k.refs;te===it&&(te=k.refs={}),Z===null?delete te[z]:te[z]=Z},_._stringRef=z,_)}if(typeof d!="string")throw Error(r(284));if(!w._owner)throw Error(r(290,d))}return d}function Jn(d,_){if(d.type!=="textarea")throw Error(r(31,Object.prototype.toString.call(_)==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":_))}function hr(d){function _(tt,je){if(d){var Qe=tt.lastEffect;Qe!==null?(Qe.nextEffect=je,tt.lastEffect=je):tt.firstEffect=tt.lastEffect=je,je.nextEffect=null,je.flags=8}}function w(tt,je){if(!d)return null;for(;je!==null;)_(tt,je),je=je.sibling;return null}function k(tt,je){for(tt=new Map;je!==null;)je.key!==null?tt.set(je.key,je):tt.set(je.index,je),je=je.sibling;return tt}function z(tt,je){return tt=Na(tt,je),tt.index=0,tt.sibling=null,tt}function Z(tt,je,Qe){return tt.index=Qe,d?(Qe=tt.alternate,Qe!==null?(Qe=Qe.index,Qe<je?(tt.flags=2,je):Qe):(tt.flags=2,je)):je}function te(tt){return d&&tt.alternate===null&&(tt.flags=2),tt}function xe(tt,je,Qe,St){return je===null||je.tag!==6?(je=ac(Qe,tt.mode,St),je.return=tt,je):(je=z(je,Qe),je.return=tt,je)}function ze(tt,je,Qe,St){return je!==null&&je.elementType===Qe.type?(St=z(je,Qe.props),St.ref=_n(tt,je,Qe),St.return=tt,St):(St=Qc(Qe.type,Qe.key,Qe.props,null,tt.mode,St),St.ref=_n(tt,je,Qe),St.return=tt,St)}function ct(tt,je,Qe,St){return je===null||je.tag!==4||je.stateNode.containerInfo!==Qe.containerInfo||je.stateNode.implementation!==Qe.implementation?(je=_0(Qe,tt.mode,St),je.return=tt,je):(je=z(je,Qe.children||[]),je.return=tt,je)}function Qt(tt,je,Qe,St,Pt){return je===null||je.tag!==7?(je=e3(Qe,tt.mode,St,Pt),je.return=tt,je):(je=z(je,Qe),je.return=tt,je)}function kn(tt,je,Qe){if(typeof je=="string"||typeof je=="number")return je=ac(""+je,tt.mode,Qe),je.return=tt,je;if(typeof je=="object"&&je!==null){switch(je.$$typeof){case Fe:return Qe=Qc(je.type,je.key,je.props,null,tt.mode,Qe),Qe.ref=_n(tt,null,je),Qe.return=tt,Qe;case yt:return je=_0(je,tt.mode,Qe),je.return=tt,je}if(sn(je)||Dt(je))return je=e3(je,tt.mode,Qe,null),je.return=tt,je;Jn(tt,je)}return null}function Nt(tt,je,Qe,St){var Pt=je!==null?je.key:null;if(typeof Qe=="string"||typeof Qe=="number")return Pt!==null?null:xe(tt,je,""+Qe,St);if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case Fe:return Qe.key===Pt?Qe.type===xt?Qt(tt,je,Qe.props.children,St,Pt):ze(tt,je,Qe,St):null;case yt:return Qe.key===Pt?ct(tt,je,Qe,St):null}if(sn(Qe)||Dt(Qe))return Pt!==null?null:Qt(tt,je,Qe,St,null);Jn(tt,Qe)}return null}function dn(tt,je,Qe,St,Pt){if(typeof St=="string"||typeof St=="number")return tt=tt.get(Qe)||null,xe(je,tt,""+St,Pt);if(typeof St=="object"&&St!==null){switch(St.$$typeof){case Fe:return tt=tt.get(St.key===null?Qe:St.key)||null,St.type===xt?Qt(je,tt,St.props.children,Pt,St.key):ze(je,tt,St,Pt);case yt:return tt=tt.get(St.key===null?Qe:St.key)||null,ct(je,tt,St,Pt)}if(sn(St)||Dt(St))return tt=tt.get(Qe)||null,Qt(je,tt,St,Pt,null);Jn(je,St)}return null}function On(tt,je,Qe,St){for(var Pt=null,Bn=null,cn=je,Ln=je=0,Zn=null;cn!==null&&Ln<Qe.length;Ln++){cn.index>Ln?(Zn=cn,cn=null):Zn=cn.sibling;var jn=Nt(tt,cn,Qe[Ln],St);if(jn===null){cn===null&&(cn=Zn);break}d&&cn&&jn.alternate===null&&_(tt,cn),je=Z(jn,je,Ln),Bn===null?Pt=jn:Bn.sibling=jn,Bn=jn,cn=Zn}if(Ln===Qe.length)return w(tt,cn),Pt;if(cn===null){for(;Ln<Qe.length;Ln++)cn=kn(tt,Qe[Ln],St),cn!==null&&(je=Z(cn,je,Ln),Bn===null?Pt=cn:Bn.sibling=cn,Bn=cn);return Pt}for(cn=k(tt,cn);Ln<Qe.length;Ln++)Zn=dn(cn,tt,Ln,Qe[Ln],St),Zn!==null&&(d&&Zn.alternate!==null&&cn.delete(Zn.key===null?Ln:Zn.key),je=Z(Zn,je,Ln),Bn===null?Pt=Zn:Bn.sibling=Zn,Bn=Zn);return d&&cn.forEach(function(u1){return _(tt,u1)}),Pt}function wn(tt,je,Qe,St){var Pt=Dt(Qe);if(typeof Pt!="function")throw Error(r(150));if(Qe=Pt.call(Qe),Qe==null)throw Error(r(151));for(var Bn=Pt=null,cn=je,Ln=je=0,Zn=null,jn=Qe.next();cn!==null&&!jn.done;Ln++,jn=Qe.next()){cn.index>Ln?(Zn=cn,cn=null):Zn=cn.sibling;var u1=Nt(tt,cn,jn.value,St);if(u1===null){cn===null&&(cn=Zn);break}d&&cn&&u1.alternate===null&&_(tt,cn),je=Z(u1,je,Ln),Bn===null?Pt=u1:Bn.sibling=u1,Bn=u1,cn=Zn}if(jn.done)return w(tt,cn),Pt;if(cn===null){for(;!jn.done;Ln++,jn=Qe.next())jn=kn(tt,jn.value,St),jn!==null&&(je=Z(jn,je,Ln),Bn===null?Pt=jn:Bn.sibling=jn,Bn=jn);return Pt}for(cn=k(tt,cn);!jn.done;Ln++,jn=Qe.next())jn=dn(cn,tt,Ln,jn.value,St),jn!==null&&(d&&jn.alternate!==null&&cn.delete(jn.key===null?Ln:jn.key),je=Z(jn,je,Ln),Bn===null?Pt=jn:Bn.sibling=jn,Bn=jn);return d&&cn.forEach(function(z6){return _(tt,z6)}),Pt}return function(tt,je,Qe,St){var Pt=typeof Qe=="object"&&Qe!==null&&Qe.type===xt&&Qe.key===null;Pt&&(Qe=Qe.props.children);var Bn=typeof Qe=="object"&&Qe!==null;if(Bn)switch(Qe.$$typeof){case Fe:e:{for(Bn=Qe.key,Pt=je;Pt!==null;){if(Pt.key===Bn){switch(Pt.tag){case 7:if(Qe.type===xt){w(tt,Pt.sibling),je=z(Pt,Qe.props.children),je.return=tt,tt=je;break e}break;default:if(Pt.elementType===Qe.type){w(tt,Pt.sibling),je=z(Pt,Qe.props),je.ref=_n(tt,Pt,Qe),je.return=tt,tt=je;break e}}w(tt,Pt);break}else _(tt,Pt);Pt=Pt.sibling}Qe.type===xt?(je=e3(Qe.props.children,tt.mode,St,Qe.key),je.return=tt,tt=je):(St=Qc(Qe.type,Qe.key,Qe.props,null,tt.mode,St),St.ref=_n(tt,je,Qe),St.return=tt,tt=St)}return te(tt);case yt:e:{for(Pt=Qe.key;je!==null;){if(je.key===Pt)if(je.tag===4&&je.stateNode.containerInfo===Qe.containerInfo&&je.stateNode.implementation===Qe.implementation){w(tt,je.sibling),je=z(je,Qe.children||[]),je.return=tt,tt=je;break e}else{w(tt,je);break}else _(tt,je);je=je.sibling}je=_0(Qe,tt.mode,St),je.return=tt,tt=je}return te(tt)}if(typeof Qe=="string"||typeof Qe=="number")return Qe=""+Qe,je!==null&&je.tag===6?(w(tt,je.sibling),je=z(je,Qe),je.return=tt,tt=je):(w(tt,je),je=ac(Qe,tt.mode,St),je.return=tt,tt=je),te(tt);if(sn(Qe))return On(tt,je,Qe,St);if(Dt(Qe))return wn(tt,je,Qe,St);if(Bn&&Jn(tt,Qe),typeof Qe>"u"&&!Pt)switch(tt.tag){case 1:case 22:case 0:case 11:case 15:throw Error(r(152,Qr(tt.type)||"Component"))}return w(tt,je)}}var mn=hr(!0),Nn=hr(!1),fr={},_r=ia(fr),_i=ia(fr),Ni=ia(fr);function Ai(d){if(d===fr)throw Error(r(174));return d}function $n(d,_){switch(Cr(Ni,_),Cr(_i,d),Cr(_r,fr),d=_.nodeType,d){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:To(null,"");break;default:d=d===8?_.parentNode:_,_=d.namespaceURI||null,d=d.tagName,_=To(_,d)}Ar(_r),Cr(_r,_)}function gn(){Ar(_r),Ar(_i),Ar(Ni)}function Un(d){Ai(Ni.current);var _=Ai(_r.current),w=To(_,d.type);_!==w&&(Cr(_i,d),Cr(_r,w))}function Rr(d){_i.current===d&&(Ar(_r),Ar(_i))}var tr=ia(0);function dr(d){for(var _=d;_!==null;){if(_.tag===13){var w=_.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||w.data==="$?"||w.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if(_.flags&64)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===d)break;for(;_.sibling===null;){if(_.return===null||_.return===d)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var qr=null,js=null,zr=!1;function Ca(d,_){var w=po(5,null,null,0);w.elementType="DELETED",w.type="DELETED",w.stateNode=_,w.return=d,w.flags=8,d.lastEffect!==null?(d.lastEffect.nextEffect=w,d.lastEffect=w):d.firstEffect=d.lastEffect=w}function Gt(d,_){switch(d.tag){case 5:var w=d.type;return _=_.nodeType!==1||w.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(d.stateNode=_,!0):!1;case 6:return _=d.pendingProps===""||_.nodeType!==3?null:_,_!==null?(d.stateNode=_,!0):!1;case 13:return!1;default:return!1}}function an(d){if(zr){var _=js;if(_){var w=_;if(!Gt(d,_)){if(_=ta(w.nextSibling),!_||!Gt(d,_)){d.flags=d.flags&-1025|2,zr=!1,qr=d;return}Ca(qr,w)}qr=d,js=ta(_.firstChild)}else d.flags=d.flags&-1025|2,zr=!1,qr=d}}function li(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;qr=d}function ko(d){if(d!==qr)return!1;if(!zr)return li(d),zr=!0,!1;var _=d.type;if(d.tag!==5||_!=="head"&&_!=="body"&&!Kl(_,d.memoizedProps))for(_=js;_;)Ca(d,_),_=ta(_.nextSibling);if(li(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(317));e:{for(d=d.nextSibling,_=0;d;){if(d.nodeType===8){var w=d.data;if(w==="/$"){if(_===0){js=ta(d.nextSibling);break e}_--}else w!=="$"&&w!=="$!"&&w!=="$?"||_++}d=d.nextSibling}js=null}}else js=qr?ta(d.stateNode.nextSibling):null;return!0}function Oo(){js=qr=null,zr=!1}var Hr=[];function r4(){for(var d=0;d<Hr.length;d++)Hr[d]._workInProgressVersionPrimary=null;Hr.length=0}var Q3=Me.ReactCurrentDispatcher,fs=Me.ReactCurrentBatchConfig,kr=0,Mn=null,ns=null,ti=null,fl=!1,Z1=!1;function Ci(){throw Error(r(321))}function Pa(d,_){if(_===null)return!1;for(var w=0;w<_.length&&w<d.length;w++)if(!us(d[w],_[w]))return!1;return!0}function Hc(d,_,w,k,z,Z){if(kr=Z,Mn=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,Q3.current=d===null||d.memoizedState===null?X2:Z2,d=w(k,z),Z1){Z=0;do{if(Z1=!1,!(25>Z))throw Error(r(301));Z+=1,ti=ns=null,_.updateQueue=null,Q3.current=q2,d=w(k,z)}while(Z1)}if(Q3.current=n0,_=ns!==null&&ns.next!==null,kr=0,ti=ns=Mn=null,fl=!1,_)throw Error(r(300));return d}function dl(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ti===null?Mn.memoizedState=ti=d:ti=ti.next=d,ti}function pl(){if(ns===null){var d=Mn.alternate;d=d!==null?d.memoizedState:null}else d=ns.next;var _=ti===null?Mn.memoizedState:ti.next;if(_!==null)ti=_,ns=d;else{if(d===null)throw Error(r(310));ns=d,d={memoizedState:ns.memoizedState,baseState:ns.baseState,baseQueue:ns.baseQueue,queue:ns.queue,next:null},ti===null?Mn.memoizedState=ti=d:ti=ti.next=d}return ti}function Do(d,_){return typeof _=="function"?_(d):_}function i1(d){var _=pl(),w=_.queue;if(w===null)throw Error(r(311));w.lastRenderedReducer=d;var k=ns,z=k.baseQueue,Z=w.pending;if(Z!==null){if(z!==null){var te=z.next;z.next=Z.next,Z.next=te}k.baseQueue=z=Z,w.pending=null}if(z!==null){z=z.next,k=k.baseState;var xe=te=Z=null,ze=z;do{var ct=ze.lane;if((kr&ct)===ct)xe!==null&&(xe=xe.next={lane:0,action:ze.action,eagerReducer:ze.eagerReducer,eagerState:ze.eagerState,next:null}),k=ze.eagerReducer===d?ze.eagerState:d(k,ze.action);else{var Qt={lane:ct,action:ze.action,eagerReducer:ze.eagerReducer,eagerState:ze.eagerState,next:null};xe===null?(te=xe=Qt,Z=k):xe=xe.next=Qt,Mn.lanes|=ct,a0|=ct}ze=ze.next}while(ze!==null&&ze!==z);xe===null?Z=k:xe.next=te,us(k,_.memoizedState)||(oa=!0),_.memoizedState=k,_.baseState=Z,_.baseQueue=xe,w.lastRenderedState=k}return[_.memoizedState,w.dispatch]}function q1(d){var _=pl(),w=_.queue;if(w===null)throw Error(r(311));w.lastRenderedReducer=d;var k=w.dispatch,z=w.pending,Z=_.memoizedState;if(z!==null){w.pending=null;var te=z=z.next;do Z=d(Z,te.action),te=te.next;while(te!==z);us(Z,_.memoizedState)||(oa=!0),_.memoizedState=Z,_.baseQueue===null&&(_.baseState=Z),w.lastRenderedState=Z}return[Z,k]}function i4(d,_,w){var k=_._getVersion;k=k(_._source);var z=_._workInProgressVersionPrimary;if(z!==null?d=z===k:(d=d.mutableReadLanes,(d=(kr&d)===d)&&(_._workInProgressVersionPrimary=k,Hr.push(_))),d)return w(_._source);throw Hr.push(_),Error(r(350))}function $s(d,_,w,k){var z=rs;if(z===null)throw Error(r(349));var Z=_._getVersion,te=Z(_._source),xe=Q3.current,ze=xe.useState(function(){return i4(z,_,w)}),ct=ze[1],Qt=ze[0];ze=ti;var kn=d.memoizedState,Nt=kn.refs,dn=Nt.getSnapshot,On=kn.source;kn=kn.subscribe;var wn=Mn;return d.memoizedState={refs:Nt,source:_,subscribe:k},xe.useEffect(function(){Nt.getSnapshot=w,Nt.setSnapshot=ct;var tt=Z(_._source);if(!us(te,tt)){tt=w(_._source),us(Qt,tt)||(ct(tt),tt=La(wn),z.mutableReadLanes|=tt&z.pendingLanes),tt=z.mutableReadLanes,z.entangledLanes|=tt;for(var je=z.entanglements,Qe=tt;0<Qe;){var St=31-Ss(Qe),Pt=1<<St;je[St]|=tt,Qe&=~Pt}}},[w,_,k]),xe.useEffect(function(){return k(_._source,function(){var tt=Nt.getSnapshot,je=Nt.setSnapshot;try{je(tt(_._source));var Qe=La(wn);z.mutableReadLanes|=Qe&z.pendingLanes}catch(St){je(function(){throw St})}})},[_,k]),us(dn,w)&&us(On,_)&&us(kn,k)||(d={pending:null,dispatch:null,lastRenderedReducer:Do,lastRenderedState:Qt},d.dispatch=ct=u4.bind(null,Mn,d),ze.queue=d,ze.baseQueue=null,Qt=i4(z,_,w),ze.memoizedState=ze.baseState=Qt),Qt}function s4(d,_,w){var k=pl();return $s(k,d,_,w)}function G1(d){var _=dl();return typeof d=="function"&&(d=d()),_.memoizedState=_.baseState=d,d=_.queue={pending:null,dispatch:null,lastRenderedReducer:Do,lastRenderedState:d},d=d.dispatch=u4.bind(null,Mn,d),[_.memoizedState,d]}function Y1(d,_,w,k){return d={tag:d,create:_,destroy:w,deps:k,next:null},_=Mn.updateQueue,_===null?(_={lastEffect:null},Mn.updateQueue=_,_.lastEffect=d.next=d):(w=_.lastEffect,w===null?_.lastEffect=d.next=d:(k=w.next,w.next=d,d.next=k,_.lastEffect=d)),d}function o4(d){var _=dl();return d={current:d},_.memoizedState=d}function s1(){return pl().memoizedState}function e0(d,_,w,k){var z=dl();Mn.flags|=d,z.memoizedState=Y1(1|_,w,void 0,k===void 0?null:k)}function Ia(d,_,w,k){var z=pl();k=k===void 0?null:k;var Z=void 0;if(ns!==null){var te=ns.memoizedState;if(Z=te.destroy,k!==null&&Pa(k,te.deps)){Y1(_,w,Z,k);return}}Mn.flags|=d,z.memoizedState=Y1(1|_,w,Z,k)}function t0(d,_){return e0(516,4,d,_)}function K1(d,_){return Ia(516,4,d,_)}function a4(d,_){return Ia(4,2,d,_)}function _u(d,_){if(typeof _=="function")return d=d(),_(d),function(){_(null)};if(_!=null)return d=d(),_.current=d,function(){_.current=null}}function l4(d,_,w){return w=w!=null?w.concat([d]):null,Ia(4,2,_u.bind(null,_,d),w)}function c4(){}function yu(d,_){var w=pl();_=_===void 0?null:_;var k=w.memoizedState;return k!==null&&_!==null&&Pa(_,k[1])?k[0]:(w.memoizedState=[d,_],d)}function vu(d,_){var w=pl();_=_===void 0?null:_;var k=w.memoizedState;return k!==null&&_!==null&&Pa(_,k[1])?k[0]:(d=d(),w.memoizedState=[d,_],d)}function H2(d,_){var w=E();I(98>w?98:w,function(){d(!0)}),I(97<w?97:w,function(){var k=fs.transition;fs.transition=1;try{d(!1),_()}finally{fs.transition=k}})}function u4(d,_,w){var k=Xs(),z=La(d),Z={lane:z,action:w,eagerReducer:null,eagerState:null,next:null},te=_.pending;if(te===null?Z.next=Z:(Z.next=te.next,te.next=Z),_.pending=Z,te=d.alternate,d===Mn||te!==null&&te===Mn)Z1=fl=!0;else{if(d.lanes===0&&(te===null||te.lanes===0)&&(te=_.lastRenderedReducer,te!==null))try{var xe=_.lastRenderedState,ze=te(xe,w);if(Z.eagerReducer=te,Z.eagerState=ze,us(ze,xe))return}catch{}finally{}xl(d,z,k)}}var n0={readContext:be,useCallback:Ci,useContext:Ci,useEffect:Ci,useImperativeHandle:Ci,useLayoutEffect:Ci,useMemo:Ci,useReducer:Ci,useRef:Ci,useState:Ci,useDebugValue:Ci,useDeferredValue:Ci,useTransition:Ci,useMutableSource:Ci,useOpaqueIdentifier:Ci,unstable_isNewReconciler:!1},X2={readContext:be,useCallback:function(d,_){return dl().memoizedState=[d,_===void 0?null:_],d},useContext:be,useEffect:t0,useImperativeHandle:function(d,_,w){return w=w!=null?w.concat([d]):null,e0(4,2,_u.bind(null,_,d),w)},useLayoutEffect:function(d,_){return e0(4,2,d,_)},useMemo:function(d,_){var w=dl();return _=_===void 0?null:_,d=d(),w.memoizedState=[d,_],d},useReducer:function(d,_,w){var k=dl();return _=w!==void 0?w(_):_,k.memoizedState=k.baseState=_,d=k.queue={pending:null,dispatch:null,lastRenderedReducer:d,lastRenderedState:_},d=d.dispatch=u4.bind(null,Mn,d),[k.memoizedState,d]},useRef:o4,useState:G1,useDebugValue:c4,useDeferredValue:function(d){var _=G1(d),w=_[0],k=_[1];return t0(function(){var z=fs.transition;fs.transition=1;try{k(d)}finally{fs.transition=z}},[d]),w},useTransition:function(){var d=G1(!1),_=d[0];return d=H2.bind(null,d[1]),o4(d),[d,_]},useMutableSource:function(d,_,w){var k=dl();return k.memoizedState={refs:{getSnapshot:_,setSnapshot:null},source:d,subscribe:w},$s(k,d,_,w)},useOpaqueIdentifier:function(){if(zr){var d=!1,_=n4(function(){throw d||(d=!0,w("r:"+(Ql++).toString(36))),Error(r(355))}),w=G1(_)[1];return!(Mn.mode&2)&&(Mn.flags|=516,Y1(5,function(){w("r:"+(Ql++).toString(36))},void 0,null)),_}return _="r:"+(Ql++).toString(36),G1(_),_},unstable_isNewReconciler:!1},Z2={readContext:be,useCallback:yu,useContext:be,useEffect:K1,useImperativeHandle:l4,useLayoutEffect:a4,useMemo:vu,useReducer:i1,useRef:s1,useState:function(){return i1(Do)},useDebugValue:c4,useDeferredValue:function(d){var _=i1(Do),w=_[0],k=_[1];return K1(function(){var z=fs.transition;fs.transition=1;try{k(d)}finally{fs.transition=z}},[d]),w},useTransition:function(){var d=i1(Do)[0];return[s1().current,d]},useMutableSource:s4,useOpaqueIdentifier:function(){return i1(Do)[0]},unstable_isNewReconciler:!1},q2={readContext:be,useCallback:yu,useContext:be,useEffect:K1,useImperativeHandle:l4,useLayoutEffect:a4,useMemo:vu,useReducer:q1,useRef:s1,useState:function(){return q1(Do)},useDebugValue:c4,useDeferredValue:function(d){var _=q1(Do),w=_[0],k=_[1];return K1(function(){var z=fs.transition;fs.transition=1;try{k(d)}finally{fs.transition=z}},[d]),w},useTransition:function(){var d=q1(Do)[0];return[s1().current,d]},useMutableSource:s4,useOpaqueIdentifier:function(){return q1(Do)[0]},unstable_isNewReconciler:!1},G2=Me.ReactCurrentOwner,oa=!1;function Ws(d,_,w,k){_.child=d===null?Nn(_,null,w,k):mn(_,d.child,w,k)}function xu(d,_,w,k,z){w=w.render;var Z=_.ref;return Se(_,z),k=Hc(d,_,w,k,Z,z),d!==null&&!oa?(_.updateQueue=d.updateQueue,_.flags&=-517,d.lanes&=~z,Hs(d,_,z)):(_.flags|=1,Ws(d,_,k,z),_.child)}function Y2(d,_,w,k,z,Z){if(d===null){var te=w.type;return typeof te=="function"&&!_4(te)&&te.defaultProps===void 0&&w.compare===null&&w.defaultProps===void 0?(_.tag=15,_.type=te,Xc(d,_,te,k,z,Z)):(d=Qc(w.type,null,k,_,_.mode,Z),d.ref=_.ref,d.return=_,_.child=d)}return te=d.child,!(z&Z)&&(z=te.memoizedProps,w=w.compare,w=w!==null?w:xa,w(z,k)&&d.ref===_.ref)?Hs(d,_,Z):(_.flags|=1,d=Na(te,k),d.ref=_.ref,d.return=_,_.child=d)}function Xc(d,_,w,k,z,Z){if(d!==null&&xa(d.memoizedProps,k)&&d.ref===_.ref)if(oa=!1,(Z&z)!==0)d.flags&16384&&(oa=!0);else return _.lanes=d.lanes,Hs(d,_,Z);return h4(d,_,w,k,Z)}function bu(d,_,w){var k=_.pendingProps,z=k.children,Z=d!==null?d.memoizedState:null;if(k.mode==="hidden"||k.mode==="unstable-defer-without-hiding")if(!(_.mode&4))_.memoizedState={baseLanes:0},ic(_,w);else if(w&1073741824)_.memoizedState={baseLanes:0},ic(_,Z!==null?Z.baseLanes:w);else return d=Z!==null?Z.baseLanes|w:w,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:d},ic(_,d),null;else Z!==null?(k=Z.baseLanes|w,_.memoizedState=null):k=w,ic(_,k);return Ws(d,_,z,w),_.child}function r0(d,_){var w=_.ref;(d===null&&w!==null||d!==null&&d.ref!==w)&&(_.flags|=128)}function h4(d,_,w,k,z){var Z=Li(w)?sa:gi.current;return Z=Sa(_,Z),Se(_,z),w=Hc(d,_,w,k,Z,z),d!==null&&!oa?(_.updateQueue=d.updateQueue,_.flags&=-517,d.lanes&=~z,Hs(d,_,z)):(_.flags|=1,Ws(d,_,w,z),_.child)}function f4(d,_,w,k,z){if(Li(w)){var Z=!0;Us(_)}else Z=!1;if(Se(_,z),_.stateNode===null)d!==null&&(d.alternate=null,_.alternate=null,_.flags|=2),hn(_,w,k),Rt(_,w,k,z),k=!0;else if(d===null){var te=_.stateNode,xe=_.memoizedProps;te.props=xe;var ze=te.context,ct=w.contextType;typeof ct=="object"&&ct!==null?ct=be(ct):(ct=Li(w)?sa:gi.current,ct=Sa(_,ct));var Qt=w.getDerivedStateFromProps,kn=typeof Qt=="function"||typeof te.getSnapshotBeforeUpdate=="function";kn||typeof te.UNSAFE_componentWillReceiveProps!="function"&&typeof te.componentWillReceiveProps!="function"||(xe!==k||ze!==ct)&&In(_,te,k,ct),we=!1;var Nt=_.memoizedState;te.state=Nt,bt(_,k,te,z),ze=_.memoizedState,xe!==k||Nt!==ze||es.current||we?(typeof Qt=="function"&&(vt(_,w,Qt,k),ze=_.memoizedState),(xe=we||nn(_,w,xe,k,Nt,ze,ct))?(kn||typeof te.UNSAFE_componentWillMount!="function"&&typeof te.componentWillMount!="function"||(typeof te.componentWillMount=="function"&&te.componentWillMount(),typeof te.UNSAFE_componentWillMount=="function"&&te.UNSAFE_componentWillMount()),typeof te.componentDidMount=="function"&&(_.flags|=4)):(typeof te.componentDidMount=="function"&&(_.flags|=4),_.memoizedProps=k,_.memoizedState=ze),te.props=k,te.state=ze,te.context=ct,k=xe):(typeof te.componentDidMount=="function"&&(_.flags|=4),k=!1)}else{te=_.stateNode,Ke(d,_),xe=_.memoizedProps,ct=_.type===_.elementType?xe:X(_.type,xe),te.props=ct,kn=_.pendingProps,Nt=te.context,ze=w.contextType,typeof ze=="object"&&ze!==null?ze=be(ze):(ze=Li(w)?sa:gi.current,ze=Sa(_,ze));var dn=w.getDerivedStateFromProps;(Qt=typeof dn=="function"||typeof te.getSnapshotBeforeUpdate=="function")||typeof te.UNSAFE_componentWillReceiveProps!="function"&&typeof te.componentWillReceiveProps!="function"||(xe!==kn||Nt!==ze)&&In(_,te,k,ze),we=!1,Nt=_.memoizedState,te.state=Nt,bt(_,k,te,z);var On=_.memoizedState;xe!==kn||Nt!==On||es.current||we?(typeof dn=="function"&&(vt(_,w,dn,k),On=_.memoizedState),(ct=we||nn(_,w,ct,k,Nt,On,ze))?(Qt||typeof te.UNSAFE_componentWillUpdate!="function"&&typeof te.componentWillUpdate!="function"||(typeof te.componentWillUpdate=="function"&&te.componentWillUpdate(k,On,ze),typeof te.UNSAFE_componentWillUpdate=="function"&&te.UNSAFE_componentWillUpdate(k,On,ze)),typeof te.componentDidUpdate=="function"&&(_.flags|=4),typeof te.getSnapshotBeforeUpdate=="function"&&(_.flags|=256)):(typeof te.componentDidUpdate!="function"||xe===d.memoizedProps&&Nt===d.memoizedState||(_.flags|=4),typeof te.getSnapshotBeforeUpdate!="function"||xe===d.memoizedProps&&Nt===d.memoizedState||(_.flags|=256),_.memoizedProps=k,_.memoizedState=On),te.props=k,te.state=On,te.context=ze,k=ct):(typeof te.componentDidUpdate!="function"||xe===d.memoizedProps&&Nt===d.memoizedState||(_.flags|=4),typeof te.getSnapshotBeforeUpdate!="function"||xe===d.memoizedProps&&Nt===d.memoizedState||(_.flags|=256),k=!1)}return Zc(d,_,w,k,Z,z)}function Zc(d,_,w,k,z,Z){r0(d,_);var te=(_.flags&64)!==0;if(!k&&!te)return z&&Y3(_,w,!1),Hs(d,_,Z);k=_.stateNode,G2.current=_;var xe=te&&typeof w.getDerivedStateFromError!="function"?null:k.render();return _.flags|=1,d!==null&&te?(_.child=mn(_,d.child,null,Z),_.child=mn(_,null,xe,Z)):Ws(d,_,xe,Z),_.memoizedState=k.state,z&&Y3(_,w,!0),_.child}function Ma(d){var _=d.stateNode;_.pendingContext?ai(d,_.pendingContext,_.pendingContext!==_.context):_.context&&ai(d,_.context,!1),$n(d,_.containerInfo)}var J1={dehydrated:null,retryLane:0};function wu(d,_,w){var k=_.pendingProps,z=tr.current,Z=!1,te;return(te=(_.flags&64)!==0)||(te=d!==null&&d.memoizedState===null?!1:(z&2)!==0),te?(Z=!0,_.flags&=-65):d!==null&&d.memoizedState===null||k.fallback===void 0||k.unstable_avoidThisFallback===!0||(z|=1),Cr(tr,z&1),d===null?(k.fallback!==void 0&&an(_),d=k.children,z=k.fallback,Z?(d=Tu(_,d,z,w),_.child.memoizedState={baseLanes:w},_.memoizedState=J1,d):typeof k.unstable_expectedLoadTime=="number"?(d=Tu(_,d,z,w),_.child.memoizedState={baseLanes:w},_.memoizedState=J1,_.lanes=33554432,d):(w=y4({mode:"visible",children:d},_.mode,w,null),w.return=_,_.child=w)):d.memoizedState!==null?Z?(k=J2(d,_,k.children,k.fallback,w),Z=_.child,z=d.child.memoizedState,Z.memoizedState=z===null?{baseLanes:w}:{baseLanes:z.baseLanes|w},Z.childLanes=d.childLanes&~w,_.memoizedState=J1,k):(w=K2(d,_,k.children,w),_.memoizedState=null,w):Z?(k=J2(d,_,k.children,k.fallback,w),Z=_.child,z=d.child.memoizedState,Z.memoizedState=z===null?{baseLanes:w}:{baseLanes:z.baseLanes|w},Z.childLanes=d.childLanes&~w,_.memoizedState=J1,k):(w=K2(d,_,k.children,w),_.memoizedState=null,w)}function Tu(d,_,w,k){var z=d.mode,Z=d.child;return _={mode:"hidden",children:_},!(z&2)&&Z!==null?(Z.childLanes=0,Z.pendingProps=_):Z=y4(_,z,0,null),w=e3(w,z,k,null),Z.return=d,w.return=d,Z.sibling=w,d.child=Z,w}function K2(d,_,w,k){var z=d.child;return d=z.sibling,w=Na(z,{mode:"visible",children:w}),!(_.mode&2)&&(w.lanes=k),w.return=_,w.sibling=null,d!==null&&(d.nextEffect=null,d.flags=8,_.firstEffect=_.lastEffect=d),_.child=w}function J2(d,_,w,k,z){var Z=_.mode,te=d.child;d=te.sibling;var xe={mode:"hidden",children:w};return!(Z&2)&&_.child!==te?(w=_.child,w.childLanes=0,w.pendingProps=xe,te=w.lastEffect,te!==null?(_.firstEffect=w.firstEffect,_.lastEffect=te,te.nextEffect=null):_.firstEffect=_.lastEffect=null):w=Na(te,xe),d!==null?k=Na(d,k):(k=e3(k,Z,z,null),k.flags|=2),k.return=_,w.return=_,w.sibling=k,_.child=w,k}function Q2(d,_){d.lanes|=_;var w=d.alternate;w!==null&&(w.lanes|=_),Ae(d.return,_)}function i0(d,_,w,k,z,Z){var te=d.memoizedState;te===null?d.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:k,tail:w,tailMode:z,lastEffect:Z}:(te.isBackwards=_,te.rendering=null,te.renderingStartTime=0,te.last=k,te.tail=w,te.tailMode=z,te.lastEffect=Z)}function qc(d,_,w){var k=_.pendingProps,z=k.revealOrder,Z=k.tail;if(Ws(d,_,k.children,w),k=tr.current,k&2)k=k&1|2,_.flags|=64;else{if(d!==null&&d.flags&64)e:for(d=_.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&Q2(d,w);else if(d.tag===19)Q2(d,w);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===_)break e;for(;d.sibling===null;){if(d.return===null||d.return===_)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}k&=1}if(Cr(tr,k),!(_.mode&2))_.memoizedState=null;else switch(z){case"forwards":for(w=_.child,z=null;w!==null;)d=w.alternate,d!==null&&dr(d)===null&&(z=w),w=w.sibling;w=z,w===null?(z=_.child,_.child=null):(z=w.sibling,w.sibling=null),i0(_,!1,z,w,Z,_.lastEffect);break;case"backwards":for(w=null,z=_.child,_.child=null;z!==null;){if(d=z.alternate,d!==null&&dr(d)===null){_.child=z;break}d=z.sibling,z.sibling=w,w=z,z=d}i0(_,!0,w,null,Z,_.lastEffect);break;case"together":i0(_,!1,null,null,void 0,_.lastEffect);break;default:_.memoizedState=null}return _.child}function Hs(d,_,w){if(d!==null&&(_.dependencies=d.dependencies),a0|=_.lanes,w&_.childLanes){if(d!==null&&_.child!==d.child)throw Error(r(153));if(_.child!==null){for(d=_.child,w=Na(d,d.pendingProps),_.child=w,w.return=_;d.sibling!==null;)d=d.sibling,w=w.sibling=Na(d,d.pendingProps),w.return=_;w.sibling=null}return _.child}return null}var Ra,co,ml,ka;Ra=function(d,_){for(var w=_.child;w!==null;){if(w.tag===5||w.tag===6)d.appendChild(w.stateNode);else if(w.tag!==4&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===_)break;for(;w.sibling===null;){if(w.return===null||w.return===_)return;w=w.return}w.sibling.return=w.return,w=w.sibling}},co=function(){},ml=function(d,_,w,k){var z=d.memoizedProps;if(z!==k){d=_.stateNode,Ai(_r.current);var Z=null;switch(w){case"input":z=xo(d,z),k=xo(d,k),Z=[];break;case"option":z=bo(d,z),k=bo(d,k),Z=[];break;case"select":z=e({},z,{value:void 0}),k=e({},k,{value:void 0}),Z=[];break;case"textarea":z=wo(d,z),k=wo(d,k),Z=[];break;default:typeof z.onClick!="function"&&typeof k.onClick=="function"&&(d.onclick=ol)}so(w,k);var te;w=null;for(ct in z)if(!k.hasOwnProperty(ct)&&z.hasOwnProperty(ct)&&z[ct]!=null)if(ct==="style"){var xe=z[ct];for(te in xe)xe.hasOwnProperty(te)&&(w||(w={}),w[te]="")}else ct!=="dangerouslySetInnerHTML"&&ct!=="children"&&ct!=="suppressContentEditableWarning"&&ct!=="suppressHydrationWarning"&&ct!=="autoFocus"&&(u.hasOwnProperty(ct)?Z||(Z=[]):(Z=Z||[]).push(ct,null));for(ct in k){var ze=k[ct];if(xe=z!=null?z[ct]:void 0,k.hasOwnProperty(ct)&&ze!==xe&&(ze!=null||xe!=null))if(ct==="style")if(xe){for(te in xe)!xe.hasOwnProperty(te)||ze&&ze.hasOwnProperty(te)||(w||(w={}),w[te]="");for(te in ze)ze.hasOwnProperty(te)&&xe[te]!==ze[te]&&(w||(w={}),w[te]=ze[te])}else w||(Z||(Z=[]),Z.push(ct,w)),w=ze;else ct==="dangerouslySetInnerHTML"?(ze=ze?ze.__html:void 0,xe=xe?xe.__html:void 0,ze!=null&&xe!==ze&&(Z=Z||[]).push(ct,ze)):ct==="children"?typeof ze!="string"&&typeof ze!="number"||(Z=Z||[]).push(ct,""+ze):ct!=="suppressContentEditableWarning"&&ct!=="suppressHydrationWarning"&&(u.hasOwnProperty(ct)?(ze!=null&&ct==="onScroll"&&Mr("scroll",d),Z||xe===ze||(Z=[])):typeof ze=="object"&&ze!==null&&ze.$$typeof===rt?ze.toString():(Z=Z||[]).push(ct,ze))}w&&(Z=Z||[]).push("style",w);var ct=Z;(_.updateQueue=ct)&&(_.flags|=4)}},ka=function(d,_,w,k){w!==k&&(_.flags|=4)};function aa(d,_){if(!zr)switch(d.tailMode){case"hidden":_=d.tail;for(var w=null;_!==null;)_.alternate!==null&&(w=_),_=_.sibling;w===null?d.tail=null:w.sibling=null;break;case"collapsed":w=d.tail;for(var k=null;w!==null;)w.alternate!==null&&(k=w),w=w.sibling;k===null?_||d.tail===null?d.tail=null:d.tail.sibling=null:k.sibling=null}}function A6(d,_,w){var k=_.pendingProps;switch(_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Li(_.type)&&t1(),null;case 3:return gn(),Ar(es),Ar(gi),r4(),k=_.stateNode,k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(d===null||d.child===null)&&(ko(_)?_.flags|=4:k.hydrate||(_.flags|=256)),co(_),null;case 5:Rr(_);var z=Ai(Ni.current);if(w=_.type,d!==null&&_.stateNode!=null)ml(d,_,w,k,z),d.ref!==_.ref&&(_.flags|=128);else{if(!k){if(_.stateNode===null)throw Error(r(166));return null}if(d=Ai(_r.current),ko(_)){k=_.stateNode,w=_.type;var Z=_.memoizedProps;switch(k[Ta]=_,k[Uc]=Z,w){case"dialog":Mr("cancel",k),Mr("close",k);break;case"iframe":case"object":case"embed":Mr("load",k);break;case"video":case"audio":for(d=0;d<wa.length;d++)Mr(wa[d],k);break;case"source":Mr("error",k);break;case"img":case"image":case"link":Mr("error",k),Mr("load",k);break;case"details":Mr("toggle",k);break;case"input":Vo(k,Z),Mr("invalid",k);break;case"select":k._wrapperState={wasMultiple:!!Z.multiple},Mr("invalid",k);break;case"textarea":$o(k,Z),Mr("invalid",k)}so(w,Z),d=null;for(var te in Z)Z.hasOwnProperty(te)&&(z=Z[te],te==="children"?typeof z=="string"?k.textContent!==z&&(d=["children",z]):typeof z=="number"&&k.textContent!==""+z&&(d=["children",""+z]):u.hasOwnProperty(te)&&z!=null&&te==="onScroll"&&Mr("scroll",k));switch(w){case"input":Ht(k),no(k,Z,!0);break;case"textarea":Ht(k),Mi(k);break;case"select":case"option":break;default:typeof Z.onClick=="function"&&(k.onclick=ol)}k=d,_.updateQueue=k,k!==null&&(_.flags|=4)}else{switch(te=z.nodeType===9?z:z.ownerDocument,d===ro.html&&(d=io(w)),d===ro.html?w==="script"?(d=te.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof k.is=="string"?d=te.createElement(w,{is:k.is}):(d=te.createElement(w),w==="select"&&(te=d,k.multiple?te.multiple=!0:k.size&&(te.size=k.size))):d=te.createElementNS(d,w),d[Ta]=_,d[Uc]=k,Ra(d,_,!1,!1),_.stateNode=d,te=xs(w,k),w){case"dialog":Mr("cancel",d),Mr("close",d),z=k;break;case"iframe":case"object":case"embed":Mr("load",d),z=k;break;case"video":case"audio":for(z=0;z<wa.length;z++)Mr(wa[z],d);z=k;break;case"source":Mr("error",d),z=k;break;case"img":case"image":case"link":Mr("error",d),Mr("load",d),z=k;break;case"details":Mr("toggle",d),z=k;break;case"input":Vo(d,k),z=xo(d,k),Mr("invalid",d);break;case"option":z=bo(d,k);break;case"select":d._wrapperState={wasMultiple:!!k.multiple},z=e({},k,{value:void 0}),Mr("invalid",d);break;case"textarea":$o(d,k),z=wo(d,k),Mr("invalid",d);break;default:z=k}so(w,z);var xe=z;for(Z in xe)if(xe.hasOwnProperty(Z)){var ze=xe[Z];Z==="style"?Xo(d,ze):Z==="dangerouslySetInnerHTML"?(ze=ze?ze.__html:void 0,ze!=null&&Ho(d,ze)):Z==="children"?typeof ze=="string"?(w!=="textarea"||ze!=="")&&fi(d,ze):typeof ze=="number"&&fi(d,""+ze):Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&Z!=="autoFocus"&&(u.hasOwnProperty(Z)?ze!=null&&Z==="onScroll"&&Mr("scroll",d):ze!=null&&_e(d,Z,ze,te))}switch(w){case"input":Ht(d),no(d,k,!1);break;case"textarea":Ht(d),Mi(d);break;case"option":k.value!=null&&d.setAttribute("value",""+Or(k.value));break;case"select":d.multiple=!!k.multiple,Z=k.value,Z!=null?ur(d,!!k.multiple,Z,!1):k.defaultValue!=null&&ur(d,!!k.multiple,k.defaultValue,!0);break;default:typeof z.onClick=="function"&&(d.onclick=ol)}q3(w,k)&&(_.flags|=4)}_.ref!==null&&(_.flags|=128)}return null;case 6:if(d&&_.stateNode!=null)ka(d,_,d.memoizedProps,k);else{if(typeof k!="string"&&_.stateNode===null)throw Error(r(166));w=Ai(Ni.current),Ai(_r.current),ko(_)?(k=_.stateNode,w=_.memoizedProps,k[Ta]=_,k.nodeValue!==w&&(_.flags|=4)):(k=(w.nodeType===9?w:w.ownerDocument).createTextNode(k),k[Ta]=_,_.stateNode=k)}return null;case 13:return Ar(tr),k=_.memoizedState,_.flags&64?(_.lanes=w,_):(k=k!==null,w=!1,d===null?_.memoizedProps.fallback!==void 0&&ko(_):w=d.memoizedState!==null,k&&!w&&_.mode&2&&(d===null&&_.memoizedProps.unstable_avoidThisFallback!==!0||tr.current&1?vi===0&&(vi=3):((vi===0||vi===3)&&(vi=4),rs===null||!(a0&134217727)&&!(tc&134217727)||Jc(rs,ds))),(k||w)&&(_.flags|=4),null);case 4:return gn(),co(_),d===null&&t4(_.stateNode.containerInfo),null;case 10:return ie(_),null;case 17:return Li(_.type)&&t1(),null;case 19:if(Ar(tr),k=_.memoizedState,k===null)return null;if(Z=(_.flags&64)!==0,te=k.rendering,te===null)if(Z)aa(k,!1);else{if(vi!==0||d!==null&&d.flags&64)for(d=_.child;d!==null;){if(te=dr(d),te!==null){for(_.flags|=64,aa(k,!1),Z=te.updateQueue,Z!==null&&(_.updateQueue=Z,_.flags|=4),k.lastEffect===null&&(_.firstEffect=null),_.lastEffect=k.lastEffect,k=w,w=_.child;w!==null;)Z=w,d=k,Z.flags&=2,Z.nextEffect=null,Z.firstEffect=null,Z.lastEffect=null,te=Z.alternate,te===null?(Z.childLanes=0,Z.lanes=d,Z.child=null,Z.memoizedProps=null,Z.memoizedState=null,Z.updateQueue=null,Z.dependencies=null,Z.stateNode=null):(Z.childLanes=te.childLanes,Z.lanes=te.lanes,Z.child=te.child,Z.memoizedProps=te.memoizedProps,Z.memoizedState=te.memoizedState,Z.updateQueue=te.updateQueue,Z.type=te.type,d=te.dependencies,Z.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),w=w.sibling;return Cr(tr,tr.current&1|2),_.child}d=d.sibling}k.tail!==null&&x()>c0&&(_.flags|=64,Z=!0,aa(k,!1),_.lanes=33554432)}else{if(!Z)if(d=dr(te),d!==null){if(_.flags|=64,Z=!0,w=d.updateQueue,w!==null&&(_.updateQueue=w,_.flags|=4),aa(k,!0),k.tail===null&&k.tailMode==="hidden"&&!te.alternate&&!zr)return _=_.lastEffect=k.lastEffect,_!==null&&(_.nextEffect=null),null}else 2*x()-k.renderingStartTime>c0&&w!==1073741824&&(_.flags|=64,Z=!0,aa(k,!1),_.lanes=33554432);k.isBackwards?(te.sibling=_.child,_.child=te):(w=k.last,w!==null?w.sibling=te:_.child=te,k.last=te)}return k.tail!==null?(w=k.tail,k.rendering=w,k.tail=w.sibling,k.lastEffect=_.lastEffect,k.renderingStartTime=x(),w.sibling=null,_=tr.current,Cr(tr,Z?_&1|2:_&1),w):null;case 23:case 24:return ku(),d!==null&&d.memoizedState!==null!=(_.memoizedState!==null)&&k.mode!=="unstable-defer-without-hiding"&&(_.flags|=4),null}throw Error(r(156,_.tag))}function C6(d){switch(d.tag){case 1:Li(d.type)&&t1();var _=d.flags;return _&4096?(d.flags=_&-4097|64,d):null;case 3:if(gn(),Ar(es),Ar(gi),r4(),_=d.flags,_&64)throw Error(r(285));return d.flags=_&-4097|64,d;case 5:return Rr(d),null;case 13:return Ar(tr),_=d.flags,_&4096?(d.flags=_&-4097|64,d):null;case 19:return Ar(tr),null;case 4:return gn(),null;case 10:return ie(d),null;case 23:case 24:return ku(),null;default:return null}}function Eu(d,_){try{var w="",k=_;do w+=Tn(k),k=k.return;while(k);var z=w}catch(Z){z=`
Error generating stack: `+Z.message+`
`+Z.stack}return{value:d,source:_,stack:z}}function Su(d,_){try{console.error(_.value)}catch(w){setTimeout(function(){throw w})}}var e8=typeof WeakMap=="function"?WeakMap:Map;function s0(d,_,w){w=st(-1,w),w.tag=3,w.payload={element:null};var k=_.value;return w.callback=function(){_l||(_l=!0,d4=k),Su(d,_)},w}function Lo(d,_,w){w=st(-1,w),w.tag=3;var k=d.type.getDerivedStateFromError;if(typeof k=="function"){var z=_.value;w.payload=function(){return Su(d,_),k(z)}}var Z=d.stateNode;return Z!==null&&typeof Z.componentDidCatch=="function"&&(w.callback=function(){typeof k!="function"&&(Da===null?Da=new Set([this]):Da.add(this),Su(d,_));var te=_.stack;this.componentDidCatch(_.value,{componentStack:te!==null?te:""})}),w}var P6=typeof WeakSet=="function"?WeakSet:Set;function t8(d){var _=d.ref;if(_!==null)if(typeof _=="function")try{_(null)}catch(w){ca(d,w)}else _.current=null}function Gr(d,_){switch(_.tag){case 0:case 11:case 15:case 22:return;case 1:if(_.flags&256&&d!==null){var w=d.memoizedProps,k=d.memoizedState;d=_.stateNode,_=d.getSnapshotBeforeUpdate(_.elementType===_.type?w:X(_.type,w),k),d.__reactInternalSnapshotBeforeUpdate=_}return;case 3:_.flags&256&&Jl(_.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(r(163))}function Vn(d,_,w){switch(w.tag){case 0:case 11:case 15:case 22:if(_=w.updateQueue,_=_!==null?_.lastEffect:null,_!==null){d=_=_.next;do{if((d.tag&3)===3){var k=d.create;d.destroy=k()}d=d.next}while(d!==_)}if(_=w.updateQueue,_=_!==null?_.lastEffect:null,_!==null){d=_=_.next;do{var z=d;k=z.next,z=z.tag,z&4&&z&1&&(oc(w,d),D6(w,d)),d=k}while(d!==_)}return;case 1:d=w.stateNode,w.flags&4&&(_===null?d.componentDidMount():(k=w.elementType===w.type?_.memoizedProps:X(w.type,_.memoizedProps),d.componentDidUpdate(k,_.memoizedState,d.__reactInternalSnapshotBeforeUpdate))),_=w.updateQueue,_!==null&&ut(w,_,d);return;case 3:if(_=w.updateQueue,_!==null){if(d=null,w.child!==null)switch(w.child.tag){case 5:d=w.child.stateNode;break;case 1:d=w.child.stateNode}ut(w,_,d)}return;case 5:d=w.stateNode,_===null&&w.flags&4&&q3(w.type,w.memoizedProps)&&d.focus();return;case 6:return;case 4:return;case 12:return;case 13:w.memoizedState===null&&(w=w.alternate,w!==null&&(w=w.memoizedState,w!==null&&(w=w.dehydrated,w!==null&&ke(w))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(r(163))}function o1(d,_){for(var w=d;;){if(w.tag===5){var k=w.stateNode;if(_)k=k.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{k=w.stateNode;var z=w.memoizedProps.style;z=z!=null&&z.hasOwnProperty("display")?z.display:null,k.style.display=Zi("display",z)}}else if(w.tag===6)w.stateNode.nodeValue=_?"":w.memoizedProps;else if((w.tag!==23&&w.tag!==24||w.memoizedState===null||w===d)&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===d)break;for(;w.sibling===null;){if(w.return===null||w.return===d)return;w=w.return}w.sibling.return=w.return,w=w.sibling}}function Au(d,_){if(Vs&&typeof Vs.onCommitFiberUnmount=="function")try{Vs.onCommitFiberUnmount(Is,_)}catch{}switch(_.tag){case 0:case 11:case 14:case 15:case 22:if(d=_.updateQueue,d!==null&&(d=d.lastEffect,d!==null)){var w=d=d.next;do{var k=w,z=k.destroy;if(k=k.tag,z!==void 0)if(k&4)oc(_,w);else{k=_;try{z()}catch(Z){ca(k,Z)}}w=w.next}while(w!==d)}break;case 1:if(t8(_),d=_.stateNode,typeof d.componentWillUnmount=="function")try{d.props=_.memoizedProps,d.state=_.memoizedState,d.componentWillUnmount()}catch(Z){ca(_,Z)}break;case 5:t8(_);break;case 4:Fo(d,_)}}function cr(d){d.alternate=null,d.child=null,d.dependencies=null,d.firstEffect=null,d.lastEffect=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.return=null,d.updateQueue=null}function Cu(d){return d.tag===5||d.tag===3||d.tag===4}function Pu(d){e:{for(var _=d.return;_!==null;){if(Cu(_))break e;_=_.return}throw Error(r(160))}var w=_;switch(_=w.stateNode,w.tag){case 5:var k=!1;break;case 3:_=_.containerInfo,k=!0;break;case 4:_=_.containerInfo,k=!0;break;default:throw Error(r(161))}w.flags&16&&(fi(_,""),w.flags&=-17);e:t:for(w=d;;){for(;w.sibling===null;){if(w.return===null||Cu(w.return)){w=null;break e}w=w.return}for(w.sibling.return=w.return,w=w.sibling;w.tag!==5&&w.tag!==6&&w.tag!==18;){if(w.flags&2||w.child===null||w.tag===4)continue t;w.child.return=w,w=w.child}if(!(w.flags&2)){w=w.stateNode;break e}}k?a1(d,w,_):l1(d,w,_)}function a1(d,_,w){var k=d.tag,z=k===5||k===6;if(z)d=z?d.stateNode:d.stateNode.instance,_?w.nodeType===8?w.parentNode.insertBefore(d,_):w.insertBefore(d,_):(w.nodeType===8?(_=w.parentNode,_.insertBefore(d,w)):(_=w,_.appendChild(d)),w=w._reactRootContainer,w!=null||_.onclick!==null||(_.onclick=ol));else if(k!==4&&(d=d.child,d!==null))for(a1(d,_,w),d=d.sibling;d!==null;)a1(d,_,w),d=d.sibling}function l1(d,_,w){var k=d.tag,z=k===5||k===6;if(z)d=z?d.stateNode:d.stateNode.instance,_?w.insertBefore(d,_):w.appendChild(d);else if(k!==4&&(d=d.child,d!==null))for(l1(d,_,w),d=d.sibling;d!==null;)l1(d,_,w),d=d.sibling}function Fo(d,_){for(var w=_,k=!1,z,Z;;){if(!k){k=w.return;e:for(;;){if(k===null)throw Error(r(160));switch(z=k.stateNode,k.tag){case 5:Z=!1;break e;case 3:z=z.containerInfo,Z=!0;break e;case 4:z=z.containerInfo,Z=!0;break e}k=k.return}k=!0}if(w.tag===5||w.tag===6){e:for(var te=d,xe=w,ze=xe;;)if(Au(te,ze),ze.child!==null&&ze.tag!==4)ze.child.return=ze,ze=ze.child;else{if(ze===xe)break e;for(;ze.sibling===null;){if(ze.return===null||ze.return===xe)break e;ze=ze.return}ze.sibling.return=ze.return,ze=ze.sibling}Z?(te=z,xe=w.stateNode,te.nodeType===8?te.parentNode.removeChild(xe):te.removeChild(xe)):z.removeChild(w.stateNode)}else if(w.tag===4){if(w.child!==null){z=w.stateNode.containerInfo,Z=!0,w.child.return=w,w=w.child;continue}}else if(Au(d,w),w.child!==null){w.child.return=w,w=w.child;continue}if(w===_)break;for(;w.sibling===null;){if(w.return===null||w.return===_)return;w=w.return,w.tag===4&&(k=!1)}w.sibling.return=w.return,w=w.sibling}}function la(d,_){switch(_.tag){case 0:case 11:case 14:case 15:case 22:var w=_.updateQueue;if(w=w!==null?w.lastEffect:null,w!==null){var k=w=w.next;do(k.tag&3)===3&&(d=k.destroy,k.destroy=void 0,d!==void 0&&d()),k=k.next;while(k!==w)}return;case 1:return;case 5:if(w=_.stateNode,w!=null){k=_.memoizedProps;var z=d!==null?d.memoizedProps:k;d=_.type;var Z=_.updateQueue;if(_.updateQueue=null,Z!==null){for(w[Uc]=k,d==="input"&&k.type==="radio"&&k.name!=null&&to(w,k),xs(d,z),_=xs(d,k),z=0;z<Z.length;z+=2){var te=Z[z],xe=Z[z+1];te==="style"?Xo(w,xe):te==="dangerouslySetInnerHTML"?Ho(w,xe):te==="children"?fi(w,xe):_e(w,te,xe,_)}switch(d){case"input":En(w,k);break;case"textarea":Wo(w,k);break;case"select":d=w._wrapperState.wasMultiple,w._wrapperState.wasMultiple=!!k.multiple,Z=k.value,Z!=null?ur(w,!!k.multiple,Z,!1):d!==!!k.multiple&&(k.defaultValue!=null?ur(w,!!k.multiple,k.defaultValue,!0):ur(w,!!k.multiple,k.multiple?[]:"",!1))}}}return;case 6:if(_.stateNode===null)throw Error(r(162));_.stateNode.nodeValue=_.memoizedProps;return;case 3:w=_.stateNode,w.hydrate&&(w.hydrate=!1,ke(w.containerInfo));return;case 12:return;case 13:_.memoizedState!==null&&(Mu=x(),o1(_.child,!0)),uo(_);return;case 19:uo(_);return;case 17:return;case 23:case 24:o1(_,_.memoizedState!==null);return}throw Error(r(163))}function uo(d){var _=d.updateQueue;if(_!==null){d.updateQueue=null;var w=d.stateNode;w===null&&(w=d.stateNode=new P6),_.forEach(function(k){var z=g4.bind(null,d,k);w.has(k)||(w.add(k),k.then(z,z))})}}function n8(d,_){return d!==null&&(d=d.memoizedState,d===null||d.dehydrated!==null)?(_=_.memoizedState,_!==null&&_.dehydrated===null):!1}var Oa=Math.ceil,Q1=Me.ReactCurrentDispatcher,o0=Me.ReactCurrentOwner,Rn=0,rs=null,yi=null,ds=0,Ms=0,gl=ia(0),vi=0,Gc=null,ec=0,a0=0,tc=0,Iu=0,l0=null,Mu=0,c0=1/0;function nc(){c0=x()+500}var ln=null,_l=!1,d4=null,Da=null,ho=!1,c1=null,Yc=90,p4=[],Ru=[],yl=null,rc=0,fo=null,u0=-1,vl=0,h0=0,f0=null,m4=!1;function Xs(){return Rn&48?x():u0!==-1?u0:u0=x()}function La(d){if(d=d.mode,!(d&2))return 1;if(!(d&4))return E()===99?1:2;if(vl===0&&(vl=ec),$.transition!==0){h0!==0&&(h0=l0!==null?l0.pendingLanes:0),d=vl;var _=4186112&~h0;return _&=-_,_===0&&(d=4186112&~d,_=d&-d,_===0&&(_=8192)),_}return d=E(),Rn&4&&d===98?d=Ec(12,vl):(d=_a(d),d=Ec(d,vl)),d}function xl(d,_,w){if(50<rc)throw rc=0,fo=null,Error(r(185));if(d=Kc(d,_),d===null)return null;Jo(d,_,w),d===rs&&(tc|=_,vi===4&&Jc(d,ds));var k=E();_===1?Rn&8&&!(Rn&48)?d0(d):(Pi(d,w),Rn===0&&(nc(),B())):(!(Rn&4)||k!==98&&k!==99||(yl===null?yl=new Set([d]):yl.add(d)),Pi(d,w)),l0=d}function Kc(d,_){d.lanes|=_;var w=d.alternate;for(w!==null&&(w.lanes|=_),w=d,d=d.return;d!==null;)d.childLanes|=_,w=d.alternate,w!==null&&(w.childLanes|=_),w=d,d=d.return;return w.tag===3?w.stateNode:null}function Pi(d,_){for(var w=d.callbackNode,k=d.suspendedLanes,z=d.pingedLanes,Z=d.expirationTimes,te=d.pendingLanes;0<te;){var xe=31-Ss(te),ze=1<<xe,ct=Z[xe];if(ct===-1){if(!(ze&k)||ze&z){ct=_,So(ze);var Qt=rn;Z[xe]=10<=Qt?ct+250:6<=Qt?ct+5e3:-1}}else ct<=_&&(d.expiredLanes|=ze);te&=~ze}if(k=Di(d,d===rs?ds:0),_=rn,k===0)w!==null&&(w!==Wc&&H1(w),d.callbackNode=null,d.callbackPriority=0);else{if(w!==null){if(d.callbackPriority===_)return;w!==Wc&&H1(w)}_===15?(w=d0.bind(null,d),Fi===null?(Fi=[w],v=K3(Aa,j)):Fi.push(w),w=Wc):_===14?w=D(99,d0.bind(null,d)):(w=A1(_),w=D(w,Zs.bind(null,d))),d.callbackPriority=_,d.callbackNode=w}}function Zs(d){if(u0=-1,h0=vl=0,Rn&48)throw Error(r(327));var _=d.callbackNode;if(Fa()&&d.callbackNode!==_)return null;var w=Di(d,d===rs?ds:0);if(w===0)return null;var k=w,z=Rn;Rn|=16;var Z=wl();(rs!==d||ds!==k)&&(nc(),bl(d,k));do try{R6();break}catch(xe){Ou(d,xe)}while(!0);if(Pe(),Q1.current=Z,Rn=z,yi!==null?k=0:(rs=null,ds=0,k=vi),ec&tc)bl(d,0);else if(k!==0){if(k===2&&(Rn|=64,d.hydrate&&(d.hydrate=!1,Jl(d.containerInfo)),w=Ir(d),w!==0&&(k=Tl(d,w))),k===1)throw _=Gc,bl(d,0),Jc(d,w),Pi(d,x()),_;switch(d.finishedWork=d.current.alternate,d.finishedLanes=w,k){case 0:case 1:throw Error(r(345));case 2:sc(d);break;case 3:if(Jc(d,w),(w&62914560)===w&&(k=Mu+500-x(),10<k)){if(Di(d,0)!==0)break;if(z=d.suspendedLanes,(z&w)!==w){Xs(),d.pingedLanes|=d.suspendedLanes&z;break}d.timeoutHandle=Mo(sc.bind(null,d),k);break}sc(d);break;case 4:if(Jc(d,w),(w&4186112)===w)break;for(k=d.eventTimes,z=-1;0<w;){var te=31-Ss(w);Z=1<<te,te=k[te],te>z&&(z=te),w&=~Z}if(w=z,w=x()-w,w=(120>w?120:480>w?480:1080>w?1080:1920>w?1920:3e3>w?3e3:4320>w?4320:1960*Oa(w/1960))-w,10<w){d.timeoutHandle=Mo(sc.bind(null,d),w);break}sc(d);break;case 5:sc(d);break;default:throw Error(r(329))}}return Pi(d,x()),d.callbackNode===_?Zs.bind(null,d):null}function Jc(d,_){for(_&=~Iu,_&=~tc,d.suspendedLanes|=_,d.pingedLanes&=~_,d=d.expirationTimes;0<_;){var w=31-Ss(_),k=1<<w;d[w]=-1,_&=~k}}function d0(d){if(Rn&48)throw Error(r(327));if(Fa(),d===rs&&d.expiredLanes&ds){var _=ds,w=Tl(d,_);ec&tc&&(_=Di(d,_),w=Tl(d,_))}else _=Di(d,0),w=Tl(d,_);if(d.tag!==0&&w===2&&(Rn|=64,d.hydrate&&(d.hydrate=!1,Jl(d.containerInfo)),_=Ir(d),_!==0&&(w=Tl(d,_))),w===1)throw w=Gc,bl(d,0),Jc(d,_),Pi(d,x()),w;return d.finishedWork=d.current.alternate,d.finishedLanes=_,sc(d),Pi(d,x()),null}function I6(){if(yl!==null){var d=yl;yl=null,d.forEach(function(_){_.expiredLanes|=24&_.pendingLanes,Pi(_,x())})}B()}function r8(d,_){var w=Rn;Rn|=1;try{return d(_)}finally{Rn=w,Rn===0&&(nc(),B())}}function i8(d,_){var w=Rn;Rn&=-2,Rn|=8;try{return d(_)}finally{Rn=w,Rn===0&&(nc(),B())}}function ic(d,_){Cr(gl,Ms),Ms|=_,ec|=_}function ku(){Ms=gl.current,Ar(gl)}function bl(d,_){d.finishedWork=null,d.finishedLanes=0;var w=d.timeoutHandle;if(w!==-1&&(d.timeoutHandle=-1,G3(w)),yi!==null)for(w=yi.return;w!==null;){var k=w;switch(k.tag){case 1:k=k.type.childContextTypes,k!=null&&t1();break;case 3:gn(),Ar(es),Ar(gi),r4();break;case 5:Rr(k);break;case 4:gn();break;case 13:Ar(tr);break;case 19:Ar(tr);break;case 10:ie(k);break;case 23:case 24:ku()}w=w.return}rs=d,yi=Na(d.current,null),ds=Ms=ec=_,vi=0,Gc=null,Iu=tc=a0=0}function Ou(d,_){do{var w=yi;try{if(Pe(),Q3.current=n0,fl){for(var k=Mn.memoizedState;k!==null;){var z=k.queue;z!==null&&(z.pending=null),k=k.next}fl=!1}if(kr=0,ti=ns=Mn=null,Z1=!1,o0.current=null,w===null||w.return===null){vi=1,Gc=_,yi=null;break}e:{var Z=d,te=w.return,xe=w,ze=_;if(_=ds,xe.flags|=2048,xe.firstEffect=xe.lastEffect=null,ze!==null&&typeof ze=="object"&&typeof ze.then=="function"){var ct=ze;if(!(xe.mode&2)){var Qt=xe.alternate;Qt?(xe.updateQueue=Qt.updateQueue,xe.memoizedState=Qt.memoizedState,xe.lanes=Qt.lanes):(xe.updateQueue=null,xe.memoizedState=null)}var kn=(tr.current&1)!==0,Nt=te;do{var dn;if(dn=Nt.tag===13){var On=Nt.memoizedState;if(On!==null)dn=On.dehydrated!==null;else{var wn=Nt.memoizedProps;dn=wn.fallback===void 0?!1:wn.unstable_avoidThisFallback!==!0?!0:!kn}}if(dn){var tt=Nt.updateQueue;if(tt===null){var je=new Set;je.add(ct),Nt.updateQueue=je}else tt.add(ct);if(!(Nt.mode&2)){if(Nt.flags|=64,xe.flags|=16384,xe.flags&=-2981,xe.tag===1)if(xe.alternate===null)xe.tag=17;else{var Qe=st(-1,1);Qe.tag=2,It(xe,Qe)}xe.lanes|=1;break e}ze=void 0,xe=_;var St=Z.pingCache;if(St===null?(St=Z.pingCache=new e8,ze=new Set,St.set(ct,ze)):(ze=St.get(ct),ze===void 0&&(ze=new Set,St.set(ct,ze))),!ze.has(xe)){ze.add(xe);var Pt=a8.bind(null,Z,ct,xe);ct.then(Pt,Pt)}Nt.flags|=4096,Nt.lanes=_;break e}Nt=Nt.return}while(Nt!==null);ze=Error((Qr(xe.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}vi!==5&&(vi=2),ze=Eu(ze,xe),Nt=te;do{switch(Nt.tag){case 3:Z=ze,Nt.flags|=4096,_&=-_,Nt.lanes|=_;var Bn=s0(Nt,Z,_);Et(Nt,Bn);break e;case 1:Z=ze;var cn=Nt.type,Ln=Nt.stateNode;if(!(Nt.flags&64)&&(typeof cn.getDerivedStateFromError=="function"||Ln!==null&&typeof Ln.componentDidCatch=="function"&&(Da===null||!Da.has(Ln)))){Nt.flags|=4096,_&=-_,Nt.lanes|=_;var Zn=Lo(Nt,Z,_);Et(Nt,Zn);break e}}Nt=Nt.return}while(Nt!==null)}o8(w)}catch(jn){_=jn,yi===w&&w!==null&&(yi=w=w.return);continue}break}while(!0)}function wl(){var d=Q1.current;return Q1.current=n0,d===null?n0:d}function Tl(d,_){var w=Rn;Rn|=16;var k=wl();rs===d&&ds===_||bl(d,_);do try{M6();break}catch(z){Ou(d,z)}while(!0);if(Pe(),Rn=w,Q1.current=k,yi!==null)throw Error(r(261));return rs=null,ds=0,vi}function M6(){for(;yi!==null;)s8(yi)}function R6(){for(;yi!==null&&!gu();)s8(yi)}function s8(d){var _=p0(d.alternate,d,Ms);d.memoizedProps=d.pendingProps,_===null?o8(d):yi=_,o0.current=null}function o8(d){var _=d;do{var w=_.alternate;if(d=_.return,_.flags&2048){if(w=C6(_),w!==null){w.flags&=2047,yi=w;return}d!==null&&(d.firstEffect=d.lastEffect=null,d.flags|=2048)}else{if(w=A6(w,_,Ms),w!==null){yi=w;return}if(w=_,w.tag!==24&&w.tag!==23||w.memoizedState===null||Ms&1073741824||!(w.mode&4)){for(var k=0,z=w.child;z!==null;)k|=z.lanes|z.childLanes,z=z.sibling;w.childLanes=k}d!==null&&!(d.flags&2048)&&(d.firstEffect===null&&(d.firstEffect=_.firstEffect),_.lastEffect!==null&&(d.lastEffect!==null&&(d.lastEffect.nextEffect=_.firstEffect),d.lastEffect=_.lastEffect),1<_.flags&&(d.lastEffect!==null?d.lastEffect.nextEffect=_:d.firstEffect=_,d.lastEffect=_))}if(_=_.sibling,_!==null){yi=_;return}yi=_=d}while(_!==null);vi===0&&(vi=5)}function sc(d){var _=E();return I(99,k6.bind(null,d,_)),null}function k6(d,_){do Fa();while(c1!==null);if(Rn&48)throw Error(r(327));var w=d.finishedWork;if(w===null)return null;if(d.finishedWork=null,d.finishedLanes=0,w===d.current)throw Error(r(177));d.callbackNode=null;var k=w.lanes|w.childLanes,z=k,Z=d.pendingLanes&~z;d.pendingLanes=z,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=z,d.mutableReadLanes&=z,d.entangledLanes&=z,z=d.entanglements;for(var te=d.eventTimes,xe=d.expirationTimes;0<Z;){var ze=31-Ss(Z),ct=1<<ze;z[ze]=0,te[ze]=-1,xe[ze]=-1,Z&=~ct}if(yl!==null&&!(k&24)&&yl.has(d)&&yl.delete(d),d===rs&&(yi=rs=null,ds=0),1<w.flags?w.lastEffect!==null?(w.lastEffect.nextEffect=w,k=w.firstEffect):k=w:k=w.firstEffect,k!==null){if(z=Rn,Rn|=32,o0.current=null,hs=Ki,te=Fc(),tl(te)){if("selectionStart"in te)xe={start:te.selectionStart,end:te.selectionEnd};else e:if(xe=(xe=te.ownerDocument)&&xe.defaultView||window,(ct=xe.getSelection&&xe.getSelection())&&ct.rangeCount!==0){xe=ct.anchorNode,Z=ct.anchorOffset,ze=ct.focusNode,ct=ct.focusOffset;try{xe.nodeType,ze.nodeType}catch{xe=null;break e}var Qt=0,kn=-1,Nt=-1,dn=0,On=0,wn=te,tt=null;t:for(;;){for(var je;wn!==xe||Z!==0&&wn.nodeType!==3||(kn=Qt+Z),wn!==ze||ct!==0&&wn.nodeType!==3||(Nt=Qt+ct),wn.nodeType===3&&(Qt+=wn.nodeValue.length),(je=wn.firstChild)!==null;)tt=wn,wn=je;for(;;){if(wn===te)break t;if(tt===xe&&++dn===Z&&(kn=Qt),tt===ze&&++On===ct&&(Nt=Qt),(je=wn.nextSibling)!==null)break;wn=tt,tt=wn.parentNode}wn=je}xe=kn===-1||Nt===-1?null:{start:kn,end:Nt}}else xe=null;xe=xe||{start:0,end:0}}else xe=null;j1={focusedElem:te,selectionRange:xe},Ki=!1,f0=null,m4=!1,ln=k;do try{O6()}catch(jn){if(ln===null)throw Error(r(330));ca(ln,jn),ln=ln.nextEffect}while(ln!==null);f0=null,ln=k;do try{for(te=d;ln!==null;){var Qe=ln.flags;if(Qe&16&&fi(ln.stateNode,""),Qe&128){var St=ln.alternate;if(St!==null){var Pt=St.ref;Pt!==null&&(typeof Pt=="function"?Pt(null):Pt.current=null)}}switch(Qe&1038){case 2:Pu(ln),ln.flags&=-3;break;case 6:Pu(ln),ln.flags&=-3,la(ln.alternate,ln);break;case 1024:ln.flags&=-1025;break;case 1028:ln.flags&=-1025,la(ln.alternate,ln);break;case 4:la(ln.alternate,ln);break;case 8:xe=ln,Fo(te,xe);var Bn=xe.alternate;cr(xe),Bn!==null&&cr(Bn)}ln=ln.nextEffect}}catch(jn){if(ln===null)throw Error(r(330));ca(ln,jn),ln=ln.nextEffect}while(ln!==null);if(Pt=j1,St=Fc(),Qe=Pt.focusedElem,te=Pt.selectionRange,St!==Qe&&Qe&&Qe.ownerDocument&&Lc(Qe.ownerDocument.documentElement,Qe)){for(te!==null&&tl(Qe)&&(St=te.start,Pt=te.end,Pt===void 0&&(Pt=St),"selectionStart"in Qe?(Qe.selectionStart=St,Qe.selectionEnd=Math.min(Pt,Qe.value.length)):(Pt=(St=Qe.ownerDocument||document)&&St.defaultView||window,Pt.getSelection&&(Pt=Pt.getSelection(),xe=Qe.textContent.length,Bn=Math.min(te.start,xe),te=te.end===void 0?Bn:Math.min(te.end,xe),!Pt.extend&&Bn>te&&(xe=te,te=Bn,Bn=xe),xe=zs(Qe,Bn),Z=zs(Qe,te),xe&&Z&&(Pt.rangeCount!==1||Pt.anchorNode!==xe.node||Pt.anchorOffset!==xe.offset||Pt.focusNode!==Z.node||Pt.focusOffset!==Z.offset)&&(St=St.createRange(),St.setStart(xe.node,xe.offset),Pt.removeAllRanges(),Bn>te?(Pt.addRange(St),Pt.extend(Z.node,Z.offset)):(St.setEnd(Z.node,Z.offset),Pt.addRange(St)))))),St=[],Pt=Qe;Pt=Pt.parentNode;)Pt.nodeType===1&&St.push({element:Pt,left:Pt.scrollLeft,top:Pt.scrollTop});for(typeof Qe.focus=="function"&&Qe.focus(),Qe=0;Qe<St.length;Qe++)Pt=St[Qe],Pt.element.scrollLeft=Pt.left,Pt.element.scrollTop=Pt.top}Ki=!!hs,j1=hs=null,d.current=w,ln=k;do try{for(Qe=d;ln!==null;){var cn=ln.flags;if(cn&36&&Vn(Qe,ln.alternate,ln),cn&128){St=void 0;var Ln=ln.ref;if(Ln!==null){var Zn=ln.stateNode;switch(ln.tag){case 5:St=Zn;break;default:St=Zn}typeof Ln=="function"?Ln(St):Ln.current=St}}ln=ln.nextEffect}}catch(jn){if(ln===null)throw Error(r(330));ca(ln,jn),ln=ln.nextEffect}while(ln!==null);ln=null,X1(),Rn=z}else d.current=w;if(ho)ho=!1,c1=d,Yc=_;else for(ln=k;ln!==null;)_=ln.nextEffect,ln.nextEffect=null,ln.flags&8&&(cn=ln,cn.sibling=null,cn.stateNode=null),ln=_;if(k=d.pendingLanes,k===0&&(Da=null),k===1?d===fo?rc++:(rc=0,fo=d):rc=0,w=w.stateNode,Vs&&typeof Vs.onCommitFiberRoot=="function")try{Vs.onCommitFiberRoot(Is,w,void 0,(w.current.flags&64)===64)}catch{}if(Pi(d,x()),_l)throw _l=!1,d=d4,d4=null,d;return Rn&8||B(),null}function O6(){for(;ln!==null;){var d=ln.alternate;m4||f0===null||(ln.flags&8?Zr(ln,f0)&&(m4=!0):ln.tag===13&&n8(d,ln)&&Zr(ln,f0)&&(m4=!0));var _=ln.flags;_&256&&Gr(d,ln),!(_&512)||ho||(ho=!0,D(97,function(){return Fa(),null})),ln=ln.nextEffect}}function Fa(){if(Yc!==90){var d=97<Yc?97:Yc;return Yc=90,I(d,L6)}return!1}function D6(d,_){p4.push(_,d),ho||(ho=!0,D(97,function(){return Fa(),null}))}function oc(d,_){Ru.push(_,d),ho||(ho=!0,D(97,function(){return Fa(),null}))}function L6(){if(c1===null)return!1;var d=c1;if(c1=null,Rn&48)throw Error(r(331));var _=Rn;Rn|=32;var w=Ru;Ru=[];for(var k=0;k<w.length;k+=2){var z=w[k],Z=w[k+1],te=z.destroy;if(z.destroy=void 0,typeof te=="function")try{te()}catch(ze){if(Z===null)throw Error(r(330));ca(Z,ze)}}for(w=p4,p4=[],k=0;k<w.length;k+=2){z=w[k],Z=w[k+1];try{var xe=z.create;z.destroy=xe()}catch(ze){if(Z===null)throw Error(r(330));ca(Z,ze)}}for(xe=d.current.firstEffect;xe!==null;)d=xe.nextEffect,xe.nextEffect=null,xe.flags&8&&(xe.sibling=null,xe.stateNode=null),xe=d;return Rn=_,B(),!0}function Xr(d,_,w){_=Eu(w,_),_=s0(d,_,1),It(d,_),_=Xs(),d=Kc(d,1),d!==null&&(Jo(d,1,_),Pi(d,_))}function ca(d,_){if(d.tag===3)Xr(d,d,_);else for(var w=d.return;w!==null;){if(w.tag===3){Xr(w,d,_);break}else if(w.tag===1){var k=w.stateNode;if(typeof w.type.getDerivedStateFromError=="function"||typeof k.componentDidCatch=="function"&&(Da===null||!Da.has(k))){d=Eu(_,d);var z=Lo(w,d,1);if(It(w,z),z=Xs(),w=Kc(w,1),w!==null)Jo(w,1,z),Pi(w,z);else if(typeof k.componentDidCatch=="function"&&(Da===null||!Da.has(k)))try{k.componentDidCatch(_,d)}catch{}break}}w=w.return}}function a8(d,_,w){var k=d.pingCache;k!==null&&k.delete(_),_=Xs(),d.pingedLanes|=d.suspendedLanes&w,rs===d&&(ds&w)===w&&(vi===4||vi===3&&(ds&62914560)===ds&&500>x()-Mu?bl(d,0):Iu|=w),Pi(d,_)}function g4(d,_){var w=d.stateNode;w!==null&&w.delete(_),_=0,_===0&&(_=d.mode,_&2?_&4?(vl===0&&(vl=ec),_=oi(62914560&~vl),_===0&&(_=4194304)):_=E()===99?1:2:_=1),w=Xs(),d=Kc(d,_),d!==null&&(Jo(d,_,w),Pi(d,w))}var p0;p0=function(d,_,w){var k=_.lanes;if(d!==null)if(d.memoizedProps!==_.pendingProps||es.current)oa=!0;else if(w&k)oa=!!(d.flags&16384);else{switch(oa=!1,_.tag){case 3:Ma(_),Oo();break;case 5:Un(_);break;case 1:Li(_.type)&&Us(_);break;case 4:$n(_,_.stateNode.containerInfo);break;case 10:k=_.memoizedProps.value;var z=_.type._context;Cr(K,z._currentValue),z._currentValue=k;break;case 13:if(_.memoizedState!==null)return w&_.child.childLanes?wu(d,_,w):(Cr(tr,tr.current&1),_=Hs(d,_,w),_!==null?_.sibling:null);Cr(tr,tr.current&1);break;case 19:if(k=(w&_.childLanes)!==0,d.flags&64){if(k)return qc(d,_,w);_.flags|=64}if(z=_.memoizedState,z!==null&&(z.rendering=null,z.tail=null,z.lastEffect=null),Cr(tr,tr.current),k)break;return null;case 23:case 24:return _.lanes=0,bu(d,_,w)}return Hs(d,_,w)}else oa=!1;switch(_.lanes=0,_.tag){case 2:if(k=_.type,d!==null&&(d.alternate=null,_.alternate=null,_.flags|=2),d=_.pendingProps,z=Sa(_,gi.current),Se(_,w),z=Hc(null,_,k,d,z,w),_.flags|=1,typeof z=="object"&&z!==null&&typeof z.render=="function"&&z.$$typeof===void 0){if(_.tag=1,_.memoizedState=null,_.updateQueue=null,Li(k)){var Z=!0;Us(_)}else Z=!1;_.memoizedState=z.state!==null&&z.state!==void 0?z.state:null,Ie(_);var te=k.getDerivedStateFromProps;typeof te=="function"&&vt(_,k,te,d),z.updater=dt,_.stateNode=z,z._reactInternals=_,Rt(_,k,d,w),_=Zc(null,_,k,!0,Z,w)}else _.tag=0,Ws(null,_,z,w),_=_.child;return _;case 16:z=_.elementType;e:{switch(d!==null&&(d.alternate=null,_.alternate=null,_.flags|=2),d=_.pendingProps,Z=z._init,z=Z(z._payload),_.type=z,Z=_.tag=g0(z),d=X(z,d),Z){case 0:_=h4(null,_,z,d,w);break e;case 1:_=f4(null,_,z,d,w);break e;case 11:_=xu(null,_,z,d,w);break e;case 14:_=Y2(null,_,z,X(z.type,d),k,w);break e}throw Error(r(306,z,""))}return _;case 0:return k=_.type,z=_.pendingProps,z=_.elementType===k?z:X(k,z),h4(d,_,k,z,w);case 1:return k=_.type,z=_.pendingProps,z=_.elementType===k?z:X(k,z),f4(d,_,k,z,w);case 3:if(Ma(_),k=_.updateQueue,d===null||k===null)throw Error(r(282));if(k=_.pendingProps,z=_.memoizedState,z=z!==null?z.element:null,Ke(d,_),bt(_,k,null,w),k=_.memoizedState.element,k===z)Oo(),_=Hs(d,_,w);else{if(z=_.stateNode,(Z=z.hydrate)&&(js=ta(_.stateNode.containerInfo.firstChild),qr=_,Z=zr=!0),Z){if(d=z.mutableSourceEagerHydrationData,d!=null)for(z=0;z<d.length;z+=2)Z=d[z],Z._workInProgressVersionPrimary=d[z+1],Hr.push(Z);for(w=Nn(_,null,k,w),_.child=w;w;)w.flags=w.flags&-3|1024,w=w.sibling}else Ws(d,_,k,w),Oo();_=_.child}return _;case 5:return Un(_),d===null&&an(_),k=_.type,z=_.pendingProps,Z=d!==null?d.memoizedProps:null,te=z.children,Kl(k,z)?te=null:Z!==null&&Kl(k,Z)&&(_.flags|=16),r0(d,_),Ws(d,_,te,w),_.child;case 6:return d===null&&an(_),null;case 13:return wu(d,_,w);case 4:return $n(_,_.stateNode.containerInfo),k=_.pendingProps,d===null?_.child=mn(_,null,k,w):Ws(d,_,k,w),_.child;case 11:return k=_.type,z=_.pendingProps,z=_.elementType===k?z:X(k,z),xu(d,_,k,z,w);case 7:return Ws(d,_,_.pendingProps,w),_.child;case 8:return Ws(d,_,_.pendingProps.children,w),_.child;case 12:return Ws(d,_,_.pendingProps.children,w),_.child;case 10:e:{k=_.type._context,z=_.pendingProps,te=_.memoizedProps,Z=z.value;var xe=_.type._context;if(Cr(K,xe._currentValue),xe._currentValue=Z,te!==null)if(xe=te.value,Z=us(xe,Z)?0:(typeof k._calculateChangedBits=="function"?k._calculateChangedBits(xe,Z):1073741823)|0,Z===0){if(te.children===z.children&&!es.current){_=Hs(d,_,w);break e}}else for(xe=_.child,xe!==null&&(xe.return=_);xe!==null;){var ze=xe.dependencies;if(ze!==null){te=xe.child;for(var ct=ze.firstContext;ct!==null;){if(ct.context===k&&ct.observedBits&Z){xe.tag===1&&(ct=st(-1,w&-w),ct.tag=2,It(xe,ct)),xe.lanes|=w,ct=xe.alternate,ct!==null&&(ct.lanes|=w),Ae(xe.return,w),ze.lanes|=w;break}ct=ct.next}}else te=xe.tag===10&&xe.type===_.type?null:xe.child;if(te!==null)te.return=xe;else for(te=xe;te!==null;){if(te===_){te=null;break}if(xe=te.sibling,xe!==null){xe.return=te.return,te=xe;break}te=te.return}xe=te}Ws(d,_,z.children,w),_=_.child}return _;case 9:return z=_.type,Z=_.pendingProps,k=Z.children,Se(_,w),z=be(z,Z.unstable_observedBits),k=k(z),_.flags|=1,Ws(d,_,k,w),_.child;case 14:return z=_.type,Z=X(z,_.pendingProps),Z=X(z.type,Z),Y2(d,_,z,Z,k,w);case 15:return Xc(d,_,_.type,_.pendingProps,k,w);case 17:return k=_.type,z=_.pendingProps,z=_.elementType===k?z:X(k,z),d!==null&&(d.alternate=null,_.alternate=null,_.flags|=2),_.tag=1,Li(k)?(d=!0,Us(_)):d=!1,Se(_,w),hn(_,k,z),Rt(_,k,z,w),Zc(null,_,k,!0,d,w);case 19:return qc(d,_,w);case 23:return bu(d,_,w);case 24:return bu(d,_,w)}throw Error(r(156,_.tag))};function m0(d,_,w,k){this.tag=d,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=k,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function po(d,_,w,k){return new m0(d,_,w,k)}function _4(d){return d=d.prototype,!(!d||!d.isReactComponent)}function g0(d){if(typeof d=="function")return _4(d)?1:0;if(d!=null){if(d=d.$$typeof,d===$t)return 11;if(d===Oe)return 14}return 2}function Na(d,_){var w=d.alternate;return w===null?(w=po(d.tag,_,d.key,d.mode),w.elementType=d.elementType,w.type=d.type,w.stateNode=d.stateNode,w.alternate=d,d.alternate=w):(w.pendingProps=_,w.type=d.type,w.flags=0,w.nextEffect=null,w.firstEffect=null,w.lastEffect=null),w.childLanes=d.childLanes,w.lanes=d.lanes,w.child=d.child,w.memoizedProps=d.memoizedProps,w.memoizedState=d.memoizedState,w.updateQueue=d.updateQueue,_=d.dependencies,w.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},w.sibling=d.sibling,w.index=d.index,w.ref=d.ref,w}function Qc(d,_,w,k,z,Z){var te=2;if(k=d,typeof d=="function")_4(d)&&(te=1);else if(typeof d=="string")te=5;else e:switch(d){case xt:return e3(w.children,z,Z,_);case at:te=8,z|=16;break;case ht:te=8,z|=1;break;case kt:return d=po(12,w,_,z|8),d.elementType=kt,d.type=kt,d.lanes=Z,d;case Ct:return d=po(13,w,_,z),d.type=Ct,d.elementType=Ct,d.lanes=Z,d;case xn:return d=po(19,w,_,z),d.elementType=xn,d.lanes=Z,d;case Ne:return y4(w,z,Z,_);case Be:return d=po(24,w,_,z),d.elementType=Be,d.lanes=Z,d;default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case Bt:te=10;break e;case Vt:te=9;break e;case $t:te=11;break e;case Oe:te=14;break e;case ce:te=16,k=null;break e;case ve:te=22;break e}throw Error(r(130,d==null?d:typeof d,""))}return _=po(te,w,_,z),_.elementType=d,_.type=k,_.lanes=Z,_}function e3(d,_,w,k){return d=po(7,d,k,_),d.lanes=w,d}function y4(d,_,w,k){return d=po(23,d,k,_),d.elementType=Ne,d.lanes=w,d}function ac(d,_,w){return d=po(6,d,null,_),d.lanes=w,d}function _0(d,_,w){return _=po(4,d.children!==null?d.children:[],d.key,_),_.lanes=w,_.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},_}function F6(d,_,w){this.tag=_,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=w,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=zl(0),this.expirationTimes=zl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zl(0),this.mutableSourceEagerHydrationData=null}function Du(d,_,w){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yt,key:k==null?null:""+k,children:d,containerInfo:_,implementation:w}}function t3(d,_,w,k){var z=_.current,Z=Xs(),te=La(z);e:if(w){w=w._reactInternals;t:{if(Xn(w)!==w||w.tag!==1)throw Error(r(170));var xe=w;do{switch(xe.tag){case 3:xe=xe.stateNode.context;break t;case 1:if(Li(xe.type)){xe=xe.stateNode.__reactInternalMemoizedMergedChildContext;break t}}xe=xe.return}while(xe!==null);throw Error(r(171))}if(w.tag===1){var ze=w.type;if(Li(ze)){w=$c(w,ze,xe);break e}}w=xe}else w=Ps;return _.context===null?_.context=w:_.pendingContext=w,_=st(Z,te),_.payload={element:d},k=k===void 0?null:k,k!==null&&(_.callback=k),It(z,_),xl(z,te,Z),te}function n3(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function l8(d,_){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var w=d.retryLane;d.retryLane=w!==0&&w<_?w:_}}function Lu(d,_){l8(d,_),(d=d.alternate)&&l8(d,_)}function Fu(d,_,w){var k=w!=null&&w.hydrationOptions!=null&&w.hydrationOptions.mutableSources||null;if(w=new F6(d,_,w!=null&&w.hydrate===!0),_=po(3,null,null,_===2?7:_===1?3:0),w.current=_,_.stateNode=w,Ie(_),d[Ea]=w.current,t4(d.nodeType===8?d.parentNode:d),k)for(d=0;d<k.length;d++){_=k[d];var z=_._getVersion;z=z(_._source),w.mutableSourceEagerHydrationData==null?w.mutableSourceEagerHydrationData=[_,z]:w.mutableSourceEagerHydrationData.push(_,z)}this._internalRoot=w}Fu.prototype.render=function(d){t3(d,this._internalRoot,null,null)},Fu.prototype.unmount=function(){var d=this._internalRoot,_=d.containerInfo;t3(null,d,null,function(){_[Ea]=null})};function y0(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function N6(d,_){if(_||(_=d?d.nodeType===9?d.documentElement:d.firstChild:null,_=!(!_||_.nodeType!==1||!_.hasAttribute("data-reactroot"))),!_)for(var w;w=d.lastChild;)d.removeChild(w);return new Fu(d,0,_?{hydrate:!0}:void 0)}function v0(d,_,w,k,z){var Z=w._reactRootContainer;if(Z){var te=Z._internalRoot;if(typeof z=="function"){var xe=z;z=function(){var ct=n3(te);xe.call(ct)}}t3(_,te,d,z)}else{if(Z=w._reactRootContainer=N6(w,k),te=Z._internalRoot,typeof z=="function"){var ze=z;z=function(){var ct=n3(te);ze.call(ct)}}i8(function(){t3(_,te,d,z)})}return n3(te)}oo=function(d){if(d.tag===13){var _=Xs();xl(d,4,_),Lu(d,4)}},Yi=function(d){if(d.tag===13){var _=Xs();xl(d,67108864,_),Lu(d,67108864)}},ls=function(d){if(d.tag===13){var _=Xs(),w=La(d);xl(d,w,_),Lu(d,w)}},qo=function(d,_){return _()},qi=function(d,_,w){switch(_){case"input":if(En(d,w),_=w.name,w.type==="radio"&&_!=null){for(w=d;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<w.length;_++){var k=w[_];if(k!==d&&k.form===d.form){var z=ll(k);if(!z)throw Error(r(90));pn(k),En(k,z)}}}break;case"textarea":Wo(d,w);break;case"select":_=w.value,_!=null&&ur(d,!!w.multiple,_,!1)}},W=r8,G=function(d,_,w,k,z){var Z=Rn;Rn|=4;try{return I(98,d.bind(null,_,w,k,z))}finally{Rn=Z,Rn===0&&(nc(),B())}},he=function(){!(Rn&49)&&(I6(),Fa())},ye=function(d,_){var w=Rn;Rn|=2;try{return d(_)}finally{Rn=w,Rn===0&&(nc(),B())}};function lc(d,_){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!y0(_))throw Error(r(200));return Du(d,_,null,w)}var B6={Events:[e1,al,ll,Ri,de,Fa,{current:!1}]},x0={findFiberByHostInstance:ra,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},c8={bundleType:x0.bundleType,version:x0.version,rendererPackageName:x0.rendererPackageName,rendererConfig:x0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Me.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=br(d),d===null?null:d.stateNode},findFiberByHostInstance:x0.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var b0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!b0.isDisabled&&b0.supportsFiber)try{Is=b0.inject(c8),Vs=b0}catch{}}return ha.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B6,ha.createPortal=lc,ha.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var _=d._reactInternals;if(_===void 0)throw typeof d.render=="function"?Error(r(188)):Error(r(268,Object.keys(d)));return d=br(_),d=d===null?null:d.stateNode,d},ha.flushSync=function(d,_){var w=Rn;if(w&48)return d(_);Rn|=1;try{if(d)return I(99,d.bind(null,_))}finally{Rn=w,B()}},ha.hydrate=function(d,_,w){if(!y0(_))throw Error(r(200));return v0(null,d,_,!0,w)},ha.render=function(d,_,w){if(!y0(_))throw Error(r(200));return v0(null,d,_,!1,w)},ha.unmountComponentAtNode=function(d){if(!y0(d))throw Error(r(40));return d._reactRootContainer?(i8(function(){v0(null,null,d,!1,function(){d._reactRootContainer=null,d[Ea]=null})}),!0):!1},ha.unstable_batchedUpdates=r8,ha.unstable_createPortal=function(d,_){return lc(d,_,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)},ha.unstable_renderSubtreeIntoContainer=function(d,_,w,k){if(!y0(w))throw Error(r(200));if(d==null||d._reactInternals===void 0)throw Error(r(38));return v0(d,_,w,!1,k)},ha.version="17.0.2",ha}var sp;function Pw(){if(sp)return T5.exports;sp=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),T5.exports=Cw(),T5.exports}var Iw=Pw();const Mw=L2(Iw);var qu={},A5={},op;function Rw(){return op||(op=1,Object.defineProperty(A5,"__esModule",{value:!0})),A5}var Gu={},Kr={},Yu={},Ku={},Ju={},Qu={},ap;function kw(){if(ap)return Qu;ap=1,Object.defineProperty(Qu,"__esModule",{value:!0}),Qu.validateConfigId=void 0;function n(e,t){e===void 0&&console.warn(`Invalid config ${t}: ${e}`)}return Qu.validateConfigId=n,Qu}const Ow="@sigmacomputing/plugin",Dw="1.0.6",Lw="Sigma Computing Plugin Client API",Fw="MIT",Nw="https://github.com/sigmacomputing/plugin",Bw="./dist/index.js",zw={type:"git",url:"https://github.com/sigmacomputing/plugin.git"},Uw={email:"support@sigmacomputing.com",url:"https://github.com/sigmacomputing/plugin/issues"},Vw="yarn@4.4.1",jw=["dist/*"],$w={"*":{react:["dist/react/index.d.ts"]}},Ww={build:"yarn tsc --build tsconfig.build.json","build:watch":"yarn build --watch",format:"prettier --write 'src/**/*.{ts,tsx}' 'jest.config.ts'",precommit:"lint-staged",prepublish:"yarn build",test:"jest --ci","test:watch":"yarn test --watch"},Hw={react:"^16.8.0 || ^17.0.0 || ^18.0.0","react-dom":"^16.8.0 || ^17.0.0 || ^18.0.0"},Xw={"@jest/types":"^27.5.1","@types/jest":"^27.5.1","@types/node":"^18.7.14","@types/react":"^18.0.18","@types/react-dom":"^18.0.6",jest:"^27.5.1","jest-watch-typeahead":"^2.1.1","lint-staged":"^13.0.3",prettier:"^2.7.1","ts-jest":"^27.1.4",typescript:"^4.8.2"},Zw={name:Ow,version:Dw,description:Lw,license:Fw,homepage:Nw,main:Bw,repository:zw,bugs:Uw,packageManager:Vw,files:jw,typesVersions:$w,scripts:Ww,peerDependencies:Hw,devDependencies:Xw};var lp;function qw(){if(lp)return Ju;lp=1,Object.defineProperty(Ju,"__esModule",{value:!0}),Ju.initialize=void 0;const n=kw();function e(){const t={config:{}};let r={},s={};const u={},f={};for(const[O,U]of new URL(document.location.toString()).searchParams.entries())t[O]=JSON.parse(U);const m=O=>{C(O.data.type,O.data.result,O.data.error)};window.addEventListener("message",m,!1),window.addEventListener("click",()=>R("wb:plugin:focus")),o("wb:plugin:config:update",O=>{var U;Object.assign(t,O),C("config",(U=t.config)!==null&&U!==void 0?U:{})}),R("wb:plugin:init",Zw.version).then(O=>{Object.assign(t,O),C("init",t),C("config",t.config)}),o("wb:plugin:variable:update",O=>{s={},Object.assign(s,O)}),o("wb:plugin:selection:update",O=>{r={},Object.assign(r,O)}),o("wb:plugin:action-effect:invoke",O=>{const U=u[O];if(!U)throw new Error(`Unknown action effect with name: ${O}`);U()});function o(O,U){f[O]=f[O]||[],f[O].push(U)}function T(O,U){f[O]!=null&&(f[O]=f[O].filter(V=>V!==U))}function C(O,...U){Object.values(f[O]||[]).forEach(V=>V(...U))}function R(O,...U){return new Promise((V,Y)=>{var ee;const le=(Ee,ue)=>{ue?Y(ue):V(Ee),T(O,le)};o(O,le),window.parent.postMessage({type:O,args:U,elementId:t.id},(ee=t==null?void 0:t.wbOrigin)!==null&&ee!==void 0?ee:"*")})}return{get sigmaEnv(){return t.sigmaEnv},get isScreenshot(){return t.screenshot},config:{getKey(O){var U;return(U=t==null?void 0:t.config)===null||U===void 0?void 0:U[O]},get(){return t.config},set(O){R("wb:plugin:config:update",O)},setKey(O,U){R("wb:plugin:config:update",{[O]:U})},subscribe(O){return o("config",O),()=>T("config",O)},getVariable(O){return(0,n.validateConfigId)(O,"variable"),s[O]},setVariable(O,...U){(0,n.validateConfigId)(O,"variable"),R("wb:plugin:variable:set",O,...U)},getInteraction(O){return(0,n.validateConfigId)(O,"interaction"),r[O]},setInteraction(O,U,V){(0,n.validateConfigId)(O,"interaction"),R("wb:plugin:selection:set",O,U,V)},triggerAction(O){(0,n.validateConfigId)(O,"action-trigger"),R("wb:plugin:action-trigger:invoke",O)},registerEffect(O,U){return(0,n.validateConfigId)(O,"action-effect"),u[O]=U,()=>{delete u[O]}},configureEditorPanel(O){R("wb:plugin:config:inspector",O)},setLoadingState(O){R("wb:plugin:config:loading-state",O)},subscribeToWorkbookVariable(O,U){(0,n.validateConfigId)(O,"variable");const V=Y=>{U(Y[O])};return o("wb:plugin:variable:update",V),()=>{T("wb:plugin:variable:update",V)}},subscribeToWorkbookInteraction(O,U){(0,n.validateConfigId)(O,"interaction");const V=Y=>{U(Y[O])};return o("wb:plugin:selection:update",V),()=>{T("wb:plugin:selection:update",V)}}},elements:{getElementColumns(O){return(0,n.validateConfigId)(O,"element"),R("wb:plugin:element:columns:get",O)},subscribeToElementColumns(O,U){(0,n.validateConfigId)(O,"element");const V=`wb:plugin:element:${O}:columns`;return o(V,U),R("wb:plugin:element:subscribe:columns",O),()=>{T(V,U),R("wb:plugin:element:unsubscribe:columns",O)}},subscribeToElementData(O,U){(0,n.validateConfigId)(O,"element");const V=`wb:plugin:element:${O}:data`;return o(V,U),R("wb:plugin:element:subscribe:data",O),()=>{T(V,U),R("wb:plugin:element:unsubscribe:data",O)}},fetchMoreElementData(O){(0,n.validateConfigId)(O,"element"),R("wb:plugin:element:fetch-more",O)}},destroy(){Object.keys(f).forEach(O=>delete f[O]),window.removeEventListener("message",m,!1)}}}return Ju.initialize=e,Ju}var cp;function ry(){if(cp)return Ku;cp=1,Object.defineProperty(Ku,"__esModule",{value:!0}),Ku.client=void 0;const n=qw();return Ku.client=(0,n.initialize)(),Ku}var up;function iy(){if(up)return Yu;up=1,Object.defineProperty(Yu,"__esModule",{value:!0}),Yu.PluginContext=void 0;const n=F2(),e=ry();return Yu.PluginContext=(0,n.createContext)(e.client),Yu}var e2={},hp;function Gw(){if(hp)return e2;hp=1,Object.defineProperty(e2,"__esModule",{value:!0}),e2.deepEqual=void 0;function n(t){return typeof t=="object"&&t!=null}function e(t,r){if(t===r)return!0;if(n(t)&&n(r)){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const s in t)if(!e(t[s],r[s]))return!1;return!0}}return e2.deepEqual=e,e2}var fp;function Yw(){if(fp)return Kr;fp=1,Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.useActionEffect=Kr.useActionTrigger=Kr.useInteraction=Kr.useVariable=Kr.useConfig=Kr.usePaginatedElementData=Kr.useElementData=Kr.useElementColumns=Kr.useLoadingState=Kr.useEditorPanelConfig=Kr.usePlugin=void 0;const n=F2(),e=iy(),t=Gw();function r(){return(0,n.useContext)(e.PluginContext)}Kr.usePlugin=r;function s(V){const Y=r(),ee=(0,n.useRef)({});(0,n.useEffect)(()=>{V!=null&&((0,t.deepEqual)(V,ee.current)||(Y.config.configureEditorPanel(V),ee.current=V))},[Y,V])}Kr.useEditorPanelConfig=s;function u(V){const Y=r(),[ee,le]=(0,n.useState)(()=>(Y.config.setLoadingState(V),V));return[ee,Ee=>{Ee!==ee&&(le(Ee),Y.config.setLoadingState(Ee))}]}Kr.useLoadingState=u;function f(V){const Y=r(),[ee,le]=(0,n.useState)({});return(0,n.useEffect)(()=>{if(V)return Y.elements.subscribeToElementColumns(V,le)},[Y,V]),ee}Kr.useElementColumns=f;function m(V){const Y=r(),[ee,le]=(0,n.useState)({});return(0,n.useEffect)(()=>{if(V)return Y.elements.subscribeToElementData(V,le)},[Y,V]),ee}Kr.useElementData=m;function o(V){const Y=r(),[ee,le]=(0,n.useState)({}),Ee=(0,n.useCallback)(()=>{V&&Y.elements.fetchMoreElementData(V)},[V]);return(0,n.useEffect)(()=>{if(V)return Y.elements.subscribeToElementData(V,le)},[Y,V]),[ee,Ee]}Kr.usePaginatedElementData=o;function T(V){const Y=r(),[ee,le]=(0,n.useState)(V!=null?Y.config.getKey(V):Y.config.get());return(0,n.useEffect)(()=>Y.config.subscribe(Ee=>{V!=null&&Ee[V]!==ee[V]?le(Ee[V]):le(Ee)}),[Y]),ee}Kr.useConfig=T;function C(V){const Y=r(),[ee,le]=(0,n.useState)();(0,n.useEffect)(()=>Y.config.subscribeToWorkbookVariable(V,le),[Y,V]);const Ee=(0,n.useCallback)((...ue)=>Y.config.setVariable(V,...ue),[V]);return[ee,Ee]}Kr.useVariable=C;function R(V,Y){const ee=r(),[le,Ee]=(0,n.useState)();(0,n.useEffect)(()=>ee.config.subscribeToWorkbookInteraction(V,Ee),[ee,V]);const ue=(0,n.useCallback)(_e=>{ee.config.setInteraction(V,Y,_e)},[V]);return[le,ue]}Kr.useInteraction=R;function O(V){const Y=r();return(0,n.useCallback)(()=>{Y.config.triggerAction(V)},[Y,V])}Kr.useActionTrigger=O;function U(V,Y){const ee=r(),le=(0,n.useRef)(Y);(0,n.useEffect)(()=>{le.current=Y}),(0,n.useEffect)(()=>ee.config.registerEffect(V,le.current),[ee,V,Y])}return Kr.useActionEffect=U,Kr}var t2={},dp;function Kw(){if(dp)return t2;dp=1,Object.defineProperty(t2,"__esModule",{value:!0}),t2.SigmaClientProvider=void 0;const n=ny(),e=iy();function t(r){return(0,n.jsx)(e.PluginContext.Provider,Object.assign({value:r.client},{children:r.children}))}return t2.SigmaClientProvider=t,t2}var pp;function Jw(){return pp||(pp=1,function(n){var e=Gu.__createBinding||(Object.create?function(s,u,f,m){m===void 0&&(m=f);var o=Object.getOwnPropertyDescriptor(u,f);(!o||("get"in o?!u.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return u[f]}}),Object.defineProperty(s,m,o)}:function(s,u,f,m){m===void 0&&(m=f),s[m]=u[f]}),t=Gu.__exportStar||function(s,u){for(var f in s)f!=="default"&&!Object.prototype.hasOwnProperty.call(u,f)&&e(u,s,f)};Object.defineProperty(n,"__esModule",{value:!0}),n.SigmaClientProvider=void 0,t(Yw(),n);var r=Kw();Object.defineProperty(n,"SigmaClientProvider",{enumerable:!0,get:function(){return r.SigmaClientProvider}})}(Gu)),Gu}var n2={},mp;function Qw(){if(mp)return n2;mp=1,Object.defineProperty(n2,"__esModule",{value:!0}),n2.polyfillRequestAnimationFrame=void 0;function n(e){"requestAnimationFrame"in e&&(e.requestAnimationFrame=t=>e.setTimeout(t,1e3/60),e.cancelAnimationFrame=t=>e.clearTimeout(t))}return n2.polyfillRequestAnimationFrame=n,n2}var gp;function eT(){return gp||(gp=1,function(n){var e=qu.__createBinding||(Object.create?function(s,u,f,m){m===void 0&&(m=f);var o=Object.getOwnPropertyDescriptor(u,f);(!o||("get"in o?!u.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return u[f]}}),Object.defineProperty(s,m,o)}:function(s,u,f,m){m===void 0&&(m=f),s[m]=u[f]}),t=qu.__exportStar||function(s,u){for(var f in s)f!=="default"&&!Object.prototype.hasOwnProperty.call(u,f)&&e(u,s,f)};Object.defineProperty(n,"__esModule",{value:!0}),n.polyfillRequestAnimationFrame=void 0,t(Rw(),n),t(Jw(),n),t(ry(),n);var r=Qw();Object.defineProperty(n,"polyfillRequestAnimationFrame",{enumerable:!0,get:function(){return r.polyfillRequestAnimationFrame}})}(qu)),qu}var E9=eT();function p7(){return p7=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},p7.apply(this,arguments)}function S9(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function tT(n){if(Array.isArray(n))return S9(n)}function nT(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function sy(n,e){if(n){if(typeof n=="string")return S9(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return S9(n,e)}}function rT(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iT(n){return tT(n)||nT(n)||sy(n)||rT()}function Dn(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var C5={exports:{}},P5,_p;function sT(){if(_p)return P5;_p=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return P5=n,P5}var I5,yp;function oT(){if(yp)return I5;yp=1;var n=sT();function e(){}function t(){}return t.resetWarningCache=e,I5=function(){function r(f,m,o,T,C,R){if(R!==n){var O=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw O.name="Invariant Violation",O}}r.isRequired=r;function s(){return r}var u={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:s,element:r,elementType:r,instanceOf:s,node:r,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:t,resetWarningCache:e};return u.PropTypes=u,u},I5}var vp;function aT(){return vp||(vp=1,C5.exports=oT()()),C5.exports}var et=aT();function lT(n){if(Array.isArray(n))return n}function cT(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r=[],s=!0,u=!1,f,m;try{for(t=t.call(n);!(s=(f=t.next()).done)&&(r.push(f.value),!(e&&r.length===e));s=!0);}catch(o){u=!0,m=o}finally{try{!s&&t.return!=null&&t.return()}finally{if(u)throw m}}return r}}function uT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Hi(n,e){return lT(n)||cT(n,e)||sy(n,e)||uT()}var Ys=1e-6,J4=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function hT(){var n=new J4(4);return J4!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function fT(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function dT(n,e,t){var r=e[0],s=e[1],u=e[2],f=e[3];return n[0]=t[0]*r+t[4]*s+t[8]*u+t[12]*f,n[1]=t[1]*r+t[5]*s+t[9]*u+t[13]*f,n[2]=t[2]*r+t[6]*s+t[10]*u+t[14]*f,n[3]=t[3]*r+t[7]*s+t[11]*u+t[15]*f,n}(function(){var n=hT();return function(e,t,r,s,u,f){var m,o;for(t||(t=4),r||(r=0),s?o=Math.min(s*t+r,e.length):o=e.length,m=r;m<o;m+=t)n[0]=e[m],n[1]=e[m+1],n[2]=e[m+2],n[3]=e[m+3],u(n,n,f),e[m]=n[0],e[m+1]=n[1],e[m+2]=n[2],e[m+3]=n[3];return e}})();function Q8(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Z4(n,e){const t=dT([],e,n);return fT(t,t,1/t[3]),t}function xp(n,e){const t=n%e;return t<0?e+t:t}function pT(n,e,t){return t*e+(1-t)*n}function bp(n,e,t){return n<e?e:n>t?t:n}function mT(n){return Math.log(n)*Math.LOG2E}const Dh=Math.log2||mT;function gT(n,e){var t=e[0],r=e[1],s=e[2],u=e[3],f=e[4],m=e[5],o=e[6],T=e[7],C=e[8],R=e[9],O=e[10],U=e[11],V=e[12],Y=e[13],ee=e[14],le=e[15],Ee=t*m-r*f,ue=t*o-s*f,_e=t*T-u*f,Me=r*o-s*m,Fe=r*T-u*m,yt=s*T-u*o,xt=C*Y-R*V,ht=C*ee-O*V,kt=C*le-U*V,Bt=R*ee-O*Y,Vt=R*le-U*Y,$t=O*le-U*ee,Ct=Ee*$t-ue*Vt+_e*Bt+Me*kt-Fe*ht+yt*xt;return Ct?(Ct=1/Ct,n[0]=(m*$t-o*Vt+T*Bt)*Ct,n[1]=(s*Vt-r*$t-u*Bt)*Ct,n[2]=(Y*yt-ee*Fe+le*Me)*Ct,n[3]=(O*Fe-R*yt-U*Me)*Ct,n[4]=(o*kt-f*$t-T*ht)*Ct,n[5]=(t*$t-s*kt+u*ht)*Ct,n[6]=(ee*_e-V*yt-le*ue)*Ct,n[7]=(C*yt-O*_e+U*ue)*Ct,n[8]=(f*Vt-m*kt+T*xt)*Ct,n[9]=(r*kt-t*Vt-u*xt)*Ct,n[10]=(V*Fe-Y*_e+le*Ee)*Ct,n[11]=(R*_e-C*Fe-U*Ee)*Ct,n[12]=(m*ht-f*Bt-o*xt)*Ct,n[13]=(t*Bt-r*ht+s*xt)*Ct,n[14]=(Y*ue-V*Me-ee*Ee)*Ct,n[15]=(C*Me-R*ue+O*Ee)*Ct,n):null}function M5(n,e,t){var r=e[0],s=e[1],u=e[2],f=e[3],m=e[4],o=e[5],T=e[6],C=e[7],R=e[8],O=e[9],U=e[10],V=e[11],Y=e[12],ee=e[13],le=e[14],Ee=e[15],ue=t[0],_e=t[1],Me=t[2],Fe=t[3];return n[0]=ue*r+_e*m+Me*R+Fe*Y,n[1]=ue*s+_e*o+Me*O+Fe*ee,n[2]=ue*u+_e*T+Me*U+Fe*le,n[3]=ue*f+_e*C+Me*V+Fe*Ee,ue=t[4],_e=t[5],Me=t[6],Fe=t[7],n[4]=ue*r+_e*m+Me*R+Fe*Y,n[5]=ue*s+_e*o+Me*O+Fe*ee,n[6]=ue*u+_e*T+Me*U+Fe*le,n[7]=ue*f+_e*C+Me*V+Fe*Ee,ue=t[8],_e=t[9],Me=t[10],Fe=t[11],n[8]=ue*r+_e*m+Me*R+Fe*Y,n[9]=ue*s+_e*o+Me*O+Fe*ee,n[10]=ue*u+_e*T+Me*U+Fe*le,n[11]=ue*f+_e*C+Me*V+Fe*Ee,ue=t[12],_e=t[13],Me=t[14],Fe=t[15],n[12]=ue*r+_e*m+Me*R+Fe*Y,n[13]=ue*s+_e*o+Me*O+Fe*ee,n[14]=ue*u+_e*T+Me*U+Fe*le,n[15]=ue*f+_e*C+Me*V+Fe*Ee,n}function A9(n,e,t){var r=t[0],s=t[1],u=t[2],f,m,o,T,C,R,O,U,V,Y,ee,le;return e===n?(n[12]=e[0]*r+e[4]*s+e[8]*u+e[12],n[13]=e[1]*r+e[5]*s+e[9]*u+e[13],n[14]=e[2]*r+e[6]*s+e[10]*u+e[14],n[15]=e[3]*r+e[7]*s+e[11]*u+e[15]):(f=e[0],m=e[1],o=e[2],T=e[3],C=e[4],R=e[5],O=e[6],U=e[7],V=e[8],Y=e[9],ee=e[10],le=e[11],n[0]=f,n[1]=m,n[2]=o,n[3]=T,n[4]=C,n[5]=R,n[6]=O,n[7]=U,n[8]=V,n[9]=Y,n[10]=ee,n[11]=le,n[12]=f*r+C*s+V*u+e[12],n[13]=m*r+R*s+Y*u+e[13],n[14]=o*r+O*s+ee*u+e[14],n[15]=T*r+U*s+le*u+e[15]),n}function oy(n,e,t){var r=t[0],s=t[1],u=t[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*u,n[9]=e[9]*u,n[10]=e[10]*u,n[11]=e[11]*u,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function _T(n,e,t){var r=Math.sin(t),s=Math.cos(t),u=e[4],f=e[5],m=e[6],o=e[7],T=e[8],C=e[9],R=e[10],O=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=u*s+T*r,n[5]=f*s+C*r,n[6]=m*s+R*r,n[7]=o*s+O*r,n[8]=T*s-u*r,n[9]=C*s-f*r,n[10]=R*s-m*r,n[11]=O*s-o*r,n}function yT(n,e,t){var r=Math.sin(t),s=Math.cos(t),u=e[0],f=e[1],m=e[2],o=e[3],T=e[4],C=e[5],R=e[6],O=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=u*s+T*r,n[1]=f*s+C*r,n[2]=m*s+R*r,n[3]=o*s+O*r,n[4]=T*s-u*r,n[5]=C*s-f*r,n[6]=R*s-m*r,n[7]=O*s-o*r,n}function vT(n,e,t,r,s){var u=1/Math.tan(e/2),f;return n[0]=u/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0?(f=1/(r-s),n[10]=(s+r)*f,n[14]=2*s*r*f):(n[10]=-1,n[14]=-2*r),n}function wp(n,e){var t=n[0],r=n[1],s=n[2],u=n[3],f=n[4],m=n[5],o=n[6],T=n[7],C=n[8],R=n[9],O=n[10],U=n[11],V=n[12],Y=n[13],ee=n[14],le=n[15],Ee=e[0],ue=e[1],_e=e[2],Me=e[3],Fe=e[4],yt=e[5],xt=e[6],ht=e[7],kt=e[8],Bt=e[9],Vt=e[10],$t=e[11],Ct=e[12],xn=e[13],Oe=e[14],ce=e[15];return Math.abs(t-Ee)<=Ys*Math.max(1,Math.abs(t),Math.abs(Ee))&&Math.abs(r-ue)<=Ys*Math.max(1,Math.abs(r),Math.abs(ue))&&Math.abs(s-_e)<=Ys*Math.max(1,Math.abs(s),Math.abs(_e))&&Math.abs(u-Me)<=Ys*Math.max(1,Math.abs(u),Math.abs(Me))&&Math.abs(f-Fe)<=Ys*Math.max(1,Math.abs(f),Math.abs(Fe))&&Math.abs(m-yt)<=Ys*Math.max(1,Math.abs(m),Math.abs(yt))&&Math.abs(o-xt)<=Ys*Math.max(1,Math.abs(o),Math.abs(xt))&&Math.abs(T-ht)<=Ys*Math.max(1,Math.abs(T),Math.abs(ht))&&Math.abs(C-kt)<=Ys*Math.max(1,Math.abs(C),Math.abs(kt))&&Math.abs(R-Bt)<=Ys*Math.max(1,Math.abs(R),Math.abs(Bt))&&Math.abs(O-Vt)<=Ys*Math.max(1,Math.abs(O),Math.abs(Vt))&&Math.abs(U-$t)<=Ys*Math.max(1,Math.abs(U),Math.abs($t))&&Math.abs(V-Ct)<=Ys*Math.max(1,Math.abs(V),Math.abs(Ct))&&Math.abs(Y-xn)<=Ys*Math.max(1,Math.abs(Y),Math.abs(xn))&&Math.abs(ee-Oe)<=Ys*Math.max(1,Math.abs(ee),Math.abs(Oe))&&Math.abs(le-ce)<=Ys*Math.max(1,Math.abs(le),Math.abs(ce))}function xT(){var n=new J4(2);return J4!=Float32Array&&(n[0]=0,n[1]=0),n}function C9(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function bT(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}function wT(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n}function TT(n){var e=n[0],t=n[1];return Math.hypot(e,t)}function ET(n,e){return n[0]=-e[0],n[1]=-e[1],n}function ay(n,e,t,r){var s=e[0],u=e[1];return n[0]=s+r*(t[0]-s),n[1]=u+r*(t[1]-u),n}var ST=bT;(function(){var n=xT();return function(e,t,r,s,u,f){var m,o;for(t||(t=2),r||(r=0),s?o=Math.min(s*t+r,e.length):o=e.length,m=r;m<o;m+=t)n[0]=e[m],n[1]=e[m+1],u(n,n,f),e[m]=n[0],e[m+1]=n[1];return e}})();function AT(){var n=new J4(3);return J4!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function CT(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function PT(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function IT(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}var MT=PT;(function(){var n=AT();return function(e,t,r,s,u,f){var m,o;for(t||(t=3),r||(r=0),s?o=Math.min(s*t+r,e.length):o=e.length,m=r;m<o;m+=t)n[0]=e[m],n[1]=e[m+1],n[2]=e[m+2],u(n,n,f),e[m]=n[0],e[m+1]=n[1],e[m+2]=n[2];return e}})();function b3(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Rl=Math.PI,ly=Rl/4,b1=Rl/180,P9=180/Rl,A2=512,Tp=4003e4,Ep=85.051129,cy=1.5;function I9(n){return Math.pow(2,n)}function RT(n){return Dh(n)}function g3([n,e]){b3(Number.isFinite(n)),b3(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const t=n*b1,r=e*b1,s=A2*(t+Rl)/(2*Rl),u=A2*(Rl+Math.log(Math.tan(ly+r*.5)))/(2*Rl);return[s,u]}function w3([n,e]){const t=n/A2*(2*Rl)-Rl,r=2*(Math.atan(Math.exp(e/A2*(2*Rl)-Rl))-ly);return[t*P9,r*P9]}function kT({latitude:n,longitude:e,highPrecision:t=!1}){b3(Number.isFinite(n)&&Number.isFinite(e));const r={},s=A2,u=Math.cos(n*b1),f=s/360,m=f/u,o=s/Tp/u;if(r.unitsPerMeter=[o,o,o],r.metersPerUnit=[1/o,1/o,1/o],r.unitsPerDegree=[f,m,o],r.degreesPerUnit=[1/f,1/m,1/o],t){const T=b1*Math.tan(n*b1)/u,C=f*T/2,R=s/Tp*T,O=R/m*o;r.unitsPerDegree2=[0,C,R],r.unitsPerMeter2=[O,0,O]}return r}function OT({height:n,pitch:e,bearing:t,altitude:r,scale:s,center:u=null}){const f=Q8();return A9(f,f,[0,0,-r]),_T(f,f,-e*b1),yT(f,f,t*b1),s/=n,oy(f,f,[s,s,s]),u&&A9(f,f,IT([],u)),f}function DT({width:n,height:e,fovy:t=m7(cy),altitude:r,pitch:s=0,nearZMultiplier:u=1,farZMultiplier:f=1}){r!==void 0&&(t=m7(r));const m=.5*t*b1,o=uy(t),T=s*b1,C=Math.sin(m)*o/Math.sin(Math.min(Math.max(Math.PI/2-T-m,.01),Math.PI-.01)),R=Math.sin(T)*C+o;return{fov:2*m,aspect:n/e,focalDistance:o,near:u,far:R*f}}function LT({width:n,height:e,pitch:t,altitude:r,fovy:s,nearZMultiplier:u,farZMultiplier:f}){const{fov:m,aspect:o,near:T,far:C}=DT({width:n,height:e,altitude:r,fovy:s,pitch:t,nearZMultiplier:u,farZMultiplier:f});return vT([],m,o,T,C)}function m7(n){return 2*Math.atan(.5/n)*P9}function uy(n){return .5/Math.tan(.5*n*b1)}function FT(n,e){const[t,r,s=0]=n;return b3(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(s)),Z4(e,[t,r,s,1])}function Sp(n,e,t=0){const[r,s,u]=n;if(b3(Number.isFinite(r)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(u))return Z4(e,[r,s,u,1]);const f=Z4(e,[r,s,0,1]),m=Z4(e,[r,s,1,1]),o=f[2],T=m[2],C=o===T?0:((t||0)-o)/(T-o);return ay([],f,m,C)}function NT({width:n,height:e,bounds:t,minExtent:r=0,maxZoom:s=24,padding:u=0,offset:f=[0,0]}){const[[m,o],[T,C]]=t;if(Number.isFinite(u)){const Fe=u;u={top:Fe,bottom:Fe,left:Fe,right:Fe}}else b3(Number.isFinite(u.top)&&Number.isFinite(u.bottom)&&Number.isFinite(u.left)&&Number.isFinite(u.right));const R=g3([m,bp(C,-85.051129,Ep)]),O=g3([T,bp(o,-85.051129,Ep)]),U=[Math.max(Math.abs(O[0]-R[0]),r),Math.max(Math.abs(O[1]-R[1]),r)],V=[n-u.left-u.right-Math.abs(f[0])*2,e-u.top-u.bottom-Math.abs(f[1])*2];b3(V[0]>0&&V[1]>0);const Y=V[0]/U[0],ee=V[1]/U[1],le=(u.right-u.left)/2/Y,Ee=(u.bottom-u.top)/2/ee,ue=[(O[0]+R[0])/2+le,(O[1]+R[1])/2+Ee],_e=w3(ue),Me=Math.min(s,Dh(Math.abs(Math.min(Y,ee))));return b3(Number.isFinite(Me)),{longitude:_e[0],latitude:_e[1],zoom:Me}}const Ap=Math.PI/180;function BT(n,e=0){const{width:t,height:r,unproject:s}=n,u={targetZ:e},f=s([0,r],u),m=s([t,r],u);let o,T;const C=n.fovy?.5*n.fovy*Ap:Math.atan(.5/n.altitude),R=(90-n.pitch)*Ap;return C>R-.01?(o=Cp(n,0,e),T=Cp(n,t,e)):(o=s([0,0],u),T=s([t,0],u)),[f,m,T,o]}function Cp(n,e,t){const{pixelUnprojectionMatrix:r}=n,s=Z4(r,[e,0,1,1]),u=Z4(r,[e,n.height,1,1]),m=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(u[2]-s[2]),o=ay([],s,u,m),T=w3(o);return T[2]=t,T}let O0=class M9{constructor({width:e,height:t,latitude:r=0,longitude:s=0,zoom:u=0,pitch:f=0,bearing:m=0,altitude:o=null,fovy:T=null,position:C=null,nearZMultiplier:R=.02,farZMultiplier:O=1.01}={width:1,height:1}){e=e||1,t=t||1,T===null&&o===null?(o=cy,T=m7(o)):T===null?T=m7(o):o===null&&(o=uy(T));const U=I9(u);o=Math.max(.75,o);const V=kT({longitude:s,latitude:r}),Y=g3([s,r]);Y[2]=0,C&&CT(Y,Y,MT([],C,V.unitsPerMeter)),this.projectionMatrix=LT({width:e,height:t,pitch:f,fovy:T,nearZMultiplier:R,farZMultiplier:O}),this.viewMatrix=OT({height:t,scale:U,center:Y,pitch:f,bearing:m,altitude:o}),this.width=e,this.height=t,this.scale=U,this.latitude=r,this.longitude=s,this.zoom=u,this.pitch=f,this.bearing=m,this.altitude=o,this.fovy=T,this.center=Y,this.meterOffset=C||[0,0,0],this.distanceScales=V,this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this)}_initMatrices(){const{width:e,height:t,projectionMatrix:r,viewMatrix:s}=this,u=Q8();M5(u,u,r),M5(u,u,s),this.viewProjectionMatrix=u;const f=Q8();oy(f,f,[e/2,-t/2,1]),A9(f,f,[1,-1,0]),M5(f,f,u);const m=gT(Q8(),f);if(!m)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=f,this.pixelUnprojectionMatrix=m}equals(e){return e instanceof M9?e.width===this.width&&e.height===this.height&&wp(e.projectionMatrix,this.projectionMatrix)&&wp(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),s=FT(r,this.pixelProjectionMatrix),[u,f]=s,m=t?f:this.height-f;return e.length===2?[u,m]:[u,m,s[2]]}unproject(e,{topLeft:t=!0,targetZ:r=void 0}={}){const[s,u,f]=e,m=t?u:this.height-u,o=r&&r*this.distanceScales.unitsPerMeter[2],T=Sp([s,m,f],this.pixelUnprojectionMatrix,o),[C,R,O]=this.unprojectPosition(T);return Number.isFinite(f)?[C,R,O]:Number.isFinite(r)?[C,R,r]:[C,R]}projectPosition(e){const[t,r]=g3(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,s]}unprojectPosition(e){const[t,r]=w3(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,s]}projectFlat(e){return g3(e)}unprojectFlat(e){return w3(e)}getMapCenterByLngLatPosition({lngLat:e,pos:t}){const r=Sp(t,this.pixelUnprojectionMatrix),s=g3(e),u=C9([],s,ET([],r)),f=C9([],this.center,u);return w3(f)}getLocationAtPoint({lngLat:e,pos:t}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:t})}fitBounds(e,t={}){const{width:r,height:s}=this,{longitude:u,latitude:f,zoom:m}=NT(Object.assign({width:r,height:s,bounds:e},t));return new M9({width:r,height:s,longitude:u,latitude:f,zoom:m})}getBounds(e){const t=this.getBoundingRegion(e),r=Math.min(...t.map(m=>m[0])),s=Math.max(...t.map(m=>m[0])),u=Math.min(...t.map(m=>m[1])),f=Math.max(...t.map(m=>m[1]));return[[r,u],[s,f]]}getBoundingRegion(e={}){return BT(this,e.z||0)}};const Pp=512;function zT({width:n,height:e,longitude:t,latitude:r,zoom:s,pitch:u=0,bearing:f=0}){(t<-180||t>180)&&(t=xp(t+180,360)-180),(f<-180||f>180)&&(f=xp(f+180,360)-180);const m=Dh(e/Pp);if(s<=m)s=m,r=0;else{const o=e/2/Math.pow(2,s),T=w3([0,o])[1];if(r<T)r=T;else{const C=w3([0,Pp-o])[1];r>C&&(r=C)}}return{width:n,height:e,longitude:t,latitude:r,zoom:s,pitch:u,bearing:f}}const hy=.01,UT=["longitude","latitude","zoom"],fy={curve:1.414,speed:1.2};function VT(n,e,t,r={}){const s={},{startZoom:u,startCenterXY:f,uDelta:m,w0:o,u1:T,S:C,rho:R,rho2:O,r0:U}=dy(n,e,r);if(T<hy){for(const Me of UT){const Fe=n[Me],yt=e[Me];s[Me]=pT(Fe,yt,t)}return s}const V=t*C,Y=Math.cosh(U)/Math.cosh(U+R*V),ee=o*((Math.cosh(U)*Math.tanh(U+R*V)-Math.sinh(U))/O)/T,le=1/Y,Ee=u+RT(le),ue=wT([],m,ee);C9(ue,ue,f);const _e=w3(ue);return s.longitude=_e[0],s.latitude=_e[1],s.zoom=Ee,s}function jT(n,e,t={}){t=Object.assign({},fy,t);const{screenSpeed:r,speed:s,maxDuration:u}=t,{S:f,rho:m}=dy(n,e,t),o=1e3*f;let T;return Number.isFinite(r)?T=o/(r/m):T=o/s,Number.isFinite(u)&&T>u?0:T}function dy(n,e,t){t=Object.assign({},fy,t);const r=t.curve,s=n.zoom,u=[n.longitude,n.latitude],f=I9(s),m=e.zoom,o=[e.longitude,e.latitude],T=I9(m-s),C=g3(u),R=g3(o),O=ST([],R,C),U=Math.max(n.width,n.height),V=U/T,Y=TT(O)*f,ee=Math.max(Y,hy),le=r*r,Ee=(V*V-U*U+le*le*ee*ee)/(2*U*le*ee),ue=(V*V-U*U-le*le*ee*ee)/(2*V*le*ee),_e=Math.log(Math.sqrt(Ee*Ee+1)-Ee),Me=Math.log(Math.sqrt(ue*ue+1)-ue),Fe=(Me-_e)/r;return{startZoom:s,startCenterXY:C,uDelta:O,w0:U,u1:Y,S:Fe,rho:r,rho2:le,r0:_e,r1:Me}}var py=function(){if(typeof Map<"u")return Map;function n(e,t){var r=-1;return e.some(function(s,u){return s[0]===t?(r=u,!0):!1}),r}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(t){var r=n(this.__entries__,t),s=this.__entries__[r];return s&&s[1]},e.prototype.set=function(t,r){var s=n(this.__entries__,t);~s?this.__entries__[s][1]=r:this.__entries__.push([t,r])},e.prototype.delete=function(t){var r=this.__entries__,s=n(r,t);~s&&r.splice(s,1)},e.prototype.has=function(t){return!!~n(this.__entries__,t)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,r){r===void 0&&(r=null);for(var s=0,u=this.__entries__;s<u.length;s++){var f=u[s];t.call(r,f[1],f[0])}},e}()}(),R9=typeof window<"u"&&typeof document<"u"&&window.document===document,g7=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),$T=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(g7):function(n){return setTimeout(function(){return n(Date.now())},1e3/60)}}(),WT=2;function HT(n,e){var t=!1,r=!1,s=0;function u(){t&&(t=!1,n()),r&&m()}function f(){$T(u)}function m(){var o=Date.now();if(t){if(o-s<WT)return;r=!0}else t=!0,r=!1,setTimeout(f,e);s=o}return m}var XT=20,ZT=["top","right","bottom","left","width","height","size","weight"],qT=typeof MutationObserver<"u",GT=function(){function n(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=HT(this.refresh.bind(this),XT)}return n.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},n.prototype.removeObserver=function(e){var t=this.observers_,r=t.indexOf(e);~r&&t.splice(r,1),!t.length&&this.connected_&&this.disconnect_()},n.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},n.prototype.updateObservers_=function(){var e=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return e.forEach(function(t){return t.broadcastActive()}),e.length>0},n.prototype.connect_=function(){!R9||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),qT?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},n.prototype.disconnect_=function(){!R9||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},n.prototype.onTransitionEnd_=function(e){var t=e.propertyName,r=t===void 0?"":t,s=ZT.some(function(u){return!!~r.indexOf(u)});s&&this.refresh()},n.getInstance=function(){return this.instance_||(this.instance_=new n),this.instance_},n.instance_=null,n}(),my=function(n,e){for(var t=0,r=Object.keys(e);t<r.length;t++){var s=r[t];Object.defineProperty(n,s,{value:e[s],enumerable:!1,writable:!1,configurable:!0})}return n},Q4=function(n){var e=n&&n.ownerDocument&&n.ownerDocument.defaultView;return e||g7},gy=p6(0,0,0,0);function _7(n){return parseFloat(n)||0}function Ip(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return e.reduce(function(r,s){var u=n["border-"+s+"-width"];return r+_7(u)},0)}function YT(n){for(var e=["top","right","bottom","left"],t={},r=0,s=e;r<s.length;r++){var u=s[r],f=n["padding-"+u];t[u]=_7(f)}return t}function KT(n){var e=n.getBBox();return p6(0,0,e.width,e.height)}function JT(n){var e=n.clientWidth,t=n.clientHeight;if(!e&&!t)return gy;var r=Q4(n).getComputedStyle(n),s=YT(r),u=s.left+s.right,f=s.top+s.bottom,m=_7(r.width),o=_7(r.height);if(r.boxSizing==="border-box"&&(Math.round(m+u)!==e&&(m-=Ip(r,"left","right")+u),Math.round(o+f)!==t&&(o-=Ip(r,"top","bottom")+f)),!eE(n)){var T=Math.round(m+u)-e,C=Math.round(o+f)-t;Math.abs(T)!==1&&(m-=T),Math.abs(C)!==1&&(o-=C)}return p6(s.left,s.top,m,o)}var QT=function(){return typeof SVGGraphicsElement<"u"?function(n){return n instanceof Q4(n).SVGGraphicsElement}:function(n){return n instanceof Q4(n).SVGElement&&typeof n.getBBox=="function"}}();function eE(n){return n===Q4(n).document.documentElement}function tE(n){return R9?QT(n)?KT(n):JT(n):gy}function nE(n){var e=n.x,t=n.y,r=n.width,s=n.height,u=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,f=Object.create(u.prototype);return my(f,{x:e,y:t,width:r,height:s,top:t,right:e+r,bottom:s+t,left:e}),f}function p6(n,e,t,r){return{x:n,y:e,width:t,height:r}}var rE=function(){function n(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=p6(0,0,0,0),this.target=e}return n.prototype.isActive=function(){var e=tE(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},n.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},n}(),iE=function(){function n(e,t){var r=nE(t);my(this,{target:e,contentRect:r})}return n}(),sE=function(){function n(e,t,r){if(this.activeObservations_=[],this.observations_=new py,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=r}return n.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof Q4(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new rE(e)),this.controller_.addObserver(this),this.controller_.refresh())}},n.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof Q4(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},n.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},n.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(t){t.isActive()&&e.activeObservations_.push(t)})},n.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map(function(r){return new iE(r.target,r.broadcastRect())});this.callback_.call(e,t,e),this.clearActive()}},n.prototype.clearActive=function(){this.activeObservations_.splice(0)},n.prototype.hasActive=function(){return this.activeObservations_.length>0},n}(),_y=typeof WeakMap<"u"?new WeakMap:new py,yy=function(){function n(e){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var t=GT.getInstance(),r=new sE(e,t,this);_y.set(this,r)}return n}();["observe","unobserve","disconnect"].forEach(function(n){yy.prototype[n]=function(){var e;return(e=_y.get(this))[n].apply(e,arguments)}});var oE=function(){return typeof g7.ResizeObserver<"u"?g7.ResizeObserver:yy}();function P3(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function aE(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function I3(n,e,t){return e&&aE(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}var _c=typeof document<"u"?document:{};function Mp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function M8(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Mp(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Mp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Rp(n,e){var t;if(typeof Symbol>"u"||n[Symbol.iterator]==null){if(Array.isArray(n)||(t=lE(n))||e){t&&(n=t);var r=0,s=function(){};return{s,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(T){throw T},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,f=!1,m;return{s:function(){t=n[Symbol.iterator]()},n:function(){var T=t.next();return u=T.done,T},e:function(T){f=!0,m=T},f:function(){try{!u&&t.return!=null&&t.return()}finally{if(f)throw m}}}}function lE(n,e){if(n){if(typeof n=="string")return kp(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return kp(n,e)}}function kp(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}var cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function R5(n){if(!n)return null;if(typeof n=="string")return n;n.toJS&&(n=n.toJS());var e={},t=Rp(n.layers),r;try{for(t.s();!(r=t.n()).done;){var s=r.value;e[s.id]=s}}catch(f){t.e(f)}finally{t.f()}var u=n.layers.map(function(f){var m=e[f.ref],o=null;if("interactive"in f&&(o=M8({},f),delete o.interactive),m){o=o||M8({},f),delete o.ref;var T=Rp(cE),C;try{for(T.s();!(C=T.n()).done;){var R=C.value;R in m&&(o[R]=m[R])}}catch(O){T.e(O)}finally{T.f()}}return o||f});return M8(M8({},n),{},{layers:u})}var Op={};function uE(){}function hE(n){n&&console.error(n.error)}var vy={container:et.object,gl:et.object,mapboxApiAccessToken:et.string,mapboxApiUrl:et.string,attributionControl:et.bool,preserveDrawingBuffer:et.bool,reuseMaps:et.bool,transformRequest:et.func,mapOptions:et.object,mapStyle:et.oneOfType([et.string,et.object]),preventStyleDiffing:et.bool,visible:et.bool,asyncRender:et.bool,onLoad:et.func,onError:et.func,width:et.number,height:et.number,viewState:et.object,longitude:et.number,latitude:et.number,zoom:et.number,bearing:et.number,pitch:et.number,altitude:et.number},e7={container:_c.body,mapboxApiAccessToken:fE(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:uE,onError:hE,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function fE(){var n=null;if(typeof window<"u"&&window.location){var e=window.location.search.match(/access_token=([^&\/]*)/);n=e&&e[1]}return!n&&typeof process<"u"&&(n=n||Op.MapboxAccessToken||Op.REACT_APP_MAPBOX_ACCESS_TOKEN),n||"no-token"}function Dp(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";n.debug&&et.checkPropTypes(vy,n,"prop",e)}var V0=function(){function n(e){var t=this;if(P3(this,n),Dn(this,"props",e7),Dn(this,"width",0),Dn(this,"height",0),Dn(this,"_fireLoadEvent",function(){t.props.onLoad({type:"load",target:t._map})}),Dn(this,"_handleError",function(r){t.props.onError(r)}),!e.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=e.mapboxgl,n.initialized||(n.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(e)}return I3(n,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(t){return this._update(this.props,t),this}},{key:"redraw",value:function(){var t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(t){this._map=n.savedMap;var r=this._map.getContainer(),s=t.container;for(s.classList.add("mapboxgl-map");r.childNodes.length>0;)s.appendChild(r.childNodes[0]);this._map._container=s,n.savedMap=null,t.mapStyle&&this._map.setStyle(R5(t.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(t){if(t.reuseMaps&&n.savedMap)this._reuse(t);else{if(t.gl){var r=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=r,t.gl}}var s={container:t.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:R5(t.mapStyle),interactive:!1,trackResize:!1,attributionControl:t.attributionControl,preserveDrawingBuffer:t.preserveDrawingBuffer};t.transformRequest&&(s.transformRequest=t.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},s,t.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!n.savedMap?(n.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(t){var r=this;t=Object.assign({},e7,t),Dp(t,"Mapbox"),this.mapboxgl.accessToken=t.mapboxApiAccessToken||e7.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=t.mapboxApiUrl,this._create(t);var s=t,u=s.container;Object.defineProperty(u,"offsetWidth",{configurable:!0,get:function(){return r.width}}),Object.defineProperty(u,"clientWidth",{configurable:!0,get:function(){return r.width}}),Object.defineProperty(u,"offsetHeight",{configurable:!0,get:function(){return r.height}}),Object.defineProperty(u,"clientHeight",{configurable:!0,get:function(){return r.height}});var f=this._map.getCanvas();f&&(f.style.outline="none"),this._updateMapViewport({},t),this._updateMapSize({},t),this.props=t}},{key:"_update",value:function(t,r){if(this._map){r=Object.assign({},this.props,r),Dp(r,"Mapbox");var s=this._updateMapViewport(t,r),u=this._updateMapSize(t,r);this._updateMapStyle(t,r),!r.asyncRender&&(s||u)&&this.redraw(),this.props=r}}},{key:"_updateMapStyle",value:function(t,r){var s=t.mapStyle!==r.mapStyle;s&&this._map.setStyle(R5(r.mapStyle),{diff:!r.preventStyleDiffing})}},{key:"_updateMapSize",value:function(t,r){var s=t.width!==r.width||t.height!==r.height;return s&&(this.width=r.width,this.height=r.height,this._map.resize()),s}},{key:"_updateMapViewport",value:function(t,r){var s=this._getViewState(t),u=this._getViewState(r),f=u.latitude!==s.latitude||u.longitude!==s.longitude||u.zoom!==s.zoom||u.pitch!==s.pitch||u.bearing!==s.bearing||u.altitude!==s.altitude;return f&&(this._map.jumpTo(this._viewStateToMapboxProps(u)),u.altitude!==s.altitude&&(this._map.transform.altitude=u.altitude)),f}},{key:"_getViewState",value:function(t){var r=t.viewState||t,s=r.longitude,u=r.latitude,f=r.zoom,m=r.pitch,o=m===void 0?0:m,T=r.bearing,C=T===void 0?0:T,R=r.altitude,O=R===void 0?1.5:R;return{longitude:s,latitude:u,zoom:f,pitch:o,bearing:C,altitude:O}}},{key:"_checkStyleSheet",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof _c>"u"))try{var r=_c.createElement("div");r.className="mapboxgl-map",r.style.display="none",_c.body.appendChild(r);var s=window.getComputedStyle(r).position!=="static";if(!s){var u=_c.createElement("link");u.setAttribute("rel","stylesheet"),u.setAttribute("type","text/css"),u.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(t,"/mapbox-gl.css")),_c.head.appendChild(u)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(t){return{center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}}}]),n}();Dn(V0,"initialized",!1);Dn(V0,"propTypes",vy);Dn(V0,"defaultProps",e7);Dn(V0,"savedMap",null);var t7={exports:{}},dE=t7.exports,Lp;function pE(){return Lp||(Lp=1,function(n,e){var t={};(function(r,s){n.exports=s()})(dE,function(){var r,s,u;function f(o,T){if(!r)r=T;else if(!s)s=T;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",R={};r(R),u=T(R),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}f(["exports"],function(o){var T="2.7.1",C=R;function R(a,i,c,h){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=h,this.p2x=c,this.p2y=h}R.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},R.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},R.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},R.prototype.solveCurveX=function(a,i){var c,h,g,y,b;for(i===void 0&&(i=1e-6),g=a,b=0;b<8;b++){if(y=this.sampleCurveX(g)-a,Math.abs(y)<i)return g;var S=this.sampleCurveDerivativeX(g);if(Math.abs(S)<1e-6)break;g-=y/S}if((g=a)<(c=0))return c;if(g>(h=1))return h;for(;c<h;){if(y=this.sampleCurveX(g),Math.abs(y-a)<i)return g;a>y?c=g:h=g,g=.5*(h-c)+c}return g},R.prototype.solve=function(a,i){return this.sampleCurveY(this.solveCurveX(a,i))};var O=U;function U(a,i){this.x=a,this.y=i}U.prototype={clone:function(){return new U(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,i){return this.clone()._rotateAround(a,i)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var i=a.x-this.x,c=a.y-this.y;return i*i+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,i){return Math.atan2(this.x*i-this.y*a,this.x*a+this.y*i)},_matMult:function(a){var i=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=i,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var i=Math.cos(a),c=Math.sin(a),h=c*this.x+i*this.y;return this.x=i*this.x-c*this.y,this.y=h,this},_rotateAround:function(a,i){var c=Math.cos(a),h=Math.sin(a),g=i.y+h*(this.x-i.x)+c*(this.y-i.y);return this.x=i.x+c*(this.x-i.x)-h*(this.y-i.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},U.convert=function(a){return a instanceof U?a:Array.isArray(a)?new U(a[0],a[1]):a};var V=typeof self<"u"?self:{},Y=1e-6,ee=typeof Float32Array<"u"?Float32Array:Array;function le(){var a=new ee(9);return ee!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Ee(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function ue(a,i,c){var h=i[0],g=i[1],y=i[2],b=i[3],S=i[4],P=i[5],M=i[6],L=i[7],F=i[8],N=i[9],H=i[10],q=i[11],J=i[12],oe=i[13],me=i[14],Ce=i[15],De=c[0],Ue=c[1],We=c[2],Xe=c[3];return a[0]=De*h+Ue*S+We*F+Xe*J,a[1]=De*g+Ue*P+We*N+Xe*oe,a[2]=De*y+Ue*M+We*H+Xe*me,a[3]=De*b+Ue*L+We*q+Xe*Ce,a[4]=(De=c[4])*h+(Ue=c[5])*S+(We=c[6])*F+(Xe=c[7])*J,a[5]=De*g+Ue*P+We*N+Xe*oe,a[6]=De*y+Ue*M+We*H+Xe*me,a[7]=De*b+Ue*L+We*q+Xe*Ce,a[8]=(De=c[8])*h+(Ue=c[9])*S+(We=c[10])*F+(Xe=c[11])*J,a[9]=De*g+Ue*P+We*N+Xe*oe,a[10]=De*y+Ue*M+We*H+Xe*me,a[11]=De*b+Ue*L+We*q+Xe*Ce,a[12]=(De=c[12])*h+(Ue=c[13])*S+(We=c[14])*F+(Xe=c[15])*J,a[13]=De*g+Ue*P+We*N+Xe*oe,a[14]=De*y+Ue*M+We*H+Xe*me,a[15]=De*b+Ue*L+We*q+Xe*Ce,a}function _e(a,i,c){var h,g,y,b,S,P,M,L,F,N,H,q,J=c[0],oe=c[1],me=c[2];return i===a?(a[12]=i[0]*J+i[4]*oe+i[8]*me+i[12],a[13]=i[1]*J+i[5]*oe+i[9]*me+i[13],a[14]=i[2]*J+i[6]*oe+i[10]*me+i[14],a[15]=i[3]*J+i[7]*oe+i[11]*me+i[15]):(g=i[1],y=i[2],b=i[3],S=i[4],P=i[5],M=i[6],L=i[7],F=i[8],N=i[9],H=i[10],q=i[11],a[0]=h=i[0],a[1]=g,a[2]=y,a[3]=b,a[4]=S,a[5]=P,a[6]=M,a[7]=L,a[8]=F,a[9]=N,a[10]=H,a[11]=q,a[12]=h*J+S*oe+F*me+i[12],a[13]=g*J+P*oe+N*me+i[13],a[14]=y*J+M*oe+H*me+i[14],a[15]=b*J+L*oe+q*me+i[15]),a}function Me(a,i,c){var h=c[0],g=c[1],y=c[2];return a[0]=i[0]*h,a[1]=i[1]*h,a[2]=i[2]*h,a[3]=i[3]*h,a[4]=i[4]*g,a[5]=i[5]*g,a[6]=i[6]*g,a[7]=i[7]*g,a[8]=i[8]*y,a[9]=i[9]*y,a[10]=i[10]*y,a[11]=i[11]*y,a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15],a}function Fe(a,i,c){var h=Math.sin(c),g=Math.cos(c),y=i[4],b=i[5],S=i[6],P=i[7],M=i[8],L=i[9],F=i[10],N=i[11];return i!==a&&(a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[3],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[4]=y*g+M*h,a[5]=b*g+L*h,a[6]=S*g+F*h,a[7]=P*g+N*h,a[8]=M*g-y*h,a[9]=L*g-b*h,a[10]=F*g-S*h,a[11]=N*g-P*h,a}function yt(a,i,c){var h=Math.sin(c),g=Math.cos(c),y=i[0],b=i[1],S=i[2],P=i[3],M=i[8],L=i[9],F=i[10],N=i[11];return i!==a&&(a[4]=i[4],a[5]=i[5],a[6]=i[6],a[7]=i[7],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=y*g-M*h,a[1]=b*g-L*h,a[2]=S*g-F*h,a[3]=P*g-N*h,a[8]=y*h+M*g,a[9]=b*h+L*g,a[10]=S*h+F*g,a[11]=P*h+N*g,a}Math.hypot||(Math.hypot=function(){for(var a=0,i=arguments.length;i--;)a+=arguments[i]*arguments[i];return Math.sqrt(a)});var xt=ue;function ht(){var a=new ee(3);return ee!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function kt(a){var i=new ee(3);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i}function Bt(a){return Math.hypot(a[0],a[1],a[2])}function Vt(a,i,c){var h=new ee(3);return h[0]=a,h[1]=i,h[2]=c,h}function $t(a,i,c){return a[0]=i[0]+c[0],a[1]=i[1]+c[1],a[2]=i[2]+c[2],a}function Ct(a,i,c){return a[0]=i[0]-c[0],a[1]=i[1]-c[1],a[2]=i[2]-c[2],a}function xn(a,i,c){return a[0]=i[0]*c[0],a[1]=i[1]*c[1],a[2]=i[2]*c[2],a}function Oe(a,i,c){return a[0]=Math.max(i[0],c[0]),a[1]=Math.max(i[1],c[1]),a[2]=Math.max(i[2],c[2]),a}function ce(a,i,c){return a[0]=i[0]*c,a[1]=i[1]*c,a[2]=i[2]*c,a}function ve(a,i,c,h){return a[0]=i[0]+c[0]*h,a[1]=i[1]+c[1]*h,a[2]=i[2]+c[2]*h,a}function rt(a,i){var c=i[0],h=i[1],g=i[2],y=c*c+h*h+g*g;return y>0&&(y=1/Math.sqrt(y)),a[0]=i[0]*y,a[1]=i[1]*y,a[2]=i[2]*y,a}function at(a,i){return a[0]*i[0]+a[1]*i[1]+a[2]*i[2]}function Ne(a,i,c){var h=i[0],g=i[1],y=i[2],b=c[0],S=c[1],P=c[2];return a[0]=g*P-y*S,a[1]=y*b-h*P,a[2]=h*S-g*b,a}function Be(a,i,c){var h=i[0],g=i[1],y=i[2],b=c[3]*h+c[7]*g+c[11]*y+c[15];return a[0]=(c[0]*h+c[4]*g+c[8]*y+c[12])/(b=b||1),a[1]=(c[1]*h+c[5]*g+c[9]*y+c[13])/b,a[2]=(c[2]*h+c[6]*g+c[10]*y+c[14])/b,a}function ot(a,i,c){var h=c[0],g=c[1],y=c[2],b=i[0],S=i[1],P=i[2],M=g*P-y*S,L=y*b-h*P,F=h*S-g*b,N=g*F-y*L,H=y*M-h*F,q=h*L-g*M,J=2*c[3];return L*=J,F*=J,H*=2,q*=2,a[0]=b+(M*=J)+(N*=2),a[1]=S+L+H,a[2]=P+F+q,a}var Ft,Dt=Ct,vn=xn,un=Bt;function fn(a,i,c){var h=i[0],g=i[1],y=i[2],b=i[3];return a[0]=c[0]*h+c[4]*g+c[8]*y+c[12]*b,a[1]=c[1]*h+c[5]*g+c[9]*y+c[13]*b,a[2]=c[2]*h+c[6]*g+c[10]*y+c[14]*b,a[3]=c[3]*h+c[7]*g+c[11]*y+c[15]*b,a}function yn(){var a=new ee(4);return ee!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Tn(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Qr(a,i,c){c*=.5;var h=i[0],g=i[1],y=i[2],b=i[3],S=Math.sin(c),P=Math.cos(c);return a[0]=h*P+b*S,a[1]=g*P+y*S,a[2]=y*P-g*S,a[3]=b*P-h*S,a}function Or(a,i){return a[0]===i[0]&&a[1]===i[1]}ht(),Ft=new ee(4),ee!=Float32Array&&(Ft[0]=0,Ft[1]=0,Ft[2]=0,Ft[3]=0),ht(),Vt(1,0,0),Vt(0,1,0),yn(),yn(),le(),function(){var a;a=new ee(2),ee!=Float32Array&&(a[0]=0,a[1]=0)}();const as=Math.PI/180,Xi=180/Math.PI;function Ht(a){return a*as}function pn(a){return a*Xi}const hi=[[0,0],[1,0],[1,1],[0,1]];function xo(a){if(a<=0)return 0;if(a>=1)return 1;const i=a*a,c=i*a;return 4*(a<.5?c:3*(a-i)+c-.75)}function Vo(a,i,c,h){const g=new C(a,i,c,h);return function(y){return g.solve(y)}}const to=Vo(.25,.1,.25,1);function En(a,i,c){return Math.min(c,Math.max(i,a))}function no(a,i,c){return(c=En((c-a)/(i-a),0,1))*c*(3-2*c)}function _s(a,i,c){const h=c-i,g=((a-i)%h+h)%h+i;return g===i?c:g}function jo(a,i,c){if(!a.length)return c(null,[]);let h=a.length;const g=new Array(a.length);let y=null;a.forEach((b,S)=>{i(b,(P,M)=>{P&&(y=P),g[S]=M,--h==0&&c(y,g)})})}function bo(a){const i=[];for(const c in a)i.push(a[c]);return i}function ur(a,...i){for(const c of i)for(const h in c)a[h]=c[h];return a}let wo=1;function $o(){return wo++}function Wo(){return function a(i){return i?(i^16*Math.random()>>i/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Mi(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function ro(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function io(a,i){a.forEach(c=>{i[c]&&(i[c]=i[c].bind(i))})}function To(a,i){return a.indexOf(i,a.length-i.length)!==-1}function ys(a,i,c){const h={};for(const g in a)h[g]=i.call(this,a[g],g,a);return h}function Ho(a,i,c){const h={};for(const g in a)i.call(c||this,a[g],g,a)&&(h[g]=a[g]);return h}function fi(a){return Array.isArray(a)?a.map(fi):typeof a=="object"&&a?ys(a,fi):a}const Eo={};function gr(a){Eo[a]||(typeof console<"u"&&console.warn(a),Eo[a]=!0)}function Zi(a,i,c){return(c.y-a.y)*(i.x-a.x)>(i.y-a.y)*(c.x-a.x)}function Xo(a){let i=0;for(let c,h,g=0,y=a.length,b=y-1;g<y;b=g++)c=a[g],h=a[b],i+=(h.x-c.x)*(c.y+h.y);return i}function vs(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function so(a){const i={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,h,g,y)=>{const b=g||y;return i[h]=!b||b.toLowerCase(),""}),i["max-age"]){const c=parseInt(i["max-age"],10);isNaN(c)?delete i["max-age"]:i["max-age"]=c}return i}let xs,bs,qi,Gi=null;function ii(a){if(Gi==null){const i=a.navigator?a.navigator.userAgent:null;Gi=!!a.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Gi}function Zo(a){try{const i=V[a];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}const Ri={now:()=>qi!==void 0?qi:V.performance.now(),setNow(a){qi=a},restoreNow(){qi=void 0},frame(a){const i=V.requestAnimationFrame(a);return{cancel:()=>V.cancelAnimationFrame(i)}},getImageData(a,i=0){const c=V.document.createElement("canvas"),h=c.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,h.drawImage(a,0,0,a.width,a.height),h.getImageData(-i,-i,a.width+2*i,a.height+2*i)},resolveURL:a=>(xs||(xs=V.document.createElement("a")),xs.href=a,xs.href),get devicePixelRatio(){return V.devicePixelRatio},get prefersReducedMotion(){return!!V.matchMedia&&(bs==null&&(bs=V.matchMedia("(prefers-reduced-motion: reduce)")),bs.matches)}};let de;const W={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(de==null){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{de=t.API_URL_REGEX!=null?new RegExp(t.API_URL_REGEX):a}catch{de=a}}return de},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},G={supported:!1,testSupport:function(a){!Re&&ye&&($e?Ve(a):he=a)}};let he,ye,Re=!1,$e=!1;function Ve(a){const i=a.createTexture();a.bindTexture(a.TEXTURE_2D,i);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,ye),a.isContextLost())return;G.supported=!0}catch{}a.deleteTexture(i),Re=!0}V.document&&(ye=V.document.createElement("img"),ye.onload=function(){he&&Ve(he),he=null,$e=!0},ye.onerror=function(){Re=!0,he=null},ye.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Le="01",Ye="NO_ACCESS_TOKEN";function ft(a){return a.indexOf("mapbox:")===0}function _t(a){return W.API_URL_REGEX.test(a)}const Tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qt(a){const i=a.match(Tt);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Kt(a){const i=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${i}`}function tn(a){if(!a)return null;const i=a.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(decodeURIComponent(V.atob(i[1]).split("").map(c=>"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class on{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const c=tn(W.ACCESS_TOKEN);let h="";return h=c&&c.u?V.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,(g,y)=>String.fromCharCode(+("0x"+y)))):W.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${h}`:`mapbox.eventData:${h}`}fetchEventData(){const i=Zo("localStorage"),c=this.getStorageKey(),h=this.getStorageKey("uuid");if(i)try{const g=V.localStorage.getItem(c);g&&(this.eventData=JSON.parse(g));const y=V.localStorage.getItem(h);y&&(this.anonId=y)}catch{gr("Unable to read from LocalStorage")}}saveEventData(){const i=Zo("localStorage"),c=this.getStorageKey(),h=this.getStorageKey("uuid");if(i)try{V.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&V.localStorage.setItem(c,JSON.stringify(this.eventData))}catch{gr("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,c,h,g){if(!W.EVENTS_URL)return;const y=qt(W.EVENTS_URL);y.params.push(`access_token=${g||W.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:Le,userId:this.anonId},S=c?ur(b,c):b,P={url:Kt(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=pi(P,M=>{this.pendingRequest=null,h(M),this.saveEventData(),this.processRequests(g)})}queueRequest(i,c){this.queue.push(i),this.processRequests(c)}}const Sn=new class extends on{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,i){W.EVENTS_URL&&W.ACCESS_TOKEN&&Array.isArray(a)&&a.some(c=>ft(c)||_t(c))&&this.queueRequest(Date.now(),i)}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=tn(W.ACCESS_TOKEN),c=i?i.u:W.ACCESS_TOKEN;let h=c!==this.eventData.tokenU;ro(this.anonId)||(this.anonId=Wo(),h=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),b=new Date(g),S=(g-this.eventData.lastSuccess)/864e5;h=h||S>=1||S<-1||y.getDate()!==b.getDate()}else h=!0;if(!h)return this.processRequests();this.postEvent(g,{"enabled.telemetry":!1},y=>{y||(this.eventData.lastSuccess=g,this.eventData.tokenU=c)},a)}},ir=Sn.postTurnstileEvent.bind(Sn),yr=new class extends on{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,i,c,h){this.skuToken=i,this.errorCb=h,W.EVENTS_URL&&(c||W.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},c):this.errorCb(new Error(Ye)))}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:c}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),ro(this.anonId)||(this.anonId=Wo()),this.postEvent(c,{skuToken:this.skuToken},h=>{h?this.errorCb(h):i&&(this.success[i]=!0)},a))}},Xn=yr.postMapLoadEvent.bind(yr),sr=new class extends on{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,i,c,h){if(!W.API_URL||!W.SESSION_PATH)return;const g=qt(W.API_URL+W.SESSION_PATH);g.params.push(`sku=${i||""}`),g.params.push(`access_token=${h||W.ACCESS_TOKEN||""}`);const y={url:Kt(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Xa(y,b=>{this.pendingRequest=null,c(b),this.saveEventData(),this.processRequests(h)})}getSessionAPI(a,i,c,h){this.skuToken=i,this.errorCb=h,W.SESSION_PATH&&W.API_URL&&(c||W.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},c):this.errorCb(new Error(Ye)))}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:c}=this.queue.shift();i&&this.success[i]||this.getSession(c,this.skuToken,h=>{h?this.errorCb(h):i&&(this.success[i]=!0)},a)}},$r=sr.getSessionAPI.bind(sr),ki=new Set,br="mapbox-tiles";let Zr,oo,Yi=500,ls=50;function qo(){V.caches&&!Zr&&(Zr=V.caches.open(br))}function ga(a){const i=a.indexOf("?");return i<0?a:a.slice(0,i)}let di=1/0;const Nr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Nr);class Ei extends Error{constructor(i,c,h){c===401&&_t(h)&&(i+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(i),this.status=c,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const cs=vs()?()=>self.worker&&self.worker.referrer:()=>(V.location.protocol==="blob:"?V.parent:V).location.href,si=function(a,i){if(!(/^file:/.test(c=a.url)||/^file:/.test(cs())&&!/^\w+:/.test(c))){if(V.fetch&&V.Request&&V.AbortController&&V.Request.prototype.hasOwnProperty("signal"))return function(h,g){const y=new V.AbortController,b=new V.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:cs(),signal:y.signal});let S=!1,P=!1;const M=(L=b.url).indexOf("sku=")>0&&_t(L);var L;h.type==="json"&&b.headers.set("Accept","application/json");const F=(H,q,J)=>{if(P)return;if(H&&H.message!=="SecurityError"&&gr(H),q&&J)return N(q);const oe=Date.now();V.fetch(b).then(me=>{if(me.ok){const Ce=M?me.clone():null;return N(me,Ce,oe)}return g(new Ei(me.statusText,me.status,h.url))}).catch(me=>{me.code!==20&&g(new Error(me.message))})},N=(H,q,J)=>{(h.type==="arrayBuffer"?H.arrayBuffer():h.type==="json"?H.json():H.text()).then(oe=>{P||(q&&J&&function(me,Ce,De){if(qo(),!Zr)return;const Ue={status:Ce.status,statusText:Ce.statusText,headers:new V.Headers};Ce.headers.forEach((Xe,gt)=>Ue.headers.set(gt,Xe));const We=so(Ce.headers.get("Cache-Control")||"");We["no-store"]||(We["max-age"]&&Ue.headers.set("Expires",new Date(De+1e3*We["max-age"]).toUTCString()),new Date(Ue.headers.get("Expires")).getTime()-De<42e4||function(Xe,gt){if(oo===void 0)try{new Response(new ReadableStream),oo=!0}catch{oo=!1}oo?gt(Xe.body):Xe.blob().then(gt)}(Ce,Xe=>{const gt=new V.Response(Xe,Ue);qo(),Zr&&Zr.then(pt=>pt.put(ga(me.url),gt)).catch(pt=>gr(pt.message))}))}(b,q,J),S=!0,g(null,oe,H.headers.get("Cache-Control"),H.headers.get("Expires")))}).catch(oe=>{P||g(new Error(oe.message))})};return M?function(H,q){if(qo(),!Zr)return q(null);const J=ga(H.url);Zr.then(oe=>{oe.match(J).then(me=>{const Ce=function(De){if(!De)return!1;const Ue=new Date(De.headers.get("Expires")||0),We=so(De.headers.get("Cache-Control")||"");return Ue>Date.now()&&!We["no-cache"]}(me);oe.delete(J),Ce&&oe.put(J,me.clone()),q(null,me,Ce)}).catch(q)}).catch(q)}(b,F):F(null,null),{cancel:()=>{P=!0,S||y.abort()}}}(a,i);if(vs()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,i,void 0,!0)}var c;return function(h,g){const y=new V.XMLHttpRequest;y.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const b in h.headers)y.setRequestHeader(b,h.headers[b]);return h.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=h.credentials==="include",y.onerror=()=>{g(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let b=y.response;if(h.type==="json")try{b=JSON.parse(y.response)}catch(S){return g(S)}g(null,b,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else g(new Ei(y.statusText,y.status,h.url))},y.send(h.body),{cancel:()=>y.abort()}}(a,i)},ws=function(a,i){return si(ur(a,{type:"arrayBuffer"}),i)},pi=function(a,i){return si(ur(a,{method:"POST"}),i)},Xa=function(a,i){return si(ur(a,{method:"GET"}),i)};function Ts(a){const i=V.document.createElement("a");return i.href=a,i.protocol===V.document.location.protocol&&i.host===V.document.location.host}const Go="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Es,Yo;Es=[],Yo=0;const S1=function(a,i){if(G.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Yo>=W.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:a,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Es.push(y),y}Yo++;let c=!1;const h=()=>{if(!c)for(c=!0,Yo--;Es.length&&Yo<W.MAX_PARALLEL_IMAGE_REQUESTS;){const y=Es.shift(),{requestParameters:b,callback:S,cancelled:P}=y;P||(y.cancel=S1(b,S).cancel)}},g=ws(a,(y,b,S,P)=>{h(),y?i(y):b&&(V.createImageBitmap?function(M,L){const F=new V.Blob([new Uint8Array(M)],{type:"image/png"});V.createImageBitmap(F).then(N=>{L(null,N)}).catch(N=>{L(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(b,(M,L)=>i(M,L,S,P)):function(M,L){const F=new V.Image,N=V.URL;F.onload=()=>{L(null,F),N.revokeObjectURL(F.src),F.onload=null,V.requestAnimationFrame(()=>{F.src=Go})},F.onerror=()=>L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new V.Blob([new Uint8Array(M)],{type:"image/png"});F.src=M.byteLength?N.createObjectURL(H):Go}(b,(M,L)=>i(M,L,S,P)))});return{cancel:()=>{g.cancel(),h()}}};function Za(a,i,c){c[a]&&c[a].indexOf(i)!==-1||(c[a]=c[a]||[],c[a].push(i))}function qa(a,i,c){if(c&&c[a]){const h=c[a].indexOf(i);h!==-1&&c[a].splice(h,1)}}class Q{constructor(i,c={}){ur(this,c),this.type=i}}class fe extends Q{constructor(i,c={}){super("error",ur({error:i},c))}}class ke{on(i,c){return this._listeners=this._listeners||{},Za(i,c,this._listeners),this}off(i,c){return qa(i,c,this._listeners),qa(i,c,this._oneTimeListeners),this}once(i,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Za(i,c,this._oneTimeListeners),this):new Promise(h=>this.once(i,h))}fire(i,c){typeof i=="string"&&(i=new Q(i,c||{}));const h=i.type;if(this.listens(h)){i.target=this;const g=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const S of g)S.call(this,i);const y=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const S of y)qa(h,S,this._oneTimeListeners),S.call(this,i);const b=this._eventedParent;b&&(ur(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(i))}else i instanceof fe&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,c){return this._eventedParent=i,this._eventedParentData=c,this}}var ge=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class He{constructor(i,c,h,g){this.message=(i?`${i}: `:"")+h,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function Jt(a){const i=a.value;return i?[new He(a.key,i,"constants have been deprecated as of v8")]:[]}function bn(a,...i){for(const c of i)for(const h in c)a[h]=c[h];return a}function Pn(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function vr(a){if(Array.isArray(a))return a.map(vr);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const i={};for(const c in a)i[c]=vr(a[c]);return i}return Pn(a)}class wr extends Error{constructor(i,c){super(c),this.message=c,this.key=i}}class Oi{constructor(i,c=[]){this.parent=i,this.bindings={};for(const[h,g]of c)this.bindings[h]=g}concat(i){return new Oi(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Ko={kind:"null"},Wt={kind:"number"},zn={kind:"string"},Fn={kind:"boolean"},Ns={kind:"color"},Bl={kind:"object"},rn={kind:"value"},So={kind:"collator"},_a={kind:"formatted"},A1={kind:"resolvedImage"};function Di(a,i){return{kind:"array",itemType:a,N:i}}function Ir(a){if(a.kind==="array"){const i=Ir(a.itemType);return typeof a.N=="number"?`array<${i}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${i}>`}return a.kind}const Ec=[Ko,Wt,zn,Fn,Ns,_a,Bl,Di(rn),A1];function oi(a,i){if(i.kind==="error")return null;if(a.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!oi(a.itemType,i.itemType))&&(typeof a.N!="number"||a.N===i.N))return null}else{if(a.kind===i.kind)return null;if(a.kind==="value"){for(const c of Ec)if(!oi(c,i))return null}}return`Expected ${Ir(a)} but found ${Ir(i)} instead.`}function zl(a,i){return i.some(c=>c.kind===a.kind)}function Jo(a,i){return i.some(c=>c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a)}function Ss(a){var i={exports:{}};return a(i,i.exports),i.exports}var Ul=Ss(function(a,i){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(S){return(S=Math.round(S))<0?0:S>255?255:S}function g(S){return h(S[S.length-1]==="%"?parseFloat(S)/100*255:parseInt(S))}function y(S){return(P=S[S.length-1]==="%"?parseFloat(S)/100:parseFloat(S))<0?0:P>1?1:P;var P}function b(S,P,M){return M<0?M+=1:M>1&&(M-=1),6*M<1?S+(P-S)*M*6:2*M<1?P:3*M<2?S+(P-S)*(2/3-M)*6:S}try{i.parseCSSColor=function(S){var P,M=S.replace(/ /g,"").toLowerCase();if(M in c)return c[M].slice();if(M[0]==="#")return M.length===4?(P=parseInt(M.substr(1),16))>=0&&P<=4095?[(3840&P)>>4|(3840&P)>>8,240&P|(240&P)>>4,15&P|(15&P)<<4,1]:null:M.length===7&&(P=parseInt(M.substr(1),16))>=0&&P<=16777215?[(16711680&P)>>16,(65280&P)>>8,255&P,1]:null;var L=M.indexOf("("),F=M.indexOf(")");if(L!==-1&&F+1===M.length){var N=M.substr(0,L),H=M.substr(L+1,F-(L+1)).split(","),q=1;switch(N){case"rgba":if(H.length!==4)return null;q=y(H.pop());case"rgb":return H.length!==3?null:[g(H[0]),g(H[1]),g(H[2]),q];case"hsla":if(H.length!==4)return null;q=y(H.pop());case"hsl":if(H.length!==3)return null;var J=(parseFloat(H[0])%360+360)%360/360,oe=y(H[1]),me=y(H[2]),Ce=me<=.5?me*(oe+1):me+oe-me*oe,De=2*me-Ce;return[h(255*b(De,Ce,J+1/3)),h(255*b(De,Ce,J)),h(255*b(De,Ce,J-1/3)),q];default:return null}}return null}}catch{}});class Gn{constructor(i,c,h,g=1){this.r=i,this.g=c,this.b=h,this.a=g}static parse(i){if(!i)return;if(i instanceof Gn)return i;if(typeof i!="string")return;const c=Ul.parseCSSColor(i);return c?new Gn(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3]):void 0}toString(){const[i,c,h,g]=this.toArray();return`rgba(${Math.round(i)},${Math.round(c)},${Math.round(h)},${g})`}toArray(){const{r:i,g:c,b:h,a:g}=this;return g===0?[0,0,0,0]:[255*i/g,255*c/g,255*h/g,g]}}Gn.black=new Gn(0,0,0,1),Gn.white=new Gn(1,1,1,1),Gn.transparent=new Gn(0,0,0,0),Gn.red=new Gn(1,0,0,1),Gn.blue=new Gn(0,0,1,1);class Sc{constructor(i,c,h){this.sensitivity=i?c?"variant":"case":c?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,c){return this.collator.compare(i,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class k3{constructor(i,c,h,g,y){this.text=i.normalize?i.normalize():i,this.image=c,this.scale=h,this.fontStack=g,this.textColor=y}}class An{constructor(i){this.sections=i}static fromString(i){return new An([new k3(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof An?i:An.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const c of this.sections){if(c.image){i.push(["image",c.image.name]);continue}i.push(c.text);const h={};c.fontStack&&(h["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(h["font-scale"]=c.scale),c.textColor&&(h["text-color"]=["rgba"].concat(c.textColor.toArray())),i.push(h)}return i}}class Ki{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Ki({name:i,available:!1}):null}serialize(){return["image",this.name]}}function H0(a,i,c,h){return typeof a=="number"&&a>=0&&a<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof c=="number"&&c>=0&&c<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[a,i,c,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[a,i,c,h]:[a,i,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ac(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Gn||a instanceof Sc||a instanceof An||a instanceof Ki)return!0;if(Array.isArray(a)){for(const i of a)if(!Ac(i))return!1;return!0}if(typeof a=="object"){for(const i in a)if(!Ac(a[i]))return!1;return!0}return!1}function Br(a){if(a===null)return Ko;if(typeof a=="string")return zn;if(typeof a=="boolean")return Fn;if(typeof a=="number")return Wt;if(a instanceof Gn)return Ns;if(a instanceof Sc)return So;if(a instanceof An)return _a;if(a instanceof Ki)return A1;if(Array.isArray(a)){const i=a.length;let c;for(const h of a){const g=Br(h);if(c){if(c===g)continue;c=rn;break}c=g}return Di(c||rn,i)}return Bl}function Ga(a){const i=typeof a;return a===null?"":i==="string"||i==="number"||i==="boolean"?String(a):a instanceof Gn||a instanceof An||a instanceof Ki?a.toString():JSON.stringify(a)}class Ji{constructor(i,c){this.type=i,this.value=c}static parse(i,c){if(i.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Ac(i[1]))return c.error("invalid value");const h=i[1];let g=Br(h);const y=c.expectedType;return g.kind!=="array"||g.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(g=y),new Ji(g,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Gn?["rgba"].concat(this.value.toArray()):this.value instanceof An?this.value.serialize():this.value}}class ei{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Ya={string:zn,number:Wt,boolean:Fn,object:Bl};class As{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");let h,g=1;const y=i[0];if(y==="array"){let S,P;if(i.length>2){const M=i[1];if(typeof M!="string"||!(M in Ya)||M==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);S=Ya[M],g++}else S=rn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return c.error('The length argument to "array" must be a positive integer literal',2);P=i[2],g++}h=Di(S,P)}else h=Ya[y];const b=[];for(;g<i.length;g++){const S=c.parse(i[g],g,rn);if(!S)return null;b.push(S)}return new As(h,b)}evaluate(i){for(let c=0;c<this.args.length;c++){const h=this.args[c].evaluate(i);if(!oi(this.type,Br(h)))return h;if(c===this.args.length-1)throw new ei(`Expected value to be of type ${Ir(this.type)}, but found ${Ir(Br(h))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,c=[i.kind];if(i.kind==="array"){const h=i.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){c.push(h.kind);const g=i.N;(typeof g=="number"||this.args.length>1)&&c.push(g)}}return c.concat(this.args.map(h=>h.serialize()))}}class Cs{constructor(i){this.type=_a,this.sections=i}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");const h=i[1];if(!Array.isArray(h)&&typeof h=="object")return c.error("First argument must be an image or text section.");const g=[];let y=!1;for(let b=1;b<=i.length-1;++b){const S=i[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;let P=null;if(S["font-scale"]&&(P=c.parse(S["font-scale"],1,Wt),!P))return null;let M=null;if(S["text-font"]&&(M=c.parse(S["text-font"],1,Di(zn)),!M))return null;let L=null;if(S["text-color"]&&(L=c.parse(S["text-color"],1,Ns),!L))return null;const F=g[g.length-1];F.scale=P,F.font=M,F.textColor=L}else{const P=c.parse(i[b],1,rn);if(!P)return null;const M=P.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,g.push({content:P,scale:null,font:null,textColor:null})}}return new Cs(g)}evaluate(i){return new An(this.sections.map(c=>{const h=c.content.evaluate(i);return Br(h)===A1?new k3("",h,null,null,null):new k3(Ga(h),null,c.scale?c.scale.evaluate(i):null,c.font?c.font.evaluate(i).join(","):null,c.textColor?c.textColor.evaluate(i):null)}))}eachChild(i){for(const c of this.sections)i(c.content),c.scale&&i(c.scale),c.font&&i(c.font),c.textColor&&i(c.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const c of this.sections){i.push(c.content.serialize());const h={};c.scale&&(h["font-scale"]=c.scale.serialize()),c.font&&(h["text-font"]=c.font.serialize()),c.textColor&&(h["text-color"]=c.textColor.serialize()),i.push(h)}return i}}class Ao{constructor(i){this.type=A1,this.input=i}static parse(i,c){if(i.length!==2)return c.error("Expected two arguments.");const h=c.parse(i[1],1,zn);return h?new Ao(h):c.error("No image name provided.")}evaluate(i){const c=this.input.evaluate(i),h=Ki.fromString(c);return h&&i.availableImages&&(h.available=i.availableImages.indexOf(c)>-1),h}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const X0={"to-boolean":Fn,"to-color":Ns,"to-number":Wt,"to-string":zn};class Wr{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");const h=i[0];if((h==="to-boolean"||h==="to-string")&&i.length!==2)return c.error("Expected one argument.");const g=X0[h],y=[];for(let b=1;b<i.length;b++){const S=c.parse(i[b],b,rn);if(!S)return null;y.push(S)}return new Wr(g,y)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let c,h;for(const g of this.args){if(c=g.evaluate(i),h=null,c instanceof Gn)return c;if(typeof c=="string"){const y=i.parseColor(c);if(y)return y}else if(Array.isArray(c)&&(h=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:H0(c[0],c[1],c[2],c[3]),!h))return new Gn(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new ei(h||`Could not parse color from value '${typeof c=="string"?c:String(JSON.stringify(c))}'`)}if(this.type.kind==="number"){let c=null;for(const h of this.args){if(c=h.evaluate(i),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new ei(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?An.fromString(Ga(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?Ki.fromString(Ga(this.args[0].evaluate(i))):Ga(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Cs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ao(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(c=>{i.push(c.serialize())}),i}}const Ka=["Unknown","Point","LineString","Polygon"];class Cc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ka[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:h,y:g}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*c-i[0])+this.featureDistanceData.bearing[1]*(g*c-i[1])}return 0}parseColor(i){let c=this._parseColorCache[i];return c||(c=this._parseColorCache[i]=Gn.parse(i)),c}}class Si{constructor(i,c,h,g){this.name=i,this.type=c,this._evaluate=h,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,c){const h=i[0],g=Si.definitions[h];if(!g)return c.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,S=b.filter(([M])=>!Array.isArray(M)||M.length===i.length-1);let P=null;for(const[M,L]of S){P=new Ic(c.registry,c.path,null,c.scope);const F=[];let N=!1;for(let H=1;H<i.length;H++){const q=i[H],J=Array.isArray(M)?M[H-1]:M.type,oe=P.parse(q,1+F.length,J);if(!oe){N=!0;break}F.push(oe)}if(!N)if(Array.isArray(M)&&M.length!==F.length)P.error(`Expected ${M.length} arguments, but found ${F.length} instead.`);else{for(let H=0;H<F.length;H++){const q=Array.isArray(M)?M[H]:M.type,J=F[H];P.concat(H+1).checkSubtype(q,J.type)}if(P.errors.length===0)return new Si(h,y,L,F)}}if(S.length===1)c.errors.push(...P.errors);else{const M=(S.length?S:b).map(([F])=>{return N=F,Array.isArray(N)?`(${N.map(Ir).join(", ")})`:`(${Ir(N.type)}...)`;var N}).join(" | "),L=[];for(let F=1;F<i.length;F++){const N=c.parse(i[F],1+L.length);if(!N)return null;L.push(Ir(N.type))}c.error(`Expected arguments of type ${M}, but found (${L.join(", ")}) instead.`)}return null}static register(i,c){Si.definitions=c;for(const h in c)i[h]=Si}}class C1{constructor(i,c,h){this.type=So,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=c}static parse(i,c){if(i.length!==2)return c.error("Expected one argument.");const h=i[1];if(typeof h!="object"||Array.isArray(h))return c.error("Collator options argument must be an object.");const g=c.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,Fn);if(!g)return null;const y=c.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,Fn);if(!y)return null;let b=null;return h.locale&&(b=c.parse(h.locale,1,zn),!b)?null:new C1(g,y,b)}evaluate(i){return new Sc(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const Co=8192;function Vl(a,i){a[0]=Math.min(a[0],i[0]),a[1]=Math.min(a[1],i[1]),a[2]=Math.max(a[2],i[0]),a[3]=Math.max(a[3],i[1])}function Qo(a,i){return!(a[0]<=i[0]||a[2]>=i[2]||a[1]<=i[1]||a[3]>=i[3])}function P1(a,i){const c=(180+a[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(c*g*Co),Math.round(h*g*Co)]}function O3(a,i,c){const h=a[0]-i[0],g=a[1]-i[1],y=a[0]-c[0],b=a[1]-c[1];return h*b-y*g==0&&h*y<=0&&g*b<=0}function D3(a,i){let c=!1;for(let b=0,S=i.length;b<S;b++){const P=i[b];for(let M=0,L=P.length;M<L-1;M++){if(O3(a,P[M],P[M+1]))return!1;(g=P[M])[1]>(h=a)[1]!=(y=P[M+1])[1]>h[1]&&h[0]<(y[0]-g[0])*(h[1]-g[1])/(y[1]-g[1])+g[0]&&(c=!c)}}var h,g,y;return c}function Z0(a,i){for(let c=0;c<i.length;c++)if(D3(a,i[c]))return!0;return!1}function L3(a,i,c,h){const g=h[0]-c[0],y=h[1]-c[1],b=(a[0]-c[0])*y-g*(a[1]-c[1]),S=(i[0]-c[0])*y-g*(i[1]-c[1]);return b>0&&S<0||b<0&&S>0}function F3(a,i,c){for(const M of c)for(let L=0;L<M.length-1;++L)if((S=[(b=M[L+1])[0]-(y=M[L])[0],b[1]-y[1]])[0]*(P=[(g=i)[0]-(h=a)[0],g[1]-h[1]])[1]-S[1]*P[0]!=0&&L3(h,g,y,b)&&L3(y,b,h,g))return!0;var h,g,y,b,S,P;return!1}function q0(a,i){for(let c=0;c<a.length;++c)if(!D3(a[c],i))return!1;for(let c=0;c<a.length-1;++c)if(F3(a[c],a[c+1],i))return!1;return!0}function du(a,i){for(let c=0;c<i.length;c++)if(q0(a,i[c]))return!0;return!1}function N3(a,i,c){const h=[];for(let g=0;g<a.length;g++){const y=[];for(let b=0;b<a[g].length;b++){const S=P1(a[g][b],c);Vl(i,S),y.push(S)}h.push(y)}return h}function G0(a,i,c){const h=[];for(let g=0;g<a.length;g++){const y=N3(a[g],i,c);h.push(y)}return h}function B3(a,i,c,h){if(a[0]<c[0]||a[0]>c[2]){const g=.5*h;let y=a[0]-c[0]>g?-h:c[0]-a[0]>g?h:0;y===0&&(y=a[0]-c[2]>g?-h:c[2]-a[0]>g?h:0),a[0]+=y}Vl(i,a)}function z3(a,i,c,h){const g=Math.pow(2,h.z)*Co,y=[h.x*Co,h.y*Co],b=[];for(const S of a)for(const P of S){const M=[P.x+y[0],P.y+y[1]];B3(M,i,c,g),b.push(M)}return b}function Y0(a,i,c,h){const g=Math.pow(2,h.z)*Co,y=[h.x*Co,h.y*Co],b=[];for(const P of a){const M=[];for(const L of P){const F=[L.x+y[0],L.y+y[1]];Vl(i,F),M.push(F)}b.push(M)}if(i[2]-i[0]<=g/2){(S=i)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const P of b)for(const M of P)B3(M,i,c,g)}var S;return b}class Ja{constructor(i,c){this.type=Fn,this.geojson=i,this.geometries=c}static parse(i,c){if(i.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Ac(i[1])){const h=i[1];if(h.type==="FeatureCollection")for(let g=0;g<h.features.length;++g){const y=h.features[g].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Ja(h,h.features[g].geometry)}else if(h.type==="Feature"){const g=h.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ja(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Ja(h,h)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(c,h){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if(h.type==="Polygon"){const S=N3(h.coordinates,y,b),P=z3(c.geometry(),g,y,b);if(!Qo(g,y))return!1;for(const M of P)if(!D3(M,S))return!1}if(h.type==="MultiPolygon"){const S=G0(h.coordinates,y,b),P=z3(c.geometry(),g,y,b);if(!Qo(g,y))return!1;for(const M of P)if(!Z0(M,S))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(c,h){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if(h.type==="Polygon"){const S=N3(h.coordinates,y,b),P=Y0(c.geometry(),g,y,b);if(!Qo(g,y))return!1;for(const M of P)if(!q0(M,S))return!1}if(h.type==="MultiPolygon"){const S=G0(h.coordinates,y,b),P=Y0(c.geometry(),g,y,b);if(!Qo(g,y))return!1;for(const M of P)if(!du(M,S))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function jl(a){if(a instanceof Si&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ja)return!1;let i=!0;return a.eachChild(c=>{i&&!jl(c)&&(i=!1)}),i}function I1(a){if(a instanceof Si&&a.name==="feature-state")return!1;let i=!0;return a.eachChild(c=>{i&&!I1(c)&&(i=!1)}),i}function Qa(a,i){if(a instanceof Si&&i.indexOf(a.name)>=0)return!1;let c=!0;return a.eachChild(h=>{c&&!Qa(h,i)&&(c=!1)}),c}class Pc{constructor(i,c){this.type=c.type,this.name=i,this.boundExpression=c}static parse(i,c){if(i.length!==2||typeof i[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const h=i[1];return c.scope.has(h)?new Pc(h,c.scope.get(h)):c.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ic{constructor(i,c=[],h,g=new Oi,y=[]){this.registry=i,this.path=c,this.key=c.map(b=>`[${b}]`).join(""),this.scope=g,this.errors=y,this.expectedType=h}parse(i,c,h,g,y={}){return c?this.concat(c,h,g)._parse(i,y):this._parse(i,y)}_parse(i,c){function h(g,y,b){return b==="assert"?new As(y,[g]):b==="coerce"?new Wr(y,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[g];if(y){let b=y.parse(i,this);if(!b)return null;if(this.expectedType){const S=this.expectedType,P=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||P.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(S,P))return null}else b=h(b,S,c.typeAnnotation||"coerce");else b=h(b,S,c.typeAnnotation||"assert")}if(!(b instanceof Ji)&&b.type.kind!=="resolvedImage"&&Mc(b)){const S=new Cc;try{b=new Ji(b.type,b.evaluate(S))}catch(P){return this.error(P.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,c,h){const g=typeof i=="number"?this.path.concat(i):this.path,y=h?this.scope.concat(h):this.scope;return new Ic(this.registry,g,c||null,y,this.errors)}error(i,...c){const h=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new wr(h,i))}checkSubtype(i,c){const h=oi(i,c);return h&&this.error(h),h}}function Mc(a){if(a instanceof Pc)return Mc(a.boundExpression);if(a instanceof Si&&a.name==="error"||a instanceof C1||a instanceof Ja)return!1;const i=a instanceof Wr||a instanceof As;let c=!0;return a.eachChild(h=>{c=i?c&&Mc(h):c&&h instanceof Ji}),!!c&&jl(a)&&Qa(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function $l(a,i){const c=a.length-1;let h,g,y=0,b=c,S=0;for(;y<=b;)if(S=Math.floor((y+b)/2),h=a[S],g=a[S+1],h<=i){if(S===c||i<g)return S;y=S+1}else{if(!(h>i))throw new ei("Input is not a number.");b=S-1}return 0}class M1{constructor(i,c,h){this.type=i,this.input=c,this.labels=[],this.outputs=[];for(const[g,y]of h)this.labels.push(g),this.outputs.push(y)}static parse(i,c){if(i.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return c.error("Expected an even number of arguments.");const h=c.parse(i[1],1,Wt);if(!h)return null;const g=[];let y=null;c.expectedType&&c.expectedType.kind!=="value"&&(y=c.expectedType);for(let b=1;b<i.length;b+=2){const S=b===1?-1/0:i[b],P=i[b+1],M=b,L=b+1;if(typeof S!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(g.length&&g[g.length-1][0]>=S)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const F=c.parse(P,L,y);if(!F)return null;y=y||F.type,g.push([S,F])}return new M1(y,h,g)}evaluate(i){const c=this.labels,h=this.outputs;if(c.length===1)return h[0].evaluate(i);const g=this.input.evaluate(i);if(g<=c[0])return h[0].evaluate(i);const y=c.length;return g>=c[y-1]?h[y-1].evaluate(i):h[$l(c,g)].evaluate(i)}eachChild(i){i(this.input);for(const c of this.outputs)i(c)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&i.push(this.labels[c]),i.push(this.outputs[c].serialize());return i}}function rr(a,i,c){return a*(1-c)+i*c}var Rc=Object.freeze({__proto__:null,number:rr,color:function(a,i,c){return new Gn(rr(a.r,i.r,c),rr(a.g,i.g,c),rr(a.b,i.b,c),rr(a.a,i.a,c))},array:function(a,i,c){return a.map((h,g)=>rr(h,i[g],c))}});const K0=.95047,R1=1.08883,U3=4/29,kc=6/29,Oc=3*kc*kc,k1=Math.PI/180,pu=180/Math.PI;function O1(a){return a>.008856451679035631?Math.pow(a,1/3):a/Oc+U3}function D1(a){return a>kc?a*a*a:Oc*(a-U3)}function L1(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Wl(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function V3(a){const i=Wl(a.r),c=Wl(a.g),h=Wl(a.b),g=O1((.4124564*i+.3575761*c+.1804375*h)/K0),y=O1((.2126729*i+.7151522*c+.072175*h)/1);return{l:116*y-16,a:500*(g-y),b:200*(y-O1((.0193339*i+.119192*c+.9503041*h)/R1)),alpha:a.a}}function el(a){let i=(a.l+16)/116,c=isNaN(a.a)?i:i+a.a/500,h=isNaN(a.b)?i:i-a.b/200;return i=1*D1(i),c=K0*D1(c),h=R1*D1(h),new Gn(L1(3.2404542*c-1.5371385*i-.4985314*h),L1(-.969266*c+1.8760108*i+.041556*h),L1(.0556434*c-.2040259*i+1.0572252*h),a.alpha)}function mu(a,i,c){const h=i-a;return a+c*(h>180||h<-180?h-360*Math.round(h/360):h)}const F1={forward:V3,reverse:el,interpolate:function(a,i,c){return{l:rr(a.l,i.l,c),a:rr(a.a,i.a,c),b:rr(a.b,i.b,c),alpha:rr(a.alpha,i.alpha,c)}}},N1={forward:function(a){const{l:i,a:c,b:h}=V3(a),g=Math.atan2(h,c)*pu;return{h:g<0?g+360:g,c:Math.sqrt(c*c+h*h),l:i,alpha:a.a}},reverse:function(a){const i=a.h*k1,c=a.c;return el({l:a.l,a:Math.cos(i)*c,b:Math.sin(i)*c,alpha:a.alpha})},interpolate:function(a,i,c){return{h:mu(a.h,i.h,c),c:rr(a.c,i.c,c),l:rr(a.l,i.l,c),alpha:rr(a.alpha,i.alpha,c)}}};var j3=Object.freeze({__proto__:null,lab:F1,hcl:N1});class Qi{constructor(i,c,h,g,y){this.type=i,this.operator=c,this.interpolation=h,this.input=g,this.labels=[],this.outputs=[];for(const[b,S]of y)this.labels.push(b),this.outputs.push(S)}static interpolationFactor(i,c,h,g){let y=0;if(i.name==="exponential")y=ya(c,i.base,h,g);else if(i.name==="linear")y=ya(c,1,h,g);else if(i.name==="cubic-bezier"){const b=i.controlPoints;y=new C(b[0],b[1],b[2],b[3]).solve(ya(c,1,h,g))}return y}static parse(i,c){let[h,g,y,...b]=i;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const M=g[1];if(typeof M!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:M}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const M=g.slice(1);if(M.length!==4||M.some(L=>typeof L!="number"||L<0||L>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:M}}}if(i.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(y=c.parse(y,2,Wt),!y)return null;const S=[];let P=null;h==="interpolate-hcl"||h==="interpolate-lab"?P=Ns:c.expectedType&&c.expectedType.kind!=="value"&&(P=c.expectedType);for(let M=0;M<b.length;M+=2){const L=b[M],F=b[M+1],N=M+3,H=M+4;if(typeof L!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(S.length&&S[S.length-1][0]>=L)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const q=c.parse(F,H,P);if(!q)return null;P=P||q.type,S.push([L,q])}return P.kind==="number"||P.kind==="color"||P.kind==="array"&&P.itemType.kind==="number"&&typeof P.N=="number"?new Qi(P,h,g,y,S):c.error(`Type ${Ir(P)} is not interpolatable.`)}evaluate(i){const c=this.labels,h=this.outputs;if(c.length===1)return h[0].evaluate(i);const g=this.input.evaluate(i);if(g<=c[0])return h[0].evaluate(i);const y=c.length;if(g>=c[y-1])return h[y-1].evaluate(i);const b=$l(c,g),S=Qi.interpolationFactor(this.interpolation,g,c[b],c[b+1]),P=h[b].evaluate(i),M=h[b+1].evaluate(i);return this.operator==="interpolate"?Rc[this.type.kind.toLowerCase()](P,M,S):this.operator==="interpolate-hcl"?N1.reverse(N1.interpolate(N1.forward(P),N1.forward(M),S)):F1.reverse(F1.interpolate(F1.forward(P),F1.forward(M),S))}eachChild(i){i(this.input);for(const c of this.outputs)i(c)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const c=[this.operator,i,this.input.serialize()];for(let h=0;h<this.labels.length;h++)c.push(this.labels[h],this.outputs[h].serialize());return c}}function ya(a,i,c,h){const g=h-c,y=a-c;return g===0?0:i===1?y/g:(Math.pow(i,y)-1)/(Math.pow(i,g)-1)}class ao{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expectected at least one argument.");let h=null;const g=c.expectedType;g&&g.kind!=="value"&&(h=g);const y=[];for(const S of i.slice(1)){const P=c.parse(S,1+y.length,h,void 0,{typeAnnotation:"omit"});if(!P)return null;h=h||P.type,y.push(P)}const b=g&&y.some(S=>oi(g,S.type));return new ao(b?rn:h,y)}evaluate(i){let c,h=null,g=0;for(const y of this.args){if(g++,h=y.evaluate(i),h&&h instanceof Ki&&!h.available&&(c||(c=h),h=null,g===this.args.length))return c;if(h!==null)break}return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(c=>{i.push(c.serialize())}),i}}class Dc{constructor(i,c){this.type=c.type,this.bindings=[].concat(i),this.result=c}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const c of this.bindings)i(c[1]);i(this.result)}static parse(i,c){if(i.length<4)return c.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const h=[];for(let y=1;y<i.length-1;y+=2){const b=i[y];if(typeof b!="string")return c.error(`Expected string, but found ${typeof b} instead.`,y);if(/[^a-zA-Z0-9_]/.test(b))return c.error("Variable names must contain only alphanumeric characters or '_'.",y);const S=c.parse(i[y+1],y+1);if(!S)return null;h.push([b,S])}const g=c.parse(i[i.length-1],i.length-1,c.expectedType,h);return g?new Dc(h,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[c,h]of this.bindings)i.push(c,h.serialize());return i.push(this.result.serialize()),i}}class Hl{constructor(i,c,h){this.type=i,this.index=c,this.input=h}static parse(i,c){if(i.length!==3)return c.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=c.parse(i[1],1,Wt),g=c.parse(i[2],2,Di(c.expectedType||rn));return h&&g?new Hl(g.type.itemType,h,g):null}evaluate(i){const c=this.index.evaluate(i),h=this.input.evaluate(i);if(c<0)throw new ei(`Array index out of bounds: ${c} < 0.`);if(c>=h.length)throw new ei(`Array index out of bounds: ${c} > ${h.length-1}.`);if(c!==Math.floor(c))throw new ei(`Array index must be an integer, but found ${c} instead.`);return h[c]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class $3{constructor(i,c){this.type=Fn,this.needle=i,this.haystack=c}static parse(i,c){if(i.length!==3)return c.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=c.parse(i[1],1,rn),g=c.parse(i[2],2,rn);return h&&g?zl(h.type,[Fn,zn,Wt,Ko,rn])?new $3(h,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ir(h.type)} instead`):null}evaluate(i){const c=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!h)return!1;if(!Jo(c,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Ir(Br(c))} instead.`);if(!Jo(h,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${Ir(Br(h))} instead.`);return h.indexOf(c)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Bs{constructor(i,c,h){this.type=Wt,this.needle=i,this.haystack=c,this.fromIndex=h}static parse(i,c){if(i.length<=2||i.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=c.parse(i[1],1,rn),g=c.parse(i[2],2,rn);if(!h||!g)return null;if(!zl(h.type,[Fn,zn,Wt,Ko,rn]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ir(h.type)} instead`);if(i.length===4){const y=c.parse(i[3],3,Wt);return y?new Bs(h,g,y):null}return new Bs(h,g)}evaluate(i){const c=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!Jo(c,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Ir(Br(c))} instead.`);if(!Jo(h,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${Ir(Br(h))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(i);return h.indexOf(c,g)}return h.indexOf(c)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Xl{constructor(i,c,h,g,y,b){this.inputType=i,this.type=c,this.input=h,this.cases=g,this.outputs=y,this.otherwise=b}static parse(i,c){if(i.length<5)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return c.error("Expected an even number of arguments.");let h,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const y={},b=[];for(let M=2;M<i.length-1;M+=2){let L=i[M];const F=i[M+1];Array.isArray(L)||(L=[L]);const N=c.concat(M);if(L.length===0)return N.error("Expected at least one branch label.");for(const q of L){if(typeof q!="number"&&typeof q!="string")return N.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return N.error("Numeric branch labels must be integer values.");if(h){if(N.checkSubtype(h,Br(q)))return null}else h=Br(q);if(y[String(q)]!==void 0)return N.error("Branch labels must be unique.");y[String(q)]=b.length}const H=c.parse(F,M,g);if(!H)return null;g=g||H.type,b.push(H)}const S=c.parse(i[1],1,rn);if(!S)return null;const P=c.parse(i[i.length-1],i.length-1,g);return P?S.type.kind!=="value"&&c.concat(1).checkSubtype(h,S.type)?null:new Xl(h,g,S,y,b,P):null}evaluate(i){const c=this.input.evaluate(i);return(Br(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),h=[],g={};for(const b of c){const S=g[this.cases[b]];S===void 0?(g[this.cases[b]]=h.length,h.push([this.cases[b],[b]])):h[S][1].push(b)}const y=b=>this.inputType.kind==="number"?Number(b):b;for(const[b,S]of h)i.push(S.length===1?y(S[0]):S.map(y)),i.push(this.outputs[b].serialize());return i.push(this.otherwise.serialize()),i}}class Po{constructor(i,c,h){this.type=i,this.branches=c,this.otherwise=h}static parse(i,c){if(i.length<4)return c.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return c.error("Expected an odd number of arguments.");let h;c.expectedType&&c.expectedType.kind!=="value"&&(h=c.expectedType);const g=[];for(let b=1;b<i.length-1;b+=2){const S=c.parse(i[b],b,Fn);if(!S)return null;const P=c.parse(i[b+1],b+1,h);if(!P)return null;g.push([S,P]),h=h||P.type}const y=c.parse(i[i.length-1],i.length-1,h);return y?new Po(h,g,y):null}evaluate(i){for(const[c,h]of this.branches)if(c.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[c,h]of this.branches)i(c),i(h);i(this.otherwise)}outputDefined(){return this.branches.every(([i,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(c=>{i.push(c.serialize())}),i}}class Zl{constructor(i,c,h,g){this.type=i,this.input=c,this.beginIndex=h,this.endIndex=g}static parse(i,c){if(i.length<=2||i.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=c.parse(i[1],1,rn),g=c.parse(i[2],2,Wt);if(!h||!g)return null;if(!zl(h.type,[Di(rn),zn,rn]))return c.error(`Expected first argument to be of type array or string, but found ${Ir(h.type)} instead`);if(i.length===4){const y=c.parse(i[3],3,Wt);return y?new Zl(h.type,h,g,y):null}return new Zl(h.type,h,g)}evaluate(i){const c=this.input.evaluate(i),h=this.beginIndex.evaluate(i);if(!Jo(c,["string","array"]))throw new ei(`Expected first argument to be of type array or string, but found ${Ir(Br(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(i);return c.slice(h,g)}return c.slice(h)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function W3(a,i){return a==="=="||a==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function B1(a,i,c,h){return h.compare(i,c)===0}function va(a,i,c){const h=a!=="=="&&a!=="!=";return class xy{constructor(y,b,S){this.type=Fn,this.lhs=y,this.rhs=b,this.collator=S,this.hasUntypedArgument=y.type.kind==="value"||b.type.kind==="value"}static parse(y,b){if(y.length!==3&&y.length!==4)return b.error("Expected two or three arguments.");const S=y[0];let P=b.parse(y[1],1,rn);if(!P)return null;if(!W3(S,P.type))return b.concat(1).error(`"${S}" comparisons are not supported for type '${Ir(P.type)}'.`);let M=b.parse(y[2],2,rn);if(!M)return null;if(!W3(S,M.type))return b.concat(2).error(`"${S}" comparisons are not supported for type '${Ir(M.type)}'.`);if(P.type.kind!==M.type.kind&&P.type.kind!=="value"&&M.type.kind!=="value")return b.error(`Cannot compare types '${Ir(P.type)}' and '${Ir(M.type)}'.`);h&&(P.type.kind==="value"&&M.type.kind!=="value"?P=new As(M.type,[P]):P.type.kind!=="value"&&M.type.kind==="value"&&(M=new As(P.type,[M])));let L=null;if(y.length===4){if(P.type.kind!=="string"&&M.type.kind!=="string"&&P.type.kind!=="value"&&M.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(L=b.parse(y[3],3,So),!L)return null}return new xy(P,M,L)}evaluate(y){const b=this.lhs.evaluate(y),S=this.rhs.evaluate(y);if(h&&this.hasUntypedArgument){const P=Br(b),M=Br(S);if(P.kind!==M.kind||P.kind!=="string"&&P.kind!=="number")throw new ei(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${P.kind}, ${M.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const P=Br(b),M=Br(S);if(P.kind!=="string"||M.kind!=="string")return i(y,b,S)}return this.collator?c(y,b,S,this.collator.evaluate(y)):i(y,b,S)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[a];return this.eachChild(b=>{y.push(b.serialize())}),y}}}const J0=va("==",function(a,i,c){return i===c},B1),H3=va("!=",function(a,i,c){return i!==c},function(a,i,c,h){return!B1(0,i,c,h)}),X3=va("<",function(a,i,c){return i<c},function(a,i,c,h){return h.compare(i,c)<0}),Q0=va(">",function(a,i,c){return i>c},function(a,i,c,h){return h.compare(i,c)>0}),us=va("<=",function(a,i,c){return i<=c},function(a,i,c,h){return h.compare(i,c)<=0}),e4=va(">=",function(a,i,c){return i>=c},function(a,i,c,h){return h.compare(i,c)>=0});class xa{constructor(i,c,h,g,y){this.type=zn,this.number=i,this.locale=c,this.currency=h,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(i,c){if(i.length!==3)return c.error("Expected two arguments.");const h=c.parse(i[1],1,Wt);if(!h)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let y=null;if(g.locale&&(y=c.parse(g.locale,1,zn),!y))return null;let b=null;if(g.currency&&(b=c.parse(g.currency,1,zn),!b))return null;let S=null;if(g["min-fraction-digits"]&&(S=c.parse(g["min-fraction-digits"],1,Wt),!S))return null;let P=null;return g["max-fraction-digits"]&&(P=c.parse(g["max-fraction-digits"],1,Wt),!P)?null:new xa(h,y,b,S,P)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class z1{constructor(i){this.type=Wt,this.input=i}static parse(i,c){if(i.length!==2)return c.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=c.parse(i[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${Ir(h.type)} instead.`):new z1(h):null}evaluate(i){const c=this.input.evaluate(i);if(typeof c=="string"||Array.isArray(c))return c.length;throw new ei(`Expected value to be of type string or array, but found ${Ir(Br(c))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(c=>{i.push(c.serialize())}),i}}const zs={"==":J0,"!=":H3,">":Q0,"<":X3,">=":e4,"<=":us,array:As,at:Hl,boolean:As,case:Po,coalesce:ao,collator:C1,format:Cs,image:Ao,in:$3,"index-of":Bs,interpolate:Qi,"interpolate-hcl":Qi,"interpolate-lab":Qi,length:z1,let:Dc,literal:Ji,match:Xl,number:As,"number-format":xa,object:As,slice:Zl,step:M1,string:As,"to-boolean":Wr,"to-color":Wr,"to-number":Wr,"to-string":Wr,var:Pc,within:Ja};function Lc(a,[i,c,h,g]){i=i.evaluate(a),c=c.evaluate(a),h=h.evaluate(a);const y=g?g.evaluate(a):1,b=H0(i,c,h,y);if(b)throw new ei(b);return new Gn(i/255*y,c/255*y,h/255*y,y)}function Fc(a,i){return a in i}function tl(a,i){const c=i[a];return c===void 0?null:c}function ba(a){return{type:a}}function nl(a){return{result:"success",value:a}}function lo(a){return{result:"error",value:a}}function Io(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Nc(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Bc(a){return!!a.expression&&a.expression.interpolated}function Kn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function ql(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function wa(a){return a}function U1(a,i){const c=i.type==="color",h=a.stops&&typeof a.stops[0][0]=="object",g=h||!(h||a.property!==void 0),y=a.type||(Bc(i)?"exponential":"interval");if(c&&((a=bn({},a)).stops&&(a.stops=a.stops.map(M=>[M[0],Gn.parse(M[1])])),a.default=Gn.parse(a.default?a.default:i.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!j3[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let b,S,P;if(y==="exponential")b=Z3;else if(y==="interval")b=Mr;else if(y==="categorical"){b=V1,S=Object.create(null);for(const M of a.stops)S[M[0]]=M[1];P=typeof a.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);b=t4}if(h){const M={},L=[];for(let H=0;H<a.stops.length;H++){const q=a.stops[H],J=q[0].zoom;M[J]===void 0&&(M[J]={zoom:J,type:a.type,property:a.property,default:a.default,stops:[]},L.push(J)),M[J].stops.push([q[0].value,q[1]])}const F=[];for(const H of L)F.push([M[H].zoom,U1(M[H],i)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:Qi.interpolationFactor.bind(void 0,N),zoomStops:F.map(H=>H[0]),evaluate:({zoom:H},q)=>Z3({stops:F,base:a.base},i,H).evaluate(H,q)}}if(g){const M=y==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Qi.interpolationFactor.bind(void 0,M),zoomStops:a.stops.map(L=>L[0]),evaluate:({zoom:L})=>b(a,i,L,S,P)}}return{kind:"source",evaluate(M,L){const F=L&&L.properties?L.properties[a.property]:void 0;return F===void 0?mi(a.default,i.default):b(a,i,F,S,P)}}}function mi(a,i,c){return a!==void 0?a:i!==void 0?i:c!==void 0?c:void 0}function V1(a,i,c,h,g){return mi(typeof c===g?h[c]:void 0,a.default,i.default)}function Mr(a,i,c){if(Kn(c)!=="number")return mi(a.default,i.default);const h=a.stops.length;if(h===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[h-1][0])return a.stops[h-1][1];const g=$l(a.stops.map(y=>y[0]),c);return a.stops[g][1]}function Z3(a,i,c){const h=a.base!==void 0?a.base:1;if(Kn(c)!=="number")return mi(a.default,i.default);const g=a.stops.length;if(g===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[g-1][0])return a.stops[g-1][1];const y=$l(a.stops.map(L=>L[0]),c),b=function(L,F,N,H){const q=H-N,J=L-N;return q===0?0:F===1?J/q:(Math.pow(F,J)-1)/(Math.pow(F,q)-1)}(c,h,a.stops[y][0],a.stops[y+1][0]),S=a.stops[y][1],P=a.stops[y+1][1];let M=Rc[i.type]||wa;if(a.colorSpace&&a.colorSpace!=="rgb"){const L=j3[a.colorSpace];M=(F,N)=>L.reverse(L.interpolate(L.forward(F),L.forward(N),b))}return typeof S.evaluate=="function"?{evaluate(...L){const F=S.evaluate.apply(void 0,L),N=P.evaluate.apply(void 0,L);if(F!==void 0&&N!==void 0)return M(F,N,b)}}:M(S,P,b)}function t4(a,i,c){return i.type==="color"?c=Gn.parse(c):i.type==="formatted"?c=An.fromString(c.toString()):i.type==="resolvedImage"?c=Ki.fromString(c.toString()):Kn(c)===i.type||i.type==="enum"&&i.values[c]||(c=void 0),mi(c,a.default,i.default)}Si.register(zs,{error:[{kind:"error"},[zn],(a,[i])=>{throw new ei(i.evaluate(a))}],typeof:[zn,[rn],(a,[i])=>Ir(Br(i.evaluate(a)))],"to-rgba":[Di(Wt,4),[Ns],(a,[i])=>i.evaluate(a).toArray()],rgb:[Ns,[Wt,Wt,Wt],Lc],rgba:[Ns,[Wt,Wt,Wt,Wt],Lc],has:{type:Fn,overloads:[[[zn],(a,[i])=>Fc(i.evaluate(a),a.properties())],[[zn,Bl],(a,[i,c])=>Fc(i.evaluate(a),c.evaluate(a))]]},get:{type:rn,overloads:[[[zn],(a,[i])=>tl(i.evaluate(a),a.properties())],[[zn,Bl],(a,[i,c])=>tl(i.evaluate(a),c.evaluate(a))]]},"feature-state":[rn,[zn],(a,[i])=>tl(i.evaluate(a),a.featureState||{})],properties:[Bl,[],a=>a.properties()],"geometry-type":[zn,[],a=>a.geometryType()],id:[rn,[],a=>a.id()],zoom:[Wt,[],a=>a.globals.zoom],pitch:[Wt,[],a=>a.globals.pitch||0],"distance-from-center":[Wt,[],a=>a.distanceFromCenter()],"heatmap-density":[Wt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Wt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[Wt,[],a=>a.globals.skyRadialProgress||0],accumulated:[rn,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Wt,ba(Wt),(a,i)=>{let c=0;for(const h of i)c+=h.evaluate(a);return c}],"*":[Wt,ba(Wt),(a,i)=>{let c=1;for(const h of i)c*=h.evaluate(a);return c}],"-":{type:Wt,overloads:[[[Wt,Wt],(a,[i,c])=>i.evaluate(a)-c.evaluate(a)],[[Wt],(a,[i])=>-i.evaluate(a)]]},"/":[Wt,[Wt,Wt],(a,[i,c])=>i.evaluate(a)/c.evaluate(a)],"%":[Wt,[Wt,Wt],(a,[i,c])=>i.evaluate(a)%c.evaluate(a)],ln2:[Wt,[],()=>Math.LN2],pi:[Wt,[],()=>Math.PI],e:[Wt,[],()=>Math.E],"^":[Wt,[Wt,Wt],(a,[i,c])=>Math.pow(i.evaluate(a),c.evaluate(a))],sqrt:[Wt,[Wt],(a,[i])=>Math.sqrt(i.evaluate(a))],log10:[Wt,[Wt],(a,[i])=>Math.log(i.evaluate(a))/Math.LN10],ln:[Wt,[Wt],(a,[i])=>Math.log(i.evaluate(a))],log2:[Wt,[Wt],(a,[i])=>Math.log(i.evaluate(a))/Math.LN2],sin:[Wt,[Wt],(a,[i])=>Math.sin(i.evaluate(a))],cos:[Wt,[Wt],(a,[i])=>Math.cos(i.evaluate(a))],tan:[Wt,[Wt],(a,[i])=>Math.tan(i.evaluate(a))],asin:[Wt,[Wt],(a,[i])=>Math.asin(i.evaluate(a))],acos:[Wt,[Wt],(a,[i])=>Math.acos(i.evaluate(a))],atan:[Wt,[Wt],(a,[i])=>Math.atan(i.evaluate(a))],min:[Wt,ba(Wt),(a,i)=>Math.min(...i.map(c=>c.evaluate(a)))],max:[Wt,ba(Wt),(a,i)=>Math.max(...i.map(c=>c.evaluate(a)))],abs:[Wt,[Wt],(a,[i])=>Math.abs(i.evaluate(a))],round:[Wt,[Wt],(a,[i])=>{const c=i.evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[Wt,[Wt],(a,[i])=>Math.floor(i.evaluate(a))],ceil:[Wt,[Wt],(a,[i])=>Math.ceil(i.evaluate(a))],"filter-==":[Fn,[zn,rn],(a,[i,c])=>a.properties()[i.value]===c.value],"filter-id-==":[Fn,[rn],(a,[i])=>a.id()===i.value],"filter-type-==":[Fn,[zn],(a,[i])=>a.geometryType()===i.value],"filter-<":[Fn,[zn,rn],(a,[i,c])=>{const h=a.properties()[i.value],g=c.value;return typeof h==typeof g&&h<g}],"filter-id-<":[Fn,[rn],(a,[i])=>{const c=a.id(),h=i.value;return typeof c==typeof h&&c<h}],"filter->":[Fn,[zn,rn],(a,[i,c])=>{const h=a.properties()[i.value],g=c.value;return typeof h==typeof g&&h>g}],"filter-id->":[Fn,[rn],(a,[i])=>{const c=a.id(),h=i.value;return typeof c==typeof h&&c>h}],"filter-<=":[Fn,[zn,rn],(a,[i,c])=>{const h=a.properties()[i.value],g=c.value;return typeof h==typeof g&&h<=g}],"filter-id-<=":[Fn,[rn],(a,[i])=>{const c=a.id(),h=i.value;return typeof c==typeof h&&c<=h}],"filter->=":[Fn,[zn,rn],(a,[i,c])=>{const h=a.properties()[i.value],g=c.value;return typeof h==typeof g&&h>=g}],"filter-id->=":[Fn,[rn],(a,[i])=>{const c=a.id(),h=i.value;return typeof c==typeof h&&c>=h}],"filter-has":[Fn,[rn],(a,[i])=>i.value in a.properties()],"filter-has-id":[Fn,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Fn,[Di(zn)],(a,[i])=>i.value.indexOf(a.geometryType())>=0],"filter-id-in":[Fn,[Di(rn)],(a,[i])=>i.value.indexOf(a.id())>=0],"filter-in-small":[Fn,[zn,Di(rn)],(a,[i,c])=>c.value.indexOf(a.properties()[i.value])>=0],"filter-in-large":[Fn,[zn,Di(rn)],(a,[i,c])=>function(h,g,y,b){for(;y<=b;){const S=y+b>>1;if(g[S]===h)return!0;g[S]>h?b=S-1:y=S+1}return!1}(a.properties()[i.value],c.value,0,c.value.length-1)],all:{type:Fn,overloads:[[[Fn,Fn],(a,[i,c])=>i.evaluate(a)&&c.evaluate(a)],[ba(Fn),(a,i)=>{for(const c of i)if(!c.evaluate(a))return!1;return!0}]]},any:{type:Fn,overloads:[[[Fn,Fn],(a,[i,c])=>i.evaluate(a)||c.evaluate(a)],[ba(Fn),(a,i)=>{for(const c of i)if(c.evaluate(a))return!0;return!1}]]},"!":[Fn,[Fn],(a,[i])=>!i.evaluate(a)],"is-supported-script":[Fn,[zn],(a,[i])=>{const c=a.globals&&a.globals.isSupportedScript;return!c||c(i.evaluate(a))}],upcase:[zn,[zn],(a,[i])=>i.evaluate(a).toUpperCase()],downcase:[zn,[zn],(a,[i])=>i.evaluate(a).toLowerCase()],concat:[zn,ba(rn),(a,i)=>i.map(c=>Ga(c.evaluate(a))).join("")],"resolved-locale":[zn,[So],(a,[i])=>i.evaluate(a).resolvedLocale()]});class zc{constructor(i,c){this.expression=i,this._warningHistory={},this._evaluator=new Cc,this._defaultValue=c?function(h){return h.type==="color"&&ql(h.default)?new Gn(0,0,0,0):h.type==="color"?Gn.parse(h.default)||null:h.default===void 0?null:h.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(i,c,h,g,y,b,S,P){return this._evaluator.globals=i,this._evaluator.feature=c,this._evaluator.featureState=h,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(i,c,h,g,y,b,S,P){this._evaluator.globals=i,this._evaluator.feature=c||null,this._evaluator.featureState=h||null,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=P||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new ei(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function rl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in zs}function Gl(a,i){const c=new Ic(zs,[],i?function(g){const y={color:Ns,string:zn,number:Wt,enum:zn,boolean:Fn,formatted:_a,resolvedImage:A1};return g.type==="array"?Di(y[g.value]||rn,g.length):y[g.type]}(i):void 0),h=c.parse(a,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?nl(new zc(h,i)):lo(c.errors)}class ea{constructor(i,c){this.kind=i,this._styleExpression=c,this.isStateDependent=i!=="constant"&&!I1(c.expression)}evaluateWithoutErrorHandling(i,c,h,g,y,b){return this._styleExpression.evaluateWithoutErrorHandling(i,c,h,g,y,b)}evaluate(i,c,h,g,y,b){return this._styleExpression.evaluate(i,c,h,g,y,b)}}class Yl{constructor(i,c,h,g){this.kind=i,this.zoomStops=h,this._styleExpression=c,this.isStateDependent=i!=="camera"&&!I1(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,c,h,g,y,b){return this._styleExpression.evaluateWithoutErrorHandling(i,c,h,g,y,b)}evaluate(i,c,h,g,y,b){return this._styleExpression.evaluate(i,c,h,g,y,b)}interpolationFactor(i,c,h){return this.interpolationType?Qi.interpolationFactor(this.interpolationType,i,c,h):0}}function il(a,i){if((a=Gl(a,i)).result==="error")return a;const c=a.value.expression,h=jl(c);if(!h&&!Io(i))return lo([new wr("","data expressions not supported")]);const g=Qa(c,["zoom","pitch","distance-from-center"]);if(!g&&!Nc(i))return lo([new wr("","zoom expressions not supported")]);const y=ol(c);return y||g?y instanceof wr?lo([y]):y instanceof Qi&&!Bc(i)?lo([new wr("",'"interpolate" expressions cannot be used with this property')]):nl(y?new Yl(h?"camera":"composite",a.value,y.labels,y instanceof Qi?y.interpolation:void 0):new ea(h?"constant":"source",a.value)):lo([new wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class sl{constructor(i,c){this._parameters=i,this._specification=c,bn(this,U1(this._parameters,this._specification))}static deserialize(i){return new sl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function ol(a){let i=null;if(a instanceof Dc)i=ol(a.result);else if(a instanceof ao){for(const c of a.args)if(i=ol(c),i)break}else(a instanceof M1||a instanceof Qi)&&a.input instanceof Si&&a.input.name==="zoom"&&(i=a);return i instanceof wr||a.eachChild(c=>{const h=ol(c);h instanceof wr?i=h:!i&&h?i=new wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&h&&i!==h&&(i=new wr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function hs(a){const i=a.key,c=a.value,h=a.valueSpec||{},g=a.objectElementValidators||{},y=a.style,b=a.styleSpec;let S=[];const P=Kn(c);if(P!=="object")return[new He(i,c,`object expected, ${P} found`)];for(const M in c){const L=M.split(".")[0],F=h[L]||h["*"];let N;if(g[L])N=g[L];else if(h[L])N=ai;else if(g["*"])N=g["*"];else{if(!h["*"]){S.push(new He(i,c[M],`unknown property "${M}"`));continue}N=ai}S=S.concat(N({key:(i&&`${i}.`)+M,value:c[M],valueSpec:F,style:y,styleSpec:b,object:c,objectKey:M},c))}for(const M in h)g[M]||h[M].required&&h[M].default===void 0&&c[M]===void 0&&S.push(new He(i,c,`missing required property "${M}"`));return S}function j1(a){const i=a.value,c=a.valueSpec,h=a.style,g=a.styleSpec,y=a.key,b=a.arrayElementValidator||ai;if(Kn(i)!=="array")return[new He(y,i,`array expected, ${Kn(i)} found`)];if(c.length&&i.length!==c.length)return[new He(y,i,`array length ${c.length} expected, length ${i.length} found`)];if(c["min-length"]&&i.length<c["min-length"])return[new He(y,i,`array length at least ${c["min-length"]} expected, length ${i.length} found`)];let S={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum};g.$version<7&&(S.function=c.function),Kn(c.value)==="object"&&(S=c.value);let P=[];for(let M=0;M<i.length;M++)P=P.concat(b({array:i,arrayIndex:M,value:i[M],valueSpec:S,style:h,styleSpec:g,key:`${y}[${M}]`}));return P}function q3(a){const i=a.key,c=a.value,h=a.valueSpec;let g=Kn(c);if(g==="number"&&c!=c&&(g="NaN"),g!=="number")return[new He(i,c,`number expected, ${g} found`)];if("minimum"in h){let y=h.minimum;if(Kn(h.minimum)==="array"&&(y=h.minimum[a.arrayIndex]),c<y)return[new He(i,c,`${c} is less than the minimum value ${y}`)]}if("maximum"in h){let y=h.maximum;if(Kn(h.maximum)==="array"&&(y=h.maximum[a.arrayIndex]),c>y)return[new He(i,c,`${c} is greater than the maximum value ${y}`)]}return[]}function Kl(a){const i=a.valueSpec,c=Pn(a.value.type);let h,g,y,b={};const S=c!=="categorical"&&a.value.property===void 0,P=!S,M=Kn(a.value.stops)==="array"&&Kn(a.value.stops[0])==="array"&&Kn(a.value.stops[0][0])==="object",L=hs({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(H){if(c==="identity")return[new He(H.key,H.value,'identity function may not have a "stops" property')];let q=[];const J=H.value;return q=q.concat(j1({key:H.key,value:J,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:F})),Kn(J)==="array"&&J.length===0&&q.push(new He(H.key,J,"array must have at least one stop")),q},default:function(H){return ai({key:H.key,value:H.value,valueSpec:i,style:H.style,styleSpec:H.styleSpec})}}});return c==="identity"&&S&&L.push(new He(a.key,a.value,'missing required property "property"')),c==="identity"||a.value.stops||L.push(new He(a.key,a.value,'missing required property "stops"')),c==="exponential"&&a.valueSpec.expression&&!Bc(a.valueSpec)&&L.push(new He(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(P&&!Io(a.valueSpec)?L.push(new He(a.key,a.value,"property functions not supported")):S&&!Nc(a.valueSpec)&&L.push(new He(a.key,a.value,"zoom functions not supported"))),c!=="categorical"&&!M||a.value.property!==void 0||L.push(new He(a.key,a.value,'"property" property is required')),L;function F(H){let q=[];const J=H.value,oe=H.key;if(Kn(J)!=="array")return[new He(oe,J,`array expected, ${Kn(J)} found`)];if(J.length!==2)return[new He(oe,J,`array length 2 expected, length ${J.length} found`)];if(M){if(Kn(J[0])!=="object")return[new He(oe,J,`object expected, ${Kn(J[0])} found`)];if(J[0].zoom===void 0)return[new He(oe,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new He(oe,J,"object stop key must have value")];if(y&&y>Pn(J[0].zoom))return[new He(oe,J[0].zoom,"stop zoom values must appear in ascending order")];Pn(J[0].zoom)!==y&&(y=Pn(J[0].zoom),g=void 0,b={}),q=q.concat(hs({key:`${oe}[0]`,value:J[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:q3,value:N}}))}else q=q.concat(N({key:`${oe}[0]`,value:J[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},J));return rl(vr(J[1]))?q.concat([new He(`${oe}[1]`,J[1],"expressions are not allowed in function stops.")]):q.concat(ai({key:`${oe}[1]`,value:J[1],valueSpec:i,style:H.style,styleSpec:H.styleSpec}))}function N(H,q){const J=Kn(H.value),oe=Pn(H.value),me=H.value!==null?H.value:q;if(h){if(J!==h)return[new He(H.key,me,`${J} stop domain type must match previous stop domain type ${h}`)]}else h=J;if(J!=="number"&&J!=="string"&&J!=="boolean")return[new He(H.key,me,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&c!=="categorical"){let Ce=`number expected, ${J} found`;return Io(i)&&c===void 0&&(Ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new He(H.key,me,Ce)]}return c!=="categorical"||J!=="number"||isFinite(oe)&&Math.floor(oe)===oe?c!=="categorical"&&J==="number"&&g!==void 0&&oe<g?[new He(H.key,me,"stop domain values must appear in ascending order")]:(g=oe,c==="categorical"&&oe in b?[new He(H.key,me,"stop domain values must be unique")]:(b[oe]=!0,[])):[new He(H.key,me,`integer expected, found ${oe}`)]}}function Mo(a){const i=(a.expressionContext==="property"?il:Gl)(vr(a.value),a.valueSpec);if(i.result==="error")return i.value.map(h=>new He(`${a.key}${h.key}`,a.value,h.message));const c=i.value.expression||i.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new He(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!I1(c))return[new He(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter")return G3(c,a);if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Qa(c,["zoom","feature-state"]))return[new He(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!jl(c))return[new He(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function G3(a,i){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const g of i.valueSpec.expression.parameters)c.delete(g);if(c.size===0)return[];const h=[];return a instanceof Si&&c.has(a.name)?[new He(i.key,i.value,`["${a.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(a.eachChild(g=>{h.push(...G3(g,i))}),h)}function Jl(a){const i=a.key,c=a.value,h=a.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(Pn(c))===-1&&g.push(new He(i,c,`expected one of [${h.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(h.values).indexOf(Pn(c))===-1&&g.push(new He(i,c,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function ta(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const i of a.slice(1))if(!ta(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function $1(a,i="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ta(a)||(a=W1(a));const c=a;let h=!0;try{h=function(M){if(!na(M))return M;let L=vr(M);return n4(L),L=Ql(L),L}(c)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(c,null,2)}
        `)}const g=ge[`filter_${i}`],y=Gl(h,g);let b=null;if(y.result==="error")throw new Error(y.value.map(M=>`${M.key}: ${M.message}`).join(", "));b=(M,L,F)=>y.value.evaluate(M,L,{},F);let S=null,P=null;if(h!==c){const M=Gl(c,g);if(M.result==="error")throw new Error(M.value.map(L=>`${L.key}: ${L.message}`).join(", "));S=(L,F,N,H,q)=>M.value.evaluate(L,F,{},N,void 0,void 0,H,q),P=!jl(M.value.expression)}return b=b,{filter:b,dynamicFilter:S||void 0,needGeometry:Ea(h),needFeature:!!P}}function Ql(a){if(!Array.isArray(a))return a;const i=function(c){if(Ta.has(c[0])){for(let h=1;h<c.length;h++)if(na(c[h]))return!0}return c}(a);return i===!0?i:i.map(c=>Ql(c))}function n4(a){let i=!1;const c=[];if(a[0]==="case"){for(let h=1;h<a.length-1;h+=2)i=i||na(a[h]),c.push(a[h+1]);c.push(a[a.length-1])}else if(a[0]==="match"){i=i||na(a[1]);for(let h=2;h<a.length-1;h+=2)c.push(a[h+1]);c.push(a[a.length-1])}else if(a[0]==="step"){i=i||na(a[1]);for(let h=1;h<a.length-1;h+=2)c.push(a[h+1])}i&&(a.length=0,a.push("any",...c));for(let h=1;h<a.length;h++)n4(a[h])}function na(a){if(!Array.isArray(a))return!1;if((i=a[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let c=1;c<a.length;c++)if(na(a[c]))return!0;return!1}const Ta=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Uc(a,i){return a<i?-1:a>i?1:0}function Ea(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let i=1;i<a.length;i++)if(Ea(a[i]))return!0;return!1}function W1(a){if(!a)return!0;const i=a[0];return a.length<=1?i!=="any":i==="=="?ra(a[1],a[2],"=="):i==="!="?ll(ra(a[1],a[2],"==")):i==="<"||i===">"||i==="<="||i===">="?ra(a[1],a[2],i):i==="any"?(c=a.slice(1),["any"].concat(c.map(W1))):i==="all"?["all"].concat(a.slice(1).map(W1)):i==="none"?["all"].concat(a.slice(1).map(W1).map(ll)):i==="in"?e1(a[1],a.slice(2)):i==="!in"?ll(e1(a[1],a.slice(2))):i==="has"?al(a[1]):i==="!has"?ll(al(a[1])):i!=="within"||a;var c}function ra(a,i,c){switch(a){case"$type":return[`filter-type-${c}`,i];case"$id":return[`filter-id-${c}`,i];default:return[`filter-${c}`,a,i]}}function e1(a,i){if(i.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(c=>typeof c!=typeof i[0])?["filter-in-large",a,["literal",i.sort(Uc)]]:["filter-in-small",a,["literal",i]]}}function al(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function ll(a){return["!",a]}function Vc(a){if(ta(vr(a.value))){const i=vr(a.layerType);return Mo(bn({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${i||"fill"}`]}))}return jc(a)}function jc(a){const i=a.value,c=a.key;if(Kn(i)!=="array")return[new He(c,i,`array expected, ${Kn(i)} found`)];const h=a.styleSpec;let g,y=[];if(i.length<1)return[new He(c,i,"filter array must have at least 1 element")];switch(y=y.concat(Jl({key:`${c}[0]`,value:i[0],valueSpec:h.filter_operator,style:a.style,styleSpec:a.styleSpec})),Pn(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Pn(i[1])==="$type"&&y.push(new He(c,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&y.push(new He(c,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=Kn(i[1]),g!=="string"&&y.push(new He(`${c}[1]`,i[1],`string expected, ${g} found`)));for(let b=2;b<i.length;b++)g=Kn(i[b]),Pn(i[1])==="$type"?y=y.concat(Jl({key:`${c}[${b}]`,value:i[b],valueSpec:h.geometry_type,style:a.style,styleSpec:a.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new He(`${c}[${b}]`,i[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<i.length;b++)y=y.concat(jc({key:`${c}[${b}]`,value:i[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":g=Kn(i[1]),i.length!==2?y.push(new He(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new He(`${c}[1]`,i[1],`string expected, ${g} found`));break;case"within":g=Kn(i[1]),i.length!==2?y.push(new He(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="object"&&y.push(new He(`${c}[1]`,i[1],`object expected, ${g} found`))}return y}function Ro(a,i){const c=a.key,h=a.style,g=a.styleSpec,y=a.value,b=a.objectKey,S=g[`${i}_${a.layerType}`];if(!S)return[];const P=b.match(/^(.*)-transition$/);if(i==="paint"&&P&&S[P[1]]&&S[P[1]].transition)return ai({key:c,value:y,valueSpec:g.transition,style:h,styleSpec:g});const M=a.valueSpec||S[b];if(!M)return[new He(c,y,`unknown property "${b}"`)];let L;if(Kn(y)==="string"&&Io(M)&&!M.tokens&&(L=/^{([^}]+)}$/.exec(y)))return[new He(c,y,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const F=[];return a.layerType==="symbol"&&(b==="text-field"&&h&&!h.glyphs&&F.push(new He(c,y,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&ql(vr(y))&&Pn(y.type)==="identity"&&F.push(new He(c,y,'"text-font" does not support identity functions'))),F.concat(ai({key:a.key,value:y,valueSpec:M,style:h,styleSpec:g,expressionContext:"property",propertyType:i,propertyKey:b}))}function ia(a){return Ro(a,"paint")}function Ar(a){return Ro(a,"layout")}function Cr(a){let i=[];const c=a.value,h=a.key,g=a.style,y=a.styleSpec;c.type||c.ref||i.push(new He(h,c,'either "type" or "ref" is required'));let b=Pn(c.type);const S=Pn(c.ref);if(c.id){const P=Pn(c.id);for(let M=0;M<a.arrayIndex;M++){const L=g.layers[M];Pn(L.id)===P&&i.push(new He(h,c.id,`duplicate layer id "${c.id}", previously used at line ${L.id.__line__}`))}}if("ref"in c){let P;["type","source","source-layer","filter","layout"].forEach(M=>{M in c&&i.push(new He(h,c[M],`"${M}" is prohibited for ref layers`))}),g.layers.forEach(M=>{Pn(M.id)===S&&(P=M)}),P?P.ref?i.push(new He(h,c.ref,"ref cannot reference another ref layer")):b=Pn(P.type):i.push(new He(h,c.ref,`ref layer "${S}" not found`))}else if(b!=="background"&&b!=="sky")if(c.source){const P=g.sources&&g.sources[c.source],M=P&&Pn(P.type);P?M==="vector"&&b==="raster"?i.push(new He(h,c.source,`layer "${c.id}" requires a raster source`)):M==="raster"&&b!=="raster"?i.push(new He(h,c.source,`layer "${c.id}" requires a vector source`)):M!=="vector"||c["source-layer"]?M==="raster-dem"&&b!=="hillshade"?i.push(new He(h,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!c.paint||!c.paint["line-gradient"]||M==="geojson"&&P.lineMetrics||i.push(new He(h,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new He(h,c,`layer "${c.id}" must specify a "source-layer"`)):i.push(new He(h,c.source,`source "${c.source}" not found`))}else i.push(new He(h,c,'missing required property "source"'));return i=i.concat(hs({key:h,value:c,valueSpec:y.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ai({key:`${h}.type`,value:c.type,valueSpec:y.layer.type,style:a.style,styleSpec:a.styleSpec,object:c,objectKey:"type"}),filter:P=>Vc(bn({layerType:b},P)),layout:P=>hs({layer:c,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":M=>Ar(bn({layerType:b},M))}}),paint:P=>hs({layer:c,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":M=>ia(bn({layerType:b},M))}})}})),i}function Ps(a){const i=a.value,c=a.key,h=Kn(i);return h!=="string"?[new He(c,i,`string expected, ${h} found`)]:[]}const gi={promoteId:function({key:a,value:i}){if(Kn(i)==="string")return Ps({key:a,value:i});{const c=[];for(const h in i)c.push(...Ps({key:`${a}.${h}`,value:i[h]}));return c}}};function es(a){const i=a.value,c=a.key,h=a.styleSpec,g=a.style;if(!i.type)return[new He(c,i,'"type" is required')];const y=Pn(i.type);let b;switch(y){case"vector":case"raster":case"raster-dem":return b=hs({key:c,value:i,valueSpec:h[`source_${y.replace("-","_")}`],style:a.style,styleSpec:h,objectElementValidators:gi}),b;case"geojson":if(b=hs({key:c,value:i,valueSpec:h.source_geojson,style:g,styleSpec:h,objectElementValidators:gi}),i.cluster)for(const S in i.clusterProperties){const[P,M]=i.clusterProperties[S],L=typeof P=="string"?[P,["accumulated"],["get",S]]:P;b.push(...Mo({key:`${c}.${S}.map`,value:M,expressionContext:"cluster-map"})),b.push(...Mo({key:`${c}.${S}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return b;case"video":return hs({key:c,value:i,valueSpec:h.source_video,style:g,styleSpec:h});case"image":return hs({key:c,value:i,valueSpec:h.source_image,style:g,styleSpec:h});case"canvas":return[new He(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jl({key:`${c}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:h})}}function sa(a){const i=a.value,c=a.styleSpec,h=c.light,g=a.style;let y=[];const b=Kn(i);if(i===void 0)return y;if(b!=="object")return y=y.concat([new He("light",i,`object expected, ${b} found`)]),y;for(const S in i){const P=S.match(/^(.*)-transition$/);y=y.concat(P&&h[P[1]]&&h[P[1]].transition?ai({key:S,value:i[S],valueSpec:c.transition,style:g,styleSpec:c}):h[S]?ai({key:S,value:i[S],valueSpec:h[S],style:g,styleSpec:c}):[new He(S,i[S],`unknown property "${S}"`)])}return y}function Sa(a){const i=a.value,c=a.key,h=a.style,g=a.styleSpec,y=g.terrain;let b=[];const S=Kn(i);if(i===void 0)return b;if(S!=="object")return b=b.concat([new He("terrain",i,`object expected, ${S} found`)]),b;for(const P in i){const M=P.match(/^(.*)-transition$/);b=b.concat(M&&y[M[1]]&&y[M[1]].transition?ai({key:P,value:i[P],valueSpec:g.transition,style:h,styleSpec:g}):y[P]?ai({key:P,value:i[P],valueSpec:y[P],style:h,styleSpec:g}):[new He(P,i[P],`unknown property "${P}"`)])}if(i.source){const P=h.sources&&h.sources[i.source],M=P&&Pn(P.type);P?M!=="raster-dem"&&b.push(new He(c,i.source,`terrain cannot be used with a source of type ${M}, it only be used with a "raster-dem" source type`)):b.push(new He(c,i.source,`source "${i.source}" not found`))}else b.push(new He(c,i,'terrain is missing required property "source"'));return b}function Li(a){const i=a.value,c=a.style,h=a.styleSpec,g=h.fog;let y=[];const b=Kn(i);if(i===void 0)return y;if(b!=="object")return y=y.concat([new He("fog",i,`object expected, ${b} found`)]),y;for(const S in i){const P=S.match(/^(.*)-transition$/);y=y.concat(P&&g[P[1]]&&g[P[1]].transition?ai({key:S,value:i[S],valueSpec:h.transition,style:c,styleSpec:h}):g[S]?ai({key:S,value:i[S],valueSpec:g[S],style:c,styleSpec:h}):[new He(S,i[S],`unknown property "${S}"`)])}return y}const t1={"*":()=>[],array:j1,boolean:function(a){const i=a.value,c=a.key,h=Kn(i);return h!=="boolean"?[new He(c,i,`boolean expected, ${h} found`)]:[]},number:q3,color:function(a){const i=a.key,c=a.value,h=Kn(c);return h!=="string"?[new He(i,c,`color expected, ${h} found`)]:Ul.parseCSSColor(c)===null?[new He(i,c,`color expected, "${c}" found`)]:[]},constants:Jt,enum:Jl,filter:Vc,function:Kl,layer:Cr,object:hs,source:es,light:sa,terrain:Sa,fog:Li,string:Ps,formatted:function(a){return Ps(a).length===0?[]:Mo(a)},resolvedImage:function(a){return Ps(a).length===0?[]:Mo(a)},projection:function(a){const i=a.value,c=a.styleSpec,h=c.projection,g=a.style;let y=[];const b=Kn(i);if(b==="object")for(const S in i)y=y.concat(ai({key:S,value:i[S],valueSpec:h[S],style:g,styleSpec:c}));else b!=="string"&&(y=y.concat([new He("projection",i,`object or string expected, ${b} found`)]));return y}};function ai(a){const i=a.value,c=a.valueSpec,h=a.styleSpec;return c.expression&&ql(Pn(i))?Kl(a):c.expression&&rl(vr(i))?Mo(a):c.type&&t1[c.type]?t1[c.type](a):hs(bn({},a,{valueSpec:c.type?h[c.type]:c}))}function $c(a){const i=a.value,c=a.key,h=Ps(a);return h.length||(i.indexOf("{fontstack}")===-1&&h.push(new He(c,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&h.push(new He(c,i,'"glyphs" url must include a "{range}" token'))),h}function Us(a,i=ge){let c=[];return c=c.concat(ai({key:"",value:a,valueSpec:i.$root,styleSpec:i,style:a,objectElementValidators:{glyphs:$c,"*":()=>[]}})),a.constants&&(c=c.concat(Jt({key:"constants",value:a.constants,style:a,styleSpec:i}))),Y3(c)}function Y3(a){return[].concat(a).sort((i,c)=>i.line-c.line)}function Is(a){return function(...i){return Y3(a.apply(this,i))}}Us.source=Is(es),Us.light=Is(sa),Us.terrain=Is(Sa),Us.fog=Is(Li),Us.layer=Is(Cr),Us.filter=Is(Vc),Us.paintProperty=Is(ia),Us.layoutProperty=Is(Ar);const Vs=Us,n1=Vs.light,K3=Vs.fog,H1=Vs.paintProperty,gu=Vs.layoutProperty;function J3(a,i){let c=!1;if(i&&i.length)for(const h of i)a.fire(new fe(new Error(h.message))),c=!0;return c}var cl=ts;function ts(a,i,c){var h=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var g=new Int32Array(this.arrayBuffer);a=g[0],this.d=(i=g[1])+2*(c=g[2]);for(var y=0;y<this.d*this.d;y++){var b=g[3+y],S=g[3+y+1];h.push(b===S?null:g.subarray(b,S))}var P=g[3+h.length+1];this.keys=g.subarray(g[3+h.length],P),this.bboxes=g.subarray(P),this.insert=this._insertReadonly}else{this.d=i+2*c;for(var M=0;M<this.d*this.d;M++)h.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=a,this.padding=c,this.scale=i/a,this.uid=0;var L=c/i*a;this.min=-L,this.max=a+L}ts.prototype.insert=function(a,i,c,h,g){this._forEachCell(i,c,h,g,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(i),this.bboxes.push(c),this.bboxes.push(h),this.bboxes.push(g)},ts.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ts.prototype._insertCell=function(a,i,c,h,g,y){this.cells[g].push(y)},ts.prototype.query=function(a,i,c,h,g){var y=this.min,b=this.max;if(a<=y&&i<=y&&b<=c&&b<=h&&!g)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(a,i,c,h,this._queryCell,S,{},g),S},ts.prototype._queryCell=function(a,i,c,h,g,y,b,S){var P=this.cells[g];if(P!==null)for(var M=this.keys,L=this.bboxes,F=0;F<P.length;F++){var N=P[F];if(b[N]===void 0){var H=4*N;(S?S(L[H+0],L[H+1],L[H+2],L[H+3]):a<=L[H+2]&&i<=L[H+3]&&c>=L[H+0]&&h>=L[H+1])?(b[N]=!0,y.push(M[N])):b[N]=!1}}},ts.prototype._forEachCell=function(a,i,c,h,g,y,b,S){for(var P=this._convertToCellCoord(a),M=this._convertToCellCoord(i),L=this._convertToCellCoord(c),F=this._convertToCellCoord(h),N=P;N<=L;N++)for(var H=M;H<=F;H++){var q=this.d*H+N;if((!S||S(this._convertFromCellCoord(N),this._convertFromCellCoord(H),this._convertFromCellCoord(N+1),this._convertFromCellCoord(H+1)))&&g.call(this,a,i,c,h,q,y,b,S))return}},ts.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},ts.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},ts.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,i=3+this.cells.length+1+1,c=0,h=0;h<this.cells.length;h++)c+=this.cells[h].length;var g=new Int32Array(i+c+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var y=i,b=0;b<a.length;b++){var S=a[b];g[3+b]=y,g.set(S,y),y+=S.length}return g[3+a.length]=y,g.set(this.keys,y),g[3+a.length+1]=y+=this.keys.length,g.set(this.bboxes,y),y+=this.bboxes.length,g.buffer};const{ImageData:Aa,ImageBitmap:ul}=V,r1={};function Xt(a,i,c={}){Object.defineProperty(i,"_classRegistryKey",{value:a,writeable:!1}),r1[a]={klass:i,omit:c.omit||[],shallow:c.shallow||[]}}Xt("Object",Object),cl.serialize=function(a,i){const c=a.toArrayBuffer();return i&&i.push(c),{buffer:c}},cl.deserialize=function(a){return new cl(a.buffer)},Xt("Grid",cl),Xt("Color",Gn),Xt("Error",Error),Xt("ResolvedImage",Ki),Xt("StylePropertyFunction",sl),Xt("StyleExpression",zc,{omit:["_evaluator"]}),Xt("ZoomDependentExpression",Yl),Xt("ZoomConstantExpression",ea),Xt("CompoundExpression",Si,{omit:["_evaluate"]});for(const a in zs)zs[a]._classRegistryKey||Xt(`Expression_${a}`,zs[a]);function hl(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Wc(a){return ul&&a instanceof ul}function X1(a,i){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(hl(a)||Wc(a))return i&&i.push(a),a;if(ArrayBuffer.isView(a)){const c=a;return i&&i.push(c.buffer),c}if(a instanceof Aa)return i&&i.push(a.data.buffer),a;if(Array.isArray(a)){const c=[];for(const h of a)c.push(X1(h,i));return c}if(typeof a=="object"){const c=a.constructor,h=c._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");const g=c.serialize?c.serialize(a,i):{};if(!c.serialize){for(const y in a){if(!a.hasOwnProperty(y)||r1[h].omit.indexOf(y)>=0)continue;const b=a[y];g[y]=r1[h].shallow.indexOf(y)>=0?b:X1(b,i)}a instanceof Error&&(g.message=a.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(g.$name=h),g}throw new Error("can't serialize object of type "+typeof a)}function Fi(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||hl(a)||Wc(a)||ArrayBuffer.isView(a)||a instanceof Aa)return a;if(Array.isArray(a))return a.map(Fi);if(typeof a=="object"){const i=a.$name||"Object",{klass:c}=r1[i];if(!c)throw new Error(`can't deserialize unregistered class ${i}`);if(c.deserialize)return c.deserialize(a);const h=Object.create(c.prototype);for(const g of Object.keys(a)){if(g==="$name")continue;const y=a[g];h[g]=r1[i].shallow.indexOf(g)>=0?y:Fi(y)}return h}throw new Error("can't deserialize object of type "+typeof a)}class v{constructor(){this.first=!0}update(i,c){const h=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=c),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=h,!0))}}const l=a=>a>=1536&&a<=1791,p=a=>a>=1872&&a<=1919,x=a=>a>=2208&&a<=2303,E=a=>a>=11904&&a<=12031,A=a=>a>=12032&&a<=12255,I=a=>a>=12272&&a<=12287,D=a=>a>=12288&&a<=12351,B=a=>a>=12352&&a<=12447,j=a=>a>=12448&&a<=12543,$=a=>a>=12544&&a<=12591,X=a=>a>=12704&&a<=12735,K=a=>a>=12736&&a<=12783,se=a=>a>=12784&&a<=12799,re=a=>a>=12800&&a<=13055,ae=a=>a>=13056&&a<=13311,Pe=a=>a>=13312&&a<=19903,ie=a=>a>=19968&&a<=40959,Ae=a=>a>=40960&&a<=42127,Se=a=>a>=42128&&a<=42191,be=a=>a>=44032&&a<=55215,we=a=>a>=63744&&a<=64255,Ie=a=>a>=64336&&a<=65023,Ke=a=>a>=65040&&a<=65055,st=a=>a>=65072&&a<=65103,It=a=>a>=65104&&a<=65135,Et=a=>a>=65136&&a<=65279,bt=a=>a>=65280&&a<=65519;function ut(a){for(const i of a)if(dt(i.charCodeAt(0)))return!0;return!1}function it(a){for(const i of a)if(!vt(i.charCodeAt(0)))return!1;return!0}function vt(a){return!(l(a)||p(a)||x(a)||Ie(a)||Et(a))}function dt(a){return!(a!==746&&a!==747&&(a<4352||!(X(a)||$(a)||st(a)&&!(a>=65097&&a<=65103)||we(a)||ae(a)||E(a)||K(a)||!(!D(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Pe(a)||ie(a)||re(a)||(i=>i>=12592&&i<=12687)(a)||(i=>i>=43360&&i<=43391)(a)||(i=>i>=55216&&i<=55295)(a)||(i=>i>=4352&&i<=4607)(a)||be(a)||B(a)||I(a)||(i=>i>=12688&&i<=12703)(a)||A(a)||se(a)||j(a)&&a!==12540||!(!bt(a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!It(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(i=>i>=5120&&i<=5759)(a)||(i=>i>=6320&&i<=6399)(a)||Ke(a)||(i=>i>=19904&&i<=19967)(a)||Ae(a)||Se(a))))}function nn(a){return!(dt(a)||function(i){return!!((c=>c>=128&&c<=255)(i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||(c=>c>=8192&&c<=8303)(i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||(c=>c>=8448&&c<=8527)(i)||(c=>c>=8528&&c<=8591)(i)||(c=>c>=8960&&c<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||(c=>c>=9216&&c<=9279)(i)&&i!==9251||(c=>c>=9280&&c<=9311)(i)||(c=>c>=9312&&c<=9471)(i)||(c=>c>=9632&&c<=9727)(i)||(c=>c>=9728&&c<=9983)(i)&&!(i>=9754&&i<=9759)||(c=>c>=11008&&c<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||D(i)||j(i)||(c=>c>=57344&&c<=63743)(i)||st(i)||It(i)||bt(i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(a))}function hn(a){return a>=1424&&a<=2303||Ie(a)||Et(a)}function In(a,i){return!(!i&&hn(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(c=>c>=6016&&c<=6143)(a))}function Rt(a){for(const i of a)if(hn(i.charCodeAt(0)))return!0;return!1}const sn="deferred",_n="loading",Jn="loaded";let hr=null,mn="unavailable",Nn=null;const fr=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(mn="error"),hr&&hr(a)};function _r(){_i.fire(new Q("pluginStateChange",{pluginStatus:mn,pluginURL:Nn}))}const _i=new ke,Ni=function(){return mn},Ai=function(){if(mn!==sn||!Nn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");mn=_n,_r(),Nn&&ws({url:Nn},a=>{a?fr(a):(mn=Jn,_r())})},$n={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>mn===Jn||$n.applyArabicShaping!=null,isLoading:()=>mn===_n,setState(a){mn=a.pluginStatus,Nn=a.pluginURL},isParsed:()=>$n.applyArabicShaping!=null&&$n.processBidirectionalText!=null&&$n.processStyledBidirectionalText!=null,getPluginURL:()=>Nn};class gn{constructor(i,c){this.zoom=i,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition,this.pitch=c.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new v,this.transition={},this.pitch=0)}isSupportedScript(i){return function(c,h){for(const g of c)if(!In(g.charCodeAt(0),h))return!1;return!0}(i,$n.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,c=i-Math.floor(i),h=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*c}}}class Un{constructor(i,c){this.property=i,this.value=c,this.expression=function(h,g){if(ql(h))return new sl(h,g);if(rl(h)){const y=il(h,g);if(y.result==="error")throw new Error(y.value.map(b=>`${b.key}: ${b.message}`).join(", "));return y.value}{let y=h;return typeof h=="string"&&g.type==="color"&&(y=Gn.parse(h)),{kind:"constant",evaluate:()=>y}}}(c===void 0?i.specification.default:c,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,c,h){return this.property.possiblyEvaluate(this,i,c,h)}}class Rr{constructor(i){this.property=i,this.value=new Un(i,void 0)}transitioned(i,c){return new dr(this.property,this.value,c,ur({},i.transition,this.transition),i.now)}untransitioned(){return new dr(this.property,this.value,null,{},0)}}class tr{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return fi(this._values[i].value.value)}setValue(i,c){this._values.hasOwnProperty(i)||(this._values[i]=new Rr(this._values[i].property)),this._values[i].value=new Un(this._values[i].property,c===null?void 0:fi(c))}getTransition(i){return fi(this._values[i].transition)}setTransition(i,c){this._values.hasOwnProperty(i)||(this._values[i]=new Rr(this._values[i].property)),this._values[i].transition=fi(c)||void 0}serialize(){const i={};for(const c of Object.keys(this._values)){const h=this.getValue(c);h!==void 0&&(i[c]=h);const g=this.getTransition(c);g!==void 0&&(i[`${c}-transition`]=g)}return i}transitioned(i,c){const h=new qr(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].transitioned(i,c._values[g]);return h}untransitioned(){const i=new qr(this._properties);for(const c of Object.keys(this._values))i._values[c]=this._values[c].untransitioned();return i}}class dr{constructor(i,c,h,g,y){const b=g.delay||0,S=g.duration||0;y=y||0,this.property=i,this.value=c,this.begin=y+b,this.end=this.begin+S,i.specification.transition&&(g.delay||g.duration)&&(this.prior=h)}possiblyEvaluate(i,c,h){const g=i.now||0,y=this.value.possiblyEvaluate(i,c,h),b=this.prior;if(b){if(g>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(g<this.begin)return b.possiblyEvaluate(i,c,h);{const S=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(i,c,h),y,xo(S))}}return y}}class qr{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,c,h){const g=new Ca(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(i,c,h);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class js{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return fi(this._values[i].value)}setValue(i,c){this._values[i]=new Un(this._values[i].property,c===null?void 0:fi(c))}serialize(){const i={};for(const c of Object.keys(this._values)){const h=this.getValue(c);h!==void 0&&(i[c]=h)}return i}possiblyEvaluate(i,c,h){const g=new Ca(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(i,c,h);return g}}class zr{constructor(i,c,h){this.property=i,this.value=c,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,c,h,g){return this.property.evaluate(this.value,this.parameters,i,c,h,g)}}class Ca{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Gt{constructor(i){this.specification=i}possiblyEvaluate(i,c){return i.expression.evaluate(c)}interpolate(i,c,h){const g=Rc[this.specification.type];return g?g(i,c,h):i}}class an{constructor(i,c){this.specification=i,this.overrides=c}possiblyEvaluate(i,c,h,g){return new zr(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(c,null,{},h,g)}:i.expression,c)}interpolate(i,c,h){if(i.value.kind!=="constant"||c.value.kind!=="constant")return i;if(i.value.value===void 0||c.value.value===void 0)return new zr(this,{kind:"constant",value:void 0},i.parameters);const g=Rc[this.specification.type];return g?new zr(this,{kind:"constant",value:g(i.value.value,c.value.value,h)},i.parameters):i}evaluate(i,c,h,g,y,b){return i.kind==="constant"?i.value:i.evaluate(c,h,g,y,b)}}class li extends an{possiblyEvaluate(i,c,h,g){if(i.value===void 0)return new zr(this,{kind:"constant",value:void 0},c);if(i.expression.kind==="constant"){const y=i.expression.evaluate(c,null,{},h,g),b=i.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,S=this._calculate(b,b,b,c);return new zr(this,{kind:"constant",value:S},c)}if(i.expression.kind==="camera"){const y=this._calculate(i.expression.evaluate({zoom:c.zoom-1}),i.expression.evaluate({zoom:c.zoom}),i.expression.evaluate({zoom:c.zoom+1}),c);return new zr(this,{kind:"constant",value:y},c)}return new zr(this,i.expression,c)}evaluate(i,c,h,g,y,b){if(i.kind==="source"){const S=i.evaluate(c,h,g,y,b);return this._calculate(S,S,S,c)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(c.zoom)-1},h,g),i.evaluate({zoom:Math.floor(c.zoom)},h,g),i.evaluate({zoom:Math.floor(c.zoom)+1},h,g),c):i.value}_calculate(i,c,h,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:c,other:h}:{from:h,to:c,other:i}}interpolate(i){return i}}class ko{constructor(i){this.specification=i}possiblyEvaluate(i,c,h,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const y=i.expression.evaluate(c,null,{},h,g);return this._calculate(y,y,y,c)}return this._calculate(i.expression.evaluate(new gn(Math.floor(c.zoom-1),c)),i.expression.evaluate(new gn(Math.floor(c.zoom),c)),i.expression.evaluate(new gn(Math.floor(c.zoom+1),c)),c)}}_calculate(i,c,h,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:c}:{from:h,to:c}}interpolate(i){return i}}class Oo{constructor(i){this.specification=i}possiblyEvaluate(i,c,h,g){return!!i.expression.evaluate(c,null,{},h,g)}interpolate(){return!1}}class Hr{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in i){const h=i[c];h.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new Un(h,void 0),y=this.defaultTransitionablePropertyValues[c]=new Rr(h);this.defaultTransitioningPropertyValues[c]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}function r4(a,i){return 256*(a=En(Math.floor(a),0,255))+En(Math.floor(i),0,255)}Xt("DataDrivenProperty",an),Xt("DataConstantProperty",Gt),Xt("CrossFadedDataDrivenProperty",li),Xt("CrossFadedProperty",ko),Xt("ColorRampProperty",Oo);const Q3={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fs{constructor(i,c){this._structArray=i,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,c){return i._trim(),c&&(i.isTransferred=!0,c.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const c=Object.create(this.prototype);return c.arrayBuffer=i.arrayBuffer,c.length=i.length,c.capacity=i.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Mn(a,i=1){let c=0,h=0;return{members:a.map(g=>{const y=Q3[g.type].BYTES_PER_ELEMENT,b=c=ns(c,Math.max(i,y)),S=g.components||1;return h=Math.max(h,y),c+=y*S,{name:g.name,type:g.type,components:S,offset:b}}),size:ns(c,Math.max(h,i)),alignment:i}}function ns(a,i){return Math.ceil(a/i)*i}class ti extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c){const h=this.length;return this.resize(h+1),this.emplace(h,i,c)}emplace(i,c,h){const g=2*i;return this.int16[g+0]=c,this.int16[g+1]=h,i}}ti.prototype.bytesPerElement=4,Xt("StructArrayLayout2i4",ti);class fl extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,c,h,g)}emplace(i,c,h,g,y){const b=4*i;return this.int16[b+0]=c,this.int16[b+1]=h,this.int16[b+2]=g,this.int16[b+3]=y,i}}fl.prototype.bytesPerElement=8,Xt("StructArrayLayout4i8",fl);class Z1 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,h,g,y,b,S){const P=this.length;return this.resize(P+1),this.emplace(P,i,c,h,g,y,b,S)}emplace(i,c,h,g,y,b,S,P){const M=6*i,L=12*i,F=3*i;return this.int16[M+0]=c,this.int16[M+1]=h,this.uint8[L+4]=g,this.uint8[L+5]=y,this.uint8[L+6]=b,this.uint8[L+7]=S,this.float32[F+2]=P,i}}Z1.prototype.bytesPerElement=12,Xt("StructArrayLayout2i4ub1f12",Z1);class Ci extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,h)}emplace(i,c,h,g){const y=3*i;return this.float32[y+0]=c,this.float32[y+1]=h,this.float32[y+2]=g,i}}Ci.prototype.bytesPerElement=12,Xt("StructArrayLayout3f12",Ci);class Pa extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,h,g,y,b,S,P,M,L){const F=this.length;return this.resize(F+1),this.emplace(F,i,c,h,g,y,b,S,P,M,L)}emplace(i,c,h,g,y,b,S,P,M,L,F){const N=10*i;return this.uint16[N+0]=c,this.uint16[N+1]=h,this.uint16[N+2]=g,this.uint16[N+3]=y,this.uint16[N+4]=b,this.uint16[N+5]=S,this.uint16[N+6]=P,this.uint16[N+7]=M,this.uint16[N+8]=L,this.uint16[N+9]=F,i}}Pa.prototype.bytesPerElement=20,Xt("StructArrayLayout10ui20",Pa);class Hc extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,h,g,y,b,S,P){const M=this.length;return this.resize(M+1),this.emplace(M,i,c,h,g,y,b,S,P)}emplace(i,c,h,g,y,b,S,P,M){const L=8*i;return this.uint16[L+0]=c,this.uint16[L+1]=h,this.uint16[L+2]=g,this.uint16[L+3]=y,this.uint16[L+4]=b,this.uint16[L+5]=S,this.uint16[L+6]=P,this.uint16[L+7]=M,i}}Hc.prototype.bytesPerElement=16,Xt("StructArrayLayout8ui16",Hc);class dl extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,h,g,y,b,S,P,M,L,F,N,H,q,J,oe){const me=this.length;return this.resize(me+1),this.emplace(me,i,c,h,g,y,b,S,P,M,L,F,N,H,q,J,oe)}emplace(i,c,h,g,y,b,S,P,M,L,F,N,H,q,J,oe,me){const Ce=16*i;return this.int16[Ce+0]=c,this.int16[Ce+1]=h,this.int16[Ce+2]=g,this.int16[Ce+3]=y,this.uint16[Ce+4]=b,this.uint16[Ce+5]=S,this.uint16[Ce+6]=P,this.uint16[Ce+7]=M,this.int16[Ce+8]=L,this.int16[Ce+9]=F,this.int16[Ce+10]=N,this.int16[Ce+11]=H,this.int16[Ce+12]=q,this.int16[Ce+13]=J,this.int16[Ce+14]=oe,this.int16[Ce+15]=me,i}}dl.prototype.bytesPerElement=32,Xt("StructArrayLayout4i4ui4i4i32",dl);class pl extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.uint32[1*i+0]=c,i}}pl.prototype.bytesPerElement=4,Xt("StructArrayLayout1ul4",pl);class Do extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,h,g,y,b,S,P,M,L,F,N,H){const q=this.length;return this.resize(q+1),this.emplace(q,i,c,h,g,y,b,S,P,M,L,F,N,H)}emplace(i,c,h,g,y,b,S,P,M,L,F,N,H,q){const J=20*i,oe=10*i;return this.int16[J+0]=c,this.int16[J+1]=h,this.int16[J+2]=g,this.int16[J+3]=y,this.int16[J+4]=b,this.float32[oe+3]=S,this.float32[oe+4]=P,this.float32[oe+5]=M,this.float32[oe+6]=L,this.int16[J+14]=F,this.uint32[oe+8]=N,this.uint16[J+18]=H,this.uint16[J+19]=q,i}}Do.prototype.bytesPerElement=40,Xt("StructArrayLayout5i4f1i1ul2ui40",Do);class i1 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,h,g,y,b,S){const P=this.length;return this.resize(P+1),this.emplace(P,i,c,h,g,y,b,S)}emplace(i,c,h,g,y,b,S,P){const M=8*i;return this.int16[M+0]=c,this.int16[M+1]=h,this.int16[M+2]=g,this.int16[M+4]=y,this.int16[M+5]=b,this.int16[M+6]=S,this.int16[M+7]=P,i}}i1.prototype.bytesPerElement=16,Xt("StructArrayLayout3i2i2i16",i1);class q1 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,h,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,i,c,h,g,y)}emplace(i,c,h,g,y,b){const S=4*i,P=8*i;return this.float32[S+0]=c,this.float32[S+1]=h,this.float32[S+2]=g,this.int16[P+6]=y,this.int16[P+7]=b,i}}q1.prototype.bytesPerElement=16,Xt("StructArrayLayout2f1f2i16",q1);class i4 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,c,h,g)}emplace(i,c,h,g,y){const b=12*i,S=3*i;return this.uint8[b+0]=c,this.uint8[b+1]=h,this.float32[S+1]=g,this.float32[S+2]=y,i}}i4.prototype.bytesPerElement=12,Xt("StructArrayLayout2ub2f12",i4);class $s extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,h)}emplace(i,c,h,g){const y=3*i;return this.uint16[y+0]=c,this.uint16[y+1]=h,this.uint16[y+2]=g,i}}$s.prototype.bytesPerElement=6,Xt("StructArrayLayout3ui6",$s);class s4 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,c,h,g,y,b,S,P,M,L,F,N,H,q,J,oe,me,Ce,De,Ue,We){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,i,c,h,g,y,b,S,P,M,L,F,N,H,q,J,oe,me,Ce,De,Ue,We)}emplace(i,c,h,g,y,b,S,P,M,L,F,N,H,q,J,oe,me,Ce,De,Ue,We,Xe){const gt=30*i,pt=15*i,zt=60*i;return this.int16[gt+0]=c,this.int16[gt+1]=h,this.int16[gt+2]=g,this.float32[pt+2]=y,this.float32[pt+3]=b,this.uint16[gt+8]=S,this.uint16[gt+9]=P,this.uint32[pt+5]=M,this.uint32[pt+6]=L,this.uint32[pt+7]=F,this.uint16[gt+16]=N,this.uint16[gt+17]=H,this.uint16[gt+18]=q,this.float32[pt+10]=J,this.float32[pt+11]=oe,this.uint8[zt+48]=me,this.uint8[zt+49]=Ce,this.uint8[zt+50]=De,this.uint32[pt+13]=Ue,this.int16[gt+28]=We,this.uint8[zt+58]=Xe,i}}s4.prototype.bytesPerElement=60,Xt("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",s4);class G1 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,c,h,g,y,b,S,P,M,L,F,N,H,q,J,oe,me,Ce,De,Ue,We,Xe,gt,pt,zt,Ot,mt,Lt,Ut,wt){const Zt=this.length;return this.resize(Zt+1),this.emplace(Zt,i,c,h,g,y,b,S,P,M,L,F,N,H,q,J,oe,me,Ce,De,Ue,We,Xe,gt,pt,zt,Ot,mt,Lt,Ut,wt)}emplace(i,c,h,g,y,b,S,P,M,L,F,N,H,q,J,oe,me,Ce,De,Ue,We,Xe,gt,pt,zt,Ot,mt,Lt,Ut,wt,Zt){const en=38*i,Yn=19*i;return this.int16[en+0]=c,this.int16[en+1]=h,this.int16[en+2]=g,this.float32[Yn+2]=y,this.float32[Yn+3]=b,this.int16[en+8]=S,this.int16[en+9]=P,this.int16[en+10]=M,this.int16[en+11]=L,this.int16[en+12]=F,this.int16[en+13]=N,this.uint16[en+14]=H,this.uint16[en+15]=q,this.uint16[en+16]=J,this.uint16[en+17]=oe,this.uint16[en+18]=me,this.uint16[en+19]=Ce,this.uint16[en+20]=De,this.uint16[en+21]=Ue,this.uint16[en+22]=We,this.uint16[en+23]=Xe,this.uint16[en+24]=gt,this.uint16[en+25]=pt,this.uint16[en+26]=zt,this.uint16[en+27]=Ot,this.uint16[en+28]=mt,this.uint32[Yn+15]=Lt,this.float32[Yn+16]=Ut,this.float32[Yn+17]=wt,this.float32[Yn+18]=Zt,i}}G1.prototype.bytesPerElement=76,Xt("StructArrayLayout3i2f6i15ui1ul3f76",G1);class Y1 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.float32[1*i+0]=c,i}}Y1.prototype.bytesPerElement=4,Xt("StructArrayLayout1f4",Y1);class o4 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,h){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,h)}emplace(i,c,h,g){const y=3*i;return this.int16[y+0]=c,this.int16[y+1]=h,this.int16[y+2]=g,i}}o4.prototype.bytesPerElement=6,Xt("StructArrayLayout3i6",o4);class s1 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,h,g,y,b,S){const P=this.length;return this.resize(P+1),this.emplace(P,i,c,h,g,y,b,S)}emplace(i,c,h,g,y,b,S,P){const M=7*i;return this.float32[M+0]=c,this.float32[M+1]=h,this.float32[M+2]=g,this.float32[M+3]=y,this.float32[M+4]=b,this.float32[M+5]=S,this.float32[M+6]=P,i}}s1.prototype.bytesPerElement=28,Xt("StructArrayLayout7f28",s1);class e0 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,c,h,g)}emplace(i,c,h,g,y){const b=6*i;return this.uint32[3*i+0]=c,this.uint16[b+2]=h,this.uint16[b+3]=g,this.uint16[b+4]=y,i}}e0.prototype.bytesPerElement=12,Xt("StructArrayLayout1ul3ui12",e0);class Ia extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c){const h=this.length;return this.resize(h+1),this.emplace(h,i,c)}emplace(i,c,h){const g=2*i;return this.uint16[g+0]=c,this.uint16[g+1]=h,i}}Ia.prototype.bytesPerElement=4,Xt("StructArrayLayout2ui4",Ia);class t0 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.uint16[1*i+0]=c,i}}t0.prototype.bytesPerElement=2,Xt("StructArrayLayout1ui2",t0);class K1 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c){const h=this.length;return this.resize(h+1),this.emplace(h,i,c)}emplace(i,c,h){const g=2*i;return this.float32[g+0]=c,this.float32[g+1]=h,i}}K1.prototype.bytesPerElement=8,Xt("StructArrayLayout2f8",K1);class a4 extends kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,c,h,g)}emplace(i,c,h,g,y){const b=4*i;return this.float32[b+0]=c,this.float32[b+1]=h,this.float32[b+2]=g,this.float32[b+3]=y,i}}a4.prototype.bytesPerElement=16,Xt("StructArrayLayout4f16",a4);class _u extends fs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}_u.prototype.size=40;class l4 extends Do{get(i){return new _u(this,i)}}Xt("CollisionBoxArray",l4);class c4 extends fs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}c4.prototype.size=60;class yu extends s4{get(i){return new c4(this,i)}}Xt("PlacedSymbolArray",yu);class vu extends fs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}vu.prototype.size=76;class H2 extends G1{get(i){return new vu(this,i)}}Xt("SymbolInstanceArray",H2);class u4 extends Y1{getoffsetX(i){return this.float32[1*i+0]}}Xt("GlyphOffsetArray",u4);class n0 extends o4{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Xt("SymbolLineVertexArray",n0);class X2 extends fs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}X2.prototype.size=12;class Z2 extends e0{get(i){return new X2(this,i)}}Xt("FeatureIndexArray",Z2);class q2 extends fs{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}q2.prototype.size=4;class G2 extends Ia{get(i){return new q2(this,i)}}Xt("FillExtrusionCentroidArray",G2);const oa=Mn([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Ws=Mn([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var xu=Ss(function(a){a.exports=function(i,c){var h,g,y,b,S,P,M,L;for(g=i.length-(h=3&i.length),y=c,S=3432918353,P=461845907,L=0;L<g;)M=255&i.charCodeAt(L)|(255&i.charCodeAt(++L))<<8|(255&i.charCodeAt(++L))<<16|(255&i.charCodeAt(++L))<<24,++L,y=27492+(65535&(b=5*(65535&(y=(y^=M=(65535&(M=(M=(65535&M)*S+(((M>>>16)*S&65535)<<16)&4294967295)<<15|M>>>17))*P+(((M>>>16)*P&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(M=0,h){case 3:M^=(255&i.charCodeAt(L+2))<<16;case 2:M^=(255&i.charCodeAt(L+1))<<8;case 1:y^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(L)))*S+(((M>>>16)*S&65535)<<16)&4294967295)<<15|M>>>17))*P+(((M>>>16)*P&65535)<<16)&4294967295}return y^=i.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}}),Y2=Ss(function(a){a.exports=function(i,c){for(var h,g=i.length,y=c^g,b=0;g>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(b)|(255&i.charCodeAt(++b))<<8|(255&i.charCodeAt(++b))<<16|(255&i.charCodeAt(++b))<<24))+((1540483477*(h>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),g-=4,++b;switch(g){case 3:y^=(255&i.charCodeAt(b+2))<<16;case 2:y^=(255&i.charCodeAt(b+1))<<8;case 1:y=1540483477*(65535&(y^=255&i.charCodeAt(b)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}}),Xc=xu,bu=Y2;Xc.murmur3=xu,Xc.murmur2=bu;class r0{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,c,h,g){this.ids.push(h4(i)),this.positions.push(c,h,g)}getPositions(i){const c=h4(i);let h=0,g=this.ids.length-1;for(;h<g;){const b=h+g>>1;this.ids[b]>=c?g=b:h=b+1}const y=[];for(;this.ids[h]===c;)y.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return y}static serialize(i,c){const h=new Float64Array(i.ids),g=new Uint32Array(i.positions);return f4(h,g,0,h.length-1),c&&c.push(h.buffer,g.buffer),{ids:h,positions:g}}static deserialize(i){const c=new r0;return c.ids=i.ids,c.positions=i.positions,c.indexed=!0,c}}function h4(a){const i=+a;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:Xc(String(a))}function f4(a,i,c,h){for(;c<h;){const g=a[c+h>>1];let y=c-1,b=h+1;for(;;){do y++;while(a[y]<g);do b--;while(a[b]>g);if(y>=b)break;Zc(a,y,b),Zc(i,3*y,3*b),Zc(i,3*y+1,3*b+1),Zc(i,3*y+2,3*b+2)}b-c<h-b?(f4(a,i,c,b),c=b+1):(f4(a,i,b+1,h),h=b)}}function Zc(a,i,c){const h=a[i];a[i]=a[c],a[c]=h}Xt("FeaturePositionMap",r0);class Ma{constructor(i,c){this.gl=i.gl,this.location=c}}class J1 extends Ma{constructor(i,c){super(i,c),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class wu extends Ma{constructor(i,c){super(i,c),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Tu extends Ma{constructor(i,c){super(i,c),this.current=Gn.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const K2=new Float32Array(16),J2=new Float32Array(9),Q2=new Float32Array(4);function i0(a){return[r4(255*a.r,255*a.g),r4(255*a.b,255*a.a)]}class qc{constructor(i,c,h){this.value=i,this.uniformNames=c.map(g=>`u_${g}`),this.type=h}setUniform(i,c,h){i.set(h.constantOr(this.value))}getBinding(i,c,h){return this.type==="color"?new Tu(i,c):new J1(i,c)}}class Hs{constructor(i,c){this.uniformNames=c.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=c.tl.concat(c.br),this.patternTo=i.tl.concat(i.br)}setUniform(i,c,h,g){const y=g==="u_pattern_to"||g==="u_dash_to"?this.patternTo:g==="u_pattern_from"||g==="u_dash_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&i.set(y)}getBinding(i,c,h){return h==="u_pattern_from"||h==="u_pattern_to"||h==="u_dash_from"||h==="u_dash_to"?new wu(i,c):new J1(i,c)}}class Ra{constructor(i,c,h,g){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=c.map(y=>({name:`a_${y}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,c,h,g,y,b){const S=this.paintVertexArray.length,P=this.expression.evaluate(new gn(0),c,{},y,g,b);this.paintVertexArray.resize(i),this._setPaintValue(S,i,P)}updatePaintArray(i,c,h,g,y){const b=this.expression.evaluate({zoom:0},h,g,void 0,y);this._setPaintValue(i,c,b)}_setPaintValue(i,c,h){if(this.type==="color"){const g=i0(h);for(let y=i;y<c;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=i;g<c;g++)this.paintVertexArray.emplace(g,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class co{constructor(i,c,h,g,y,b){this.expression=i,this.uniformNames=c.map(S=>`u_${S}_t`),this.type=h,this.useIntegerZoom=g,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=c.map(S=>({name:`a_${S}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(i,c,h,g,y,b){const S=this.expression.evaluate(new gn(this.zoom),c,{},y,g,b),P=this.expression.evaluate(new gn(this.zoom+1),c,{},y,g,b),M=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(M,i,S,P)}updatePaintArray(i,c,h,g,y){const b=this.expression.evaluate({zoom:this.zoom},h,g,void 0,y),S=this.expression.evaluate({zoom:this.zoom+1},h,g,void 0,y);this._setPaintValue(i,c,b,S)}_setPaintValue(i,c,h,g){if(this.type==="color"){const y=i0(h),b=i0(g);for(let S=i;S<c;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1])}else{for(let y=i;y<c;y++)this.paintVertexArray.emplace(y,h,g);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,c){const h=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=En(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,c,h){return new J1(i,c)}}class ml{constructor(i,c,h,g,y,b,S){this.expression=i,this.type=h,this.useIntegerZoom=g,this.zoom=y,this.layerId=S,this.paintVertexAttributes=(h==="array"?Ws:oa).members;for(let P=0;P<c.length;++P);this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(i,c,h){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,c.patterns&&c.patterns[this.layerId],h)}updatePaintArray(i,c,h,g,y,b){this._setPaintValues(i,c,h.patterns&&h.patterns[this.layerId],b)}_setPaintValues(i,c,h,g){if(!g||!h)return;const{min:y,mid:b,max:S}=h,P=g[y],M=g[b],L=g[S];if(P&&M&&L)for(let F=i;F<c;F++)this._setPaintValue(this.zoomInPaintVertexArray,F,M,P),this._setPaintValue(this.zoomOutPaintVertexArray,F,M,L)}_setPaintValue(i,c,h,g){i.emplace(c,h.tl[0],h.tl[1],h.br[0],h.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],h.pixelRatio,g.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ka{constructor(i,c,h=()=>!0){this.binders={},this._buffers=[];const g=[];for(const y in i.paint._values){if(!h(y))continue;const b=i.paint.get(y);if(!(b instanceof zr&&Io(b.property.specification)))continue;const S=C6(y,i.type),P=b.value,M=b.property.specification.type,L=b.property.useIntegerZoom,F=b.property.specification["property-type"],N=F==="cross-faded"||F==="cross-faded-data-driven",H=String(y)==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant";if(P.kind!=="constant"||H)if(P.kind==="source"||H||N){const q=e8(y,M,"source");this.binders[y]=N?new ml(P,S,M,L,c,q,i.id):new Ra(P,S,M,q),g.push(`/a_${y}`)}else{const q=e8(y,M,"composite");this.binders[y]=new co(P,S,M,L,c,q),g.push(`/z_${y}`)}else this.binders[y]=N?new Hs(P.value,S):new qc(P.value,S,M),g.push(`/u_${y}`)}this.cacheKey=g.sort().join("")}getMaxValue(i){const c=this.binders[i];return c instanceof Ra||c instanceof co?c.maxValue:0}populatePaintArrays(i,c,h,g,y,b){for(const S in this.binders){const P=this.binders[S];(P instanceof Ra||P instanceof co||P instanceof ml)&&P.populatePaintArray(i,c,h,g,y,b)}}setConstantPatternPositions(i,c){for(const h in this.binders){const g=this.binders[h];g instanceof Hs&&g.setConstantPatternPositions(i,c)}}updatePaintArrays(i,c,h,g,y,b){let S=!1;for(const P in i){const M=c.getPositions(P);for(const L of M){const F=h.feature(L.index);for(const N in this.binders){const H=this.binders[N];if((H instanceof Ra||H instanceof co||H instanceof ml)&&H.expression.isStateDependent===!0){const q=g.paint.get(N);H.expression=q.value,H.updatePaintArray(L.start,L.end,F,i[P],y,b),S=!0}}}}return S}defines(){const i=[];for(const c in this.binders){const h=this.binders[c];(h instanceof qc||h instanceof Hs)&&i.push(...h.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof Ra||h instanceof co||h instanceof ml)for(let g=0;g<h.paintVertexAttributes.length;g++)i.push(h.paintVertexAttributes[g].name)}return i}getBinderUniforms(){const i=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof qc||h instanceof Hs||h instanceof co)for(const g of h.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,c){const h=[];for(const g in this.binders){const y=this.binders[g];if(y instanceof qc||y instanceof Hs||y instanceof co){for(const b of y.uniformNames)if(c[b]){const S=y.getBinding(i,c[b],b);h.push({name:b,property:g,binding:S})}}}return h}setUniforms(i,c,h,g){for(const{name:y,property:b,binding:S}of c)this.binders[b].setUniform(S,g,h.get(b),y)}updatePaintBuffers(i){this._buffers=[];for(const c in this.binders){const h=this.binders[c];if(i&&h instanceof ml){const g=i.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(h instanceof Ra||h instanceof co)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(i){for(const c in this.binders){const h=this.binders[c];(h instanceof Ra||h instanceof co||h instanceof ml)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const c=this.binders[i];(c instanceof Ra||c instanceof co||c instanceof ml)&&c.destroy()}}}class aa{constructor(i,c,h=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new ka(g,c,h);this.needsUpload=!1,this._featureMap=new r0,this._bufferOffset=0}populatePaintArrays(i,c,h,g,y,b,S){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(i,c,g,y,b,S);c.id!==void 0&&this._featureMap.add(c.id,h,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,c,h,g,y){for(const b of h)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(i,this._featureMap,c,b,g,y)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const A6={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function C6(a,i){return A6[a]||[a.replace(`${i}-`,"").replace(/-/g,"_")]}const Eu={"line-pattern":{source:Pa,composite:Pa},"fill-pattern":{source:Pa,composite:Pa},"fill-extrusion-pattern":{source:Pa,composite:Pa},"line-dasharray":{source:Hc,composite:Hc}},Su={color:{source:K1,composite:a4},number:{source:Y1,composite:K1}};function e8(a,i,c){const h=Eu[a];return h&&h[c]||Su[i][c]}Xt("ConstantBinder",qc),Xt("CrossFadedConstantBinder",Hs),Xt("SourceExpressionBinder",Ra),Xt("CrossFadedCompositeBinder",ml),Xt("CompositeExpressionBinder",co),Xt("ProgramConfiguration",ka,{omit:["_buffers"]}),Xt("ProgramConfigurationSet",aa);const s0="-transition";class Lo extends ke{constructor(i,c){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,i.type!=="custom"&&(this.metadata=(i=i).metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&i.type!=="sky"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),c.layout&&(this._unevaluatedLayout=new js(c.layout)),c.paint)){this._transitionablePaint=new tr(c.paint);for(const h in i.paint)this.setPaintProperty(h,i.paint[h],{validate:!1});for(const h in i.layout)this.setLayoutProperty(h,i.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ca(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,c,h={}){c!=null&&this._validate(gu,`layers.${this.id}.layout.${i}`,i,c,h)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,c):this.visibility=c)}getPaintProperty(i){return To(i,s0)?this._transitionablePaint.getTransition(i.slice(0,-s0.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,c,h={}){if(c!=null&&this._validate(H1,`layers.${this.id}.paint.${i}`,i,c,h))return!1;if(To(i,s0))return this._transitionablePaint.setTransition(i.slice(0,-s0.length),c||void 0),!1;{const g=this._transitionablePaint._values[i],y=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),S=g.value;this._transitionablePaint.setValue(i,c),this._handleSpecialPaintPropertyUpdate(i);const P=this._transitionablePaint._values[i].value;return P.isDataDriven()||b||y||this._handleOverridablePaintPropertyUpdate(i,S,P)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,c,h){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,c){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,c)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Ho(i,(c,h)=>!(c===void 0||h==="layout"&&!Object.keys(c).length||h==="paint"&&!Object.keys(c).length))}_validate(i,c,h,g,y={}){return(!y||y.validate!==!1)&&J3(this,i.call(Vs,{key:c,layerType:this.type,objectKey:h,value:g,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const c=this.paint.get(i);if(c instanceof zr&&Io(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=$1(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const P6=Mn([{name:"a_pos",components:2,type:"Int16"}],4),{members:t8}=P6;class Gr{constructor(i=[]){this.segments=i}prepareSegment(i,c,h,g){let y=this.segments[this.segments.length-1];return i>Gr.MAX_VERTEX_ARRAY_LENGTH&&gr(`Max vertices per segment is ${Gr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!y||y.vertexLength+i>Gr.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==g)&&(y={vertexOffset:c.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},g!==void 0&&(y.sortKey=g),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const i of this.segments)for(const c in i.vaos)i.vaos[c].destroy()}static simpleSegment(i,c,h,g){return new Gr([{vertexOffset:i,primitiveOffset:c,vertexLength:h,primitiveLength:g,vaos:{},sortKey:0}])}}Gr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xt("SegmentVector",Gr);var Vn=8192;class o1{constructor(i,c){i&&(c?this.setSouthWest(i).setNorthEast(c):i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof cr?new cr(i.lng,i.lat):cr.convert(i),this}setSouthWest(i){return this._sw=i instanceof cr?new cr(i.lng,i.lat):cr.convert(i),this}extend(i){const c=this._sw,h=this._ne;let g,y;if(i instanceof cr)g=i,y=i;else{if(!(i instanceof o1))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(o1.convert(i)):this.extend(cr.convert(i)):this;if(g=i._sw,y=i._ne,!g||!y)return this}return c||h?(c.lng=Math.min(g.lng,c.lng),c.lat=Math.min(g.lat,c.lat),h.lng=Math.max(y.lng,h.lng),h.lat=Math.max(y.lat,h.lat)):(this._sw=new cr(g.lng,g.lat),this._ne=new cr(y.lng,y.lat)),this}getCenter(){return new cr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new cr(this.getWest(),this.getNorth())}getSouthEast(){return new cr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:c,lat:h}=cr.convert(i);let g=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&g}static convert(i){return!i||i instanceof o1?i:new o1(i)}}const Au=63710088e-1;class cr{constructor(i,c){if(isNaN(i)||isNaN(c))throw new Error(`Invalid LngLat object: (${i}, ${c})`);if(this.lng=+i,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new cr(_s(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const c=Math.PI/180,h=this.lat*c,g=i.lat*c,y=Math.sin(h)*Math.sin(g)+Math.cos(h)*Math.cos(g)*Math.cos((i.lng-this.lng)*c);return Au*Math.acos(Math.min(y,1))}toBounds(i=0){const c=360*i/40075017,h=c/Math.cos(Math.PI/180*this.lat);return new o1(new cr(this.lng-h,this.lat-c),new cr(this.lng+h,this.lat+c))}static convert(i){if(i instanceof cr)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new cr(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new cr(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Cu=2*Math.PI*Au;function Pu(a){return Cu*Math.cos(a*Math.PI/180)}function a1(a){return(180+a)/360}function l1(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Fo(a,i){return a/Pu(i)}function la(a){return 360*a-180}function uo(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function n8(a,i){return a*Pu(uo(i))}const Oa=85.051129;class Q1{constructor(i,c,h=0){this.x=+i,this.y=+c,this.z=+h}static fromLngLat(i,c=0){const h=cr.convert(i);return new Q1(a1(h.lng),l1(h.lat),Fo(c,h.lat))}toLngLat(){return new cr(la(this.x),uo(this.y))}toAltitude(){return n8(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Cu*(i=uo(this.y),1/Math.cos(i*Math.PI/180));var i}}function o0(a,i,c,h,g,y,b,S,P){const M=(i+h)/2,L=(c+g)/2,F=new O(M,L);S(F),function(N,H,q,J,oe,me){const Ce=q-oe,De=J-me;return Math.abs((J-H)*Ce-(q-N)*De)/Math.hypot(Ce,De)}(F.x,F.y,y.x,y.y,b.x,b.y)>=P?(o0(a,i,c,M,L,y,F,S,P),o0(a,M,L,h,g,F,b,S,P)):a.push(b)}function Rn(a,i,c){const h=[];let g,y,b;for(const S of a){const{x:P,y:M}=S;i(S),b?o0(h,g,y,P,M,b,S,i,c):h.push(S),g=P,y=M,b=S}return h}const rs=Math.pow(2,14)-1,yi=-rs-1;function ds(a,i){const c=Math.round(a.x*i),h=Math.round(a.y*i);return a.x=En(c,yi,rs),a.y=En(h,yi,rs),(c<a.x||c>a.x+1||h<a.y||h>a.y+1)&&gr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Ms(a,i,c){const h=a.loadGeometry(),g=a.extent,y=Vn/g;if(i&&c&&c.projection.isReprojectedInTileSpace){const b=1<<i.z,{scale:S,x:P,y:M,projection:L}=c,F=N=>{const H=la((i.x+N.x/g)/b),q=uo((i.y+N.y/g)/b),J=L.project(H,q);N.x=(J.x*S-P)*g,N.y=(J.y*S-M)*g};for(let N=0;N<h.length;N++)if(a.type!==1)h[N]=Rn(h[N],F,1);else{const H=[];for(const q of h[N])q.x<0||q.x>=g||q.y<0||q.y>=g||(F(q),H.push(q));h[N]=H}}for(const b of h)for(const S of b)ds(S,y);return h}function gl(a,i){return{type:a.type,id:a.id,properties:a.properties,geometry:i?Ms(a):[]}}function vi(a,i,c,h,g){a.emplaceBack(2*i+(h+1)/2,2*c+(g+1)/2)}class Gc{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new ti,this.indexArray=new $s,this.segments=new Gr,this.programConfigurations=new aa(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,h,g){const y=this.layers[0],b=[];let S=null;y.type==="circle"&&(S=y.layout.get("circle-sort-key"));for(const{feature:P,id:M,index:L,sourceLayerIndex:F}of i){const N=this.layers[0]._featureFilter.needGeometry,H=gl(P,N);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),H,h))continue;const q=S?S.evaluate(H,{},h):void 0,J={id:M,properties:P.properties,type:P.type,sourceLayerIndex:F,index:L,geometry:N?H.geometry:Ms(P,h,g),patterns:{},sortKey:q};b.push(J)}S&&b.sort((P,M)=>P.sortKey-M.sortKey);for(const P of b){const{geometry:M,index:L,sourceLayerIndex:F}=P,N=i[L].feature;this.addFeature(P,M,L,c.availableImages,h),c.featureIndex.insert(N,M,L,F,this.index)}}update(i,c,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,t8),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,c,h,g,y){for(const b of c)for(const S of b){const P=S.x,M=S.y;if(P<0||P>=Vn||M<0||M>=Vn)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),F=L.vertexLength;vi(this.layoutVertexArray,P,M,-1,-1),vi(this.layoutVertexArray,P,M,1,-1),vi(this.layoutVertexArray,P,M,1,1),vi(this.layoutVertexArray,P,M,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+3,F+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{},g,y)}}function ec(a,i){for(let c=0;c<a.length;c++)if(_l(i,a[c]))return!0;for(let c=0;c<i.length;c++)if(_l(a,i[c]))return!0;return!!l0(a,i)}function a0(a,i,c){return!!_l(a,i)||!!c0(i,a,c)}function tc(a,i){if(a.length===1)return ln(i,a[0]);for(let c=0;c<i.length;c++){const h=i[c];for(let g=0;g<h.length;g++)if(_l(a,h[g]))return!0}for(let c=0;c<a.length;c++)if(ln(i,a[c]))return!0;for(let c=0;c<i.length;c++)if(l0(a,i[c]))return!0;return!1}function Iu(a,i,c){if(a.length>1){if(l0(a,i))return!0;for(let h=0;h<i.length;h++)if(c0(i[h],a,c))return!0}for(let h=0;h<a.length;h++)if(c0(a[h],i,c))return!0;return!1}function l0(a,i){if(a.length===0||i.length===0)return!1;for(let c=0;c<a.length-1;c++){const h=a[c],g=a[c+1];for(let y=0;y<i.length-1;y++)if(Mu(h,g,i[y],i[y+1]))return!0}return!1}function Mu(a,i,c,h){return Zi(a,c,h)!==Zi(i,c,h)&&Zi(a,i,c)!==Zi(a,i,h)}function c0(a,i,c){const h=c*c;if(i.length===1)return a.distSqr(i[0])<h;for(let g=1;g<i.length;g++)if(nc(a,i[g-1],i[g])<h)return!0;return!1}function nc(a,i,c){const h=i.distSqr(c);if(h===0)return a.distSqr(i);const g=((a.x-i.x)*(c.x-i.x)+(a.y-i.y)*(c.y-i.y))/h;return a.distSqr(g<0?i:g>1?c:c.sub(i)._mult(g)._add(i))}function ln(a,i){let c,h,g,y=!1;for(let b=0;b<a.length;b++){c=a[b];for(let S=0,P=c.length-1;S<c.length;P=S++)h=c[S],g=c[P],h.y>i.y!=g.y>i.y&&i.x<(g.x-h.x)*(i.y-h.y)/(g.y-h.y)+h.x&&(y=!y)}return y}function _l(a,i){let c=!1;for(let h=0,g=a.length-1;h<a.length;g=h++){const y=a[h],b=a[g];y.y>i.y!=b.y>i.y&&i.x<(b.x-y.x)*(i.y-y.y)/(b.y-y.y)+y.x&&(c=!c)}return c}function d4(a,i,c,h,g){for(const b of a)if(i<=b.x&&c<=b.y&&h>=b.x&&g>=b.y)return!0;const y=[new O(i,c),new O(i,g),new O(h,g),new O(h,c)];if(a.length>2){for(const b of y)if(_l(a,b))return!0}for(let b=0;b<a.length-1;b++)if(Da(a[b],a[b+1],y))return!0;return!1}function Da(a,i,c){const h=c[0],g=c[2];if(a.x<h.x&&i.x<h.x||a.x>g.x&&i.x>g.x||a.y<h.y&&i.y<h.y||a.y>g.y&&i.y>g.y)return!1;const y=Zi(a,i,c[0]);return y!==Zi(a,i,c[1])||y!==Zi(a,i,c[2])||y!==Zi(a,i,c[3])}function ho(a,i,c){const h=i.paint.get(a).value;return h.kind==="constant"?h.value:c.programConfigurations.get(i.id).getMaxValue(a)}function c1(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Yc(a,i,c,h,g){if(!i[0]&&!i[1])return a;const y=O.convert(i)._mult(g);c==="viewport"&&y._rotate(-h);const b=[];for(let S=0;S<a.length;S++)b.push(a[S].sub(y));return b}function p4(a,i,c,h){const g=O.convert(a)._mult(h);return i==="viewport"&&g._rotate(-c),g}Xt("CircleBucket",Gc,{omit:["layers"]});const Ru=new Hr({"circle-sort-key":new an(ge.layout_circle["circle-sort-key"])});var yl={paint:new Hr({"circle-radius":new an(ge.paint_circle["circle-radius"]),"circle-color":new an(ge.paint_circle["circle-color"]),"circle-blur":new an(ge.paint_circle["circle-blur"]),"circle-opacity":new an(ge.paint_circle["circle-opacity"]),"circle-translate":new Gt(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Gt(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Gt(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Gt(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new an(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new an(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new an(ge.paint_circle["circle-stroke-opacity"])}),layout:Ru};class rc{constructor(i,c){this.points=i,this.planes=c}static fromInvProjectionMatrix(i,c,h,g){const y=Math.pow(2,h),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const M=fn([],P,i),L=1/M[3]/c*y;return function(F,N,H){return F[0]=N[0]*H[0],F[1]=N[1]*H[1],F[2]=N[2]*H[2],F[3]=N[3]*H[3],F}(M,M,[L,L,g?1/M[3]:L,L])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const M=rt([],Ne([],Dt([],b[P[0]],b[P[1]]),Dt([],b[P[2]],b[P[1]]))),L=-at(M,b[P[1]]);return M.concat(L)});return new rc(b,S)}}class fo{constructor(i,c){this.min=i,this.max=c,this.center=ce([],$t([],this.min,this.max),.5)}quadrant(i){const c=[i%2==0,i<2],h=kt(this.min),g=kt(this.max);for(let y=0;y<c.length;y++)h[y]=c[y]?this.min[y]:this.center[y],g[y]=c[y]?this.center[y]:this.max[y];return g[2]=this.max[2],new fo(h,g)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,c=this.max;return[[i[0],i[1],i[2]],[c[0],i[1],i[2]],[c[0],c[1],i[2]],[i[0],c[1],i[2]],[i[0],i[1],c[2]],[c[0],i[1],c[2]],[c[0],c[1],c[2]],[i[0],c[1],c[2]]]}intersects(i){const c=this.getCorners();let h=!0;for(let g=0;g<i.planes.length;g++){const y=i.planes[g];let b=0;for(let S=0;S<c.length;S++)b+=at(y,c[S])+y[3]>=0;if(b===0)return 0;b!==c.length&&(h=!1)}if(h)return 2;for(let g=0;g<3;g++){let y=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let S=0;S<i.points.length;S++){const P=i.points[S][g]-this.min[g];y=Math.min(y,P),b=Math.max(b,P)}if(b<0||y>this.max[g]-this.min[g])return 0}return 1}}function u0(a,i,c,h,g,y,b,S,P){if(y&&a.queryGeometry.isAboveHorizon)return!1;y&&(P*=a.pixelToTileUnitsFactor);for(const M of i)for(const L of M){const F=L.add(S),N=g&&c.elevation?c.elevation.exaggeration()*g.getElevationAt(F.x,F.y,!0):0,H=y?F:vl(F,N,h),q=y?a.tilespaceRays.map(oe=>m4(oe,N)):a.queryGeometry.screenGeometry,J=fn([],[L.x,L.y,N,1],h);if(!b&&y?P*=J[3]/c.cameraToCenterDistance:b&&!y&&(P*=c.cameraToCenterDistance/J[3]),a0(q,H,P))return!0}return!1}function vl(a,i,c){const h=fn([],[a.x,a.y,i,1],c);return new O(h[0]/h[3],h[1]/h[3])}const h0=Vt(0,0,0),f0=Vt(0,0,1);function m4(a,i){const c=ht();return h0[2]=i,a.intersectsPlane(h0,f0,c),new O(c[0],c[1])}class Xs extends Gc{}function La(a,{width:i,height:c},h,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*c*h)throw new RangeError("mismatched image size")}else g=new Uint8Array(i*c*h);return a.width=i,a.height=c,a.data=g,a}function xl(a,{width:i,height:c},h){if(i===a.width&&c===a.height)return;const g=La({},{width:i,height:c},h);Kc(a,g,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,i),height:Math.min(a.height,c)},h),a.width=i,a.height=c,a.data=g.data}function Kc(a,i,c,h,g,y){if(g.width===0||g.height===0)return i;if(g.width>a.width||g.height>a.height||c.x>a.width-g.width||c.y>a.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||h.x>i.width-g.width||h.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,S=i.data;for(let P=0;P<g.height;P++){const M=((c.y+P)*a.width+c.x)*y,L=((h.y+P)*i.width+h.x)*y;for(let F=0;F<g.width*y;F++)S[L+F]=b[M+F]}return i}Xt("HeatmapBucket",Xs,{omit:["layers"]});class Pi{constructor(i,c){La(this,i,1,c)}resize(i){xl(this,i,1)}clone(){return new Pi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,c,h,g,y){Kc(i,c,h,g,y,1)}}class Zs{constructor(i,c){La(this,i,4,c)}resize(i){xl(this,i,4)}replace(i,c){c?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Zs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,c,h,g,y){Kc(i,c,h,g,y,4)}}Xt("AlphaImage",Pi),Xt("RGBAImage",Zs);var Jc={paint:new Hr({"heatmap-radius":new an(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new an(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Gt(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Oo(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Gt(ge.paint_heatmap["heatmap-opacity"])})};function d0(a){const i={},c=a.resolution||256,h=a.clips?a.clips.length:1,g=a.image||new Zs({width:c,height:h}),y=(b,S,P)=>{i[a.evaluationKey]=P;const M=a.expression.evaluate(i);g.data[b+S+0]=Math.floor(255*M.r/M.a),g.data[b+S+1]=Math.floor(255*M.g/M.a),g.data[b+S+2]=Math.floor(255*M.b/M.a),g.data[b+S+3]=Math.floor(255*M.a)};if(a.clips)for(let b=0,S=0;b<h;++b,S+=4*c)for(let P=0,M=0;P<c;P++,M+=4){const L=P/(c-1),{start:F,end:N}=a.clips[b];y(S,M,F*(1-L)+N*L)}else for(let b=0,S=0;b<c;b++,S+=4)y(0,S,b/(c-1));return g}var I6={paint:new Hr({"hillshade-illumination-direction":new Gt(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Gt(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Gt(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Gt(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Gt(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Gt(ge.paint_hillshade["hillshade-accent-color"])})};const r8=Mn([{name:"a_pos",components:2,type:"Int16"}],4),{members:i8}=r8;var ic=bl,ku=bl;function bl(a,i,c){c=c||2;var h,g,y,b,S,P,M,L=i&&i.length,F=L?i[0]*c:a.length,N=Ou(a,0,F,c,!0),H=[];if(!N||N.next===N.prev)return H;if(L&&(N=function(J,oe,me,Ce){var De,Ue,We,Xe=[];for(De=0,Ue=oe.length;De<Ue;De++)(We=Ou(J,oe[De]*Ce,De<Ue-1?oe[De+1]*Ce:J.length,Ce,!1))===We.next&&(We.steiner=!0),Xe.push(D6(We));for(Xe.sort(sc),De=0;De<Xe.length;De++)me=wl(me=k6(Xe[De],me),me.next);return me}(a,i,N,c)),a.length>80*c){h=y=a[0],g=b=a[1];for(var q=c;q<F;q+=c)(S=a[q])<h&&(h=S),(P=a[q+1])<g&&(g=P),S>y&&(y=S),P>b&&(b=P);M=(M=Math.max(y-h,b-g))!==0?1/M:0}return Tl(N,H,c,h,g,M),H}function Ou(a,i,c,h,g){var y,b;if(g===Qc(a,i,c,h)>0)for(y=i;y<c;y+=h)b=_4(y,a[y],a[y+1],b);else for(y=c-h;y>=i;y-=h)b=_4(y,a[y],a[y+1],b);return b&&ca(b,b.next)&&(g0(b),b=b.next),b}function wl(a,i){if(!a)return a;i||(i=a);var c,h=a;do if(c=!1,h.steiner||!ca(h,h.next)&&Xr(h.prev,h,h.next)!==0)h=h.next;else{if(g0(h),(h=i=h.prev)===h.next)break;c=!0}while(c||h!==i);return i}function Tl(a,i,c,h,g,y,b){if(a){!b&&y&&function(L,F,N,H){var q=L;do q.z===null&&(q.z=Fa(q.x,q.y,F,N,H)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==L);q.prevZ.nextZ=null,q.prevZ=null,function(J){var oe,me,Ce,De,Ue,We,Xe,gt,pt=1;do{for(me=J,J=null,Ue=null,We=0;me;){for(We++,Ce=me,Xe=0,oe=0;oe<pt&&(Xe++,Ce=Ce.nextZ);oe++);for(gt=pt;Xe>0||gt>0&&Ce;)Xe!==0&&(gt===0||!Ce||me.z<=Ce.z)?(De=me,me=me.nextZ,Xe--):(De=Ce,Ce=Ce.nextZ,gt--),Ue?Ue.nextZ=De:J=De,De.prevZ=Ue,Ue=De;me=Ce}Ue.nextZ=null,pt*=2}while(We>1)}(q)}(a,h,g,y);for(var S,P,M=a;a.prev!==a.next;)if(S=a.prev,P=a.next,y?R6(a,h,g,y):M6(a))i.push(S.i/c),i.push(a.i/c),i.push(P.i/c),g0(a),a=P.next,M=P.next;else if((a=P)===M){b?b===1?Tl(a=s8(wl(a),i,c),i,c,h,g,y,2):b===2&&o8(a,i,c,h,g,y):Tl(wl(a),i,c,h,g,y,1);break}}}function M6(a){var i=a.prev,c=a,h=a.next;if(Xr(i,c,h)>=0)return!1;for(var g=a.next.next;g!==a.prev;){if(oc(i.x,i.y,c.x,c.y,h.x,h.y,g.x,g.y)&&Xr(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function R6(a,i,c,h){var g=a.prev,y=a,b=a.next;if(Xr(g,y,b)>=0)return!1;for(var S=g.x>y.x?g.x>b.x?g.x:b.x:y.x>b.x?y.x:b.x,P=g.y>y.y?g.y>b.y?g.y:b.y:y.y>b.y?y.y:b.y,M=Fa(g.x<y.x?g.x<b.x?g.x:b.x:y.x<b.x?y.x:b.x,g.y<y.y?g.y<b.y?g.y:b.y:y.y<b.y?y.y:b.y,i,c,h),L=Fa(S,P,i,c,h),F=a.prevZ,N=a.nextZ;F&&F.z>=M&&N&&N.z<=L;){if(F!==a.prev&&F!==a.next&&oc(g.x,g.y,y.x,y.y,b.x,b.y,F.x,F.y)&&Xr(F.prev,F,F.next)>=0||(F=F.prevZ,N!==a.prev&&N!==a.next&&oc(g.x,g.y,y.x,y.y,b.x,b.y,N.x,N.y)&&Xr(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;F&&F.z>=M;){if(F!==a.prev&&F!==a.next&&oc(g.x,g.y,y.x,y.y,b.x,b.y,F.x,F.y)&&Xr(F.prev,F,F.next)>=0)return!1;F=F.prevZ}for(;N&&N.z<=L;){if(N!==a.prev&&N!==a.next&&oc(g.x,g.y,y.x,y.y,b.x,b.y,N.x,N.y)&&Xr(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function s8(a,i,c){var h=a;do{var g=h.prev,y=h.next.next;!ca(g,y)&&a8(g,h,h.next,y)&&m0(g,y)&&m0(y,g)&&(i.push(g.i/c),i.push(h.i/c),i.push(y.i/c),g0(h),g0(h.next),h=a=y),h=h.next}while(h!==a);return wl(h)}function o8(a,i,c,h,g,y){var b=a;do{for(var S=b.next.next;S!==b.prev;){if(b.i!==S.i&&L6(b,S)){var P=po(b,S);return b=wl(b,b.next),P=wl(P,P.next),Tl(b,i,c,h,g,y),void Tl(P,i,c,h,g,y)}S=S.next}b=b.next}while(b!==a)}function sc(a,i){return a.x-i.x}function k6(a,i){var c=function(y,b){var S,P=b,M=y.x,L=y.y,F=-1/0;do{if(L<=P.y&&L>=P.next.y&&P.next.y!==P.y){var N=P.x+(L-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if(N<=M&&N>F){if(F=N,N===M){if(L===P.y)return P;if(L===P.next.y)return P.next}S=P.x<P.next.x?P:P.next}}P=P.next}while(P!==b);if(!S)return null;if(M===F)return S;var H,q=S,J=S.x,oe=S.y,me=1/0;P=S;do M>=P.x&&P.x>=J&&M!==P.x&&oc(L<oe?M:F,L,J,oe,L<oe?F:M,L,P.x,P.y)&&(H=Math.abs(L-P.y)/(M-P.x),m0(P,y)&&(H<me||H===me&&(P.x>S.x||P.x===S.x&&O6(S,P)))&&(S=P,me=H)),P=P.next;while(P!==q);return S}(a,i);if(!c)return i;var h=po(c,a),g=wl(c,c.next);return wl(h,h.next),i===c?g:i}function O6(a,i){return Xr(a.prev,a,i.prev)<0&&Xr(i.next,a,a.next)<0}function Fa(a,i,c,h,g){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-c)*g)|a<<8))|a<<4))|a<<2))|a<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-h)*g)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function D6(a){var i=a,c=a;do(i.x<c.x||i.x===c.x&&i.y<c.y)&&(c=i),i=i.next;while(i!==a);return c}function oc(a,i,c,h,g,y,b,S){return(g-b)*(i-S)-(a-b)*(y-S)>=0&&(a-b)*(h-S)-(c-b)*(i-S)>=0&&(c-b)*(y-S)-(g-b)*(h-S)>=0}function L6(a,i){return a.next.i!==i.i&&a.prev.i!==i.i&&!function(c,h){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==h.i&&g.next.i!==h.i&&a8(g,g.next,c,h))return!0;g=g.next}while(g!==c);return!1}(a,i)&&(m0(a,i)&&m0(i,a)&&function(c,h){var g=c,y=!1,b=(c.x+h.x)/2,S=(c.y+h.y)/2;do g.y>S!=g.next.y>S&&g.next.y!==g.y&&b<(g.next.x-g.x)*(S-g.y)/(g.next.y-g.y)+g.x&&(y=!y),g=g.next;while(g!==c);return y}(a,i)&&(Xr(a.prev,a,i.prev)||Xr(a,i.prev,i))||ca(a,i)&&Xr(a.prev,a,a.next)>0&&Xr(i.prev,i,i.next)>0)}function Xr(a,i,c){return(i.y-a.y)*(c.x-i.x)-(i.x-a.x)*(c.y-i.y)}function ca(a,i){return a.x===i.x&&a.y===i.y}function a8(a,i,c,h){var g=p0(Xr(a,i,c)),y=p0(Xr(a,i,h)),b=p0(Xr(c,h,a)),S=p0(Xr(c,h,i));return g!==y&&b!==S||!(g!==0||!g4(a,c,i))||!(y!==0||!g4(a,h,i))||!(b!==0||!g4(c,a,h))||!(S!==0||!g4(c,i,h))}function g4(a,i,c){return i.x<=Math.max(a.x,c.x)&&i.x>=Math.min(a.x,c.x)&&i.y<=Math.max(a.y,c.y)&&i.y>=Math.min(a.y,c.y)}function p0(a){return a>0?1:a<0?-1:0}function m0(a,i){return Xr(a.prev,a,a.next)<0?Xr(a,i,a.next)>=0&&Xr(a,a.prev,i)>=0:Xr(a,i,a.prev)<0||Xr(a,a.next,i)<0}function po(a,i){var c=new Na(a.i,a.x,a.y),h=new Na(i.i,i.x,i.y),g=a.next,y=i.prev;return a.next=i,i.prev=a,c.next=g,g.prev=c,h.next=c,c.prev=h,y.next=h,h.prev=y,h}function _4(a,i,c,h){var g=new Na(a,i,c);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function g0(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Na(a,i,c){this.i=a,this.x=i,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qc(a,i,c,h){for(var g=0,y=i,b=c-h;y<c;y+=h)g+=(a[b]-a[y])*(a[y+1]+a[b+1]),b=y;return g}function e3(a,i,c,h,g){y4(a,i,c,h||a.length-1,g)}function y4(a,i,c,h,g){for(;h>c;){if(h-c>600){var y=h-c+1,b=i-c+1,S=Math.log(y),P=.5*Math.exp(2*S/3),M=.5*Math.sqrt(S*P*(y-P)/y)*(b-y/2<0?-1:1);y4(a,i,Math.max(c,Math.floor(i-b*P/y+M)),Math.min(h,Math.floor(i+(y-b)*P/y+M)),g)}var L=a[i],F=c,N=h;for(ac(a,c,i),g(a[h],L)>0&&ac(a,c,h);F<N;){for(ac(a,F,N),F++,N--;g(a[F],L)<0;)F++;for(;g(a[N],L)>0;)N--}g(a[c],L)===0?ac(a,c,N):ac(a,++N,h),N<=i&&(c=N+1),i<=N&&(h=N-1)}}function ac(a,i,c){var h=a[i];a[i]=a[c],a[c]=h}function _0(a,i){const c=a.length;if(c<=1)return[a];const h=[];let g,y;for(let b=0;b<c;b++){const S=Xo(a[b]);S!==0&&(a[b].area=Math.abs(S),y===void 0&&(y=S<0),y===S<0?(g&&h.push(g),g=[a[b]]):g.push(a[b]))}if(g&&h.push(g),i>1)for(let b=0;b<h.length;b++)h[b].length<=i||(e3(h[b],i,1,h[b].length-1,F6),h[b]=h[b].slice(0,i));return h}function F6(a,i){return i.area-a.area}function Du(a,i,c){const h=c.patternDependencies;let g=!1;for(const y of i){const b=y.paint.get(`${a}-pattern`);b.isConstant()||(g=!0);const S=b.constantOr(null);S&&(g=!0,h[S.to]=!0,h[S.from]=!0)}return g}function t3(a,i,c,h,g){const y=g.patternDependencies;for(const b of i){const S=b.paint.get(`${a}-pattern`).value;if(S.kind!=="constant"){let P=S.evaluate({zoom:h-1},c,{},g.availableImages),M=S.evaluate({zoom:h},c,{},g.availableImages),L=S.evaluate({zoom:h+1},c,{},g.availableImages);P=P&&P.name?P.name:P,M=M&&M.name?M.name:M,L=L&&L.name?L.name:L,y[P]=!0,y[M]=!0,y[L]=!0,c.patterns[b.id]={min:P,mid:M,max:L}}}return c}bl.deviation=function(a,i,c,h){var g=i&&i.length,y=Math.abs(Qc(a,0,g?i[0]*c:a.length,c));if(g)for(var b=0,S=i.length;b<S;b++)y-=Math.abs(Qc(a,i[b]*c,b<S-1?i[b+1]*c:a.length,c));var P=0;for(b=0;b<h.length;b+=3){var M=h[b]*c,L=h[b+1]*c,F=h[b+2]*c;P+=Math.abs((a[M]-a[F])*(a[L+1]-a[M+1])-(a[M]-a[L])*(a[F+1]-a[M+1]))}return y===0&&P===0?0:Math.abs((P-y)/y)},bl.flatten=function(a){for(var i=a[0][0].length,c={vertices:[],holes:[],dimensions:i},h=0,g=0;g<a.length;g++){for(var y=0;y<a[g].length;y++)for(var b=0;b<i;b++)c.vertices.push(a[g][y][b]);g>0&&c.holes.push(h+=a[g-1].length)}return c},ic.default=ku;class n3{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ti,this.indexArray=new $s,this.indexArray2=new Ia,this.programConfigurations=new aa(i.layers,i.zoom),this.segments=new Gr,this.segments2=new Gr,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,h,g){this.hasPattern=Du("fill",this.layers,c);const y=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:S,id:P,index:M,sourceLayerIndex:L}of i){const F=this.layers[0]._featureFilter.needGeometry,N=gl(S,F);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),N,h))continue;const H=y?y.evaluate(N,{},h,c.availableImages):void 0,q={id:P,properties:S.properties,type:S.type,sourceLayerIndex:L,index:M,geometry:F?N.geometry:Ms(S,h,g),patterns:{},sortKey:H};b.push(q)}y&&b.sort((S,P)=>S.sortKey-P.sortKey);for(const S of b){const{geometry:P,index:M,sourceLayerIndex:L}=S;if(this.hasPattern){const F=t3("fill",this.layers,S,this.zoom,c);this.patternFeatures.push(F)}else this.addFeature(S,P,M,h,{},c.availableImages);c.featureIndex.insert(i[M].feature,P,M,L,this.index)}}update(i,c,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,h,g)}addFeatures(i,c,h,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,c,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,i8),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,c,h,g,y,b=[]){for(const S of _0(c,500)){let P=0;for(const q of S)P+=q.length;const M=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),L=M.vertexLength,F=[],N=[];for(const q of S){if(q.length===0)continue;q!==S[0]&&N.push(F.length/2);const J=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),oe=J.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(oe+q.length-1,oe),F.push(q[0].x),F.push(q[0].y);for(let me=1;me<q.length;me++)this.layoutVertexArray.emplaceBack(q[me].x,q[me].y),this.indexArray2.emplaceBack(oe+me-1,oe+me),F.push(q[me].x),F.push(q[me].y);J.vertexLength+=q.length,J.primitiveLength+=q.length}const H=ic(F,N);for(let q=0;q<H.length;q+=3)this.indexArray.emplaceBack(L+H[q],L+H[q+1],L+H[q+2]);M.vertexLength+=P,M.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,y,b,g)}}Xt("FillBucket",n3,{omit:["layers","patternFeatures"]});const l8=new Hr({"fill-sort-key":new an(ge.layout_fill["fill-sort-key"])});var Lu={paint:new Hr({"fill-antialias":new Gt(ge.paint_fill["fill-antialias"]),"fill-opacity":new an(ge.paint_fill["fill-opacity"]),"fill-color":new an(ge.paint_fill["fill-color"]),"fill-outline-color":new an(ge.paint_fill["fill-outline-color"]),"fill-translate":new Gt(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Gt(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new li(ge.paint_fill["fill-pattern"])}),layout:l8};const Fu=Mn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),y0=Mn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:N6}=Fu;var v0=lc;function lc(a,i,c,h,g){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=h,this._values=g,a.readFields(B6,this,i)}function B6(a,i,c){a==1?i.id=c.readVarint():a==2?function(h,g){for(var y=h.readVarint()+h.pos;h.pos<y;){var b=g._keys[h.readVarint()],S=g._values[h.readVarint()];g.properties[b]=S}}(c,i):a==3?i.type=c.readVarint():a==4&&(i._geometry=c.pos)}function x0(a){for(var i,c,h=0,g=0,y=a.length,b=y-1;g<y;b=g++)h+=((c=a[b]).x-(i=a[g]).x)*(i.y+c.y);return h}lc.types=["Unknown","Point","LineString","Polygon"],lc.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var i,c=a.readVarint()+a.pos,h=1,g=0,y=0,b=0,S=[];a.pos<c;){if(g<=0){var P=a.readVarint();h=7&P,g=P>>3}if(g--,h===1||h===2)y+=a.readSVarint(),b+=a.readSVarint(),h===1&&(i&&S.push(i),i=[]),i.push(new O(y,b));else{if(h!==7)throw new Error("unknown command "+h);i&&i.push(i[0].clone())}}return i&&S.push(i),S},lc.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var i=a.readVarint()+a.pos,c=1,h=0,g=0,y=0,b=1/0,S=-1/0,P=1/0,M=-1/0;a.pos<i;){if(h<=0){var L=a.readVarint();c=7&L,h=L>>3}if(h--,c===1||c===2)(g+=a.readSVarint())<b&&(b=g),g>S&&(S=g),(y+=a.readSVarint())<P&&(P=y),y>M&&(M=y);else if(c!==7)throw new Error("unknown command "+c)}return[b,P,S,M]},lc.prototype.toGeoJSON=function(a,i,c){var h,g,y=this.extent*Math.pow(2,c),b=this.extent*a,S=this.extent*i,P=this.loadGeometry(),M=lc.types[this.type];function L(H){for(var q=0;q<H.length;q++){var J=H[q];H[q]=[360*(J.x+b)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+S)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(h=0;h<P.length;h++)F[h]=P[h][0];L(P=F);break;case 2:for(h=0;h<P.length;h++)L(P[h]);break;case 3:for(P=function(H){var q=H.length;if(q<=1)return[H];for(var J,oe,me=[],Ce=0;Ce<q;Ce++){var De=x0(H[Ce]);De!==0&&(oe===void 0&&(oe=De<0),oe===De<0?(J&&me.push(J),J=[H[Ce]]):J.push(H[Ce]))}return J&&me.push(J),me}(P),h=0;h<P.length;h++)for(g=0;g<P[h].length;g++)L(P[h][g])}P.length===1?P=P[0]:M="Multi"+M;var N={type:"Feature",geometry:{type:M,coordinates:P},properties:this.properties};return"id"in this&&(N.id=this.id),N};var c8=b0;function b0(a,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(d,this,i),this.length=this._features.length}function d(a,i,c){a===15?i.version=c.readVarint():a===1?i.name=c.readString():a===5?i.extent=c.readVarint():a===2?i._features.push(c.pos):a===3?i._keys.push(c.readString()):a===4&&i._values.push(function(h){for(var g=null,y=h.readVarint()+h.pos;h.pos<y;){var b=h.readVarint()>>3;g=b===1?h.readString():b===2?h.readFloat():b===3?h.readDouble():b===4?h.readVarint64():b===5?h.readVarint():b===6?h.readSVarint():b===7?h.readBoolean():null}return g}(c))}function _(a,i,c){if(a===3){var h=new c8(c,c.readVarint()+c.pos);h.length&&(i[h.name]=h)}}b0.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var i=this._pbf.readVarint()+this._pbf.pos;return new v0(this._pbf,i,this.extent,this._keys,this._values)};var w={VectorTile:function(a,i){this.layers=a.readFields(_,{},i)},VectorTileFeature:v0,VectorTileLayer:c8};const k=w.VectorTileFeature.types,z=Math.pow(2,13);function Z(a,i,c,h,g,y,b,S){a.emplaceBack((i<<1)+b,(c<<1)+y,(Math.floor(h*z)<<1)+g,Math.round(S))}class te{constructor(){this.acc=new O(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new O(i.x,i.y),this.max=new O(i.x,i.y))}append(i,c){this.currentPolyCount.edges++,this.acc._add(i);let h=!!this.borders;const g=this.min,y=this.max;i.x<g.x?(g.x=i.x,h=!0):i.x>y.x&&(y.x=i.x,h=!0),i.y<g.y?(g.y=i.y,h=!0):i.y>y.y&&(y.y=i.y,h=!0),((i.x===0||i.x===Vn)&&i.x===c.x)!=((i.y===0||i.y===Vn)&&i.y===c.y)&&this.processBorderOverlap(i,c),h&&this.checkBorderIntersection(i,c)}checkBorderIntersection(i,c){c.x<0!=i.x<0&&this.addBorderIntersection(0,rr(c.y,i.y,(0-c.x)/(i.x-c.x))),c.x>Vn!=i.x>Vn&&this.addBorderIntersection(1,rr(c.y,i.y,(Vn-c.x)/(i.x-c.x))),c.y<0!=i.y<0&&this.addBorderIntersection(2,rr(c.x,i.x,(0-c.y)/(i.y-c.y))),c.y>Vn!=i.y>Vn&&this.addBorderIntersection(3,rr(c.x,i.x,(Vn-c.y)/(i.y-c.y)))}addBorderIntersection(i,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[i];c<h[0]&&(h[0]=c),c>h[1]&&(h[1]=c)}processBorderOverlap(i,c){if(i.x===c.x){if(i.y===c.y)return;const h=i.x===0?0:1;this.addBorderIntersection(h,c.y),this.addBorderIntersection(h,i.y)}else{const h=i.y===0?2:3;this.addBorderIntersection(h,c.x),this.addBorderIntersection(h,i.x)}}centroid(){const i=this.polyCount.reduce((c,h)=>c+h.edges,0);return i!==0?this.acc.div(i)._round():new O(0,0)}span(){return new O(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,c)=>i+ +(c[0]!==Number.MAX_VALUE),0)}}class xe{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new fl,this.centroidVertexArray=new G2,this.indexArray=new $s,this.programConfigurations=new aa(i.layers,i.zoom),this.segments=new Gr,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.enableTerrain=i.enableTerrain}populate(i,c,h,g){this.features=[],this.hasPattern=Du("fill-extrusion",this.layers,c),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(y){const b=Math.exp(Math.PI*(1-y.y/(1<<y.z)*2));return 80150034*b/(b*b+1)/Vn/(1<<y.z)}(h);for(const{feature:y,id:b,index:S,sourceLayerIndex:P}of i){const M=this.layers[0]._featureFilter.needGeometry,L=gl(y,M);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),L,h))continue;const F={id:b,sourceLayerIndex:P,index:S,geometry:M?L.geometry:Ms(y,h,g),properties:y.properties,type:y.type,patterns:{}},N=this.layoutVertexArray.length;this.hasPattern?this.features.push(t3("fill-extrusion",this.layers,F,this.zoom,c)):this.addFeature(F,F.geometry,S,h,{},c.availableImages),c.featureIndex.insert(y,F.geometry,S,P,this.index,N)}this.sortBorders()}addFeatures(i,c,h,g){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,c,h,g)}this.sortBorders()}update(i,c,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,N6),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,y0.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,c,h,g,y,b){const S=this.enableTerrain?new te:null;for(const M of _0(c,500)){let L=0,F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(M.length===0||(P=M[0]).every(oe=>oe.x<=0)||P.every(oe=>oe.x>=Vn)||P.every(oe=>oe.y<=0)||P.every(oe=>oe.y>=Vn))continue;for(let oe=0;oe<M.length;oe++){const me=M[oe];if(me.length===0)continue;L+=me.length;let Ce=0;S&&S.startRing(me[0]);for(let De=0;De<me.length;De++){const Ue=me[De];if(De>=1){const We=me[De-1];if(!ze(Ue,We)){S&&S.append(Ue,We),F.vertexLength+4>Gr.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Xe=Ue.sub(We)._perp(),gt=Xe.x/(Math.abs(Xe.x)+Math.abs(Xe.y)),pt=Xe.y>0?1:0,zt=We.dist(Ue);Ce+zt>32768&&(Ce=0),Z(this.layoutVertexArray,Ue.x,Ue.y,gt,pt,0,0,Ce),Z(this.layoutVertexArray,Ue.x,Ue.y,gt,pt,0,1,Ce),Ce+=zt,Z(this.layoutVertexArray,We.x,We.y,gt,pt,0,0,Ce),Z(this.layoutVertexArray,We.x,We.y,gt,pt,0,1,Ce);const Ot=F.vertexLength;this.indexArray.emplaceBack(Ot,Ot+2,Ot+1),this.indexArray.emplaceBack(Ot+1,Ot+2,Ot+3),F.vertexLength+=4,F.primitiveLength+=2}}}}if(F.vertexLength+L>Gr.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),k[i.type]!=="Polygon")continue;const N=[],H=[],q=F.vertexLength;for(let oe=0;oe<M.length;oe++){const me=M[oe];if(me.length!==0){me!==M[0]&&H.push(N.length/2);for(let Ce=0;Ce<me.length;Ce++){const De=me[Ce];Z(this.layoutVertexArray,De.x,De.y,0,0,1,1,0),N.push(De.x),N.push(De.y),S&&S.currentPolyCount.top++}}}const J=ic(N,H);for(let oe=0;oe<J.length;oe+=3)this.indexArray.emplaceBack(q+J[oe],q+J[oe+2],q+J[oe+1]);F.primitiveLength+=J.length/3,F.vertexLength+=L}var P;if(S&&S.polyCount.length>0){if(S.borders){S.vertexArrayOffset=this.centroidVertexArray.length;const M=S.borders,L=this.featuresOnBorder.push(S)-1;for(let F=0;F<4;F++)M[F][0]!==Number.MAX_VALUE&&this.borders[F].push(L)}this.encodeCentroid(S.borders?void 0:S.centroid(),S)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,y,b,g)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((c,h)=>this.featuresOnBorder[c].borders[i][0]-this.featuresOnBorder[h].borders[i][0])}encodeCentroid(i,c,h=!0){let g,y;if(i)if(i.y!==0){const S=c.span()._mult(this.tileToMeter);g=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(S.x/10)),y=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(S.y/10))}else g=Math.ceil(7*(i.x+450)),y=0;else g=0,y=+h;let b=h?this.centroidVertexArray.length:c.vertexArrayOffset;for(const S of c.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*S.edges+S.top);for(let P=0;P<2*S.edges;P++)this.centroidVertexArray.emplace(b++,0,y),this.centroidVertexArray.emplace(b++,g,y);for(let P=0;P<S.top;P++)this.centroidVertexArray.emplace(b++,g,y)}}}function ze(a,i){return a.x===i.x&&(a.x<0||a.x>Vn)||a.y===i.y&&(a.y<0||a.y>Vn)}Xt("FillExtrusionBucket",xe,{omit:["layers","features"]}),Xt("PartMetadata",te);var ct={paint:new Hr({"fill-extrusion-opacity":new Gt(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new an(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Gt(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Gt(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new li(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new an(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new an(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Gt(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Qt(a,i){return a.x*i.x+a.y*i.y}function kn(a,i){if(a.length===1){let c=0;const h=i[c++];let g;for(;!g||h.equals(g);)if(g=i[c++],!g)return 1/0;for(;c<i.length;c++){const y=i[c],b=a[0],S=g.sub(h),P=y.sub(h),M=b.sub(h),L=Qt(S,S),F=Qt(S,P),N=Qt(P,P),H=Qt(M,S),q=Qt(M,P),J=L*N-F*F,oe=(N*H-F*q)/J,me=(L*q-F*H)/J,Ce=h.z*(1-oe-me)+g.z*oe+y.z*me;if(isFinite(Ce))return Ce}return 1/0}{let c=1/0;for(const h of i)c=Math.min(c,h.z);return c}}function Nt(a){const i=new O(a[0],a[1]);return i.z=a[2],i}function dn(a,i,c,h,g,y,b,S){const P=b*g.getElevationAt(a,i,!0,!0),M=y[0]!==0,L=M?y[1]===0?b*(y[0]/7-450):b*function(F,N,H){const q=Math.floor(N[0]/8),J=Math.floor(N[1]/8),oe=10*(N[0]-8*q),me=10*(N[1]-8*J),Ce=F.getElevationAt(q,J,!0,!0),De=F.getMeterToDEM(H),Ue=Math.floor(.5*(oe*De-1)),We=Math.floor(.5*(me*De-1)),Xe=F.tileCoordToPixel(q,J),gt=2*Ue+1,pt=2*We+1,zt=function(Zt,en,Yn,Er,Qn){return[Zt.getElevationAtPixel(en,Yn,!0),Zt.getElevationAtPixel(en+Qn,Yn,!0),Zt.getElevationAtPixel(en,Yn+Qn,!0),Zt.getElevationAtPixel(en+Er,Yn+Qn,!0)]}(F,Xe.x-Ue,Xe.y-We,gt,pt),Ot=Math.abs(zt[0]-zt[1]),mt=Math.abs(zt[2]-zt[3]),Lt=Math.abs(zt[0]-zt[2])+Math.abs(zt[1]-zt[3]),Ut=Math.min(.25,.5*De*(Ot+mt)/gt),wt=Math.min(.25,.5*De*Lt/pt);return Ce+Math.max(Ut*oe,wt*me)}(g,y,S):P;return{base:P+(c===0)?-1:c,top:M?Math.max(L+h,P+c+2):P+h}}const On=Mn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:wn}=On,tt=Mn([{name:"a_packed",components:3,type:"Float32"}]),{members:je}=tt,Qe=w.VectorTileFeature.types,St=Math.cos(Math.PI/180*37.5);class Pt{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Z1,this.layoutVertexArray2=new Ci,this.indexArray=new $s,this.programConfigurations=new aa(i.layers,i.zoom),this.segments=new Gr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,h,g){this.hasPattern=Du("line",this.layers,c);const y=this.layers[0].layout.get("line-sort-key"),b=[];for(const{feature:L,id:F,index:N,sourceLayerIndex:H}of i){const q=this.layers[0]._featureFilter.needGeometry,J=gl(L,q);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),J,h))continue;const oe=y?y.evaluate(J,{},h):void 0,me={id:F,properties:L.properties,type:L.type,sourceLayerIndex:H,index:N,geometry:q?J.geometry:Ms(L,h,g),patterns:{},sortKey:oe};b.push(me)}y&&b.sort((L,F)=>L.sortKey-F.sortKey);const{lineAtlas:S,featureIndex:P}=c,M=this.addConstantDashes(S);for(const L of b){const{geometry:F,index:N,sourceLayerIndex:H}=L;if(M&&this.addFeatureDashes(L,S),this.hasPattern){const q=t3("line",this.layers,L,this.zoom,c);this.patternFeatures.push(q)}else this.addFeature(L,F,N,h,S.positions,c.availableImages);P.insert(i[N].feature,F,N,H,this.index)}}addConstantDashes(i){let c=!1;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,y=h.layout.get("line-cap").value;if(g.kind!=="constant"||y.kind!=="constant")c=!0;else{const b=y.value,S=g.value;if(!S)continue;i.addDash(S.from,b),i.addDash(S.to,b),S.other&&i.addDash(S.other,b)}}return c}addFeatureDashes(i,c){const h=this.zoom;for(const g of this.layers){const y=g.paint.get("line-dasharray").value,b=g.layout.get("line-cap").value;if(y.kind==="constant"&&b.kind==="constant")continue;let S,P,M,L,F,N;if(y.kind==="constant"){const oe=y.value;if(!oe)continue;S=oe.other||oe.to,P=oe.to,M=oe.from}else S=y.evaluate({zoom:h-1},i),P=y.evaluate({zoom:h},i),M=y.evaluate({zoom:h+1},i);b.kind==="constant"?L=F=N=b.value:(L=b.evaluate({zoom:h-1},i),F=b.evaluate({zoom:h},i),N=b.evaluate({zoom:h+1},i)),c.addDash(S,L),c.addDash(P,F),c.addDash(M,N);const H=c.getKey(S,L),q=c.getKey(P,F),J=c.getKey(M,N);i.patterns[g.id]={min:H,mid:q,max:J}}}update(i,c,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,h,g)}addFeatures(i,c,h,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,c,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,je)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,wn),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,c,h,g,y,b){const S=this.layers[0].layout,P=S.get("line-join").evaluate(i,{}),M=S.get("line-cap").evaluate(i,{}),L=S.get("line-miter-limit"),F=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const N of c)this.addLine(N,i,P,M,L,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,y,b,g)}addLine(i,c,h,g,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let me=0;me<i.length-1;me++)this.totalDistance+=i[me].dist(i[me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=Qe[c.type]==="Polygon";let P=i.length;for(;P>=2&&i[P-1].equals(i[P-2]);)P--;let M=0;for(;M<P-1&&i[M].equals(i[M+1]);)M++;if(P<(S?3:2))return;h==="bevel"&&(y=1.05);const L=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let N,H,q,J,oe;this.e1=this.e2=-1,S&&(N=i[P-2],oe=i[M].sub(N)._unit()._perp());for(let me=M;me<P;me++){if(q=me===P-1?S?i[M+1]:void 0:i[me+1],q&&i[me].equals(q))continue;oe&&(J=oe),N&&(H=N),N=i[me],oe=q?q.sub(N)._unit()._perp():J,J=J||oe;let Ce=J.add(oe);Ce.x===0&&Ce.y===0||Ce._unit();const De=J.x*oe.x+J.y*oe.y,Ue=Ce.x*oe.x+Ce.y*oe.y,We=Ue!==0?1/Ue:1/0,Xe=2*Math.sqrt(2-2*Ue),gt=Ue<St&&H&&q,pt=J.x*oe.y-J.y*oe.x>0;if(gt&&me>M){const mt=N.dist(H);if(mt>2*L){const Lt=N.sub(N.sub(H)._mult(L/mt)._round());this.updateDistance(H,Lt),this.addCurrentVertex(Lt,J,0,0,F),H=Lt}}const zt=H&&q;let Ot=zt?h:S?"butt":g;if(zt&&Ot==="round"&&(We<b?Ot="miter":We<=2&&(Ot="fakeround")),Ot==="miter"&&We>y&&(Ot="bevel"),Ot==="bevel"&&(We>2&&(Ot="flipbevel"),We<y&&(Ot="miter")),H&&this.updateDistance(H,N),Ot==="miter")Ce._mult(We),this.addCurrentVertex(N,Ce,0,0,F);else if(Ot==="flipbevel"){if(We>100)Ce=oe.mult(-1);else{const mt=We*J.add(oe).mag()/J.sub(oe).mag();Ce._perp()._mult(mt*(pt?-1:1))}this.addCurrentVertex(N,Ce,0,0,F),this.addCurrentVertex(N,Ce.mult(-1),0,0,F)}else if(Ot==="bevel"||Ot==="fakeround"){const mt=-Math.sqrt(We*We-1),Lt=pt?mt:0,Ut=pt?0:mt;if(H&&this.addCurrentVertex(N,J,Lt,Ut,F),Ot==="fakeround"){const wt=Math.round(180*Xe/Math.PI/20);for(let Zt=1;Zt<wt;Zt++){let en=Zt/wt;if(en!==.5){const Er=en-.5;en+=en*Er*(en-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*Er*Er+(.848013+De*(.215638*De-1.06021)))}const Yn=oe.sub(J)._mult(en)._add(J)._unit()._mult(pt?-1:1);this.addHalfVertex(N,Yn.x,Yn.y,!1,pt,0,F)}}q&&this.addCurrentVertex(N,oe,-Lt,-Ut,F)}else if(Ot==="butt")this.addCurrentVertex(N,Ce,0,0,F);else if(Ot==="square"){const mt=H?1:-1;H||this.addCurrentVertex(N,Ce,mt,mt,F),this.addCurrentVertex(N,Ce,0,0,F),H&&this.addCurrentVertex(N,Ce,mt,mt,F)}else Ot==="round"&&(H&&(this.addCurrentVertex(N,J,0,0,F),this.addCurrentVertex(N,J,1,1,F,!0)),q&&(this.addCurrentVertex(N,oe,-1,-1,F,!0),this.addCurrentVertex(N,oe,0,0,F)));if(gt&&me<P-1){const mt=N.dist(q);if(mt>2*L){const Lt=N.add(q.sub(N)._mult(L/mt)._round());this.updateDistance(N,Lt),this.addCurrentVertex(Lt,oe,0,0,F),N=Lt}}}}addCurrentVertex(i,c,h,g,y,b=!1){const S=c.y*g-c.x,P=-c.y-c.x*g;this.addHalfVertex(i,c.x+c.y*h,c.y-c.x*h,b,!1,h,y),this.addHalfVertex(i,S,P,b,!0,-g,y)}addHalfVertex({x:i,y:c},h,g,y,b,S,P){this.layoutVertexArray.emplaceBack((i<<1)+(y?1:0),(c<<1)+(b?1:0),Math.round(63*h)+128,Math.round(63*g)+128,1+(S===0?0:S<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const M=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),P.primitiveLength++),b?this.e2=M:this.e1=M}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,c){this.distance+=i.dist(c),this.updateScaledDistance()}}Xt("LineBucket",Pt,{omit:["layers","patternFeatures"]});const Bn=new Hr({"line-cap":new an(ge.layout_line["line-cap"]),"line-join":new an(ge.layout_line["line-join"]),"line-miter-limit":new Gt(ge.layout_line["line-miter-limit"]),"line-round-limit":new Gt(ge.layout_line["line-round-limit"]),"line-sort-key":new an(ge.layout_line["line-sort-key"])});var cn={paint:new Hr({"line-opacity":new an(ge.paint_line["line-opacity"]),"line-color":new an(ge.paint_line["line-color"]),"line-translate":new Gt(ge.paint_line["line-translate"]),"line-translate-anchor":new Gt(ge.paint_line["line-translate-anchor"]),"line-width":new an(ge.paint_line["line-width"]),"line-gap-width":new an(ge.paint_line["line-gap-width"]),"line-offset":new an(ge.paint_line["line-offset"]),"line-blur":new an(ge.paint_line["line-blur"]),"line-dasharray":new li(ge.paint_line["line-dasharray"]),"line-pattern":new li(ge.paint_line["line-pattern"]),"line-gradient":new Oo(ge.paint_line["line-gradient"])}),layout:Bn};const Ln=new class extends an{possiblyEvaluate(a,i){return i=new gn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(a,i)}evaluate(a,i,c,h){return i=ur({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(a,i,c,h)}}(cn.paint.properties["line-width"].specification);function Zn(a,i){return i>0?i+2*a:a}Ln.useIntegerZoom=!0;const jn=Mn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),u1=Mn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Mn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const z6=Mn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),mb=Mn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Bf=Mn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),gb=Mn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Mn([{name:"triangle",components:3,type:"Uint16"}]),Mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mn([{type:"Float32",name:"offsetX"}]),Mn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var ps=24;const h1=128;function U6(a,i){const{expression:c}=i;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new gn(a+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=c;let y=0;for(;y<h.length&&h[y]<=a;)y++;y=Math.max(0,y-1);let b=y;for(;b<h.length&&h[b]<a+1;)b++;b=Math.min(h.length-1,b);const S=h[y],P=h[b];return c.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:P,interpolationType:g}:{kind:"camera",minZoom:S,maxZoom:P,minSize:c.evaluate(new gn(S)),maxSize:c.evaluate(new gn(P)),interpolationType:g}}}function u8(a,{uSize:i,uSizeT:c},{lowerSize:h,upperSize:g}){return a.kind==="source"?h/h1:a.kind==="composite"?rr(h/h1,g/h1,c):i}function v4(a,i){let c=0,h=0;if(a.kind==="constant")h=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:b}=a,S=g?En(Qi.interpolationFactor(g,i,y,b),0,1):0;a.kind==="camera"?h=rr(a.minSize,a.maxSize,S):c=S}return{uSizeT:c,uSize:h}}var _b=Object.freeze({__proto__:null,getSizeData:U6,evaluateSizeForFeature:u8,evaluateSizeForZoom:v4,SIZE_PACK_FACTOR:h1});function yb(a,i,c){return a.sections.forEach(h=>{h.text=function(g,y,b){const S=y.layout.get("text-transform").evaluate(b,{});return S==="uppercase"?g=g.toLocaleUpperCase():S==="lowercase"&&(g=g.toLocaleLowerCase()),$n.applyArabicShaping&&(g=$n.applyArabicShaping(g)),g}(h.text,i,c)}),a}const Nu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function vb(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function xb(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}var zf=function(a,i,c,h,g){var y,b,S=8*g-h-1,P=(1<<S)-1,M=P>>1,L=-7,F=g-1,N=-1,H=a[i+F];for(F+=N,y=H&(1<<-L)-1,H>>=-L,L+=S;L>0;y=256*y+a[i+F],F+=N,L-=8);for(b=y&(1<<-L)-1,y>>=-L,L+=h;L>0;b=256*b+a[i+F],F+=N,L-=8);if(y===0)y=1-M;else{if(y===P)return b?NaN:1/0*(H?-1:1);b+=Math.pow(2,h),y-=M}return(H?-1:1)*b*Math.pow(2,y-h)},Uf=function(a,i,c,h,g,y){var b,S,P,M=8*y-g-1,L=(1<<M)-1,F=L>>1,N=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=0,q=1,J=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(S=isNaN(i)?1:0,b=L):(b=Math.floor(Math.log(i)/Math.LN2),i*(P=Math.pow(2,-b))<1&&(b--,P*=2),(i+=b+F>=1?N/P:N*Math.pow(2,1-F))*P>=2&&(b++,P/=2),b+F>=L?(S=0,b=L):b+F>=1?(S=(i*P-1)*Math.pow(2,g),b+=F):(S=i*Math.pow(2,F-1)*Math.pow(2,g),b=0));g>=8;a[c+H]=255&S,H+=q,S/=256,g-=8);for(b=b<<g|S,M+=g;M>0;a[c+H]=255&b,H+=q,b/=256,M-=8);a[c+H-q]|=128*J},Bu=Tr;function Tr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Tr.Varint=0,Tr.Fixed64=1,Tr.Bytes=2,Tr.Fixed32=5;var V6=4294967296,Vf=1/V6,jf=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function cc(a){return a.type===Tr.Bytes?a.readVarint()+a.pos:a.pos+1}function x4(a,i,c){return c?4294967296*i+(a>>>0):4294967296*(i>>>0)+(a>>>0)}function $f(a,i,c){var h=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));c.realloc(h);for(var g=c.pos-1;g>=a;g--)c.buf[g+h]=c.buf[g]}function bb(a,i){for(var c=0;c<a.length;c++)i.writeVarint(a[c])}function wb(a,i){for(var c=0;c<a.length;c++)i.writeSVarint(a[c])}function Tb(a,i){for(var c=0;c<a.length;c++)i.writeFloat(a[c])}function Eb(a,i){for(var c=0;c<a.length;c++)i.writeDouble(a[c])}function Sb(a,i){for(var c=0;c<a.length;c++)i.writeBoolean(a[c])}function Ab(a,i){for(var c=0;c<a.length;c++)i.writeFixed32(a[c])}function Cb(a,i){for(var c=0;c<a.length;c++)i.writeSFixed32(a[c])}function Pb(a,i){for(var c=0;c<a.length;c++)i.writeFixed64(a[c])}function Ib(a,i){for(var c=0;c<a.length;c++)i.writeSFixed64(a[c])}function h8(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16)+16777216*a[i+3]}function b4(a,i,c){a[c]=i,a[c+1]=i>>>8,a[c+2]=i>>>16,a[c+3]=i>>>24}function Wf(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16)+(a[i+3]<<24)}function Mb(a,i,c){i.glyphs=[],a===1&&c.readMessage(Rb,i)}function Rb(a,i,c){if(a===3){const{id:h,bitmap:g,width:y,height:b,left:S,top:P,advance:M}=c.readMessage(kb,{});i.glyphs.push({id:h,bitmap:new Pi({width:y+6,height:b+6},g),metrics:{width:y,height:b,left:S,top:P,advance:M}})}else a===4?i.ascender=c.readSVarint():a===5&&(i.descender=c.readSVarint())}function kb(a,i,c){a===1?i.id=c.readVarint():a===2?i.bitmap=c.readBytes():a===3?i.width=c.readVarint():a===4?i.height=c.readVarint():a===5?i.left=c.readSVarint():a===6?i.top=c.readSVarint():a===7&&(i.advance=c.readVarint())}function j6(a){let i=0,c=0;for(const b of a)i+=b.w*b.h,c=Math.max(c,b.w);a.sort((b,S)=>S.h-b.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),c),h:1/0}];let g=0,y=0;for(const b of a)for(let S=h.length-1;S>=0;S--){const P=h[S];if(!(b.w>P.w||b.h>P.h)){if(b.x=P.x,b.y=P.y,y=Math.max(y,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===P.w&&b.h===P.h){const M=h.pop();S<h.length&&(h[S]=M)}else b.h===P.h?(P.x+=b.w,P.w-=b.w):b.w===P.w?(P.y+=b.h,P.h-=b.h):(h.push({x:P.x+b.w,y:P.y,w:P.w-b.w,h:b.h}),P.y+=b.h,P.h-=b.h);break}}return{w:g,h:y,fill:i/(g*y)||0}}Tr.prototype={destroy:function(){this.buf=null},readFields:function(a,i,c){for(c=c||this.length;this.pos<c;){var h=this.readVarint(),g=h>>3,y=this.pos;this.type=7&h,a(g,i,this),this.pos===y&&this.skip(h)}return i},readMessage:function(a,i){return this.readFields(a,i,this.readVarint()+this.pos)},readFixed32:function(){var a=h8(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Wf(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=h8(this.buf,this.pos)+h8(this.buf,this.pos+4)*V6;return this.pos+=8,a},readSFixed64:function(){var a=h8(this.buf,this.pos)+Wf(this.buf,this.pos+4)*V6;return this.pos+=8,a},readFloat:function(){var a=zf(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=zf(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var i,c,h=this.buf;return i=127&(c=h[this.pos++]),c<128?i:(i|=(127&(c=h[this.pos++]))<<7,c<128?i:(i|=(127&(c=h[this.pos++]))<<14,c<128?i:(i|=(127&(c=h[this.pos++]))<<21,c<128?i:function(g,y,b){var S,P,M=b.buf;if(S=(112&(P=M[b.pos++]))>>4,P<128||(S|=(127&(P=M[b.pos++]))<<3,P<128)||(S|=(127&(P=M[b.pos++]))<<10,P<128)||(S|=(127&(P=M[b.pos++]))<<17,P<128)||(S|=(127&(P=M[b.pos++]))<<24,P<128)||(S|=(1&(P=M[b.pos++]))<<31,P<128))return x4(g,S,y);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(c=h[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,i=this.pos;return this.pos=a,a-i>=12&&jf?function(c,h,g){return jf.decode(c.subarray(h,g))}(this.buf,i,a):function(c,h,g){for(var y="",b=h;b<g;){var S,P,M,L=c[b],F=null,N=L>239?4:L>223?3:L>191?2:1;if(b+N>g)break;N===1?L<128&&(F=L):N===2?(192&(S=c[b+1]))==128&&(F=(31&L)<<6|63&S)<=127&&(F=null):N===3?(P=c[b+2],(192&(S=c[b+1]))==128&&(192&P)==128&&((F=(15&L)<<12|(63&S)<<6|63&P)<=2047||F>=55296&&F<=57343)&&(F=null)):N===4&&(P=c[b+2],M=c[b+3],(192&(S=c[b+1]))==128&&(192&P)==128&&(192&M)==128&&((F=(15&L)<<18|(63&S)<<12|(63&P)<<6|63&M)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,N=1):F>65535&&(F-=65536,y+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),y+=String.fromCharCode(F),b+=N}return y}(this.buf,i,a)},readBytes:function(){var a=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,a);return this.pos=a,i},readPackedVarint:function(a,i){if(this.type!==Tr.Bytes)return a.push(this.readVarint(i));var c=cc(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(i));return a},readPackedSVarint:function(a){if(this.type!==Tr.Bytes)return a.push(this.readSVarint());var i=cc(this);for(a=a||[];this.pos<i;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Tr.Bytes)return a.push(this.readBoolean());var i=cc(this);for(a=a||[];this.pos<i;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Tr.Bytes)return a.push(this.readFloat());var i=cc(this);for(a=a||[];this.pos<i;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Tr.Bytes)return a.push(this.readDouble());var i=cc(this);for(a=a||[];this.pos<i;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Tr.Bytes)return a.push(this.readFixed32());var i=cc(this);for(a=a||[];this.pos<i;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Tr.Bytes)return a.push(this.readSFixed32());var i=cc(this);for(a=a||[];this.pos<i;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Tr.Bytes)return a.push(this.readFixed64());var i=cc(this);for(a=a||[];this.pos<i;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Tr.Bytes)return a.push(this.readSFixed64());var i=cc(this);for(a=a||[];this.pos<i;)a.push(this.readSFixed64());return a},skip:function(a){var i=7&a;if(i===Tr.Varint)for(;this.buf[this.pos++]>127;);else if(i===Tr.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Tr.Fixed32)this.pos+=4;else{if(i!==Tr.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(a,i){this.writeVarint(a<<3|i)},realloc:function(a){for(var i=this.length||16;i<this.pos+a;)i*=2;if(i!==this.length){var c=new Uint8Array(i);c.set(this.buf),this.buf=c,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),b4(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),b4(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),b4(this.buf,-1&a,this.pos),b4(this.buf,Math.floor(a*Vf),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),b4(this.buf,-1&a,this.pos),b4(this.buf,Math.floor(a*Vf),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(i,c){var h,g;if(i>=0?(h=i%4294967296|0,g=i/4294967296|0):(g=~(-i/4294967296),4294967295^(h=~(-i%4294967296))?h=h+1|0:(h=0,g=g+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(y,b,S){S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,S.buf[S.pos]=127&(y>>>=7)}(h,0,c),function(y,b){var S=(7&y)<<4;b.buf[b.pos++]|=S|((y>>>=3)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y)))))}(g,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var i=this.pos;this.pos=function(h,g,y){for(var b,S,P=0;P<g.length;P++){if((b=g.charCodeAt(P))>55295&&b<57344){if(!S){b>56319||P+1===g.length?(h[y++]=239,h[y++]=191,h[y++]=189):S=b;continue}if(b<56320){h[y++]=239,h[y++]=191,h[y++]=189,S=b;continue}b=S-55296<<10|b-56320|65536,S=null}else S&&(h[y++]=239,h[y++]=191,h[y++]=189,S=null);b<128?h[y++]=b:(b<2048?h[y++]=b>>6|192:(b<65536?h[y++]=b>>12|224:(h[y++]=b>>18|240,h[y++]=b>>12&63|128),h[y++]=b>>6&63|128),h[y++]=63&b|128)}return y}(this.buf,a,this.pos);var c=this.pos-i;c>=128&&$f(i,c,this),this.pos=i-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),Uf(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Uf(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var i=a.length;this.writeVarint(i),this.realloc(i);for(var c=0;c<i;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,i){this.pos++;var c=this.pos;a(i,this);var h=this.pos-c;h>=128&&$f(c,h,this),this.pos=c-1,this.writeVarint(h),this.pos+=h},writeMessage:function(a,i,c){this.writeTag(a,Tr.Bytes),this.writeRawMessage(i,c)},writePackedVarint:function(a,i){i.length&&this.writeMessage(a,bb,i)},writePackedSVarint:function(a,i){i.length&&this.writeMessage(a,wb,i)},writePackedBoolean:function(a,i){i.length&&this.writeMessage(a,Sb,i)},writePackedFloat:function(a,i){i.length&&this.writeMessage(a,Tb,i)},writePackedDouble:function(a,i){i.length&&this.writeMessage(a,Eb,i)},writePackedFixed32:function(a,i){i.length&&this.writeMessage(a,Ab,i)},writePackedSFixed32:function(a,i){i.length&&this.writeMessage(a,Cb,i)},writePackedFixed64:function(a,i){i.length&&this.writeMessage(a,Pb,i)},writePackedSFixed64:function(a,i){i.length&&this.writeMessage(a,Ib,i)},writeBytesField:function(a,i){this.writeTag(a,Tr.Bytes),this.writeBytes(i)},writeFixed32Field:function(a,i){this.writeTag(a,Tr.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(a,i){this.writeTag(a,Tr.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(a,i){this.writeTag(a,Tr.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(a,i){this.writeTag(a,Tr.Fixed64),this.writeSFixed64(i)},writeVarintField:function(a,i){this.writeTag(a,Tr.Varint),this.writeVarint(i)},writeSVarintField:function(a,i){this.writeTag(a,Tr.Varint),this.writeSVarint(i)},writeStringField:function(a,i){this.writeTag(a,Tr.Bytes),this.writeString(i)},writeFloatField:function(a,i){this.writeTag(a,Tr.Fixed32),this.writeFloat(i)},writeDoubleField:function(a,i){this.writeTag(a,Tr.Fixed64),this.writeDouble(i)},writeBooleanField:function(a,i){this.writeVarintField(a,!!i)}};class $6{constructor(i,{pixelRatio:c,version:h,stretchX:g,stretchY:y,content:b}){this.paddedRect=i,this.pixelRatio=c,this.stretchX=g,this.stretchY=y,this.content=b,this.version=h}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Hf{constructor(i,c){const h={},g={};this.haveRenderCallbacks=[];const y=[];this.addImages(i,h,y),this.addImages(c,g,y);const{w:b,h:S}=j6(y),P=new Zs({width:b||1,height:S||1});for(const M in i){const L=i[M],F=h[M].paddedRect;Zs.copy(L.data,P,{x:0,y:0},{x:F.x+1,y:F.y+1},L.data)}for(const M in c){const L=c[M],F=g[M].paddedRect,N=F.x+1,H=F.y+1,q=L.data.width,J=L.data.height;Zs.copy(L.data,P,{x:0,y:0},{x:N,y:H},L.data),Zs.copy(L.data,P,{x:0,y:J-1},{x:N,y:H-1},{width:q,height:1}),Zs.copy(L.data,P,{x:0,y:0},{x:N,y:H+J},{width:q,height:1}),Zs.copy(L.data,P,{x:q-1,y:0},{x:N-1,y:H},{width:1,height:J}),Zs.copy(L.data,P,{x:0,y:0},{x:N+q,y:H},{width:1,height:J})}this.image=P,this.iconPositions=h,this.patternPositions=g}addImages(i,c,h){for(const g in i){const y=i[g],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};h.push(b),c[g]=new $6(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,c){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in i.updatedImages)this.patchUpdatedImage(this.iconPositions[h],i.getImage(h),c),this.patchUpdatedImage(this.patternPositions[h],i.getImage(h),c)}patchUpdatedImage(i,c,h){if(!i||!c||i.version===c.version)return;i.version=c.version;const[g,y]=i.tl;h.update(c.data,void 0,{x:g,y})}}Xt("ImagePosition",$6),Xt("ImageAtlas",Hf);const ua={horizontal:1,vertical:2,horizontalOnly:3};class zu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,c){const h=new zu;return h.scale=i||1,h.fontStack=c,h}static forImage(i){const c=new zu;return c.imageName=i,c}}class w4{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,c){const h=new w4;for(let g=0;g<i.sections.length;g++){const y=i.sections[g];y.image?h.addImageSection(y):h.addTextSection(y,c)}return h}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(c,h){let g="";for(let y=0;y<c.length;y++){const b=c.charCodeAt(y+1)||null,S=c.charCodeAt(y-1)||null;g+=!h&&(b&&nn(b)&&!Nu[c[y+1]]||S&&nn(S)&&!Nu[c[y-1]])||!Nu[c[y]]?c[y]:Nu[c[y]]}return g}(this.text,i)}trim(){let i=0;for(let h=0;h<this.text.length&&f8[this.text.charCodeAt(h)];h++)i++;let c=this.text.length;for(let h=this.text.length-1;h>=0&&h>=i&&f8[this.text.charCodeAt(h)];h--)c--;this.text=this.text.substring(i,c),this.sectionIndex=this.sectionIndex.slice(i,c)}substring(i,c){const h=new w4;return h.text=this.text.substring(i,c),h.sectionIndex=this.sectionIndex.slice(i,c),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,c)=>Math.max(i,this.sections[c].scale),0)}addTextSection(i,c){this.text+=i.text,this.sections.push(zu.forText(i.scale,i.fontStack||c));const h=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(h)}addImageSection(i){const c=i.image?i.image.name:"";if(c.length===0)return void gr("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(zu.forImage(c)),this.sectionIndex.push(this.sections.length-1)):gr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function W6(a,i,c,h,g,y,b,S,P,M,L,F,N,H,q,J){const oe=w4.fromFeature(a,g);let me;F===ua.vertical&&oe.verticalizePunctuation(N);const{processBidirectionalText:Ce,processStyledBidirectionalText:De}=$n;if(Ce&&oe.sections.length===1){me=[];const Xe=Ce(oe.toString(),H6(oe,M,y,i,h,H,q));for(const gt of Xe){const pt=new w4;pt.text=gt,pt.sections=oe.sections;for(let zt=0;zt<gt.length;zt++)pt.sectionIndex.push(0);me.push(pt)}}else if(De){me=[];const Xe=De(oe.text,oe.sectionIndex,H6(oe,M,y,i,h,H,q));for(const gt of Xe){const pt=new w4;pt.text=gt[0],pt.sectionIndex=gt[1],pt.sections=oe.sections,me.push(pt)}}else me=function(Xe,gt){const pt=[],zt=Xe.text;let Ot=0;for(const mt of gt)pt.push(Xe.substring(Ot,mt)),Ot=mt;return Ot<zt.length&&pt.push(Xe.substring(Ot,zt.length)),pt}(oe,H6(oe,M,y,i,h,H,q));const Ue=[],We={positionedLines:Ue,text:oe.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:F,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Xe,gt,pt,zt,Ot,mt,Lt,Ut,wt,Zt,en,Yn){let Er=0,Qn=0,er=0;const Mt=Ut==="right"?1:Ut==="left"?0:.5;let or=!1;for(const ar of Ot){const qn=ar.getSections();for(const Ur of qn){if(Ur.imageName)continue;const ui=gt[Ur.fontStack];if(ui&&(or=ui.ascender!==void 0&&ui.descender!==void 0,!or))break}if(!or)break}let nr=0;for(const ar of Ot){ar.trim();const qn=ar.getMaxScale(),Ur=(qn-1)*ps,ui={positionedGlyphs:[],lineOffset:0};Xe.positionedLines[nr]=ui;const ni=ui.positionedGlyphs;let xi=0;if(!ar.length()){Qn+=mt,++nr;continue}let ms=0,go=0;for(let Dr=0;Dr<ar.length();Dr++){const zi=ar.getSection(Dr),za=ar.getSectionIndex(Dr),is=ar.getCharCode(Dr);let xr=zi.scale,Ui=null,Vr=null,ks=null,Ii=ps,Os=0;const qs=!(wt===ua.horizontal||!en&&!dt(is)||en&&(f8[is]||(ci=is,l(ci)||p(ci)||x(ci)||Ie(ci)||Et(ci))));if(zi.imageName){const Gs=zt[zi.imageName];if(!Gs)continue;ks=zi.imageName,Xe.iconsInText=Xe.iconsInText||!0,Vr=Gs.paddedRect;const Vi=Gs.displaySize;xr=xr*ps/Yn,Ui={width:Vi[0],height:Vi[1],left:1,top:-3,advance:qs?Vi[1]:Vi[0],localGlyph:!1},Os=or?-Ui.height*xr:qn*ps-17-Vi[1]*xr,Ii=Ui.advance;const Sl=(qs?Vi[0]:Vi[1])*xr-ps*qn;Sl>0&&Sl>xi&&(xi=Sl)}else{const Gs=pt[zi.fontStack];if(!Gs)continue;Gs[is]&&(Vr=Gs[is]);const Vi=gt[zi.fontStack];if(!Vi)continue;const Sl=Vi.glyphs[is];if(!Sl)continue;if(Ui=Sl.metrics,Ii=is!==8203?ps:0,or){const P4=Vi.ascender!==void 0?Math.abs(Vi.ascender):0,Hu=Vi.descender!==void 0?Math.abs(Vi.descender):0,Xu=(P4+Hu)*xr;ms<Xu&&(ms=Xu,go=(P4-Hu)/2*xr),Os=-P4*xr}else Os=(qn-xr)*ps-17}qs?(Xe.verticalizable=!0,ni.push({glyph:is,imageName:ks,x:Er,y:Qn+Os,vertical:qs,scale:xr,localGlyph:Ui.localGlyph,fontStack:zi.fontStack,sectionIndex:za,metrics:Ui,rect:Vr}),Er+=Ii*xr+Zt):(ni.push({glyph:is,imageName:ks,x:Er,y:Qn+Os,vertical:qs,scale:xr,localGlyph:Ui.localGlyph,fontStack:zi.fontStack,sectionIndex:za,metrics:Ui,rect:Vr}),Er+=Ui.advance*xr+Zt)}ni.length!==0&&(er=Math.max(Er-Zt,er),or?Yf(ni,Mt,xi,go,mt*qn/2):Yf(ni,Mt,xi,0,mt/2)),Er=0;const _o=mt*qn+xi;ui.lineOffset=Math.max(xi,Ur),Qn+=_o,++nr}var ci;const Yr=Qn,{horizontalAlign:Bi,verticalAlign:Rs}=X6(Lt);(function(ar,qn,Ur,ui,ni,xi){const ms=(qn-Ur)*ni,go=-xi*ui;for(const _o of ar)for(const Dr of _o.positionedGlyphs)Dr.x+=ms,Dr.y+=go})(Xe.positionedLines,Mt,Bi,Rs,er,Yr),Xe.top+=-Rs*Yr,Xe.bottom=Xe.top+Yr,Xe.left+=-Bi*er,Xe.right=Xe.left+er,Xe.hasBaseline=or}(We,i,c,h,me,b,S,P,F,M,N,J),!function(Xe){for(const gt of Xe)if(gt.positionedGlyphs.length!==0)return!1;return!0}(Ue)&&We}const f8={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ob={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Xf(a,i,c,h,g,y){if(i.imageName){const b=h[i.imageName];return b?b.displaySize[0]*i.scale*ps/y+g:0}{const b=c[i.fontStack],S=b&&b.glyphs[a];return S?S.metrics.advance*i.scale+g:0}}function Zf(a,i,c,h){const g=Math.pow(a-i,2);return h?a<i?g/2:2*g:g+Math.abs(c)*c}function Db(a,i,c){let h=0;return a===10&&(h-=1e4),c&&(h+=150),a!==40&&a!==65288||(h+=50),i!==41&&i!==65289||(h+=50),h}function qf(a,i,c,h,g,y){let b=null,S=Zf(i,c,g,y);for(const P of h){const M=Zf(i-P.x,c,g,y)+P.badness;M<=S&&(b=P,S=M)}return{index:a,x:i,priorBreak:b,badness:S}}function Gf(a){return a?Gf(a.priorBreak).concat(a.index):[]}function H6(a,i,c,h,g,y,b){if(y!=="point")return[];if(!a)return[];const S=[],P=function(N,H,q,J,oe,me){let Ce=0;for(let De=0;De<N.length();De++){const Ue=N.getSection(De);Ce+=Xf(N.getCharCode(De),Ue,J,oe,H,me)}return Ce/Math.max(1,Math.ceil(Ce/q))}(a,i,c,h,g,b),M=a.text.indexOf("")>=0;let L=0;for(let N=0;N<a.length();N++){const H=a.getSection(N),q=a.getCharCode(N);if(f8[q]||(L+=Xf(q,H,h,g,i,b)),N<a.length()-1){const J=!((F=q)<11904||!(X(F)||$(F)||st(F)||we(F)||ae(F)||E(F)||K(F)||D(F)||Pe(F)||ie(F)||re(F)||bt(F)||B(F)||I(F)||A(F)||se(F)||j(F)||Ke(F)||Se(F)||Ae(F)));(Ob[q]||J||H.imageName)&&S.push(qf(N+1,L,P,S,Db(q,a.getCharCode(N+1),J&&M),!1))}}var F;return Gf(qf(a.length(),L,P,S,0,!0))}function X6(a){let i=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:i,verticalAlign:c}}function Yf(a,i,c,h,g){if(!(i||c||h||g))return;const y=a.length-1,b=a[y],S=(b.x+b.metrics.advance*b.scale)*i;for(let P=0;P<=y;P++)a[P].x-=S,a[P].y+=c+h+g}function Lb(a,i,c){const{horizontalAlign:h,verticalAlign:g}=X6(c),y=i[0]-a.displaySize[0]*h,b=i[1]-a.displaySize[1]*g;return{image:a,top:b,bottom:b+a.displaySize[1],left:y,right:y+a.displaySize[0]}}function Kf(a,i,c,h,g,y){const b=a.image;let S;if(b.content){const oe=b.content,me=b.pixelRatio||1;S=[oe[0]/me,oe[1]/me,b.displaySize[0]-oe[2]/me,b.displaySize[1]-oe[3]/me]}const P=i.left*y,M=i.right*y;let L,F,N,H;c==="width"||c==="both"?(H=g[0]+P-h[3],F=g[0]+M+h[1]):(H=g[0]+(P+M-b.displaySize[0])/2,F=H+b.displaySize[0]);const q=i.top*y,J=i.bottom*y;return c==="height"||c==="both"?(L=g[1]+q-h[0],N=g[1]+J+h[2]):(L=g[1]+(q+J-b.displaySize[1])/2,N=L+b.displaySize[1]),{image:b,top:L,right:F,bottom:N,left:H,collisionPadding:S}}class uc extends O{constructor(i,c,h,g,y){super(i,c),this.angle=g,this.z=h,y!==void 0&&(this.segment=y)}clone(){return new uc(this.x,this.y,this.z,this.angle,this.segment)}}function Jf(a,i,c,h,g){if(i.segment===void 0)return!0;let y=i,b=i.segment+1,S=0;for(;S>-c/2;){if(b--,b<0)return!1;S-=a[b].dist(y),y=a[b]}S+=a[b].dist(a[b+1]),b++;const P=[];let M=0;for(;S<c/2;){const L=a[b],F=a[b+1];if(!F)return!1;let N=a[b-1].angleTo(L)-L.angleTo(F);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:S,angleDelta:N}),M+=N;S-P[0].distance>h;)M-=P.shift().angleDelta;if(M>g)return!1;b++,S+=L.dist(F)}return!0}function Qf(a){let i=0;for(let c=0;c<a.length-1;c++)i+=a[c].dist(a[c+1]);return i}function ed(a,i,c){return a?.6*i*c:0}function td(a,i){return Math.max(a?a.right-a.left:0,i?i.right-i.left:0)}function Fb(a,i,c,h,g,y){const b=ed(c,g,y),S=td(c,h)*y;let P=0;const M=Qf(a)/2;for(let L=0;L<a.length-1;L++){const F=a[L],N=a[L+1],H=F.dist(N);if(P+H>M){const q=(M-P)/H,J=rr(F.x,N.x,q),oe=rr(F.y,N.y,q),me=new uc(J,oe,0,N.angleTo(F),L);return!b||Jf(a,me,S,b,i)?me:void 0}P+=H}}function Nb(a,i,c,h,g,y,b,S,P){const M=ed(h,y,b),L=td(h,g),F=L*b,N=a[0].x===0||a[0].x===P||a[0].y===0||a[0].y===P;return i-F<i/4&&(i=F+i/4),nd(a,N?i/2*S%i:(L/2+2*y)*b*S%i,i,M,c,F,N,!1,P)}function nd(a,i,c,h,g,y,b,S,P){const M=y/2,L=Qf(a);let F=0,N=i-c,H=[];for(let q=0;q<a.length-1;q++){const J=a[q],oe=a[q+1],me=J.dist(oe),Ce=oe.angleTo(J);for(;N+c<F+me;){N+=c;const De=(N-F)/me,Ue=rr(J.x,oe.x,De),We=rr(J.y,oe.y,De);if(Ue>=0&&Ue<P&&We>=0&&We<P&&N-M>=0&&N+M<=L){const Xe=new uc(Ue,We,0,Ce,q);Xe._round(),h&&!Jf(a,Xe,y,h,g)||H.push(Xe)}}F+=me}return S||H.length||b||(H=nd(a,F/2,c,h,g,y,b,!0,P)),H}function rd(a,i,c,h,g){const y=[];for(let b=0;b<a.length;b++){const S=a[b];let P;for(let M=0;M<S.length-1;M++){let L=S[M],F=S[M+1];L.x<i&&F.x<i||(L.x<i?L=new O(i,L.y+(i-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x<i&&(F=new O(i,L.y+(i-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y<c&&F.y<c||(L.y<c?L=new O(L.x+(c-L.y)/(F.y-L.y)*(F.x-L.x),c)._round():F.y<c&&(F=new O(L.x+(c-L.y)/(F.y-L.y)*(F.x-L.x),c)._round()),L.x>=h&&F.x>=h||(L.x>=h?L=new O(h,L.y+(h-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x>=h&&(F=new O(h,L.y+(h-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y>=g&&F.y>=g||(L.y>=g?L=new O(L.x+(g-L.y)/(F.y-L.y)*(F.x-L.x),g)._round():F.y>=g&&(F=new O(L.x+(g-L.y)/(F.y-L.y)*(F.x-L.x),g)._round()),P&&L.equals(P[P.length-1])||(P=[L],y.push(P)),P.push(F)))))}}return y}Xt("Anchor",uc);const d8=1e20;function id(a,i,c,h,g,y,b,S,P){for(let M=i;M<i+h;M++)sd(a,c*y+M,y,g,b,S,P);for(let M=c;M<c+g;M++)sd(a,M*y+i,1,h,b,S,P)}function sd(a,i,c,h,g,y,b){y[0]=0,b[0]=-1e20,b[1]=d8,g[0]=a[i];for(let S=1,P=0,M=0;S<h;S++){g[S]=a[i+S*c];const L=S*S;do{const F=y[P];M=(g[S]-g[F]+L-F*F)/(S-F)/2}while(M<=b[P]&&--P>-1);P++,y[P]=S,b[P]=M,b[P+1]=d8}for(let S=0,P=0;S<h;S++){for(;b[P+1]<S;)P++;const M=y[P],L=S-M;a[i+S*c]=g[M]+L*L}}const Z6={none:0,ideographs:1,all:2};class T4{constructor(i,c,h){this.requestManager=i,this.localGlyphMode=c,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,c){const h=[];for(const g in i)for(const y of i[g])h.push({stack:g,id:y});jo(h,({stack:g,id:y},b)=>{let S=this.entries[g];S||(S=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=S.glyphs[y];if(P!==void 0)return void b(null,{stack:g,id:y,glyph:P});if(P=this._tinySDF(S,g,y),P)return S.glyphs[y]=P,void b(null,{stack:g,id:y,glyph:P});const M=Math.floor(y/256);if(256*M>65535)return void b(new Error("glyphs > 65535 not supported"));if(S.ranges[M])return void b(null,{stack:g,id:y,glyph:P});let L=S.requests[M];L||(L=S.requests[M]=[],T4.loadGlyphRange(g,M,this.url,this.requestManager,(F,N)=>{if(N){S.ascender=N.ascender,S.descender=N.descender;for(const H in N.glyphs)this._doesCharSupportLocalGlyph(+H)||(S.glyphs[+H]=N.glyphs[+H]);S.ranges[M]=!0}for(const H of L)H(F,N);delete S.requests[M]})),L.push((F,N)=>{F?b(F):N&&b(null,{stack:g,id:y,glyph:N.glyphs[y]||null})})},(g,y)=>{if(g)c(g);else if(y){const b={};for(const{stack:S,id:P,glyph:M}of y)b[S]===void 0&&(b[S]={}),b[S].glyphs===void 0&&(b[S].glyphs={}),b[S].glyphs[P]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},b[S].ascender=this.entries[S].ascender,b[S].descender=this.entries[S].descender;c(null,b)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==Z6.none&&(this.localGlyphMode===Z6.all?!!this.localFontFamily:!!this.localFontFamily&&(ie(i)||be(i)||B(i)||j(i))||D(i))}_tinySDF(i,c,h){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(h))return;let y=i.tinySDF;if(!y){let J="400";/bold/i.test(c)?J="900":/medium/i.test(c)?J="500":/light/i.test(c)&&(J="200"),y=i.tinySDF=new T4.TinySDF({fontFamily:g,fontWeight:J,fontSize:48,buffer:6,radius:16}),y.fontWeight=J}if(this.localGlyphs[y.fontWeight][h])return this.localGlyphs[y.fontWeight][h];const b=String.fromCharCode(h),{data:S,width:P,height:M,glyphWidth:L,glyphHeight:F,glyphLeft:N,glyphTop:H,glyphAdvance:q}=y.draw(b);return this.localGlyphs[y.fontWeight][h]={id:h,bitmap:new Pi({width:P,height:M},S),metrics:{width:L/2,height:F/2,left:N/2,top:H/2-27,advance:q/2,localGlyph:!0}}}}function od(a,i,c,h){const g=[],y=a.image,b=y.pixelRatio,S=y.paddedRect.w-2,P=y.paddedRect.h-2,M=a.right-a.left,L=a.bottom-a.top,F=y.stretchX||[[0,S]],N=y.stretchY||[[0,P]],H=(mt,Lt)=>mt+Lt[1]-Lt[0],q=F.reduce(H,0),J=N.reduce(H,0),oe=S-q,me=P-J;let Ce=0,De=q,Ue=0,We=J,Xe=0,gt=oe,pt=0,zt=me;if(y.content&&h){const mt=y.content;Ce=p8(F,0,mt[0]),Ue=p8(N,0,mt[1]),De=p8(F,mt[0],mt[2]),We=p8(N,mt[1],mt[3]),Xe=mt[0]-Ce,pt=mt[1]-Ue,gt=mt[2]-mt[0]-De,zt=mt[3]-mt[1]-We}const Ot=(mt,Lt,Ut,wt)=>{const Zt=m8(mt.stretch-Ce,De,M,a.left),en=g8(mt.fixed-Xe,gt,mt.stretch,q),Yn=m8(Lt.stretch-Ue,We,L,a.top),Er=g8(Lt.fixed-pt,zt,Lt.stretch,J),Qn=m8(Ut.stretch-Ce,De,M,a.left),er=g8(Ut.fixed-Xe,gt,Ut.stretch,q),Mt=m8(wt.stretch-Ue,We,L,a.top),or=g8(wt.fixed-pt,zt,wt.stretch,J),nr=new O(Zt,Yn),ci=new O(Qn,Yn),Yr=new O(Qn,Mt),Bi=new O(Zt,Mt),Rs=new O(en/b,Er/b),ar=new O(er/b,or/b),qn=i*Math.PI/180;if(qn){const ni=Math.sin(qn),xi=Math.cos(qn),ms=[xi,-ni,ni,xi];nr._matMult(ms),ci._matMult(ms),Bi._matMult(ms),Yr._matMult(ms)}const Ur=mt.stretch+mt.fixed,ui=Lt.stretch+Lt.fixed;return{tl:nr,tr:ci,bl:Bi,br:Yr,tex:{x:y.paddedRect.x+1+Ur,y:y.paddedRect.y+1+ui,w:Ut.stretch+Ut.fixed-Ur,h:wt.stretch+wt.fixed-ui},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rs,pixelOffsetBR:ar,minFontScaleX:gt/b/M,minFontScaleY:zt/b/L,isSDF:c}};if(h&&(y.stretchX||y.stretchY)){const mt=ad(F,oe,q),Lt=ad(N,me,J);for(let Ut=0;Ut<mt.length-1;Ut++){const wt=mt[Ut],Zt=mt[Ut+1];for(let en=0;en<Lt.length-1;en++)g.push(Ot(wt,Lt[en],Zt,Lt[en+1]))}}else g.push(Ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:P+1}));return g}function p8(a,i,c){let h=0;for(const g of a)h+=Math.max(i,Math.min(c,g[1]))-Math.max(i,Math.min(c,g[0]));return h}function ad(a,i,c){const h=[{fixed:-1,stretch:0}];for(const[g,y]of a){const b=h[h.length-1];h.push({fixed:g-b.stretch,stretch:b.stretch}),h.push({fixed:g-b.stretch,stretch:b.stretch+(y-g)})}return h.push({fixed:i+1,stretch:c}),h}function m8(a,i,c,h){return a/i*c+h}function g8(a,i,c,h){return a-i*c/h}function Bb(a,i,c,h){const g=i+a.positionedLines[h].lineOffset;return h===0?c+g/2:c+(g+(i+a.positionedLines[h-1].lineOffset))/2}T4.loadGlyphRange=function(a,i,c,h,g){const y=256*i,b=y+255,S=h.transformRequest(h.normalizeGlyphsURL(c).replace("{fontstack}",a).replace("{range}",`${y}-${b}`),Nr.Glyphs);ws(S,(P,M)=>{if(P)g(P);else if(M){const L={},F=function(N){return new Bu(N).readFields(Mb,{})}(M);for(const N of F.glyphs)L[N.id]=N;g(null,{glyphs:L,ascender:F.ascender,descender:F.descender})}})},T4.TinySDF=class{constructor({fontSize:a=24,buffer:i=3,radius:c=8,cutoff:h=.25,fontFamily:g="sans-serif",fontWeight:y="normal",fontStyle:b="normal"}){this.buffer=i,this.cutoff=h,this.radius=c;const S=this.size=a+4*i,P=this._createCanvas(S),M=this.ctx=P.getContext("2d",{willReadFrequently:!0});M.font=`${b} ${y} ${a}px ${g}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(a){const i=document.createElement("canvas");return i.width=i.height=a,i}draw(a){const{width:i,actualBoundingBoxAscent:c,actualBoundingBoxDescent:h,actualBoundingBoxLeft:g,actualBoundingBoxRight:y}=this.ctx.measureText(a),b=Math.floor(c),S=Math.min(this.size-this.buffer,Math.ceil(y-g)),P=Math.min(this.size-this.buffer,Math.ceil(c)+Math.ceil(h)),M=S+2*this.buffer,L=P+2*this.buffer,F=M*L,N=new Uint8ClampedArray(F),H={data:N,width:M,height:L,glyphWidth:S,glyphHeight:P,glyphTop:b,glyphLeft:0,glyphAdvance:i};if(S===0||P===0)return H;const{ctx:q,buffer:J,gridInner:oe,gridOuter:me}=this;q.clearRect(J,J,S,P),q.fillText(a,J,J+b+1);const Ce=q.getImageData(J,J,S,P);me.fill(d8,0,F),oe.fill(0,0,F);for(let De=0;De<P;De++)for(let Ue=0;Ue<S;Ue++){const We=Ce.data[4*(De*S+Ue)+3]/255;if(We===0)continue;const Xe=(De+J)*M+Ue+J;if(We===1)me[Xe]=0,oe[Xe]=d8;else{const gt=.5-We;me[Xe]=gt>0?gt*gt:0,oe[Xe]=gt<0?gt*gt:0}}id(me,0,0,M,L,M,this.f,this.v,this.z),id(oe,J,J,S,P,M,this.f,this.v,this.z);for(let De=0;De<F;De++){const Ue=Math.sqrt(me[De])-Math.sqrt(oe[De]);N[De]=Math.round(255-255*(Ue/this.radius+this.cutoff))}return H}};class zb{constructor(i=[],c=Ub){if(this.data=i,this.length=this.data.length,this.compare=c,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:c,compare:h}=this,g=c[i];for(;i>0;){const y=i-1>>1,b=c[y];if(h(g,b)>=0)break;c[i]=b,i=y}c[i]=g}_down(i){const{data:c,compare:h}=this,g=this.length>>1,y=c[i];for(;i<g;){let b=1+(i<<1),S=c[b];const P=b+1;if(P<this.length&&h(c[P],S)<0&&(b=P,S=c[P]),h(S,y)>=0)break;c[i]=S,i=b}c[i]=y}}function Ub(a,i){return a<i?-1:a>i?1:0}function Vb(a,i=1,c=!1){let h=1/0,g=1/0,y=-1/0,b=-1/0;const S=a[0];for(let H=0;H<S.length;H++){const q=S[H];(!H||q.x<h)&&(h=q.x),(!H||q.y<g)&&(g=q.y),(!H||q.x>y)&&(y=q.x),(!H||q.y>b)&&(b=q.y)}const P=Math.min(y-h,b-g);let M=P/2;const L=new zb([],jb);if(P===0)return new O(h,g);for(let H=h;H<y;H+=P)for(let q=g;q<b;q+=P)L.push(new E4(H+M,q+M,M,a));let F=function(H){let q=0,J=0,oe=0;const me=H[0];for(let Ce=0,De=me.length,Ue=De-1;Ce<De;Ue=Ce++){const We=me[Ce],Xe=me[Ue],gt=We.x*Xe.y-Xe.x*We.y;J+=(We.x+Xe.x)*gt,oe+=(We.y+Xe.y)*gt,q+=3*gt}return new E4(J/q,oe/q,0,H)}(a),N=L.length;for(;L.length;){const H=L.pop();(H.d>F.d||!F.d)&&(F=H,c&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,N)),H.max-F.d<=i||(M=H.h/2,L.push(new E4(H.p.x-M,H.p.y-M,M,a)),L.push(new E4(H.p.x+M,H.p.y-M,M,a)),L.push(new E4(H.p.x-M,H.p.y+M,M,a)),L.push(new E4(H.p.x+M,H.p.y+M,M,a)),N+=4)}return c&&(console.log(`num probes: ${N}`),console.log(`best distance: ${F.d}`)),F.p}function jb(a,i){return i.max-a.max}function E4(a,i,c,h){this.p=new O(a,i),this.h=c,this.d=function(g,y){let b=!1,S=1/0;for(let P=0;P<y.length;P++){const M=y[P];for(let L=0,F=M.length,N=F-1;L<F;N=L++){const H=M[L],q=M[N];H.y>g.y!=q.y>g.y&&g.x<(q.x-H.x)*(g.y-H.y)/(q.y-H.y)+H.x&&(b=!b),S=Math.min(S,nc(g,H,q))}}return(b?1:-1)*Math.sqrt(S)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}const q6=Number.POSITIVE_INFINITY,$b=Math.sqrt(2);function ld(a,i){return i[1]!==q6?function(c,h,g){let y=0,b=0;switch(h=Math.abs(h),g=Math.abs(g),c){case"top-right":case"top-left":case"top":b=g-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-g}switch(c){case"top-right":case"bottom-right":case"right":y=-h;break;case"top-left":case"bottom-left":case"left":y=h}return[y,b]}(a,i[0],i[1]):function(c,h){let g=0,y=0;h<0&&(h=0);const b=h/$b;switch(c){case"top-right":case"top-left":y=b-7;break;case"bottom-right":case"bottom-left":y=7-b;break;case"bottom":y=7-h;break;case"top":y=h-7}switch(c){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=h;break;case"right":g=-h}return[g,y]}(a,i[0])}function Wb(a,i,c,h,g,y,b,S,P,M){a.createArrays(),a.tilePixelRatio=Vn/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const L=a.layers[0].layout,F=a.layers[0]._unevaluatedLayout._values,N={};if(a.textSizeData.kind==="composite"){const{minZoom:J,maxZoom:oe}=a.textSizeData;N.compositeTextSizes=[F["text-size"].possiblyEvaluate(new gn(J),S),F["text-size"].possiblyEvaluate(new gn(oe),S)]}if(a.iconSizeData.kind==="composite"){const{minZoom:J,maxZoom:oe}=a.iconSizeData;N.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new gn(J),S),F["icon-size"].possiblyEvaluate(new gn(oe),S)]}N.layoutTextSize=F["text-size"].possiblyEvaluate(new gn(P+1),S),N.layoutIconSize=F["icon-size"].possiblyEvaluate(new gn(P+1),S),N.textMaxSize=F["text-size"].possiblyEvaluate(new gn(18),S);const H=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",q=L.get("text-size");for(const J of a.features){const oe=L.get("text-font").evaluate(J,{},S).join(","),me=q.evaluate(J,{},S),Ce=N.layoutTextSize.evaluate(J,{},S),De=(N.layoutIconSize.evaluate(J,{},S),{horizontal:{},vertical:void 0}),Ue=J.text;let We,Xe=[0,0];if(Ue){const zt=Ue.toString(),Ot=L.get("text-letter-spacing").evaluate(J,{},S)*ps,mt=L.get("text-line-height").evaluate(J,{},S)*ps,Lt=it(zt)?Ot:0,Ut=L.get("text-anchor").evaluate(J,{},S),wt=L.get("text-variable-anchor");if(!wt){const er=L.get("text-radial-offset").evaluate(J,{},S);Xe=er?ld(Ut,[er*ps,q6]):L.get("text-offset").evaluate(J,{},S).map(Mt=>Mt*ps)}let Zt=H?"center":L.get("text-justify").evaluate(J,{},S);const en=L.get("symbol-placement"),Yn=en==="point",Er=en==="point"?L.get("text-max-width").evaluate(J,{},S)*ps:0,Qn=er=>{a.allowVerticalPlacement&&ut(zt)&&(De.vertical=W6(Ue,i,c,g,oe,Er,mt,Ut,er,Lt,Xe,ua.vertical,!0,en,Ce,me))};if(!H&&wt){const er=Zt==="auto"?wt.map(or=>G6(or)):[Zt];let Mt=!1;for(let or=0;or<er.length;or++){const nr=er[or];if(!De.horizontal[nr])if(Mt)De.horizontal[nr]=De.horizontal[0];else{const ci=W6(Ue,i,c,g,oe,Er,mt,"center",nr,Lt,Xe,ua.horizontal,!1,en,Ce,me);ci&&(De.horizontal[nr]=ci,Mt=ci.positionedLines.length===1)}}Qn("left")}else{if(Zt==="auto"&&(Zt=G6(Ut)),Yn||L.get("text-writing-mode").indexOf("horizontal")>=0||!ut(zt)){const er=W6(Ue,i,c,g,oe,Er,mt,Ut,Zt,Lt,Xe,ua.horizontal,!1,en,Ce,me);er&&(De.horizontal[Zt]=er)}Qn(en==="point"?"left":Zt)}}let gt=!1;if(J.icon&&J.icon.name){const zt=h[J.icon.name];zt&&(We=Lb(g[J.icon.name],L.get("icon-offset").evaluate(J,{},S),L.get("icon-anchor").evaluate(J,{},S)),gt=zt.sdf,a.sdfIcons===void 0?a.sdfIcons=zt.sdf:a.sdfIcons!==zt.sdf&&gr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(zt.pixelRatio!==a.pixelRatio||L.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}const pt=ud(De.horizontal)||De.vertical;a.iconsInText||(a.iconsInText=!!pt&&pt.iconsInText),(pt||We)&&Hb(a,J,De,We,h,N,Ce,0,Xe,gt,b,S,M)}y&&a.generateCollisionDebugBuffers(P,a.collisionBoxArray)}function G6(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Hb(a,i,c,h,g,y,b,S,P,M,L,F,N){let H=y.textMaxSize.evaluate(i,{},F);H===void 0&&(H=b);const q=a.layers[0].layout,J=q.get("icon-offset").evaluate(i,{},F),oe=ud(c.horizontal)||c.vertical,me=b/24,Ce=a.tilePixelRatio*H/24,De=a.tilePixelRatio*q.get("symbol-spacing"),Ue=q.get("text-padding")*a.tilePixelRatio,We=q.get("icon-padding")*a.tilePixelRatio,Xe=Ht(q.get("text-max-angle")),gt=q.get("text-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",pt=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",zt=q.get("symbol-placement"),Ot=De/2,mt=q.get("icon-text-fit");let Lt;h&&mt!=="none"&&(a.allowVerticalPlacement&&c.vertical&&(Lt=Kf(h,c.vertical,mt,q.get("icon-text-fit-padding"),J,me)),oe&&(h=Kf(h,oe,mt,q.get("icon-text-fit-padding"),J,me)));const Ut=(wt,Zt,en)=>{if(Zt.x<0||Zt.x>=Vn||Zt.y<0||Zt.y>=Vn)return;const{x:Yn,y:Er,z:Qn}=N.projectTilePoint(Zt.x,Zt.y,en),er=new uc(Yn,Er,Qn,0,void 0);(function(Mt,or,nr,ci,Yr,Bi,Rs,ar,qn,Ur,ui,ni,xi,ms,go,_o,Dr,zi,za,is,xr,Ui,Vr,ks,Ii){const Os=Mt.addToLineVertexArray(or,ci);let qs,Gs,Vi,Sl,P4,Hu,Xu,Hd=0,Xd=0,Zd=0,qd=0,p5=-1,m5=-1;const m1={};let Gd=Xc(""),g5=0,_5=0;if(qn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[g5,_5]=qn.layout.get("text-offset").evaluate(xr,{},Ii).map(zo=>zo*ps):(g5=qn.layout.get("text-radial-offset").evaluate(xr,{},Ii)*ps,_5=q6),Mt.allowVerticalPlacement&&Yr.vertical){const zo=Yr.vertical;if(go)Hu=Y6(zo),ar&&(Xu=Y6(ar));else{const Uo=qn.layout.get("text-rotate").evaluate(xr,{},Ii)+90;Vi=_8(Ur,nr,or,ui,ni,xi,zo,ms,Uo,_o),ar&&(Sl=_8(Ur,nr,or,ui,ni,xi,ar,zi,Uo))}}if(Bi){const zo=qn.layout.get("icon-rotate").evaluate(xr,{},Ii),Uo=qn.layout.get("icon-text-fit")!=="none",Zu=od(Bi,zo,Vr,Uo),v5=ar?od(ar,zo,Vr,Uo):void 0;Gs=_8(Ur,nr,or,ui,ni,xi,Bi,zi,zo),Hd=4*Zu.length;const Yd=Mt.iconSizeData;let S0=null;Yd.kind==="source"?(S0=[h1*qn.layout.get("icon-size").evaluate(xr,{},Ii)],S0[0]>r3&&gr(`${Mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Yd.kind==="composite"&&(S0=[h1*Ui.compositeIconSizes[0].evaluate(xr,{},Ii),h1*Ui.compositeIconSizes[1].evaluate(xr,{},Ii)],(S0[0]>r3||S0[1]>r3)&&gr(`${Mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Mt.addSymbols(Mt.icon,Zu,S0,is,za,xr,!1,nr,or,Os.lineStartIndex,Os.lineLength,-1,ks,Ii),p5=Mt.icon.placedSymbolArray.length-1,v5&&(Xd=4*v5.length,Mt.addSymbols(Mt.icon,v5,S0,is,za,xr,ua.vertical,nr,or,Os.lineStartIndex,Os.lineLength,-1,ks,Ii),m5=Mt.icon.placedSymbolArray.length-1)}for(const zo in Yr.horizontal){const Uo=Yr.horizontal[zo];qs||(Gd=Xc(Uo.text),go?P4=Y6(Uo):qs=_8(Ur,nr,or,ui,ni,xi,Uo,ms,qn.layout.get("text-rotate").evaluate(xr,{},Ii),_o));const Zu=Uo.positionedLines.length===1;if(Zd+=cd(Mt,nr,or,Uo,Rs,qn,go,xr,_o,Os,Yr.vertical?ua.horizontal:ua.horizontalOnly,Zu?Object.keys(Yr.horizontal):[zo],m1,p5,Ui,ks,Ii),Zu)break}Yr.vertical&&(qd+=cd(Mt,nr,or,Yr.vertical,Rs,qn,go,xr,_o,Os,ua.vertical,["vertical"],m1,m5,Ui,ks,Ii));let l3=-1;const y5=(zo,Uo)=>zo?Math.max(zo,Uo):Uo;l3=y5(P4,l3),l3=y5(Hu,l3),l3=y5(Xu,l3);const xw=l3>-1?1:0;Mt.glyphOffsetArray.length>=i3.MAX_GLYPHS&&gr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xr.sortKey!==void 0&&Mt.addToSortKeyRanges(Mt.symbolInstances.length,xr.sortKey),Mt.symbolInstances.emplaceBack(nr.x,nr.y,nr.z,or.x,or.y,m1.right>=0?m1.right:-1,m1.center>=0?m1.center:-1,m1.left>=0?m1.left:-1,m1.vertical>=0?m1.vertical:-1,p5,m5,Gd,qs!==void 0?qs:Mt.collisionBoxArray.length,qs!==void 0?qs+1:Mt.collisionBoxArray.length,Vi!==void 0?Vi:Mt.collisionBoxArray.length,Vi!==void 0?Vi+1:Mt.collisionBoxArray.length,Gs!==void 0?Gs:Mt.collisionBoxArray.length,Gs!==void 0?Gs+1:Mt.collisionBoxArray.length,Sl||Mt.collisionBoxArray.length,Sl?Sl+1:Mt.collisionBoxArray.length,ui,Zd,qd,Hd,Xd,xw,0,g5,_5,l3)})(a,Zt,er,wt,c,h,g,Lt,a.layers[0],a.collisionBoxArray,i.index,i.sourceLayerIndex,a.index,Ue,gt,P,0,We,pt,J,i,y,M,L,F)};if(zt==="line")for(const wt of rd(i.geometry,0,0,Vn,Vn)){const Zt=Nb(wt,De,Xe,c.vertical||oe,h,24,Ce,a.overscaling,Vn);for(const en of Zt){const Yn=oe;Yn&&Xb(a,Yn.text,Ot,en)||Ut(wt,en,F)}}else if(zt==="line-center"){for(const wt of i.geometry)if(wt.length>1){const Zt=Fb(wt,Xe,c.vertical||oe,h,24,Ce);Zt&&Ut(wt,Zt,F)}}else if(i.type==="Polygon")for(const wt of _0(i.geometry,0)){const Zt=Vb(wt,16);Ut(wt[0],new uc(Zt.x,Zt.y,0,0,void 0),F)}else if(i.type==="LineString")for(const wt of i.geometry)Ut(wt,new uc(wt[0].x,wt[0].y,0,0,void 0),F);else if(i.type==="Point")for(const wt of i.geometry)for(const Zt of wt)Ut([Zt],new uc(Zt.x,Zt.y,0,0,void 0),F)}const r3=32640;function cd(a,i,c,h,g,y,b,S,P,M,L,F,N,H,q,J,oe){const me=function(Ue,We,Xe,gt,pt,zt,Ot,mt){const Lt=[];if(We.positionedLines.length===0)return Lt;const Ut=gt.layout.get("text-rotate").evaluate(zt,{})*Math.PI/180,wt=function(Qn){const er=Qn[0],Mt=Qn[1],or=er*Mt;return or>0?[er,-Mt]:or<0?[-er,Mt]:er===0?[Mt,er]:[Mt,-er]}(Xe);let Zt=Math.abs(We.top-We.bottom);for(const Qn of We.positionedLines)Zt-=Qn.lineOffset;const en=We.positionedLines.length,Yn=Zt/en;let Er=We.top-Xe[1];for(let Qn=0;Qn<en;++Qn){const er=We.positionedLines[Qn];Er=Bb(We,Yn,Er,Qn);for(const Mt of er.positionedGlyphs){if(!Mt.rect)continue;const or=Mt.rect||{};let nr=4,ci=!0,Yr=1,Bi=0;if(Mt.imageName){const Vr=Ot[Mt.imageName];if(!Vr)continue;if(Vr.sdf){gr("SDF images are not supported in formatted text and will be ignored.");continue}ci=!1,Yr=Vr.pixelRatio,nr=1/Yr}const Rs=(pt||mt)&&Mt.vertical,ar=Mt.metrics.advance*Mt.scale/2,qn=Mt.metrics,Ur=Mt.rect;if(Ur===null)continue;mt&&We.verticalizable&&(Bi=Mt.imageName?ar-Mt.metrics.width*Mt.scale/2:0);const ui=pt?[Mt.x+ar,Mt.y]:[0,0];let ni=[0,0],xi=[0,0],ms=!1;pt||(Rs?(xi=[Mt.x+ar+wt[0],Mt.y+wt[1]-Bi],ms=!0):ni=[Mt.x+ar+Xe[0],Mt.y+Xe[1]-Bi]);const go=Ur.w*Mt.scale/(Yr*(Mt.localGlyph?2:1)),_o=Ur.h*Mt.scale/(Yr*(Mt.localGlyph?2:1));let Dr,zi,za,is;if(Rs){const Vr=Mt.y-Er,ks=new O(-ar,ar-Vr),Ii=-Math.PI/2,Os=new O(...xi);Dr=new O(-ar+ni[0],ni[1]),Dr._rotateAround(Ii,ks)._add(Os),Dr.x+=-Vr+ar,Dr.y-=(qn.left-nr)*Mt.scale;const qs=Mt.imageName?qn.advance*Mt.scale:ps*Mt.scale,Gs=String.fromCharCode(Mt.glyph);vb(Gs)?Dr.x+=(1-nr)*Mt.scale:xb(Gs)?Dr.x+=qs-qn.height*Mt.scale+(-nr-1)*Mt.scale:Dr.x+=Mt.imageName||qn.width+2*nr===Ur.w&&qn.height+2*nr===Ur.h?(qs-_o)/2:(qs-(qn.height+2*nr)*Mt.scale)/2,zi=new O(Dr.x,Dr.y-go),za=new O(Dr.x+_o,Dr.y),is=new O(Dr.x+_o,Dr.y-go)}else{const Vr=(qn.left-nr)*Mt.scale-ar+ni[0],ks=(-qn.top-nr)*Mt.scale+ni[1],Ii=Vr+go,Os=ks+_o;Dr=new O(Vr,ks),zi=new O(Ii,ks),za=new O(Vr,Os),is=new O(Ii,Os)}if(Ut){let Vr;Vr=pt?new O(0,0):ms?new O(wt[0],wt[1]):new O(Xe[0],Xe[1]),Dr._rotateAround(Ut,Vr),zi._rotateAround(Ut,Vr),za._rotateAround(Ut,Vr),is._rotateAround(Ut,Vr)}const xr=new O(0,0),Ui=new O(0,0);Lt.push({tl:Dr,tr:zi,bl:za,br:is,tex:or,writingMode:We.writingMode,glyphOffset:ui,sectionIndex:Mt.sectionIndex,isSDF:ci,pixelOffsetTL:xr,pixelOffsetBR:Ui,minFontScaleX:0,minFontScaleY:0})}}return Lt}(0,h,P,y,b,S,g,a.allowVerticalPlacement),Ce=a.textSizeData;let De=null;Ce.kind==="source"?(De=[h1*y.layout.get("text-size").evaluate(S,{},oe)],De[0]>r3&&gr(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Ce.kind==="composite"&&(De=[h1*q.compositeTextSizes[0].evaluate(S,{},oe),h1*q.compositeTextSizes[1].evaluate(S,{},oe)],(De[0]>r3||De[1]>r3)&&gr(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,me,De,P,b,S,L,i,c,M.lineStartIndex,M.lineLength,H,J,oe);for(const Ue of F)N[Ue]=a.text.placedSymbolArray.length-1;return 4*me.length}function ud(a){for(const i in a)return a[i];return null}function _8(a,i,c,h,g,y,b,S,P,M){let L=b.top,F=b.bottom,N=b.left,H=b.right;const q=b.collisionPadding;if(q&&(N-=q[0],L-=q[1],H+=q[2],F+=q[3]),P){const J=new O(N,L),oe=new O(H,L),me=new O(N,F),Ce=new O(H,F),De=Ht(P);let Ue=new O(0,0);M&&(Ue=new O(M[0],M[1])),J._rotateAround(De,Ue),oe._rotateAround(De,Ue),me._rotateAround(De,Ue),Ce._rotateAround(De,Ue),N=Math.min(J.x,oe.x,me.x,Ce.x),H=Math.max(J.x,oe.x,me.x,Ce.x),L=Math.min(J.y,oe.y,me.y,Ce.y),F=Math.max(J.y,oe.y,me.y,Ce.y)}return a.emplaceBack(i.x,i.y,i.z,c.x,c.y,N,L,H,F,S,h,g,y),a.length-1}function Y6(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const i=a.bottom-a.top;return i>0?Math.max(10,i):null}function Xb(a,i,c,h){const g=a.compareText;if(i in g){const y=g[i];for(let b=y.length-1;b>=0;b--)if(h.dist(y[b])<c)return!0}else g[i]=[];return g[i].push(h),!1}const Zb=w.VectorTileFeature.types,qb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function y8(a,i,c,h,g,y,b,S,P,M,L,F,N,H,q,J){const oe=L?Math.min(r3,Math.round(L[0])):0,me=L?Math.min(r3,Math.round(L[1])):0;a.emplaceBack(i,c,Math.round(32*b),Math.round(32*S),P,M,(oe<<1)+(F?1:0),me,16*N,16*H,256*q,256*J,h,g,y,0)}function K6(a,i,c){a.emplaceBack(i.x,i.y,c),a.emplaceBack(i.x,i.y,c),a.emplaceBack(i.x,i.y,c),a.emplaceBack(i.x,i.y,c)}function Gb(a){for(const i of a.sections)if(Rt(i.text))return!0;return!1}class J6{constructor(i){this.layoutVertexArray=new dl,this.indexArray=new $s,this.programConfigurations=i,this.segments=new Gr,this.dynamicLayoutVertexArray=new Ci,this.opacityVertexArray=new pl,this.placedSymbolArray=new yu}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,c,h,g){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,jn.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,u1.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,qb,!0),this.opacityVertexBuffer.itemSize=1),(h||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Xt("SymbolBuffers",J6);class Q6{constructor(i,c,h){this.layoutVertexArray=new i,this.layoutAttributes=c,this.indexArray=new h,this.segments=new Gr,this.collisionVertexArray=new i4,this.collisionVertexArrayExt=new Ci}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,z6.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,mb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xt("CollisionBuffers",Q6);class i3{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(b=>b.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ee([]),this.placementViewportMatrix=Ee([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=U6(this.zoom,c["text-size"]),this.iconSizeData=U6(this.zoom,c["icon-size"]);const h=this.layers[0].layout,g=h.get("symbol-sort-key"),y=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(b=>ua[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=i.sourceID}createArrays(){this.text=new J6(new aa(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new J6(new aa(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new u4,this.lineVertexArray=new n0,this.symbolInstances=new H2}calculateGlyphDependencies(i,c,h,g,y){for(let b=0;b<i.length;b++)if(c[i.charCodeAt(b)]=!0,g&&y){const S=Nu[i.charAt(b)];S&&(c[S.charCodeAt(0)]=!0)}}populate(i,c,h,g){const y=this.layers[0],b=y.layout,S=b.get("text-font"),P=b.get("text-field"),M=b.get("icon-image"),L=(P.value.kind!=="constant"||P.value.value instanceof An&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),F=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,N=b.get("symbol-sort-key");if(this.features=[],!L&&!F)return;const H=c.iconDependencies,q=c.glyphDependencies,J=c.availableImages,oe=new gn(this.zoom);for(const{feature:me,id:Ce,index:De,sourceLayerIndex:Ue}of i){const We=y._featureFilter.needGeometry,Xe=gl(me,We);if(!y._featureFilter.filter(oe,Xe,h))continue;let gt,pt;if(We||(Xe.geometry=Ms(me,h,g)),L){const Ot=y.getValueAndResolveTokens("text-field",Xe,h,J),mt=An.factory(Ot);Gb(mt)&&(this.hasRTLText=!0),(!this.hasRTLText||Ni()==="unavailable"||this.hasRTLText&&$n.isParsed())&&(gt=yb(mt,y,Xe))}if(F){const Ot=y.getValueAndResolveTokens("icon-image",Xe,h,J);pt=Ot instanceof Ki?Ot:Ki.fromString(Ot)}if(!gt&&!pt)continue;const zt=this.sortFeaturesByKey?N.evaluate(Xe,{},h):void 0;if(this.features.push({id:Ce,text:gt,icon:pt,index:De,sourceLayerIndex:Ue,geometry:Xe.geometry,properties:me.properties,type:Zb[me.type],sortKey:zt}),pt&&(H[pt.name]=!0),gt){const Ot=S.evaluate(Xe,{},h).join(","),mt=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ua.vertical)>=0;for(const Lt of gt.sections)if(Lt.image)H[Lt.image.name]=!0;else{const Ut=ut(gt.toString()),wt=Lt.fontStack||Ot,Zt=q[wt]=q[wt]||{};this.calculateGlyphDependencies(Lt.text,Zt,mt,this.allowVerticalPlacement,Ut)}}}b.get("symbol-placement")==="line"&&(this.features=function(me){const Ce={},De={},Ue=[];let We=0;function Xe(Ot){Ue.push(me[Ot]),We++}function gt(Ot,mt,Lt){const Ut=De[Ot];return delete De[Ot],De[mt]=Ut,Ue[Ut].geometry[0].pop(),Ue[Ut].geometry[0]=Ue[Ut].geometry[0].concat(Lt[0]),Ut}function pt(Ot,mt,Lt){const Ut=Ce[mt];return delete Ce[mt],Ce[Ot]=Ut,Ue[Ut].geometry[0].shift(),Ue[Ut].geometry[0]=Lt[0].concat(Ue[Ut].geometry[0]),Ut}function zt(Ot,mt,Lt){const Ut=Lt?mt[0][mt[0].length-1]:mt[0][0];return`${Ot}:${Ut.x}:${Ut.y}`}for(let Ot=0;Ot<me.length;Ot++){const mt=me[Ot],Lt=mt.geometry,Ut=mt.text?mt.text.toString():null;if(!Ut){Xe(Ot);continue}const wt=zt(Ut,Lt),Zt=zt(Ut,Lt,!0);if(wt in De&&Zt in Ce&&De[wt]!==Ce[Zt]){const en=pt(wt,Zt,Lt),Yn=gt(wt,Zt,Ue[en].geometry);delete Ce[wt],delete De[Zt],De[zt(Ut,Ue[Yn].geometry,!0)]=Yn,Ue[en].geometry=null}else wt in De?gt(wt,Zt,Lt):Zt in Ce?pt(wt,Zt,Lt):(Xe(Ot),Ce[wt]=We-1,De[Zt]=We-1)}return Ue.filter(Ot=>Ot.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((me,Ce)=>me.sortKey-Ce.sortKey)}update(i,c,h,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,c,this.layers,h,g),this.icon.programConfigurations.updatePaintArrays(i,c,this.layers,h,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,c){const h=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(c[i.segment+1]),y=i.dist(c[i.segment]);const b={};for(let S=i.segment+1;S<c.length;S++)b[S]={x:c[S].x,y:c[S].y,tileUnitDistanceFromAnchor:g},S<c.length-1&&(g+=c[S+1].dist(c[S]));for(let S=i.segment||0;S>=0;S--)b[S]={x:c[S].x,y:c[S].y,tileUnitDistanceFromAnchor:y},S>0&&(y+=c[S-1].dist(c[S]));for(let S=0;S<c.length;S++){const P=b[S];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,c,h,g,y,b,S,P,M,L,F,N,H,q){const J=i.indexArray,oe=i.layoutVertexArray,me=i.segments.prepareSegment(4*c.length,oe,J,this.canOverlap?b.sortKey:void 0),Ce=this.glyphOffsetArray.length,De=me.vertexLength,Ue=this.allowVerticalPlacement&&S===ua.vertical?Math.PI/2:0,We=b.text&&b.text.sections;for(let Xe=0;Xe<c.length;Xe++){const{tl:gt,tr:pt,bl:zt,br:Ot,tex:mt,pixelOffsetTL:Lt,pixelOffsetBR:Ut,minFontScaleX:wt,minFontScaleY:Zt,glyphOffset:en,isSDF:Yn,sectionIndex:Er}=c[Xe],Qn=me.vertexLength,er=en[1];y8(oe,P.x,P.y,P.z,M.x,M.y,gt.x,er+gt.y,mt.x,mt.y,h,Yn,Lt.x,Lt.y,wt,Zt),y8(oe,P.x,P.y,P.z,M.x,M.y,pt.x,er+pt.y,mt.x+mt.w,mt.y,h,Yn,Ut.x,Lt.y,wt,Zt),y8(oe,P.x,P.y,P.z,M.x,M.y,zt.x,er+zt.y,mt.x,mt.y+mt.h,h,Yn,Lt.x,Ut.y,wt,Zt),y8(oe,P.x,P.y,P.z,M.x,M.y,Ot.x,er+Ot.y,mt.x+mt.w,mt.y+mt.h,h,Yn,Ut.x,Ut.y,wt,Zt),K6(i.dynamicLayoutVertexArray,P,Ue),J.emplaceBack(Qn,Qn+1,Qn+2),J.emplaceBack(Qn+1,Qn+2,Qn+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(en[0]),Xe!==c.length-1&&Er===c[Xe+1].sectionIndex||i.programConfigurations.populatePaintArrays(oe.length,b,b.index,{},H,q,We&&We[Er])}i.placedSymbolArray.emplaceBack(P.x,P.y,P.z,M.x,M.y,Ce,this.glyphOffsetArray.length-Ce,De,L,F,M.segment,h?h[0]:0,h?h[1]:0,g[0],g[1],S,0,!1,0,N,0)}_commitLayoutVertex(i,c,h,g,y,b,S){i.emplaceBack(c,h,g,y,b,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(i,c,h,g,y,b,S){const P=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),M=P.vertexLength,L=S.tileAnchorX,F=S.tileAnchorY;for(let H=0;H<4;H++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(c,-i.padding,-i.padding),h.collisionVertexArrayExt.emplaceBack(c,i.padding,-i.padding),h.collisionVertexArrayExt.emplaceBack(c,i.padding,i.padding),h.collisionVertexArrayExt.emplaceBack(c,-i.padding,i.padding),this._commitLayoutVertex(h.layoutVertexArray,g,y,b,L,F,new O(i.x1,i.y1)),this._commitLayoutVertex(h.layoutVertexArray,g,y,b,L,F,new O(i.x2,i.y1)),this._commitLayoutVertex(h.layoutVertexArray,g,y,b,L,F,new O(i.x2,i.y2)),this._commitLayoutVertex(h.layoutVertexArray,g,y,b,L,F,new O(i.x1,i.y2)),P.vertexLength+=4;const N=h.indexArray;N.emplaceBack(M,M+1),N.emplaceBack(M+1,M+2),N.emplaceBack(M+2,M+3),N.emplaceBack(M+3,M),P.primitiveLength+=4}_addTextDebugCollisionBoxes(i,c,h,g,y,b){for(let S=g;S<y;S++){const P=h.get(S),M=this.getSymbolInstanceTextSize(i,b,c,S);this._addCollisionDebugVertices(P,M,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(i,c,h,g,y,b){for(let S=g;S<y;S++){const P=h.get(S),M=this.getSymbolInstanceIconSize(i,c,S);this._addCollisionDebugVertices(P,M,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}generateCollisionDebugBuffers(i,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Q6(i1,Bf.members,Ia),this.iconCollisionBox=new Q6(i1,Bf.members,Ia);const h=v4(this.iconSizeData,i),g=v4(this.textSizeData,i);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(g,i,c,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(g,i,c,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,i,c,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,i,c,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(i,c,h,g){const y=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:g),b=u8(this.textSizeData,i,y)/ps;return this.tilePixelRatio*b}getSymbolInstanceIconSize(i,c,h){const g=this.icon.placedSymbolArray.get(h),y=u8(this.iconSizeData,i,g);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(i,c,h){i.emplaceBack(c,-h,-h),i.emplaceBack(c,h,-h),i.emplaceBack(c,h,h),i.emplaceBack(c,-h,h)}_updateTextDebugCollisionBoxes(i,c,h,g,y,b){for(let S=g;S<y;S++){const P=h.get(S),M=this.getSymbolInstanceTextSize(i,b,c,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,P.padding)}}_updateIconDebugCollisionBoxes(i,c,h,g,y){for(let b=g;b<y;b++){const S=h.get(b),P=this.getSymbolInstanceIconSize(i,c,b);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,P,S.padding)}}updateCollisionDebugBuffers(i,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=v4(this.iconSizeData,i),g=v4(this.textSizeData,i);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(g,i,c,b.textBoxStartIndex,b.textBoxEndIndex,b),this._updateTextDebugCollisionBoxes(g,i,c,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._updateIconDebugCollisionBoxes(h,i,c,b.iconBoxStartIndex,b.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(h,i,c,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,c,h,g,y,b,S,P,M){const L={};for(let F=c;F<h;F++){const N=i.get(F);L.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,padding:N.padding,projectedAnchorX:N.projectedAnchorX,projectedAnchorY:N.projectedAnchorY,projectedAnchorZ:N.projectedAnchorZ,tileAnchorX:N.tileAnchorX,tileAnchorY:N.tileAnchorY},L.textFeatureIndex=N.featureIndex;break}for(let F=g;F<y;F++){const N=i.get(F);L.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,padding:N.padding,projectedAnchorX:N.projectedAnchorX,projectedAnchorY:N.projectedAnchorY,projectedAnchorZ:N.projectedAnchorZ,tileAnchorX:N.tileAnchorX,tileAnchorY:N.tileAnchorY},L.verticalTextFeatureIndex=N.featureIndex;break}for(let F=b;F<S;F++){const N=i.get(F);L.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,padding:N.padding,projectedAnchorX:N.projectedAnchorX,projectedAnchorY:N.projectedAnchorY,projectedAnchorZ:N.projectedAnchorZ,tileAnchorX:N.tileAnchorX,tileAnchorY:N.tileAnchorY},L.iconFeatureIndex=N.featureIndex;break}for(let F=P;F<M;F++){const N=i.get(F);L.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,padding:N.padding,projectedAnchorX:N.projectedAnchorX,projectedAnchorY:N.projectedAnchorY,projectedAnchorZ:N.projectedAnchorZ,tileAnchorX:N.tileAnchorX,tileAnchorY:N.tileAnchorY},L.verticalIconFeatureIndex=N.featureIndex;break}return L}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const h=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,c){const h=i.placedSymbolArray.get(c),g=h.vertexStartIndex+4*h.numGlyphs;for(let y=h.vertexStartIndex;y<g;y+=4)i.indexArray.emplaceBack(y,y+1,y+2),i.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(i),h=Math.cos(i),g=[],y=[],b=[];for(let S=0;S<this.symbolInstances.length;++S){b.push(S);const P=this.symbolInstances.get(S);g.push(0|Math.round(c*P.tileAnchorX+h*P.tileAnchorY)),y.push(P.featureIndex)}return b.sort((S,P)=>g[S]-g[P]||y[P]-y[S]),b}addToSortKeyRanges(i,c){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===c?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const h=this.symbolInstances.get(c);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((g,y,b)=>{g>=0&&b.indexOf(g)===y&&this.addIndicesForPlacedSymbol(this.text,g)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Xt("SymbolBucket",i3,{omit:["layers","collisionBoxArray","features","compareText"]}),i3.MAX_GLYPHS=65535,i3.addDynamicAttributes=K6;const Yb=new Hr({"symbol-placement":new Gt(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Gt(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Gt(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new an(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Gt(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Gt(ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Gt(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Gt(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Gt(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new an(ge.layout_symbol["icon-size"]),"icon-text-fit":new Gt(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gt(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new an(ge.layout_symbol["icon-image"]),"icon-rotate":new an(ge.layout_symbol["icon-rotate"]),"icon-padding":new Gt(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Gt(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new an(ge.layout_symbol["icon-offset"]),"icon-anchor":new an(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Gt(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Gt(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Gt(ge.layout_symbol["text-rotation-alignment"]),"text-field":new an(ge.layout_symbol["text-field"]),"text-font":new an(ge.layout_symbol["text-font"]),"text-size":new an(ge.layout_symbol["text-size"]),"text-max-width":new an(ge.layout_symbol["text-max-width"]),"text-line-height":new an(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new an(ge.layout_symbol["text-letter-spacing"]),"text-justify":new an(ge.layout_symbol["text-justify"]),"text-radial-offset":new an(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Gt(ge.layout_symbol["text-variable-anchor"]),"text-anchor":new an(ge.layout_symbol["text-anchor"]),"text-max-angle":new Gt(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Gt(ge.layout_symbol["text-writing-mode"]),"text-rotate":new an(ge.layout_symbol["text-rotate"]),"text-padding":new Gt(ge.layout_symbol["text-padding"]),"text-keep-upright":new Gt(ge.layout_symbol["text-keep-upright"]),"text-transform":new an(ge.layout_symbol["text-transform"]),"text-offset":new an(ge.layout_symbol["text-offset"]),"text-allow-overlap":new Gt(ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Gt(ge.layout_symbol["text-ignore-placement"]),"text-optional":new Gt(ge.layout_symbol["text-optional"])});var e5={paint:new Hr({"icon-opacity":new an(ge.paint_symbol["icon-opacity"]),"icon-color":new an(ge.paint_symbol["icon-color"]),"icon-halo-color":new an(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new an(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new an(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Gt(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Gt(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new an(ge.paint_symbol["text-opacity"]),"text-color":new an(ge.paint_symbol["text-color"],{runtimeType:Ns,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new an(ge.paint_symbol["text-halo-color"]),"text-halo-width":new an(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new an(ge.paint_symbol["text-halo-blur"]),"text-translate":new Gt(ge.paint_symbol["text-translate"]),"text-translate-anchor":new Gt(ge.paint_symbol["text-translate-anchor"])}),layout:Yb};class hd{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Ko,this.defaultValue=i}evaluate(i){if(i.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(i.formattedSection))return c.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xt("FormatSectionOverride",hd,{omit:["defaultValue"]});class v8 extends Lo{constructor(i){super(i,e5)}recalculate(i,c){super.recalculate(i,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const g=[];for(const y of h)g.indexOf(y)<0&&g.push(y);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,c,h,g){const y=this.layout.get(i).evaluate(c,{},h,g),b=this._unevaluatedLayout._values[i];return b.isDataDriven()||rl(b.value)||!y?y:function(S,P){return P.replace(/{([^{}]+)}/g,(M,L)=>L in S?String(S[L]):"")}(c.properties,y)}createBucket(i){return new i3(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of e5.paint.overridableProperties){if(!v8.hasPaintOverride(this.layout,i))continue;const c=this.paint.get(i),h=new hd(c),g=new zc(h,c.property.specification);let y=null;y=c.value.kind==="constant"||c.value.kind==="source"?new ea("source",g):new Yl("composite",g,c.value.zoomStops,c.value._interpolationType),this.paint._values[i]=new zr(c.property,y,c.parameters)}}_handleOverridablePaintPropertyUpdate(i,c,h){return!(!this.layout||c.isDataDriven()||h.isDataDriven())&&v8.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,c){const h=i.get("text-field"),g=e5.paint.properties[c];let y=!1;const b=S=>{for(const P of S)if(g.overrides&&g.overrides.hasOverride(P))return void(y=!0)};if(h.value.kind==="constant"&&h.value.value instanceof An)b(h.value.value.sections);else if(h.value.kind==="source"){const S=M=>{y||(M instanceof Ji&&Br(M.value)===_a?b(M.value.sections):M instanceof Cs?b(M.sections):M.eachChild(S))},P=h.value;P._styleExpression&&S(P._styleExpression.expression)}return y}getProgramConfiguration(i){return new ka(this,i)}}var Kb={paint:new Hr({"background-color":new Gt(ge.paint_background["background-color"]),"background-pattern":new ko(ge.paint_background["background-pattern"]),"background-opacity":new Gt(ge.paint_background["background-opacity"])})},Jb={paint:new Hr({"raster-opacity":new Gt(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Gt(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Gt(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Gt(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Gt(ge.paint_raster["raster-saturation"]),"raster-contrast":new Gt(ge.paint_raster["raster-contrast"]),"raster-resampling":new Gt(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Gt(ge.paint_raster["raster-fade-duration"])})};class Qb extends Lo{constructor(i){super(i,{}),this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var ew={paint:new Hr({"sky-type":new Gt(ge.paint_sky["sky-type"]),"sky-atmosphere-sun":new Gt(ge.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Gt(ge.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Gt(ge.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Gt(ge.paint_sky["sky-gradient-radius"]),"sky-gradient":new Oo(ge.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Gt(ge.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Gt(ge.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Gt(ge.paint_sky["sky-opacity"])})};function t5(a,i,c){const h=Vt(0,0,1),g=Tn(yn());return function(y,b,S){S*=.5;var P=b[0],M=b[1],L=b[2],F=b[3],N=Math.sin(S),H=Math.cos(S);y[0]=P*H-L*N,y[1]=M*H+F*N,y[2]=L*H+P*N,y[3]=F*H-M*N}(g,g,c?-Ht(a)+Math.PI:Ht(a)),Qr(g,g,-Ht(i)),ot(h,h,g),rt(h,h)}const tw={circle:class extends Lo{constructor(a){super(a,yl)}createBucket(a){return new Gc(a)}queryRadius(a){const i=a;return ho("circle-radius",this,i)+ho("circle-stroke-width",this,i)+c1(this.paint.get("circle-translate"))}queryIntersectsFeature(a,i,c,h,g,y,b,S){const P=p4(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(i,c)+this.paint.get("circle-stroke-width").evaluate(i,c);return u0(a,h,y,b,S,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",P,M)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new ka(this,a)}},heatmap:class extends Lo{createBucket(a){return new Xs(a)}constructor(a){super(a,Jc),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=d0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return ho("heatmap-radius",this,a)}queryIntersectsFeature(a,i,c,h,g,y,b,S){const P=this.paint.get("heatmap-radius").evaluate(i,c);return u0(a,h,y,b,S,!0,!0,new O(0,0),P)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new ka(this,a)}},hillshade:class extends Lo{constructor(a){super(a,I6)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(a){return new ka(this,a)}},fill:class extends Lo{constructor(a){super(a,Lu)}getProgramIds(){const a=this.paint.get("fill-pattern"),i=a&&a.constantOr(1),c=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getProgramConfiguration(a){return new ka(this,a)}recalculate(a,i){super.recalculate(a,i);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new n3(a)}queryRadius(){return c1(this.paint.get("fill-translate"))}queryIntersectsFeature(a,i,c,h,g,y){return!a.queryGeometry.isAboveHorizon&&tc(Yc(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends Lo{constructor(a){super(a,ct)}createBucket(a){return new xe(a)}queryRadius(){return c1(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new ka(this,a)}queryIntersectsFeature(a,i,c,h,g,y,b,S,P){const M=p4(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),L=this.paint.get("fill-extrusion-height").evaluate(i,c),F=this.paint.get("fill-extrusion-base").evaluate(i,c),N=[0,0],H=S&&y.elevation,q=y.elevation?y.elevation.exaggeration():1;if(H){const me=a.tile.getBucket(this).centroidVertexArray,Ce=P+1;if(Ce<me.length){const De=me.get(Ce);N[0]=De.a_centroid_pos0,N[1]=De.a_centroid_pos1}}if(N[0]===0&&N[1]===1)return!1;const J=function(me,Ce,De,Ue,We,Xe,gt,pt,zt){return Xe?function(Ot,mt,Lt,Ut,wt,Zt,en,Yn,Er){const Qn=[],er=[],Mt=[0,0,0,1];for(const or of Ot){const nr=[],ci=[];for(const Yr of or){const Bi=Yr.x+Ut.x,Rs=Yr.y+Ut.y,ar=dn(Bi,Rs,mt,Lt,Zt,en,Yn,Er);Mt[0]=Bi,Mt[1]=Rs,Mt[2]=ar.base,Mt[3]=1,fn(Mt,Mt,wt),Mt[3]=Math.max(Mt[3],1e-5);const qn=Nt([Mt[0]/Mt[3],Mt[1]/Mt[3],Mt[2]/Mt[3]]);Mt[0]=Bi,Mt[1]=Rs,Mt[2]=ar.top,Mt[3]=1,fn(Mt,Mt,wt),Mt[3]=Math.max(Mt[3],1e-5);const Ur=Nt([Mt[0]/Mt[3],Mt[1]/Mt[3],Mt[2]/Mt[3]]);nr.push(qn),ci.push(Ur)}Qn.push(nr),er.push(ci)}return[Qn,er]}(me,Ce,De,Ue,We,Xe,gt,pt,zt):function(Ot,mt,Lt,Ut,wt){const Zt=[],en=[],Yn=wt[8]*mt,Er=wt[9]*mt,Qn=wt[10]*mt,er=wt[11]*mt,Mt=wt[8]*Lt,or=wt[9]*Lt,nr=wt[10]*Lt,ci=wt[11]*Lt;for(const Yr of Ot){const Bi=[],Rs=[];for(const ar of Yr){const qn=ar.x+Ut.x,Ur=ar.y+Ut.y,ui=wt[0]*qn+wt[4]*Ur+wt[12],ni=wt[1]*qn+wt[5]*Ur+wt[13],xi=wt[2]*qn+wt[6]*Ur+wt[14],ms=wt[3]*qn+wt[7]*Ur+wt[15],go=ui+Yn,_o=ni+Er,Dr=xi+Qn,zi=Math.max(ms+er,1e-5),za=ui+Mt,is=ni+or,xr=xi+nr,Ui=Math.max(ms+ci,1e-5),Vr=new O(go/zi,_o/zi);Vr.z=Dr/zi,Bi.push(Vr);const ks=new O(za/Ui,is/Ui);ks.z=xr/Ui,Rs.push(ks)}Zt.push(Bi),en.push(Rs)}return[Zt,en]}(me,Ce,De,Ue,We)}(h,F,L,M,b,H?S:null,N,q,y.center.lat),oe=a.queryGeometry;return function(me,Ce,De){let Ue=1/0;tc(De,Ce)&&(Ue=kn(De,Ce[0]));for(let We=0;We<Ce.length;We++){const Xe=Ce[We],gt=me[We];for(let pt=0;pt<Xe.length-1;pt++){const zt=Xe[pt],Ot=[zt,Xe[pt+1],gt[pt+1],gt[pt],zt];ec(De,Ot)&&(Ue=Math.min(Ue,kn(De,Ot)))}}return Ue!==1/0&&Ue}(J[0],J[1],oe.isPointQuery()?oe.screenBounds:oe.screenGeometry)}},line:class extends Lo{constructor(a){super(a,cn),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof M1,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,i){super.recalculate(a,i),this.paint._values["line-floorwidth"]=Ln.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Pt(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new ka(this,a)}queryRadius(a){const i=a,c=Zn(ho("line-width",this,i),ho("line-gap-width",this,i)),h=ho("line-offset",this,i);return c/2+Math.abs(h)+c1(this.paint.get("line-translate"))}queryIntersectsFeature(a,i,c,h,g,y){if(a.queryGeometry.isAboveHorizon)return!1;const b=Yc(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,a.pixelToTileUnitsFactor),S=a.pixelToTileUnitsFactor/2*Zn(this.paint.get("line-width").evaluate(i,c),this.paint.get("line-gap-width").evaluate(i,c)),P=this.paint.get("line-offset").evaluate(i,c);return P&&(h=function(M,L){const F=[],N=new O(0,0);for(let H=0;H<M.length;H++){const q=M[H],J=[];for(let oe=0;oe<q.length;oe++){const me=q[oe-1],Ce=q[oe],De=q[oe+1],Ue=oe===0?N:Ce.sub(me)._unit()._perp(),We=oe===q.length-1?N:De.sub(Ce)._unit()._perp(),Xe=Ue._add(We)._unit();Xe._mult(1/(Xe.x*We.x+Xe.y*We.y)),J.push(Xe._mult(L)._add(Ce))}F.push(J)}return F}(h,P*a.pixelToTileUnitsFactor)),function(M,L,F){for(let N=0;N<L.length;N++){const H=L[N];if(M.length>=3){for(let q=0;q<H.length;q++)if(_l(M,H[q]))return!0}if(Iu(M,H,F))return!0}return!1}(b,h,S)}isTileClipped(){return!0}},symbol:v8,background:class extends Lo{constructor(a){super(a,Kb)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Lo{constructor(a){super(a,Jb)}getProgramIds(){return["raster"]}},sky:class extends Lo{constructor(a){super(a,ew),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=d0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}}getCenter(a,i){const c=this.paint.get("sky-type");if(c==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),g=!h,y=a.style.light,b=y.properties.get("position");return g&&y.properties.get("anchor")==="viewport"&&gr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?t5(b.azimuthal,90-b.polar,i):t5(h[0],90-h[1],i)}if(c==="gradient"){const h=this.paint.get("sky-gradient-center");return t5(h[0],90-h[1],i)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:fd,HTMLCanvasElement:dd,HTMLVideoElement:pd,ImageData:md,ImageBitmap:x8}=V;class b8{constructor(i,c,h,g){this.context=i,this.format=h,this.texture=i.gl.createTexture(),this.update(c,g)}update(i,c,h){const{width:g,height:y}=i,{context:b}=this,{gl:S}=b;if(S.bindTexture(S.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!c||c.premultiply!==!1)),h||this.size&&this.size[0]===g&&this.size[1]===y){const{x:P,y:M}=h||{x:0,y:0};i instanceof fd||i instanceof dd||i instanceof pd||i instanceof md||x8&&i instanceof x8?S.texSubImage2D(S.TEXTURE_2D,0,P,M,S.RGBA,S.UNSIGNED_BYTE,i):S.texSubImage2D(S.TEXTURE_2D,0,P,M,g,y,S.RGBA,S.UNSIGNED_BYTE,i.data)}else this.size=[g,y],i instanceof fd||i instanceof dd||i instanceof pd||i instanceof md||x8&&i instanceof x8?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,i):S.texImage2D(S.TEXTURE_2D,0,this.format,g,y,0,this.format,S.UNSIGNED_BYTE,i.data);this.useMipmap=!!(c&&c.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&S.generateMipmap(S.TEXTURE_2D)}bind(i,c){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),i!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,i),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?i===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_NEAREST:i),this.filter=i),c!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,c),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class n5{constructor(i,c){this.width=i,this.height=c,this.nextRow=0,this.image=new Pi({width:i,height:c}),this.positions={},this.uploaded=!1}getDash(i,c){const h=this.getKey(i,c);return this.positions[h]}trim(){const i=this.width,c=this.height=Mi(this.nextRow);this.image.resize({width:i,height:c})}getKey(i,c){return i.join(",")+c}getDashRanges(i,c,h){const g=[];let y=i.length%2==1?-i[i.length-1]*h:0,b=i[0]*h,S=!0;g.push({left:y,right:b,isDash:S,zeroLength:i[0]===0});let P=i[0];for(let M=1;M<i.length;M++){S=!S;const L=i[M];y=P*h,P+=L,b=P*h,g.push({left:y,right:b,isDash:S,zeroLength:L===0})}return g}addRoundDash(i,c,h){const g=c/2;for(let y=-h;y<=h;y++){const b=this.width*(this.nextRow+h+y);let S=0,P=i[S];for(let M=0;M<this.width;M++){M/P.right>1&&(P=i[++S]);const L=Math.abs(M-P.left),F=Math.abs(M-P.right),N=Math.min(L,F);let H;const q=y/h*(g+1);if(P.isDash){const J=g-Math.abs(q);H=Math.sqrt(N*N+J*J)}else H=g-Math.sqrt(N*N+q*q);this.image.data[b+M]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(i,c){for(let P=i.length-1;P>=0;--P){const M=i[P],L=i[P+1];M.zeroLength?i.splice(P,1):L&&L.isDash===M.isDash&&(L.left=M.left,i.splice(P,1))}const h=i[0],g=i[i.length-1];h.isDash===g.isDash&&(h.left=g.left-this.width,g.right=h.right+this.width);const y=this.width*this.nextRow;let b=0,S=i[b];for(let P=0;P<this.width;P++){P/S.right>1&&(S=i[++b]);const M=Math.abs(P-S.left),L=Math.abs(P-S.right),F=Math.min(M,L);this.image.data[y+P]=Math.max(0,Math.min(255,(S.isDash?F:-F)+c+128))}}addDash(i,c){const h=this.getKey(i,c);if(this.positions[h])return this.positions[h];const g=c==="round",y=g?7:0,b=2*y+1;if(this.nextRow+b>this.height)return gr("LineAtlas out of space"),null;i.length===0&&i.push(1);let S=0;for(let L=0;L<i.length;L++)i[L]<0&&(gr("Negative value is found in line dasharray, replacing values with 0"),i[L]=0),S+=i[L];if(S!==0){const L=this.width/S,F=this.getDashRanges(i,this.width,L);g?this.addRoundDash(F,L,y):this.addRegularDash(F,c==="square"?.5*L:0)}const P=this.nextRow+y;this.nextRow+=b;const M={tl:[P,y],br:[S,0]};return this.positions[h]=M,M}}Xt("LineAtlas",n5);class nw{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const rw=V.performance;function gd(a){const i=a?a.url.toString():void 0;return rw.getEntriesByName(i)}class iw{constructor(){this.tasks={},this.taskQueue=[],io(["process"],this),this.invoker=new nw(this.process),this.nextId=0}add(i,c){const h=this.nextId++,g=function({type:y,isSymbolTile:b,zoom:S}){return S=S||0,y==="message"?0:y!=="maybePrepare"||b?y!=="parseTile"||b?y==="parseTile"&&b?300-S:y==="maybePrepare"&&b?400-S:500:200-S:100-S}(c);if(g===0){vs();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:i,metadata:c,priority:g,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){vs();try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const c=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let i=null,c=1/0;for(let g=0;g<this.taskQueue.length;g++){const y=this.tasks[this.taskQueue[g]];y.priority<c&&(c=y.priority,i=g)}if(i===null)return null;const h=this.taskQueue[i];return this.taskQueue.splice(i,1),h}remove(){this.invoker.remove()}}function _d(a,i,c){var h=2*Math.PI*6378137/256/Math.pow(2,c);return[a*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}class w8{constructor(i,c,h){this.z=i,this.x=c,this.y=h,this.key=Uu(0,i,i,c,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,c){const h=function(y,b,S){var P=_d(256*y,256*(b=Math.pow(2,S)-b-1),S),M=_d(256*(y+1),256*(b+1),S);return P[0]+","+P[1]+","+M[0]+","+M[1]}(this.x,this.y,this.z),g=function(y,b,S){let P,M="";for(let L=y;L>0;L--)P=1<<L-1,M+=(b&P?1:0)+(S&P?2:0);return M}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class r5{constructor(i,c){this.wrap=i,this.canonical=c,this.key=Uu(i,c.z,c.z,c.x,c.y)}}class mo{constructor(i,c,h,g,y){this.overscaledZ=i,this.wrap=c,this.canonical=new w8(h,+g,+y),this.key=c===0&&i===h?this.canonical.key:Uu(c,i,h,g,y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const c=this.canonical.z-i;return i>this.canonical.z?new mo(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new mo(i,this.wrap,i,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(i,c=!0){if(this.overscaledZ===i&&c)return this.key;if(i>this.canonical.z)return Uu(this.wrap*+c,i,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-i;return Uu(this.wrap*+c,i,i,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const c=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>c&&i.canonical.y===this.canonical.y>>c}children(i){if(this.overscaledZ>=i)return[new mo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,h=2*this.canonical.x,g=2*this.canonical.y;return[new mo(c,this.wrap,c,h,g),new mo(c,this.wrap,c,h+1,g),new mo(c,this.wrap,c,h,g+1),new mo(c,this.wrap,c,h+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new mo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new mo(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new r5(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Uu(a,i,c,h,g){const y=1<<Math.min(c,22);let b=y*(g%y)+h%y;return a&&c<22&&(b+=y*y*((a<0?-2*a-1:2*a)%(1<<2*(22-c)))),16*(32*b+c)+(i-c)}Xt("CanonicalTileID",w8),Xt("OverscaledTileID",mo,{omit:["projMatrix"]});class S4{constructor(i,c,h){this.func=i,this.mask=c,this.range=h}}S4.ReadOnly=!1,S4.ReadWrite=!0,S4.disabled=new S4(519,S4.ReadOnly,[0,1]);const i5=7680;class s5{constructor(i,c,h,g,y,b){this.test=i,this.ref=c,this.mask=h,this.fail=g,this.depthFail=y,this.pass=b}}s5.disabled=new s5({func:519,mask:0},0,0,i5,i5,i5);class f1{constructor(i,c,h){this.blendFunction=i,this.blendColor=c,this.mask=h}}f1.Replace=[1,0],f1.disabled=new f1(f1.Replace,Gn.transparent,[!1,!1,!1,!1]),f1.unblended=new f1(f1.Replace,Gn.transparent,[!0,!0,!0,!0]),f1.alphaBlended=new f1([1,771],Gn.transparent,[!0,!0,!0,!0]);const o5=1029,a5=2305;class El{constructor(i,c,h){this.enable=i,this.mode=c,this.frontFace=h}}El.disabled=new El(!1,o5,a5),El.backCCW=new El(!0,o5,a5),El.backCW=new El(!0,o5,2304),El.frontCW=new El(!0,1028,2304),El.frontCCW=new El(!0,1028,a5);class yd{constructor(i){this._stringToNumber={},this._numberToString=[];for(let c=0;c<i.length;c++){const h=i[c];this._stringToNumber[h]=c,this._numberToString[c]=h}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}class vd{constructor(i,c,h,g,y){this.type="Feature",this._vectorTileFeature=i,i._z=c,i._x=h,i._y=g,this.properties=i.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(i[c]=this[c]);return i}}class sw{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,c,h){const g=String(c);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][g]=this.stateChanges[i][g]||{},ur(this.stateChanges[i][g],h),this.deletedStates[i]===null){this.deletedStates[i]={};for(const y in this.state[i])y!==g&&(this.deletedStates[i][y]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][g]===null){this.deletedStates[i][g]={};for(const y in this.state[i][g])h[y]||(this.deletedStates[i][g][y]=null)}else for(const y in h)this.deletedStates[i]&&this.deletedStates[i][g]&&this.deletedStates[i][g][y]===null&&delete this.deletedStates[i][g][y]}removeFeatureState(i,c,h){if(this.deletedStates[i]===null)return;const g=String(c);if(this.deletedStates[i]=this.deletedStates[i]||{},h&&c!==void 0)this.deletedStates[i][g]!==null&&(this.deletedStates[i][g]=this.deletedStates[i][g]||{},this.deletedStates[i][g][h]=null);else if(c!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][g])for(h in this.deletedStates[i][g]={},this.stateChanges[i][g])this.deletedStates[i][g][h]=null;else this.deletedStates[i][g]=null;else this.deletedStates[i]=null}getState(i,c){const h=String(c),g=ur({},(this.state[i]||{})[h],(this.stateChanges[i]||{})[h]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const y=this.deletedStates[i][c];if(y===null)return{};for(const b in y)delete g[b]}return g}initializeTileState(i,c){i.setFeatureState(this.state,c)}coalesceChanges(i,c){const h={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const y={};for(const b in this.stateChanges[g])this.state[g][b]||(this.state[g][b]={}),ur(this.state[g][b],this.stateChanges[g][b]),y[b]=this.state[g][b];h[g]=y}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const y={};if(this.deletedStates[g]===null)for(const b in this.state[g])y[b]={},this.state[g][b]={};else for(const b in this.deletedStates[g]){if(this.deletedStates[g][b]===null)this.state[g][b]={};else for(const S of Object.keys(this.deletedStates[g][b]))delete this.state[g][b][S];y[b]=this.state[g][b]}h[g]=h[g]||{},ur(h[g],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const g in i)i[g].setFeatureState(h,c)}}class xd{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,c){const h=this.toIdx(i,c);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(i,c){return this.leaves[this.toIdx(i,c)]}toIdx(i,c){return c*this.size+i}}function bd(a,i,c,h){let g=0,y=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(h[b])<1e-15){if(c[b]<a[b]||c[b]>i[b])return null}else{const S=1/h[b];let P=(a[b]-c[b])*S,M=(i[b]-c[b])*S;if(P>M){const L=P;P=M,M=L}if(P>g&&(g=P),M<y&&(y=M),g>y)return null}return g}function wd(a,i,c,h,g,y,b,S,P,M,L){const F=h-a,N=g-i,H=y-c,q=b-a,J=S-i,oe=P-c,me=L[1]*oe-L[2]*J,Ce=L[2]*q-L[0]*oe,De=L[0]*J-L[1]*q,Ue=F*me+N*Ce+H*De;if(Math.abs(Ue)<1e-15)return null;const We=1/Ue,Xe=M[0]-a,gt=M[1]-i,pt=M[2]-c,zt=(Xe*me+gt*Ce+pt*De)*We;if(zt<0||zt>1)return null;const Ot=gt*H-pt*N,mt=pt*F-Xe*H,Lt=Xe*N-gt*F,Ut=(L[0]*Ot+L[1]*mt+L[2]*Lt)*We;return Ut<0||zt+Ut>1?null:(q*Ot+J*mt+oe*Lt)*We}function Td(a,i,c){return(a-i)/(c-i)}function Ed(a,i,c,h,g,y,b,S,P){const M=1<<c,L=y-h,F=b-g,N=(a+1)/M*L+h,H=(i+0)/M*F+g,q=(i+1)/M*F+g;S[0]=(a+0)/M*L+h,S[1]=H,P[0]=N,P[1]=q}class Sd{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(y){const b=Math.ceil(Math.log2(y.dim/8)),S=[];let P=Math.ceil(Math.pow(2,b));const M=1/P,L=(H,q,J,oe,me)=>{const Ce=oe?1:0,De=(H+1)*J-Ce,Ue=q*J,We=(q+1)*J-Ce;me[0]=H*J,me[1]=Ue,me[2]=De,me[3]=We};let F=new xd(P);const N=[];for(let H=0;H<P*P;H++){L(H%P,Math.floor(H/P),M,!1,N);const q=s3(N[0],N[1],y),J=s3(N[2],N[1],y),oe=s3(N[2],N[3],y),me=s3(N[0],N[3],y);F.minimums.push(Math.min(q,J,oe,me)),F.maximums.push(Math.max(q,J,oe,me)),F.leaves.push(1)}for(S.push(F),P/=2;P>=1;P/=2){const H=S[S.length-1];F=new xd(P);for(let q=0;q<P*P;q++){L(q%P,Math.floor(q/P),2,!0,N);const J=H.getElevation(N[0],N[1]),oe=H.getElevation(N[2],N[1]),me=H.getElevation(N[2],N[3]),Ce=H.getElevation(N[0],N[3]),De=H.isLeaf(N[0],N[1]),Ue=H.isLeaf(N[2],N[1]),We=H.isLeaf(N[2],N[3]),Xe=H.isLeaf(N[0],N[3]),gt=Math.min(J.min,oe.min,me.min,Ce.min),pt=Math.max(J.max,oe.max,me.max,Ce.max),zt=De&&Ue&&We&&Xe;F.maximums.push(pt),F.minimums.push(gt),F.leaves.push(pt-gt<=5&&zt?1:0)}S.push(F)}return S}(this.dem),h=c.length-1,g=c[h];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(c,0,0,h,0)}raycastRoot(i,c,h,g,y,b,S=1){return bd([i,c,-100],[h,g,this.maximums[0]*S],y,b)}raycast(i,c,h,g,y,b,S=1){if(!this.nodeCount)return null;const P=this.raycastRoot(i,c,h,g,y,b,S);if(P==null)return null;const M=[],L=[],F=[],N=[],H=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;H.length>0;){const{idx:q,t:J,nodex:oe,nodey:me,depth:Ce}=H.pop();if(this.leaves[q]){Ed(oe,me,Ce,i,c,h,g,F,N);const Ue=1<<Ce,We=(oe+0)/Ue,Xe=(oe+1)/Ue,gt=(me+0)/Ue,pt=(me+1)/Ue,zt=s3(We,gt,this.dem)*S,Ot=s3(Xe,gt,this.dem)*S,mt=s3(Xe,pt,this.dem)*S,Lt=s3(We,pt,this.dem)*S,Ut=wd(F[0],F[1],zt,N[0],F[1],Ot,N[0],N[1],mt,y,b),wt=wd(N[0],N[1],mt,F[0],N[1],Lt,F[0],F[1],zt,y,b),Zt=Math.min(Ut!==null?Ut:Number.MAX_VALUE,wt!==null?wt:Number.MAX_VALUE);if(Zt!==Number.MAX_VALUE)return Zt;{const en=ve([],y,b,J);if(Ad(zt,Ot,Lt,mt,Td(en[0],F[0],N[0]),Td(en[1],F[1],N[1]))>=en[2])return J}continue}let De=0;for(let Ue=0;Ue<this._siblingOffset.length;Ue++){Ed((oe<<1)+this._siblingOffset[Ue][0],(me<<1)+this._siblingOffset[Ue][1],Ce+1,i,c,h,g,F,N),F[2]=-100,N[2]=this.maximums[this.childOffsets[q]+Ue]*S;const We=bd(F,N,y,b);if(We!=null){const Xe=We;M[Ue]=Xe;let gt=!1;for(let pt=0;pt<De&&!gt;pt++)Xe>=M[L[pt]]&&(L.splice(pt,0,Ue),gt=!0);gt||(L[De]=Ue),De++}}for(let Ue=0;Ue<De;Ue++){const We=L[Ue];H.push({idx:this.childOffsets[q]+We,t:M[We],nodex:(oe<<1)+this._siblingOffset[We][0],nodey:(me<<1)+this._siblingOffset[We][1],depth:Ce+1})}}return null}_addNode(i,c,h){return this.minimums.push(i),this.maximums.push(c),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(i,c,h,g,y){if(i[g].isLeaf(c,h)===1)return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const b=g-1,S=i[b];let P,M=0;for(let L=0;L<this._siblingOffset.length;L++){const F=2*c+this._siblingOffset[L][0],N=2*h+this._siblingOffset[L][1],H=S.getElevation(F,N),q=S.isLeaf(F,N),J=this._addNode(H.min,H.max,q);q&&(M|=1<<L),P||(P=J)}for(let L=0;L<this._siblingOffset.length;L++)M&1<<L||this._construct(i,2*c+this._siblingOffset[L][0],2*h+this._siblingOffset[L][1],b,P+L)}}function Ad(a,i,c,h,g,y){return rr(rr(a,c,y),rr(i,h,y),g)}function s3(a,i,c){const h=c.dim,g=En(a*h-.5,0,h-1),y=En(i*h-.5,0,h-1),b=Math.floor(g),S=Math.floor(y),P=Math.min(b+1,h-1),M=Math.min(S+1,h-1);return Ad(c.get(b,S),c.get(P,S),c.get(b,M),c.get(P,M),g-b,y-S)}const Cd={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class T8{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,c,h,g=!1,y=!1){if(this.uid=i,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return gr(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const b=this.dim=c.height-2;if(this.data=new Uint32Array(c.data.buffer),this.encoding=h||"mapbox",this.borderReady=g,!g){for(let S=0;S<b;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(b,S)]=this.data[this._idx(b-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,b)]=this.data[this._idx(S,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],y&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Sd(this)}get(i,c,h=!1){const g=new Uint8Array(this.data.buffer);h&&(i=En(i,-1,this.dim),c=En(c,-1,this.dim));const y=4*this._idx(i,c);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(g[y],g[y+1],g[y+2])}static getUnpackVector(i){return Cd[i]}get unpackVector(){return Cd[this.encoding]}_idx(i,c){if(i<-1||i>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(i+1)}_unpackMapbox(i,c,h){return(256*i*256+256*c+h)/10-1e4}_unpackTerrarium(i,c,h){return 256*i+c+h/256-32768}static pack(i,c){const h=[0,0,0,0],g=T8.getUnpackVector(c);let y=Math.floor((i+g[3])/g[2]);return h[2]=y%256,y=Math.floor(y/256),h[1]=y%256,y=Math.floor(y/256),h[0]=y,h}getPixels(){return new Zs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,c,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,y=c*this.dim+this.dim,b=h*this.dim,S=h*this.dim+this.dim;switch(c){case-1:g=y-1;break;case 1:y=g+1}switch(h){case-1:b=S-1;break;case 1:S=b+1}const P=-c*this.dim,M=-h*this.dim;for(let L=b;L<S;L++)for(let F=g;F<y;F++)this.data[this._idx(F,L)]=i.data[this._idx(F+P,L+M)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Xt("DEMData",T8),Xt("DemMinMaxQuadTree",Sd,{omit:["dem"]});class ow{constructor(i,c){this.max=i,this.onRemove=c,this.reset()}reset(){for(const i in this.data)for(const c of this.data[i])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(i,c,h){const g=i.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const y={value:c,timeout:void 0};if(h!==void 0&&(y.timeout=setTimeout(()=>{this.remove(i,y)},h)),this.data[g].push(y),this.order.push(g),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const c=this.data[i].shift();return c.timeout&&clearTimeout(c.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),c.value}getByKey(i){const c=this.data[i];return c?c[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,c){if(!this.has(i))return this;const h=i.wrapped().key,g=c===void 0?0:this.data[h].indexOf(c),y=this.data[h][g];return this.data[h].splice(g,1),y.timeout&&clearTimeout(y.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(y.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(i){const c=[];for(const h in this.data)for(const g of this.data[h])i(g.value)||c.push(g);for(const h of c)this.remove(h.value.tileID,h)}}class w0 extends ke{constructor(i,c,h){super(),this.id=i,this._onlySymbols=h,c.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new ow(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new sw}onAdd(i){this.map=i,this._minTileCacheSize=i?i._minTileCacheSize:null,this._maxTileCacheSize=i?i._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const c=this._tiles[i];if(c.state!=="loaded"&&c.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,c){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,c)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const h=this._tiles[c];h.upload(i),h.prepare(this.map.style.imageManager)}}getIds(){return bo(this._tiles).map(i=>i.tileID).sort(Pd).map(i=>i.key)}getRenderableIds(i){const c=[];for(const h in this._tiles)this._isIdRenderable(+h,i)&&c.push(this._tiles[h]);return i?c.sort((h,g)=>{const y=h.tileID,b=g.tileID,S=new O(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),P=new O(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-b.overscaledZ||P.y-S.y||P.x-S.x}).map(h=>h.tileID.key):c.map(h=>h.tileID).sort(Pd).map(h=>h.key)}hasRenderableParent(i){const c=this.findLoadedParent(i,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(i,c){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(c||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,c){const h=this._tiles[i];h&&(h.state!=="loading"&&(h.state=c),this._loadTile(h,this._tileLoaded.bind(this,h,i,c)))}_tileLoaded(i,c,h,g){if(g)if(i.state="errored",g.status!==404)this._source.fire(new fe(g,{tile:i}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=Ri.now(),h==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(c,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new Q("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const c=this.getRenderableIds();for(let g=0;g<c.length;g++){const y=c[g];if(i.neighboringTiles&&i.neighboringTiles[y]){const b=this.getTileByID(y);h(i,b),h(b,i)}}function h(g,y){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let b=y.tileID.canonical.x-g.tileID.canonical.x;const S=y.tileID.canonical.y-g.tileID.canonical.y,P=Math.pow(2,g.tileID.canonical.z),M=y.tileID.key;b===0&&S===0||Math.abs(S)>1||(Math.abs(b)>1&&(Math.abs(b+P)===1?b+=P:Math.abs(b-P)===1&&(b-=P)),y.dem&&g.dem&&(g.dem.backfillBorder(y.dem,b,S),g.neighboringTiles&&g.neighboringTiles[M]&&(g.neighboringTiles[M].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,c,h,g){for(const y in this._tiles){let b=this._tiles[y];if(g[y]||!b.hasData()||b.tileID.overscaledZ<=c||b.tileID.overscaledZ>h)continue;let S=b.tileID;for(;b&&b.tileID.overscaledZ>c+1;){const M=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[M.key],b&&b.hasData()&&(S=M)}let P=S;for(;P.overscaledZ>c;)if(P=P.scaledTo(P.overscaledZ-1),i[P.key]){g[S.key]=S;break}}}findLoadedParent(i,c){if(i.key in this._loadedParentTiles){const h=this._loadedParentTiles[i.key];return h&&h.tileID.overscaledZ>=c?h:null}for(let h=i.overscaledZ-1;h>=c;h--){const g=i.scaledTo(h),y=this._getLoadedTile(g);if(y)return y}}_getLoadedTile(i){const c=this._tiles[i.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,c){c=c||this._source.tileSize;const h=Math.ceil(i.width/c)+1,g=Math.ceil(i.height/c)+1,y=Math.floor(h*g*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(S)}handleWrapJump(i){const c=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,c){const h={};for(const g in this._tiles){const y=this._tiles[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+c),h[y.tileID.key]=y}this._tiles=h;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(i,c,h){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let g;this.updateCacheSize(i,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?g=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new mo(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(g=i.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(g=g.filter(S=>this._source.hasTile(S)))):g=[];const y=this._updateRetainedTiles(g);if(Id(this._source.type)&&g.length!==0){const S={},P={},M=Object.keys(y);for(const F of M){const N=y[F],H=this._tiles[F];if(!H||H.fadeEndTime&&H.fadeEndTime<=Ri.now())continue;const q=this.findLoadedParent(N,Math.max(N.overscaledZ-w0.maxOverzooming,this._source.minzoom));q&&(this._addTile(q.tileID),S[q.tileID.key]=q.tileID),P[F]=N}const L=g[g.length-1].overscaledZ;for(const F in this._tiles){const N=this._tiles[F];if(y[F]||!N.hasData())continue;let H=N.tileID;for(;H.overscaledZ>L;){H=H.scaledTo(H.overscaledZ-1);const q=this._tiles[H.key];if(q&&q.hasData()&&P[H.key]){y[F]=N.tileID;break}}}for(const F in S)y[F]||(this._coveredTiles[F]=!0,y[F]=S[F])}for(const S in y)this._tiles[S].clearFadeHold();const b=function(S,P){const M=[];for(const L in S)L in P||M.push(L);return M}(this._tiles,y);for(const S of b){const P=this._tiles[S];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const c={};if(i.length===0)return c;const h={},g=i.reduce((M,L)=>Math.min(M,L.overscaledZ),1/0),y=i[0].overscaledZ,b=Math.max(y-w0.maxOverzooming,this._source.minzoom),S=Math.max(y+w0.maxUnderzooming,this._source.minzoom),P={};for(const M of i){const L=this._addTile(M);c[M.key]=M,L.hasData()||g<this._source.maxzoom&&(P[M.key]=M)}this._retainLoadedChildren(P,g,S,c);for(const M of i){let L=this._tiles[M.key];if(L.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const N=M.children(this._source.maxzoom)[0],H=this.getTile(N);if(H&&H.hasData()){c[N.key]=N;continue}}else{const N=M.children(this._source.maxzoom);if(c[N[0].key]&&c[N[1].key]&&c[N[2].key]&&c[N[3].key])continue}let F=L.wasRequested();for(let N=M.overscaledZ-1;N>=b;--N){const H=M.scaledTo(N);if(h[H.key]||(h[H.key]=!0,L=this.getTile(H),!L&&F&&(L=this._addTile(H)),L&&(c[H.key]=H,F=L.wasRequested(),L.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const c=[];let h,g=this._tiles[i].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){h=this._loadedParentTiles[g.key];break}c.push(g.key);const y=g.scaledTo(g.overscaledZ-1);if(h=this._getLoadedTile(y),h)break;g=y}for(const y of c)this._loadedParentTiles[y]=h}}_addTile(i){let c=this._tiles[i.key];if(c)return c;c=this._cache.getAndRemove(i),c&&(this._setTileReloadTimer(i.key,c),c.tileID=i,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,c)));const h=!!c;if(!h){const g=this.map?this.map.painter:null,y=this._source.type==="raster"||this._source.type==="raster-dem";c=new c5(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,g,y),this._loadTile(c,this._tileLoaded.bind(this,c,i.key,c.state))}return c?(c.uses++,this._tiles[i.key]=c,h||this._source.fire(new Q("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c):null}_setTileReloadTimer(i,c){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const h=c.getExpiryTimeout();h&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},h))}_removeTile(i){const c=this._tiles[i];c&&(c.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),c.uses>0||(c.hasData()&&c.state!=="reloading"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(i,c,h){const g=[],y=this.transform;if(!y)return g;for(const b in this._tiles){const S=this._tiles[b];if(h&&S.clearQueryDebugViz(),S.holdingForFade())continue;const P=i.containsTile(S,y,c);P&&g.push(P)}return g}getVisibleCoordinates(i){const c=this.getRenderableIds(i).map(h=>this._tiles[h].tileID);for(const h of c)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return c}hasTransition(){if(this._source.hasTransition())return!0;if(Id(this._source.type))for(const i in this._tiles){const c=this._tiles[i];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=Ri.now())return!0}return!1}setFeatureState(i,c,h){this._state.updateState(i=i||"_geojsonTileLayer",c,h)}removeFeatureState(i,c,h){this._state.removeFeatureState(i=i||"_geojsonTileLayer",c,h)}getFeatureState(i,c){return this._state.getState(i=i||"_geojsonTileLayer",c)}setDependencies(i,c,h){const g=this._tiles[i];g&&g.setDependencies(c,h)}reloadTilesForDependencies(i,c){for(const h in this._tiles)this._tiles[h].hasDependency(i,c)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(i,c))}_preloadTiles(i,c){const h=new Map,g=Array.isArray(i)?i:[i],y=this.map.painter.terrain,b=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const M of g){const L=M.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of L)h.set(F.key,F);this.usedForTerrain&&M.updateElevation(!1)}const S=Array.from(h.values()),P=this._source.type==="raster"||this._source.type==="raster-dem";jo(S,(M,L)=>{const F=new c5(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,P);this._loadTile(F,N=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),L(N,F)})},c)}}function Pd(a,i){const c=Math.abs(2*a.wrap)-+(a.wrap<0),h=Math.abs(2*i.wrap)-+(i.wrap<0);return a.overscaledZ-i.overscaledZ||h-c||i.canonical.y-a.canonical.y||i.canonical.x-a.canonical.x}function Id(a){return a==="raster"||a==="image"||a==="video"}w0.maxOverzooming=10,w0.maxUnderzooming=3;class E8{constructor(i,c,h){this._demTile=i,this._dem=this._demTile.dem,this._scale=c,this._offset=h}static create(i,c,h){const g=h||i.findDEMTileFor(c);if(!g||!g.dem)return;const y=g.dem,b=g.tileID,S=1<<c.canonical.z-b.canonical.z;return new E8(g,g.tileSize/Vn/S,[(c.canonical.x/S-b.canonical.x)*y.dim,(c.canonical.y/S-b.canonical.y)*y.dim])}tileCoordToPixel(i,c){const h=c*this._scale+this._offset[1],g=Math.floor(i*this._scale+this._offset[0]),y=Math.floor(h);return new O(g,y)}getElevationAt(i,c,h,g){const y=i*this._scale+this._offset[0],b=c*this._scale+this._offset[1],S=Math.floor(y),P=Math.floor(b),M=this._dem;return g=!!g,h?rr(rr(M.get(S,P,g),M.get(S,P+1,g),b-P),rr(M.get(S+1,P,g),M.get(S+1,P+1,g),b-P),y-S):M.get(S,P,g)}getElevationAtPixel(i,c,h){return this._dem.get(i,c,!!h)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*Fo(1,i)*this._dem.stride}}class Md{constructor(i,c){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new cl(Vn,16,0),this.featureIndexArray=new Z2,this.promoteId=c}insert(i,c,h,g,y,b=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,g,y,b);const P=this.grid;for(let M=0;M<c.length;M++){const L=c[M],F=[1/0,1/0,-1/0,-1/0];for(let N=0;N<L.length;N++){const H=L[N];F[0]=Math.min(F[0],H.x),F[1]=Math.min(F[1],H.y),F[2]=Math.max(F[2],H.x),F[3]=Math.max(F[3],H.y)}F[0]<Vn&&F[1]<Vn&&F[2]>=0&&F[3]>=0&&P.insert(S,F[0],F[1],F[2],F[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new w.VectorTile(new Bu(this.rawTileData)).layers,this.sourceLayerCoder=new yd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,c,h,g){this.loadVTLayers();const y=i.params||{},b=$1(y.filter),S=i.tileResult,P=i.transform,M=S.bufferedTilespaceBounds,L=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(q,J,oe,me)=>d4(S.bufferedTilespaceGeometry,q,J,oe,me));L.sort(aw);let F=null;P.elevation&&L.length>0&&(F=E8.create(P.elevation,this.tileID));const N={};let H;for(let q=0;q<L.length;q++){const J=L[q];if(J===H)continue;H=J;const oe=this.featureIndexArray.get(J);let me=null;this.loadMatchingFeature(N,oe,b,y.layers,y.availableImages,c,h,g,(Ce,De,Ue,We=0)=>(me||(me=Ms(Ce,this.tileID.canonical,i.tileTransform)),De.queryIntersectsFeature(S,Ce,Ue,me,this.z,i.transform,i.pixelPosMatrix,F,We)))}return N}loadMatchingFeature(i,c,h,g,y,b,S,P,M){const{featureIndex:L,bucketIndex:F,sourceLayerIndex:N,layoutVertexArrayOffset:H}=c,q=this.bucketLayerIDs[F];if(g&&!function(Ce,De){for(let Ue=0;Ue<Ce.length;Ue++)if(De.indexOf(Ce[Ue])>=0)return!0;return!1}(g,q))return;const J=this.sourceLayerCoder.decode(N),oe=this.vtLayers[J].feature(L);if(h.needGeometry){const Ce=gl(oe,!0);if(!h.filter(new gn(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!h.filter(new gn(this.tileID.overscaledZ),oe))return;const me=this.getId(oe,J);for(let Ce=0;Ce<q.length;Ce++){const De=q[Ce];if(g&&g.indexOf(De)<0)continue;const Ue=b[De];if(!Ue)continue;let We={};me!==void 0&&P&&(We=P.getState(Ue.sourceLayer||"_geojsonTileLayer",me));const Xe=ur({},S[De]);Xe.paint=Rd(Xe.paint,Ue.paint,oe,We,y),Xe.layout=Rd(Xe.layout,Ue.layout,oe,We,y);const gt=!M||M(oe,Ue,We,H);if(!gt)continue;const pt=new vd(oe,this.z,this.x,this.y,me);pt.layer=Xe;let zt=i[De];zt===void 0&&(zt=i[De]=[]),zt.push({featureIndex:L,feature:pt,intersectionZ:gt})}}lookupSymbolFeatures(i,c,h,g,y,b,S,P){const M={};this.loadVTLayers();const L=$1(y);for(const F of i)this.loadMatchingFeature(M,{bucketIndex:h,sourceLayerIndex:g,featureIndex:F,layoutVertexArrayOffset:0},L,b,S,P,c);return M}loadFeature(i){const{featureIndex:c,sourceLayerIndex:h}=i;this.loadVTLayers();const g=this.sourceLayerCoder.decode(h),y=this.vtFeatures[g];if(y[c])return y[c];const b=this.vtLayers[g].feature(c);return y[c]=b,b}hasLayer(i){for(const c of this.bucketLayerIDs)for(const h of c)if(i===h)return!0;return!1}getId(i,c){let h=i.id;return this.promoteId&&(h=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof h=="boolean"&&(h=Number(h))),h}}function Rd(a,i,c,h,g){return ys(a,(y,b)=>{const S=i instanceof Ca?i.get(b):null;return S&&S.evaluate?S.evaluate(c,h,g):S})}function aw(a,i){return i-a}Xt("FeatureIndex",Md,{omit:["rawTileData","sourceLayerCoder"]});var lw=Mn([{name:"a_pos",type:"Int16",components:2}]);const Ba=32,d1=33,o3=new Uint16Array(8184);for(let a=0;a<2046;a++){let i=a+2,c=0,h=0,g=0,y=0,b=0,S=0;for(1&i?g=y=b=Ba:c=h=S=Ba;(i>>=1)>1;){const M=c+g>>1,L=h+y>>1;1&i?(g=c,y=h,c=b,h=S):(c=g,h=y,g=b,y=S),b=M,S=L}const P=4*a;o3[P+0]=c,o3[P+1]=h,o3[P+2]=g,o3[P+3]=y}const p1=new Uint16Array(2178),a3=new Uint8Array(1089),S8=new Uint16Array(1089);function kd(a){return a===0?-.03125:a===32?.03125:0}var l5=Mn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Od={type:2,extent:Vn,loadGeometry:()=>[[new O(0,0),new O(8193,0),new O(8193,8193),new O(0,8193),new O(0,0)]]};class c5{constructor(i,c,h,g,y){this.tileID=i,this.uid=$o(),this.uses=0,this.tileSize=c,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(i){const c=i+this.timeAdded;c<Ri.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=A4(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,c,h){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(g,y){const b={};if(!y)return b;for(const S of g){const P=S.layerIds.map(M=>y.getLayer(M)).filter(Boolean);if(P.length!==0){S.layers=P,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(M=>P.filter(L=>L.id===M)[0]));for(const M of P)b[M.id]=S}}return b}(i.buckets,c.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const y=this.buckets[g];if(y instanceof i3){if(this.hasSymbolBuckets=!0,!h)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const y=this.buckets[g];if(y instanceof i3&&y.hasRTLText){this.hasRTLText=!0,$n.isLoading()||$n.isLoaded()||Ni()!=="deferred"||Ai();break}}this.queryPadding=0;for(const g in this.buckets){const y=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(g).queryRadius(y))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new l4}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const h in this.buckets){const g=this.buckets[h];g.uploadPending()&&g.upload(i)}const c=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new b8(i,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new b8(i,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new b8(i,this.lineAtlas.image,c.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,c,h,g,y,b,S,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:g,pixelPosMatrix:S,transform:b,params:y,tileTransform:this.tileTransform},i,c,h):{}}querySourceFeatures(i,c){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const g=h.loadVTLayers(),y=c?c.sourceLayer:"",b=g._geojsonTileLayer||g[y];if(!b)return;const S=$1(c&&c.filter),{z:P,x:M,y:L}=this.tileID.canonical,F={z:P,x:M,y:L};for(let N=0;N<b.length;N++){const H=b.feature(N);if(S.needGeometry){const oe=gl(H,!0);if(!S.filter(new gn(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!S.filter(new gn(this.tileID.overscaledZ),H))continue;const q=h.getId(H,y),J=new vd(H,P,M,L,q);J.tile=F,i.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const c=this.expirationTime;if(i.cacheControl){const h=so(i.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const h=Date.now();let g=!1;if(this.expirationTime>h)g=!1;else if(c)if(this.expirationTime<c)g=!0;else{const y=this.expirationTime-c;y?this.expirationTime=h+Math.max(y,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0||!c)return;const h=this.latestFeatureIndex.loadVTLayers(),g=c.style.listImages();for(const y in this.buckets){if(!c.style.hasLayer(y))continue;const b=this.buckets[y],S=b.layers[0].sourceLayer||"_geojsonTileLayer",P=h[S],M=i[S];if(!P||!M||Object.keys(M).length===0)continue;if(b.update(M,P,g,this.imageAtlas&&this.imageAtlas.patternPositions||{}),b instanceof Pt||b instanceof n3){const F=c.style._getSourceCache(b.layers[0].source);c._terrain&&c._terrain.enabled&&F&&b.programConfigurations.needsUpload&&c._terrain._clearRenderCacheForTile(F.id,this.tileID)}const L=c&&c.style&&c.style.getLayer(y);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ri.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=Ri.now()+i}setDependencies(i,c){const h={};for(const g of c)h[g]=!0;this.dependencies[i]=h}hasDependency(i,c){for(const h of i){const g=this.dependencies[h];if(g){for(const y of c)if(g[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const h=Ms(Od,this.tileID.canonical,this.tileTransform)[0],g=new ti,y=new t0;for(let b=0;b<h.length;b++){const{x:S,y:P}=h[b];g.emplaceBack(S,P),y.emplaceBack(b)}y.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(y),this._tileDebugBuffer=i.createVertexBuffer(g,l5.members),this._tileDebugSegments=Gr.simpleSegment(0,0,g.length,y.length)}_makeTileBoundsBuffers(i,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const h=Ms(Od,this.tileID.canonical,this.tileTransform)[0];let g,y;if(this.isRaster){const b=function(S,P){const M=A4(S,P),L=Math.pow(2,S.z);for(let oe=0;oe<d1;oe++)for(let me=0;me<d1;me++){const Ce=la((S.x+(me+kd(me))/Ba)/L),De=uo((S.y+(oe+kd(oe))/Ba)/L),Ue=P.project(Ce,De),We=oe*d1+me;p1[2*We+0]=Math.round((Ue.x*M.scale-M.x)*Vn),p1[2*We+1]=Math.round((Ue.y*M.scale-M.y)*Vn)}a3.fill(0),S8.fill(0);for(let oe=2045;oe>=0;oe--){const me=4*oe,Ce=o3[me+0],De=o3[me+1],Ue=o3[me+2],We=o3[me+3],Xe=Ce+Ue>>1,gt=De+We>>1,pt=Xe+gt-De,zt=gt+Ce-Xe,Ot=De*d1+Ce,mt=We*d1+Ue,Lt=gt*d1+Xe,Ut=Math.hypot((p1[2*Ot+0]+p1[2*mt+0])/2-p1[2*Lt+0],(p1[2*Ot+1]+p1[2*mt+1])/2-p1[2*Lt+1])>=16;if(a3[Lt]=a3[Lt]||(Ut?1:0),oe<1022){const wt=(De+zt>>1)*d1+(Ce+pt>>1),Zt=(We+zt>>1)*d1+(Ue+pt>>1);a3[Lt]=a3[Lt]||a3[wt]||a3[Zt]}}const F=new fl,N=new $s;let H=0;function q(oe,me){const Ce=me*d1+oe;return S8[Ce]===0&&(F.emplaceBack(p1[2*Ce+0],p1[2*Ce+1],oe*Vn/Ba,me*Vn/Ba),S8[Ce]=++H),S8[Ce]-1}function J(oe,me,Ce,De,Ue,We){const Xe=oe+Ce>>1,gt=me+De>>1;if(Math.abs(oe-Ue)+Math.abs(me-We)>1&&a3[gt*d1+Xe])J(Ue,We,oe,me,Xe,gt),J(Ce,De,Ue,We,Xe,gt);else{const pt=q(oe,me),zt=q(Ce,De),Ot=q(Ue,We);N.emplaceBack(pt,zt,Ot)}}return J(0,0,Ba,Ba,Ba,0),J(Ba,Ba,0,0,0,Ba),{vertices:F,indices:N}}(this.tileID.canonical,c);g=b.vertices,y=b.indices}else{g=new fl,y=new $s;for(const{x:S,y:P}of h)g.emplaceBack(S,P,0,0);const b=ic(g.int16,void 0,4);for(let S=0;S<b.length;S+=3)y.emplaceBack(b[S],b[S+1],b[S+2])}this._tileBoundsBuffer=i.createVertexBuffer(g,l5.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(y),this._tileBoundsSegments=Gr.simpleSegment(0,0,g.length,y.length)}}const cw=Mn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),uw=Mn([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Dd}=cw;function T0(a,i){const c=a.fovAboveCenter,h=a.elevation?a.elevation.getMinElevationBelowMSL()*i:0,g=(a._camera.position[2]*a.worldSize-h)/Math.cos(a._pitch),y=Math.sin(c)*g/Math.sin(Math.max(Math.PI/2-a._pitch-c,.01)),b=Math.sin(a._pitch)*y+g;return Math.min(1.01*b,g*(1/a._horizonShift))}const u5=Vn/Math.PI/2,No=-u5,Bo=u5,hw=[new fo([No,No,No],[Bo,Bo,Bo]),new fo([No,No,No],[0,0,Bo]),new fo([0,No,No],[Bo,0,Bo]),new fo([No,0,No],[0,Bo,Bo]),new fo([0,0,No],[Bo,Bo,Bo])];function A8(a){if(a.z<=1)return hw[a.z+2*a.y+a.x];const[i,c]=Ld(a),h=[C8(i[0],i[1]),C8(i[0],c[1]),C8(c[0],i[1]),C8(c[0],c[1])],g=[Bo,Bo,Bo],y=[No,No,No];for(const b of h)g[0]=Math.min(g[0],b[0]),g[1]=Math.min(g[1],b[1]),g[2]=Math.min(g[2],b[2]),y[0]=Math.max(y[0],b[0]),y[1]=Math.max(y[1],b[1]),y[2]=Math.max(y[2],b[2]);return new fo(g,y)}function Ld(a){const i=Math.pow(2,a.z),c=a.x/i,h=(a.x+1)/i,g=(a.y+1)/i;return[[uo(a.y/i),la(c)],[uo(g),la(h)]]}function h5(a,i,c,h){return c=Ht(c),h||(h=u5),[a*Math.sin(c)*h,-i*h,a*Math.cos(c)*h]}function C8(a,i,c){return h5(Math.cos(Ht(a)),Math.sin(Ht(a)),i,c)}function Fd(a){return 16383/Math.max(...Dt([],a.max,a.min))}function Nd(a){const i=Ee(new Float64Array(16)),c=1/Fd(a);return _e(i,i,a.min),Me(i,i,[c,c,c]),i}function Bd(a,i,c){const h=i/(2*Math.PI),g=function(b){const S=Vn/(2*Math.PI);return b/(2*Math.PI)/S}(i);if(!c){const b=En(a.center.lat,-85.051129,Oa);c=[a1(a.center.lng)*i,l1(b)*i]}const y=Ee(new Float64Array(16));return _e(y,y,[c[0],c[1],-h]),Me(y,y,[g,g,g]),Fe(y,y,Ht(-a._center.lat)),yt(y,y,Ht(-a._center.lng)),y}class f5{constructor(i){const c=this._createGridIndices();this.gridIndexBuffer=i.createIndexBuffer(c,!0),this.gridSegments=Gr.simpleSegment(0,0,4225,8192);const h=this._createPoleTriangleIndices();this.poleIndexBuffer=i.createIndexBuffer(h,!0),this.poleSegments=Gr.simpleSegment(0,0,66,64);const g=new s1;g.emplaceBack(-1,1,1,0,0,0,0),g.emplaceBack(1,1,1,0,0,1,0),g.emplaceBack(1,-1,1,0,0,1,1),g.emplaceBack(-1,-1,1,0,0,0,1);const y=new $s;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.atmosphereVertexBuffer=i.createVertexBuffer(g,uw.members),this.atmosphereIndexBuffer=i.createIndexBuffer(y),this.atmosphereSegments=Gr.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(i,c,h){const g=new s1,y=c/Math.PI/2;g.emplaceBack(0,-y,0,0,0,.5,h?0:1);const b=360/i,S=Math.cos(Ht(85)),P=Math.sin(Ht(85));for(let L=0;L<=64;L++){const F=L/64,N=h5(S,P,0*(1-(M=F))+b*M,y);g.emplaceBack(N[0],N[1],N[2],0,0,F,h?0:1)}var M;return g}_createPoleTriangleIndices(){const i=new $s;for(let c=0;c<=64;c++)i.emplaceBack(0,c+1,c+2);return i}static createGridVertices(i){const c=Math.pow(2,i.z),h=(P,M,L)=>P*(1-L)+M*L,[g,y]=Ld(i),b=new s1,S=function(P){const M=Ee(new Float64Array(16)),L=Fd(P);var F,N;return Me(M,M,[L,L,L]),_e(M,M,((F=[])[0]=-(N=P.min)[0],F[1]=-N[1],F[2]=-N[2],F)),M}(A8(i));b.reserve(4096);for(let P=0;P<65;P++){const M=h(g[0],y[0],P/64),L=l1(M),F=L*c-i.y,N=Math.sin(Ht(M)),H=Math.cos(Ht(M));for(let q=0;q<65;q++){const J=q/64,oe=h(g[1],y[1],J),me=h5(H,N,oe);Be(me,me,S);const Ce=a1(oe);b.emplaceBack(me[0],me[1],me[2],Ce,L,J,F)}}return b}_createGridIndices(){const i=new $s,c=(h,g)=>{const y=65*g+h;i.emplaceBack(y+1,y,y+65),i.emplaceBack(y+65,y+65+1,y+1)};for(let h=0;h<64;h++)for(let g=0;g<64;g++)c(g,h);return i}getWirefameBuffer(i){if(!this.wireframeSegments){const c=this._createWireframeGrid();this.wireframeIndexBuffer=i.createIndexBuffer(c),this.wireframeSegments=Gr.simpleSegment(0,0,4096,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const i=new Ia,c=(h,g)=>{const y=65*g+h;i.emplaceBack(y,y+1),i.emplaceBack(y,y+65),i.emplaceBack(y,y+65+1)};for(let h=0;h<64;h++)for(let g=0;g<64;g++)c(g,h);return i}}function A4(a,i){if(!i.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:i};const c=Math.pow(2,-a.z),h=a.x*c,g=(a.x+1)*c,y=a.y*c,b=(a.y+1)*c,S=la(h),P=la(g),M=uo(y),L=uo(b),F=i.project(S,M),N=i.project(P,M),H=i.project(P,L),q=i.project(S,L);let J=Math.min(F.x,N.x,H.x,q.x),oe=Math.min(F.y,N.y,H.y,q.y),me=Math.max(F.x,N.x,H.x,q.x),Ce=Math.max(F.y,N.y,H.y,q.y);const De=c/16;function Ue(Xe,gt,pt,zt,Ot,mt){const Lt=(pt+Ot)/2,Ut=(zt+mt)/2,wt=i.project(la(Lt),uo(Ut)),Zt=Math.max(0,J-wt.x,oe-wt.y,wt.x-me,wt.y-Ce);J=Math.min(J,wt.x),me=Math.max(me,wt.x),oe=Math.min(oe,wt.y),Ce=Math.max(Ce,wt.y),Zt>De&&(Ue(Xe,wt,pt,zt,Lt,Ut),Ue(wt,gt,Lt,Ut,Ot,mt))}Ue(F,N,h,y,g,y),Ue(N,H,g,y,g,b),Ue(H,q,g,b,h,b),Ue(q,F,h,b,h,y),J-=De,oe-=De,me+=De,Ce+=De;const We=1/Math.max(me-J,Ce-oe);return{scale:We,x:J*We,y:oe*We,x2:me*We,y2:Ce*We,projection:i}}class zd{constructor(i){const c={},h=[];for(const S in i){const P=i[S],M=c[S]={};for(const L in P.glyphs){const F=P.glyphs[+L];if(!F||F.bitmap.width===0||F.bitmap.height===0)continue;const N=F.metrics.localGlyph?2:1,H={x:0,y:0,w:F.bitmap.width+2*N,h:F.bitmap.height+2*N};h.push(H),M[L]=H}}const{w:g,h:y}=j6(h),b=new Pi({width:g||1,height:y||1});for(const S in i){const P=i[S];for(const M in P.glyphs){const L=P.glyphs[+M];if(!L||L.bitmap.width===0||L.bitmap.height===0)continue;const F=c[S][M],N=L.metrics.localGlyph?2:1;Pi.copy(L.bitmap,b,{x:0,y:0},{x:F.x+N,y:F.y+N},L.bitmap)}}this.image=b,this.positions=c}}Xt("GlyphAtlas",zd);class fw{constructor(i){this.tileID=new mo(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=A4(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,c,h,g,y){this.status="parsing",this.data=i,this.collisionBoxArray=new l4;const b=new yd(Object.keys(i.layers).sort()),S=new Md(this.tileID,this.promoteId);S.bucketLayerIDs=[];const P={},M=new n5(256,256),L={featureIndex:S,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:M,availableImages:h},F=c.familiesBySource[this.source];for(const We in F){const Xe=i.layers[We];if(!Xe)continue;let gt=!1,pt=!1;for(const mt of F[We])mt[0].type==="symbol"?gt=!0:pt=!0;if(this.isSymbolTile===!0&&!gt||this.isSymbolTile===!1&&!pt)continue;Xe.version===1&&gr(`Vector tile source "${this.source}" layer "${We}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const zt=b.encode(We),Ot=[];for(let mt=0;mt<Xe.length;mt++){const Lt=Xe.feature(mt),Ut=S.getId(Lt,We);Ot.push({feature:Lt,id:Ut,index:mt,sourceLayerIndex:zt})}for(const mt of F[We]){const Lt=mt[0];this.isSymbolTile!==void 0&&Lt.type==="symbol"!==this.isSymbolTile||Lt.minzoom&&this.zoom<Math.floor(Lt.minzoom)||Lt.maxzoom&&this.zoom>=Lt.maxzoom||Lt.visibility!=="none"&&(d5(mt,this.zoom,h),(P[Lt.id]=Lt.createBucket({index:S.bucketLayerIDs.length,layers:mt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:zt,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:h})).populate(Ot,L,this.tileID.canonical,this.tileTransform),S.bucketLayerIDs.push(mt.map(Ut=>Ut.id)))}}let N,H,q,J;M.trim();const oe={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},me=ys(L.glyphDependencies,We=>Object.keys(We).map(Number));Object.keys(me).length?g.send("getGlyphs",{uid:this.uid,stacks:me},(We,Xe)=>{N||(N=We,H=Xe,Ue.call(this))},void 0,!1,oe):H={};const Ce=Object.keys(L.iconDependencies);Ce.length?g.send("getImages",{icons:Ce,source:this.source,tileID:this.tileID,type:"icons"},(We,Xe)=>{N||(N=We,q=Xe,Ue.call(this))},void 0,!1,oe):q={};const De=Object.keys(L.patternDependencies);function Ue(){if(N)return y(N);if(H&&q&&J){const We=new zd(H),Xe=new Hf(q,J);for(const gt in P){const pt=P[gt];pt instanceof i3?(d5(pt.layers,this.zoom,h),Wb(pt,H,We.positions,q,Xe.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection),pt.projection=this.projection.name):pt.hasPattern&&(pt instanceof Pt||pt instanceof n3||pt instanceof xe)&&(d5(pt.layers,this.zoom,h),pt.addFeatures(L,this.tileID.canonical,Xe.patternPositions,h))}this.status="done",y(null,{buckets:bo(P).filter(gt=>!gt.isEmpty()),featureIndex:S,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:We.image,lineAtlas:M,imageAtlas:Xe,glyphMap:this.returnDependencies?H:null,iconMap:this.returnDependencies?q:null,glyphPositions:this.returnDependencies?We.positions:null})}}De.length?g.send("getImages",{icons:De,source:this.source,tileID:this.tileID,type:"patterns"},(We,Xe)=>{N||(N=We,J=Xe,Ue.call(this))},void 0,!1,oe):J={},Ue.call(this)}}function d5(a,i,c){const h=new gn(i);for(const g of a)g.recalculate(h,c)}class Ud{constructor(i){this.entries={},this.scheduler=i}request(i,c,h,g){const y=this.entries[i]=this.entries[i]||{callbacks:[]};if(y.result){const[b,S]=y.result;return this.scheduler?this.scheduler.add(()=>{g(b,S)},c):g(b,S),()=>{}}return y.callbacks.push(g),y.cancel||(y.cancel=h((b,S)=>{y.result=[b,S];for(const P of y.callbacks)this.scheduler?this.scheduler.add(()=>{P(b,S)},c):P(b,S);setTimeout(()=>delete this.entries[i],3e3)})),()=>{y.result||(y.callbacks=y.callbacks.filter(b=>b!==g),y.callbacks.length||(y.cancel(),delete this.entries[i]))}}}function Vd(a,i,c){const h=JSON.stringify(a.request);return a.data&&(this.deduped.entries[h]={result:[null,a.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},g=>{const y=ws(a.request,(b,S,P,M)=>{b?g(b):S&&g(null,{vectorTile:c?void 0:new w.VectorTile(new Bu(S)),rawData:S,cacheControl:P,expires:M})});return()=>{y.cancel(),g()}},i)}const dw=Ee(new Float64Array(16));class E0{constructor(i,c){this._tr=i,this._worldSize=c}createInversionMatrix(){return dw}createTileMatrix(i){let c,h,g;const y=i.canonical,b=Ee(new Float64Array(16)),S=this._tr.projection;if(S.isReprojectedInTileSpace){const P=A4(y,S);c=1,h=P.x+i.wrap*P.scale,g=P.y,Me(b,b,[c/P.scale,c/P.scale,this._tr.pixelsPerMeter/this._worldSize])}else c=this._worldSize/this._tr.zoomScale(y.z),h=(y.x+Math.pow(2,y.z)*i.wrap)*c,g=y.y*c;return _e(b,b,[h,g,0]),Me(b,b,[c/Vn,c/Vn,1]),b}pointCoordinate(i,c,h){const g=this._tr.horizonLineFromTop(!1),y=new O(i,Math.max(g,c));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(y,h))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var pw={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Or(this.parallels,this.constants.parallels))return;const a=Math.sin(Ht(this.parallels[0])),i=(a+Math.sin(Ht(this.parallels[1])))/2,c=1+a*(2*i-a),h=Math.sqrt(c)/i;this.constants={n:i,c,r0:h,parallels:this.parallels}},project(a,i){this.initializeConstants();const c=Ht(a-this.center[0]),h=Ht(i),{n:g,c:y,r0:b}=this.constants,S=Math.sqrt(y-2*g*Math.sin(h))/g;return{x:S*Math.sin(c*g),y:S*Math.cos(c*g)-b,z:0}},unproject(a,i){this.initializeConstants();const{n:c,c:h,r0:g}=this.constants,y=g+i;let b=Math.atan2(a,Math.abs(y))*Math.sign(y);y*c<0&&(b-=Math.PI*Math.sign(a)*Math.sign(y));const S=Ht(this.center[0])*c;b=_s(b,-Math.PI-S,Math.PI-S);const P=pn(b/c)+this.center[0],M=Math.asin(En((h-(a*a+y*y)*c*c)/(2*c),-1,1)),L=En(pn(M),-85.051129,Oa);return new cr(P,L)},projectTilePoint:(a,i)=>({x:a,y:i,z:0}),locationPoint:(a,i)=>a._coordinatePoint(a.locationCoordinate(i),!1),pixelsPerMeter:(a,i)=>Fo(1,a)*i,farthestPixelDistance(a){return T0(a,this.pixelsPerMeter(a.center.lat,a.worldSize))},createTileTransform:(a,i)=>new E0(a,i)};const Vu=1.340264,ju=-.081106,$u=893e-6,Wu=.003796,P8=Math.sqrt(3)/2;var mw={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(a,i){i=i/180*Math.PI,a=a/180*Math.PI;const c=Math.asin(P8*Math.sin(i)),h=c*c,g=h*h*h;return{x:.5*(a*Math.cos(c)/(P8*(Vu+3*ju*h+g*(7*$u+9*Wu*h)))/Math.PI+.5),y:1-.5*(c*(Vu+ju*h+g*($u+Wu*h))/Math.PI+1),z:0}},unproject(a,i){a=(2*a-.5)*Math.PI;let c=i=(2*(1-i)-1)*Math.PI,h=c*c,g=h*h*h;for(let M,L,F,N=0;N<12&&(L=c*(Vu+ju*h+g*($u+Wu*h))-i,F=Vu+3*ju*h+g*(7*$u+9*Wu*h),M=L/F,c=En(c-M,-Math.PI/3,Math.PI/3),h=c*c,g=h*h*h,!(Math.abs(M)<1e-12));++N);const y=P8*a*(Vu+3*ju*h+g*(7*$u+9*Wu*h))/Math.cos(c),b=Math.asin(Math.sin(c)/P8),S=En(180*y/Math.PI,-180,180),P=En(180*b/Math.PI,-85.051129,Oa);return new cr(S,P)},projectTilePoint:(a,i)=>({x:a,y:i,z:0}),locationPoint:(a,i)=>a._coordinatePoint(a.locationCoordinate(i),!1),pixelsPerMeter:(a,i)=>Fo(1,a)*i,farthestPixelDistance(a){return T0(a,this.pixelsPerMeter(a.center.lat,a.worldSize))},createTileTransform:(a,i)=>new E0(a,i)},gw={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(a,i)=>({x:.5+a/360,y:.5-i/360,z:0}),unproject(a,i){const c=360*(a-.5),h=En(360*(.5-i),-85.051129,Oa);return new cr(c,h)},projectTilePoint:(a,i)=>({x:a,y:i,z:0}),locationPoint:(a,i)=>a._coordinatePoint(a.locationCoordinate(i),!1),pixelsPerMeter:(a,i)=>Fo(1,a)*i,farthestPixelDistance(a){return T0(a,this.pixelsPerMeter(a.center.lat,a.worldSize))},createTileTransform:(a,i)=>new E0(a,i)};const C4=Math.PI/2;function I8(a){return Math.tan((C4+a)/2)}var _w={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Or(this.parallels,this.constants.parallels))return;const a=Ht(this.parallels[0]),i=Ht(this.parallels[1]),c=Math.cos(a),h=a===i?Math.sin(a):Math.log(c/Math.cos(i))/Math.log(I8(i)/I8(a)),g=c*Math.pow(I8(a),h)/h;this.constants={n:h,f:g,parallels:this.parallels}},project(a,i){this.initializeConstants(),i=Ht(i),a=Ht(a-this.center[0]);const c=1e-6,{n:h,f:g}=this.constants;g>0?i<-C4+c&&(i=-C4+c):i>C4-c&&(i=C4-c);const y=g/Math.pow(I8(i),h),b=y*Math.sin(h*a),S=g-y*Math.cos(h*a);return{x:.5*(b/Math.PI+.5),y:1-.5*(S/Math.PI+.5),z:0}},unproject(a,i){this.initializeConstants(),a=(2*a-.5)*Math.PI,i=(2*(1-i)-.5)*Math.PI;const{n:c,f:h}=this.constants,g=h-i,y=Math.sign(g),b=Math.sign(c)*Math.sqrt(a*a+g*g);let S=Math.atan2(a,Math.abs(g))*y;g*c<0&&(S-=Math.PI*Math.sign(a)*y);const P=En(pn(S/c)+this.center[0],-180,180),M=En(pn(2*Math.atan(Math.pow(h/b,1/c))-C4),-85.051129,Oa);return new cr(P,M)},projectTilePoint:(a,i)=>({x:a,y:i,z:0}),locationPoint:(a,i)=>a._coordinatePoint(a.locationCoordinate(i),!1),pixelsPerMeter:(a,i)=>Fo(1,a)*i,farthestPixelDistance(a){return T0(a,this.pixelsPerMeter(a.center.lat,a.worldSize))},createTileTransform:(a,i)=>new E0(a,i)},yw={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(a,i)=>({x:a1(a),y:l1(i),z:0}),unproject(a,i){const c=la(a),h=uo(i);return new cr(c,h)},projectTilePoint:(a,i)=>({x:a,y:i,z:0}),locationPoint:(a,i)=>a._coordinatePoint(a.locationCoordinate(i),!1),pixelsPerMeter:(a,i)=>Fo(1,a)*i,farthestPixelDistance(a){return T0(a,this.pixelsPerMeter(a.center.lat,a.worldSize))},createTileTransform:(a,i)=>new E0(a,i)};const jd=Ht(Oa);var vw={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(a,i){const c=(i=Ht(i))*i,h=c*c;return{x:.5*((a=Ht(a))*(.8707-.131979*c+h*(h*(.003971*c-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+c*(.015085+h*(.028874*c-.044475-.005916*h)))/Math.PI+1),z:0}},unproject(a,i){a=(2*a-.5)*Math.PI;let c=i=(2*(1-i)-1)*Math.PI,h=25,g=0,y=c*c;do{y=c*c;const P=y*y;g=(c*(1.007226+y*(.015085+P*(.028874*y-.044475-.005916*P)))-i)/(1.007226+y*(.045255+P*(.259866*y-.311325-.005916*11*P))),c=En(c-g,-jd,jd)}while(Math.abs(g)>1e-6&&--h>0);y=c*c;const b=En(pn(a/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),S=pn(c);return new cr(b,S)},projectTilePoint:(a,i)=>({x:a,y:i,z:0}),locationPoint:(a,i)=>a._coordinatePoint(a.locationCoordinate(i),!1),pixelsPerMeter:(a,i)=>Fo(1,a)*i,farthestPixelDistance(a){return T0(a,this.pixelsPerMeter(a.center.lat,a.worldSize))},createTileTransform:(a,i)=>new E0(a,i)};const $d=Ht(Oa),Wd={albers:pw,equalEarth:mw,equirectangular:gw,lambertConformalConic:_w,mercator:yw,naturalEarth:vw,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(a,i){i=Ht(i),a=Ht(a);const c=Math.cos(i),h=2/Math.PI,g=Math.acos(c*Math.cos(a/2)),y=Math.sin(g)/g,b=.5*(a*h+2*c*Math.sin(a/2)/y)||0,S=.5*(i+Math.sin(i)/y)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}},unproject(a,i){let c=a=(2*a-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,g=25;const y=1e-6;let b=0,S=0;do{const P=Math.cos(h),M=Math.sin(h),L=2*M*P,F=M*M,N=P*P,H=Math.cos(c/2),q=Math.sin(c/2),J=2*H*q,oe=q*q,me=1-N*H*H,Ce=me?1/me:0,De=me?Math.acos(P*H)*Math.sqrt(1/me):0,Ue=.5*(2*De*P*q+2*c/Math.PI)-a,We=.5*(De*M+h)-i,Xe=.5*Ce*(N*oe+De*P*H*F)+1/Math.PI,gt=Ce*(J*L/4-De*M*q),pt=.125*Ce*(L*q-De*M*N*J),zt=.5*Ce*(F*H+De*oe*P)+.5,Ot=gt*pt-zt*Xe;b=(We*gt-Ue*zt)/Ot,S=(Ue*pt-We*Xe)/Ot,c=En(c-b,-Math.PI,Math.PI),h=En(h-S,-$d,$d)}while((Math.abs(b)>y||Math.abs(S)>y)&&--g>0);return new cr(pn(c),pn(h))},projectTilePoint:(a,i)=>({x:a,y:i,z:0}),locationPoint:(a,i)=>a._coordinatePoint(a.locationCoordinate(i),!1),pixelsPerMeter:(a,i)=>Fo(1,a)*i,farthestPixelDistance(a){return T0(a,this.pixelsPerMeter(a.center.lat,a.worldSize))},createTileTransform:(a,i)=>new E0(a,i)}};o.ARRAY_TYPE=ee,o.AUTH_ERR_MSG=Ye,o.Aabb=fo,o.Actor=class{constructor(a,i,c){this.target=a,this.parent=i,this.mapId=c,this.callbacks={},this.cancelCallbacks={},io(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=vs()?a:V,this.scheduler=new iw}send(a,i,c,h,g=!1,y){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=y,this.callbacks[b]=c);const S=ii(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:a,hasCallback:!!c,targetMapId:h,mustQueue:g,sourceMapId:this.mapId,data:X1(i,S)},S),{cancel:()=>{c&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(a){const i=a.data,c=i.id;if(c&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[c];delete this.cancelCallbacks[c],h&&h.cancel()}else if(i.mustQueue||vs()){const h=this.callbacks[c];this.cancelCallbacks[c]=this.scheduler.add(()=>this.processTask(c,i),h&&h.metadata||{type:"message"})}else this.processTask(c,i)}processTask(a,i){if(i.type==="<response>"){const c=this.callbacks[a];delete this.callbacks[a],c&&(i.error?c(Fi(i.error)):c(null,Fi(i.data)))}else{const c=ii(this.globalScope)?void 0:[],h=i.hasCallback?(y,b)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:y?X1(y):null,data:X1(b,c)},c)}:y=>{},g=Fi(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,g,h);else if(this.parent.getWorkerSource){const y=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,y[0],g.source)[y[1]](g,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=w8,o.Color=Gn,o.ColorMode=f1,o.CullFaceMode=El,o.DEMData=T8,o.DataConstantProperty=Gt,o.DedupedRequest=Ud,o.DepthMode=S4,o.EXTENT=Vn,o.Elevation=class{getAtPointOrZero(a,i=0){return this.getAtPoint(a,i)||0}getAtPoint(a,i,c=!0){i==null&&(i=null);const h=this._source();if(!h||a.y<0||a.y>1)return i;const g=h.getSource().maxzoom,y=1<<g,b=Math.floor(a.x),S=a.x-b,P=new mo(g,b,g,Math.floor(S*y),Math.floor(a.y*y)),M=this.findDEMTileFor(P);if(!M||!M.dem)return i;const L=M.dem,F=1<<M.tileID.canonical.z,N=(S*F-M.tileID.canonical.x)*L.dim,H=(a.y*F-M.tileID.canonical.y)*L.dim,q=Math.floor(N),J=Math.floor(H);return(c?this.exaggeration():1)*rr(rr(L.get(q,J),L.get(q,J+1),H-J),rr(L.get(q+1,J),L.get(q+1,J+1),H-J),N-q)}getAtTileOffset(a,i,c){const h=1<<a.canonical.z;return this.getAtPointOrZero(new Q1(a.wrap+(a.canonical.x+i/Vn)/h,(a.canonical.y+c/Vn)/h))}getAtTileOffsetFunc(a,i){return c=>{const h=this.getAtTileOffset(a,c.x,c.y),g=i.upVector(a.canonical,c.x,c.y);return ce(g,g,h*i.upVectorScale(a.canonical)),g}}getForTilePoints(a,i,c,h){const g=E8.create(this,a,h);return!!g&&(i.forEach(y=>{y[2]=this.exaggeration()*g.getElevationAt(y[0],y[1],c)}),!0)}getMinMaxForTile(a){const i=this.findDEMTileFor(a);if(!i||!i.dem)return null;const c=i.dem.tree,h=i.tileID,g=1<<a.canonical.z-h.canonical.z;let y=a.canonical.x/g-h.canonical.x,b=a.canonical.y/g-h.canonical.y,S=0;for(let P=0;P<a.canonical.z-h.canonical.z&&!c.leaves[S];P++){y*=2,b*=2;const M=2*Math.floor(b)+Math.floor(y);S=c.childOffsets[S]+M,y%=1,b%=1}return{min:this.exaggeration()*c.minimums[S],max:this.exaggeration()*c.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,i,c){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=fe,o.EvaluationParameters=gn,o.Event=Q,o.Evented=ke,o.Frustum=rc,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GlobeSharedBuffers=f5,o.GlyphManager=T4,o.ImagePosition=$6,o.LineAtlas=n5,o.LngLat=cr,o.LngLatBounds=o1,o.LocalGlyphMode=Z6,o.MAX_MERCATOR_LATITUDE=Oa,o.MercatorCoordinate=Q1,o.ONE_EM=ps,o.OverscaledTileID=mo,o.Properties=Hr,o.RGBAImage=Zs,o.Ray=class{constructor(a,i){this.pos=a,this.dir=i}intersectsPlane(a,i,c){const h=at(i,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((a[0]-this.pos[0])*i[0]+(a[1]-this.pos[1])*i[1]+(a[2]-this.pos[2])*i[2])/h;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,c[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(a,i,c){if(function(N,H){var q=N[0],J=N[1],oe=N[2],me=H[0],Ce=H[1],De=H[2];return Math.abs(q-me)<=Y*Math.max(1,Math.abs(q),Math.abs(me))&&Math.abs(J-Ce)<=Y*Math.max(1,Math.abs(J),Math.abs(Ce))&&Math.abs(oe-De)<=Y*Math.max(1,Math.abs(oe),Math.abs(De))}(this.pos,a)||i===0)return c[0]=c[1]=c[2]=0,!1;const[h,g,y]=this.dir,b=this.pos[0]-a[0],S=this.pos[1]-a[1],P=this.pos[2]-a[2],M=h*h+g*g+y*y,L=2*(b*h+S*g+P*y),F=L*L-4*M*(b*b+S*S+P*P-i*i);if(F<0){const N=Math.max(-L/2,0),H=b+h*N,q=S+g*N,J=P+y*N,oe=Math.hypot(H,q,J);return c[0]=H*i/oe,c[1]=q*i/oe,c[2]=J*i/oe,!1}{const N=(-L-Math.sqrt(F))/(2*M);if(N<0){const H=Math.hypot(b,S,P);return c[0]=b*i/H,c[1]=S*i/H,c[2]=P*i/H,!1}return c[0]=b+h*N,c[1]=S+g*N,c[2]=P+y*N,!0}}},o.RequestManager=class{constructor(a,i,c){this._transformRequestFn=a,this._customAccessToken=i,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const a=function(){let i="";for(let c=0;c<10;c++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Le,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,i){return this._transformRequestFn&&this._transformRequestFn(a,i)||{url:a}}normalizeStyleURL(a,i){if(!ft(a))return a;const c=qt(a);return c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||i)}normalizeGlyphsURL(a,i){if(!ft(a))return a;const c=qt(a);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||i)}normalizeSourceURL(a,i){if(!ft(a))return a;const c=qt(a);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||i)}normalizeSpriteURL(a,i,c,h){const g=qt(a);return ft(a)?(g.path=`/styles/v1${g.path}/sprite${i}${c}`,this._makeAPIURL(g,this._customAccessToken||h)):(g.path+=`${i}${c}`,Kt(g))}normalizeTileURL(a,i,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!ft(a))return a;const h=qt(a);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||c&&h.authority!=="raster"&&c===512?"@2x":""}${G.supported?".webp":"$1"}`),h.authority==="raster"?h.path=`/${W.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${W.TILE_URL_VERSION}${h.path}`);const g=this._customAccessToken||function(y){for(const b of y){const S=b.match(/^access_token=(.*)$/);if(S)return S[1]}return null}(h.params)||W.ACCESS_TOKEN;return W.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,g)}canonicalizeTileURL(a,i){const c=qt(a);if(!c.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!c.path.match(/\.[\w]+$/))return a;let h="mapbox://";c.path.match(/^\/raster\/v1\//)?h+=`raster/${c.path.replace(`/${W.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${c.path.replace(`/${W.TILE_URL_VERSION}/`,"")}`;let g=c.params;return i&&(g=g.filter(y=>!y.match(/^access_token=/))),g.length&&(h+=`?${g.join("&")}`),h}canonicalizeTileset(a,i){const c=!!i&&ft(i),h=[];for(const g of a.tiles||[])_t(g)?h.push(this.canonicalizeTileURL(g,c)):h.push(g);return h}_makeAPIURL(a,i){const c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=qt(W.API_URL);if(a.protocol=h.protocol,a.authority=h.authority,a.protocol==="http"){const g=a.params.indexOf("secure");g>=0&&a.params.splice(g,1)}if(h.path!=="/"&&(a.path=`${h.path}${a.path}`),!W.REQUIRE_ACCESS_TOKEN)return Kt(a);if(i=i||W.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return a.params=a.params.filter(g=>g.indexOf("access_token")===-1),a.params.push(`access_token=${i||""}`),Kt(a)}},o.ResourceType=Nr,o.SegmentVector=Gr,o.SourceCache=w0,o.StencilMode=s5,o.StructArrayLayout1ui2=t0,o.StructArrayLayout2f1f2i16=q1,o.StructArrayLayout2i4=ti,o.StructArrayLayout2ui4=Ia,o.StructArrayLayout3f12=Ci,o.StructArrayLayout3ui6=$s,o.StructArrayLayout4i8=fl,o.Texture=b8,o.Tile=c5,o.Transitionable=tr,o.Uniform1f=J1,o.Uniform1i=class extends Ma{constructor(a,i){super(a,i),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},o.Uniform2f=class extends Ma{constructor(a,i){super(a,i),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},o.Uniform3f=class extends Ma{constructor(a,i){super(a,i),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},o.Uniform4f=wu,o.UniformColor=Tu,o.UniformMatrix2f=class extends Ma{constructor(a,i){super(a,i),this.current=Q2}set(a){for(let i=0;i<4;i++)if(a[i]!==this.current[i]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}},o.UniformMatrix3f=class extends Ma{constructor(a,i){super(a,i),this.current=J2}set(a){for(let i=0;i<9;i++)if(a[i]!==this.current[i]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},o.UniformMatrix4f=class extends Ma{constructor(a,i){super(a,i),this.current=K2}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let i=1;i<16;i++)if(a[i]!==this.current[i]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},o.UnwrappedTileID=r5,o.ValidationError=He,o.VectorTileWorkerSource=class extends ke{constructor(a,i,c,h,g){super(),this.actor=a,this.layerIndex=i,this.availableImages=c,this.loadVectorData=g||Vd,this.loading={},this.loaded={},this.deduped=new Ud(a.scheduler),this.isSpriteLoaded=h,this.scheduler=a.scheduler}loadTile(a,i){const c=a.uid,h=a&&a.request,g=h&&h.collectResourceTiming,y=this.loading[c]=new fw(a);y.abort=this.loadVectorData(a,(b,S)=>{const P=!this.loading[c];if(delete this.loading[c],P||b||!S)return y.status="done",P||(this.loaded[c]=y),i(b);const M=S.rawData,L={};S.expires&&(L.expires=S.expires),S.cacheControl&&(L.cacheControl=S.cacheControl),y.vectorTile=S.vectorTile||new w.VectorTile(new Bu(M));const F=()=>{y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,(N,H)=>{if(N||!H)return i(N);const q={};if(g){const J=gd(h);J.length>0&&(q.resourceTiming=JSON.parse(JSON.stringify(J)))}i(null,ur({rawTileData:M.slice(0)},H,L,q))})};this.isSpriteLoaded?F():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(F,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):F()}),this.loaded=this.loaded||{},this.loaded[c]=y})}reloadTile(a,i){const c=this.loaded,h=a.uid,g=this;if(c&&c[h]){const y=c[h];y.showCollisionBoxes=a.showCollisionBoxes,y.enableTerrain=!!a.enableTerrain,y.projection=a.projection;const b=(S,P)=>{const M=y.reloadCallback;M&&(delete y.reloadCallback,y.parse(y.vectorTile,g.layerIndex,this.availableImages,g.actor,M)),i(S,P)};y.status==="parsing"?y.reloadCallback=b:y.status==="done"&&(y.vectorTile?y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,b):b())}}abortTile(a,i){const c=a.uid,h=this.loading[c];h&&(h.abort&&h.abort(),delete this.loading[c]),i()}removeTile(a,i){const c=this.loaded,h=a.uid;c&&c[h]&&delete c[h],i()}},o.WritingMode=ua,o.ZoomHistory=v,o.add=$t,o.addDynamicAttributes=K6,o.adjoint=function(a,i){var c=i[0],h=i[1],g=i[2],y=i[3],b=i[4],S=i[5],P=i[6],M=i[7],L=i[8];return a[0]=b*L-S*M,a[1]=g*M-h*L,a[2]=h*S-g*b,a[3]=S*P-y*L,a[4]=c*L-g*P,a[5]=g*y-c*S,a[6]=y*M-b*P,a[7]=h*P-c*M,a[8]=c*b-h*y,a},o.asyncAll=jo,o.bezier=Vo,o.bindAll=io,o.boundsAttributes=l5,o.bufferConvexPolygon=function(a,i){const c=[];for(let h=0;h<a.length;h++){const g=_s(h-1,-1,a.length-1),y=_s(h+1,-1,a.length-1),b=a[h],S=a[y],P=a[g].sub(b).unit(),M=S.sub(b).unit(),L=M.angleWithSep(P.x,P.y),F=P.add(M).unit().mult(-1*i/Math.sin(L/2));c.push(b.add(F))}return c},o.cacheEntryPossiblyAdded=function(a){di++,di>ls&&(a.getActor().send("enforceCacheSizeLimit",Yi),di=0)},o.calculateGlobeMatrix=Bd,o.calculateGlobeMercatorMatrix=function(a){const i=a.worldSize,c=En(a.center.lat,-85.051129,Oa),h=new O(a1(a.center.lng)*i,l1(c)*i),g=Fo(1,a.center.lat)*i,y=a.pixelsPerMeter,b=i/(g/a.pixelsPerMeter),S=Ee(new Float64Array(16));return _e(S,S,[h.x,h.y,0]),Me(S,S,[b,b,y]),S},o.clamp=En,o.clearTileCache=function(a){const i=V.caches.delete(br);a&&i.catch(a).then(()=>a())},o.clipLine=rd,o.clone=function(a){var i=new ee(16);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3],i[4]=a[4],i[5]=a[5],i[6]=a[6],i[7]=a[7],i[8]=a[8],i[9]=a[9],i[10]=a[10],i[11]=a[11],i[12]=a[12],i[13]=a[13],i[14]=a[14],i[15]=a[15],i},o.clone$1=fi,o.collisionCircleLayout=gb,o.config=W,o.conjugate=function(a,i){return a[0]=-i[0],a[1]=-i[1],a[2]=-i[2],a[3]=i[3],a},o.create=function(){var a=new ee(16);return ee!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},o.create$1=le,o.createExpression=Gl,o.createLayout=Mn,o.createStyleLayer=function(a){return a.type==="custom"?new Qb(a):new tw[a.type](a)},o.cross=Ne,o.degToRad=Ht,o.div=function(a,i,c){return a[0]=i[0]/c[0],a[1]=i[1]/c[1],a[2]=i[2]/c[2],a},o.dot=at,o.ease=to,o.easeCubicInOut=xo,o.emitValidationErrors=J3,o.endsWith=To,o.enforceCacheSizeLimit=function(a){qo(),Zr&&Zr.then(i=>{i.keys().then(c=>{for(let h=0;h<c.length-a;h++)i.delete(c[h])})})},o.evaluateSizeForFeature=u8,o.evaluateSizeForZoom=v4,o.evaluateVariableOffset=ld,o.evented=_i,o.exactEquals=function(a,i){return a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]&&a[3]===i[3]},o.exactEquals$1=function(a,i){return a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]},o.exported=Ri,o.exported$1=G,o.extend=ur,o.extend$1=bn,o.filterObject=Ho,o.fromMat4=function(a,i){return a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[4],a[4]=i[5],a[5]=i[6],a[6]=i[8],a[7]=i[9],a[8]=i[10],a},o.fromQuat=function(a,i){var c=i[0],h=i[1],g=i[2],y=i[3],b=c+c,S=h+h,P=g+g,M=c*b,L=h*b,F=h*S,N=g*b,H=g*S,q=g*P,J=y*b,oe=y*S,me=y*P;return a[0]=1-F-q,a[1]=L+me,a[2]=N-oe,a[3]=0,a[4]=L-me,a[5]=1-M-q,a[6]=H+J,a[7]=0,a[8]=N+oe,a[9]=H-J,a[10]=1-M-F,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},o.fromRotation=function(a,i){var c=Math.sin(i),h=Math.cos(i);return a[0]=h,a[1]=c,a[2]=0,a[3]=-c,a[4]=h,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.fromScaling=function(a,i){return a[0]=i[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=i[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=i[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},o.furthestTileCorner=function(a){const i=Math.round((a+45+360)%360/90)%4;return hi[i]},o.getAABBPointSquareDist=function(a,i,c){let h=0;for(let g=0;g<2;++g){const y=c?c[g]:0;a[g]>y&&(h+=(a[g]-y)*(a[g]-y)),i[g]<y&&(h+=(y-i[g])*(y-i[g]))}return h},o.getAnchorAlignment=X6,o.getAnchorJustification=G6,o.getBounds=function(a){let i=1/0,c=1/0,h=-1/0,g=-1/0;for(const y of a)i=Math.min(i,y.x),c=Math.min(c,y.y),h=Math.max(h,y.x),g=Math.max(g,y.y);return{min:new O(i,c),max:new O(h,g)}},o.getColumn=function(a,i){return[a[4*i],a[4*i+1],a[4*i+2],a[4*i+3]]},o.getImage=S1,o.getJSON=function(a,i){return si(ur(a,{type:"json"}),i)},o.getMapSessionAPI=$r,o.getPerformanceMeasurement=gd,o.getProjection=function(a){const i=Wd[a.name];if(!i)throw new Error(`Invalid projection name: ${a.name}`);return i.conic?function(c,h){if(h.parallels&&Math.abs(h.parallels[0]+h.parallels[1])<.01){let g=function(y){const b=Math.max(.01,Math.cos(Ht(y))),S=1/(2*Math.max(Math.PI*b,1/b));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(P,M){const L=Ht(P)*b,F=Math.sin(Ht(M))/b;return{x:L*S+.5,y:-F*S+.5,z:0}},unproject(P,M){const L=-(M-.5)/S,F=En(pn((P-.5)/S)/b,-180,180),N=Math.asin(En(L*b,-1,1)),H=En(pn(N),-85.051129,Oa);return new cr(F,H)}}}(h.parallels[0]);if(h.name==="lambertConformalConic"){const{project:y,unproject:b}=Wd.mercator;g={wrap:!0,supportsWorldCopies:!0,project:y,unproject:b}}return ur({},c,h,g)}return ur({},c,h)}(i,a):i},o.getRTLTextPluginStatus=Ni,o.getReferrer=cs,o.getTilePoint=function(a,{x:i,y:c},h=0){return new O(((i-h)*a.scale-a.x)*Vn,(c*a.scale-a.y)*Vn)},o.getTileVec3=function(a,i,c=0){return Vt(((i.x-c)*a.scale-a.x)*Vn,(i.y*a.scale-a.y)*Vn,n8(i.z,i.y))},o.getVideo=function(a,i){const c=V.document.createElement("video");c.muted=!0,c.onloadstart=function(){i(null,c)};for(let h=0;h<a.length;h++){const g=V.document.createElement("source");Ts(a[h])||(c.crossOrigin="Anonymous"),g.src=a[h],c.appendChild(g)}return{cancel:()=>{}}},o.globeBuffersForTileMesh=function(a,i,c,h){const g=a.context,y=a.transform;let b=i.globeGridBuffer,S=i.globePoleBuffer;if(!b){const P=f5.createGridVertices(c.canonical);b=i.globeGridBuffer=g.createVertexBuffer(P,Dd,!1)}if(!S){const P=f5.createPoleTriangleVertices(h,y.tileSize*h,c.canonical.y===0);S=i.globePoleBuffer=g.createVertexBuffer(P,Dd,!1)}return[b,S]},o.globeDenormalizeECEF=Nd,o.globeMatrixForTile=function(a,i){const c=Nd(A8(a)),h=((g=new Float64Array(16))[0]=(y=i)[0],g[1]=y[1],g[2]=y[2],g[3]=y[3],g[4]=y[4],g[5]=y[5],g[6]=y[6],g[7]=y[7],g[8]=y[8],g[9]=y[9],g[10]=y[10],g[11]=y[11],g[12]=y[12],g[13]=y[13],g[14]=y[14],g[15]=y[15],g);var g,y;return xt(h,h,c),h},o.globePoleMatrixForTile=function(a,i,c){const h=Ee(new Float64Array(16)),g=Math.pow(2,a.z),y=(a.x-g/2)/g*Math.PI*2,b=c.point,S=c.worldSize/(c.tileSize*g);return _e(h,h,[b.x,b.y,-c.worldSize/Math.PI/2]),Me(h,h,[S,S,S]),Fe(h,h,Ht(-c._center.lat)),yt(h,h,Ht(-c._center.lng)),yt(h,h,y),i&&Me(h,h,[1,-1,1]),h},o.globeTileBounds=A8,o.globeToMercatorTransition=function(a){return no(5,6,a)},o.identity=Ee,o.identity$1=Tn,o.invert=function(a,i){var c=i[0],h=i[1],g=i[2],y=i[3],b=i[4],S=i[5],P=i[6],M=i[7],L=i[8],F=i[9],N=i[10],H=i[11],q=i[12],J=i[13],oe=i[14],me=i[15],Ce=c*S-h*b,De=c*P-g*b,Ue=c*M-y*b,We=h*P-g*S,Xe=h*M-y*S,gt=g*M-y*P,pt=L*J-F*q,zt=L*oe-N*q,Ot=L*me-H*q,mt=F*oe-N*J,Lt=F*me-H*J,Ut=N*me-H*oe,wt=Ce*Ut-De*Lt+Ue*mt+We*Ot-Xe*zt+gt*pt;return wt?(a[0]=(S*Ut-P*Lt+M*mt)*(wt=1/wt),a[1]=(g*Lt-h*Ut-y*mt)*wt,a[2]=(J*gt-oe*Xe+me*We)*wt,a[3]=(N*Xe-F*gt-H*We)*wt,a[4]=(P*Ot-b*Ut-M*zt)*wt,a[5]=(c*Ut-g*Ot+y*zt)*wt,a[6]=(oe*Ue-q*gt-me*De)*wt,a[7]=(L*gt-N*Ue+H*De)*wt,a[8]=(b*Lt-S*Ot+M*pt)*wt,a[9]=(h*Ot-c*Lt-y*pt)*wt,a[10]=(q*Xe-J*Ue+me*Ce)*wt,a[11]=(F*Ue-L*Xe-H*Ce)*wt,a[12]=(S*zt-b*mt-P*pt)*wt,a[13]=(c*mt-h*zt+g*pt)*wt,a[14]=(J*De-q*We-oe*Ce)*wt,a[15]=(L*We-F*De+N*Ce)*wt,a):null},o.isMapAuthenticated=function(a){return ki.has(a)},o.isMapboxURL=ft,o.isSafariWithAntialiasingBug=function(a){const i=a.navigator?a.navigator.userAgent:null;return!!ii(a)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=uo,o.len=un,o.length=Bt,o.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},o.loadVectorTile=Vd,o.makeRequest=si,o.mercatorXfromLng=a1,o.mercatorYfromLat=l1,o.mercatorZfromAltitude=Fo,o.mul=xt,o.mul$1=vn,o.multiply=function(a,i,c){var h=i[0],g=i[1],y=i[2],b=i[3],S=i[4],P=i[5],M=i[6],L=i[7],F=i[8],N=c[0],H=c[1],q=c[2],J=c[3],oe=c[4],me=c[5],Ce=c[6],De=c[7],Ue=c[8];return a[0]=N*h+H*b+q*M,a[1]=N*g+H*S+q*L,a[2]=N*y+H*P+q*F,a[3]=J*h+oe*b+me*M,a[4]=J*g+oe*S+me*L,a[5]=J*y+oe*P+me*F,a[6]=Ce*h+De*b+Ue*M,a[7]=Ce*g+De*S+Ue*L,a[8]=Ce*y+De*P+Ue*F,a},o.multiply$1=ue,o.multiply$2=xn,o.nextPowerOfTwo=Mi,o.normalize=rt,o.normalize$1=function(a,i){var c=i[0],h=i[1],g=i[2],y=i[3],b=c*c+h*h+g*g+y*y;return b>0&&(b=1/Math.sqrt(b)),a[0]=c*b,a[1]=h*b,a[2]=g*b,a[3]=y*b,a},o.number=rr,o.ortho=function(a,i,c,h,g,y,b){var S=1/(i-c),P=1/(h-g),M=1/(y-b);return a[0]=-2*S,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*P,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*M,a[11]=0,a[12]=(i+c)*S,a[13]=(g+h)*P,a[14]=(b+y)*M,a[15]=1,a},o.pbf=Bu,o.perspective=function(a,i,c,h,g){var y,b=1/Math.tan(i/2);return a[0]=b/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,g!=null&&g!==1/0?(a[10]=(g+h)*(y=1/(h-g)),a[14]=2*g*h*y):(a[10]=-1,a[14]=-2*h),a},o.pick=function(a,i){const c={};for(let h=0;h<i.length;h++){const g=i[h];g in a&&(c[g]=a[g])}return c},o.plugin=$n,o.pointGeometry=O,o.polygonIntersectsBox=d4,o.polygonIntersectsPolygon=ec,o.polygonizeBounds=function(a,i,c=0,h=!0){const g=new O(c,c),y=a.sub(g),b=i.add(g),S=[y,new O(b.x,y.y),b,new O(y.x,b.y)];return h&&S.push(y),S},o.posAttributes=lw,o.postMapLoadEvent=Xn,o.postTurnstileEvent=ir,o.potpack=j6,o.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},o.radToDeg=pn,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(a){return a({pluginStatus:mn,pluginURL:Nn}),_i.on("pluginStateChange",a),a},o.removeAuthState=function(a){ki.delete(a)},o.renderColorRamp=d0,o.rotateX=Fe,o.rotateX$1=Qr,o.rotateY=yt,o.rotateZ=function(a,i,c){var h=Math.sin(c),g=Math.cos(c),y=i[0],b=i[1],S=i[2],P=i[3],M=i[4],L=i[5],F=i[6],N=i[7];return i!==a&&(a[8]=i[8],a[9]=i[9],a[10]=i[10],a[11]=i[11],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=y*g+M*h,a[1]=b*g+L*h,a[2]=S*g+F*h,a[3]=P*g+N*h,a[4]=M*g-y*h,a[5]=L*g-b*h,a[6]=F*g-S*h,a[7]=N*g-P*h,a},o.rotateZ$1=function(a,i,c){c*=.5;var h=i[0],g=i[1],y=i[2],b=i[3],S=Math.sin(c),P=Math.cos(c);return a[0]=h*P+g*S,a[1]=g*P-h*S,a[2]=y*P+b*S,a[3]=b*P-y*S,a},o.scale=Me,o.scale$1=function(a,i,c){return a[0]=i[0]*c,a[1]=i[1]*c,a[2]=i[2]*c,a[3]=i[3]*c,a},o.scale$2=ce,o.scaleAndAdd=ve,o.setCacheLimits=function(a,i){Yi=a,ls=i},o.setColumn=function(a,i,c){a[4*i+0]=c[0],a[4*i+1]=c[1],a[4*i+2]=c[2],a[4*i+3]=c[3]},o.setRTLTextPlugin=function(a,i,c=!1){if(mn===sn||mn===_n||mn===Jn)throw new Error("setRTLTextPlugin cannot be called multiple times.");Nn=Ri.resolveURL(a),mn=sn,hr=i,_r(),c||Ai()},o.smoothstep=no,o.spec=ge,o.storeAuthState=function(a,i){i?ki.add(a):ki.delete(a)},o.sub=Dt,o.subtract=Ct,o.symbolSize=_b,o.tileAABB=function(a,i,c,h,g,y,b,S,P){if(P.name==="globe"){const H=A8(new r5(y,new w8(c,h,g)).canonical).getCorners(),q=Number.MAX_VALUE,J=[-q,-q,-q],oe=[q,q,q],me=Bd(a,i);for(let Ce=0;Ce<H.length;Ce++)Be(H[Ce],H[Ce],me),L=oe,F=H[Ce],(M=oe)[0]=Math.min(L[0],F[0]),M[1]=Math.min(L[1],F[1]),M[2]=Math.min(L[2],F[2]),Oe(J,J,H[Ce]);return new fo(oe,J)}var M,L,F;const N=A4({z:c,x:h,y:g},P);return new fo([(y+N.x/N.scale)*i,i*(N.y/N.scale),b],[(y+N.x2/N.scale)*i,i*(N.y2/N.scale),S])},o.tileTransform=A4,o.transformMat3=function(a,i,c){var h=i[0],g=i[1],y=i[2];return a[0]=h*c[0]+g*c[3]+y*c[6],a[1]=h*c[1]+g*c[4]+y*c[7],a[2]=h*c[2]+g*c[5]+y*c[8],a},o.transformMat4=Be,o.transformMat4$1=fn,o.transformQuat=ot,o.translate=_e,o.transpose=function(a,i){if(a===i){var c=i[1],h=i[2],g=i[5];a[1]=i[3],a[2]=i[6],a[3]=c,a[5]=i[7],a[6]=h,a[7]=g}else a[0]=i[0],a[1]=i[3],a[2]=i[6],a[3]=i[1],a[4]=i[4],a[5]=i[7],a[6]=i[2],a[7]=i[5],a[8]=i[8];return a},o.triggerPluginCompletionEvent=fr,o.uniqueId=$o,o.validateCustomStyleLayer=function(a){const i=[],c=a.id;return c===void 0&&i.push({message:`layers.${c}: missing required property "id"`}),a.render===void 0&&i.push({message:`layers.${c}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&i.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),i},o.validateFog=K3,o.validateLight=n1,o.validateStyle=Vs,o.values=bo,o.vectorTile=w,o.version=T,o.warnOnce=gr,o.window=V,o.wrap=_s}),f(["./shared"],function(o){function T(de){const W=typeof de;if(W==="number"||W==="boolean"||W==="string"||de==null)return JSON.stringify(de);if(Array.isArray(de)){let ye="[";for(const Re of de)ye+=`${T(Re)},`;return`${ye}]`}const G=Object.keys(de).sort();let he="{";for(let ye=0;ye<G.length;ye++)he+=`${JSON.stringify(G[ye])}:${T(de[G[ye]])},`;return`${he}}`}function C(de){let W="";for(const G of o.refProperties)W+=`/${T(de[G])}`;return W}class R{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,G){for(const ye of W)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=o.createStyleLayer(ye)).compileFilter(),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of G)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const he=function(ye,Re){const $e={};for(let Le=0;Le<ye.length;Le++){const Ye=Re&&Re[ye[Le].id]||C(ye[Le]);Re&&(Re[ye[Le].id]=Ye);let ft=$e[Ye];ft||(ft=$e[Ye]=[]),ft.push(ye[Le])}const Ve=[];for(const Le in $e)Ve.push($e[Le]);return Ve}(o.values(this._layerConfigs),this.keyCache);for(const ye of he){const Re=ye.map(_t=>this._layers[_t.id]),$e=Re[0];if($e.visibility==="none")continue;const Ve=$e.source||"";let Le=this.familiesBySource[Ve];Le||(Le=this.familiesBySource[Ve]={});const Ye=$e.sourceLayer||"_geojsonTileLayer";let ft=Le[Ye];ft||(ft=Le[Ye]=[]),ft.push(Re)}}}const{ImageBitmap:O}=o.window;class U{loadTile(W,G){const{uid:he,encoding:ye,rawImageData:Re,padding:$e,buildQuadTree:Ve}=W,Le=O&&Re instanceof O?this.getImageData(Re,$e):Re;G(null,new o.DEMData(he,Le,ye,$e<1,Ve))}getImageData(W,G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);const he=this.offscreenCanvasContext.getImageData(-G,-G,W.width+2*G,W.height+2*G);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:he.width,height:he.height},he.data)}}var V=function de(W,G){var he,ye=W&&W.type;if(ye==="FeatureCollection")for(he=0;he<W.features.length;he++)de(W.features[he],G);else if(ye==="GeometryCollection")for(he=0;he<W.geometries.length;he++)de(W.geometries[he],G);else if(ye==="Feature")de(W.geometry,G);else if(ye==="Polygon")Y(W.coordinates,G);else if(ye==="MultiPolygon")for(he=0;he<W.coordinates.length;he++)Y(W.coordinates[he],G);return W};function Y(de,W){if(de.length!==0){ee(de[0],W);for(var G=1;G<de.length;G++)ee(de[G],!1)}}function ee(de,W){for(var G=0,he=0,ye=0,Re=de.length,$e=Re-1;ye<Re;$e=ye++){var Ve=(de[ye][0]-de[$e][0])*(de[$e][1]+de[ye][1]),Le=G+Ve;he+=Math.abs(G)>=Math.abs(Ve)?G-Le+Ve:Ve-Le+G,G=Le}G+he>=0!=!!W&&de.reverse()}const le=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ee{constructor(W){this._feature=W,this.extent=o.EXTENT,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){const W=[];for(const G of this._feature.geometry)W.push([new o.pointGeometry(G[0],G[1])]);return W}{const W=[];for(const G of this._feature.geometry){const he=[];for(const ye of G)he.push(new o.pointGeometry(ye[0],ye[1]));W.push(he)}return W}}toGeoJSON(W,G,he){return le.call(this,W,G,he)}}class ue{constructor(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=W.length,this._features=W}feature(W){return new Ee(this._features[W])}}var _e=o.vectorTile.VectorTileFeature,Me=Fe;function Fe(de,W){this.options=W||{},this.features=de,this.length=de.length}function yt(de,W){this.id=typeof de.id=="number"?de.id:void 0,this.type=de.type,this.rawGeometry=de.type===1?[de.geometry]:de.geometry,this.properties=de.tags,this.extent=W||4096}Fe.prototype.feature=function(de){return new yt(this.features[de],this.options.extent)},yt.prototype.loadGeometry=function(){var de=this.rawGeometry;this.geometry=[];for(var W=0;W<de.length;W++){for(var G=de[W],he=[],ye=0;ye<G.length;ye++)he.push(new o.pointGeometry(G[ye][0],G[ye][1]));this.geometry.push(he)}return this.geometry},yt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var de=this.geometry,W=1/0,G=-1/0,he=1/0,ye=-1/0,Re=0;Re<de.length;Re++)for(var $e=de[Re],Ve=0;Ve<$e.length;Ve++){var Le=$e[Ve];W=Math.min(W,Le.x),G=Math.max(G,Le.x),he=Math.min(he,Le.y),ye=Math.max(ye,Le.y)}return[W,he,G,ye]},yt.prototype.toGeoJSON=_e.prototype.toGeoJSON;var xt=kt,ht=Me;function kt(de){var W=new o.pbf;return function(G,he){for(var ye in G.layers)he.writeMessage(3,Bt,G.layers[ye])}(de,W),W.finish()}function Bt(de,W){var G;W.writeVarintField(15,de.version||1),W.writeStringField(1,de.name||""),W.writeVarintField(5,de.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(G=0;G<de.length;G++)he.feature=de.feature(G),W.writeMessage(2,Vt,he);var ye=he.keys;for(G=0;G<ye.length;G++)W.writeStringField(3,ye[G]);var Re=he.values;for(G=0;G<Re.length;G++)W.writeMessage(4,ce,Re[G])}function Vt(de,W){var G=de.feature;G.id!==void 0&&W.writeVarintField(1,G.id),W.writeMessage(2,$t,de),W.writeVarintField(3,G.type),W.writeMessage(4,Oe,G)}function $t(de,W){var G=de.feature,he=de.keys,ye=de.values,Re=de.keycache,$e=de.valuecache;for(var Ve in G.properties){var Le=G.properties[Ve],Ye=Re[Ve];if(Le!==null){Ye===void 0&&(he.push(Ve),Re[Ve]=Ye=he.length-1),W.writeVarint(Ye);var ft=typeof Le;ft!=="string"&&ft!=="boolean"&&ft!=="number"&&(Le=JSON.stringify(Le));var _t=ft+":"+Le,Tt=$e[_t];Tt===void 0&&(ye.push(Le),$e[_t]=Tt=ye.length-1),W.writeVarint(Tt)}}}function Ct(de,W){return(W<<3)+(7&de)}function xn(de){return de<<1^de>>31}function Oe(de,W){for(var G=de.loadGeometry(),he=de.type,ye=0,Re=0,$e=G.length,Ve=0;Ve<$e;Ve++){var Le=G[Ve],Ye=1;he===1&&(Ye=Le.length),W.writeVarint(Ct(1,Ye));for(var ft=he===3?Le.length-1:Le.length,_t=0;_t<ft;_t++){_t===1&&he!==1&&W.writeVarint(Ct(2,ft-1));var Tt=Le[_t].x-ye,qt=Le[_t].y-Re;W.writeVarint(xn(Tt)),W.writeVarint(xn(qt)),ye+=Tt,Re+=qt}he===3&&W.writeVarint(Ct(7,1))}}function ce(de,W){var G=typeof de;G==="string"?W.writeStringField(1,de):G==="boolean"?W.writeBooleanField(7,de):G==="number"&&(de%1!=0?W.writeDoubleField(3,de):de<0?W.writeSVarintField(6,de):W.writeVarintField(5,de))}function ve(de,W,G,he,ye,Re){if(ye-he<=G)return;const $e=he+ye>>1;rt(de,W,$e,he,ye,Re%2),ve(de,W,G,he,$e-1,Re+1),ve(de,W,G,$e+1,ye,Re+1)}function rt(de,W,G,he,ye,Re){for(;ye>he;){if(ye-he>600){const Ye=ye-he+1,ft=G-he+1,_t=Math.log(Ye),Tt=.5*Math.exp(2*_t/3),qt=.5*Math.sqrt(_t*Tt*(Ye-Tt)/Ye)*(ft-Ye/2<0?-1:1);rt(de,W,G,Math.max(he,Math.floor(G-ft*Tt/Ye+qt)),Math.min(ye,Math.floor(G+(Ye-ft)*Tt/Ye+qt)),Re)}const $e=W[2*G+Re];let Ve=he,Le=ye;for(at(de,W,he,G),W[2*ye+Re]>$e&&at(de,W,he,ye);Ve<Le;){for(at(de,W,Ve,Le),Ve++,Le--;W[2*Ve+Re]<$e;)Ve++;for(;W[2*Le+Re]>$e;)Le--}W[2*he+Re]===$e?at(de,W,he,Le):(Le++,at(de,W,Le,ye)),Le<=G&&(he=Le+1),G<=Le&&(ye=Le-1)}}function at(de,W,G,he){Ne(de,G,he),Ne(W,2*G,2*he),Ne(W,2*G+1,2*he+1)}function Ne(de,W,G){const he=de[W];de[W]=de[G],de[G]=he}function Be(de,W,G,he){const ye=de-G,Re=W-he;return ye*ye+Re*Re}xt.fromVectorTileJs=kt,xt.fromGeojsonVt=function(de,W){W=W||{};var G={};for(var he in de)G[he]=new Me(de[he].features,W),G[he].name=he,G[he].version=W.version,G[he].extent=W.extent;return kt({layers:G})},xt.GeoJSONWrapper=ht;const ot=de=>de[0],Ft=de=>de[1];class Dt{constructor(W,G=ot,he=Ft,ye=64,Re=Float64Array){this.nodeSize=ye,this.points=W;const $e=W.length<65536?Uint16Array:Uint32Array,Ve=this.ids=new $e(W.length),Le=this.coords=new Re(2*W.length);for(let Ye=0;Ye<W.length;Ye++)Ve[Ye]=Ye,Le[2*Ye]=G(W[Ye]),Le[2*Ye+1]=he(W[Ye]);ve(Ve,Le,ye,0,Ve.length-1,0)}range(W,G,he,ye){return function(Re,$e,Ve,Le,Ye,ft,_t){const Tt=[0,Re.length-1,0],qt=[];let Kt,tn;for(;Tt.length;){const on=Tt.pop(),Sn=Tt.pop(),ir=Tt.pop();if(Sn-ir<=_t){for(let sr=ir;sr<=Sn;sr++)Kt=$e[2*sr],tn=$e[2*sr+1],Kt>=Ve&&Kt<=Ye&&tn>=Le&&tn<=ft&&qt.push(Re[sr]);continue}const yr=Math.floor((ir+Sn)/2);Kt=$e[2*yr],tn=$e[2*yr+1],Kt>=Ve&&Kt<=Ye&&tn>=Le&&tn<=ft&&qt.push(Re[yr]);const Xn=(on+1)%2;(on===0?Ve<=Kt:Le<=tn)&&(Tt.push(ir),Tt.push(yr-1),Tt.push(Xn)),(on===0?Ye>=Kt:ft>=tn)&&(Tt.push(yr+1),Tt.push(Sn),Tt.push(Xn))}return qt}(this.ids,this.coords,W,G,he,ye,this.nodeSize)}within(W,G,he){return function(ye,Re,$e,Ve,Le,Ye){const ft=[0,ye.length-1,0],_t=[],Tt=Le*Le;for(;ft.length;){const qt=ft.pop(),Kt=ft.pop(),tn=ft.pop();if(Kt-tn<=Ye){for(let Xn=tn;Xn<=Kt;Xn++)Be(Re[2*Xn],Re[2*Xn+1],$e,Ve)<=Tt&&_t.push(ye[Xn]);continue}const on=Math.floor((tn+Kt)/2),Sn=Re[2*on],ir=Re[2*on+1];Be(Sn,ir,$e,Ve)<=Tt&&_t.push(ye[on]);const yr=(qt+1)%2;(qt===0?$e-Le<=Sn:Ve-Le<=ir)&&(ft.push(tn),ft.push(on-1),ft.push(yr)),(qt===0?$e+Le>=Sn:Ve+Le>=ir)&&(ft.push(on+1),ft.push(Kt),ft.push(yr))}return _t}(this.ids,this.coords,W,G,he,this.nodeSize)}}const vn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:de=>de},un=Math.fround||(fn=new Float32Array(1),de=>(fn[0]=+de,fn[0]));var fn;class yn{constructor(W){this.options=hi(Object.create(vn),W),this.trees=new Array(this.options.maxZoom+1)}load(W){const{log:G,minZoom:he,maxZoom:ye,nodeSize:Re}=this.options;G&&console.time("total time");const $e=`prepare ${W.length} points`;G&&console.time($e),this.points=W;let Ve=[];for(let Le=0;Le<W.length;Le++)W[Le].geometry&&Ve.push(Qr(W[Le],Le));this.trees[ye+1]=new Dt(Ve,xo,Vo,Re,Float32Array),G&&console.timeEnd($e);for(let Le=ye;Le>=he;Le--){const Ye=+Date.now();Ve=this._cluster(Ve,Le),this.trees[Le]=new Dt(Ve,xo,Vo,Re,Float32Array),G&&console.log("z%d: %d clusters in %dms",Le,Ve.length,+Date.now()-Ye)}return G&&console.timeEnd("total time"),this}getClusters(W,G){let he=((W[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,W[1]));let Re=W[2]===180?180:((W[2]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)he=-180,Re=180;else if(he>Re){const ft=this.getClusters([he,ye,180,$e],G),_t=this.getClusters([-180,ye,Re,$e],G);return ft.concat(_t)}const Ve=this.trees[this._limitZoom(G)],Le=Ve.range(Xi(he),Ht($e),Xi(Re),Ht(ye)),Ye=[];for(const ft of Le){const _t=Ve.points[ft];Ye.push(_t.numPoints?Or(_t):this.points[_t.index])}return Ye}getChildren(W){const G=this._getOriginId(W),he=this._getOriginZoom(W),ye="No cluster with the specified id.",Re=this.trees[he];if(!Re)throw new Error(ye);const $e=Re.points[G];if(!$e)throw new Error(ye);const Ve=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Le=Re.within($e.x,$e.y,Ve),Ye=[];for(const ft of Le){const _t=Re.points[ft];_t.parentId===W&&Ye.push(_t.numPoints?Or(_t):this.points[_t.index])}if(Ye.length===0)throw new Error(ye);return Ye}getLeaves(W,G,he){const ye=[];return this._appendLeaves(ye,W,G=G||10,he=he||0,0),ye}getTile(W,G,he){const ye=this.trees[this._limitZoom(W)],Re=Math.pow(2,W),{extent:$e,radius:Ve}=this.options,Le=Ve/$e,Ye=(he-Le)/Re,ft=(he+1+Le)/Re,_t={features:[]};return this._addTileFeatures(ye.range((G-Le)/Re,Ye,(G+1+Le)/Re,ft),ye.points,G,he,Re,_t),G===0&&this._addTileFeatures(ye.range(1-Le/Re,Ye,1,ft),ye.points,Re,he,Re,_t),G===Re-1&&this._addTileFeatures(ye.range(0,Ye,Le/Re,ft),ye.points,-1,he,Re,_t),_t.features.length?_t:null}getClusterExpansionZoom(W){let G=this._getOriginZoom(W)-1;for(;G<=this.options.maxZoom;){const he=this.getChildren(W);if(G++,he.length!==1)break;W=he[0].properties.cluster_id}return G}_appendLeaves(W,G,he,ye,Re){const $e=this.getChildren(G);for(const Ve of $e){const Le=Ve.properties;if(Le&&Le.cluster?Re+Le.point_count<=ye?Re+=Le.point_count:Re=this._appendLeaves(W,Le.cluster_id,he,ye,Re):Re<ye?Re++:W.push(Ve),W.length===he)break}return Re}_addTileFeatures(W,G,he,ye,Re,$e){for(const Ve of W){const Le=G[Ve],Ye=Le.numPoints;let ft,_t,Tt;if(Ye)ft=as(Le),_t=Le.x,Tt=Le.y;else{const tn=this.points[Le.index];ft=tn.properties,_t=Xi(tn.geometry.coordinates[0]),Tt=Ht(tn.geometry.coordinates[1])}const qt={type:1,geometry:[[Math.round(this.options.extent*(_t*Re-he)),Math.round(this.options.extent*(Tt*Re-ye))]],tags:ft};let Kt;Ye?Kt=Le.id:this.options.generateId?Kt=Le.index:this.points[Le.index].id&&(Kt=this.points[Le.index].id),Kt!==void 0&&(qt.id=Kt),$e.features.push(qt)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(+W,this.options.maxZoom+1))}_cluster(W,G){const he=[],{radius:ye,extent:Re,reduce:$e,minPoints:Ve}=this.options,Le=ye/(Re*Math.pow(2,G));for(let Ye=0;Ye<W.length;Ye++){const ft=W[Ye];if(ft.zoom<=G)continue;ft.zoom=G;const _t=this.trees[G+1],Tt=_t.within(ft.x,ft.y,Le),qt=ft.numPoints||1;let Kt=qt;for(const tn of Tt){const on=_t.points[tn];on.zoom>G&&(Kt+=on.numPoints||1)}if(Kt>qt&&Kt>=Ve){let tn=ft.x*qt,on=ft.y*qt,Sn=$e&&qt>1?this._map(ft,!0):null;const ir=(Ye<<5)+(G+1)+this.points.length;for(const yr of Tt){const Xn=_t.points[yr];if(Xn.zoom<=G)continue;Xn.zoom=G;const sr=Xn.numPoints||1;tn+=Xn.x*sr,on+=Xn.y*sr,Xn.parentId=ir,$e&&(Sn||(Sn=this._map(ft,!0)),$e(Sn,this._map(Xn)))}ft.parentId=ir,he.push(Tn(tn/Kt,on/Kt,ir,Kt,Sn))}else if(he.push(ft),Kt>1)for(const tn of Tt){const on=_t.points[tn];on.zoom<=G||(on.zoom=G,he.push(on))}}return he}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,G){if(W.numPoints)return G?hi({},W.properties):W.properties;const he=this.points[W.index].properties,ye=this.options.map(he);return G&&ye===he?hi({},ye):ye}}function Tn(de,W,G,he,ye){return{x:un(de),y:un(W),zoom:1/0,id:G,parentId:-1,numPoints:he,properties:ye}}function Qr(de,W){const[G,he]=de.geometry.coordinates;return{x:un(Xi(G)),y:un(Ht(he)),zoom:1/0,index:W,parentId:-1}}function Or(de){return{type:"Feature",id:de.id,properties:as(de),geometry:{type:"Point",coordinates:[(W=de.x,360*(W-.5)),pn(de.y)]}};var W}function as(de){const W=de.numPoints,G=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W;return hi(hi({},de.properties),{cluster:!0,cluster_id:de.id,point_count:W,point_count_abbreviated:G})}function Xi(de){return de/360+.5}function Ht(de){const W=Math.sin(de*Math.PI/180),G=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return G<0?0:G>1?1:G}function pn(de){const W=(180-360*de)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function hi(de,W){for(const G in W)de[G]=W[G];return de}function xo(de){return de.x}function Vo(de){return de.y}function to(de,W,G,he){for(var ye,Re=he,$e=G-W>>1,Ve=G-W,Le=de[W],Ye=de[W+1],ft=de[G],_t=de[G+1],Tt=W+3;Tt<G;Tt+=3){var qt=En(de[Tt],de[Tt+1],Le,Ye,ft,_t);if(qt>Re)ye=Tt,Re=qt;else if(qt===Re){var Kt=Math.abs(Tt-$e);Kt<Ve&&(ye=Tt,Ve=Kt)}}Re>he&&(ye-W>3&&to(de,W,ye,he),de[ye+2]=Re,G-ye>3&&to(de,ye,G,he))}function En(de,W,G,he,ye,Re){var $e=ye-G,Ve=Re-he;if($e!==0||Ve!==0){var Le=((de-G)*$e+(W-he)*Ve)/($e*$e+Ve*Ve);Le>1?(G=ye,he=Re):Le>0&&(G+=$e*Le,he+=Ve*Le)}return($e=de-G)*$e+(Ve=W-he)*Ve}function no(de,W,G,he){var ye={id:de===void 0?null:de,type:W,geometry:G,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Re){var $e=Re.geometry,Ve=Re.type;if(Ve==="Point"||Ve==="MultiPoint"||Ve==="LineString")_s(Re,$e);else if(Ve==="Polygon"||Ve==="MultiLineString")for(var Le=0;Le<$e.length;Le++)_s(Re,$e[Le]);else if(Ve==="MultiPolygon")for(Le=0;Le<$e.length;Le++)for(var Ye=0;Ye<$e[Le].length;Ye++)_s(Re,$e[Le][Ye])}(ye),ye}function _s(de,W){for(var G=0;G<W.length;G+=3)de.minX=Math.min(de.minX,W[G]),de.minY=Math.min(de.minY,W[G+1]),de.maxX=Math.max(de.maxX,W[G]),de.maxY=Math.max(de.maxY,W[G+1])}function jo(de,W,G,he){if(W.geometry){var ye=W.geometry.coordinates,Re=W.geometry.type,$e=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),Ve=[],Le=W.id;if(G.promoteId?Le=W.properties[G.promoteId]:G.generateId&&(Le=he||0),Re==="Point")bo(ye,Ve);else if(Re==="MultiPoint")for(var Ye=0;Ye<ye.length;Ye++)bo(ye[Ye],Ve);else if(Re==="LineString")ur(ye,Ve,$e,!1);else if(Re==="MultiLineString"){if(G.lineMetrics){for(Ye=0;Ye<ye.length;Ye++)ur(ye[Ye],Ve=[],$e,!1),de.push(no(Le,"LineString",Ve,W.properties));return}wo(ye,Ve,$e,!1)}else if(Re==="Polygon")wo(ye,Ve,$e,!0);else{if(Re!=="MultiPolygon"){if(Re==="GeometryCollection"){for(Ye=0;Ye<W.geometry.geometries.length;Ye++)jo(de,{id:Le,geometry:W.geometry.geometries[Ye],properties:W.properties},G,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ye=0;Ye<ye.length;Ye++){var ft=[];wo(ye[Ye],ft,$e,!0),Ve.push(ft)}}de.push(no(Le,Re,Ve,W.properties))}}function bo(de,W){W.push($o(de[0])),W.push(Wo(de[1])),W.push(0)}function ur(de,W,G,he){for(var ye,Re,$e=0,Ve=0;Ve<de.length;Ve++){var Le=$o(de[Ve][0]),Ye=Wo(de[Ve][1]);W.push(Le),W.push(Ye),W.push(0),Ve>0&&($e+=he?(ye*Ye-Le*Re)/2:Math.sqrt(Math.pow(Le-ye,2)+Math.pow(Ye-Re,2))),ye=Le,Re=Ye}var ft=W.length-3;W[2]=1,to(W,0,ft,G),W[ft+2]=1,W.size=Math.abs($e),W.start=0,W.end=W.size}function wo(de,W,G,he){for(var ye=0;ye<de.length;ye++){var Re=[];ur(de[ye],Re,G,he),W.push(Re)}}function $o(de){return de/360+.5}function Wo(de){var W=Math.sin(de*Math.PI/180),G=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return G<0?0:G>1?1:G}function Mi(de,W,G,he,ye,Re,$e,Ve){if(he/=W,Re>=(G/=W)&&$e<he)return de;if($e<G||Re>=he)return null;for(var Le=[],Ye=0;Ye<de.length;Ye++){var ft=de[Ye],_t=ft.geometry,Tt=ft.type,qt=ye===0?ft.minX:ft.minY,Kt=ye===0?ft.maxX:ft.maxY;if(qt>=G&&Kt<he)Le.push(ft);else if(!(Kt<G||qt>=he)){var tn=[];if(Tt==="Point"||Tt==="MultiPoint")ro(_t,tn,G,he,ye);else if(Tt==="LineString")io(_t,tn,G,he,ye,!1,Ve.lineMetrics);else if(Tt==="MultiLineString")ys(_t,tn,G,he,ye,!1);else if(Tt==="Polygon")ys(_t,tn,G,he,ye,!0);else if(Tt==="MultiPolygon")for(var on=0;on<_t.length;on++){var Sn=[];ys(_t[on],Sn,G,he,ye,!0),Sn.length&&tn.push(Sn)}if(tn.length){if(Ve.lineMetrics&&Tt==="LineString"){for(on=0;on<tn.length;on++)Le.push(no(ft.id,Tt,tn[on],ft.tags));continue}Tt!=="LineString"&&Tt!=="MultiLineString"||(tn.length===1?(Tt="LineString",tn=tn[0]):Tt="MultiLineString"),Tt!=="Point"&&Tt!=="MultiPoint"||(Tt=tn.length===3?"Point":"MultiPoint"),Le.push(no(ft.id,Tt,tn,ft.tags))}}}return Le.length?Le:null}function ro(de,W,G,he,ye){for(var Re=0;Re<de.length;Re+=3){var $e=de[Re+ye];$e>=G&&$e<=he&&(W.push(de[Re]),W.push(de[Re+1]),W.push(de[Re+2]))}}function io(de,W,G,he,ye,Re,$e){for(var Ve,Le,Ye=To(de),ft=ye===0?fi:Eo,_t=de.start,Tt=0;Tt<de.length-3;Tt+=3){var qt=de[Tt],Kt=de[Tt+1],tn=de[Tt+2],on=de[Tt+3],Sn=de[Tt+4],ir=ye===0?qt:Kt,yr=ye===0?on:Sn,Xn=!1;$e&&(Ve=Math.sqrt(Math.pow(qt-on,2)+Math.pow(Kt-Sn,2))),ir<G?yr>G&&(Le=ft(Ye,qt,Kt,on,Sn,G),$e&&(Ye.start=_t+Ve*Le)):ir>he?yr<he&&(Le=ft(Ye,qt,Kt,on,Sn,he),$e&&(Ye.start=_t+Ve*Le)):Ho(Ye,qt,Kt,tn),yr<G&&ir>=G&&(Le=ft(Ye,qt,Kt,on,Sn,G),Xn=!0),yr>he&&ir<=he&&(Le=ft(Ye,qt,Kt,on,Sn,he),Xn=!0),!Re&&Xn&&($e&&(Ye.end=_t+Ve*Le),W.push(Ye),Ye=To(de)),$e&&(_t+=Ve)}var sr=de.length-3;qt=de[sr],Kt=de[sr+1],tn=de[sr+2],(ir=ye===0?qt:Kt)>=G&&ir<=he&&Ho(Ye,qt,Kt,tn),sr=Ye.length-3,Re&&sr>=3&&(Ye[sr]!==Ye[0]||Ye[sr+1]!==Ye[1])&&Ho(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&W.push(Ye)}function To(de){var W=[];return W.size=de.size,W.start=de.start,W.end=de.end,W}function ys(de,W,G,he,ye,Re){for(var $e=0;$e<de.length;$e++)io(de[$e],W,G,he,ye,Re,!1)}function Ho(de,W,G,he){de.push(W),de.push(G),de.push(he)}function fi(de,W,G,he,ye,Re){var $e=(Re-W)/(he-W);return de.push(Re),de.push(G+(ye-G)*$e),de.push(1),$e}function Eo(de,W,G,he,ye,Re){var $e=(Re-G)/(ye-G);return de.push(W+(he-W)*$e),de.push(Re),de.push(1),$e}function gr(de,W){for(var G=[],he=0;he<de.length;he++){var ye,Re=de[he],$e=Re.type;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")ye=Zi(Re.geometry,W);else if($e==="MultiLineString"||$e==="Polygon"){ye=[];for(var Ve=0;Ve<Re.geometry.length;Ve++)ye.push(Zi(Re.geometry[Ve],W))}else if($e==="MultiPolygon")for(ye=[],Ve=0;Ve<Re.geometry.length;Ve++){for(var Le=[],Ye=0;Ye<Re.geometry[Ve].length;Ye++)Le.push(Zi(Re.geometry[Ve][Ye],W));ye.push(Le)}G.push(no(Re.id,$e,ye,Re.tags))}return G}function Zi(de,W){var G=[];G.size=de.size,de.start!==void 0&&(G.start=de.start,G.end=de.end);for(var he=0;he<de.length;he+=3)G.push(de[he]+W,de[he+1],de[he+2]);return G}function Xo(de,W){if(de.transformed)return de;var G,he,ye,Re=1<<de.z,$e=de.x,Ve=de.y;for(G=0;G<de.features.length;G++){var Le=de.features[G],Ye=Le.geometry,ft=Le.type;if(Le.geometry=[],ft===1)for(he=0;he<Ye.length;he+=2)Le.geometry.push(vs(Ye[he],Ye[he+1],W,Re,$e,Ve));else for(he=0;he<Ye.length;he++){var _t=[];for(ye=0;ye<Ye[he].length;ye+=2)_t.push(vs(Ye[he][ye],Ye[he][ye+1],W,Re,$e,Ve));Le.geometry.push(_t)}}return de.transformed=!0,de}function vs(de,W,G,he,ye,Re){return[Math.round(G*(de*he-ye)),Math.round(G*(W*he-Re))]}function so(de,W,G,he,ye){for(var Re=W===ye.maxZoom?0:ye.tolerance/((1<<W)*ye.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:G,y:he,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ve=0;Ve<de.length;Ve++){$e.numFeatures++,xs($e,de[Ve],Re,ye);var Le=de[Ve].minX,Ye=de[Ve].minY,ft=de[Ve].maxX,_t=de[Ve].maxY;Le<$e.minX&&($e.minX=Le),Ye<$e.minY&&($e.minY=Ye),ft>$e.maxX&&($e.maxX=ft),_t>$e.maxY&&($e.maxY=_t)}return $e}function xs(de,W,G,he){var ye=W.geometry,Re=W.type,$e=[];if(Re==="Point"||Re==="MultiPoint")for(var Ve=0;Ve<ye.length;Ve+=3)$e.push(ye[Ve]),$e.push(ye[Ve+1]),de.numPoints++,de.numSimplified++;else if(Re==="LineString")bs($e,ye,de,G,!1,!1);else if(Re==="MultiLineString"||Re==="Polygon")for(Ve=0;Ve<ye.length;Ve++)bs($e,ye[Ve],de,G,Re==="Polygon",Ve===0);else if(Re==="MultiPolygon")for(var Le=0;Le<ye.length;Le++){var Ye=ye[Le];for(Ve=0;Ve<Ye.length;Ve++)bs($e,Ye[Ve],de,G,!0,Ve===0)}if($e.length){var ft=W.tags||null;if(Re==="LineString"&&he.lineMetrics){for(var _t in ft={},W.tags)ft[_t]=W.tags[_t];ft.mapbox_clip_start=ye.start/ye.size,ft.mapbox_clip_end=ye.end/ye.size}var Tt={geometry:$e,type:Re==="Polygon"||Re==="MultiPolygon"?3:Re==="LineString"||Re==="MultiLineString"?2:1,tags:ft};W.id!==null&&(Tt.id=W.id),de.features.push(Tt)}}function bs(de,W,G,he,ye,Re){var $e=he*he;if(he>0&&W.size<(ye?$e:he))G.numPoints+=W.length/3;else{for(var Ve=[],Le=0;Le<W.length;Le+=3)(he===0||W[Le+2]>$e)&&(G.numSimplified++,Ve.push(W[Le]),Ve.push(W[Le+1])),G.numPoints++;ye&&function(Ye,ft){for(var _t=0,Tt=0,qt=Ye.length,Kt=qt-2;Tt<qt;Kt=Tt,Tt+=2)_t+=(Ye[Tt]-Ye[Kt])*(Ye[Tt+1]+Ye[Kt+1]);if(_t>0===ft)for(Tt=0,qt=Ye.length;Tt<qt/2;Tt+=2){var tn=Ye[Tt],on=Ye[Tt+1];Ye[Tt]=Ye[qt-2-Tt],Ye[Tt+1]=Ye[qt-1-Tt],Ye[qt-2-Tt]=tn,Ye[qt-1-Tt]=on}}(Ve,Re),de.push(Ve)}}function qi(de,W){var G=(W=this.options=function(ye,Re){for(var $e in Re)ye[$e]=Re[$e];return ye}(Object.create(this.options),W)).debug;if(G&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");var he=function(ye,Re){var $e=[];if(ye.type==="FeatureCollection")for(var Ve=0;Ve<ye.features.length;Ve++)jo($e,ye.features[Ve],Re,Ve);else jo($e,ye.type==="Feature"?ye:{geometry:ye},Re);return $e}(de,W);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=function(ye,Re){var $e=Re.buffer/Re.extent,Ve=ye,Le=Mi(ye,1,-1-$e,$e,0,-1,2,Re),Ye=Mi(ye,1,1-$e,2+$e,0,-1,2,Re);return(Le||Ye)&&(Ve=Mi(ye,1,-$e,1+$e,0,-1,2,Re)||[],Le&&(Ve=gr(Le,1).concat(Ve)),Ye&&(Ve=Ve.concat(gr(Ye,-1)))),Ve}(he,W)).length&&this.splitTile(he,0,0,0),G&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Gi(de,W,G){return 32*((1<<de)*G+W)+de}function ii(de,W){const G=de.tileID.canonical;if(!this._geoJSONIndex)return W(null,null);const he=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!he)return W(null,null);const ye=new ue(he.features);let Re=xt(ye);Re.byteOffset===0&&Re.byteLength===Re.buffer.byteLength||(Re=new Uint8Array(Re)),W(null,{vectorTile:ye,rawData:Re.buffer})}qi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},qi.prototype.splitTile=function(de,W,G,he,ye,Re,$e){for(var Ve=[de,W,G,he],Le=this.options,Ye=Le.debug;Ve.length;){he=Ve.pop(),G=Ve.pop(),W=Ve.pop(),de=Ve.pop();var ft=1<<W,_t=Gi(W,G,he),Tt=this.tiles[_t];if(!Tt&&(Ye>1&&console.time("creation"),Tt=this.tiles[_t]=so(de,W,G,he,Le),this.tileCoords.push({z:W,x:G,y:he}),Ye)){Ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,G,he,Tt.numFeatures,Tt.numPoints,Tt.numSimplified),console.timeEnd("creation"));var qt="z"+W;this.stats[qt]=(this.stats[qt]||0)+1,this.total++}if(Tt.source=de,ye){if(W===Le.maxZoom||W===ye)continue;var Kt=1<<ye-W;if(G!==Math.floor(Re/Kt)||he!==Math.floor($e/Kt))continue}else if(W===Le.indexMaxZoom||Tt.numPoints<=Le.indexMaxPoints)continue;if(Tt.source=null,de.length!==0){Ye>1&&console.time("clipping");var tn,on,Sn,ir,yr,Xn,sr=.5*Le.buffer/Le.extent,$r=.5-sr,ki=.5+sr,br=1+sr;tn=on=Sn=ir=null,yr=Mi(de,ft,G-sr,G+ki,0,Tt.minX,Tt.maxX,Le),Xn=Mi(de,ft,G+$r,G+br,0,Tt.minX,Tt.maxX,Le),de=null,yr&&(tn=Mi(yr,ft,he-sr,he+ki,1,Tt.minY,Tt.maxY,Le),on=Mi(yr,ft,he+$r,he+br,1,Tt.minY,Tt.maxY,Le),yr=null),Xn&&(Sn=Mi(Xn,ft,he-sr,he+ki,1,Tt.minY,Tt.maxY,Le),ir=Mi(Xn,ft,he+$r,he+br,1,Tt.minY,Tt.maxY,Le),Xn=null),Ye>1&&console.timeEnd("clipping"),Ve.push(tn||[],W+1,2*G,2*he),Ve.push(on||[],W+1,2*G,2*he+1),Ve.push(Sn||[],W+1,2*G+1,2*he),Ve.push(ir||[],W+1,2*G+1,2*he+1)}}},qi.prototype.getTile=function(de,W,G){var he=this.options,ye=he.extent,Re=he.debug;if(de<0||de>24)return null;var $e=1<<de,Ve=Gi(de,W=(W%$e+$e)%$e,G);if(this.tiles[Ve])return Xo(this.tiles[Ve],ye);Re>1&&console.log("drilling down to z%d-%d-%d",de,W,G);for(var Le,Ye=de,ft=W,_t=G;!Le&&Ye>0;)Ye--,ft=Math.floor(ft/2),_t=Math.floor(_t/2),Le=this.tiles[Gi(Ye,ft,_t)];return Le&&Le.source?(Re>1&&console.log("found parent tile z%d-%d-%d",Ye,ft,_t),Re>1&&console.time("drilling down"),this.splitTile(Le.source,Ye,ft,_t,de,W,G),Re>1&&console.timeEnd("drilling down"),this.tiles[Ve]?Xo(this.tiles[Ve],ye):null):null};class Zo extends o.VectorTileWorkerSource{constructor(W,G,he,ye,Re){super(W,G,he,ye,ii),Re&&(this.loadGeoJSON=Re)}loadData(W,G){const he=W&&W.request,ye=he&&he.collectResourceTiming;this.loadGeoJSON(W,(Re,$e)=>{if(Re||!$e)return G(Re);if(typeof $e!="object")return G(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));{V($e,!0);try{if(W.filter){const Le=o.createExpression(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map(ft=>`${ft.key}: ${ft.message}`).join(", "));$e={type:"FeatureCollection",features:$e.features.filter(ft=>Le.value.evaluate({zoom:0},ft))}}this._geoJSONIndex=W.cluster?new yn(function({superclusterOptions:Le,clusterProperties:Ye}){if(!Ye||!Le)return Le;const ft={},_t={},Tt={accumulated:null,zoom:0},qt={properties:null},Kt=Object.keys(Ye);for(const tn of Kt){const[on,Sn]=Ye[tn],ir=o.createExpression(Sn),yr=o.createExpression(typeof on=="string"?[on,["accumulated"],["get",tn]]:on);ft[tn]=ir.value,_t[tn]=yr.value}return Le.map=tn=>{qt.properties=tn;const on={};for(const Sn of Kt)on[Sn]=ft[Sn].evaluate(Tt,qt);return on},Le.reduce=(tn,on)=>{qt.properties=on;for(const Sn of Kt)Tt.accumulated=tn[Sn],tn[Sn]=_t[Sn].evaluate(Tt,qt)},Le}(W)).load($e.features):function(Le,Ye){return new qi(Le,Ye)}($e,W.geojsonVtOptions)}catch(Le){return G(Le)}this.loaded={};const Ve={};if(ye){const Le=o.getPerformanceMeasurement(he);Le&&(Ve.resourceTiming={},Ve.resourceTiming[W.source]=JSON.parse(JSON.stringify(Le)))}G(null,Ve)}})}reloadTile(W,G){const he=this.loaded;return he&&he[W.uid]?super.reloadTile(W,G):this.loadTile(W,G)}loadGeoJSON(W,G){if(W.request)o.getJSON(W.request,G);else{if(typeof W.data!="string")return G(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));try{return G(null,JSON.parse(W.data))}catch{return G(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(W,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(he){G(he)}}getClusterChildren(W,G){try{G(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(he){G(he)}}getClusterLeaves(W,G){try{G(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(he){G(he)}}}class Ri{constructor(W){this.self=W,this.actor=new o.Actor(W,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Zo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(G,he)=>{if(this.workerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.workerSourceTypes[G]=he},this.self.registerRTLTextPlugin=G=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=G.applyArabicShaping,o.plugin.processBidirectionalText=G.processBidirectionalText,o.plugin.processStyledBidirectionalText=G.processStyledBidirectionalText}}clearCaches(W,G,he){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W],he()}checkIfReady(W,G,he){he()}setReferrer(W,G){this.referrer=G}spriteLoaded(W,G){this.isSpriteLoaded[W]=G;for(const he in this.workerSources[W]){const ye=this.workerSources[W][he];for(const Re in ye)ye[Re]instanceof o.VectorTileWorkerSource&&(ye[Re].isSpriteLoaded=G,ye[Re].fire(new o.Event("isSpriteLoaded")))}}setImages(W,G,he){this.availableImages[W]=G;for(const ye in this.workerSources[W]){const Re=this.workerSources[W][ye];for(const $e in Re)Re[$e].availableImages=G}he()}enableTerrain(W,G,he){this.terrain=G,he()}setProjection(W,G){this.projections[W]=o.getProjection(G)}setLayers(W,G,he){this.getLayerIndex(W).replace(G),he()}updateLayers(W,G,he){this.getLayerIndex(W).update(G.layers,G.removedIds),he()}loadTile(W,G,he){const ye=this.enableTerrain?o.extend({enableTerrain:this.terrain},G):G;ye.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,G.type,G.source).loadTile(ye,he)}loadDEMTile(W,G,he){const ye=this.enableTerrain?o.extend({buildQuadTree:this.terrain},G):G;this.getDEMWorkerSource(W,G.source).loadTile(ye,he)}reloadTile(W,G,he){const ye=this.enableTerrain?o.extend({enableTerrain:this.terrain},G):G;ye.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,G.type,G.source).reloadTile(ye,he)}abortTile(W,G,he){this.getWorkerSource(W,G.type,G.source).abortTile(G,he)}removeTile(W,G,he){this.getWorkerSource(W,G.type,G.source).removeTile(G,he)}removeSource(W,G,he){if(!this.workerSources[W]||!this.workerSources[W][G.type]||!this.workerSources[W][G.type][G.source])return;const ye=this.workerSources[W][G.type][G.source];delete this.workerSources[W][G.type][G.source],ye.removeSource!==void 0?ye.removeSource(G,he):he()}loadWorkerSource(W,G,he){try{this.self.importScripts(G.url),he()}catch(ye){he(ye.toString())}}syncRTLPluginState(W,G,he){try{o.plugin.setState(G);const ye=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ye!=null){this.self.importScripts(ye);const Re=o.plugin.isParsed();he(Re?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ye}`),Re)}}catch(ye){he(ye.toString())}}getAvailableImages(W){let G=this.availableImages[W];return G||(G=[]),G}getLayerIndex(W){let G=this.layerIndexes[W];return G||(G=this.layerIndexes[W]=new R),G}getWorkerSource(W,G,he){return this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][G]||(this.workerSources[W][G]={}),this.workerSources[W][G][he]||(this.workerSources[W][G][he]=new this.workerSourceTypes[G]({send:(ye,Re,$e,Ve,Le,Ye)=>{this.actor.send(ye,Re,$e,W,Le,Ye)},scheduler:this.actor.scheduler},this.getLayerIndex(W),this.getAvailableImages(W),this.isSpriteLoaded[W])),this.workerSources[W][G][he]}getDEMWorkerSource(W,G){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][G]||(this.demWorkerSources[W][G]=new U),this.demWorkerSources[W][G]}enforceCacheSizeLimit(W,G){o.enforceCacheSizeLimit(G)}getWorkerPerformanceMetrics(W,G,he){he(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ri(self)),Ri}),f(["./shared"],function(o){var T=C;function C(v){return!function(l){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,E,A=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(A);try{E=new Worker(I),x=!0}catch{x=!1}return E&&E.terminate(),URL.revokeObjectURL(I),x}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var x=document.createElement("canvas");x.width=x.height=1;var E=x.getContext("2d");if(!E)return!1;var A=E.getImageData(0,0,1,1);return A&&A.width===x.width}()?(R[p=l&&l.failIfMajorPerformanceCaveat]===void 0&&(R[p]=function(x){var E,A=function(I){var D=document.createElement("canvas"),B=Object.create(C.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=I,D.getContext("webgl",B)||D.getContext("experimental-webgl",B)}(x);if(!A)return!1;try{E=A.createShader(A.VERTEX_SHADER)}catch{return!1}return!(!E||A.isContextLost())&&(A.shaderSource(E,"void main() {}"),A.compileShader(E),A.getShaderParameter(E,A.COMPILE_STATUS)===!0)}(p)),R[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var p}(v)}var R={};function O(v,l){var p=l[0],x=l[1],E=l[2],A=l[3],I=p*A-E*x;return I?(v[0]=A*(I=1/I),v[1]=-x*I,v[2]=-E*I,v[3]=p*I,v):null}function U(v,l){if(Array.isArray(v)){if(!Array.isArray(l)||v.length!==l.length)return!1;for(let p=0;p<v.length;p++)if(!U(v[p],l[p]))return!1;return!0}if(typeof v=="object"&&v!==null&&l!==null){if(typeof l!="object"||Object.keys(v).length!==Object.keys(l).length)return!1;for(const p in v)if(!U(v[p],l[p]))return!1;return!0}return v===l}C.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const V={create:function(v,l,p){const x=o.window.document.createElement(v);return l!==void 0&&(x.className=l),p&&p.appendChild(x),x},createSVG:function(v,l,p){const x=o.window.document.createElementNS("http://www.w3.org/2000/svg",v);for(const E of Object.keys(l))x.setAttributeNS(null,E,l[E]);return p&&p.appendChild(x),x}},Y=o.window.document&&o.window.document.documentElement.style,ee=Y&&Y.userSelect!==void 0?"userSelect":"WebkitUserSelect";let le;V.disableDrag=function(){Y&&ee&&(le=Y[ee],Y[ee]="none")},V.enableDrag=function(){Y&&ee&&(Y[ee]=le)};const Ee=function(v){v.preventDefault(),v.stopPropagation(),o.window.removeEventListener("click",Ee,!0)};function ue(v,l,p){const x=v.offsetWidth===l.width?1:v.offsetWidth/l.width;return new o.pointGeometry((p.clientX-l.left)*x,(p.clientY-l.top)*x)}function _e(v){const{userImage:l}=v;return!!(l&&l.render&&l.render())&&(v.data.replace(new Uint8Array(l.data.buffer)),!0)}V.suppressClick=function(){o.window.addEventListener("click",Ee,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Ee,!0)},0)},V.mousePos=function(v,l){const p=v.getBoundingClientRect();return ue(v,p,l)},V.touchPos=function(v,l){const p=v.getBoundingClientRect(),x=[];for(let E=0;E<l.length;E++)x.push(ue(v,p,l[E]));return x},V.mouseButton=function(v){return o.window.InstallTrigger!==void 0&&v.button===2&&v.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:v.button};class Me extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,x);this.requestors=[]}}getImage(l){return this.images[l]}addImage(l,p){this._validate(l,p)&&(this.images[l]=p)}_validate(l,p){let x=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),x=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),x=!1),this._validateContent(p.content,p)||(this.fire(new o.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),x=!1),x}_validateStretch(l,p){if(!l)return!0;let x=0;for(const E of l){if(E[0]<x||E[1]<E[0]||p<E[1])return!1;x=E[1]}return!0}_validateContent(l,p){return!(l&&(l.length!==4||l[0]<0||p.data.width<l[0]||l[1]<0||p.data.height<l[1]||l[2]<0||p.data.width<l[2]||l[3]<0||p.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,p){p.version=this.images[l].version+1,this.images[l]=p,this.updatedImages[l]=!0}removeImage(l){const p=this.images[l];delete this.images[l],delete this.patterns[l],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,p){let x=!0;if(!this.isLoaded())for(const E of l)this.images[E]||(x=!1);this.isLoaded()||x?this._notify(l,p):this.requestors.push({ids:l,callback:p})}_notify(l,p){const x={};for(const E of l){this.images[E]||this.fire(new o.Event("styleimagemissing",{id:E}));const A=this.images[E];A?x[E]={data:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!!(A.userImage&&A.userImage.render)}:o.warnOnce(`Image "${E}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,x)}getPixelSize(){const{width:l,height:p}=this.atlasImage;return{width:l,height:p}}getPattern(l){const p=this.patterns[l],x=this.getImage(l);if(!x)return null;if(p&&p.position.version===x.version)return p.position;if(p)p.position.version=x.version;else{const E={w:x.data.width+2,h:x.data.height+2,x:0,y:0},A=new o.ImagePosition(E,x);this.patterns[l]={bin:E,position:A}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const p=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(l,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const A in this.patterns)l.push(this.patterns[A].bin);const{w:p,h:x}=o.potpack(l),E=this.atlasImage;E.resize({width:p||1,height:x||1});for(const A in this.patterns){const{bin:I}=this.patterns[A],D=I.x+1,B=I.y+1,j=this.images[A].data,$=j.width,X=j.height;o.RGBAImage.copy(j,E,{x:0,y:0},{x:D,y:B},{width:$,height:X}),o.RGBAImage.copy(j,E,{x:0,y:X-1},{x:D,y:B-1},{width:$,height:1}),o.RGBAImage.copy(j,E,{x:0,y:0},{x:D,y:B+X},{width:$,height:1}),o.RGBAImage.copy(j,E,{x:$-1,y:0},{x:D-1,y:B},{width:1,height:X}),o.RGBAImage.copy(j,E,{x:0,y:0},{x:D+$,y:B},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const p of l){if(this.callbackDispatchedThisFrame[p])continue;this.callbackDispatchedThisFrame[p]=!0;const x=this.images[p];_e(x)&&this.updateImage(p,x)}}}const Fe=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(v,l){return function([p,x,E]){const A=o.degToRad(x+90),I=o.degToRad(E);return{x:p*Math.cos(A)*Math.sin(I),y:p*Math.sin(A)*Math.sin(I),z:p*Math.cos(I),azimuthal:x,polar:E}}(v.expression.evaluate(l))}interpolate(v,l,p){return{x:o.number(v.x,l.x,p),y:o.number(v.y,l.y,p),z:o.number(v.z,l.z,p),azimuthal:o.number(v.azimuthal,l.azimuthal,p),polar:o.number(v.polar,l.polar,p)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),yt="-transition";class xt extends o.Evented{constructor(l){super(),this._transitionable=new o.Transitionable(Fe),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,p={}){if(!this._validate(o.validateLight,l,p))for(const x in l){const E=l[x];o.endsWith(x,yt)?this._transitionable.setTransition(x.slice(0,-yt.length),E):this._transitionable.setValue(x,E)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,p,x){return(!x||x.validate!==!1)&&o.emitValidationErrors(this,l.call(o.validateStyle,o.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const ht=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),kt="-transition";class Bt extends o.Evented{constructor(l,p){super(),this._transitionable=new o.Transitionable(ht),this.set(l),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=p}get(){return this._transitionable.serialize()}set(l){for(const p in l){const x=l[p];o.endsWith(p,kt)?this._transitionable.setTransition(p.slice(0,-kt.length),x):this._transitionable.setValue(p,x)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}}function Vt(v,l,p,x){const E=o.smoothstep(45,65,p),[A,I]=$t(v,x),D=o.length(l);let B=1-Math.min(1,Math.exp((D-A)/(I-A)*-6));return B*=B*B,B=Math.min(1,1.00747*B),B*E*v.alpha}function $t(v,l){const p=.5/Math.tan(.5*l);return[v.range[0]+p,v.range[1]+p]}const Ct=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"])}),xn="-transition";class Oe extends o.Evented{constructor(l,p){super(),this._transitionable=new o.Transitionable(Ct),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=p}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,p={}){if(!this._validate(o.validateFog,l,p))for(const x in l){const E=l[x];o.endsWith(x,xn)?this._transitionable.setTransition(x.slice(0,-xn.length),E):this._transitionable.setValue(x,E)}}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const p=this.properties&&this.properties.get("color")||1;return o.smoothstep(45,65,l)*p.a}getOpacityAtLatLng(l,p){return this._transform.projection.supportsFog?function(x,E,A){const I=o.MercatorCoordinate.fromLngLat(E),D=A.elevation?A.elevation.getAtPointOrZero(I):0,B=[I.x,I.y,D];return o.transformMat4(B,B,A.mercatorFogMatrix),Vt(x,B,A.pitch,A._fov)}(this.state,l,p):0}getFovAdjustedRange(l){return this._transform.projection.supportsFog?$t(this.state,l):[0,1]}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,p,x){return(!x||x.validate!==!1)&&o.emitValidationErrors(this,l.call(o.validateStyle,o.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class ce{constructor(l,p){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const x=this.workerPool.acquire(this.id);for(let E=0;E<x.length;E++){const A=new ce.Actor(x[E],p,this.id);A.name=`Worker ${E}`,this.actors.push(A)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,p,x){o.asyncAll(this.actors,(E,A)=>{E.send(l,p,A)},x=x||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ve(v,l,p){return l*(o.EXTENT/(v.tileSize*Math.pow(2,p-v.tileID.overscaledZ)))}ce.Actor=o.Actor;class rt{constructor(l,p,x){this.context=l;const E=l.gl;this.buffer=E.createBuffer(),this.dynamicDraw=!!x,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const at={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ne{constructor(l,p,x,E){this.length=p.length,this.attributes=x,this.itemSize=p.bytesPerElement,this.dynamicDraw=E,this.context=l;const A=l.gl;this.buffer=A.createBuffer(),l.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,p){for(let x=0;x<this.attributes.length;x++){const E=p.attributes[this.attributes[x].name];E!==void 0&&l.enableVertexAttribArray(E)}}setVertexAttribPointers(l,p,x){for(let E=0;E<this.attributes.length;E++){const A=this.attributes[E],I=p.attributes[A.name];I!==void 0&&l.vertexAttribPointer(I,A.components,l[at[A.type]],!1,this.itemSize,A.offset+this.itemSize*(x||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Be{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ot extends Be{getDefault(){return o.Color.transparent}set(l){const p=this.current;(l.r!==p.r||l.g!==p.g||l.b!==p.b||l.a!==p.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ft extends Be{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Dt extends Be{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class vn extends Be{getDefault(){return[!0,!0,!0,!0]}set(l){const p=this.current;(l[0]!==p[0]||l[1]!==p[1]||l[2]!==p[2]||l[3]!==p[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class un extends Be{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class fn extends Be{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class yn extends Be{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const p=this.current;(l.func!==p.func||l.ref!==p.ref||l.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Tn extends Be{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const p=this.current;(l[0]!==p[0]||l[1]!==p[1]||l[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Qr extends Be{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;l?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=l,this.dirty=!1}}class Or extends Be{getDefault(){return[0,1]}set(l){const p=this.current;(l[0]!==p[0]||l[1]!==p[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class as extends Be{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;l?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=l,this.dirty=!1}}class Xi extends Be{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Ht extends Be{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;l?p.enable(p.BLEND):p.disable(p.BLEND),this.current=l,this.dirty=!1}}class pn extends Be{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const p=this.current;(l[0]!==p[0]||l[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class hi extends Be{getDefault(){return o.Color.transparent}set(l){const p=this.current;(l.r!==p.r||l.g!==p.g||l.b!==p.b||l.a!==p.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class xo extends Be{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Vo extends Be{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;l?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=l,this.dirty=!1}}class to extends Be{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class En extends Be{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class no extends Be{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class _s extends Be{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class jo extends Be{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const p=this.current;(l[0]!==p[0]||l[1]!==p[1]||l[2]!==p[2]||l[3]!==p[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class bo extends Be{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class ur extends Be{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class wo extends Be{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class $o extends Be{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Wo extends Be{getDefault(){return null}set(l){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Mi extends Be{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class ro extends Be{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class io extends Be{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class To extends Be{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class ys extends Be{constructor(l,p){super(l),this.context=l,this.parent=p}getDefault(){return null}}class Ho extends ys{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class fi extends ys{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,this.attachment(),p.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Eo extends fi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class gr{constructor(l,p,x,E){this.context=l,this.width=p,this.height=x;const A=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new Ho(l,A),E&&(this.depthAttachment=new fi(l,A))}destroy(){const l=this.context.gl,p=this.colorAttachment.get();if(p&&l.deleteTexture(p),this.depthAttachment){const x=this.depthAttachment.get();x&&l.deleteRenderbuffer(x)}l.deleteFramebuffer(this.framebuffer)}}class Zi{constructor(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ot(this),this.clearDepth=new Ft(this),this.clearStencil=new Dt(this),this.colorMask=new vn(this),this.depthMask=new un(this),this.stencilMask=new fn(this),this.stencilFunc=new yn(this),this.stencilOp=new Tn(this),this.stencilTest=new Qr(this),this.depthRange=new Or(this),this.depthTest=new as(this),this.depthFunc=new Xi(this),this.blend=new Ht(this),this.blendFunc=new pn(this),this.blendColor=new hi(this),this.blendEquation=new xo(this),this.cullFace=new Vo(this),this.cullFaceSide=new to(this),this.frontFace=new En(this),this.program=new no(this),this.activeTexture=new _s(this),this.viewport=new jo(this),this.bindFramebuffer=new bo(this),this.bindRenderbuffer=new ur(this),this.bindTexture=new wo(this),this.bindVertexBuffer=new $o(this),this.bindElementBuffer=new Wo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Mi(this),this.pixelStoreUnpack=new ro(this),this.pixelStoreUnpackPremultiplyAlpha=new io(this),this.pixelStoreUnpackFlipY=new To(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,p){return new rt(this,l,p)}createVertexBuffer(l,p,x){return new Ne(this,l,p,x)}createRenderbuffer(l,p,x){const E=this.gl,A=E.createRenderbuffer();return this.bindRenderbuffer.set(A),E.renderbufferStorage(E.RENDERBUFFER,l,p,x),this.bindRenderbuffer.set(null),A}createFramebuffer(l,p,x){return new gr(this,l,p,x)}clear({color:l,depth:p,stencil:x}){const E=this.gl;let A=0;l&&(A|=E.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(A|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),x!==void 0&&(A|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(x),this.stencilMask.set(255)),E.clear(A)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){U(l.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Xo{constructor(l,p,x,E){this.screenBounds=l,this.cameraPoint=p,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=x,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(A=>E.pointCoordinate3D(A)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(l,p){let x,E;if(l instanceof o.pointGeometry||typeof l[0]=="number"){const A=o.pointGeometry.convert(l);x=[o.pointGeometry.convert(l)],E=p.isPointAboveHorizon(A)}else{const A=o.pointGeometry.convert(l[0]),I=o.pointGeometry.convert(l[1]);x=[A,I],E=o.polygonizeBounds(A,I).every(D=>p.isPointAboveHorizon(D))}return new Xo(x,p.getCameraPoint(),E,p)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const p=this.screenBounds[0],x=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],E=o.polygonizeBounds(p,x,0,!1);return this.cameraPoint.y>x.y&&(this.cameraPoint.x>p.x&&this.cameraPoint.x<x.x?E.splice(3,0,this.cameraPoint):this.cameraPoint.x>=x.x?E[2]=this.cameraPoint:this.cameraPoint.x<=p.x&&(E[3]=this.cameraPoint)),o.bufferConvexPolygon(E,l)}containsTile(l,p,x){const E=l.queryPadding+1,A=l.tileID.wrap,I=x?this._bufferedCameraMercator(E,p).map(re=>o.getTilePoint(l.tileTransform,re,A)):this._bufferedScreenMercator(E,p).map(re=>o.getTilePoint(l.tileTransform,re,A)),D=this.screenGeometryMercator.map(re=>o.getTileVec3(l.tileTransform,re,A)),B=D.map(re=>new o.pointGeometry(re[0],re[1])),j=p.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),$=o.getTileVec3(l.tileTransform,j,A),X=D.map(re=>{const ae=o.sub(re,re,$);return o.normalize(ae,ae),new o.Ray($,ae)}),K=ve(l,1,p.zoom);if(o.polygonIntersectsBox(I,0,0,o.EXTENT,o.EXTENT))return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:X,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(se=o.getBounds(I),se.min.x=o.clamp(se.min.x,0,o.EXTENT),se.min.y=o.clamp(se.min.y,0,o.EXTENT),se.max.x=o.clamp(se.max.x,0,o.EXTENT),se.max.y=o.clamp(se.max.y,0,o.EXTENT),se),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:K};var se}_bufferedScreenMercator(l,p){const x=vs(l);if(this._screenRaycastCache[x])return this._screenRaycastCache[x];{const E=this.bufferedScreenGeometry(l).map(A=>p.pointCoordinate3D(A));return this._screenRaycastCache[x]=E,E}}_bufferedCameraMercator(l,p){const x=vs(l);if(this._cameraRaycastCache[x])return this._cameraRaycastCache[x];{const E=this.bufferedCameraGeometry(l).map(A=>p.pointCoordinate3D(A));return this._cameraRaycastCache[x]=E,E}}}function vs(v){return 100*v|0}function so(v,l,p){const x=function(E,A){if(E)return p(E);if(A){const I=o.pick(o.extend(A,v),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(I.vectorLayers=A.vector_layers,I.vectorLayerIds=I.vectorLayers.map(D=>D.id)),I.tiles=l.canonicalizeTileset(I,v.url),p(null,I)}};return v.url?o.getJSON(l.transformRequest(l.normalizeSourceURL(v.url),o.ResourceType.Source),x):o.exported.frame(()=>x(null,v))}class xs{constructor(l,p,x){this.bounds=o.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=p||0,this.maxzoom=x||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const p=Math.pow(2,l.z),x=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*p),E=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*p),A=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*p),I=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*p);return l.x>=x&&l.x<A&&l.y>=E&&l.y<I}}class bs extends o.Evented{constructor(l,p,x,E){super(),this.id=l,this.dispatcher=x,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},p),o.extend(this,o.pick(p,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=so(this._options,this.map._requestManager,(l,p)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new o.ErrorEvent(l)):p&&(o.extend(this,p),p.bounds&&(this.tileBounds=new xs(p.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(p.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,p){const x=o.exported.devicePixelRatio>=2,E=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),x,this.tileSize);l.request=o.getImage(this.map._requestManager.transformRequest(E,o.ResourceType.Tile),(A,I,D,B)=>{if(delete l.request,l.aborted)l.state="unloaded",p(null);else if(A)l.state="errored",p(A);else if(I){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:D,expires:B});const j=this.map.painter.context,$=j.gl;l.texture=this.map.painter.getTileTexture(I.width),l.texture?l.texture.update(I,{useMipmap:!0}):(l.texture=new o.Texture(j,I,$.RGBA,{useMipmap:!0}),l.texture.bind($.LINEAR,$.CLAMP_TO_EDGE),j.extTextureFilterAnisotropic&&$.texParameterf($.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax)),l.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),p(null)}})}abortTile(l,p){l.request&&(l.request.cancel(),delete l.request),p()}unloadTile(l,p){l.texture&&this.map.painter.saveTileTexture(l.texture),p()}hasTransition(){return!1}}let qi;function Gi(v,l,p,x,E,A,I,D){const B=[v,p,E,l,x,A,1,1,1],j=[I,D,1],$=o.adjoint([],B),[X,K,se]=o.transformMat3(j,j,o.transpose($,$));return o.multiply(B,[X,0,0,0,K,0,0,0,se],B)}class ii extends o.Evented{constructor(l,p,x,E){super(),this.id=l,this.dispatcher=x,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(E),this.options=p}load(l,p){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(x,E)=>{this._loaded=!0,x?this.fire(new o.ErrorEvent(x)):E&&(this.image=o.exported.getImageData(E),this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),p&&p(),this._finishLoading())})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this.options.url=l.url,this.load(l.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}setCoordinates(l){this.coordinates=l,delete this._boundsArray;const p=l.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(x){let E=1/0,A=1/0,I=-1/0,D=-1/0;for(const X of x)E=Math.min(E,X.x),A=Math.min(A,X.y),I=Math.max(I,X.x),D=Math.max(D,X.y);const B=Math.max(I-E,D-A),j=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),$=Math.pow(2,j);return new o.CanonicalTileID(j,Math.floor((E+I)/2*$),Math.floor((A+D)/2*$))}(p),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const l=o.tileTransform(this.tileID,this.map.transform.projection),[p,x,E,A]=this.coordinates.map(I=>{const D=l.projection.project(I[0],I[1]);return o.getTilePoint(l,D)._round()});return this.perspectiveTransform=function(I,D,B,j,$,X,K,se,re,ae){const Pe=Gi(0,0,I,0,0,D,I,D),ie=Gi(B,j,$,X,K,se,re,ae);return o.multiply(ie,o.adjoint(Pe,Pe),ie),[ie[6]/ie[8]*I/o.EXTENT,ie[7]/ie[8]*D/o.EXTENT]}(this.width,this.height,p.x,p.y,x.x,x.y,A.x,A.y,E.x,E.y),this._boundsArray=new o.StructArrayLayout4i8,this._boundsArray.emplaceBack(p.x,p.y,0,0),this._boundsArray.emplaceBack(x.x,x.y,o.EXTENT,0),this._boundsArray.emplaceBack(A.x,A.y,0,o.EXTENT),this._boundsArray.emplaceBack(E.x,E.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,p=l.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new o.Texture(l,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE));for(const x in this.tiles){const E=this.tiles[x];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}loadTile(l,p){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},p(null)):(l.state="errored",p(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Zo={vector:class extends o.Evented{constructor(v,l,p,x){if(super(),this.id=v,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(l,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=so(this._options,this.map._requestManager,(v,l)=>{this._tileJSONRequest=null,this._loaded=!0,v?this.fire(new o.ErrorEvent(v)):l&&(o.extend(this,l),l.bounds&&(this.tileBounds=new xs(l.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(l.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(v){return!this.tileBounds||this.tileBounds.contains(v.canonical)}onAdd(v){this.map=v,this.load()}setSourceProperty(v){this._tileJSONRequest&&this._tileJSONRequest.cancel(),v();const l=this.map.style._getSourceCaches(this.id);for(const p of l)p.clearTiles();this.load()}setTiles(v){return this.setSourceProperty(()=>{this._options.tiles=v}),this}setUrl(v){return this.setSourceProperty(()=>{this.url=v,this._options.url=v}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(v,l){const p=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(p,o.ResourceType.Tile),data:void 0,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,tileSize:this.tileSize*v.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:v.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,v.actor&&v.state!=="expired")v.state==="loading"?v.reloadCallback=l:v.request=v.actor.send("reloadTile",x,E.bind(this));else if(v.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)v.request=v.actor.send("loadTile",x,E.bind(this),void 0,!0);else{const A=o.loadVectorTile.call({deduped:this._deduped},x,(I,D)=>{I||!D?E.call(this,I):(x.data={cacheControl:D.cacheControl,expires:D.expires,rawData:D.rawData.slice(0)},v.actor&&v.actor.send("loadTile",x,E.bind(this),void 0,!0))},!0);v.request={cancel:A}}function E(A,I){return delete v.request,v.aborted?l(null):A&&A.status!==404?l(A):(I&&I.resourceTiming&&(v.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&v.setExpiryData(I),v.loadVectorData(I,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(v.reloadCallback&&(this.loadTile(v,v.reloadCallback),v.reloadCallback=null)))}}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.actor&&v.actor.send("abortTile",{uid:v.uid,type:this.type,source:this.id})}unloadTile(v){v.unloadVectorData(),v.actor&&v.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:bs,"raster-dem":class extends bs{constructor(v,l,p,x){super(v,l,p,x),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(v,l){const p=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function x(E,A){E&&(v.state="errored",l(E)),A&&(v.dem=A,v.dem.onDeserialize(),v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0,v.state="loaded",l(null))}v.request=o.getImage(this.map._requestManager.transformRequest(p,o.ResourceType.Tile),(function(E,A,I,D){if(delete v.request,v.aborted)v.state="unloaded",l(null);else if(E)v.state="errored",l(E);else if(A){this.map._refreshExpiredTiles&&v.setExpiryData({cacheControl:I,expires:D});const B=o.window.ImageBitmap&&A instanceof o.window.ImageBitmap&&(qi==null&&(qi=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),qi),j=1-(A.width-o.prevPowerOfTwo(A.width))/2;j<1||v.neighboringTiles||(v.neighboringTiles=this._getNeighboringTiles(v.tileID));const $=B?A:o.exported.getImageData(A,j),X={uid:v.uid,coord:v.tileID,source:this.id,rawImageData:$,encoding:this.encoding,padding:j};v.actor&&v.state!=="expired"||(v.actor=this.dispatcher.getActor(),v.actor.send("loadDEMTile",X,x.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(v){const l=v.canonical,p=Math.pow(2,l.z),x=(l.x-1+p)%p,E=l.x===0?v.wrap-1:v.wrap,A=(l.x+1+p)%p,I=l.x+1===p?v.wrap+1:v.wrap,D={};return D[new o.OverscaledTileID(v.overscaledZ,E,l.z,x,l.y).key]={backfilled:!1},D[new o.OverscaledTileID(v.overscaledZ,I,l.z,A,l.y).key]={backfilled:!1},l.y>0&&(D[new o.OverscaledTileID(v.overscaledZ,E,l.z,x,l.y-1).key]={backfilled:!1},D[new o.OverscaledTileID(v.overscaledZ,v.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},D[new o.OverscaledTileID(v.overscaledZ,I,l.z,A,l.y-1).key]={backfilled:!1}),l.y+1<p&&(D[new o.OverscaledTileID(v.overscaledZ,E,l.z,x,l.y+1).key]={backfilled:!1},D[new o.OverscaledTileID(v.overscaledZ,v.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},D[new o.OverscaledTileID(v.overscaledZ,I,l.z,A,l.y+1).key]={backfilled:!1}),D}unloadTile(v){v.demTexture&&this.map.painter.saveTileTexture(v.demTexture),v.fbo&&(v.fbo.destroy(),delete v.fbo),v.dem&&delete v.dem,delete v.neighboringTiles,v.state="unloaded"}},geojson:class extends o.Evented{constructor(v,l,p,x){super(),this.id=v,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(x),this._data=l.data,this._options=o.extend({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const E=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*E,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*E,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:o.EXTENT,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*E,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(v){this.map=v,this.setData(this._data)}setData(v){return this._data=v,this._updateWorkerData(),this}getClusterExpansionZoom(v,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:v,source:this.id},l),this}getClusterChildren(v,l){return this.actor.send("geojson.getClusterChildren",{clusterId:v,source:this.id},l),this}getClusterLeaves(v,l,p,x){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:v,limit:l,offset:p},x),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const v=o.extend({},this.workerOptions),l=this._data;typeof l=="string"?(v.request=this.map._requestManager.transformRequest(o.exported.resolveURL(l),o.ResourceType.Source),v.request.collectResourceTiming=this._collectResourceTiming):v.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,v,(p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new o.ErrorEvent(p));else{const E={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(E.resourceTiming=x.resourceTiming[this.id]),this.fire(new o.Event("data",E)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(v,l){const p=v.actor?"reloadTile":"loadTile";v.actor=this.actor,v.request=this.actor.send(p,{type:this.type,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(x,E)=>(delete v.request,v.unloadVectorData(),v.aborted?l(null):x?l(x):(v.loadVectorData(E,this.map.painter,p==="reloadTile"),l(null))),void 0,p==="loadTile")}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.aborted=!0}unloadTile(v){v.unloadVectorData(),this.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ii{constructor(v,l,p,x){super(v,l,p,x),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const v=this.options;this.urls=[];for(const l of v.urls)this.urls.push(this.map._requestManager.transformRequest(l,o.ResourceType.Source).url);o.getVideo(this.urls,(l,p)=>{this._loaded=!0,l?this.fire(new o.ErrorEvent(l)):p&&(this.video=p,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(v){if(this.video){const l=this.video.seekable;v<l.start(0)||v>l.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=v}}getVideo(){return this.video}onAdd(v){this.map||(this.map=v,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const v=this.map.painter.context,l=v.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(v,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2));for(const p in this.tiles){const x=this.tiles[p];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ii,canvas:class extends ii{constructor(v,l,p,x){super(v,l,p,x),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(A=>typeof A!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${v}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${v}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${v}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${v}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${v}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(v){this.map=v,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let v=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,v=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,v=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context,p=l.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(v||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(l,this.canvas,p.RGBA,{premultiply:!0});for(const x in this.tiles){const E=this.tiles[x];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const v of[this.canvas.width,this.canvas.height])if(isNaN(v)||v<=0)return!0;return!1}}},Ri=function(v,l,p,x){const E=new Zo[l.type](v,l,p,x);if(E.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${E.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],E),E};function de(v,l){const p=o.identity([]);return o.scale(p,p,[.5*v.width,.5*-v.height,1]),o.translate(p,p,[1,-1,0]),o.multiply$1(p,p,v.calculateProjMatrix(l.toUnwrapped()))}function W(v,l,p,x,E,A,I,D=!1){const B=v.tilesIn(x,I,D);B.sort(he);const j=[];for(const X of B)j.push({wrappedTileID:X.tile.tileID.wrapped().key,queryResults:X.tile.queryRenderedFeatures(l,p,v._state,X,E,A,de(v.transform,X.tile.tileID),D)});const $=function(X){const K={},se={};for(const re of X){const ae=re.queryResults,Pe=re.wrappedTileID,ie=se[Pe]=se[Pe]||{};for(const Ae in ae){const Se=ae[Ae],be=ie[Ae]=ie[Ae]||{},we=K[Ae]=K[Ae]||[];for(const Ie of Se)be[Ie.featureIndex]||(be[Ie.featureIndex]=!0,we.push(Ie))}}return K}(j);for(const X in $)$[X].forEach(K=>{const se=K.feature,re=v.getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=re});return $}function G(v,l){const p=v.getRenderableIds().map(A=>v.getTileByID(A)),x=[],E={};for(let A=0;A<p.length;A++){const I=p[A],D=I.tileID.canonical.key;E[D]||(E[D]=!0,I.querySourceFeatures(x,l))}return x}function he(v,l){const p=v.tileID,x=l.tileID;return p.overscaledZ-x.overscaledZ||p.canonical.y-x.canonical.y||p.wrap-x.wrap||p.canonical.x-x.canonical.x}function ye(){return Fi.workerClass!=null?new Fi.workerClass:new o.window.Worker(Fi.workerUrl)}const Re="mapboxgl_preloaded_worker_pool";class $e{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<$e.workerCount;)this.workers.push(new ye);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(p=>{p.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Re]}numActive(){return Object.keys(this.active).length}}let Ve;function Le(){return Ve||(Ve=new $e),Ve}function Ye(v,l){const p={};for(const x in v)x!=="ref"&&(p[x]=v[x]);return o.refProperties.forEach(x=>{x in l&&(p[x]=l[x])}),p}function ft(v){v=v.slice();const l=Object.create(null);for(let p=0;p<v.length;p++)l[v[p].id]=v[p];for(let p=0;p<v.length;p++)"ref"in v[p]&&(v[p]=Ye(v[p],l[v[p].ref]));return v}$e.workerCount=2;const _t={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Tt(v,l,p){p.push({command:_t.addSource,args:[v,l[v]]})}function qt(v,l,p){l.push({command:_t.removeSource,args:[v]}),p[v]=!0}function Kt(v,l,p,x){qt(v,p,x),Tt(v,l,p)}function tn(v,l,p){let x;for(x in v[p])if(v[p].hasOwnProperty(x)&&x!=="data"&&!U(v[p][x],l[p][x]))return!1;for(x in l[p])if(l[p].hasOwnProperty(x)&&x!=="data"&&!U(v[p][x],l[p][x]))return!1;return!0}function on(v,l,p,x,E,A){let I;for(I in l=l||{},v=v||{})v.hasOwnProperty(I)&&(U(v[I],l[I])||p.push({command:A,args:[x,I,l[I],E]}));for(I in l)l.hasOwnProperty(I)&&!v.hasOwnProperty(I)&&(U(v[I],l[I])||p.push({command:A,args:[x,I,l[I],E]}))}function Sn(v){return v.id}function ir(v,l){return v[l.id]=l,v}class yr{constructor(l,p){this.reset(l,p)}reset(l,p){this.points=l||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=o.clamp(l,0,1);let p=1,x=this._distances[p];const E=l*this.paddedLength+this.padding;for(;x<E&&p<this._distances.length;)x=this._distances[++p];const A=p-1,I=this._distances[A],D=x-I,B=D>0?(E-I)/D:0;return this.points[A].mult(1-B).add(this.points[p].mult(B))}}class Xn{constructor(l,p,x){const E=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(l/x),this.yCellCount=Math.ceil(p/x);for(let I=0;I<this.xCellCount*this.yCellCount;I++)E.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=p,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,p,x,E,A){this._forEachCell(p,x,E,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(E),this.bboxes.push(A)}insertCircle(l,p,x,E){this._forEachCell(p-E,x-E,p+E,x+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(p),this.circles.push(x),this.circles.push(E)}_insertBoxCell(l,p,x,E,A,I){this.boxCells[A].push(I)}_insertCircleCell(l,p,x,E,A,I){this.circleCells[A].push(I)}_query(l,p,x,E,A,I){if(x<0||l>this.width||E<0||p>this.height)return!A&&[];const D=[];if(l<=0&&p<=0&&this.width<=x&&this.height<=E){if(A)return!0;for(let B=0;B<this.boxKeys.length;B++)D.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const j=this.circles[3*B],$=this.circles[3*B+1],X=this.circles[3*B+2];D.push({key:this.circleKeys[B],x1:j-X,y1:$-X,x2:j+X,y2:$+X})}return I?D.filter(I):D}return this._forEachCell(l,p,x,E,this._queryCell,D,{hitTest:A,seenUids:{box:{},circle:{}}},I),A?D.length>0:D}_queryCircle(l,p,x,E,A){const I=l-x,D=l+x,B=p-x,j=p+x;if(D<0||I>this.width||j<0||B>this.height)return!E&&[];const $=[];return this._forEachCell(I,B,D,j,this._queryCellCircle,$,{hitTest:E,circle:{x:l,y:p,radius:x},seenUids:{box:{},circle:{}}},A),E?$.length>0:$}query(l,p,x,E,A){return this._query(l,p,x,E,!1,A)}hitTest(l,p,x,E,A){return this._query(l,p,x,E,!0,A)}hitTestCircle(l,p,x,E){return this._queryCircle(l,p,x,!0,E)}_queryCell(l,p,x,E,A,I,D,B){const j=D.seenUids,$=this.boxCells[A];if($!==null){const K=this.bboxes;for(const se of $)if(!j.box[se]){j.box[se]=!0;const re=4*se;if(l<=K[re+2]&&p<=K[re+3]&&x>=K[re+0]&&E>=K[re+1]&&(!B||B(this.boxKeys[se]))){if(D.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[se],x1:K[re],y1:K[re+1],x2:K[re+2],y2:K[re+3]})}}}const X=this.circleCells[A];if(X!==null){const K=this.circles;for(const se of X)if(!j.circle[se]){j.circle[se]=!0;const re=3*se;if(this._circleAndRectCollide(K[re],K[re+1],K[re+2],l,p,x,E)&&(!B||B(this.circleKeys[se]))){if(D.hitTest)return I.push(!0),!0;{const ae=K[re],Pe=K[re+1],ie=K[re+2];I.push({key:this.circleKeys[se],x1:ae-ie,y1:Pe-ie,x2:ae+ie,y2:Pe+ie})}}}}}_queryCellCircle(l,p,x,E,A,I,D,B){const j=D.circle,$=D.seenUids,X=this.boxCells[A];if(X!==null){const se=this.bboxes;for(const re of X)if(!$.box[re]){$.box[re]=!0;const ae=4*re;if(this._circleAndRectCollide(j.x,j.y,j.radius,se[ae+0],se[ae+1],se[ae+2],se[ae+3])&&(!B||B(this.boxKeys[re])))return I.push(!0),!0}}const K=this.circleCells[A];if(K!==null){const se=this.circles;for(const re of K)if(!$.circle[re]){$.circle[re]=!0;const ae=3*re;if(this._circlesCollide(se[ae],se[ae+1],se[ae+2],j.x,j.y,j.radius)&&(!B||B(this.circleKeys[re])))return I.push(!0),!0}}}_forEachCell(l,p,x,E,A,I,D,B){const j=this._convertToXCellCoord(l),$=this._convertToYCellCoord(p),X=this._convertToXCellCoord(x),K=this._convertToYCellCoord(E);for(let se=j;se<=X;se++)for(let re=$;re<=K;re++)if(A.call(this,l,p,x,E,this.xCellCount*re+se,I,D,B))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,p,x,E,A,I){const D=E-l,B=A-p,j=x+I;return j*j>D*D+B*B}_circleAndRectCollide(l,p,x,E,A,I,D){const B=(I-E)/2,j=Math.abs(l-(E+B));if(j>B+x)return!1;const $=(D-A)/2,X=Math.abs(p-(A+$));if(X>$+x)return!1;if(j<=B||X<=$)return!0;const K=j-B,se=X-$;return K*K+se*se<=x*x}}const sr=Math.tan(85*Math.PI/180);function $r(v,l,p,x,E,A){let I=o.create();if(p){if(E.projection.name==="globe")I=o.calculateGlobeMatrix(E,E.worldSize/E._projectionScaler,[0,0]),o.multiply$1(I,I,o.globeDenormalizeECEF(o.globeTileBounds(l)));else{const D=O([],A);I[0]=D[0],I[1]=D[1],I[4]=D[2],I[5]=D[3]}x||o.rotateZ(I,I,E.angle)}else o.multiply$1(I,E.labelPlaneMatrix,v);return I}function ki(v,l,p,x,E,A){if(p){if(E.projection.name==="globe"){const I=$r(v,l,p,x,E,A);return o.invert(I,I),o.multiply$1(I,v,I),I}{const I=o.clone(v),D=o.identity([]);return D[0]=A[0],D[1]=A[1],D[4]=A[2],D[5]=A[3],o.multiply$1(I,I,D),x||o.rotateZ(I,I,-E.angle),I}}return E.glCoordMatrix}function br(v,l,p=0){const x=[v.x,v.y,p,1];p?o.transformMat4$1(x,x,l):ws(x,x,l);const E=x[3];return{point:new o.pointGeometry(x[0]/E,x[1]/E),signedDistanceFromCamera:E}}function Zr(v,l){return Math.min(.5+v/l*.5,1.5)}function oo(v,l){const p=v[0]/v[3],x=v[1]/v[3];return p>=-l[0]&&p<=l[0]&&x>=-l[1]&&x<=l[1]}function Yi(v,l,p,x,E,A,I,D,B,j){const $=p.transform,X=x?v.textSizeData:v.iconSizeData,K=o.evaluateSizeForZoom(X,p.transform.zoom),se=[256/p.width*2+1,256/p.height*2+1],re=x?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;re.clear();const ae=v.lineVertexArray,Pe=x?v.text.placedSymbolArray:v.icon.placedSymbolArray,ie=p.transform.width/p.transform.height;let Ae=!1;for(let Se=0;Se<Pe.length;Se++){const be=Pe.get(Se);if(be.writingMode!==o.WritingMode.vertical||Ae||Se!==0&&Pe.get(Se-1).writingMode===o.WritingMode.horizontal||(Ae=!0),be.hidden||be.writingMode===o.WritingMode.vertical&&!Ae){si(be.numGlyphs,re);continue}Ae=!1;const we=new o.pointGeometry(be.tileAnchorX,be.tileAnchorY),Ie=B?B(we):[0,0,0],Ke=$.projection.projectTilePoint(we.x,we.y,j.canonical),st=[Ke.x+Ie[0],Ke.y+Ie[1],Ke.z+Ie[2]],It=[...st,1];if(o.transformMat4$1(It,It,l),!oo(It,se)){si(be.numGlyphs,re);continue}const Et=Zr(p.transform.cameraToCenterDistance,It[3]),bt=o.evaluateSizeForFeature(X,K,be),ut=I?bt/Et:bt*Et,it=br(new o.pointGeometry(st[0],st[1]),E,st[2]);if(it.signedDistanceFromCamera<=0){si(be.numGlyphs,re);continue}let vt={};const dt=I?null:B,nn=ga(be,ut,!1,D,l,E,A,v.glyphOffsetArray,ae,re,it.point,we,vt,ie,dt,$.projection,j);Ae=nn.useVertical,dt&&nn.needsFlipping&&(vt={}),(nn.notEnoughRoom||Ae||nn.needsFlipping&&ga(be,ut,!0,D,l,E,A,v.glyphOffsetArray,ae,re,it.point,we,vt,ie,dt,$.projection,j).notEnoughRoom)&&si(be.numGlyphs,re)}x?v.text.dynamicLayoutVertexBuffer.updateData(re):v.icon.dynamicLayoutVertexBuffer.updateData(re)}function ls(v,l,p,x,E,A,I,D,B,j,$,X,K,se,re){const ae=D.glyphStartIndex+D.numGlyphs,Pe=D.lineStartIndex,ie=D.lineStartIndex+D.lineLength,Ae=l.getoffsetX(D.glyphStartIndex),Se=l.getoffsetX(ae-1),be=Ei(v*Ae,p,x,E,A,I,D.segment,Pe,ie,B,j,$,X,K,!0,se,re);if(!be)return null;const we=Ei(v*Se,p,x,E,A,I,D.segment,Pe,ie,B,j,$,X,K,!0,se,re);return we?{first:be,last:we}:null}function qo(v,l,p,x){return v.writingMode===o.WritingMode.horizontal&&Math.abs(p.y-l.y)>Math.abs(p.x-l.x)*x?{useVertical:!0}:v.writingMode===o.WritingMode.vertical?l.y<p.y?{needsFlipping:!0}:null:v.flipState!==0&&function(E,A,I){const D=(A.x-E.x)*I;return D===0||Math.abs((A.y-E.y)/D)>sr}(l,p,x)?v.flipState===1?{needsFlipping:!0}:null:l.x>p.x?{needsFlipping:!0}:null}function ga(v,l,p,x,E,A,I,D,B,j,$,X,K,se,re,ae,Pe){const ie=l/24,Ae=v.lineOffsetX*ie,Se=v.lineOffsetY*ie;let be;if(v.numGlyphs>1){const we=v.glyphStartIndex+v.numGlyphs,Ie=v.lineStartIndex,Ke=v.lineStartIndex+v.lineLength,st=ls(ie,D,Ae,Se,p,$,X,v,B,A,K,re,!1,ae,Pe);if(!st)return{notEnoughRoom:!0};const It=br(st.first.point,I).point,Et=br(st.last.point,I).point;if(x&&!p){const bt=qo(v,It,Et,se);if(v.flipState=bt&&bt.needsFlipping?1:2,bt)return bt}be=[st.first];for(let bt=v.glyphStartIndex+1;bt<we-1;bt++)be.push(Ei(ie*D.getoffsetX(bt),Ae,Se,p,$,X,v.segment,Ie,Ke,B,A,K,re,!1,!1,ae,Pe));be.push(st.last)}else{if(x&&!p){const Ie=br(X,E).point,Ke=v.lineStartIndex+v.segment+1,st=new o.pointGeometry(B.getx(Ke),B.gety(Ke)),It=br(st,E),Et=qo(v,Ie,It.signedDistanceFromCamera>0?It.point:Nr(X,st,Ie,1,E,void 0,ae,Pe.canonical),se);if(v.flipState=Et&&Et.needsFlipping?1:2,Et)return Et}const we=Ei(ie*D.getoffsetX(v.glyphStartIndex),Ae,Se,p,$,X,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,B,A,K,re,!1,!1,ae,Pe);if(!we)return{notEnoughRoom:!0};be=[we]}for(const we of be)o.addDynamicAttributes(j,we.point,we.angle);return{}}function di(v,l,p,x,E){const A=x.projectTilePoint(v.x,v.y,l);if(!E)return br(A,p,A.z);const I=E(v);return br(new o.pointGeometry(A.x+I[0],A.y+I[1]),p,A.z+I[2])}function Nr(v,l,p,x,E,A,I,D){const B=di(v.add(v.sub(l)._unit()),D,E,I,A).point,j=p.sub(B);return p.add(j._mult(x/j.mag()))}function Ei(v,l,p,x,E,A,I,D,B,j,$,X,K,se,re,ae,Pe){const ie=x?v-l:v+l;let Ae=ie>0?1:-1,Se=0;x&&(Ae*=-1,Se=Math.PI),Ae<0&&(Se+=Math.PI);let be=Ae>0?D+I:D+I+1,we=E,Ie=E,Ke=0,st=0;const It=Math.abs(ie),Et=[],bt=[];let ut=A;const it=()=>{const Rt=be-Ae;return Ke===0?A:new o.pointGeometry(j.getx(Rt),j.gety(Rt))},vt=()=>Nr(it(),ut,Ie,It-Ke+1,$,K,ae,Pe.canonical);for(;Ke+st<=It;){if(be+=Ae,be<D||be>=B)return null;if(Ie=we,Et.push(we),se&&bt.push(ut||it()),we=X[be],we===void 0){ut=new o.pointGeometry(j.getx(be),j.gety(be));const Rt=di(ut,Pe.canonical,$,ae,K);we=Rt.signedDistanceFromCamera>0?X[be]=Rt.point:vt()}else ut=null;Ke+=st,st=Ie.dist(we)}re&&K&&(ut=ut||new o.pointGeometry(j.getx(be),j.gety(be)),X[be]=we=X[be]===void 0?we:vt(),st=Ie.dist(we));const dt=(It-Ke)/st,nn=we.sub(Ie),hn=nn.mult(dt)._add(Ie);p&&hn._add(nn._unit()._perp()._mult(p*Ae));const In=Se+Math.atan2(we.y-Ie.y,we.x-Ie.x);return Et.push(hn),se&&(ut=ut||new o.pointGeometry(j.getx(be),j.gety(be)),bt.push(function(Rt,sn,_n){const Jn=1-_n;return new o.pointGeometry(Rt.x*Jn+sn.x*_n,Rt.y*Jn+sn.y*_n)}(bt.length>0?bt[bt.length-1]:ut,ut,dt))),{point:hn,angle:In,path:Et,tilePath:bt}}const cs=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function si(v,l){for(let p=0;p<v;p++){const x=l.length;l.resize(x+4),l.float32.set(cs,3*x)}}function ws(v,l,p){const x=l[0],E=l[1];return v[0]=p[0]*x+p[4]*E+p[12],v[1]=p[1]*x+p[5]*E+p[13],v[3]=p[3]*x+p[7]*E+p[15],v}const pi=100;class Xa{constructor(l,p,x=new Xn(l.width+200,l.height+200,25),E=new Xn(l.width+200,l.height+200,25)){this.transform=l,this.grid=x,this.ignoredGrid=E,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+pi,this.screenBottomBoundary=l.height+pi,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=p}placeCollisionBox(l,p,x,E,A,I,D){let B=p.projectedAnchorX,j=p.projectedAnchorY,$=p.projectedAnchorZ;const X=p.elevation,K=p.tileID;if(X&&K){const be=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),we=be.upVector(K.canonical,p.tileAnchorX,p.tileAnchorY),Ie=be.upVectorScale(K.canonical);B+=we[0]*X*Ie,j+=we[1]*X*Ie,$+=we[2]*X*Ie}const se=this.projectAndGetPerspectiveRatio(I,B,j,$,p.tileID),re=A*se.perspectiveRatio,ae=(p.x1*l+x.x-p.padding)*re+se.point.x,Pe=(p.y1*l+x.y-p.padding)*re+se.point.y,ie=(p.x2*l+x.x+p.padding)*re+se.point.x,Ae=(p.y2*l+x.y+p.padding)*re+se.point.y,Se=se.perspectiveRatio<=.55||se.aboveHorizon;return!this.isInsideGrid(ae,Pe,ie,Ae)||!E&&this.grid.hitTest(ae,Pe,ie,Ae,D)||Se?{box:[],offscreen:!1}:{box:[ae,Pe,ie,Ae],offscreen:this.isOffscreen(ae,Pe,ie,Ae)}}placeCollisionCircles(l,p,x,E,A,I,D,B,j,$,X,K,se,re){const ae=[],Pe=this.transform.elevation,ie=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),Ae=Pe?Pe.getAtTileOffsetFunc(re,ie):dt=>[0,0,0],Se=new o.pointGeometry(p.tileAnchorX,p.tileAnchorY),be=this.transform.projection.projectTilePoint(p.tileAnchorX,p.tileAnchorY,re.canonical),we=Ae(Se),Ie=[be.x+we[0],be.y+we[1],be.z+we[2]],Ke=this.projectAndGetPerspectiveRatio(I,Ie[0],Ie[1],Ie[2],re),{perspectiveRatio:st}=Ke,It=($?A/st:A*st)/o.ONE_EM,Et=br(new o.pointGeometry(Ie[0],Ie[1]),D,Ie[2]).point,bt=Ke.signedDistanceFromCamera>0?ls(It,E,p.lineOffsetX*It,p.lineOffsetY*It,!1,Et,Se,p,x,D,{},Pe&&!$?Ae:null,$&&!!Pe,this.transform.projection,re):null;let ut=!1,it=!1,vt=!0;if(bt&&!Ke.aboveHorizon){const dt=.5*K*st+se,nn=new o.pointGeometry(-100,-100),hn=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),In=new yr,Rt=bt.first,sn=bt.last;let _n=[];for(let mn=Rt.path.length-1;mn>=1;mn--)_n.push(Rt.path[mn]);for(let mn=1;mn<sn.path.length;mn++)_n.push(sn.path[mn]);const Jn=2.5*dt;if(B){const mn=_n.map(Pe?(Nn,fr)=>{const _r=Ae(fr<Rt.path.length-1?Rt.tilePath[Rt.path.length-1-fr]:sn.tilePath[fr-Rt.path.length+2]);return br(Nn,B,_r[2])}:Nn=>br(Nn,B));_n=mn.some(Nn=>Nn.signedDistanceFromCamera<=0)?[]:mn.map(Nn=>Nn.point)}let hr=[];if(_n.length>0){const mn=_n[0].clone(),Nn=_n[0].clone();for(let fr=1;fr<_n.length;fr++)mn.x=Math.min(mn.x,_n[fr].x),mn.y=Math.min(mn.y,_n[fr].y),Nn.x=Math.max(Nn.x,_n[fr].x),Nn.y=Math.max(Nn.y,_n[fr].y);hr=mn.x>=nn.x&&Nn.x<=hn.x&&mn.y>=nn.y&&Nn.y<=hn.y?[_n]:Nn.x<nn.x||mn.x>hn.x||Nn.y<nn.y||mn.y>hn.y?[]:o.clipLine([_n],nn.x,nn.y,hn.x,hn.y)}for(const mn of hr){In.reset(mn,.25*dt);let Nn=0;Nn=In.length<=.5*dt?1:Math.ceil(In.paddedLength/Jn)+1;for(let fr=0;fr<Nn;fr++){const _r=fr/Math.max(Nn-1,1),_i=In.lerp(_r),Ni=_i.x+pi,Ai=_i.y+pi;ae.push(Ni,Ai,dt,0);const $n=Ni-dt,gn=Ai-dt,Un=Ni+dt,Rr=Ai+dt;if(vt=vt&&this.isOffscreen($n,gn,Un,Rr),it=it||this.isInsideGrid($n,gn,Un,Rr),!l&&this.grid.hitTestCircle(Ni,Ai,dt,X)&&(ut=!0,!j))return{circles:[],offscreen:!1,collisionDetected:ut}}}}return{circles:!j&&ut||!it?[]:ae,offscreen:vt,collisionDetected:ut}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let x=1/0,E=1/0,A=-1/0,I=-1/0;for(const $ of l){const X=new o.pointGeometry($.x+pi,$.y+pi);x=Math.min(x,X.x),E=Math.min(E,X.y),A=Math.max(A,X.x),I=Math.max(I,X.y),p.push(X)}const D=this.grid.query(x,E,A,I).concat(this.ignoredGrid.query(x,E,A,I)),B={},j={};for(const $ of D){const X=$.key;if(B[X.bucketInstanceId]===void 0&&(B[X.bucketInstanceId]={}),B[X.bucketInstanceId][X.featureIndex])continue;const K=[new o.pointGeometry($.x1,$.y1),new o.pointGeometry($.x2,$.y1),new o.pointGeometry($.x2,$.y2),new o.pointGeometry($.x1,$.y2)];o.polygonIntersectsPolygon(p,K)&&(B[X.bucketInstanceId][X.featureIndex]=!0,j[X.bucketInstanceId]===void 0&&(j[X.bucketInstanceId]=[]),j[X.bucketInstanceId].push(X.featureIndex))}return j}insertCollisionBox(l,p,x,E,A){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:E,collisionGroupID:A},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,p,x,E,A){const I=p?this.ignoredGrid:this.grid,D={bucketInstanceId:x,featureIndex:E,collisionGroupID:A};for(let B=0;B<l.length;B+=4)I.insertCircle(D,l[B],l[B+1],l[B+2])}projectAndGetPerspectiveRatio(l,p,x,E,A){const I=[p,x,E||0,1];let D=!1;if(E||this.transform.pitch>0){o.transformMat4$1(I,I,l);let B=!1;this.fogState&&A&&(B=function(j,$,X,K,se,re){const ae=re.calculateFogTileMatrix(se),Pe=[$,X,K];return o.transformMat4(Pe,Pe,ae),Vt(j,Pe,re.pitch,re._fov)}(this.fogState,p,x,E||0,A.toUnwrapped(),this.transform)>.9),D=I[2]>I[3]||B}else ws(I,I,l);return{point:new o.pointGeometry((I[0]/I[3]+1)/2*this.transform.width+pi,(-I[1]/I[3]+1)/2*this.transform.height+pi),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/I[3]*.5,1.5),signedDistanceFromCamera:I[3],aboveHorizon:D}}isOffscreen(l,p,x,E){return x<pi||l>=this.screenRightBoundary||E<pi||p>this.screenBottomBoundary}isInsideGrid(l,p,x,E){return x>=0&&l<this.gridRightBoundary&&E>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const l=o.identity([]);return o.translate(l,l,[-100,-100,0]),l}}class Ts{constructor(l,p,x,E){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?p:-p))):E&&x?1:0,this.placed=x}isHidden(){return this.opacity===0&&!this.placed}}class Go{constructor(l,p,x,E,A,I=!1){this.text=new Ts(l?l.text:null,p,x,A),this.icon=new Ts(l?l.icon:null,p,E,A),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Es{constructor(l,p,x,E=!1){this.text=l,this.icon=p,this.skipFade=x,this.clipped=E}}class Yo{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class S1{constructor(l,p,x,E,A){this.bucketInstanceId=l,this.featureIndex=p,this.sourceLayerIndex=x,this.bucketIndex=E,this.tileID=A}}class Za{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const p=++this.maxGroupID;this.collisionGroups[l]={ID:p,predicate:x=>x.collisionGroupID===p}}return this.collisionGroups[l]}}function qa(v,l,p,x,E){const{horizontalAlign:A,verticalAlign:I}=o.getAnchorAlignment(v),D=-(A-.5)*l,B=-(I-.5)*p,j=o.evaluateVariableOffset(v,x);return new o.pointGeometry(D+j[0]*E,B+j[1]*E)}function Q(v,l,p,x,E){const A=new o.pointGeometry(v,l);return p&&A._rotate(x?E:-E),A}class fe{constructor(l,p,x,E,A){this.transform=l.clone(),this.collisionIndex=new Xa(this.transform,A),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Za(x),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,p,x,E){const A=x.getBucket(p),I=x.latestFeatureIndex;if(!A||!I||p.id!==A.layerIds[0])return;const D=A.layers[0].layout,B=x.collisionBoxArray,j=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),$=x.tileSize/o.EXTENT,X=x.tileID.toUnwrapped(),K=this.transform.calculateProjMatrix(X),se=D.get("text-pitch-alignment")==="map",re=D.get("text-rotation-alignment")==="map";p.compileFilter();const ae=p.dynamicFilter(),Pe=p.dynamicFilterNeedsFeature(),ie=this.transform.calculatePixelsToTileUnitsMatrix(x),Ae=$r(K,x.tileID.canonical,se,re,this.transform,ie);let Se=null;if(se){const Ie=ki(K,x.tileID.canonical,se,re,this.transform,ie);Se=o.multiply$1([],this.transform.labelPlaneMatrix,Ie)}let be=null;ae&&x.latestFeatureIndex&&(be={unwrappedTileID:X,dynamicFilter:ae,dynamicFilterNeedsFeature:Pe,featureIndex:x.latestFeatureIndex}),this.retainedQueryData[A.bucketInstanceId]=new S1(A.bucketInstanceId,I,A.sourceLayerIndex,A.index,x.tileID);const we={bucket:A,layout:D,posMatrix:K,textLabelPlaneMatrix:Ae,labelToScreenMatrix:Se,clippingData:be,scale:j,textPixelRatio:$,holdingForFade:x.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(A.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(A.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(E)for(const Ie of A.sortKeyRanges){const{sortKey:Ke,symbolInstanceStart:st,symbolInstanceEnd:It}=Ie;l.push({sortKey:Ke,symbolInstanceStart:st,symbolInstanceEnd:It,parameters:we})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:we})}attemptAnchorPlacement(l,p,x,E,A,I,D,B,j,$,X,K,se,re,ae,Pe,ie,Ae){const Se=[K.textOffset0,K.textOffset1],be=qa(l,x,E,Se,A),we=this.collisionIndex.placeCollisionBox(A,p,Q(be.x,be.y,I,D,this.transform.angle),X,B,j,$.predicate);if((!Pe||this.collisionIndex.placeCollisionBox(re.getSymbolInstanceIconSize(Ae,this.transform.zoom,se),Pe,Q(be.x,be.y,I,D,this.transform.angle),X,B,j,$.predicate).box.length!==0)&&we.box.length>0){let Ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID].text&&(Ie=this.prevPlacement.variableOffsets[K.crossTileID].anchor),this.variableOffsets[K.crossTileID]={textOffset:Se,width:x,height:E,anchor:l,textScale:A,prevAnchor:Ie},this.markUsedJustification(re,l,K,ae),re.allowVerticalPlacement&&(this.markUsedOrientation(re,ae,K),this.placedOrientations[K.crossTileID]=ae),{shift:be,placedGlyphBoxes:we}}}placeLayerBucketPart(l,p,x,E){const{bucket:A,layout:I,posMatrix:D,textLabelPlaneMatrix:B,labelToScreenMatrix:j,clippingData:$,textPixelRatio:X,holdingForFade:K,collisionBoxArray:se,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:ae,collisionGroup:Pe}=l.parameters,ie=I.get("text-optional"),Ae=I.get("icon-optional"),Se=I.get("text-allow-overlap"),be=I.get("icon-allow-overlap"),we=I.get("text-rotation-alignment")==="map",Ie=I.get("text-pitch-alignment")==="map",Ke=I.get("icon-text-fit")!=="none",st=I.get("symbol-z-order")==="viewport-y",It=Se&&(be||!A.hasIconData()||Ae),Et=be&&(Se||!A.hasTextData()||ie);!A.collisionArrays&&se&&A.deserializeCollisionBoxes(se),x&&E&&A.updateCollisionDebugBuffers(this.transform.zoom,se);const bt=(ut,it,vt)=>{if($){const $n={zoom:this.transform.zoom,pitch:this.transform.pitch};let gn=null;if($.dynamicFilterNeedsFeature){const Un=this.retainedQueryData[A.bucketInstanceId];gn=$.featureIndex.loadFeature({featureIndex:ut.featureIndex,bucketIndex:Un.bucketIndex,sourceLayerIndex:Un.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,$.dynamicFilter)($n,gn,this.retainedQueryData[A.bucketInstanceId].tileID.canonical,new o.pointGeometry(ut.tileAnchorX,ut.tileAnchorY),this.transform.calculateDistanceTileData($.unwrappedTileID)))return this.placements[ut.crossTileID]=new Es(!1,!1,!1,!0),void(p[ut.crossTileID]=!0)}if(p[ut.crossTileID])return;if(K)return void(this.placements[ut.crossTileID]=new Es(!1,!1,!1));let dt=!1,nn=!1,hn=!0,In=null,Rt={box:null,offscreen:null},sn={box:null,offscreen:null},_n=null,Jn=null,hr=null,mn=0,Nn=0,fr=0;vt.textFeatureIndex?mn=vt.textFeatureIndex:ut.useRuntimeCollisionCircles&&(mn=ut.featureIndex),vt.verticalTextFeatureIndex&&(Nn=vt.verticalTextFeatureIndex);const _r=$n=>{$n.tileID=this.retainedQueryData[A.bucketInstanceId].tileID,(this.transform.elevation||$n.elevation)&&($n.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[A.bucketInstanceId].tileID,$n.tileAnchorX,$n.tileAnchorY):0)},_i=vt.textBox;if(_i){_r(_i);const $n=Un=>{let Rr=o.WritingMode.horizontal;if(A.allowVerticalPlacement&&!Un&&this.prevPlacement){const tr=this.prevPlacement.placedOrientations[ut.crossTileID];tr&&(this.placedOrientations[ut.crossTileID]=tr,Rr=tr,this.markUsedOrientation(A,Rr,ut))}return Rr},gn=(Un,Rr)=>{if(A.allowVerticalPlacement&&ut.numVerticalGlyphVertices>0&&vt.verticalTextBox){for(const tr of A.writingModes)if(tr===o.WritingMode.vertical?(Rt=Rr(),sn=Rt):Rt=Un(),Rt&&Rt.box&&Rt.box.length)break}else Rt=Un()};if(I.get("text-variable-anchor")){let Un=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ut.crossTileID]){const dr=this.prevPlacement.variableOffsets[ut.crossTileID];Un.indexOf(dr.anchor)>0&&(Un=Un.filter(qr=>qr!==dr.anchor),Un.unshift(dr.anchor))}const Rr=(dr,qr,js)=>{const zr=A.getSymbolInstanceTextSize(re,ut,this.transform.zoom,it),Ca=(dr.x2-dr.x1)*zr+2*dr.padding,Gt=(dr.y2-dr.y1)*zr+2*dr.padding,an=Ke&&!be?qr:null;an&&_r(an);let li={box:[],offscreen:!1};const ko=Se?2*Un.length:Un.length;for(let Oo=0;Oo<ko;++Oo){const Hr=this.attemptAnchorPlacement(Un[Oo%Un.length],dr,Ca,Gt,zr,we,Ie,X,D,Pe,Oo>=Un.length,ut,it,A,js,an,re,ae);if(Hr&&(li=Hr.placedGlyphBoxes,li&&li.box&&li.box.length)){dt=!0,In=Hr.shift;break}}return li};gn(()=>Rr(_i,vt.iconBox,o.WritingMode.horizontal),()=>{const dr=vt.verticalTextBox;return dr&&_r(dr),A.allowVerticalPlacement&&!(Rt&&Rt.box&&Rt.box.length)&&ut.numVerticalGlyphVertices>0&&dr?Rr(dr,vt.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Rt&&(dt=Rt.box,hn=Rt.offscreen);const tr=$n(Rt&&Rt.box);if(!dt&&this.prevPlacement){const dr=this.prevPlacement.variableOffsets[ut.crossTileID];dr&&(this.variableOffsets[ut.crossTileID]=dr,this.markUsedJustification(A,dr.anchor,ut,tr))}}else{const Un=(Rr,tr)=>{const dr=A.getSymbolInstanceTextSize(re,ut,this.transform.zoom,it),qr=this.collisionIndex.placeCollisionBox(dr,Rr,new o.pointGeometry(0,0),Se,X,D,Pe.predicate);return qr&&qr.box&&qr.box.length&&(this.markUsedOrientation(A,tr,ut),this.placedOrientations[ut.crossTileID]=tr),qr};gn(()=>Un(_i,o.WritingMode.horizontal),()=>{const Rr=vt.verticalTextBox;return A.allowVerticalPlacement&&ut.numVerticalGlyphVertices>0&&Rr?(_r(Rr),Un(Rr,o.WritingMode.vertical)):{box:null,offscreen:null}}),$n(Rt&&Rt.box&&Rt.box.length)}}if(_n=Rt,dt=_n&&_n.box&&_n.box.length>0,hn=_n&&_n.offscreen,ut.useRuntimeCollisionCircles){const $n=A.text.placedSymbolArray.get(ut.centerJustifiedTextSymbolIndex>=0?ut.centerJustifiedTextSymbolIndex:ut.verticalPlacedTextSymbolIndex),gn=o.evaluateSizeForFeature(A.textSizeData,re,$n),Un=I.get("text-padding");Jn=this.collisionIndex.placeCollisionCircles(Se,$n,A.lineVertexArray,A.glyphOffsetArray,gn,D,B,j,x,Ie,Pe.predicate,ut.collisionCircleDiameter*gn/o.ONE_EM,Un,this.retainedQueryData[A.bucketInstanceId].tileID),dt=Se||Jn.circles.length>0&&!Jn.collisionDetected,hn=hn&&Jn.offscreen}if(vt.iconFeatureIndex&&(fr=vt.iconFeatureIndex),vt.iconBox){const $n=gn=>{_r(gn);const Un=Ke&&In?Q(In.x,In.y,we,Ie,this.transform.angle):new o.pointGeometry(0,0),Rr=A.getSymbolInstanceIconSize(ae,this.transform.zoom,it);return this.collisionIndex.placeCollisionBox(Rr,gn,Un,be,X,D,Pe.predicate)};sn&&sn.box&&sn.box.length&&vt.verticalIconBox?(hr=$n(vt.verticalIconBox),nn=hr.box.length>0):(hr=$n(vt.iconBox),nn=hr.box.length>0),hn=hn&&hr.offscreen}const Ni=ie||ut.numHorizontalGlyphVertices===0&&ut.numVerticalGlyphVertices===0,Ai=Ae||ut.numIconVertices===0;if(Ni||Ai?Ai?Ni||(nn=nn&&dt):dt=nn&&dt:nn=dt=nn&&dt,dt&&_n&&_n.box&&this.collisionIndex.insertCollisionBox(_n.box,I.get("text-ignore-placement"),A.bucketInstanceId,sn&&sn.box&&Nn?Nn:mn,Pe.ID),nn&&hr&&this.collisionIndex.insertCollisionBox(hr.box,I.get("icon-ignore-placement"),A.bucketInstanceId,fr,Pe.ID),Jn&&(dt&&this.collisionIndex.insertCollisionCircles(Jn.circles,I.get("text-ignore-placement"),A.bucketInstanceId,mn,Pe.ID),x)){const $n=A.bucketInstanceId;let gn=this.collisionCircleArrays[$n];gn===void 0&&(gn=this.collisionCircleArrays[$n]=new Yo);for(let Un=0;Un<Jn.circles.length;Un+=4)gn.circles.push(Jn.circles[Un+0]),gn.circles.push(Jn.circles[Un+1]),gn.circles.push(Jn.circles[Un+2]),gn.circles.push(Jn.collisionDetected?1:0)}this.placements[ut.crossTileID]=new Es(dt||It,nn||Et,hn||A.justReloaded),p[ut.crossTileID]=!0};if(st){const ut=A.getSortedSymbolIndexes(this.transform.angle);for(let it=ut.length-1;it>=0;--it){const vt=ut[it];bt(A.symbolInstances.get(vt),vt,A.collisionArrays[vt])}}else for(let ut=l.symbolInstanceStart;ut<l.symbolInstanceEnd;ut++)bt(A.symbolInstances.get(ut),ut,A.collisionArrays[ut]);if(x&&A.bucketInstanceId in this.collisionCircleArrays){const ut=this.collisionCircleArrays[A.bucketInstanceId];o.invert(ut.invProjMatrix,D),ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1}markUsedJustification(l,p,x,E){let A;A=E===o.WritingMode.vertical?x.verticalPlacedTextSymbolIndex:{left:x.leftJustifiedTextSymbolIndex,center:x.centerJustifiedTextSymbolIndex,right:x.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(p)];const I=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex,x.verticalPlacedTextSymbolIndex];for(const D of I)D>=0&&(l.text.placedSymbolArray.get(D).crossTileID=A>=0&&D!==A?0:x.crossTileID)}markUsedOrientation(l,p,x){const E=p===o.WritingMode.horizontal||p===o.WritingMode.horizontalOnly?p:0,A=p===o.WritingMode.vertical?p:0,I=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex];for(const D of I)l.text.placedSymbolArray.get(D).placedOrientation=E;x.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(x.verticalPlacedTextSymbolIndex).placedOrientation=A)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let x=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const E=p?p.symbolFadeChange(l):1,A=p?p.opacities:{},I=p?p.variableOffsets:{},D=p?p.placedOrientations:{};for(const B in this.placements){const j=this.placements[B],$=A[B];$?(this.opacities[B]=new Go($,E,j.text,j.icon,null,j.clipped),x=x||j.text!==$.text.placed||j.icon!==$.icon.placed):(this.opacities[B]=new Go(null,E,j.text,j.icon,j.skipFade,j.clipped),x=x||j.text||j.icon)}for(const B in A){const j=A[B];if(!this.opacities[B]){const $=new Go(j,E,!1,!1);$.isHidden()||(this.opacities[B]=$,x=x||j.text.placed||j.icon.placed)}}for(const B in I)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=I[B]);for(const B in D)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=D[B]);x?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:l)}updateLayerOpacities(l,p){const x={};for(const E of p){const A=E.getBucket(l);A&&E.latestFeatureIndex&&l.id===A.layerIds[0]&&this.updateBucketOpacities(A,x,E.collisionBoxArray)}}updateBucketOpacities(l,p,x){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const E=l.layers[0].layout,A=!!l.layers[0].dynamicFilter(),I=new Go(null,0,!1,!1,!0),D=E.get("text-allow-overlap"),B=E.get("icon-allow-overlap"),j=E.get("text-variable-anchor"),$=E.get("text-rotation-alignment")==="map",X=E.get("text-pitch-alignment")==="map",K=E.get("icon-text-fit")!=="none",se=new Go(null,0,D&&(B||!l.hasIconData()||E.get("icon-optional")),B&&(D||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&x&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(x);const re=(Pe,ie,Ae)=>{for(let Se=0;Se<ie/4;Se++)Pe.opacityVertexArray.emplaceBack(Ae)};let ae=0;for(let Pe=0;Pe<l.symbolInstances.length;Pe++){const ie=l.symbolInstances.get(Pe),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:Se,crossTileID:be}=ie;let we=this.opacities[be];p[be]?we=I:we||(we=se,this.opacities[be]=we),p[be]=!0;const Ie=Ae>0||Se>0,Ke=ie.numIconVertices>0,st=this.placedOrientations[ie.crossTileID],It=st===o.WritingMode.vertical,Et=st===o.WritingMode.horizontal||st===o.WritingMode.horizontalOnly;if(!Ie&&!Ke||we.isHidden()||ae++,Ie){const bt=Oi(we.text);re(l.text,Ae,It?Ko:bt),re(l.text,Se,Et?Ko:bt);const ut=we.text.isHidden();[ie.rightJustifiedTextSymbolIndex,ie.centerJustifiedTextSymbolIndex,ie.leftJustifiedTextSymbolIndex].forEach(dt=>{dt>=0&&(l.text.placedSymbolArray.get(dt).hidden=ut||It?1:0)}),ie.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(ie.verticalPlacedTextSymbolIndex).hidden=ut||Et?1:0);const it=this.variableOffsets[ie.crossTileID];it&&this.markUsedJustification(l,it.anchor,ie,st);const vt=this.placedOrientations[ie.crossTileID];vt&&(this.markUsedJustification(l,"left",ie,vt),this.markUsedOrientation(l,vt,ie))}if(Ke){const bt=Oi(we.icon);ie.placedIconSymbolIndex>=0&&(re(l.icon,ie.numIconVertices,It?Ko:bt),l.icon.placedSymbolArray.get(ie.placedIconSymbolIndex).hidden=we.icon.isHidden()),ie.verticalPlacedIconSymbolIndex>=0&&(re(l.icon,ie.numVerticalIconVertices,Et?Ko:bt),l.icon.placedSymbolArray.get(ie.verticalPlacedIconSymbolIndex).hidden=we.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const bt=l.collisionArrays[Pe];if(bt){let ut=new o.pointGeometry(0,0),it=!0;if(bt.textBox||bt.verticalTextBox){if(j){const dt=this.variableOffsets[be];dt?(ut=qa(dt.anchor,dt.width,dt.height,dt.textOffset,dt.textScale),$&&ut._rotate(X?this.transform.angle:-this.transform.angle)):it=!1}A&&(it=!we.clipped),bt.textBox&&ke(l.textCollisionBox.collisionVertexArray,we.text.placed,!it||It,ut.x,ut.y),bt.verticalTextBox&&ke(l.textCollisionBox.collisionVertexArray,we.text.placed,!it||Et,ut.x,ut.y)}const vt=it&&!!(!Et&&bt.verticalIconBox);bt.iconBox&&ke(l.iconCollisionBox.collisionVertexArray,we.icon.placed,vt,K?ut.x:0,K?ut.y:0),bt.verticalIconBox&&ke(l.iconCollisionBox.collisionVertexArray,we.icon.placed,!vt,K?ut.x:0,K?ut.y:0)}}}if(l.fullyClipped=ae===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Pe.invProjMatrix,l.placementViewportMatrix=Pe.viewportMatrix,l.collisionCircleArray=Pe.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,p){const x=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*x>l}setStale(){this.stale=!0}}function ke(v,l,p,x,E){v.emplaceBack(l?1:0,p?1:0,x||0,E||0),v.emplaceBack(l?1:0,p?1:0,x||0,E||0),v.emplaceBack(l?1:0,p?1:0,x||0,E||0),v.emplaceBack(l?1:0,p?1:0,x||0,E||0)}const ge=Math.pow(2,25),He=Math.pow(2,24),Jt=Math.pow(2,17),bn=Math.pow(2,16),Pn=Math.pow(2,9),vr=Math.pow(2,8),wr=Math.pow(2,1);function Oi(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const l=v.placed?1:0,p=Math.floor(127*v.opacity);return p*ge+l*He+p*Jt+l*bn+p*Pn+l*vr+p*wr+l}const Ko=0;class Wt{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,p,x,E,A){const I=this._bucketParts;for(;this._currentTileIndex<l.length;)if(p.getBucketParts(I,E,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((D,B)=>D.sortKey-B.sortKey));this._currentPartIndex<I.length;){const D=I[this._currentPartIndex];if(p.placeLayerBucketPart(D,this._seenCrossTileIDs,x,D.symbolInstanceStart===0),this._currentPartIndex++,A())return!0}return!1}}class zn{constructor(l,p,x,E,A,I,D,B){this.placement=new fe(l,A,I,D,B),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(l,p,x){const E=o.exported.now(),A=()=>{const I=o.exported.now()-E;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=p[l[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=D)&&(!I.maxzoom||I.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new Wt(I)),this._inProgressLayer.continuePlacement(x[I.source],this.placement,this._showCollisionBoxes,I,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Fn=512/o.EXTENT/2;class Ns{constructor(l,p,x){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=x;for(let E=0;E<p.length;E++){const A=p.get(E),I=A.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:A.crossTileID,coord:this.getScaledCoordinates(A,l)})}}getScaledCoordinates(l,p){const x=Fn/Math.pow(2,p.canonical.z-this.tileID.canonical.z);return{x:Math.floor((p.canonical.x*o.EXTENT+l.tileAnchorX)*x),y:Math.floor((p.canonical.y*o.EXTENT+l.tileAnchorY)*x)}}findMatches(l,p,x){const E=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z);for(let A=0;A<l.length;A++){const I=l.get(A);if(I.crossTileID)continue;const D=this.indexedSymbolInstances[I.key];if(!D)continue;const B=this.getScaledCoordinates(I,p);for(const j of D)if(Math.abs(j.coord.x-B.x)<=E&&Math.abs(j.coord.y-B.y)<=E&&!x[j.crossTileID]){x[j.crossTileID]=!0,I.crossTileID=j.crossTileID;break}}}}class Bl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const p=Math.round((l-this.lng)/360);if(p!==0)for(const x in this.indexes){const E=this.indexes[x],A={};for(const I in E){const D=E[I];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+p),A[D.tileID.key]=D}this.indexes[x]=A}this.lng=l}addBucket(l,p,x){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let A=0;A<p.symbolInstances.length;A++)p.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const E=this.usedCrossTileIDs[l.overscaledZ];for(const A in this.indexes){const I=this.indexes[A];if(Number(A)>l.overscaledZ)for(const D in I){const B=I[D];B.tileID.isChildOf(l)&&B.findMatches(p.symbolInstances,l,E)}else{const D=I[l.scaledTo(Number(A)).key];D&&D.findMatches(p.symbolInstances,l,E)}}for(let A=0;A<p.symbolInstances.length;A++){const I=p.symbolInstances.get(A);I.crossTileID||(I.crossTileID=x.generate(),E[I.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Ns(l,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(l,p){for(const x in p.indexedSymbolInstances)for(const E of p.indexedSymbolInstances[x])delete this.usedCrossTileIDs[l][E.crossTileID]}removeStaleBuckets(l){let p=!1;for(const x in this.indexes){const E=this.indexes[x];for(const A in E)l[E[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,E[A]),delete E[A],p=!0)}return p}}class So{constructor(){this.layerIndexes={},this.crossTileIDs=new Bl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,p,x,E){let A=this.layerIndexes[l.id];A===void 0&&(A=this.layerIndexes[l.id]=new rn);let I=!1;const D={};E.name!=="globe"&&A.handleWrapJump(x);for(const B of p){const j=B.getBucket(l);j&&l.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),A.addBucket(B.tileID,j,this.crossTileIDs)&&(I=!0),D[j.bucketInstanceId]=!0)}return A.removeStaleBuckets(D)&&(I=!0),I}pruneUnusedLayers(l){const p={};l.forEach(x=>{p[x]=!0});for(const x in this.layerIndexes)p[x]||delete this.layerIndexes[x]}}const _a=(v,l)=>o.emitValidationErrors(v,l&&l.filter(p=>p.identifier!=="source.canvas")),A1=o.pick(_t,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Di=o.pick(_t,["setCenter","setZoom","setBearing","setPitch"]),Ir=function(){const v={},l=o.spec.$version;for(const p in o.spec.$root){const x=o.spec.$root[p];if(x.required){let E=null;E=p==="version"?l:x.type==="array"?[]:{},E!=null&&(v[p]=E)}}return v}(),Ec={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class oi extends o.Evented{constructor(l,p={}){super(),this.map=l,this.dispatcher=new ce(Le(),this),this.imageManager=new Me,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(l._requestManager,p.localFontFamily?o.LocalGlyphMode.all:p.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,p.localFontFamily||p.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new So,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const x=this;this._rtlTextPluginCallback=oi.registerForPluginStateChange(E=>{x.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},(A,I)=>{if(o.triggerPluginCompletionEvent(A),I&&I.every(D=>D))for(const D in x._sourceCaches){const B=x._sourceCaches[D],j=B.getSource().type;j!=="vector"&&j!=="geojson"||B.reload()}})}),this.on("data",E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const A=this.getSource(E.sourceId);if(A&&A.vectorLayerIds)for(const I in this._layers){const D=this._layers[I];D.source===A.id&&this._validateLayer(D)}})}loadURL(l,p={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const x=typeof p.validate=="boolean"?p.validate:!o.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,p.accessToken);const E=this.map._requestManager.transformRequest(l,o.ResourceType.Style);this._request=o.getJSON(E,(A,I)=>{this._request=null,A?this.fire(new o.ErrorEvent(A)):I&&this._load(I,x)})}loadJSON(l,p={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(l,p.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Ir,!1)}_updateLayerCount(l,p){const x=p?1:-1;l.is3D()&&(this._num3DLayers+=x),l.type==="circle"&&(this._numCircleLayers+=x),l.type==="symbol"&&(this._numSymbolLayers+=x)}_load(l,p){if(p&&_a(this,o.validateStyle(l)))return;this._loaded=!0,this.stylesheet=l,this.updateProjection();for(const E in l.sources)this.addSource(E,l.sources[E],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);const x=ft(this.stylesheet.layers);this._order=x.map(E=>E.id),this._layers={},this._serializedLayers={};for(let E of x)E=o.createStyleLayer(E),E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new xt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&this.terrain.drapeRenderMode===0}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const l=this.map.transform.projection,p=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),x=this.map.transform.projection;if(this._loaded&&(x.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),p){if(x.isReprojectedInTileSpace||l.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const E in this._sourceCaches)this._sourceCaches[E].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(l){this._spriteRequest=function(p,x,E){let A,I,D;const B=o.exported.devicePixelRatio>1?"@2x":"";let j=o.getJSON(x.transformRequest(x.normalizeSpriteURL(p,B,".json"),o.ResourceType.SpriteJSON),(K,se)=>{j=null,D||(D=K,A=se,X())}),$=o.getImage(x.transformRequest(x.normalizeSpriteURL(p,B,".png"),o.ResourceType.SpriteImage),(K,se)=>{$=null,D||(D=K,I=se,X())});function X(){if(D)E(D);else if(A&&I){const K=o.exported.getImageData(I),se={};for(const re in A){const{width:ae,height:Pe,x:ie,y:Ae,sdf:Se,pixelRatio:be,stretchX:we,stretchY:Ie,content:Ke}=A[re],st=new o.RGBAImage({width:ae,height:Pe});o.RGBAImage.copy(K,st,{x:ie,y:Ae},{x:0,y:0},{width:ae,height:Pe}),se[re]={data:st,pixelRatio:be,sdf:Se,stretchX:we,stretchY:Ie,content:Ke}}E(null,se)}}return{cancel(){j&&(j.cancel(),j=null),$&&($.cancel(),$=null)}}}(l,this.map._requestManager,(p,x)=>{if(this._spriteRequest=null,p)this.fire(new o.ErrorEvent(p));else if(x)for(const E in x)this.imageManager.addImage(E,x[E]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(l){const p=this.getSource(l.source);if(!p)return;const x=l.sourceLayer;x&&(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(x)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${x}" does not exist on source "${p.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){const p=[];for(const x of l){const E=this._layers[x];E.type!=="custom"&&p.push(E.serialize())}return p}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&Ec[l.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;const p=this._changed;if(this._changed){const E=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);(E.length||A.length)&&this._updateWorkerLayers(E,A);for(const I in this._updatedSources){const D=this._updatedSources[I];D==="reload"?this._reloadSource(I):D==="clear"&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}const x={};for(const E in this._sourceCaches){const A=this._sourceCaches[E];x[E]=A.used,A.used=!1}for(const E of this._order){const A=this._layers[E];if(A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)){const D=this._getLayerSourceCache(A);D&&(D.used=!0)}const I=this.map.painter;if(I){const D=A.getProgramIds();if(!D)continue;const B=A.getProgramConfiguration(l.zoom);for(const j of D)I.useProgram(j,B)}}for(const E in x){const A=this._sourceCaches[E];x[E]!==A.used&&A.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const p in this._sourceCaches)this._sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:p})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),_a(this,o.validateStyle(l)))return!1;(l=o.clone$1(l)).layers=ft(l.layers);const p=function(E,A){if(!E)return[{command:_t.setStyle,args:[A]}];let I=[];try{if(!U(E.version,A.version))return[{command:_t.setStyle,args:[A]}];U(E.center,A.center)||I.push({command:_t.setCenter,args:[A.center]}),U(E.zoom,A.zoom)||I.push({command:_t.setZoom,args:[A.zoom]}),U(E.bearing,A.bearing)||I.push({command:_t.setBearing,args:[A.bearing]}),U(E.pitch,A.pitch)||I.push({command:_t.setPitch,args:[A.pitch]}),U(E.sprite,A.sprite)||I.push({command:_t.setSprite,args:[A.sprite]}),U(E.glyphs,A.glyphs)||I.push({command:_t.setGlyphs,args:[A.glyphs]}),U(E.transition,A.transition)||I.push({command:_t.setTransition,args:[A.transition]}),U(E.light,A.light)||I.push({command:_t.setLight,args:[A.light]}),U(E.fog,A.fog)||I.push({command:_t.setFog,args:[A.fog]}),U(E.projection,A.projection)||I.push({command:_t.setProjection,args:[A.projection]});const D={},B=[];(function(X,K,se,re){let ae;for(ae in K=K||{},X=X||{})X.hasOwnProperty(ae)&&(K.hasOwnProperty(ae)||qt(ae,se,re));for(ae in K)K.hasOwnProperty(ae)&&(X.hasOwnProperty(ae)?U(X[ae],K[ae])||(X[ae].type==="geojson"&&K[ae].type==="geojson"&&tn(X,K,ae)?se.push({command:_t.setGeoJSONSourceData,args:[ae,K[ae].data]}):Kt(ae,K,se,re)):Tt(ae,K,se))})(E.sources,A.sources,B,D);const j=[];E.layers&&E.layers.forEach(X=>{D[X.source]?I.push({command:_t.removeLayer,args:[X.id]}):j.push(X)});let $=E.terrain;$&&D[$.source]&&(I.push({command:_t.setTerrain,args:[void 0]}),$=void 0),I=I.concat(B),U($,A.terrain)||I.push({command:_t.setTerrain,args:[A.terrain]}),function(X,K,se){K=K||[];const re=(X=X||[]).map(Sn),ae=K.map(Sn),Pe=X.reduce(ir,{}),ie=K.reduce(ir,{}),Ae=re.slice(),Se=Object.create(null);let be,we,Ie,Ke,st,It,Et;for(be=0,we=0;be<re.length;be++)Ie=re[be],ie.hasOwnProperty(Ie)?we++:(se.push({command:_t.removeLayer,args:[Ie]}),Ae.splice(Ae.indexOf(Ie,we),1));for(be=0,we=0;be<ae.length;be++)Ie=ae[ae.length-1-be],Ae[Ae.length-1-be]!==Ie&&(Pe.hasOwnProperty(Ie)?(se.push({command:_t.removeLayer,args:[Ie]}),Ae.splice(Ae.lastIndexOf(Ie,Ae.length-we),1)):we++,It=Ae[Ae.length-be],se.push({command:_t.addLayer,args:[ie[Ie],It]}),Ae.splice(Ae.length-be,0,Ie),Se[Ie]=!0);for(be=0;be<ae.length;be++)if(Ie=ae[be],Ke=Pe[Ie],st=ie[Ie],!Se[Ie]&&!U(Ke,st))if(U(Ke.source,st.source)&&U(Ke["source-layer"],st["source-layer"])&&U(Ke.type,st.type)){for(Et in on(Ke.layout,st.layout,se,Ie,null,_t.setLayoutProperty),on(Ke.paint,st.paint,se,Ie,null,_t.setPaintProperty),U(Ke.filter,st.filter)||se.push({command:_t.setFilter,args:[Ie,st.filter]}),U(Ke.minzoom,st.minzoom)&&U(Ke.maxzoom,st.maxzoom)||se.push({command:_t.setLayerZoomRange,args:[Ie,st.minzoom,st.maxzoom]}),Ke)Ke.hasOwnProperty(Et)&&Et!=="layout"&&Et!=="paint"&&Et!=="filter"&&Et!=="metadata"&&Et!=="minzoom"&&Et!=="maxzoom"&&(Et.indexOf("paint.")===0?on(Ke[Et],st[Et],se,Ie,Et.slice(6),_t.setPaintProperty):U(Ke[Et],st[Et])||se.push({command:_t.setLayerProperty,args:[Ie,Et,st[Et]]}));for(Et in st)st.hasOwnProperty(Et)&&!Ke.hasOwnProperty(Et)&&Et!=="layout"&&Et!=="paint"&&Et!=="filter"&&Et!=="metadata"&&Et!=="minzoom"&&Et!=="maxzoom"&&(Et.indexOf("paint.")===0?on(Ke[Et],st[Et],se,Ie,Et.slice(6),_t.setPaintProperty):U(Ke[Et],st[Et])||se.push({command:_t.setLayerProperty,args:[Ie,Et,st[Et]]}))}else se.push({command:_t.removeLayer,args:[Ie]}),It=Ae[Ae.lastIndexOf(Ie)+1],se.push({command:_t.addLayer,args:[st,It]})}(j,A.layers,I)}catch(D){console.warn("Unable to compute style diff:",D),I=[{command:_t.setStyle,args:[A]}]}return I}(this.serialize(),l).filter(E=>!(E.command in Di));if(p.length===0)return!1;const x=p.filter(E=>!(E.command in A1));if(x.length>0)throw new Error(`Unimplemented: ${x.map(E=>E.command).join(", ")}.`);return p.forEach(E=>{E.command!=="setTransition"&&this[E.command].apply(this,E.args)}),this.stylesheet=l,this.updateProjection(),!0}addImage(l,p){if(this.getImage(l))return this.fire(new o.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(l,p),this._afterImageUpdated(l)}updateImage(l,p){this.imageManager.updateImage(l,p)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new o.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,p,x={}){if(this._checkLoaded(),this.getSource(l)!==void 0)throw new Error("There is already a source with this ID");if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(o.validateStyle.source,`sources.${l}`,p,null,x))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const E=Ri(l,p,this.dispatcher,this);E.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:E.serialize(),sourceId:l}));const A=I=>{const D=(I?"symbol:":"other:")+l,B=this._sourceCaches[D]=new o.SourceCache(D,E,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[l]=B,B.style=this,B.onAdd(this.map)};A(!1),p.type!=="vector"&&p.type!=="geojson"||A(!0),E.onAdd&&E.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();const p=this.getSource(l);if(p===void 0)throw new Error("There is no source with this ID");for(const E in this._layers)if(this._layers[E].source===l)return this.fire(new o.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${E}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new o.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const x=this._getSourceCaches(l);for(const E of x)delete this._sourceCaches[E.id],delete this._updatedSources[E.id],E.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:E.getSource().id})),E.setEventedParent(null),E.clearTiles();delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],p.setEventedParent(null),p.onRemove&&p.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,p){this._checkLoaded(),this.getSource(l).setData(p),this._changed=!0}getSource(l){const p=this._getSourceCache(l);return p&&p.getSource()}addLayer(l,p,x={}){this._checkLoaded();const E=l.id;if(this.getLayer(E))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${E}" already exists on this map`)));let A;if(l.type==="custom"){if(_a(this,o.validateCustomStyleLayer(l)))return;A=o.createStyleLayer(l)}else{if(typeof l.source=="object"&&(this.addSource(E,l.source),l=o.clone$1(l),l=o.extend(l,{source:E})),this._validate(o.validateStyle.layer,`layers.${E}`,l,{arrayIndex:-1},x))return;A=o.createStyleLayer(l),this._validateLayer(A),A.setEventedParent(this,{layer:{id:E}}),this._serializedLayers[A.id]=A.serialize(),this._updateLayerCount(A,!0)}const I=p?this._order.indexOf(p):this._order.length;if(p&&I===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${p}" does not exist on this map.`)));this._order.splice(I,0,E),this._layerOrderChanged=!0,this._layers[E]=A;const D=this._getLayerSourceCache(A);if(this._removedLayers[E]&&A.source&&D&&A.type!=="custom"){const B=this._removedLayers[E];delete this._removedLayers[E],B.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",D.pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,p){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new o.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===p)return;const x=this._order.indexOf(l);this._order.splice(x,1);const E=p?this._order.indexOf(p):this._order.length;p&&E===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${p}" does not exist on this map.`))):(this._order.splice(E,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();const p=this._layers[l];if(!p)return void this.fire(new o.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));p.setEventedParent(null),this._updateLayerCount(p,!1);const x=this._order.indexOf(l);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=p,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],p.onRemove&&p.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(const p in this._layers)if(this._layers[p].type===l)return!0;return!1}setLayerZoomRange(l,p,x){this._checkLoaded();const E=this.getLayer(l);E?E.minzoom===p&&E.maxzoom===x||(p!=null&&(E.minzoom=p),x!=null&&(E.maxzoom=x),this._updateLayer(E)):this.fire(new o.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,p,x={}){this._checkLoaded();const E=this.getLayer(l);if(E){if(!U(E.filter,p))return p==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(o.validateStyle.filter,`layers.${E.id}.filter`,p,{layerType:E.type},x)||(E.filter=o.clone$1(p),this._updateLayer(E)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){return o.clone$1(this.getLayer(l).filter)}setLayoutProperty(l,p,x,E={}){this._checkLoaded();const A=this.getLayer(l);A?U(A.getLayoutProperty(p),x)||(A.setLayoutProperty(p,x,E),this._updateLayer(A)):this.fire(new o.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,p){const x=this.getLayer(l);if(x)return x.getLayoutProperty(p);this.fire(new o.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,p,x,E={}){this._checkLoaded();const A=this.getLayer(l);A?U(A.getPaintProperty(p),x)||(A.setPaintProperty(p,x,E)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,p){return this.getLayer(l).getPaintProperty(p)}setFeatureState(l,p){this._checkLoaded();const x=l.source,E=l.sourceLayer,A=this.getSource(x);if(A===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const I=A.type;if(I==="geojson"&&E)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(I==="vector"&&!E)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const D=this._getSourceCaches(x);for(const B of D)B.setFeatureState(E,l.id,p)}removeFeatureState(l,p){this._checkLoaded();const x=l.source,E=this.getSource(x);if(E===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const A=E.type,I=A==="vector"?l.sourceLayer:void 0;if(A==="vector"&&!I)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(p&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const D=this._getSourceCaches(x);for(const B of D)B.removeFeatureState(I,l.id,p)}getFeatureState(l){this._checkLoaded();const p=l.source,x=l.sourceLayer,E=this.getSource(p);if(E!==void 0){if(E.type!=="vector"||x)return l.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(p)[0].getFeatureState(x,l.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const l={};for(const p in this._sourceCaches){const x=this._sourceCaches[p].getSource();l[x.id]||(l[x.id]=x.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0;const p=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&p&&p.getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",p.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const p=I=>this._layers[I].type==="fill-extrusion",x={},E=[];for(let I=this._order.length-1;I>=0;I--){const D=this._order[I];if(p(D)){x[D]=I;for(const B of l){const j=B[D];if(j)for(const $ of j)E.push($)}}}E.sort((I,D)=>D.intersectionZ-I.intersectionZ);const A=[];for(let I=this._order.length-1;I>=0;I--){const D=this._order[I];if(p(D))for(let B=E.length-1;B>=0;B--){const j=E[B].feature;if(x[j.layer.id]<I)break;A.push(j),E.pop()}else for(const B of l){const j=B[D];if(j)for(const $ of j)A.push($.feature)}}return A}queryRenderedFeatures(l,p,x){p&&p.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",p.filter,null,p);const E={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const B of p.layers){const j=this._layers[B];if(!j)return this.fire(new o.ErrorEvent(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];E[j.source]=!0}}const A=[];p.availableImages=this._availableImages;const I=p&&p.layers?p.layers.some(B=>{const j=this.getLayer(B);return j&&j.is3D()}):this.has3DLayers(),D=Xo.createFromScreenPoints(l,x);for(const B in this._sourceCaches){const j=this._sourceCaches[B].getSource().id;p.layers&&!E[j]||A.push(W(this._sourceCaches[B],this._layers,this._serializedLayers,D,p,x,I,!!this.map._showQueryGeometry))}return this.placement&&A.push(function(B,j,$,X,K,se,re){const ae={},Pe=se.queryRenderedSymbols(X),ie=[];for(const Ae of Object.keys(Pe).map(Number))ie.push(re[Ae]);ie.sort(he);for(const Ae of ie){const Se=Ae.featureIndex.lookupSymbolFeatures(Pe[Ae.bucketInstanceId],j,Ae.bucketIndex,Ae.sourceLayerIndex,K.filter,K.layers,K.availableImages,B);for(const be in Se){const we=ae[be]=ae[be]||[],Ie=Se[be];Ie.sort((Ke,st)=>{const It=Ae.featureSortOrder;if(It){const Et=It.indexOf(Ke.featureIndex);return It.indexOf(st.featureIndex)-Et}return st.featureIndex-Ke.featureIndex});for(const Ke of Ie)we.push(Ke)}}for(const Ae in ae)ae[Ae].forEach(Se=>{const be=Se.feature,we=$(B[Ae]).getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=we});return ae}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),D.screenGeometry,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(A)}querySourceFeatures(l,p){p&&p.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",p.filter,null,p);const x=this._getSourceCaches(l);let E=[];for(const A of x)E=E.concat(G(A,p));return E}addSourceType(l,p,x){return oi.getSourceType(l)?x(new Error(`A source type called "${l}" already exists.`)):(oi.setSourceType(l,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:p.workerSourceURL},x):x(null,null))}getLight(){return this.light.getLight()}setLight(l,p={}){this._checkLoaded();const x=this.light.getLight();let E=!1;for(const I in l)if(!U(l[I],x[I])){E=!0;break}if(!E)return;const A={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,p),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,p=1){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(p===1){if(typeof l.source=="object"){const x="terrain-dem-src";this.addSource(x,l.source),l=o.clone$1(l),l=o.extend(l,{source:x})}if(this._validate(o.validateStyle.terrain,"terrain",l))return}if(!this.terrain||this.terrain&&p!==this.terrain.drapeRenderMode)this._createTerrain(l,p);else{const x=this.terrain,E=x.get();for(const A in l)if(!U(l[A],E[A])){x.set(l),this.stylesheet.terrain=l;const I={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};x.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const p=this.fog=new Oe(l,this.map.transform);this.stylesheet.fog=l;const x={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};p.updateTransitions(x)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const p=this.fog,x=p.get();for(const E in l)if(!U(l[E],x[E])){p.set(l),this.stylesheet.fog=l;const A={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};p.updateTransitions(A);break}}else this._createFog(l);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const l=this._order.filter(x=>this.isLayerDraped(this._layers[x])),p=this._order.filter(x=>!this.isLayerDraped(this._layers[x]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...p)}_createTerrain(l,p){const x=this.terrain=new Bt(l,p);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const E={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};x.updateTransitions(E)}_force3DLayerUpdate(){for(const l in this._layers){const p=this._layers[l];p.type==="fill-extrusion"&&this._updateLayer(p)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const p=this._layers[l];p.type==="symbol"&&this._updateLayer(p)}}_validate(l,p,x,E,A={}){return(!A||A.validate!==!1)&&_a(this,l.call(o.validateStyle,o.extend({key:p,style:this.serialize(),value:x,styleSpec:o.spec},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){const p=this._getSourceCaches(l);for(const x of p)x.clearTiles()}_reloadSource(l){const p=this._getSourceCaches(l);for(const x of p)x.resume(),x.reload()}_updateSources(l){for(const p in this._sourceCaches)this._sourceCaches[p].update(l)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const p=this._sourceCaches[l];p.resume(),p.reload()}}_updatePlacement(l,p,x,E,A=!1){let I=!1,D=!1;const B={};for(const j of this._order){const $=this._layers[j];if($.type!=="symbol")continue;if(!B[$.source]){const K=this._getLayerSourceCache($);if(!K)continue;B[$.source]=K.getRenderableIds(!0).map(se=>K.getTileByID(se)).sort((se,re)=>re.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(re.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer($,B[$.source],l.center.lng,l.projection);I=I||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),A=A||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),l.zoom))&&(this.pauseablePlacement=new zn(l,this._order,A,p,x,E,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),D=!0),I&&this.pauseablePlacement.placement.setStale()),D||I)for(const j of this._order){const $=this._layers[j];$.type==="symbol"&&this.placement.updateLayerOpacities($,B[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,p,x){this.imageManager.getImages(p.icons,x),this._updateTilesForChangedImages();const E=A=>{A&&A.setDependencies(p.tileID.key,p.type,p.icons)};E(this._otherSourceCaches[p.source]),E(this._symbolSourceCaches[p.source])}getGlyphs(l,p,x){this.glyphManager.getGlyphs(p.stacks,x)}getResource(l,p,x){return o.makeRequest(p,x)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){const p=[];return this._otherSourceCaches[l]&&p.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&p.push(this._symbolSourceCaches[l]),p}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}oi.getSourceType=function(v){return Zo[v]},oi.setSourceType=function(v,l){Zo[v]=l},oi.registerForPluginStateChange=o.registerForPluginStateChange;var zl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,Jo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ss={},Ul={};Ss=An("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),Ul=An(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const Gn=An(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}
#ifdef PROJECTION_GLOBE_VIEW
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Sc=zl;var k3={background:An(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:An(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:An(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:An("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:An(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:An(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:An("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:An("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:An("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:An(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:An(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:An(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:An(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:An(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:An(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:An(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:An(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:An(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:An(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:An(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:An(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:An(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:An(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:An(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:An(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:An(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Jo),skyboxGradient:An(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Jo),skyboxCapture:An(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:An(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:An(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function An(v,l,p){const x=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,E=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,A=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),I=v.match(E),D=l.match(E),B=zl.match(E);let j=D?D.concat(I):I;p||(Ss.staticUniforms&&(j=Ss.staticUniforms.concat(j)),Ul.staticUniforms&&(j=Ul.staticUniforms.concat(j))),j&&(j=j.concat(B));const $={};return{fragmentSource:v=v.replace(x,(X,K,se,re,ae)=>($[ae]=!0,K==="define"?`
#ifndef HAS_UNIFORM_u_${ae}
varying ${se} ${re} ${ae};
#else
uniform ${se} ${re} u_${ae};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ae}
    ${se} ${re} ${ae} = u_${ae};
#endif
`)),vertexSource:l=l.replace(x,(X,K,se,re,ae)=>{const Pe=re==="float"?"vec2":"vec4",ie=ae.match(/color/)?"color":Pe;return $[ae]?K==="define"?`
#ifndef HAS_UNIFORM_u_${ae}
uniform lowp float u_${ae}_t;
attribute ${se} ${Pe} a_${ae};
varying ${se} ${re} ${ae};
#else
uniform ${se} ${re} u_${ae};
#endif
`:ie==="vec4"?`
#ifndef HAS_UNIFORM_u_${ae}
    ${ae} = a_${ae};
#else
    ${se} ${re} ${ae} = u_${ae};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ae}
    ${ae} = unpack_mix_${ie}(a_${ae}, u_${ae}_t);
#else
    ${se} ${re} ${ae} = u_${ae};
#endif
`:K==="define"?`
#ifndef HAS_UNIFORM_u_${ae}
uniform lowp float u_${ae}_t;
attribute ${se} ${Pe} a_${ae};
#else
uniform ${se} ${re} u_${ae};
#endif
`:ie==="vec4"?`
#ifndef HAS_UNIFORM_u_${ae}
    ${se} ${re} ${ae} = a_${ae};
#else
    ${se} ${re} ${ae} = u_${ae};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ae}
    ${se} ${re} ${ae} = unpack_mix_${ie}(a_${ae}, u_${ae}_t);
#else
    ${se} ${re} ${ae} = u_${ae};
#endif
`}),staticAttributes:A,staticUniforms:j}}class Ki{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,p,x,E,A,I,D,B){this.context=l;let j=this.boundPaintVertexBuffers.length!==E.length;for(let $=0;!j&&$<E.length;$++)this.boundPaintVertexBuffers[$]!==E[$]&&(j=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===p&&this.boundLayoutVertexBuffer===x&&!j&&this.boundIndexBuffer===A&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===D&&this.boundDynamicVertexBuffer2===B?(l.bindVertexArrayOES.set(this.vao),D&&D.bind(),A&&A.dynamicDraw&&A.bind(),B&&B.bind()):this.freshBind(p,x,E,A,I,D,B)}freshBind(l,p,x,E,A,I,D){let B;const j=l.numAttributes,$=this.context,X=$.gl;if($.extVertexArrayObject)this.vao&&this.destroy(),this.vao=$.extVertexArrayObject.createVertexArrayOES(),$.bindVertexArrayOES.set(this.vao),B=0,this.boundProgram=l,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=E,this.boundVertexOffset=A,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=D;else{B=$.currentNumAttributes||0;for(let K=j;K<B;K++)X.disableVertexAttribArray(K)}p.enableAttributes(X,l);for(const K of x)K.enableAttributes(X,l);I&&I.enableAttributes(X,l),D&&D.enableAttributes(X,l),p.bind(),p.setVertexAttribPointers(X,l,A);for(const K of x)K.bind(),K.setVertexAttribPointers(X,l,A);I&&(I.bind(),I.setVertexAttribPointers(X,l,A)),E&&E.bind(),D&&(D.bind(),D.setVertexAttribPointers(X,l,A)),$.currentNumAttributes=j}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function H0(v,l){const p=Math.pow(2,l.canonical.z),x=l.canonical.y;return[new o.MercatorCoordinate(0,x/p).toLngLat().lat,new o.MercatorCoordinate(0,(x+1)/p).toLngLat().lat]}function Ac(v,l,p,x,E,A,I){const D=v.context,B=D.gl,j=p.fbo;if(!j)return;v.prepareDrawTile(l);const $=v.useProgram("hillshade");D.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,j.colorAttachment.get());const X=((ae,Pe,ie,Ae)=>{const Se=ie.paint.get("hillshade-shadow-color"),be=ie.paint.get("hillshade-highlight-color"),we=ie.paint.get("hillshade-accent-color");let Ie=ie.paint.get("hillshade-illumination-direction")*(Math.PI/180);ie.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ie-=ae.transform.angle);const Ke=!ae.options.moving;return{u_matrix:Ae||ae.transform.calculateProjMatrix(Pe.tileID.toUnwrapped(),Ke),u_image:0,u_latrange:H0(0,Pe.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),Ie],u_shadow:Se,u_highlight:be,u_accent:we}})(v,p,x,v.terrain?l.projMatrix:null);v.prepareDrawProgram(D,$,l.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:se,tileBoundsSegments:re}=v.getTileBoundsBuffers(p);$.draw(D,B.TRIANGLES,E,A,I,o.CullFaceMode.disabled,X,x.id,K,se,re)}function Br(v,l,p){if(!l.needsDEMTextureUpload)return;const x=v.context,E=x.gl;x.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||v.getTileTexture(p.stride);const A=p.getPixels();l.demTexture?l.demTexture.update(A,{premultiply:!1}):l.demTexture=new o.Texture(x,A,E.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function Ga(v,l,p,x,E,A){const I=v.context,D=I.gl;if(!l.dem)return;const B=l.dem;if(I.activeTexture.set(D.TEXTURE1),Br(v,l,B),!l.demTexture)return;l.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);const j=B.dim;I.activeTexture.set(D.TEXTURE0);let $=l.fbo;if(!$){const re=new o.Texture(I,{width:j,height:j,data:null},D.RGBA);re.bind(D.LINEAR,D.CLAMP_TO_EDGE),$=l.fbo=I.createFramebuffer(j,j,!0),$.colorAttachment.set(re.texture)}I.bindFramebuffer.set($.framebuffer),I.viewport.set([0,0,j,j]);const{tileBoundsBuffer:X,tileBoundsIndexBuffer:K,tileBoundsSegments:se}=v.getMercatorTileBoundsBuffers();v.useProgram("hillshadePrepare").draw(I,D.TRIANGLES,x,E,A,o.CullFaceMode.disabled,((re,ae)=>{const Pe=ae.stride,ie=o.create();return o.ortho(ie,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(ie,ie,[0,-o.EXTENT,0]),{u_matrix:ie,u_image:1,u_dimension:[Pe,Pe],u_zoom:re.overscaledZ,u_unpack:ae.unpackVector}})(l.tileID,B),p.id,X,K,se),l.needsHillshadePrepare=!1}const Ji=(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_image0:new o.Uniform1i(v,l.u_image0),u_skirt_height:new o.Uniform1f(v,l.u_skirt_height)}),ei=(v,l)=>({u_matrix:v,u_image0:0,u_skirt_height:l}),Ya=(v,l,p,x,E)=>({u_proj_matrix:Float32Array.from(v),u_globe_matrix:l,u_merc_matrix:p,u_zoom_transition:x,u_merc_center:E,u_image0:0});function As(v,l){return v!=null&&l!=null&&!(!v.hasData()||!l.hasData())&&v.demTexture!=null&&l.demTexture!=null&&v.tileID.key!==l.tileID.key}const Cs=new class{constructor(){this.operations={}}newMorphing(v,l,p,x,E){if(v in this.operations){const A=this.operations[v];A.to.tileID.key!==p.tileID.key&&(A.queued=p)}else this.operations[v]={startTime:x,phase:0,duration:E,from:l,to:p,queued:null}}getMorphValuesForProxy(v){if(!(v in this.operations))return null;const l=this.operations[v];return{from:l.from,to:l.to,phase:l.phase}}update(v){for(const l in this.operations){const p=this.operations[l];for(p.phase=(v-p.startTime)/p.duration;p.phase>=1||!this._validOp(p);)if(!this._nextOp(p,v)){delete this.operations[l];break}}}_nextOp(v,l){return!!v.queued&&(v.from=v.to,v.to=v.queued,v.queued=null,v.phase=0,v.startTime=l,!0)}_validOp(v){return v.from.hasData()&&v.to.hasData()}},Ao={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function X0(v,l){const p=1<<v.z;return!l&&(v.x===0||v.x===p-1)||v.y===0||v.y===p-1}const Wr=v=>({u_matrix:v});function Ka(v,l,p,x,E){if(E>0){const A=o.exported.now(),I=(A-v.timeAdded)/E,D=l?(A-l.timeAdded)/E:-1,B=p.getSource(),j=x.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),$=!l||Math.abs(l.tileID.overscaledZ-j)>Math.abs(v.tileID.overscaledZ-j),X=$&&v.refreshedUponExpiration?1:o.clamp($?I:1-D,0,1);return v.refreshedUponExpiration&&I>=1&&(v.refreshedUponExpiration=!1),l?{opacity:1,mix:1-X}:{opacity:X,mix:0}}return{opacity:1,mix:0}}class Cc extends o.SourceCache{constructor(l){const p={type:"raster-dem",maxzoom:l.transform.maxZoom},x=new ce(Le(),null),E=Ri("mock-dem",p,x,l.style);super("mock-dem",E,!1),E.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,p){l.state="loaded",p(null)}}class Si extends o.SourceCache{constructor(l){const p=Ri("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new ce(Le(),null),l.style);super("proxy",p,!1),p.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,p,x){if(l.freezeTileCoverage)return;this.transform=l;const E=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((A,I)=>{if(A[I.key]="",!this._tiles[I.key]){const D=new o.Tile(I,this._source.tileSize*I.overscaleFactor(),l.tileZoom);D.state="loaded",this._tiles[I.key]=D}return A},{});for(const A in this._tiles)A in E||(this.freeFBO(A),this._tiles[A].unloadVectorData(),delete this._tiles[A])}freeFBO(l){const p=this.proxyCachedFBO[l];if(p!==void 0){const x=Object.values(p);this.renderCachePool.push(...x),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class C1 extends o.OverscaledTileID{constructor(l,p,x){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=p,this.projMatrix=x}}class Co extends o.Elevation{constructor(l,p){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[x,E,A]=function(B){const j=new o.StructArrayLayout4i8,$=new o.StructArrayLayout3ui6,X=131;j.reserve(17161),$.reserve(33800);const K=o.EXTENT/128,se=o.EXTENT+K/2,re=se+K;for(let Pe=-K;Pe<re;Pe+=K)for(let ie=-K;ie<re;ie+=K){const Ae=ie<0||ie>se||Pe<0||Pe>se?24575:0,Se=o.clamp(Math.round(ie),0,o.EXTENT),be=o.clamp(Math.round(Pe),0,o.EXTENT);j.emplaceBack(Se+Ae,be,Se,be)}const ae=(Pe,ie)=>{const Ae=ie*X+Pe;$.emplaceBack(Ae+1,Ae,Ae+X),$.emplaceBack(Ae+X,Ae+X+1,Ae+1)};for(let Pe=1;Pe<129;Pe++)for(let ie=1;ie<129;ie++)ae(ie,Pe);return[0,129].forEach(Pe=>{for(let ie=0;ie<130;ie++)ae(ie,Pe),ae(Pe,ie)}),[j,$,32768]}(),I=l.context;this.gridBuffer=I.createVertexBuffer(x,o.boundsAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(E),this.gridSegments=o.SegmentVector.simpleSegment(0,0,x.length,E.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,x.length,A),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Si(p.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);const D=I.gl;this._overlapStencilMode=new o.StencilMode({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=p,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Cc(p.map)}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency()}update(l,p,x){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;const E=l.terrain.properties;this.sourceCache=l.terrain.drapeRenderMode===0?this._mockSourceCache:l._getSourceCache(E.get("source")),this._exaggeration=E.get("exaggeration");const A=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(p,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,A(),this._initializing=!0),A(),p.updateElevation(!x),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(p),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||l.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const p=this.proxySourceCache,x=this.painter.transform;this._initializing&&(this._initializing=x._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(x.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const E=this.proxyCoords=p.getIds().map(B=>{const j=p.getTileByID(B).tileID;return j.projMatrix=x.calculateProjMatrix(j.toUnwrapped()),j});(function(B,j){const $=j.transform.pointCoordinate(j.transform.getCameraPoint()),X=new o.pointGeometry($.x,$.y);B.sort((K,se)=>{if(se.overscaledZ-K.overscaledZ)return se.overscaledZ-K.overscaledZ;const re=new o.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ae=new o.pointGeometry(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),Pe=X.mult(1<<K.canonical.z);return Pe.x-=.5,Pe.y-=.5,Pe.distSqr(re)-Pe.distSqr(ae)})})(E,this.painter),this._previousZoom=x.zoom;const A=this.proxyToSource||{};this.proxyToSource={},E.forEach(B=>{this.proxyToSource[B.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const B in I){const j=I[B];if(!j.used||(j!==this.sourceCache&&this.resetTileLookupCache(j.id),this._setupProxiedCoordsForOrtho(j,l[B],A),j.usedForTerrain))continue;const $=l[B];j.getSource().reparseOverscaled&&this._assignTerrainTiles($)}this.proxiedCoords[p.id]=E.map(B=>new C1(B,B.key,this.orthoMatrix)),this._assignTerrainTiles(E),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(A),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const D={};this._visibleDemTiles=[];for(const B of this.proxyCoords){const j=this.terrainTileForTile[B.key];if(!j)continue;const $=j.tileID.key;$ in D||(this._visibleDemTiles.push(j),D[$]=$)}}_assignTerrainTiles(l){this._initializing||l.forEach(p=>{if(this.terrainTileForTile[p.key])return;const x=this._findTileCoveringTileID(p,this.sourceCache);x&&(this.terrainTileForTile[p.key]=x)})}_prepareDEMTextures(){const l=this.painter.context,p=l.gl;for(const x in this.terrainTileForTile){const E=this.terrainTileForTile[x],A=E.dem;!A||E.demTexture&&!E.needsDEMTextureUpload||(l.activeTexture.set(p.TEXTURE1),Br(this.painter,E,A))}}_prepareDemTileUniforms(l,p,x,E){if(!p||p.demTexture==null)return!1;const A=l.tileID.canonical,I=Math.pow(2,p.tileID.canonical.z-A.z),D=E||"";return x[`u_dem_tl${D}`]=[A.x*I%1,A.y*I%1],x[`u_dem_scale${D}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,p=l.gl;if(!this._emptyDepthBufferTexture){const x={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new o.Texture(l,x,p.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const p=this._visibleDemTiles.reduce((x,E)=>{if(!E.dem)return x;const A=E.dem.tree.minimums[0];return A>0&&l++,x+A},0);return l?p/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,p=l.gl;l.activeTexture.set(p.TEXTURE2);const x=this._getLoadedAreaMinimum(),E={width:1,height:1,data:new Uint8Array(o.DEMData.pack(x,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let A=this._emptyDEMTexture;return A?A.update(E,{premultiply:!1}):A=this._emptyDEMTexture=new o.Texture(l,E,p.RGBA,{premultiply:!1}),A}setupElevationDraw(l,p,x){const E=this.painter.context,A=E.gl,I=(D=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(D),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var D;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();const B=this.painter.transform,j=B.projection.createTileTransform(B,B.worldSize),$=l.tileID.canonical;I.u_tile_tl_up=j.upVector($,0,0),I.u_tile_tr_up=j.upVector($,o.EXTENT,0),I.u_tile_br_up=j.upVector($,o.EXTENT,o.EXTENT),I.u_tile_bl_up=j.upVector($,0,o.EXTENT),I.u_tile_up_scale=j.upVectorScale($);let X=null,K=null,se=1;if(x&&x.morphing&&this._useVertexMorphing){const re=x.morphing.srcDemTile,ae=x.morphing.dstDemTile;se=x.morphing.phase,re&&ae&&(this._prepareDemTileUniforms(l,re,I,"_prev")&&(K=re),this._prepareDemTileUniforms(l,ae,I)&&(X=ae))}if(K&&X?(E.activeTexture.set(A.TEXTURE2),X.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE,A.NEAREST),E.activeTexture.set(A.TEXTURE4),K.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE,A.NEAREST),I.u_dem_lerp=se):(X=this.terrainTileForTile[l.tileID.key],E.activeTexture.set(A.TEXTURE2),(this._prepareDemTileUniforms(l,X,I)?X.demTexture:this.emptyDEMTexture).bind(A.NEAREST,A.CLAMP_TO_EDGE)),E.activeTexture.set(A.TEXTURE3),x&&x.useDepthForOcclusion?(this._depthTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE),I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),x&&x.useMeterToDem&&X){const re=(1<<X.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=re}x&&x.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=x.labelPlaneMatrixInv),p.setTerrainUniformValues(E,I)}renderToBackBuffer(l){const p=this.painter,x=this.painter.context;l.length!==0&&(x.bindFramebuffer.set(null),x.viewport.set([0,0,p.width,p.height]),this.renderingToTexture=!1,function(E,A,I,D,B){if(E.transform.projection.name==="globe")(function(j,$,X,K,se){const re=j.context,ae=re.gl;let Pe,ie;const Ae=j.options.showTerrainWireframe?2:0,Se=(bt,ut)=>{if(ie===bt)return;const it=[];ut&&it.push(Ao[Ae]),it.push(Ao[bt]),it.push("PROJECTION_GLOBE_VIEW"),Pe=j.useProgram("globeRaster",null,it),ie=bt},be=j.colorModeForRenderPass(),we=new o.DepthMode(ae.LEQUAL,o.DepthMode.ReadWrite,j.depthRangeFor3D);Cs.update(se);const Ie=j.transform,Ke=o.calculateGlobeMatrix(Ie,Ie.worldSize),st=o.calculateGlobeMercatorMatrix(Ie),It=[o.mercatorXfromLng(Ie.center.lng),o.mercatorYfromLat(Ie.center.lat)],Et=j.globeSharedBuffers;(Ae?[!1,!0]:[!1]).forEach(bt=>{ie=-1;const ut=bt?ae.LINES:ae.TRIANGLES;for(const it of K){const vt=X.getTile(it),dt=Math.pow(2,it.canonical.z),[nn,hn]=o.globeBuffersForTileMesh(j,vt,it,dt),In=o.StencilMode.disabled,Rt=$.prevTerrainTileForTile[it.key],sn=$.terrainTileForTile[it.key];As(Rt,sn)&&Cs.newMorphing(it.key,Rt,sn,se,250),re.activeTexture.set(ae.TEXTURE0),vt.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const _n=Cs.getMorphValuesForProxy(it.key),Jn=_n?1:0,hr={};_n&&o.extend$1(hr,{morphing:{srcDemTile:_n.from,dstDemTile:_n.to,phase:o.easeCubicInOut(_n.phase)}});const mn=o.globeMatrixForTile(it.canonical,Ke),Nn=Ya(Ie.projMatrix,mn,st,o.globeToMercatorTransition(Ie.zoom),It);if(Se(Jn,bt),$.setupElevationDraw(vt,Pe,hr),j.prepareDrawProgram(re,Pe,it.toUnwrapped()),Et){const[fr,_r]=bt?Et.getWirefameBuffer(j.context):[Et.gridIndexBuffer,Et.gridSegments];Pe.draw(re,ut,we,In,be,o.CullFaceMode.backCCW,Nn,"globe_raster",nn,fr,_r)}if(!bt){const fr=[it.canonical.y===0?o.globePoleMatrixForTile(it.canonical,!1,Ie):null,it.canonical.y===dt-1?o.globePoleMatrixForTile(it.canonical,!0,Ie):null];for(const _r of fr){if(!_r)continue;const _i=Ya(Ie.projMatrix,_r,_r,0,It);Et&&Pe.draw(re,ut,we,In,be,o.CullFaceMode.disabled,_i,"globe_pole_raster",hn,Et.poleIndexBuffer,Et.poleSegments)}}}})})(E,A,I,D,B);else{const j=E.context,$=j.gl;let X,K;const se=E.options.showTerrainWireframe?2:0,re=(Se,be)=>{if(K===Se)return;const we=[Ao[Se]];be&&we.push(Ao[se]),X=E.useProgram("terrainRaster",null,we),K=Se},ae=E.colorModeForRenderPass(),Pe=new o.DepthMode($.LEQUAL,o.DepthMode.ReadWrite,E.depthRangeFor3D);Cs.update(B);const ie=E.transform,Ae=6*Math.pow(1.5,22-ie.zoom)*A.exaggeration();(se?[!1,!0]:[!1]).forEach(Se=>{K=-1;const be=Se?$.LINES:$.TRIANGLES,[we,Ie]=Se?A.getWirefameBuffer():[A.gridIndexBuffer,A.gridSegments];for(const Ke of D){const st=I.getTile(Ke),It=o.StencilMode.disabled,Et=A.prevTerrainTileForTile[Ke.key],bt=A.terrainTileForTile[Ke.key];As(Et,bt)&&Cs.newMorphing(Ke.key,Et,bt,B,250),j.activeTexture.set($.TEXTURE0),st.texture.bind($.LINEAR,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);const ut=Cs.getMorphValuesForProxy(Ke.key),it=ut?1:0;let vt;ut&&(vt={morphing:{srcDemTile:ut.from,dstDemTile:ut.to,phase:o.easeCubicInOut(ut.phase)}});const dt=ei(Ke.projMatrix,X0(Ke.canonical,ie.renderWorldCopies)?Ae/10:Ae);re(it,Se),A.setupElevationDraw(st,X,vt),E.prepareDrawProgram(j,X,Ke.toUnwrapped()),X.draw(j,be,Pe,It,ae,o.CullFaceMode.backCCW,dt,"terrain_raster",A.gridBuffer,we,Ie)}})}}(p,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const p=this.painter,x=this.painter.context,E=this.proxySourceCache,A=this.proxiedCoords[E.id],I=this._drapedRenderBatches.shift(),D=[],B=p.style.order;let j=0;for(const $ of A){const X=E.getTileByID($.proxyTileKey),K=E.proxyCachedFBO[$.key]?E.proxyCachedFBO[$.key][l]:void 0,se=K!==void 0?E.renderCache[K]:this.pool[j++],re=K!==void 0;if(X.texture=se.tex,re&&!se.dirty){D.push(X.tileID);continue}let ae;x.bindFramebuffer.set(se.fb.framebuffer),this.renderedToTile=!1,se.dirty&&(x.clear({color:o.Color.transparent,stencil:0}),se.dirty=!1);for(let Pe=I.start;Pe<=I.end;++Pe){const ie=p.style._layers[B[Pe]];if(ie.isHidden(p.transform.zoom))continue;const Ae=p.style._getLayerSourceCache(ie),Se=Ae?this.proxyToSource[$.key][Ae.id]:[$];if(!Se)continue;const be=Se;x.viewport.set([0,0,se.fb.width,se.fb.height]),ae!==(Ae?Ae.id:null)&&(this._setupStencil(se,Se,ie,Ae),ae=Ae?Ae.id:null),p.renderLayer(p,Ae,ie,be)}this.renderedToTile?(se.dirty=!0,D.push(X.tileID)):re||--j,j===5&&(j=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,x.bindFramebuffer.set(null),x.viewport.set([0,0,p.width,p.height]),I.end+1}postRender(){}renderCacheEfficiency(l){const p=l.order.length;if(p===0)return{efficiency:100};let x,E=0,A=0,I=!1;for(let D=0;D<p;++D){const B=l._layers[l.order[D]];this._style.isLayerDraped(B)?(I&&++E,++A):I||(I=!0,x=B.id)}return A===0?{efficiency:100}:{efficiency:100*(1-E/A),firstUndrapedLayer:x}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(p=>p.dem).forEach(p=>{l=Math.min(l,p.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,p,x){if(!this._visibleDemTiles)return null;const E=this._visibleDemTiles.filter(A=>A.dem).map(A=>{const I=A.tileID,D=Math.pow(2,I.overscaledZ),{x:B,y:j}=I.canonical,$=B/D,X=(B+1)/D,K=j/D,se=(j+1)/D;return{minx:$,miny:K,maxx:X,maxy:se,t:A.dem.tree.raycastRoot($,K,X,se,l,p,x),tile:A}});E.sort((A,I)=>(A.t!==null?A.t:Number.MAX_VALUE)-(I.t!==null?I.t:Number.MAX_VALUE));for(const A of E){if(A.t==null)return null;const I=A.tile.dem.tree.raycast(A.minx,A.miny,A.maxx,A.maxy,l,p,x);if(I!=null)return I}return null}_createFBO(){const l=this.painter.context,p=l.gl,x=this.drapeBufferSize;l.activeTexture.set(p.TEXTURE0);const E=new o.Texture(l,{width:x[0],height:x[1],data:null},p.RGBA);E.bind(p.LINEAR,p.CLAMP_TO_EDGE);const A=l.createFramebuffer(x[0],x[1],!1);return A.colorAttachment.set(E.texture),A.depthAttachment=new Eo(l,A.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,x[0],x[1]),this._stencilRef=0,A.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):A.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&p.texParameterf(p.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:A,tex:E,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const p=this._style._layers[l],x=p.isHidden(this.painter.transform.zoom),E=p.getCrossfadeParameters(),A=!!E&&E.t!==1,I=p.hasTransition();return p.type!=="custom"&&!x&&(A||I)})}_clearRasterFadeFromRenderCache(){let l=!1;for(const p in this._style._sourceCaches)if(this._style._sourceCaches[p]._source instanceof bs){l=!0;break}if(l)for(let p=0;p<this._style.order.length;++p){const x=this._style._layers[this._style.order[p]],E=x.isHidden(this.painter.transform.zoom),A=this._style._getLayerSourceCache(x);if(x.type!=="raster"||E||!A)continue;const I=x.paint.get("raster-fade-duration");for(const D of this.proxyCoords){const B=this.proxyToSource[D.key][A.id];if(B)for(const j of B){const $=Ka(A.getTile(j),A.findLoadedParent(j,0),A,this.painter.transform,I);($.opacity!==1||$.mix!==0)&&this._clearRenderCacheForTile(A.id,j)}}}}_setupDrapedRenderBatches(){const l=this._style.order,p=l.length;if(p===0)return;const x=[];let E,A=0,I=this._style._layers[l[A]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++A<p;)I=this._style._layers[l[A]];for(;A<p;++A){const D=this._style._layers[l[A]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?E===void 0&&(E=A):E!==void 0&&(x.push({start:E,end:A-1}),E=void 0))}E!==void 0&&x.push({start:E,end:A-1}),this._drapedRenderBatches=x}_setupRenderCache(l){const p=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,p.renderCache.length>p.renderCachePool.length){const I=Object.values(p.proxyCachedFBO);p.proxyCachedFBO={};for(let D=0;D<I.length;++D){const B=Object.values(I[D]);p.renderCachePool.push(...B)}}return}this._clearRasterFadeFromRenderCache();const x=this.proxyCoords,E=this._tilesDirty;for(let I=x.length-1;I>=0;I--){const D=x[I];if(p.getTileByID(D.key),p.proxyCachedFBO[D.key]!==void 0){const B=l[D.key],j=this.proxyToSource[D.key];let $=0;for(const X in j){const K=j[X],se=B[X];if(!se||se.length!==K.length||K.some((re,ae)=>re!==se[ae]||E[X]&&E[X].hasOwnProperty(re.key))){$=-1;break}++$}for(const X in p.proxyCachedFBO[D.key])p.renderCache[p.proxyCachedFBO[D.key][X]].dirty=$<0||$!==Object.values(B).length}}const A=[...this._drapedRenderBatches];A.sort((I,D)=>D.end-D.start-(I.end-I.start));for(const I of A)for(const D of x){if(p.proxyCachedFBO[D.key])continue;let B=p.renderCachePool.pop();B===void 0&&p.renderCache.length<50&&(B=p.renderCache.length,p.renderCache.push(this._createFBO())),B!==void 0&&(p.proxyCachedFBO[D.key]={},p.proxyCachedFBO[D.key][I.start]=B,p.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(l,p,x,E){if(!E||!this._sourceTilesOverlap[E.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const A=this.painter.context,I=A.gl;if(p.length<=1)return void(this._overlapStencilType=!1);let D;if(x.isTileClipped())D=p.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(p[0].overscaledZ>p[p.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(A.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,x.isTileClipped()&&this._renderTileClippingMasks(p,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(l,p){const x=this.painter,E=this.painter.context,A=E.gl;x._tileClippingMaskIDs={},E.setColorMode(o.ColorMode.disabled),E.setDepthMode(o.DepthMode.disabled);const I=x.useProgram("clippingMask");for(const D of l){const B=x._tileClippingMaskIDs[D.key]=--p;I.draw(E,A.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:A.ALWAYS,mask:0},B,255,A.KEEP,A.KEEP,A.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Wr(D.projMatrix),"$clipping",x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}}pointCoordinate(l){const p=this.painter.transform;if(l.x<0||l.x>p.width||l.y<0||l.y>p.height)return null;const x=[l.x,l.y,1,1];o.transformMat4$1(x,x,p.pixelMatrixInverse),o.scale$1(x,x,1/x[3]),x[0]/=p.worldSize,x[1]/=p.worldSize;const E=p._camera.position,A=o.mercatorZfromAltitude(1,p.center.lat),I=[E[0],E[1],E[2]/A,0],D=o.subtract([],x.slice(0,3),I);o.normalize(D,D);const B=this.raycast(I,D,this._exaggeration);return B!==null&&B?(o.scaleAndAdd(I,I,D,B),I[3]=I[2],I[2]*=A,I):null}drawDepth(){const l=this.painter,p=l.context,x=this.proxySourceCache,E=Math.ceil(l.width),A=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===E&&this._depthFBO.height===A||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const I=p.gl,D=p.createFramebuffer(E,A,!0);p.activeTexture.set(I.TEXTURE0);const B=new o.Texture(p,{width:E,height:A,data:null},I.RGBA);B.bind(I.NEAREST,I.CLAMP_TO_EDGE),D.colorAttachment.set(B.texture);const j=p.createRenderbuffer(p.gl.DEPTH_COMPONENT16,E,A);D.depthAttachment.set(j),this._depthFBO=D,this._depthTexture=B}p.bindFramebuffer.set(this._depthFBO.framebuffer),p.viewport.set([0,0,E,A]),function(I,D,B,j){if(I.transform.projection.name==="globe")return;const $=I.context,X=$.gl;$.clear({depth:1});const K=I.useProgram("terrainDepth"),se=new o.DepthMode(X.LESS,o.DepthMode.ReadWrite,I.depthRangeFor3D);for(const re of j){const ae=B.getTile(re),Pe=ei(re.projMatrix,0);D.setupElevationDraw(ae,K),K.draw($,X.TRIANGLES,se,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,Pe,"terrain_depth",D.gridBuffer,D.gridIndexBuffer,D.gridNoSkirtSegments)}}(l,this,x,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,p,x){if(l.getSource()instanceof ii)return this._setupProxiedCoordsForImageSource(l,p,x);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const E=this.proxiedCoords[l.id]=[],A=this.proxyCoords;for(let D=0;D<A.length;D++){const B=A[D],j=this._findTileCoveringTileID(B,l);if(j){const $=this._createProxiedId(B,j,x[B.key]&&x[B.key][l.id]);E.push($),this.proxyToSource[B.key][l.id]=[$]}}let I=!1;for(let D=0;D<p.length;D++){const B=l.getTile(p[D]);if(!B||!B.hasData())continue;const j=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==B.tileID.canonical.z){const $=this.proxyToSource[j.tileID.key][l.id],X=this._createProxiedId(j.tileID,B,x[j.tileID.key]&&x[j.tileID.key][l.id]);$?$.splice($.length-1,0,X):this.proxyToSource[j.tileID.key][l.id]=[X],E.push(X),I=!0}}this._sourceTilesOverlap[l.id]=I}_setupProxiedCoordsForImageSource(l,p,x){if(!l.getSource().loaded())return;const E=this.proxiedCoords[l.id]=[],A=this.proxyCoords,I=l.getSource(),D=new o.pointGeometry(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),B=I.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce(($,X)=>($.min.x=Math.min($.min.x,X.x-D.x),$.min.y=Math.min($.min.y,X.y-D.y),$.max.x=Math.max($.max.x,X.x-D.x),$.max.y=Math.max($.max.y,X.y-D.y),$),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=($,X)=>{const K=$.wrap+$.canonical.x/(1<<$.canonical.z),se=$.canonical.y/(1<<$.canonical.z),re=o.EXTENT/(1<<$.canonical.z),ae=X.wrap+X.canonical.x/(1<<X.canonical.z),Pe=X.canonical.y/(1<<X.canonical.z);return K+re<ae+B.min.x||K>ae+B.max.x||se+re<Pe+B.min.y||se>Pe+B.max.y};for(let $=0;$<A.length;$++){const X=A[$];for(let K=0;K<p.length;K++){const se=l.getTile(p[K]);if(!se||!se.hasData()||j(X,se.tileID))continue;const re=this._createProxiedId(X,se,x[X.key]&&x[X.key][l.id]),ae=this.proxyToSource[X.key][l.id];ae?ae.push(re):this.proxyToSource[X.key][l.id]=[re],E.push(re)}}}_createProxiedId(l,p,x){let E=this.orthoMatrix;if(x){const A=x.find(I=>I.key===p.tileID.key);if(A)return A}if(p.tileID.key!==l.key){const A=l.canonical.z-p.tileID.canonical.z;let I,D,B;E=o.create();const j=p.tileID.wrap-l.wrap<<l.overscaledZ;A>0?(I=o.EXTENT>>A,D=I*((p.tileID.canonical.x<<A)-l.canonical.x+j),B=I*((p.tileID.canonical.y<<A)-l.canonical.y)):(I=o.EXTENT<<-A,D=o.EXTENT*(p.tileID.canonical.x-(l.canonical.x+j<<-A)),B=o.EXTENT*(p.tileID.canonical.y-(l.canonical.y<<-A))),o.ortho(E,0,I,0,I,0,1),o.translate(E,E,[D,B,0])}return new C1(p.tileID,l.key,E)}_findTileCoveringTileID(l,p){let x=p.getTile(l);if(x&&x.hasData())return x;const E=this._findCoveringTileCache[p.id],A=E[l.key];if(x=A?p.getTileByID(A):null,x&&x.hasData()||A===null)return x;let I=x?x.tileID:l,D=I.overscaledZ;const B=p.getSource().minzoom,j=[];if(!A){const X=p.getSource().maxzoom;if(l.canonical.z>=X){const K=l.canonical.z-X;p.getSource().reparseOverscaled?(D=Math.max(l.canonical.z+2,p.transform.tileZoom),I=new o.OverscaledTileID(D,l.wrap,X,l.canonical.x>>K,l.canonical.y>>K)):K!==0&&(D=X,I=new o.OverscaledTileID(D,l.wrap,X,l.canonical.x>>K,l.canonical.y>>K))}I.key!==l.key&&(j.push(I.key),x=p.getTile(I))}const $=X=>{j.forEach(K=>{E[K]=X}),j.length=0};for(D-=1;D>=B&&(!x||!x.hasData());D--){x&&$(x.tileID.key);const X=I.calculateScaledKey(D);if(x=p.getTileByID(X),x&&x.hasData())break;const K=E[X];if(K===null)break;K===void 0?j.push(X):x=p.getTileByID(K)}return $(x?x.tileID.key:null),x&&x.hasData()?x:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(l){this.renderedToTile=!0}_clearRenderCacheForTile(l,p){let x=this._tilesDirty[l];x||(x=this._tilesDirty[l]={}),x[p.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const l=function(p){let x,E,A;const I=new o.StructArrayLayout2ui4,D=131;for(E=1;E<129;E++){for(x=1;x<129;x++)A=E*D+x,I.emplaceBack(A,A+1),I.emplaceBack(A,A+D),I.emplaceBack(A+1,A+D),E===128&&I.emplaceBack(A+D,A+D+1);I.emplaceBack(A+1,A+1+D)}return I}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Vl(v){const l=[];for(let p=0;p<v.length;p++){if(v[p]===null)continue;const x=v[p].split(" ");l.push(x.pop())}return l}class Qo{static cacheKey(l,p,x){let E=`${l}${x?x.cacheKey:""}`;for(const A of p)E+=`/${A}`;return E}constructor(l,p,x,E,A,I){const D=l.gl;this.program=D.createProgram();const B=Vl(x.staticAttributes),j=E?E.getBinderAttributes():[],$=B.concat(j),X=x.staticUniforms?Vl(x.staticUniforms):[],K=E?E.getBinderUniforms():[],se=X.concat(K),re=[];for(const we of se)re.indexOf(we)<0&&re.push(we);let ae=E?E.defines():[];ae=ae.concat(I.map(we=>`#define ${we}`));const Pe=ae.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Sc,Gn.fragmentSource,Ul.fragmentSource,x.fragmentSource).join(`
`),ie=ae.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Sc,Gn.vertexSource,Ul.vertexSource,Ss.vertexSource,x.vertexSource).join(`
`),Ae=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(Ae,Pe),D.compileShader(Ae),D.attachShader(this.program,Ae);const Se=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(Se,ie),D.compileShader(Se),D.attachShader(this.program,Se),this.attributes={};const be={};this.numAttributes=$.length;for(let we=0;we<this.numAttributes;we++)$[we]&&(D.bindAttribLocation(this.program,we,$[we]),this.attributes[$[we]]=we);D.linkProgram(this.program),D.deleteShader(Se),D.deleteShader(Ae);for(let we=0;we<re.length;we++){const Ie=re[we];if(Ie&&!be[Ie]){const Ke=D.getUniformLocation(this.program,Ie);Ke&&(be[Ie]=Ke)}}this.fixedUniforms=A(l,be),this.binderUniforms=E?E.getUniforms(l,be):[],I.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((we,Ie)=>({u_dem:new o.Uniform1i(we,Ie.u_dem),u_dem_prev:new o.Uniform1i(we,Ie.u_dem_prev),u_dem_unpack:new o.Uniform4f(we,Ie.u_dem_unpack),u_dem_tl:new o.Uniform2f(we,Ie.u_dem_tl),u_dem_scale:new o.Uniform1f(we,Ie.u_dem_scale),u_dem_tl_prev:new o.Uniform2f(we,Ie.u_dem_tl_prev),u_dem_scale_prev:new o.Uniform1f(we,Ie.u_dem_scale_prev),u_dem_size:new o.Uniform1f(we,Ie.u_dem_size),u_dem_lerp:new o.Uniform1f(we,Ie.u_dem_lerp),u_exaggeration:new o.Uniform1f(we,Ie.u_exaggeration),u_depth:new o.Uniform1i(we,Ie.u_depth),u_depth_size_inv:new o.Uniform2f(we,Ie.u_depth_size_inv),u_meter_to_dem:new o.Uniform1f(we,Ie.u_meter_to_dem),u_label_plane_matrix_inv:new o.UniformMatrix4f(we,Ie.u_label_plane_matrix_inv),u_tile_tl_up:new o.Uniform3f(we,Ie.u_tile_tl_up),u_tile_tr_up:new o.Uniform3f(we,Ie.u_tile_tr_up),u_tile_br_up:new o.Uniform3f(we,Ie.u_tile_br_up),u_tile_bl_up:new o.Uniform3f(we,Ie.u_tile_bl_up),u_tile_up_scale:new o.Uniform1f(we,Ie.u_tile_up_scale)}))(l,be)),I.indexOf("FOG")!==-1&&(this.fogUniforms=((we,Ie)=>({u_fog_matrix:new o.UniformMatrix4f(we,Ie.u_fog_matrix),u_fog_range:new o.Uniform2f(we,Ie.u_fog_range),u_fog_color:new o.Uniform4f(we,Ie.u_fog_color),u_fog_horizon_blend:new o.Uniform1f(we,Ie.u_fog_horizon_blend),u_fog_temporal_offset:new o.Uniform1f(we,Ie.u_fog_temporal_offset)}))(l,be))}setTerrainUniformValues(l,p){if(!this.terrainUniforms)return;const x=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const E in p)x[E].set(p[E])}}setFogUniformValues(l,p){if(!this.fogUniforms)return;const x=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const E in p)x[E].location&&x[E].set(p[E])}}draw(l,p,x,E,A,I,D,B,j,$,X,K,se,re,ae,Pe){const ie=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(x),l.setStencilMode(E),l.setColorMode(A),l.setCullFace(I);for(const Se of Object.keys(this.fixedUniforms))this.fixedUniforms[Se].set(D[Se]);re&&re.setUniforms(l,this.binderUniforms,K,{zoom:se});const Ae={[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[p];for(const Se of X.get()){const be=Se.vaos||(Se.vaos={});(be[B]||(be[B]=new Ki)).bind(l,this,j,re?re.getPaintVertexBuffers():[],$,Se.vertexOffset,ae,Pe),ie.drawElements(p,Se.primitiveLength*Ae,ie.UNSIGNED_SHORT,Se.primitiveOffset*Ae*2)}}}function P1(v,l,p){const x=1/ve(p,1,l.transform.tileZoom),E=Math.pow(2,p.tileID.overscaledZ),A=p.tileSize*Math.pow(2,l.transform.tileZoom)/E,I=A*(p.tileID.canonical.x+p.tileID.wrap*E),D=A*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[x,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[I>>16,D>>16],u_pixel_coord_lower:[65535&I,65535&D]}}const O3=(v,l,p,x)=>{const E=l.style.light,A=E.properties.get("position"),I=[A.x,A.y,A.z],D=o.create$1();E.properties.get("anchor")==="viewport"&&(o.fromRotation(D,-l.transform.angle),o.transformMat3(I,I,D));const B=E.properties.get("color");return{u_matrix:v,u_lightpos:I,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+p,u_opacity:x}},D3=(v,l,p,x,E,A,I)=>o.extend(O3(v,l,p,x),P1(A,l,I),{u_height_factor:-Math.pow(2,E.overscaledZ)/I.tileSize/8}),Z0=v=>({u_matrix:v}),L3=(v,l,p,x)=>o.extend(Z0(v),P1(p,l,x)),F3=(v,l)=>({u_matrix:v,u_world:l}),q0=(v,l,p,x,E)=>o.extend(L3(v,l,p,x),{u_world:E}),du=(v,l,p,x)=>{const E=v.transform;let A;return A=x.paint.get("circle-pitch-alignment")==="map"?E.calculatePixelsToTileUnitsMatrix(p):new Float32Array([E.pixelsToGLUnits[0],0,0,E.pixelsToGLUnits[1]]),{u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:v.translatePosMatrix(l.projMatrix,p,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:A}},N3=v=>{const l=[];return v.paint.get("circle-pitch-alignment")==="map"&&l.push("PITCH_WITH_MAP"),v.paint.get("circle-pitch-scale")==="map"&&l.push("SCALE_WITH_MAP"),l},G0=(v,l,p)=>{const x=o.EXTENT/p.tileSize;return{u_matrix:v,u_camera_to_center_distance:l.cameraToCenterDistance,u_extrude_scale:[l.pixelsToGLUnits[0]/x,l.pixelsToGLUnits[1]/x]}},B3=(v,l,p=1)=>({u_matrix:v,u_color:l,u_overlay:0,u_overlay_scale:p}),z3=(v,l,p,x)=>({u_matrix:v,u_extrude_scale:ve(l,1,p),u_intensity:x}),Y0=(v,l,p,x,E,A)=>{const I=v.transform,D=I.calculatePixelsToTileUnitsMatrix(l),B={u_matrix:I1(v,l,p,E),u_pixels_to_tile_units:D,u_device_pixel_ratio:o.exported.devicePixelRatio,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:A,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Qa(p)){const j=jl(l,v.transform);B.u_texsize=l.lineAtlasTexture.size,B.u_scale=[j,x.fromScale,x.toScale],B.u_mix=x.t}return B},Ja=(v,l,p,x,E)=>{const A=v.transform,I=jl(l,A);return{u_matrix:I1(v,l,p,E),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:o.exported.devicePixelRatio,u_image:0,u_scale:[I,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function jl(v,l){return 1/ve(v,1,l.tileZoom)}function I1(v,l,p,x){return v.translatePosMatrix(x||l.tileID.projMatrix,l,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}function Qa(v){const l=v.paint.get("line-dasharray").value;return l.value||l.kind!=="constant"}const Pc=(v,l,p,x,E,A)=>{return{u_matrix:v,u_tl_parent:l,u_scale_parent:p,u_fade_t:x.mix,u_opacity:x.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(D=E.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(I=E.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Ic(E.paint.get("raster-hue-rotate")),u_perspective_transform:A};var I,D};function Ic(v){v*=Math.PI/180;const l=Math.sin(v),p=Math.cos(v);return[(2*p+1)/3,(-Math.sqrt(3)*l-p+1)/3,(Math.sqrt(3)*l-p+1)/3]}const Mc=(v,l,p,x,E,A,I,D,B,j,$,X,K,se)=>{const re=E.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:re.cameraToCenterDistance,u_pitch:re.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:re.width/re.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:I,u_coord_matrix:D,u_is_text:+B,u_pitch_with_map:+x,u_texsize:j,u_tile_id:$,u_zoom_transition:X,u_inv_rot_matrix:K,u_merc_center:se,u_texture:0}},$l=(v,l,p,x,E,A,I,D,B,j,$,X,K,se,re)=>{const{cameraToCenterDistance:ae,_pitch:Pe}=E.transform;return o.extend(Mc(v,l,p,x,E,A,I,D,B,j,X,K,se,re),{u_gamma_scale:x?ae*Math.cos(E.terrain?0:Pe):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:1})},M1=(v,l,p,x,E,A,I,D,B,j,$,X,K,se)=>o.extend($l(v,l,p,x,E,A,I,D,!0,B,!0,$,X,K,se),{u_texsize_icon:j,u_texture_icon:1}),rr=(v,l,p)=>({u_matrix:v,u_opacity:l,u_color:p}),Rc=(v,l,p,x,E,A)=>o.extend(function(I,D,B,j){const $=B.imageManager.getPattern(I.from.toString()),X=B.imageManager.getPattern(I.to.toString()),{width:K,height:se}=B.imageManager.getPixelSize(),re=Math.pow(2,j.tileID.overscaledZ),ae=j.tileSize*Math.pow(2,B.transform.tileZoom)/re,Pe=ae*(j.tileID.canonical.x+j.tileID.wrap*re),ie=ae*j.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:$.tl,u_pattern_br_a:$.br,u_pattern_tl_b:X.tl,u_pattern_br_b:X.br,u_texsize:[K,se],u_mix:D.t,u_pattern_size_a:$.displaySize,u_pattern_size_b:X.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/ve(j,1,B.transform.tileZoom),u_pixel_coord_upper:[Pe>>16,ie>>16],u_pixel_coord_lower:[65535&Pe,65535&ie]}}(x,A,p,E),{u_matrix:v,u_opacity:l}),K0={fillExtrusion:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_lightpos:new o.Uniform3f(v,l.u_lightpos),u_lightintensity:new o.Uniform1f(v,l.u_lightintensity),u_lightcolor:new o.Uniform3f(v,l.u_lightcolor),u_vertical_gradient:new o.Uniform1f(v,l.u_vertical_gradient),u_opacity:new o.Uniform1f(v,l.u_opacity)}),fillExtrusionPattern:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_lightpos:new o.Uniform3f(v,l.u_lightpos),u_lightintensity:new o.Uniform1f(v,l.u_lightintensity),u_lightcolor:new o.Uniform3f(v,l.u_lightcolor),u_vertical_gradient:new o.Uniform1f(v,l.u_vertical_gradient),u_height_factor:new o.Uniform1f(v,l.u_height_factor),u_image:new o.Uniform1i(v,l.u_image),u_texsize:new o.Uniform2f(v,l.u_texsize),u_pixel_coord_upper:new o.Uniform2f(v,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(v,l.u_pixel_coord_lower),u_scale:new o.Uniform3f(v,l.u_scale),u_fade:new o.Uniform1f(v,l.u_fade),u_opacity:new o.Uniform1f(v,l.u_opacity)}),fill:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix)}),fillPattern:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_image:new o.Uniform1i(v,l.u_image),u_texsize:new o.Uniform2f(v,l.u_texsize),u_pixel_coord_upper:new o.Uniform2f(v,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(v,l.u_pixel_coord_lower),u_scale:new o.Uniform3f(v,l.u_scale),u_fade:new o.Uniform1f(v,l.u_fade)}),fillOutline:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_world:new o.Uniform2f(v,l.u_world)}),fillOutlinePattern:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_world:new o.Uniform2f(v,l.u_world),u_image:new o.Uniform1i(v,l.u_image),u_texsize:new o.Uniform2f(v,l.u_texsize),u_pixel_coord_upper:new o.Uniform2f(v,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(v,l.u_pixel_coord_lower),u_scale:new o.Uniform3f(v,l.u_scale),u_fade:new o.Uniform1f(v,l.u_fade)}),circle:(v,l)=>({u_camera_to_center_distance:new o.Uniform1f(v,l.u_camera_to_center_distance),u_extrude_scale:new o.UniformMatrix2f(v,l.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(v,l.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(v,l.u_matrix)}),collisionBox:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_camera_to_center_distance:new o.Uniform1f(v,l.u_camera_to_center_distance),u_extrude_scale:new o.Uniform2f(v,l.u_extrude_scale)}),collisionCircle:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_inv_matrix:new o.UniformMatrix4f(v,l.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(v,l.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(v,l.u_viewport_size)}),debug:(v,l)=>({u_color:new o.UniformColor(v,l.u_color),u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_overlay:new o.Uniform1i(v,l.u_overlay),u_overlay_scale:new o.Uniform1f(v,l.u_overlay_scale)}),clippingMask:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix)}),heatmap:(v,l)=>({u_extrude_scale:new o.Uniform1f(v,l.u_extrude_scale),u_intensity:new o.Uniform1f(v,l.u_intensity),u_matrix:new o.UniformMatrix4f(v,l.u_matrix)}),heatmapTexture:(v,l)=>({u_image:new o.Uniform1i(v,l.u_image),u_color_ramp:new o.Uniform1i(v,l.u_color_ramp),u_opacity:new o.Uniform1f(v,l.u_opacity)}),hillshade:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_image:new o.Uniform1i(v,l.u_image),u_latrange:new o.Uniform2f(v,l.u_latrange),u_light:new o.Uniform2f(v,l.u_light),u_shadow:new o.UniformColor(v,l.u_shadow),u_highlight:new o.UniformColor(v,l.u_highlight),u_accent:new o.UniformColor(v,l.u_accent)}),hillshadePrepare:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_image:new o.Uniform1i(v,l.u_image),u_dimension:new o.Uniform2f(v,l.u_dimension),u_zoom:new o.Uniform1f(v,l.u_zoom),u_unpack:new o.Uniform4f(v,l.u_unpack)}),line:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_pixels_to_tile_units:new o.UniformMatrix2f(v,l.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(v,l.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(v,l.u_units_to_pixels),u_dash_image:new o.Uniform1i(v,l.u_dash_image),u_gradient_image:new o.Uniform1i(v,l.u_gradient_image),u_image_height:new o.Uniform1f(v,l.u_image_height),u_texsize:new o.Uniform2f(v,l.u_texsize),u_scale:new o.Uniform3f(v,l.u_scale),u_mix:new o.Uniform1f(v,l.u_mix),u_alpha_discard_threshold:new o.Uniform1f(v,l.u_alpha_discard_threshold)}),linePattern:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_texsize:new o.Uniform2f(v,l.u_texsize),u_pixels_to_tile_units:new o.UniformMatrix2f(v,l.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(v,l.u_device_pixel_ratio),u_image:new o.Uniform1i(v,l.u_image),u_units_to_pixels:new o.Uniform2f(v,l.u_units_to_pixels),u_scale:new o.Uniform3f(v,l.u_scale),u_fade:new o.Uniform1f(v,l.u_fade),u_alpha_discard_threshold:new o.Uniform1f(v,l.u_alpha_discard_threshold)}),raster:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_tl_parent:new o.Uniform2f(v,l.u_tl_parent),u_scale_parent:new o.Uniform1f(v,l.u_scale_parent),u_fade_t:new o.Uniform1f(v,l.u_fade_t),u_opacity:new o.Uniform1f(v,l.u_opacity),u_image0:new o.Uniform1i(v,l.u_image0),u_image1:new o.Uniform1i(v,l.u_image1),u_brightness_low:new o.Uniform1f(v,l.u_brightness_low),u_brightness_high:new o.Uniform1f(v,l.u_brightness_high),u_saturation_factor:new o.Uniform1f(v,l.u_saturation_factor),u_contrast_factor:new o.Uniform1f(v,l.u_contrast_factor),u_spin_weights:new o.Uniform3f(v,l.u_spin_weights),u_perspective_transform:new o.Uniform2f(v,l.u_perspective_transform)}),symbolIcon:(v,l)=>({u_is_size_zoom_constant:new o.Uniform1i(v,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(v,l.u_is_size_feature_constant),u_size_t:new o.Uniform1f(v,l.u_size_t),u_size:new o.Uniform1f(v,l.u_size),u_camera_to_center_distance:new o.Uniform1f(v,l.u_camera_to_center_distance),u_pitch:new o.Uniform1f(v,l.u_pitch),u_rotate_symbol:new o.Uniform1i(v,l.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(v,l.u_aspect_ratio),u_fade_change:new o.Uniform1f(v,l.u_fade_change),u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(v,l.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(v,l.u_coord_matrix),u_is_text:new o.Uniform1i(v,l.u_is_text),u_pitch_with_map:new o.Uniform1i(v,l.u_pitch_with_map),u_texsize:new o.Uniform2f(v,l.u_texsize),u_tile_id:new o.Uniform3f(v,l.u_tile_id),u_zoom_transition:new o.Uniform1f(v,l.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(v,l.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(v,l.u_merc_center),u_texture:new o.Uniform1i(v,l.u_texture)}),symbolSDF:(v,l)=>({u_is_size_zoom_constant:new o.Uniform1i(v,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(v,l.u_is_size_feature_constant),u_size_t:new o.Uniform1f(v,l.u_size_t),u_size:new o.Uniform1f(v,l.u_size),u_camera_to_center_distance:new o.Uniform1f(v,l.u_camera_to_center_distance),u_pitch:new o.Uniform1f(v,l.u_pitch),u_rotate_symbol:new o.Uniform1i(v,l.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(v,l.u_aspect_ratio),u_fade_change:new o.Uniform1f(v,l.u_fade_change),u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(v,l.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(v,l.u_coord_matrix),u_is_text:new o.Uniform1i(v,l.u_is_text),u_pitch_with_map:new o.Uniform1i(v,l.u_pitch_with_map),u_texsize:new o.Uniform2f(v,l.u_texsize),u_texture:new o.Uniform1i(v,l.u_texture),u_gamma_scale:new o.Uniform1f(v,l.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(v,l.u_device_pixel_ratio),u_tile_id:new o.Uniform3f(v,l.u_tile_id),u_zoom_transition:new o.Uniform1f(v,l.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(v,l.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(v,l.u_merc_center),u_is_halo:new o.Uniform1i(v,l.u_is_halo)}),symbolTextAndIcon:(v,l)=>({u_is_size_zoom_constant:new o.Uniform1i(v,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(v,l.u_is_size_feature_constant),u_size_t:new o.Uniform1f(v,l.u_size_t),u_size:new o.Uniform1f(v,l.u_size),u_camera_to_center_distance:new o.Uniform1f(v,l.u_camera_to_center_distance),u_pitch:new o.Uniform1f(v,l.u_pitch),u_rotate_symbol:new o.Uniform1i(v,l.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(v,l.u_aspect_ratio),u_fade_change:new o.Uniform1f(v,l.u_fade_change),u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(v,l.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(v,l.u_coord_matrix),u_is_text:new o.Uniform1i(v,l.u_is_text),u_pitch_with_map:new o.Uniform1i(v,l.u_pitch_with_map),u_texsize:new o.Uniform2f(v,l.u_texsize),u_texsize_icon:new o.Uniform2f(v,l.u_texsize_icon),u_texture:new o.Uniform1i(v,l.u_texture),u_texture_icon:new o.Uniform1i(v,l.u_texture_icon),u_gamma_scale:new o.Uniform1f(v,l.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(v,l.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(v,l.u_is_halo)}),background:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_opacity:new o.Uniform1f(v,l.u_opacity),u_color:new o.UniformColor(v,l.u_color)}),backgroundPattern:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_opacity:new o.Uniform1f(v,l.u_opacity),u_image:new o.Uniform1i(v,l.u_image),u_pattern_tl_a:new o.Uniform2f(v,l.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(v,l.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(v,l.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(v,l.u_pattern_br_b),u_texsize:new o.Uniform2f(v,l.u_texsize),u_mix:new o.Uniform1f(v,l.u_mix),u_pattern_size_a:new o.Uniform2f(v,l.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(v,l.u_pattern_size_b),u_scale_a:new o.Uniform1f(v,l.u_scale_a),u_scale_b:new o.Uniform1f(v,l.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(v,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(v,l.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(v,l.u_tile_units_to_pixels)}),terrainRaster:Ji,terrainDepth:Ji,skybox:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_sun_direction:new o.Uniform3f(v,l.u_sun_direction),u_cubemap:new o.Uniform1i(v,l.u_cubemap),u_opacity:new o.Uniform1f(v,l.u_opacity),u_temporal_offset:new o.Uniform1f(v,l.u_temporal_offset)}),skyboxGradient:(v,l)=>({u_matrix:new o.UniformMatrix4f(v,l.u_matrix),u_color_ramp:new o.Uniform1i(v,l.u_color_ramp),u_center_direction:new o.Uniform3f(v,l.u_center_direction),u_radius:new o.Uniform1f(v,l.u_radius),u_opacity:new o.Uniform1f(v,l.u_opacity),u_temporal_offset:new o.Uniform1f(v,l.u_temporal_offset)}),skyboxCapture:(v,l)=>({u_matrix_3f:new o.UniformMatrix3f(v,l.u_matrix_3f),u_sun_direction:new o.Uniform3f(v,l.u_sun_direction),u_sun_intensity:new o.Uniform1f(v,l.u_sun_intensity),u_color_tint_r:new o.Uniform4f(v,l.u_color_tint_r),u_color_tint_m:new o.Uniform4f(v,l.u_color_tint_m),u_luminance:new o.Uniform1f(v,l.u_luminance)}),globeRaster:(v,l)=>({u_proj_matrix:new o.UniformMatrix4f(v,l.u_proj_matrix),u_globe_matrix:new o.UniformMatrix4f(v,l.u_globe_matrix),u_merc_matrix:new o.UniformMatrix4f(v,l.u_merc_matrix),u_zoom_transition:new o.Uniform1f(v,l.u_zoom_transition),u_merc_center:new o.Uniform2f(v,l.u_merc_center),u_image0:new o.Uniform1i(v,l.u_image0)}),globeAtmosphere:(v,l)=>({u_center:new o.Uniform2f(v,l.u_center),u_radius:new o.Uniform1f(v,l.u_radius),u_screen_size:new o.Uniform2f(v,l.u_screen_size),u_pixel_ratio:new o.Uniform1f(v,l.u_pixel_ratio),u_opacity:new o.Uniform1f(v,l.u_opacity),u_fadeout_range:new o.Uniform1f(v,l.u_fadeout_range),u_start_color:new o.Uniform3f(v,l.u_start_color),u_end_color:new o.Uniform3f(v,l.u_end_color)})};let R1;function U3(v,l,p,x,E,A,I){const D=v.context,B=D.gl,j=v.useProgram("collisionBox"),$=[];let X=0,K=0;for(let Se=0;Se<x.length;Se++){const be=x[Se],we=l.getTile(be),Ie=we.getBucket(p);if(!Ie)continue;let Ke=be.projMatrix;E[0]===0&&E[1]===0||(Ke=v.translatePosMatrix(be.projMatrix,we,E,A));const st=I?Ie.textCollisionBox:Ie.iconCollisionBox,It=Ie.collisionCircleArray;if(It.length>0){const Et=o.create(),bt=Ke;o.mul(Et,Ie.placementInvProjMatrix,v.transform.glCoordMatrix),o.mul(Et,Et,Ie.placementViewportMatrix),$.push({circleArray:It,circleOffset:K,transform:bt,invTransform:Et}),X+=It.length/4,K=X}st&&(v.terrain&&v.terrain.setupElevationDraw(we,j),j.draw(D,B.LINES,o.DepthMode.disabled,o.StencilMode.disabled,v.colorModeForRenderPass(),o.CullFaceMode.disabled,G0(Ke,v.transform,we),p.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,null,v.transform.zoom,null,st.collisionVertexBuffer,st.collisionVertexBufferExt))}if(!I||!$.length)return;const se=v.useProgram("collisionCircle"),re=new o.StructArrayLayout2f1f2i16;re.resize(4*X),re._trim();let ae=0;for(const Se of $)for(let be=0;be<Se.circleArray.length/4;be++){const we=4*be,Ie=Se.circleArray[we+0],Ke=Se.circleArray[we+1],st=Se.circleArray[we+2],It=Se.circleArray[we+3];re.emplace(ae++,Ie,Ke,st,It,0),re.emplace(ae++,Ie,Ke,st,It,1),re.emplace(ae++,Ie,Ke,st,It,2),re.emplace(ae++,Ie,Ke,st,It,3)}(!R1||R1.length<2*X)&&(R1=function(Se){const be=2*Se,we=new o.StructArrayLayout3ui6;we.resize(be),we._trim();for(let Ie=0;Ie<be;Ie++){const Ke=6*Ie;we.uint16[Ke+0]=4*Ie+0,we.uint16[Ke+1]=4*Ie+1,we.uint16[Ke+2]=4*Ie+2,we.uint16[Ke+3]=4*Ie+2,we.uint16[Ke+4]=4*Ie+3,we.uint16[Ke+5]=4*Ie+0}return we}(X));const Pe=D.createIndexBuffer(R1,!0),ie=D.createVertexBuffer(re,o.collisionCircleLayout.members,!0);for(const Se of $){const be={u_matrix:Se.transform,u_inv_matrix:Se.invTransform,u_camera_to_center_distance:(Ae=v.transform).cameraToCenterDistance,u_viewport_size:[Ae.width,Ae.height]};se.draw(D,B.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,v.colorModeForRenderPass(),o.CullFaceMode.disabled,be,p.id,ie,Pe,o.SegmentVector.simpleSegment(0,2*Se.circleOffset,Se.circleArray.length,Se.circleArray.length/2),null,v.transform.zoom,null,null,null)}var Ae;ie.destroy(),Pe.destroy()}const kc=o.identity(new Float32Array(16));function Oc(v,l,p,x,E,A){const{horizontalAlign:I,verticalAlign:D}=o.getAnchorAlignment(v),B=-(I-.5)*l,j=-(D-.5)*p,$=o.evaluateVariableOffset(v,x);return new o.pointGeometry((B/E+$[0])*A,(j/E+$[1])*A)}function k1(v,l,p,x,E,A,I,D,B,j,$,X){const K=v.text.placedSymbolArray,se=v.text.dynamicLayoutVertexArray,re=v.icon.dynamicLayoutVertexArray,ae={},Pe=D.projMatrix,ie=A.elevation,Ae=ie?ie.getAtTileOffsetFunc(D,X):Se=>[0,0,0];se.clear();for(let Se=0;Se<K.length;Se++){const be=K.get(Se),we=v.allowVerticalPlacement&&!be.placedOrientation,Ie=be.hidden||!be.crossTileID||we?null:x[be.crossTileID];if(Ie){const Ke=new o.pointGeometry(be.tileAnchorX,be.tileAnchorY),st=Ae(Ke),It=br(Ke,p?Pe:I,st[2]),Et=Zr(A.cameraToCenterDistance,It.signedDistanceFromCamera);let bt=E.evaluateSizeForFeature(v.textSizeData,j,be)*Et/o.ONE_EM;p&&(bt*=v.tilePixelRatio/B);const{width:ut,height:it,anchor:vt,textOffset:dt,textScale:nn}=Ie,hn=Oc(vt,ut,it,dt,nn,bt),In=p?br(Ke.add(hn),I,st[2]).point:It.point.add(l?hn.rotate(-A.angle):hn),Rt=v.allowVerticalPlacement&&be.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let sn=0;sn<be.numGlyphs;sn++)o.addDynamicAttributes(se,In,Rt);$&&be.associatedIconIndex>=0&&(ae[be.associatedIconIndex]={shiftedAnchor:In,angle:Rt})}else si(be.numGlyphs,se)}if($){re.clear();const Se=v.icon.placedSymbolArray;for(let be=0;be<Se.length;be++){const we=Se.get(be);if(we.hidden)si(we.numGlyphs,re);else{const Ie=ae[be];if(Ie)for(let Ke=0;Ke<we.numGlyphs;Ke++)o.addDynamicAttributes(re,Ie.shiftedAnchor,Ie.angle);else si(we.numGlyphs,re)}}v.icon.dynamicLayoutVertexBuffer.updateData(re)}v.text.dynamicLayoutVertexBuffer.updateData(se)}function pu(v,l,p){return p.iconsInText&&l?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function O1(v,l,p,x,E,A,I,D,B,j,$,X){const K=v.context,se=K.gl,re=v.transform,ae=re.projection.createTileTransform(re,re.worldSize),Pe=D==="map",ie=B==="map",Ae=Pe&&p.layout.get("symbol-placement")!=="point",Se=Pe&&!ie&&!Ae,be=p.layout.get("symbol-sort-key").constantOr(1)!==void 0;let we=!1;const Ie=v.depthModeForSublayer(0,o.DepthMode.ReadOnly),Ke=[o.mercatorXfromLng(re.center.lng),o.mercatorYfromLat(re.center.lat)],st=p.layout.get("text-variable-anchor"),It=re.projection.name==="globe",Et=It?o.globeToMercatorTransition(re.zoom):0,bt=[],ut=[];v.terrain&&ie&&ut.push("PITCH_WITH_MAP_TERRAIN"),It&&ut.push("PROJECTION_GLOBE_VIEW"),Ae&&ut.push("PROJECTED_POS_ON_VIEWPORT");for(const it of x){const vt=l.getTile(it),dt=vt.getBucket(p);if(!dt||dt.projection!==re.projection.name)continue;const nn=E?dt.text:dt.icon;if(!nn||dt.fullyClipped||!nn.segments.get().length)continue;const hn=nn.programConfigurations.get(p.id),In=E||dt.sdfIcons,Rt=E?dt.textSizeData:dt.iconSizeData,sn=ie||re.pitch!==0,_n=v.useProgram(pu(In,E,dt),hn,ut),Jn=o.evaluateSizeForZoom(Rt,re.zoom),hr=[it.canonical.x,it.canonical.y,1<<it.canonical.z];let mn,Nn,fr,_r,_i=[0,0],Ni=null;if(E){if(Nn=vt.glyphAtlasTexture,fr=se.LINEAR,mn=vt.glyphAtlasTexture.size,dt.iconsInText){_i=vt.imageAtlasTexture.size,Ni=vt.imageAtlasTexture;const li=Rt.kind==="composite"||Rt.kind==="camera";_r=sn||v.options.rotating||v.options.zooming||li?se.LINEAR:se.NEAREST}}else{const li=p.layout.get("icon-size").constantOr(0)!==1||dt.iconsNeedLinear;Nn=vt.imageAtlasTexture,fr=In||v.options.rotating||v.options.zooming||li||sn?se.LINEAR:se.NEAREST,mn=vt.imageAtlasTexture.size}const Ai=v.transform.calculatePixelsToTileUnitsMatrix(vt),$n=$r(it.projMatrix,vt.tileID.canonical,ie,Pe,v.transform,Ai),gn=v.terrain&&ie&&Ae?o.invert(new Float32Array(16),$n):kc,Un=ki(it.projMatrix,vt.tileID.canonical,ie,Pe,v.transform,Ai),Rr=st&&dt.hasTextData(),tr=p.layout.get("icon-text-fit")!=="none"&&Rr&&dt.hasIconData();if(Ae){const li=re.elevation,ko=li?li.getAtTileOffsetFunc(it,ae):Oo=>[0,0,0];Yi(dt,it.projMatrix,v,E,$n,Un,ie,j,ko,it)}const dr=v.translatePosMatrix(it.projMatrix,vt,A,I),qr=Ae||E&&st||tr?kc:$n,js=v.translatePosMatrix(Un,vt,A,I,!0),zr=In&&p.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ca;const Gt=ae.createInversionMatrix(it.toUnwrapped());Ca=In?dt.iconsInText?M1(Rt.kind,Jn,Se,ie,v,dr,qr,js,mn,_i,hr,Et,Gt,Ke):$l(Rt.kind,Jn,Se,ie,v,dr,qr,js,E,mn,!0,hr,Et,Gt,Ke):Mc(Rt.kind,Jn,Se,ie,v,dr,qr,js,E,mn,hr,Et,Gt,Ke);const an={program:_n,buffers:nn,uniformValues:Ca,atlasTexture:Nn,atlasTextureIcon:Ni,atlasInterpolation:fr,atlasInterpolationIcon:_r,isSDF:In,hasHalo:zr,tile:vt,labelPlaneMatrixInv:gn};if(be&&dt.canOverlap){we=!0;const li=nn.segments.get();for(const ko of li)bt.push({segments:new o.SegmentVector([ko]),sortKey:ko.sortKey,state:an})}else bt.push({segments:nn.segments,sortKey:0,state:an})}we&&bt.sort((it,vt)=>it.sortKey-vt.sortKey);for(const it of bt){const vt=it.state;if(v.terrain&&v.terrain.setupElevationDraw(vt.tile,vt.program,{useDepthForOcclusion:!It,labelPlaneMatrixInv:vt.labelPlaneMatrixInv}),K.activeTexture.set(se.TEXTURE0),vt.atlasTexture.bind(vt.atlasInterpolation,se.CLAMP_TO_EDGE),vt.atlasTextureIcon&&(K.activeTexture.set(se.TEXTURE1),vt.atlasTextureIcon&&vt.atlasTextureIcon.bind(vt.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),vt.isSDF){const dt=vt.uniformValues;vt.hasHalo&&(dt.u_is_halo=1,D1(vt.buffers,it.segments,p,v,vt.program,Ie,$,X,dt)),dt.u_is_halo=0}D1(vt.buffers,it.segments,p,v,vt.program,Ie,$,X,vt.uniformValues)}}function D1(v,l,p,x,E,A,I,D,B){const j=x.context;E.draw(j,j.gl.TRIANGLES,A,I,D,o.CullFaceMode.disabled,B,p.id,v.layoutVertexBuffer,v.indexBuffer,l,p.paint,x.transform.zoom,v.programConfigurations.get(p.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function L1(v,l,p,x,E,A,I){const D=v.context.gl,B=p.paint.get("fill-pattern"),j=B&&B.constantOr(1),$=p.getCrossfadeParameters();let X,K,se,re,ae;I?(K=j&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=D.LINES):(K=j?"fillPattern":"fill",X=D.TRIANGLES);for(const Pe of x){const ie=l.getTile(Pe);if(j&&!ie.patternsLoaded())continue;const Ae=ie.getBucket(p);if(!Ae)continue;v.prepareDrawTile(Pe);const Se=Ae.programConfigurations.get(p.id),be=v.useProgram(K,Se);j&&(v.context.activeTexture.set(D.TEXTURE0),ie.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Se.updatePaintBuffers($));const we=B.constantOr(null);if(we&&ie.imageAtlas){const Ke=ie.imageAtlas,st=Ke.patternPositions[we.to.toString()],It=Ke.patternPositions[we.from.toString()];st&&It&&Se.setConstantPatternPositions(st,It)}const Ie=v.translatePosMatrix(Pe.projMatrix,ie,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(I){re=Ae.indexBuffer2,ae=Ae.segments2;const Ke=v.terrain&&v.terrain.renderingToTexture?v.terrain.drapeBufferSize:[D.drawingBufferWidth,D.drawingBufferHeight];se=K==="fillOutlinePattern"&&j?q0(Ie,v,$,ie,Ke):F3(Ie,Ke)}else re=Ae.indexBuffer,ae=Ae.segments,se=j?L3(Ie,v,$,ie):Z0(Ie);v.prepareDrawProgram(v.context,be,Pe.toUnwrapped()),be.draw(v.context,X,E,v.stencilModeForClipping(Pe),A,o.CullFaceMode.disabled,se,p.id,Ae.layoutVertexBuffer,re,ae,p.paint,v.transform.zoom,Se)}}function Wl(v,l,p,x,E,A,I){const D=v.context,B=D.gl,j=p.paint.get("fill-extrusion-pattern"),$=j.constantOr(1),X=p.getCrossfadeParameters(),K=p.paint.get("fill-extrusion-opacity");for(const se of x){const re=l.getTile(se),ae=re.getBucket(p);if(!ae)continue;const Pe=ae.programConfigurations.get(p.id),ie=v.useProgram($?"fillExtrusionPattern":"fillExtrusion",Pe);if(v.terrain){const Ie=v.terrain;if(!ae.enableTerrain)continue;if(Ie.setupElevationDraw(re,ie,{useMeterToDem:!0}),V3(D,l,se,ae,p,Ie),!ae.centroidVertexBuffer){const Ke=ie.attributes.a_centroid_pos;Ke!==void 0&&B.vertexAttrib2f(Ke,0,0)}}$&&(v.context.activeTexture.set(B.TEXTURE0),re.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Pe.updatePaintBuffers(X));const Ae=j.constantOr(null);if(Ae&&re.imageAtlas){const Ie=re.imageAtlas,Ke=Ie.patternPositions[Ae.to.toString()],st=Ie.patternPositions[Ae.from.toString()];Ke&&st&&Pe.setConstantPatternPositions(Ke,st)}const Se=v.translatePosMatrix(se.projMatrix,re,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),be=p.paint.get("fill-extrusion-vertical-gradient"),we=$?D3(Se,v,be,K,se,X,re):O3(Se,v,be,K);v.prepareDrawProgram(D,ie,se.toUnwrapped()),ie.draw(D,D.gl.TRIANGLES,E,A,I,o.CullFaceMode.backCCW,we,p.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,p.paint,v.transform.zoom,Pe,v.terrain?ae.centroidVertexBuffer:null)}}function V3(v,l,p,x,E,A){const I=[ie=>{let Ae=ie.canonical.x-1,Se=ie.wrap;return Ae<0&&(Ae=(1<<ie.canonical.z)-1,Se--),new o.OverscaledTileID(ie.overscaledZ,Se,ie.canonical.z,Ae,ie.canonical.y)},ie=>{let Ae=ie.canonical.x+1,Se=ie.wrap;return Ae===1<<ie.canonical.z&&(Ae=0,Se++),new o.OverscaledTileID(ie.overscaledZ,Se,ie.canonical.z,Ae,ie.canonical.y)},ie=>new o.OverscaledTileID(ie.overscaledZ,ie.wrap,ie.canonical.z,ie.canonical.x,(ie.canonical.y===0?1<<ie.canonical.z:ie.canonical.y)-1),ie=>new o.OverscaledTileID(ie.overscaledZ,ie.wrap,ie.canonical.z,ie.canonical.x,ie.canonical.y===(1<<ie.canonical.z)-1?0:ie.canonical.y+1)],D=ie=>{const Ae=l.getSource().maxzoom,Se=Ke=>{const st=l.getTileByID(Ke);if(st&&st.hasData())return st.getBucket(E)};let be,we,Ie;return(ie.overscaledZ===ie.canonical.z||ie.overscaledZ>=Ae)&&(be=Se(ie.key)),ie.overscaledZ>=Ae&&(we=Se(ie.calculateScaledKey(ie.overscaledZ+1))),ie.overscaledZ>Ae&&(Ie=Se(ie.calculateScaledKey(ie.overscaledZ-1))),be||we||Ie},B=[0,0,0],j=(ie,Ae)=>(B[0]=Math.min(ie.min.y,Ae.min.y),B[1]=Math.max(ie.max.y,Ae.max.y),B[2]=o.EXTENT-Ae.min.x>ie.max.x?Ae.min.x-o.EXTENT:ie.max.x,B),$=(ie,Ae)=>(B[0]=Math.min(ie.min.x,Ae.min.x),B[1]=Math.max(ie.max.x,Ae.max.x),B[2]=o.EXTENT-Ae.min.y>ie.max.y?Ae.min.y-o.EXTENT:ie.max.y,B),X=[(ie,Ae)=>j(ie,Ae),(ie,Ae)=>j(Ae,ie),(ie,Ae)=>$(ie,Ae),(ie,Ae)=>$(Ae,ie)],K=new o.pointGeometry(0,0);let se,re,ae;const Pe=(ie,Ae,Se,be,we)=>{const Ie=[[be?Se:ie,be?ie:Se,0],[be?Se:Ae,be?Ae:Se,0]],Ke=we<0?o.EXTENT+we:we,st=[be?Ke:(ie+Ae)/2,be?(ie+Ae)/2:Ke,0];return Se===0&&we<0||Se!==0&&we>0?A.getForTilePoints(ae,[st],!0,re):Ie.push(st),A.getForTilePoints(p,Ie,!0,se),Math.max(Ie[0][2],Ie[1][2],st[2])/A.exaggeration()};for(let ie=0;ie<4;ie++){const Ae=x.borders[ie];if(Ae.length===0&&(x.borderDone[ie]=!0),x.borderDone[ie])continue;const Se=ae=I[ie](p),be=D(Se);if(!be||!be.enableTerrain||(re=A.findDEMTileFor(Se),!re||!re.dem))continue;if(!se){const st=A.findDEMTileFor(p);if(!st||!st.dem)return;se=st}const we=(ie<2?1:5)-ie,Ie=be.borders[we];let Ke=0;for(let st=0;st<Ae.length;st++){const It=x.featuresOnBorder[Ae[st]],Et=It.borders[ie];let bt;for(;Ke<Ie.length&&(bt=be.featuresOnBorder[Ie[Ke]],!(bt.borders[we][1]>Et[0]+3));)be.borderDone[we]||be.encodeCentroid(void 0,bt,!1),Ke++;if(bt&&Ke<Ie.length){const ut=Ke;let it=0;for(;!(bt.borders[we][0]>Et[1]-3)&&(it++,++Ke!==Ie.length);)bt=be.featuresOnBorder[Ie[Ke]];if(bt=be.featuresOnBorder[Ie[ut]],It.intersectsCount()>1||bt.intersectsCount()>1||it!==1){it!==1&&(Ke=ut),x.encodeCentroid(void 0,It,!1),be.borderDone[we]||be.encodeCentroid(void 0,bt,!1);continue}const vt=X[ie](It,bt),dt=ie%2?o.EXTENT-1:0;K.x=Pe(vt[0],Math.min(o.EXTENT-1,vt[1]),dt,ie<2,vt[2]),K.y=0,x.encodeCentroid(K,It,!1),be.borderDone[we]||be.encodeCentroid(K,bt,!1)}else x.encodeCentroid(void 0,It,!1)}x.borderDone[ie]=x.needsCentroidUpdate=!0,be.borderDone[we]||(be.borderDone[we]=be.needsCentroidUpdate=!0)}(x.needsCentroidUpdate||!x.centroidVertexBuffer&&x.centroidVertexArray.length!==0)&&x.uploadCentroid(v)}const el=new o.Color(1,0,0,1),mu=new o.Color(0,1,0,1),F1=new o.Color(0,0,1,1),N1=new o.Color(1,0,1,1),j3=new o.Color(0,1,1,1);function Qi(v,l,p,x){ao(v,0,l+p/2,v.transform.width,p,x)}function ya(v,l,p,x){ao(v,l-p/2,0,p,v.transform.height,x)}function ao(v,l,p,x,E,A){const I=v.context,D=I.gl;D.enable(D.SCISSOR_TEST),D.scissor(l*o.exported.devicePixelRatio,p*o.exported.devicePixelRatio,x*o.exported.devicePixelRatio,E*o.exported.devicePixelRatio),I.clear({color:A}),D.disable(D.SCISSOR_TEST)}function Dc(v,l,p){const x=v.context,E=x.gl,A=p.projMatrix,I=v.useProgram("debug"),D=l.getTileByID(p.key);v.terrain&&v.terrain.setupElevationDraw(D,I);const B=o.DepthMode.disabled,j=o.StencilMode.disabled,$=v.colorModeForRenderPass(),X="$debug";x.activeTexture.set(E.TEXTURE0),v.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),D._makeDebugTileBoundsBuffers(v.context,v.transform.projection);const K=D._tileDebugBuffer||v.debugBuffer,se=D._tileDebugIndexBuffer||v.debugIndexBuffer,re=D._tileDebugSegments||v.debugSegments;I.draw(x,E.LINE_STRIP,B,j,$,o.CullFaceMode.disabled,B3(A,o.Color.red),X,K,se,re);const ae=D.latestRawTileData,Pe=Math.floor((ae&&ae.byteLength||0)/1024),ie=l.getTile(p).tileSize,Ae=512/Math.min(ie,512)*(p.overscaledZ/v.transform.zoom)*.5;let Se=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(Se+=` => ${p.overscaledZ}`),function(be,we){be.initDebugOverlayCanvas();const Ie=be.debugOverlayCanvas,Ke=be.context.gl,st=be.debugOverlayCanvas.getContext("2d");st.clearRect(0,0,Ie.width,Ie.height),st.shadowColor="white",st.shadowBlur=2,st.lineWidth=1.5,st.strokeStyle="white",st.textBaseline="top",st.font="bold 36px Open Sans, sans-serif",st.fillText(we,5,5),st.strokeText(we,5,5),be.debugOverlayTexture.update(Ie),be.debugOverlayTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}(v,`${Se} ${Pe}kb`),I.draw(x,E.TRIANGLES,B,j,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,B3(A,o.Color.transparent,Ae),X,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments)}const Hl=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:$3}=Hl;function Bs(v,l,p,x){v.emplaceBack(l,p,x)}class Xl{constructor(l){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Bs(this.vertexArray,-1,-1,1),Bs(this.vertexArray,1,-1,1),Bs(this.vertexArray,-1,1,1),Bs(this.vertexArray,1,1,1),Bs(this.vertexArray,-1,-1,-1),Bs(this.vertexArray,1,-1,-1),Bs(this.vertexArray,-1,1,-1),Bs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,$3),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function Po(v,l,p,x,E,A){const I=v.gl,D=l.paint.get("sky-atmosphere-color"),B=l.paint.get("sky-atmosphere-halo-color"),j=l.paint.get("sky-atmosphere-sun-intensity"),$=((X,K,se,re,ae)=>({u_matrix_3f:X,u_sun_direction:K,u_sun_intensity:se,u_color_tint_r:[re.r,re.g,re.b,re.a],u_color_tint_m:[ae.r,ae.g,ae.b,ae.a],u_luminance:5e-5}))(o.fromMat4([],x),E,j,D,B);I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+A,l.skyboxTexture,0),p.draw(v,I.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,$,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Zl={symbol:function(v,l,p,x,E){if(v.renderPass!=="translucent")return;const A=o.StencilMode.disabled,I=v.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(D,B,j,$,X,K,se){const re=B.transform,ae=X==="map",Pe=K==="map",ie=re.projection.createTileTransform(re,re.worldSize);for(const Ae of D){const Se=$.getTile(Ae),be=Se.getBucket(j);if(!be||be.projection!==re.projection.name||!be.text||!be.text.segments.get().length)continue;const we=o.evaluateSizeForZoom(be.textSizeData,re.zoom),Ie=B.transform.calculatePixelsToTileUnitsMatrix(Se),Ke=$r(Ae.projMatrix,Se.tileID.canonical,Pe,ae,B.transform,Ie),st=j.layout.get("icon-text-fit")!=="none"&&be.hasIconData();if(we){const It=Math.pow(2,re.zoom-Se.tileID.overscaledZ);k1(be,ae,Pe,se,o.symbolSize,re,Ke,Ae,It,we,st,ie)}}}(x,v,p,l,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),E),p.paint.get("icon-opacity").constantOr(1)!==0&&O1(v,l,p,x,!1,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),p.layout.get("icon-rotation-alignment"),p.layout.get("icon-pitch-alignment"),p.layout.get("icon-keep-upright"),A,I),p.paint.get("text-opacity").constantOr(1)!==0&&O1(v,l,p,x,!0,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),p.layout.get("text-keep-upright"),A,I),l.map.showCollisionBoxes&&(U3(v,l,p,x,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),U3(v,l,p,x,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))},circle:function(v,l,p,x){if(v.renderPass!=="translucent")return;const E=p.paint.get("circle-opacity"),A=p.paint.get("circle-stroke-width"),I=p.paint.get("circle-stroke-opacity"),D=p.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)===0&&(A.constantOr(1)===0||I.constantOr(1)===0))return;const B=v.context,j=B.gl,$=v.depthModeForSublayer(0,o.DepthMode.ReadOnly),X=o.StencilMode.disabled,K=v.colorModeForRenderPass(),se=[];for(let ae=0;ae<x.length;ae++){const Pe=x[ae],ie=l.getTile(Pe),Ae=ie.getBucket(p);if(!Ae)continue;const Se=Ae.programConfigurations.get(p.id),be=N3(p),we={programConfiguration:Se,program:v.useProgram("circle",Se,be),layoutVertexBuffer:Ae.layoutVertexBuffer,indexBuffer:Ae.indexBuffer,uniformValues:du(v,Pe,ie,p),tile:ie};if(D){const Ie=Ae.segments.get();for(const Ke of Ie)se.push({segments:new o.SegmentVector([Ke]),sortKey:Ke.sortKey,state:we})}else se.push({segments:Ae.segments,sortKey:0,state:we})}D&&se.sort((ae,Pe)=>ae.sortKey-Pe.sortKey);const re={useDepthForOcclusion:v.transform.projection.name!=="globe"};for(const ae of se){const{programConfiguration:Pe,program:ie,layoutVertexBuffer:Ae,indexBuffer:Se,uniformValues:be,tile:we}=ae.state,Ie=ae.segments;v.terrain&&v.terrain.setupElevationDraw(we,ie,re),v.prepareDrawProgram(B,ie,we.tileID.toUnwrapped()),ie.draw(B,j.TRIANGLES,$,X,K,o.CullFaceMode.disabled,be,p.id,Ae,Se,Ie,p.paint,v.transform.zoom,Pe)}},heatmap:function(v,l,p,x){if(p.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const E=v.context,A=E.gl,I=o.StencilMode.disabled,D=new o.ColorMode([A.ONE,A.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(B,j,$){const X=B.gl;B.activeTexture.set(X.TEXTURE1),B.viewport.set([0,0,j.width/4,j.height/4]);let K=$.heatmapFbo;if(K)X.bindTexture(X.TEXTURE_2D,K.colorAttachment.get()),B.bindFramebuffer.set(K.framebuffer);else{const se=X.createTexture();X.bindTexture(X.TEXTURE_2D,se),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),K=$.heatmapFbo=B.createFramebuffer(j.width/4,j.height/4,!1),function(re,ae,Pe,ie){const Ae=re.gl;Ae.texImage2D(Ae.TEXTURE_2D,0,Ae.RGBA,ae.width/4,ae.height/4,0,Ae.RGBA,re.extRenderToTextureHalfFloat?re.extTextureHalfFloat.HALF_FLOAT_OES:Ae.UNSIGNED_BYTE,null),ie.colorAttachment.set(Pe)}(B,j,se,K)}})(E,v,p),E.clear({color:o.Color.transparent});for(let B=0;B<x.length;B++){const j=x[B];if(l.hasRenderableParent(j))continue;const $=l.getTile(j),X=$.getBucket(p);if(!X)continue;const K=X.programConfigurations.get(p.id),se=v.useProgram("heatmap",K),{zoom:re}=v.transform;v.terrain&&v.terrain.setupElevationDraw($,se),v.prepareDrawProgram(E,se,j.toUnwrapped()),se.draw(E,A.TRIANGLES,o.DepthMode.disabled,I,D,o.CullFaceMode.disabled,z3(j.projMatrix,$,re,p.paint.get("heatmap-intensity")),p.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,p.paint,v.transform.zoom,K)}E.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(E,A){const I=E.context,D=I.gl,B=A.heatmapFbo;if(!B)return;I.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,B.colorAttachment.get()),I.activeTexture.set(D.TEXTURE1);let j=A.colorRampTexture;j||(j=A.colorRampTexture=new o.Texture(I,A.colorRamp,D.RGBA)),j.bind(D.LINEAR,D.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(I,D.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,E.colorModeForRenderPass(),o.CullFaceMode.disabled,(($,X,K,se)=>({u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}))(0,A),A.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,A.paint,E.transform.zoom)}(v,p))},line:function(v,l,p,x){if(v.renderPass!=="translucent")return;const E=p.paint.get("line-opacity"),A=p.paint.get("line-width");if(E.constantOr(1)===0||A.constantOr(1)===0)return;const I=v.depthModeForSublayer(0,o.DepthMode.ReadOnly),D=v.colorModeForRenderPass(),B=p.paint.get("line-dasharray"),j=B.constantOr(1),$=p.layout.get("line-cap"),X=p.paint.get("line-pattern"),K=X.constantOr(1),se=p.paint.get("line-gradient"),re=p.getCrossfadeParameters(),ae=K?"linePattern":"line",Pe=v.context,ie=Pe.gl,Ae=(be=>{const we=[];Qa(be)&&we.push("RENDER_LINE_DASH"),be.paint.get("line-gradient")&&we.push("RENDER_LINE_GRADIENT");const Ie=be.paint.get("line-pattern").constantOr(1),Ke=be.paint.get("line-opacity").constantOr(1)!==1;return!Ie&&Ke&&we.push("RENDER_LINE_ALPHA_DISCARD"),we})(p);let Se=Ae.includes("RENDER_LINE_ALPHA_DISCARD");v.terrain&&v.terrain.clipOrMaskOverlapStencilType()&&(Se=!1);for(const be of x){const we=l.getTile(be);if(K&&!we.patternsLoaded())continue;const Ie=we.getBucket(p);if(!Ie)continue;v.prepareDrawTile(be);const Ke=Ie.programConfigurations.get(p.id),st=v.useProgram(ae,Ke,Ae),It=X.constantOr(null);if(It&&we.imageAtlas){const dt=we.imageAtlas,nn=dt.patternPositions[It.to.toString()],hn=dt.patternPositions[It.from.toString()];nn&&hn&&Ke.setConstantPatternPositions(nn,hn)}const Et=B.constantOr(null),bt=$.constantOr(null);if(!K&&Et&&bt&&we.lineAtlas){const dt=we.lineAtlas,nn=dt.getDash(Et.to,bt),hn=dt.getDash(Et.from,bt);nn&&hn&&Ke.setConstantPatternPositions(nn,hn)}const ut=v.terrain?be.projMatrix:null,it=K?Ja(v,we,p,re,ut):Y0(v,we,p,re,ut,Ie.lineClipsArray.length);if(se){const dt=Ie.gradients[p.id];let nn=dt.texture;if(p.gradientVersion!==dt.version){let hn=256;if(p.stepInterpolant){const In=l.getSource().maxzoom,Rt=be.canonical.z===In?Math.ceil(1<<v.transform.maxZoom-be.canonical.z):1;hn=o.clamp(o.nextPowerOfTwo(Ie.maxLineLength/o.EXTENT*1024*Rt),256,Pe.maxTextureSize)}dt.gradient=o.renderColorRamp({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:hn,image:dt.gradient||void 0,clips:Ie.lineClipsArray}),dt.texture?dt.texture.update(dt.gradient):dt.texture=new o.Texture(Pe,dt.gradient,ie.RGBA),dt.version=p.gradientVersion,nn=dt.texture}Pe.activeTexture.set(ie.TEXTURE1),nn.bind(p.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}j&&(Pe.activeTexture.set(ie.TEXTURE0),we.lineAtlasTexture.bind(ie.LINEAR,ie.REPEAT),Ke.updatePaintBuffers(re)),K&&(Pe.activeTexture.set(ie.TEXTURE0),we.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),Ke.updatePaintBuffers(re)),v.prepareDrawProgram(Pe,st,be.toUnwrapped());const vt=dt=>{st.draw(Pe,ie.TRIANGLES,I,dt,D,o.CullFaceMode.disabled,it,p.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,p.paint,v.transform.zoom,Ke,Ie.layoutVertexBuffer2)};if(Se){const dt=v.stencilModeForClipping(be).ref;dt===0&&v.terrain&&Pe.clear({stencil:0});const nn={func:ie.EQUAL,mask:255};it.u_alpha_discard_threshold=.8,vt(new o.StencilMode(nn,dt,255,ie.KEEP,ie.KEEP,ie.INVERT)),it.u_alpha_discard_threshold=0,vt(new o.StencilMode(nn,dt,255,ie.KEEP,ie.KEEP,ie.KEEP))}else vt(v.stencilModeForClipping(be))}Se&&(v.resetStencilClippingMasks(),v.terrain&&Pe.clear({stencil:0}))},fill:function(v,l,p,x){const E=p.paint.get("fill-color"),A=p.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const I=v.colorModeForRenderPass(),D=p.paint.get("fill-pattern"),B=v.opaquePassEnabledForLayer()&&!D.constantOr(1)&&E.constantOr(o.Color.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===B){const j=v.depthModeForSublayer(1,v.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);L1(v,l,p,x,j,I,!1)}if(v.renderPass==="translucent"&&p.paint.get("fill-antialias")){const j=v.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);L1(v,l,p,x,j,I,!0)}},"fill-extrusion":function(v,l,p,x){const E=p.paint.get("fill-extrusion-opacity");if(E!==0&&v.renderPass==="translucent"){const A=new o.DepthMode(v.context.gl.LEQUAL,o.DepthMode.ReadWrite,v.depthRangeFor3D);if(E!==1||p.paint.get("fill-extrusion-pattern").constantOr(1))Wl(v,l,p,x,A,o.StencilMode.disabled,o.ColorMode.disabled),Wl(v,l,p,x,A,v.stencilModeFor3D(),v.colorModeForRenderPass()),v.resetStencilClippingMasks();else{const I=v.colorModeForRenderPass();Wl(v,l,p,x,A,o.StencilMode.disabled,I)}}},hillshade:function(v,l,p,x){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const E=v.context,A=v.depthModeForSublayer(0,o.DepthMode.ReadOnly),I=v.colorModeForRenderPass(),D=v.terrain&&v.terrain.renderingToTexture,[B,j]=v.renderPass!=="translucent"||D?[{},x]:v.stencilConfigForOverlap(x);for(const $ of j){const X=l.getTile($);if(X.needsHillshadePrepare&&v.renderPass==="offscreen")Ga(v,X,p,A,o.StencilMode.disabled,I);else if(v.renderPass==="translucent"){const K=D&&v.terrain?v.terrain.stencilModeForRTTOverlap($):B[$.overscaledZ];Ac(v,$,X,p,A,K,I)}}E.viewport.set([0,0,v.width,v.height]),v.resetStencilClippingMasks()},raster:function(v,l,p,x,E,A){if(v.renderPass!=="translucent"||p.paint.get("raster-opacity")===0||!x.length)return;const I=v.context,D=I.gl,B=l.getSource(),j=v.useProgram("raster"),$=v.colorModeForRenderPass(),X=v.terrain&&v.terrain.renderingToTexture,[K,se]=B instanceof ii||X?[{},x]:v.stencilConfigForOverlap(x),re=se[se.length-1].overscaledZ,ae=!v.options.moving;for(const Pe of se){const ie=X?o.DepthMode.disabled:v.depthModeForSublayer(Pe.overscaledZ-re,p.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,D.LESS),Ae=Pe.toUnwrapped(),Se=l.getTile(Pe);if(X&&(!Se||!Se.hasData()))continue;const be=X?Pe.projMatrix:v.transform.calculateProjMatrix(Ae,ae),we=v.terrain&&X?v.terrain.stencilModeForRTTOverlap(Pe):K[Pe.overscaledZ],Ie=A?0:p.paint.get("raster-fade-duration");Se.registerFadeDuration(Ie);const Ke=l.findLoadedParent(Pe,0),st=Ka(Se,Ke,l,v.transform,Ie);let It,Et;v.terrain&&v.terrain.prepareDrawTile(Pe);const bt=p.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;I.activeTexture.set(D.TEXTURE0),Se.texture.bind(bt,D.CLAMP_TO_EDGE),I.activeTexture.set(D.TEXTURE1),Ke?(Ke.texture.bind(bt,D.CLAMP_TO_EDGE),It=Math.pow(2,Ke.tileID.overscaledZ-Se.tileID.overscaledZ),Et=[Se.tileID.canonical.x*It%1,Se.tileID.canonical.y*It%1]):Se.texture.bind(bt,D.CLAMP_TO_EDGE);const ut=Pc(be,Et||[0,0],It||1,st,p,B instanceof ii?B.perspectiveTransform:[0,0]);if(v.prepareDrawProgram(I,j,Ae),B instanceof ii)j.draw(I,D.TRIANGLES,ie,o.StencilMode.disabled,$,o.CullFaceMode.disabled,ut,p.id,B.boundsBuffer,v.quadTriangleIndexBuffer,B.boundsSegments);else{const{tileBoundsBuffer:it,tileBoundsIndexBuffer:vt,tileBoundsSegments:dt}=v.getTileBoundsBuffers(Se);j.draw(I,D.TRIANGLES,ie,we,$,o.CullFaceMode.disabled,ut,p.id,it,vt,dt)}}v.resetStencilClippingMasks()},background:function(v,l,p,x){const E=p.paint.get("background-color"),A=p.paint.get("background-opacity");if(A===0)return;const I=v.context,D=I.gl,B=v.transform,j=B.tileSize,$=p.paint.get("background-pattern");if(v.isPatternMissing($))return;const X=!$&&E.a===1&&A===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==X)return;const K=o.StencilMode.disabled,se=v.depthModeForSublayer(0,X==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),re=v.colorModeForRenderPass(),ae=v.useProgram($?"backgroundPattern":"background");let Pe,ie=x;ie||(Pe=v.getBackgroundTiles(),ie=Object.values(Pe).map(Se=>Se.tileID)),$&&(I.activeTexture.set(D.TEXTURE0),v.imageManager.bind(v.context));const Ae=p.getCrossfadeParameters();for(const Se of ie){const be=Se.toUnwrapped(),we=x?Se.projMatrix:v.transform.calculateProjMatrix(be);v.prepareDrawTile(Se);const Ie=l?l.getTile(Se):Pe?Pe[Se.key]:new o.Tile(Se,j,B.zoom,v),Ke=$?Rc(we,A,v,$,{tileID:Se,tileSize:j},Ae):rr(we,A,E);v.prepareDrawProgram(I,ae,be);const{tileBoundsBuffer:st,tileBoundsIndexBuffer:It,tileBoundsSegments:Et}=v.getTileBoundsBuffers(Ie);ae.draw(I,D.TRIANGLES,se,K,re,o.CullFaceMode.disabled,Ke,p.id,st,It,Et)}},sky:function(v,l,p){const x=v.transform,E=x.projection.name==="mercator"||x.projection.name==="globe"?1:o.smoothstep(7,8,x.zoom),A=p.paint.get("sky-opacity")*E;if(A===0)return;const I=v.context,D=p.paint.get("sky-type"),B=new o.DepthMode(I.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),j=v.frameCounter/1e3%1;D==="atmosphere"?v.renderPass==="offscreen"?p.needsSkyboxCapture(v)&&(function($,X,K,se){const re=$.context,ae=re.gl;let Pe=X.skyboxFbo;if(!Pe){Pe=X.skyboxFbo=re.createFramebuffer(32,32,!1),X.skyboxGeometry=new Xl(re),X.skyboxTexture=re.gl.createTexture(),ae.bindTexture(ae.TEXTURE_CUBE_MAP,X.skyboxTexture),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MAG_FILTER,ae.LINEAR);for(let be=0;be<6;++be)ae.texImage2D(ae.TEXTURE_CUBE_MAP_POSITIVE_X+be,0,ae.RGBA,32,32,0,ae.RGBA,ae.UNSIGNED_BYTE,null)}re.bindFramebuffer.set(Pe.framebuffer),re.viewport.set([0,0,32,32]);const ie=X.getCenter($,!0),Ae=$.useProgram("skyboxCapture"),Se=new Float64Array(16);o.identity(Se),o.rotateY(Se,Se,.5*-Math.PI),Po(re,X,Ae,Se,ie,0),o.identity(Se),o.rotateY(Se,Se,.5*Math.PI),Po(re,X,Ae,Se,ie,1),o.identity(Se),o.rotateX(Se,Se,.5*-Math.PI),Po(re,X,Ae,Se,ie,2),o.identity(Se),o.rotateX(Se,Se,.5*Math.PI),Po(re,X,Ae,Se,ie,3),o.identity(Se),Po(re,X,Ae,Se,ie,4),o.identity(Se),o.rotateY(Se,Se,Math.PI),Po(re,X,Ae,Se,ie,5),re.viewport.set([0,0,$.width,$.height])}(v,p),p.markSkyboxValid(v)):v.renderPass==="sky"&&function($,X,K,se,re){const ae=$.context,Pe=ae.gl,ie=$.transform,Ae=$.useProgram("skybox");ae.activeTexture.set(Pe.TEXTURE0),Pe.bindTexture(Pe.TEXTURE_CUBE_MAP,X.skyboxTexture);const Se=((be,we,Ie,Ke,st)=>({u_matrix:be,u_sun_direction:we,u_cubemap:0,u_opacity:Ke,u_temporal_offset:st}))(ie.skyboxMatrix,X.getCenter($,!1),0,se,re);$.prepareDrawProgram(ae,Ae),Ae.draw(ae,Pe.TRIANGLES,K,o.StencilMode.disabled,$.colorModeForRenderPass(),o.CullFaceMode.backCW,Se,"skybox",X.skyboxGeometry.vertexBuffer,X.skyboxGeometry.indexBuffer,X.skyboxGeometry.segment)}(v,p,B,A,j):D==="gradient"&&v.renderPass==="sky"&&function($,X,K,se,re){const ae=$.context,Pe=ae.gl,ie=$.transform,Ae=$.useProgram("skyboxGradient");X.skyboxGeometry||(X.skyboxGeometry=new Xl(ae)),ae.activeTexture.set(Pe.TEXTURE0);let Se=X.colorRampTexture;Se||(Se=X.colorRampTexture=new o.Texture(ae,X.colorRamp,Pe.RGBA)),Se.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE);const be=((we,Ie,Ke,st,It)=>({u_matrix:we,u_color_ramp:0,u_center_direction:Ie,u_radius:o.degToRad(Ke),u_opacity:st,u_temporal_offset:It}))(ie.skyboxMatrix,X.getCenter($,!1),X.paint.get("sky-gradient-radius"),se,re);$.prepareDrawProgram(ae,Ae),Ae.draw(ae,Pe.TRIANGLES,K,o.StencilMode.disabled,$.colorModeForRenderPass(),o.CullFaceMode.backCW,be,"skyboxGradient",X.skyboxGeometry.vertexBuffer,X.skyboxGeometry.indexBuffer,X.skyboxGeometry.segment)}(v,p,B,A,j)},debug:function(v,l,p){for(let x=0;x<p.length;x++)Dc(v,l,p[x])},custom:function(v,l,p){const x=v.context,E=p.implementation;if(v.transform.projection.unsupportedLayers&&v.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(v.renderPass==="offscreen"){const A=E.prerender;A&&(v.setCustomLayerDefaults(),x.setColorMode(v.colorModeForRenderPass()),A.call(E,x.gl,v.transform.customLayerMatrix()),x.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),x.setColorMode(v.colorModeForRenderPass()),x.setStencilMode(o.StencilMode.disabled);const A=E.renderingMode==="3d"?new o.DepthMode(v.context.gl.LEQUAL,o.DepthMode.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,o.DepthMode.ReadOnly);x.setDepthMode(A),E.render(x.gl,v.transform.customLayerMatrix()),x.setDirty(),v.setBaseState(),x.bindFramebuffer.set(null)}}};class W3{constructor(l,p){this.context=new Zi(l),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new So,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,p){const x=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(x||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Co(this,l));const E=this._terrain;this.transform.elevation=x?E:null,E.update(l,this.transform,p)}_updateFog(l){const p=l.fog;if(!p||p.getOpacity(this.transform.pitch)<1||p.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[x,E]=p.getFovAdjustedRange(this.transform._fov);if(x>E)return void(this.transform.fogCullDistSq=null);const A=x+.78*(E-x);this.transform.fogCullDistSq=A*A}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,p){if(this.width=l*o.exported.devicePixelRatio,this.height=p*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style.order)this.style._layers[x].resize()}setup(){const l=this.context,p=new o.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(o.EXTENT,0),p.emplaceBack(0,o.EXTENT),p.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(p,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const x=new o.StructArrayLayout2i4;x.emplaceBack(0,0),x.emplaceBack(o.EXTENT,0),x.emplaceBack(0,o.EXTENT),x.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=l.createVertexBuffer(x,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const E=new o.StructArrayLayout2i4;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(-1,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const A=new o.StructArrayLayout4i8;A.emplaceBack(0,0,0,0),A.emplaceBack(o.EXTENT,0,o.EXTENT,0),A.emplaceBack(0,o.EXTENT,0,o.EXTENT),A.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(A,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const I=new o.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(I);const D=new o.StructArrayLayout1ui2;for(const j of[0,1,3,2,0])D.emplaceBack(j);this.debugIndexBuffer=l.createIndexBuffer(D),this.emptyTexture=new o.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA),this.identityMat=o.create();const B=this.context.gl;this.stencilClearMode=new o.StencilMode({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(o.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context,p=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(l,p.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Wr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,p,x){if(!p||this.currentStencilSource===p.id||!l.isTileClipped()||!x||x.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(const B of x)if(this._tileClippingMaskIDs[B.key]===void 0){D=!0;break}if(!D)return}this.currentStencilSource=p.id;const E=this.context,A=E.gl;this.nextStencilID+x.length>256&&this.clearStencil(),E.setColorMode(o.ColorMode.disabled),E.setDepthMode(o.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of x){const B=p.getTile(D),j=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:$,tileBoundsIndexBuffer:X,tileBoundsSegments:K}=this.getTileBoundsBuffers(B);I.draw(E,A.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:A.ALWAYS,mask:0},j,255,A.KEEP,A.KEEP,A.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Wr(D.projMatrix),"$clipping",$,X,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,p=this.context.gl;return new o.StencilMode({func:p.NOTEQUAL,mask:255},l,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const p=this.context.gl;return new o.StencilMode({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(l){const p=this.context.gl,x=l.sort((I,D)=>D.overscaledZ-I.overscaledZ),E=x[x.length-1].overscaledZ,A=x[0].overscaledZ-E+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const I={};for(let D=0;D<A;D++)I[D+E]=new o.StencilMode({func:p.GEQUAL,mask:255},D+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=A,[I,x]}return[{[E]:o.StencilMode.disabled},x]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([l.CONSTANT_COLOR,l.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(l,p,x){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const E=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new o.DepthMode(x||this.context.gl.LEQUAL,p,[E,E])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,p){this.style=l,this.options=p,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const x=this.style.order,E=this.style._sourceCaches;for(const j in E){const $=E[j];$.used&&$.prepare(this.context)}const A={},I={},D={};for(const j in E){const $=E[j];A[j]=$.getVisibleCoordinates(),I[j]=A[j].slice().reverse(),D[j]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let j=0;j<x.length;j++)if(this.style._layers[x[j]].is3D()){this.opaquePassCutoff=j;break}if(this.terrain&&(this.terrain.updateTileBinding(D),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const j of x){const $=this.style._layers[j],X=l._getLayerSourceCache($);if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const K=X?I[X.id]:void 0;($.type==="custom"||$.isSky()||K&&K.length)&&this.renderLayer(this,X,$,K)}this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let B=o.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(B=this.style.fog.properties.get("color")),this.context.clear({color:p.showOverdrawInspector?o.Color.black:B,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const j=this.style._layers[x[this.currentLayer]],$=l._getLayerSourceCache(j);if(j.isSky())continue;const X=$?I[$.id]:void 0;this._renderTileClippingMasks(j,$,X),this.renderLayer(this,$,j,X)}if(this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const j=this.style._layers[x[this.currentLayer]],$=l._getLayerSourceCache(j);j.isSky()&&this.renderLayer(this,$,j,$?I[$.id]:void 0)}for(this.transform.projection.name==="globe"&&function(j){const $=j.context,X=$.gl,K=j.transform,se=new o.DepthMode(X.LEQUAL,o.DepthMode.ReadOnly,[0,1]),re=j.useProgram("globeAtmosphere"),ae=K._camera.getWorldToCamera(K.worldSize,1),Pe=K._camera.getCameraToClipPerspective(K._fov,K.width/K.height,K._nearZ,K._farZ),ie=o.mul([],ae,o.calculateGlobeMatrix(K,K.worldSize)),Ae=o.mul([],K.labelPlaneMatrix,Pe),Se=o.transformMat4([],[0,0,0],ie),be=o.add([],Se,[K.worldSize/Math.PI/2,0,0]),we=o.transformMat4([],Se,Ae),Ie=o.transformMat4([],be,Ae),Ke=o.length(o.sub([],Ie,we)),st=1-o.globeToMercatorTransition(K.zoom),It={u_center:we,u_radius:Ke,u_screen_size:[K.width,K.height],u_pixel_ratio:o.exported.devicePixelRatio,u_opacity:st,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};j.prepareDrawProgram($,re);const Et=j.globeSharedBuffers;Et&&re.draw($,X.TRIANGLES,se,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,It,"skybox",Et.atmosphereVertexBuffer,Et.atmosphereIndexBuffer,Et.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;){const j=this.style._layers[x[this.currentLayer]],$=l._getLayerSourceCache(j);if(j.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(j)){if(j.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const X=$?(j.type==="symbol"?D:I)[$.id]:void 0;this._renderTileClippingMasks(j,$,$?A[$.id]:void 0),this.renderLayer(this,$,j,X),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let j=null;o.values(this.style._layers).forEach($=>{const X=l._getLayerSourceCache($);X&&!$.isHidden(this.transform.zoom)&&(!j||j.getSource().maxzoom<X.getSource().maxzoom)&&(j=X)}),j&&this.options.showTileBoundaries&&Zl.debug(this,j,j.getVisibleCoordinates())}this.options.showPadding&&function(j){const $=j.transform.padding;Qi(j,j.transform.height-($.top||0),3,el),Qi(j,$.bottom||0,3,mu),ya(j,$.left||0,3,F1),ya(j,j.transform.width-($.right||0),3,N1);const X=j.transform.centerPoint;(function(K,se,re,ae){ao(K,se-1,re-10,2,20,ae),ao(K,se-10,re-1,20,2,ae)})(j,X.x,j.transform.height-X.y,j3)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(l,p,x,E){x.isHidden(this.transform.zoom)||(x.type==="background"||x.type==="sky"||x.type==="custom"||E&&E.length)&&(this.id=x.id,this.gpuTimingStart(x),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(x.type)||Zl[x.type](l,p,x,E,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const p=this.context.extTimerQuery;let x=this.gpuTimers[l.id];x||(x=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:p.createQueryEXT()}),x.calls++,p.beginQueryEXT(p.TIME_ELAPSED_EXT,x.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}queryGpuTimers(l){const p={};for(const x in l){const E=l[x],A=this.context.extTimerQuery,I=A.getQueryObjectEXT(E.query,A.QUERY_RESULT_EXT)/1e6;A.deleteQueryEXT(E.query),p[x]=I}return p}translatePosMatrix(l,p,x,E,A){if(!x[0]&&!x[1])return l;const I=A?E==="map"?this.transform.angle:0:E==="viewport"?-this.transform.angle:0;if(I){const j=Math.sin(I),$=Math.cos(I);x=[x[0]*$-x[1]*j,x[0]*j+x[1]*$]}const D=[A?x[0]:ve(p,x[0],this.transform.zoom),A?x[1]:ve(p,x[1],this.transform.zoom),0],B=new Float32Array(16);return o.translate(B,l,D),B}saveTileTexture(l){const p=this._tileTextures[l.size[0]];p?p.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const p=this._tileTextures[l];return p&&p.length>0?p.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const p=this.imageManager.getPattern(l.from.toString()),x=this.imageManager.getPattern(l.to.toString());return!p||!x}currentGlobalDefines(){const l=this.terrain&&this.terrain.renderingToTexture,p=this.style&&this.style.fog,x=[];return this.terrain&&!this.terrain.renderingToTexture&&x.push("TERRAIN"),p&&!l&&p.getOpacity(this.transform.pitch)!==0&&x.push("FOG"),l&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(l,p,x){this.cache=this.cache||{};const E=x||[],A=this.currentGlobalDefines().concat(E),I=Qo.cacheKey(l,A,p);return this.cache[I]||(this.cache[I]=new Qo(this.context,l,k3[l],p,K0[l],A)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(l){this.terrain&&this.terrain.prepareDrawTile(l)}prepareDrawProgram(l,p,x){if(this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const A=E.getOpacity(this.transform.pitch);A!==0&&p.setFogUniformValues(l,((I,D,B,j)=>{const $=D.properties.get("color"),X=I.frameCounter/1e3%1,K=[$.r/$.a,$.g/$.a,$.b/$.a,j];return{u_fog_matrix:B?I.transform.calculateFogTileMatrix(B):I.identityMat,u_fog_range:D.getFovAdjustedRange(I.transform._fov),u_fog_color:K,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_temporal_offset:X}})(this,E,x,A))}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const l=this.context.gl,p=l.createTexture();return l.bindTexture(l.TEXTURE_2D,p),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),p}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,p=this._backgroundTiles={},x=this.transform.coveringTiles({tileSize:512});for(const E of x)p[E.key]=l[E.key]||new o.Tile(E,512,this.transform.tileZoom,this);return p}clearBackgroundTiles(){this._backgroundTiles={}}}class B1{constructor(l=0,p=0,x=0,E=0){if(isNaN(l)||l<0||isNaN(p)||p<0||isNaN(x)||x<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=p,this.left=x,this.right=E}interpolate(l,p,x){return p.top!=null&&l.top!=null&&(this.top=o.number(l.top,p.top,x)),p.bottom!=null&&l.bottom!=null&&(this.bottom=o.number(l.bottom,p.bottom,x)),p.left!=null&&l.left!=null&&(this.left=o.number(l.left,p.left,x)),p.right!=null&&l.right!=null&&(this.right=o.number(l.right,p.right,x)),this}getCenter(l,p){const x=o.clamp((this.left+l-this.right)/2,0,l),E=o.clamp((this.top+p-this.bottom)/2,0,p);return new o.pointGeometry(x,E)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new B1(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function va(v,l){const p=o.getColumn(v,3);o.fromQuat(v,l),o.setColumn(v,3,p)}function J0(v,l){o.setColumn(v,3,[l[0],l[1],l[2],1])}function H3(v,l){const p=o.identity$1([]);return o.rotateZ$1(p,p,-l),o.rotateX$1(p,p,-v),p}function X3(v,l){const p=[v[0],v[1],0],x=[l[0],l[1],0];if(o.length(p)>=1e-15){const I=o.normalize([],p);o.scale$2(x,I,o.dot(x,I)),l[0]=x[0],l[1]=x[1]}const E=o.cross([],l,v);if(o.len(E)<1e-15)return null;const A=Math.atan2(-E[1],E[0]);return H3(Math.atan2(Math.sqrt(v[0]*v[0]+v[1]*v[1]),-v[2]),A)}class Q0{constructor(l,p){this.position=l,this.orientation=p}get position(){return this._position}set position(l){this._position=this._renderWorldCopies?function(p){if(!p)return;const x=Array.isArray(p)?new o.MercatorCoordinate(p[0],p[1],p[2]):p;return x.x=o.wrap(x.x,0,1),x}(l):l}lookAtPoint(l,p){if(this.orientation=null,!this.position)return;const x=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(l)):0,E=this.position,A=o.MercatorCoordinate.fromLngLat(l,x),I=[A.x-E.x,A.y-E.y,A.z-E.z];p||(p=[0,0,1]),p[2]=Math.abs(p[2]),this.orientation=X3(I,p)}setPitchBearing(l,p){this.orientation=H3(o.degToRad(l),o.degToRad(-p))}}class us{constructor(l,p){this._transform=o.identity([]),this._orientation=o.identity$1([]),p&&(this._orientation=p,va(this._transform,this._orientation)),l&&J0(this._transform,l)}get mercatorPosition(){const l=this.position;return new o.MercatorCoordinate(l[0],l[1],l[2])}get position(){const l=o.getColumn(this._transform,3);return[l[0],l[1],l[2]]}set position(l){J0(this._transform,l)}get orientation(){return this._orientation}set orientation(l){this._orientation=l,va(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),p=this.right();return{bearing:Math.atan2(-p[1],p[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,p){this._orientation=H3(l,p),va(this._transform,this._orientation)}forward(){const l=o.getColumn(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=o.getColumn(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=o.getColumn(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,p){const x=new Float64Array(16);return o.invert(x,this.getWorldToCamera(l,p)),x}getWorldToCameraPosition(l,p,x){const E=this.position;o.scale$2(E,E,-l);const A=new Float64Array(16);return o.fromScaling(A,[x,x,x]),o.translate(A,A,E),A[10]*=p,A}getWorldToCamera(l,p){const x=new Float64Array(16),E=new Float64Array(4),A=this.position;return o.conjugate(E,this._orientation),o.scale$2(A,A,-l),o.fromQuat(x,E),o.translate(x,x,A),x[1]*=-1,x[5]*=-1,x[9]*=-1,x[13]*=-1,x[8]*=p,x[9]*=p,x[10]*=p,x[11]*=p,x}getCameraToClipPerspective(l,p,x,E){const A=new Float64Array(16);return o.perspective(A,l,p,x,E),A}getDistanceToElevation(l){const p=l===0?0:o.mercatorZfromAltitude(l,this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new us([...this.position],[...this.orientation])}}function e4(v,l){const p=z1(v),x=function(A,I,D,B,j){const $=new o.LngLat(D.lng-180*zs,D.lat),X=new o.LngLat(D.lng+180*zs,D.lat),K=A.project($.lng,$.lat),se=A.project(X.lng,X.lat),re=-Math.atan2(se.y-K.y,se.x-K.x),ae=o.MercatorCoordinate.fromLngLat(D);ae.y=o.clamp(ae.y,-.999975,.999975);const Pe=ae.toLngLat(),ie=A.project(Pe.lng,Pe.lat),Ae=o.MercatorCoordinate.fromLngLat(Pe);Ae.x+=zs;const Se=Ae.toLngLat(),be=A.project(Se.lng,Se.lat),we=Fc(be.x-ie.x,be.y-ie.y,re),Ie=o.MercatorCoordinate.fromLngLat(Pe);Ie.y+=zs;const Ke=Ie.toLngLat(),st=A.project(Ke.lng,Ke.lat),It=Fc(st.x-ie.x,st.y-ie.y,re),Et=Math.abs(we.x)/Math.abs(It.y),bt=o.identity([]);o.rotateZ(bt,bt,-re*(1-(j?0:B)));const ut=o.identity([]);return o.scale(ut,ut,[1,1-(1-Et)*B,1]),ut[4]=-It.x/It.y*B,o.rotateZ(ut,ut,re),o.multiply$1(ut,bt,ut),ut}(v.projection,0,v.center,p,l),E=xa(v);return o.scale(x,x,[E,E,1]),x}function xa(v){const l=v.projection,p=z1(v),x=Lc(l,v.center),E=Lc(l,o.LngLat.convert(l.center));return Math.pow(2,x*p+(1-p)*E)}function z1(v){const l=v.projection.range;if(!l)return 0;const p=Math.max(v.width,v.height),x=Math.log(p/1024)/Math.LN2;return o.smoothstep(l[0]+x,l[1]+x,v.zoom)}const zs=1/4e4;function Lc(v,l){const p=o.clamp(l.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),x=new o.LngLat(l.lng-180*zs,p),E=new o.LngLat(l.lng+180*zs,p),A=v.project(x.lng,p),I=v.project(E.lng,p),D=o.MercatorCoordinate.fromLngLat(x),B=o.MercatorCoordinate.fromLngLat(E),j=I.x-A.x,$=I.y-A.y,X=B.x-D.x,K=B.y-D.y,se=Math.sqrt((X*X+K*K)/(j*j+$*$));return Math.log(se)/Math.LN2}function Fc(v,l,p){const x=Math.cos(p),E=Math.sin(p);return{x:v*x-l*E,y:v*E+l*x}}class tl{constructor(l,p,x,E,A){this.tileSize=512,this._renderWorldCopies=A===void 0||A,this._minZoom=l||0,this._maxZoom=p||22,this._minPitch=x??0,this._maxPitch=E??60,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new B1,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new us,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const l=new tl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.setProjection(this.getProjection()),l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l.tileSize=this.tileSize,l.setMaxBounds(this.getMaxBounds()),l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._cameraZoom=this._cameraZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,l?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(l){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),l&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(l){l==null&&(l={name:"mercator"}),this.projectionOptions=l;const p=this.projection?this.getProjection():void 0;return this.projection=o.getProjection(l),!U(p,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const p=-l*Math.PI/180;var x;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=(x=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x),function(E,A,I){var D=A[0],B=A[1],j=A[2],$=A[3],X=Math.sin(I),K=Math.cos(I);E[0]=D*K+j*X,E[1]=B*K+$*X,E[2]=D*-X+j*K,E[3]=B*-X+$*K}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const p=o.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(l){const p=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._setZoom(p),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return l===-1?(this._cameraZoom=null,!1):(this._centerAltitude=l,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,p=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],x=this.horizonLineFromTop();let E=0,A=0;for(let I=0;I<p.length;I++){const D=new o.pointGeometry(p[I][0]*this.width,x+p[I][1]*(this.height-x)),B=l.pointCoordinate(D);if(!B)continue;const j=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);E+=B[3]*j,A+=j}return A===0?NaN:E/A}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const l=this._cameraZoom,p=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),x=this.pixelsPerMeter/this.worldSize*p,E=this._mercatorZfromZoom(l),A=this._mercatorZfromZoom(this._maxZoom),I=Math.max(E-x,A);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const p=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let x;x=l.z<this._camera.position[2]?[p.x,p.y,p.z]:[l.x,l.y,l.z];const E=o.length(o.sub([],this._camera.position,x));return o.clamp(this._zoomFromMercatorZ(E),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let p=!1;if(l.orientation&&!o.exactEquals(l.orientation,this._camera.orientation)&&(p=this._setCameraOrientation(l.orientation)),l.position){const x=[l.position.x,l.position.y,l.position.z];o.exactEquals$1(x,this._camera.position)||(this._setCameraPosition(x),p=!0)}p&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,p=new Q0;return p.position=new o.MercatorCoordinate(l[0],l[1],l[2]),p.orientation=this._camera.orientation,p._elevation=this.elevation,p._renderWorldCopies=this.renderWorldCopies,p}_setCameraOrientation(l){if(!o.length$1(l))return!1;o.normalize$1(l,l);const p=o.transformQuat([],[0,0,-1],l),x=o.transformQuat([],[0,-1,0],l);if(x[2]<0)return!1;const E=X3(p,x);return!!E&&(this._camera.orientation=E,!0)}_setCameraPosition(l){const p=this.zoomScale(this.minZoom)*this.tileSize,x=this.zoomScale(this.maxZoom)*this.tileSize,E=this.cameraToCenterDistance;l[2]=o.clamp(l[2],E/x,E/p),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,p,x){this._unmodified=!1,this._edgeInsets.interpolate(l,p,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const p=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(l){const p=[new o.UnwrappedTileID(0,l)];if(this.renderWorldCopies){const x=this.pointCoordinate(new o.pointGeometry(0,0)),E=this.pointCoordinate(new o.pointGeometry(this.width,0)),A=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),I=this.pointCoordinate(new o.pointGeometry(0,this.height)),D=Math.floor(Math.min(x.x,E.x,A.x,I.x)),B=Math.floor(Math.max(x.x,E.x,A.x,I.x)),j=1;for(let $=D-j;$<=B+j;$++)$!==0&&p.push(new o.UnwrappedTileID($,l))}return p}coveringTiles(l){let p=this.coveringZoomLevel(l);const x=p,E=this.elevation&&!l.isTerrainDEM,A=this.projection.name==="mercator";if(l.minzoom!==void 0&&p<l.minzoom)return[];l.maxzoom!==void 0&&p>l.maxzoom&&(p=l.maxzoom);const I=this.locationCoordinate(this.center),D=1<<p,B=[D*I.x,D*I.y,0],j=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p,this.projection.name!=="globe"),$=this.pointCoordinate(this.getCameraPoint()),X=D*o.mercatorZfromAltitude(1,this.center.lat),K=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),se=[D*$.x,D*$.y,K],re=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),ae=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?p:0,Pe=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ie=l.isTerrainDEM?-Pe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ae=this.projection.isReprojectedInTileSpace?xa(this):1,Se=it=>{const dt=new o.MercatorCoordinate(it.x+25e-6,it.y,it.z),nn=new o.MercatorCoordinate(it.x,it.y+25e-6,it.z),hn=it.toLngLat(),In=dt.toLngLat(),Rt=nn.toLngLat(),sn=this.locationCoordinate(hn),_n=this.locationCoordinate(In),Jn=this.locationCoordinate(Rt),hr=Math.hypot(_n.x-sn.x,_n.y-sn.y),mn=Math.hypot(Jn.x-sn.x,Jn.y-sn.y);return Math.sqrt(hr*mn)*Ae/25e-6},be=it=>{const vt=Pe,dt=ie;return{aabb:o.tileAABB(this,D,0,0,0,it,dt,vt,this.projection),zoom:0,x:0,y:0,minZ:dt,maxZ:vt,wrap:it,fullyVisible:!1}},we=[];let Ie=[];const Ke=p,st=l.reparseOverscaled?x:p,It=it=>it*it,Et=It((K-this._centerAltitude)*X),bt=it=>{if(!this._elevation||!it.tileID||!A)return;const vt=this._elevation.getMinMaxForTile(it.tileID),dt=it.aabb;vt?(dt.min[2]=vt.min,dt.max[2]=vt.max,dt.center[2]=(dt.min[2]+dt.max[2])/2):(it.shouldSplit=ut(it),it.shouldSplit||(dt.min[2]=dt.max[2]=dt.center[2]=this._centerAltitude))},ut=it=>{if(it.zoom<ae)return!0;if(it.zoom===Ke)return!1;if(it.shouldSplit!=null)return it.shouldSplit;const vt=it.aabb.distanceX(se),dt=it.aabb.distanceY(se);let nn=Et;E&&(nn=It(it.aabb.distanceZ(se)*X));let hn=1;if(this.projection.isReprojectedInTileSpace&&x<=5){const Rt=Math.pow(2,it.zoom),sn=Se(new o.MercatorCoordinate((it.x+.5)/Rt,(it.y+.5)/Rt));hn=sn>.85?1:sn}const In=vt*vt+dt*dt+nn;return In<It((1<<Ke-it.zoom)*re*hn*((Rt,sn)=>{if(sn*It(.707)<Rt)return 1;const _n=Math.sqrt(sn/Rt);return _n/(1.4144271570014144+(Math.pow(1.1,_n-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(nn,Et),In))};if(this.renderWorldCopies)for(let it=1;it<=3;it++)we.push(be(-it)),we.push(be(it));for(we.push(be(0));we.length>0;){const it=we.pop(),vt=it.x,dt=it.y;let nn=it.fullyVisible;if(!nn){const hn=it.aabb.intersects(j);if(hn===0)continue;nn=hn===2}if(it.zoom!==Ke&&ut(it))for(let hn=0;hn<4;hn++){const In=(vt<<1)+hn%2,Rt=(dt<<1)+(hn>>1),sn={aabb:A?it.aabb.quadrant(hn):o.tileAABB(this,D,it.zoom+1,In,Rt,it.wrap,it.minZ,it.maxZ,this.projection),zoom:it.zoom+1,x:In,y:Rt,wrap:it.wrap,fullyVisible:nn,tileID:void 0,shouldSplit:void 0,minZ:it.minZ,maxZ:it.maxZ};E&&(sn.tileID=new o.OverscaledTileID(it.zoom+1===Ke?st:it.zoom+1,it.wrap,it.zoom+1,In,Rt),bt(sn)),we.push(sn)}else{const hn=it.zoom===Ke?st:it.zoom;if(l.minzoom&&l.minzoom>hn)continue;const In=B[0]-(.5+vt+(it.wrap<<it.zoom))*(1<<p-it.zoom),Rt=B[1]-.5-dt,sn=it.tileID?it.tileID:new o.OverscaledTileID(hn,it.wrap,it.zoom,vt,dt);Ie.push({tileID:sn,distanceSq:In*In+Rt*Rt})}}if(this.fogCullDistSq){const it=this.fogCullDistSq,vt=this.horizonLineFromTop();Ie=Ie.filter(dt=>{const nn=[0,0,0,1],hn=[o.EXTENT,o.EXTENT,0,1],In=this.calculateFogTileMatrix(dt.tileID.toUnwrapped());o.transformMat4$1(nn,nn,In),o.transformMat4$1(hn,hn,In);const Rt=o.getAABBPointSquareDist(nn,hn);if(Rt===0)return!0;let sn=!1;const _n=this._elevation;if(_n&&Rt>it&&vt!==0){const Jn=this.calculateProjMatrix(dt.tileID.toUnwrapped());let hr;l.isTerrainDEM||(hr=_n.getMinMaxForTile(dt.tileID)),hr||(hr={min:ie,max:Pe});const mn=o.furthestTileCorner(this.rotation),Nn=[mn[0]*o.EXTENT,mn[1]*o.EXTENT,hr.max];o.transformMat4(Nn,Nn,Jn),sn=(1-Nn[1])*this.height*.5<vt}return Rt<it||sn})}return Ie.sort((it,vt)=>it.distanceSq-vt.distanceSq).map(it=>it.tileID)}resize(l,p){this.width=l,this.height=p,this.pixelsToGLUnits=[2/l,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const p=o.clamp(l.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),x=this.projection.project(l.lng,p);return new o.pointGeometry(x.x*this.worldSize,x.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(l,p){const x=this.pointCoordinate(p),E=this.pointCoordinate(this.centerPoint),A=this.locationCoordinate(l);this.setLocation(new o.MercatorCoordinate(A.x-(x.x-E.x),A.y-(x.y-E.y)))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this._coordinatePoint(this.locationCoordinate(l),!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,p){const x=p?o.mercatorZfromAltitude(p,l.lat):void 0,E=this.projection.project(l.lng,l.lat);return new o.MercatorCoordinate(E.x,E.y,x)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,p){const x=p??this._centerAltitude,E=[l.x,l.y,0,1],A=[l.x,l.y,1,1];o.transformMat4$1(E,E,this.pixelMatrixInverse),o.transformMat4$1(A,A,this.pixelMatrixInverse);const I=A[3];o.scale$1(E,E,1/E[3]),o.scale$1(A,A,1/I);const D=E[2],B=A[2];return{p0:E,p1:A,t:D===B?0:(x-D)/(B-D)}}screenPointToMercatorRay(l){const p=[l.x,l.y,0,1],x=[l.x,l.y,1,1];return o.transformMat4$1(p,p,this.pixelMatrixInverse),o.transformMat4$1(x,x,this.pixelMatrixInverse),o.scale$1(p,p,1/p[3]),o.scale$1(x,x,1/x[3]),p[2]=o.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,x[2]=o.mercatorZfromAltitude(x[2],this._center.lat)*this.worldSize,o.scale$1(p,p,1/this.worldSize),o.scale$1(x,x,1/this.worldSize),new o.Ray([p[0],p[1],p[2]],o.normalize([],o.sub([],x,p)))}rayIntersectionCoordinate(l){const{p0:p,p1:x,t:E}=l,A=o.mercatorZfromAltitude(p[2],this._center.lat),I=o.mercatorZfromAltitude(x[2],this._center.lat);return new o.MercatorCoordinate(o.number(p[0],x[0],E)/this.worldSize,o.number(p[1],x[1],E)/this.worldSize,o.number(A,I,E))}pointCoordinate(l,p=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(l.x,l.y,p)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);const p=this.elevation;let x=this.elevation.pointCoordinate(l);if(x)return new o.MercatorCoordinate(x[0],x[1],x[2]);let E=0,A=this.horizonLineFromTop();if(l.y>A)return this.pointCoordinate(l);const I=.02*A,D=l.clone();for(let B=0;B<10&&A-E>I;B++){D.y=o.number(E,A,.66);const j=p.pointCoordinate(D);j?(A=D.y,x=j):E=D.y}return x?new o.MercatorCoordinate(x[0],x[1],x[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){if(this.elevation)return!this.elevation.pointCoordinate(l);{const p=this.horizonLineFromTop();return l.y<p}}_coordinatePoint(l,p){const x=p&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,E=[l.x*this.worldSize,l.y*this.worldSize,x+l.toAltitude(),1];return o.transformMat4$1(E,E,this.pixelMatrix),E[3]>0?new o.pointGeometry(E[0]/E[3],E[1]/E[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(l,p){const x=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),E=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),A=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),I=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let D=this.pointCoordinate(x,l),B=this.pointCoordinate(E,l);const j=this.pointCoordinate(A,p),$=this.pointCoordinate(I,p),X=(K,se)=>(se.y-K.y)/(se.x-K.x);return D.y>1&&B.y>=0?D=new o.MercatorCoordinate((1-$.y)/X($,D)+$.x,1):D.y<0&&B.y<=1&&(D=new o.MercatorCoordinate(-$.y/X($,D)+$.x,0)),B.y>1&&D.y>=0?B=new o.MercatorCoordinate((1-j.y)/X(j,B)+j.x,1):B.y<0&&D.y<=1&&(B=new o.MercatorCoordinate(-j.y/X(j,B)+j.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(D)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(j))}_getBounds3D(){const l=this.elevation;if(!l.visibleDemTiles.length)return this._getBounds(0,0);const p=l.visibleDemTiles.reduce((x,E)=>{if(E.dem){const A=E.dem.tree;x.min=Math.min(x.min,A.minimums[0]),x.max=Math.max(x.max,A.maximums[0])}return x},{min:Number.MAX_VALUE,max:0});return this._getBounds(p.min*l.exaggeration(),p.max*l.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(l=!0){const p=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,x=this.height/2-p*(1-this._horizonShift);return l?Math.max(0,x):x}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,p){return this.projection.createTileTransform(this,p).createTileMatrix(l)}calculateDistanceTileData(l){const p=l.key,x=this._distanceTileDataCache;if(x[p])return x[p];const E=l.canonical,A=1/this.height,I=this.cameraWorldSize/this.zoomScale(E.z),D=(E.x+Math.pow(2,E.z)*l.wrap)*I,B=E.y*I,j=this.point,$=this.angle,X=Math.sin(-$),K=-Math.cos(-$);return x[p]={bearing:[X,K],center:[(j.x-D)*A,(j.y-B)*A],scale:I/o.EXTENT*A},x[p]}calculateFogTileMatrix(l){const p=l.key,x=this._fogTileMatrixCache;if(x[p])return x[p];const E=this.calculatePosMatrix(l,this.cameraWorldSize);return o.multiply$1(E,this.worldToFogMatrix,E),x[p]=new Float32Array(E),x[p]}calculateProjMatrix(l,p=!1){const x=l.key,E=p?this._alignedProjMatrixCache:this._projMatrixCache;if(E[x])return E[x];const A=this.calculatePosMatrix(l,this.worldSize);return o.multiply$1(A,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.alignedProjMatrix:this.projMatrix,A),E[x]=new Float32Array(A),E[x]}calculatePixelsToTileUnitsMatrix(l){const p=l.tileID.key,x=this._pixelsToTileUnitsCache;if(x[p])return x[p];const E=function(A,I){const{scale:D}=A.tileTransform,B=D*o.EXTENT/(A.tileSize*Math.pow(2,I.zoom-A.tileID.overscaledZ+A.tileID.canonical.z));return j=new Float32Array(4),K=($=I.inverseAdjustmentMatrix)[1],se=$[2],re=$[3],Pe=(X=[B,B])[1],j[0]=$[0]*(ae=X[0]),j[1]=K*ae,j[2]=se*Pe,j[3]=re*Pe,j;var j,$,X,K,se,re,ae,Pe}(l,this);return x[p]=E,x[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const l=this._elevation;this._updateCameraState();const p=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),E=this._camera.forward(),A=o.mercatorZfromAltitude(1,this._center.lat);x[2]/=A,E[2]/=A,o.normalize(E,E);const I=l.raycast(x,E,l.exaggeration());if(I){const D=o.scaleAndAdd([],x,E,I),B=new o.MercatorCoordinate(D[0],D[1],o.mercatorZfromAltitude(D[2],o.latFromMercatorY(D[1]))),j=(B.z+o.length([B.x-x[0],B.y-x[1],B.z-x[2]*A]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(j),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const l=this._elevation;this._updateCameraState();const p=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),E=l.getAtPointOrZero(new o.MercatorCoordinate(...x)),A=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),I=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*E;if(I<A){const D=this.locationCoordinate(this._center,this._centerAltitude),B=[D.x-x[0],D.y-x[1],D.z-x[2]],j=o.length(B);B[2]-=(A-I)/this._projectionScaler;const $=o.length(B);if($===0)return;o.scale$2(B,B,j/$*this._projectionScaler),this._camera.position=[D.x-B[0],D.y-B[1],D.z*this._projectionScaler-B[2]],this._camera.orientation=X3(B,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const X=this.center;return X.lat=o.clamp(X.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(X.lng=o.clamp(X.lng,this.minLng,this.maxLng)),this.center=X,void(this._constraining=!1)}const l=this._unmodified,{x:p,y:x}=this.point;let E=0,A=p,I=x;const D=this.width/2,B=this.height/2,j=this.worldMinY*this.scale,$=this.worldMaxY*this.scale;if(x-B<j&&(I=j+B),x+B>$&&(I=$-B),$-j<this.height&&(E=Math.max(E,this.height/($-j)),I=($+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const X=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,se=this.worldSize/2-(X+K)/2;A=(p+se+this.worldSize)%this.worldSize-se,A-D<X&&(A=X+D),A+D>K&&(A=K-D),K-X<this.width&&(E=Math.max(E,this.width/(K-X)),A=(K+X)/2)}A===p&&I===x||(this.center=this.unproject(new o.pointGeometry(A,I))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCameraAltitude(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this._fov/2,p=this.centerOffset,x=this.pixelsPerMeter;this._projectionScaler=x/(o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(l)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const E=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?x:1),A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);A[8]=2*-p.x/this.width,A[9]=2*p.y/this.height;let I=o.mul([],A,E);if(this.projection.isReprojectedInTileSpace){const be=this.locationCoordinate(this.center),we=o.identity([]);o.translate(we,we,[be.x*this.worldSize,be.y*this.worldSize,0]),o.multiply$1(we,we,e4(this)),o.translate(we,we,[-be.x*this.worldSize,-be.y*this.worldSize,0]),o.multiply$1(I,I,we),this.inverseAdjustmentMatrix=function(Ie){const Ke=e4(Ie,!0);return O([],[Ke[0],Ke[1],Ke[4],Ke[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],I,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=I,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const D=new Float32Array(16);o.identity(D),o.scale(D,D,[1,-1,1]),o.rotateX(D,D,this._pitch),o.rotateZ(D,D,this.angle);const B=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-p.x/this.width,B[9]=2*(p.y+j)/this.height,this.skyboxMatrix=o.multiply$1(D,B,D);const $=this.point,X=$.x,K=$.y,se=this.width%2/2,re=this.height%2/2,ae=Math.cos(this.angle),Pe=Math.sin(this.angle),ie=X-Math.round(X)+ae*se+Pe*re,Ae=K-Math.round(K)+ae*re+Pe*se,Se=new Float64Array(I);if(o.translate(Se,Se,[ie>.5?ie-1:ie,Ae>.5?Ae-1:Ae,0]),this.alignedProjMatrix=Se,I=o.create(),o.scale(I,I,[this.width/2,-this.height/2,1]),o.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=o.create(),o.scale(I,I,[1,-1,1]),o.translate(I,I,[-1,-1,0]),o.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=o.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=o.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");this.pixelMatrixInverse=I,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSize,p=this.cameraPixelsPerMeter,x=this._camera.position,E=1/this.height,A=[l,l,p];o.scale$2(A,A,E),o.scale$2(x,x,-1),o.multiply$2(x,x,A);const I=o.create();o.translate(I,I,x),o.scale(I,I,A),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,p,E)}_computeCameraPosition(l){const p=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,x=this._camera.forward(),E=this.point,A=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*p-l/this.worldSize*this._centerAltitude;return[E.x/this.worldSize-x[0]*A,E.y/this.worldSize-x[1]*A,l/this.worldSize*this._centerAltitude-x[2]*A]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const p=this._maxCameraBoundsDistance()*Math.cos(this._pitch),x=l[2];let E=1;x>0&&(E=Math.min((p-this._camera.position[2])/x,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,l,E),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,p=this._camera.forward(),{pitch:x,bearing:E}=this._camera.getPitchBearing(),A=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),D=Math.max((l[2]-A)/Math.cos(x),I),B=this._zoomFromMercatorZ(D);o.scaleAndAdd(l,l,p,D),this._pitch=o.clamp(x,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(E,-Math.PI,Math.PI),this._setZoom(o.clamp(B,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new o.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(l,p){const x=Math.min(l.x,p.x),E=Math.max(l.x,p.x),A=Math.min(l.y,p.y),I=Math.max(l.y,p.y);if(A<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const D=[new o.pointGeometry(x,A),new o.pointGeometry(E,I),new o.pointGeometry(x,I),new o.pointGeometry(E,A)],B=this.renderWorldCopies?-3:0,j=this.renderWorldCopies?4:1;for(const $ of D){const X=this.pointRayIntersection($);if(X.t<0)return!0;const K=this.rayIntersectionCoordinate(X);if(K.x<B||K.y<0||K.x>j||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(l,p){const x=o.length(o.sub([],this._camera.position,l)),E=this._zoomFromMercatorZ(x)+p;return x-this._mercatorZfromZoom(E)}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,l))}}function ba(v,l){let p=!1,x=null;const E=()=>{x=null,p&&(v(),x=setTimeout(E,l),p=!1)};return()=>(p=!0,x||E(),x)}class nl{constructor(l){this._hashName=l&&encodeURIComponent(l),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ba(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,o.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return o.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const p=this._map.getCenter(),x=Math.round(100*this._map.getZoom())/100,E=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,E),I=Math.round(p.lng*A)/A,D=Math.round(p.lat*A)/A,B=this._map.getBearing(),j=this._map.getPitch();let $="";if($+=l?`/${I}/${D}/${x}`:`${x}/${D}/${I}`,(B||j)&&($+="/"+Math.round(10*B)/10),j&&($+=`/${Math.round(j)}`),this._hashName){const X=this._hashName;let K=!1;const se=o.window.location.hash.slice(1).split("&").map(re=>{const ae=re.split("=")[0];return ae===X?(K=!0,`${ae}=${$}`):re}).filter(re=>re);return K||se.push(`${X}=${$}`),`#${se.join("&")}`}return`#${$}`}_getCurrentHash(){const l=o.window.location.hash.replace("#","");if(this._hashName){let p;return l.split("&").map(x=>x.split("=")).forEach(x=>{x[0]===this._hashName&&(p=x)}),(p&&p[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const l=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,l)}}const lo={linearity:.3,easing:o.bezier(0,0,.3,1)},Io=o.extend({deceleration:2500,maxSpeed:1400},lo),Nc=o.extend({deceleration:20,maxSpeed:1400},lo),Bc=o.extend({deceleration:1e3,maxSpeed:360},lo),Kn=o.extend({deceleration:1e3,maxSpeed:90},lo);class ql{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,p=o.exported.now();for(;l.length>0&&p-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const p={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)p.zoom+=A.zoomDelta||0,p.bearing+=A.bearingDelta||0,p.pitch+=A.pitchDelta||0,A.panDelta&&p.pan._add(A.panDelta),A.around&&(p.around=A.around),A.pinchAround&&(p.pinchAround=A.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(p.pan.mag()){const A=U1(p.pan.mag(),x,o.extend({},Io,l||{}));E.offset=p.pan.mult(A.amount/p.pan.mag()),E.center=this._map.transform.center,wa(E,A)}if(p.zoom){const A=U1(p.zoom,x,Nc);E.zoom=this._map.transform.zoom+A.amount,wa(E,A)}if(p.bearing){const A=U1(p.bearing,x,Bc);E.bearing=this._map.transform.bearing+o.clamp(A.amount,-179,179),wa(E,A)}if(p.pitch){const A=U1(p.pitch,x,Kn);E.pitch=this._map.transform.pitch+A.amount,wa(E,A)}if(E.zoom||E.bearing){const A=p.pinchAround===void 0?p.around:p.pinchAround;E.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),o.extend(E,{noMoveStart:!0})}}function wa(v,l){(!v.duration||v.duration<l.duration)&&(v.duration=l.duration,v.easing=l.easing)}function U1(v,l,p){const{maxSpeed:x,linearity:E,deceleration:A}=p,I=o.clamp(v*E/(l/1e3),-x,x),D=Math.abs(I)/(A*E);return{easing:p.easing,duration:1e3*D,amount:I*(D/2)}}class mi extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,p,x,E={}){const A=V.mousePos(p.getCanvasContainer(),x),I=p.unproject(A);super(l,o.extend({point:A,lngLat:I,originalEvent:x},E)),this._defaultPrevented=!1,this.target=p}}class V1 extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,p,x){const E=l==="touchend"?x.changedTouches:x.touches,A=V.touchPos(p.getCanvasContainer(),E),I=A.map(B=>p.unproject(B)),D=A.reduce((B,j,$,X)=>B.add(j.div(X.length)),new o.pointGeometry(0,0));super(l,{points:A,point:D,lngLats:I,lngLat:p.unproject(D),originalEvent:x}),this._defaultPrevented=!1}}class Mr extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,p,x){super(l,{originalEvent:x}),this._defaultPrevented=!1}}class Z3{constructor(l,p){this._map=l,this._clickTolerance=p.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new Mr(l.type,this._map,l))}mousedown(l,p){return this._mousedownPos=p,this._firePreventable(new mi(l.type,this._map,l))}mouseup(l){this._map.fire(new mi(l.type,this._map,l))}preclick(l){const p=o.extend({},l);p.type="preclick",this._map.fire(new mi(p.type,this._map,p))}click(l,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||(this.preclick(l),this._map.fire(new mi(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new mi(l.type,this._map,l))}mouseover(l){this._map.fire(new mi(l.type,this._map,l))}mouseout(l){this._map.fire(new mi(l.type,this._map,l))}touchstart(l){return this._firePreventable(new V1(l.type,this._map,l))}touchmove(l){this._map.fire(new V1(l.type,this._map,l))}touchend(l){this._map.fire(new V1(l.type,this._map,l))}touchcancel(l){this._map.fire(new V1(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class t4{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(l){this._map.fire(new mi(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new mi(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zc{constructor(l,p){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,p){this.isEnabled()&&l.shiftKey&&l.button===0&&(V.disableDrag(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(l,p){if(!this._active)return;const x=p;if(this._lastPos.equals(x)||!this._box&&x.dist(this._startPos)<this._clickTolerance)return;const E=this._startPos;this._lastPos=x,this._box||(this._box=V.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const A=Math.min(E.x,x.x),I=Math.max(E.x,x.x),D=Math.min(E.y,x.y),B=Math.max(E.y,x.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${D}px)`,this._box.style.width=I-A+"px",this._box.style.height=B-D+"px")})}mouseupWindow(l,p){if(!this._active||l.button!==0)return;const x=this._startPos,E=p;if(this.reset(),V.suppressClick(),x.x!==E.x||x.y!==E.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:A=>A.fitScreenCoordinates(x,E,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,p){return this._map.fire(new o.Event(l,{originalEvent:p}))}}function rl(v,l){const p={};for(let x=0;x<v.length;x++)p[v[x].identifier]=l[x];return p}class Gl{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,p,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),x.length===this.numTouches&&(this.centroid=function(E){const A=new o.pointGeometry(0,0);for(const I of E)A._add(I);return A.div(E.length)}(p),this.touches=rl(x,p)))}touchmove(l,p,x){if(this.aborted||!this.centroid)return;const E=rl(x,p);for(const A in this.touches){const I=this.touches[A],D=E[A];(!D||D.dist(I)>30)&&(this.aborted=!0)}}touchend(l,p,x){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),x.length===0){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class ea{constructor(l){this.singleTap=new Gl(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,p,x){this.singleTap.touchstart(l,p,x)}touchmove(l,p,x){this.singleTap.touchmove(l,p,x)}touchend(l,p,x){const E=this.singleTap.touchend(l,p,x);if(E){const A=l.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(E)<30;if(A&&I||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class Yl{constructor(){this._zoomIn=new ea({numTouches:1,numTaps:2}),this._zoomOut=new ea({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,p,x){this._zoomIn.touchstart(l,p,x),this._zoomOut.touchstart(l,p,x)}touchmove(l,p,x){this._zoomIn.touchmove(l,p,x),this._zoomOut.touchmove(l,p,x)}touchend(l,p,x){const E=this._zoomIn.touchend(l,p,x),A=this._zoomOut.touchend(l,p,x);return E?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(E)},{originalEvent:l})}):A?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(A)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const il={0:1,2:2};class sl{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(l,p){return!1}_move(l,p){return{}}mousedown(l,p){if(this._lastPoint)return;const x=V.mouseButton(l);this._correctButton(l,x)&&(this._lastPoint=p,this._eventButton=x)}mousemoveWindow(l,p){const x=this._lastPoint;if(x){if(l.preventDefault(),function(E,A){const I=il[A];return E.buttons===void 0||(E.buttons&I)!==I}(l,this._eventButton))this.reset();else if(this._moved||!(p.dist(x)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(x,p)}}mouseupWindow(l){this._lastPoint&&V.mouseButton(l)===this._eventButton&&(this._moved&&V.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ol extends sl{mousedown(l,p){super.mousedown(l,p),this._lastPoint&&(this._active=!0)}_correctButton(l,p){return p===0&&!l.ctrlKey}_move(l,p){return{around:p,panDelta:p.sub(l)}}}class hs extends sl{_correctButton(l,p){return p===0&&l.ctrlKey||p===2}_move(l,p){const x=.8*(p.x-l.x);if(x)return this._active=!0,{bearingDelta:x}}contextmenu(l){l.preventDefault()}}class j1 extends sl{_correctButton(l,p){return p===0&&l.ctrlKey||p===2}_move(l,p){const x=-.5*(p.y-l.y);if(x)return this._active=!0,{pitchDelta:x}}contextmenu(l){l.preventDefault()}}class q3{constructor(l,p){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(l,p,x){return this._calculateTransform(l,p,x)}touchmove(l,p,x){if(this._active&&!(x.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(x.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.preventDefault(),this._calculateTransform(l,p,x)}}touchend(l,p,x){this._calculateTransform(l,p,x),this._active&&x.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,p,x){x.length>0&&(this._active=!0);const E=rl(x,p),A=new o.pointGeometry(0,0),I=new o.pointGeometry(0,0);let D=0;for(const j in E){const $=E[j],X=this._touches[j];X&&(A._add($),I._add($.sub(X)),D++,E[j]=$)}if(this._touches=E,D<this._minTouches||!I.mag())return;const B=I.div(D);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(D),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Kl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(l){}_move(l,p,x){return{}}touchstart(l,p,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([p[0],p[1]]))}touchmove(l,p,x){if(!this._firstTwoTouches)return;l.preventDefault();const[E,A]=this._firstTwoTouches,I=Mo(x,p,E),D=Mo(x,p,A);if(!I||!D)return;const B=this._aroundCenter?null:I.add(D).div(2);return this._move([I,D],B,l)}touchend(l,p,x){if(!this._firstTwoTouches)return;const[E,A]=this._firstTwoTouches,I=Mo(x,p,E),D=Mo(x,p,A);I&&D||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Mo(v,l,p){for(let x=0;x<v.length;x++)if(v[x].identifier===p)return l[x]}function G3(v,l){return Math.log(v/l)/Math.LN2}class Jl extends Kl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,p){const x=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(G3(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:G3(this._distance,x),pinchAround:p}}}function ta(v,l){return 180*v.angleWith(l)/Math.PI}class $1 extends Kl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,p){const x=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ta(this._vector,x),pinchAround:p}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const p=25/(Math.PI*this._minDiameter)*360,x=ta(l,this._startVector);return Math.abs(x)<p}}function Ql(v){return Math.abs(v.y)>Math.abs(v.x)}class n4 extends Kl{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(l){this._lastPoints=l,Ql(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,p,x){const E=l[0].sub(this._lastPoints[0]),A=l[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&x.touches.length<3)&&(this._valid=this.gestureBeginsVertically(E,A,x.timeStamp),this._valid))return this._lastPoints=l,this._active=!0,{pitchDelta:(E.y+A.y)/2*-.5}}gestureBeginsVertically(l,p,x){if(this._valid!==void 0)return this._valid;const E=l.mag()>=2,A=p.mag()>=2;if(!E&&!A)return;if(!E||!A)return this._firstMove===void 0&&(this._firstMove=x),x-this._firstMove<100&&void 0;const I=l.y>0==p.y>0;return Ql(l)&&Ql(p)&&I}}const na={panStep:100,bearingStep:15,pitchStep:10};class Ta{constructor(){const l=na;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let p=0,x=0,E=0,A=0,I=0;switch(l.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:l.shiftKey?x=-1:(l.preventDefault(),A=-1);break;case 39:l.shiftKey?x=1:(l.preventDefault(),A=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),I=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(x=0,E=0),{cameraAnimation:D=>{const B=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:Uc,zoom:p?Math.round(B)+p*(l.shiftKey?2:1):B,bearing:D.getBearing()+x*this._bearingStep,pitch:D.getPitch()+E*this._pitchStep,offset:[-A*this._panStep,-I*this._panStep],center:D.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Uc(v){return v*(2-v)}const Ea=4.000244140625;class W1{constructor(l,p){this._map=l,this._el=l.getCanvasContainer(),this._handler=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let p=l.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const x=o.exported.now(),E=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,p!==0&&p%Ea==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(E*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),l.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=l,this._delta-=p,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=V.mousePos(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:p,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform,p=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>Ea?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&j!==0&&(j=1/j);const $=p(),X=Math.pow(2,$),K=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):X;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(K*j))),this._type==="wheel"&&(this._startZoom=p(),this._easing=this._smoothOutEasing(200)),this._delta=0}const x=typeof this._targetZoom=="number"?this._targetZoom:p(),E=this._startZoom,A=this._easing;let I,D=!1;if(this._type==="wheel"&&E&&A){const B=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),j=A(B);I=o.number(E,x,j),B<1?this._frameId||(this._frameId=!0):D=!0}else I=x,D=!0;return this._active=!0,D&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!D,zoomDelta:I-p(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let p=o.ease;if(this._prevEase){const x=this._prevEase,E=(o.exported.now()-x.start)/x.duration,A=x.easing(E+.01)-x.easing(E),I=.27/Math.sqrt(A*A+1e-4)*.01,D=Math.sqrt(.0729-I*I);p=o.bezier(I,D,.25,1)}return this._prevEase={start:o.exported.now(),duration:l,easing:p},p}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!o.window.document.fullscreenElement||!!o.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class ra{constructor(l,p){this._clickZoom=l,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class e1{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,p){return l.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:x.getZoom()+(l.shiftKey?-1:1),around:x.unproject(p)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class al{constructor(){this._tap=new ea({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(l,p,x){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?x.length>0&&(this._swipePoint=p[0],this._swipeTouch=x[0].identifier):this._tap.touchstart(l,p,x))}touchmove(l,p,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const E=p[0],A=E.y-this._swipePoint.y;return this._swipePoint=E,l.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(l,p,x)}touchend(l,p,x){this._tapTime?this._swipePoint&&x.length===0&&this.reset():this._tap.touchend(l,p,x)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ll{constructor(l,p,x){this._el=l,this._mousePan=p,this._touchPan=x}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vc{constructor(l,p,x){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=p,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class jc{constructor(l,p,x,E){this._el=l,this._touchZoom=p,this._touchRotate=x,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ro=v=>v.zoom||v.drag||v.pitch||v.rotate;class ia extends o.Event{}class Ar{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,p){const x=o.sub([],p,l);this.radius=o.length(x[2]<0?o.div([],x,this.constants):[x[0],x[1],0])}projectRay(l){o.div(l,l,this.constants),o.normalize(l,l),o.mul$1(l,l,this.constants);const p=o.scale$2([],l,this.radius);if(p[2]>0){const x=o.scale$2([],[0,0,1],o.dot(p,[0,0,1])),E=o.scale$2([],o.normalize([],[p[0],p[1],0]),this.radius),A=o.add([],p,o.scale$2([],o.sub([],o.add([],E,x),p),2));p[0]=A[0],p[1]=A[1]}return p}}function Cr(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class Ps{constructor(l,p){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ql(l),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ar,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(p),o.bindAll(["handleEvent","handleWindowEvent"],this);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[E,A,I]of this._listeners)E.addEventListener(A,E===o.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[l,p,x]of this._listeners)l.removeEventListener(p,l===o.window.document?this.handleWindowEvent:this.handleEvent,x)}_addDefaultHandlers(l){const p=this._map,x=p.getCanvasContainer();this._add("mapEvent",new Z3(p,l));const E=p.boxZoom=new zc(p,l);this._add("boxZoom",E);const A=new Yl,I=new e1;p.doubleClickZoom=new ra(I,A),this._add("tapZoom",A),this._add("clickZoom",I);const D=new al;this._add("tapDragZoom",D);const B=p.touchPitch=new n4(p);this._add("touchPitch",B);const j=new hs(l),$=new j1(l);p.dragRotate=new Vc(l,j,$),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);const X=new ol(l),K=new q3(p,l);p.dragPan=new ll(x,X,K),this._add("mousePan",X),this._add("touchPan",K,["touchZoom","touchRotate"]);const se=new $1,re=new Jl;p.touchZoomRotate=new jc(x,re,se,D),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new t4(p));const ae=p.scrollZoom=new W1(p,this);this._add("scrollZoom",ae,["mousePan"]);const Pe=p.keyboard=new Ta;this._add("keyboard",Pe);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[ie]&&p[ie].enable(l[ie])}_add(l,p,x){this._handlers.push({handlerName:l,handler:p,allowed:x}),this._handlersById[l]=p}stop(l){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ro(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,p,x){for(const E in l)if(E!==x&&(!p||p.indexOf(E)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const p=[];for(const x of l)this._el.contains(x.target)&&p.push(x);return p}handleEvent(l,p){this._updatingCamera=!0;const x=l.type==="renderFrame",E=x?void 0:l,A={needsRenderFrame:!1},I={},D={},B=l.touches?this._getMapTouches(l.touches):void 0,j=B?V.touchPos(this._el,B):x?void 0:V.mousePos(this._el,l);for(const{handlerName:K,handler:se,allowed:re}of this._handlers){if(!se.isEnabled())continue;let ae;this._blockedByActive(D,re,K)?se.reset():se[p||l.type]&&(ae=se[p||l.type](l,j,B),this.mergeHandlerResult(A,I,ae,K,E),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()),(ae||se.isActive())&&(D[K]=se)}const $={};for(const K in this._previousActiveHandlers)D[K]||($[K]=E);this._previousActiveHandlers=D,(Object.keys($).length||Cr(A))&&(this._changes.push([A,I,$]),this._triggerRenderFrame()),(Object.keys(D).length||Cr(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=A;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))}mergeHandlerResult(l,p,x,E,A){if(!x)return;o.extend(l,x);const I={handlerName:E,originalEvent:x.originalEvent||A};x.zoomDelta!==void 0&&(p.zoom=I),x.panDelta!==void 0&&(p.drag=I),x.pitchDelta!==void 0&&(p.pitch=I),x.bearingDelta!==void 0&&(p.rotate=I)}_applyChanges(){const l={},p={},x={};for(const[E,A,I]of this._changes)E.panDelta&&(l.panDelta=(l.panDelta||new o.pointGeometry(0,0))._add(E.panDelta)),E.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(l.around=E.around),E.aroundCoord!==void 0&&(l.aroundCoord=E.aroundCoord),E.pinchAround!==void 0&&(l.pinchAround=E.pinchAround),E.noInertia&&(l.noInertia=E.noInertia),o.extend(p,A),o.extend(x,I);this._updateMapTransform(l,p,x),this._changes=[]}_updateMapTransform(l,p,x){const E=this._map,A=E.transform,I=Ae=>[Ae.x,Ae.y,Ae.z];if((Ae=>{const Se=this._eventsInProgress.drag;return Se&&!this._handlersById[Se.handlerName].isActive()})()&&!Cr(l)){const Ae=A.zoom;A.cameraElevationReference="sea",A.recenterOnTerrain(),A.cameraElevationReference="ground",Ae!==A.zoom&&this._map._update(!0)}if(!Cr(l))return this._fireEvents(p,x,!0);let{panDelta:D,zoomDelta:B,bearingDelta:j,pitchDelta:$,around:X,aroundCoord:K,pinchAround:se}=l;se!==void 0&&(X=se),(Ae=>p.drag&&!this._eventsInProgress.drag)()&&X&&(this._dragOrigin=I(A.pointCoordinate3D(X)),this._trackingEllipsoid.setup(A._camera.position,this._dragOrigin)),A.cameraElevationReference="sea",E._stop(!0),X=X||E.transform.centerPoint,j&&(A.bearing+=j),$&&(A.pitch+=$),A._updateCameraState();const re=[0,0,0];if(D){const Ae=A.pointCoordinate(X),Se=A.pointCoordinate(X.sub(D));Ae&&Se&&(re[0]=Se.x-Ae.x,re[1]=Se.y-Ae.y)}const ae=A.zoom,Pe=[0,0,0];if(B){const Ae=I(K||A.pointCoordinate3D(X)),Se={dir:o.normalize([],o.sub([],Ae,A._camera.position))};if(Se.dir[2]<0){const be=A.zoomDeltaToMovement(Ae,B);o.scale$2(Pe,Se.dir,be)}}const ie=o.add(re,re,Pe);A._translateCameraConstrained(ie),B&&Math.abs(A.zoom-ae)>1e-4&&A.recenterOnTerrain(),A.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(p,x,!0)}_fireEvents(l,p,x){const E=Ro(this._eventsInProgress),A=Ro(l),I={};for(const $ in l){const{originalEvent:X}=l[$];this._eventsInProgress[$]||(I[`${$}start`]=X),this._eventsInProgress[$]=l[$]}!E&&A&&this._fireEvent("movestart",A.originalEvent);for(const $ in I)this._fireEvent($,I[$]);A&&this._fireEvent("move",A.originalEvent);for(const $ in l){const{originalEvent:X}=l[$];this._fireEvent($,X)}const D={};let B;for(const $ in this._eventsInProgress){const{handlerName:X,originalEvent:K}=this._eventsInProgress[$];this._handlersById[X].isActive()||(delete this._eventsInProgress[$],B=p[X]||K,D[`${$}end`]=B)}for(const $ in D)this._fireEvent($,D[$]);const j=Ro(this._eventsInProgress);if(x&&(E||A)&&!j){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;$?(X($.bearing||this._map.getBearing())&&($.bearing=0),this._map.easeTo($,{originalEvent:B})):(this._map.fire(new o.Event("moveend",{originalEvent:B})),X(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,p){this._map.fire(new o.Event(l,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new ia("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const gi="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class es extends o.Evented{constructor(l,p){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=p.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,p){return this.jumpTo({center:l},p)}panBy(l,p,x){return l=o.pointGeometry.convert(l).mult(-1),this.panTo(this.transform.center,o.extend({offset:l},p),x)}panTo(l,p,x){return this.easeTo(o.extend({center:l},p),x)}getZoom(){return this.transform.zoom}setZoom(l,p){return this.jumpTo({zoom:l},p),this}zoomTo(l,p,x){return this.easeTo(o.extend({zoom:l},p),x)}zoomIn(l,p){return this.zoomTo(this.getZoom()+1,l,p),this}zoomOut(l,p){return this.zoomTo(this.getZoom()-1,l,p),this}getBearing(){return this.transform.bearing}setBearing(l,p){return this.jumpTo({bearing:l},p),this}getPadding(){return this.transform.padding}setPadding(l,p){return this.jumpTo({padding:l},p),this}rotateTo(l,p,x){return this.easeTo(o.extend({bearing:l},p),x)}resetNorth(l,p){return this.rotateTo(0,o.extend({duration:1e3},l),p),this}resetNorthPitch(l,p){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},l),p),this}snapToNorth(l,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,p):this}getPitch(){return this.transform.pitch}setPitch(l,p){return this.jumpTo({pitch:l},p),this}cameraForBounds(l,p){l=o.LngLatBounds.convert(l);const x=p&&p.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),x,p)}_extendCameraOptions(l){const p={top:0,bottom:0,right:0,left:0};if(typeof(l=o.extend({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const x=l.padding;l.padding={top:x,bottom:x,right:x,left:x}}return l.padding=o.extend(p,l.padding),l}_cameraForBoxAndBearing(l,p,x,E){const A=this._extendCameraOptions(E),I=this.transform,D=I.padding,B=I.project(o.LngLat.convert(l)),j=I.project(o.LngLat.convert(p)),$=B.rotate(-o.degToRad(x)),X=j.rotate(-o.degToRad(x)),K=new o.pointGeometry(Math.max($.x,X.x),Math.max($.y,X.y)),se=new o.pointGeometry(Math.min($.x,X.x),Math.min($.y,X.y)),re=K.sub(se),ae=(I.width-(D.left+D.right+A.padding.left+A.padding.right))/re.x,Pe=(I.height-(D.top+D.bottom+A.padding.top+A.padding.bottom))/re.y;if(Pe<0||ae<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ie=Math.min(I.scaleZoom(I.scale*Math.min(ae,Pe)),A.maxZoom),Ae=typeof A.offset.x=="number"?new o.pointGeometry(A.offset.x,A.offset.y):o.pointGeometry.convert(A.offset),Se=new o.pointGeometry((A.padding.left-A.padding.right)/2,(A.padding.top-A.padding.bottom)/2).rotate(x*Math.PI/180),be=Ae.add(Se).mult(I.scale/I.zoomScale(ie));return{center:I.unproject(B.add(j).div(2).sub(be)),zoom:ie,bearing:x}}_cameraForBox(l,p,x,E,A){const I=this._extendCameraOptions(A);x=x||0,E=E||0,l=o.LngLat.convert(l),p=o.LngLat.convert(p);const D=this.transform.clone();D.padding=I.padding;const B=this.getFreeCameraOptions(),j=new o.LngLat(.5*(l.lng+p.lng),.5*(l.lat+p.lat)),$=.5*(x+E);if(D._camera.position[2]<o.mercatorZfromAltitude($,j.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");B.lookAtPoint(j),D.setFreeCameraOptions(B);const X=o.MercatorCoordinate.fromLngLat(l),K=o.MercatorCoordinate.fromLngLat(p),se=D.pointRayIntersection(D.centerPoint,$),re=[(ae=D.rayIntersectionCoordinate(se)).x,ae.y,ae.z];var ae;const Pe=D.screenPointToMercatorRay(D.centerPoint),ie=D.projection.name!=="globe";let Ae,Se=0;do{const be=Math.floor(D.zoom),we=1<<be,Ie=Math.min(we*X.x,we*K.x),Ke=Math.min(we*X.y,we*K.y),st=Math.max(we*X.x,we*K.x),It=Math.max(we*X.y,we*K.y),Et=new o.Aabb([Ie,Ke,x],[st,It,E]),bt=o.Frustum.fromInvProjectionMatrix(D.invProjMatrix,D.worldSize,be,ie);if(Et.intersects(bt)!==2){Ae&&(D._camera.position=o.scaleAndAdd([],D._camera.position,Pe.dir,-Ae),D._updateStateFromCamera());break}const ut=o.sub([],D._camera.position,re);Ae=.5*o.length(ut),D._camera.position=o.scaleAndAdd([],D._camera.position,Pe.dir,Ae);try{D._updateStateFromCamera()}catch{return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Se<10);return{center:D.center,zoom:D.zoom,bearing:D.bearing,pitch:D.pitch}}fitBounds(l,p,x){return this._fitInternal(this.cameraForBounds(l,p),p,x)}_raycastElevationBox(l,p){const x=this.transform.elevation;if(!x)return;const E=new o.pointGeometry(l.x,p.y),A=new o.pointGeometry(p.x,l.y),I=x.pointCoordinate(l);if(!I)return;const D=x.pointCoordinate(p);if(!D)return;const B=x.pointCoordinate(E);if(!B)return;const j=x.pointCoordinate(A);if(!j)return;const $=new o.MercatorCoordinate(I[0],I[1]).toLngLat(),X=new o.MercatorCoordinate(D[0],D[1]).toLngLat(),K=new o.MercatorCoordinate(B[0],B[1]).toLngLat(),se=new o.MercatorCoordinate(j[0],j[1]).toLngLat(),re=Math.min($.lng,Math.min(X.lng,Math.min(K.lng,se.lng))),ae=Math.min($.lat,Math.min(X.lat,Math.min(K.lat,se.lat))),Pe=Math.max($.lng,Math.max(X.lng,Math.max(K.lng,se.lng))),ie=Math.max($.lat,Math.max(X.lat,Math.max(K.lat,se.lat))),Ae=Math.min(I[3],Math.min(D[3],Math.min(B[3],j[3]))),Se=Math.max(I[3],Math.max(D[3],Math.max(B[3],j[3])));return{minLngLat:new o.LngLat(re,ae),maxLngLat:new o.LngLat(Pe,ie),minAltitude:Ae,maxAltitude:Se}}fitScreenCoordinates(l,p,x,E,A){let I,D,B,j;const $=o.pointGeometry.convert(l),X=o.pointGeometry.convert(p),K=this._raycastElevationBox($,X);if(K)I=K.minLngLat,D=K.maxLngLat,B=K.minAltitude,j=K.maxAltitude;else{if(this.transform.anyCornerOffEdge($,X))return this;I=this.transform.pointLocation($),D=this.transform.pointLocation(X)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(l)),this.transform.pointLocation(o.pointGeometry.convert(p)),x,E):this._cameraForBox(I,D,B,j,E),E,A)}_fitInternal(l,p,x){return l?(delete(p=o.extend(l,p)).padding,p.linear?this.easeTo(p,x):this.flyTo(p,x)):this}jumpTo(l,p){this.stop();const x=l.preloadOnly?this.transform.clone():this.transform;let E=!1,A=!1,I=!1;return"zoom"in l&&x.zoom!==+l.zoom&&(E=!0,x.zoom=+l.zoom),l.center!==void 0&&(x.center=o.LngLat.convert(l.center)),"bearing"in l&&x.bearing!==+l.bearing&&(A=!0,x.bearing=+l.bearing),"pitch"in l&&x.pitch!==+l.pitch&&(I=!0,x.pitch=+l.pitch),l.padding==null||x.isPaddingEqual(l.padding)||(x.padding=l.padding),l.preloadOnly?(this._preloadTiles(x),this):(this.fire(new o.Event("movestart",p)).fire(new o.Event("move",p)),E&&this.fire(new o.Event("zoomstart",p)).fire(new o.Event("zoom",p)).fire(new o.Event("zoomend",p)),A&&this.fire(new o.Event("rotatestart",p)).fire(new o.Event("rotate",p)).fire(new o.Event("rotateend",p)),I&&this.fire(new o.Event("pitchstart",p)).fire(new o.Event("pitch",p)).fire(new o.Event("pitchend",p)),this.fire(new o.Event("moveend",p)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(gi),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,p){const x=this.transform;if(!x.projection.supportsFreeCamera)return void o.warnOnce(gi);this.stop();const E=x.zoom,A=x.pitch,I=x.bearing;x.setFreeCameraOptions(l);const D=E!==x.zoom,B=A!==x.pitch,j=I!==x.bearing;return this.fire(new o.Event("movestart",p)).fire(new o.Event("move",p)),D&&this.fire(new o.Event("zoomstart",p)).fire(new o.Event("zoom",p)).fire(new o.Event("zoomend",p)),j&&this.fire(new o.Event("rotatestart",p)).fire(new o.Event("rotate",p)).fire(new o.Event("rotateend",p)),B&&this.fire(new o.Event("pitchstart",p)).fire(new o.Event("pitch",p)).fire(new o.Event("pitchend",p)),this.fire(new o.Event("moveend",p)),this}easeTo(l,p){this._stop(!1,l.easeId),((l=o.extend({offset:[0,0],duration:500,easing:o.ease},l)).animate===!1||!l.essential&&o.exported.prefersReducedMotion)&&(l.duration=0);const x=this.transform,E=this.getZoom(),A=this.getBearing(),I=this.getPitch(),D=this.getPadding(),B="zoom"in l?+l.zoom:E,j="bearing"in l?this._normalizeBearing(l.bearing,A):A,$="pitch"in l?+l.pitch:I,X="padding"in l?l.padding:x.padding,K=o.pointGeometry.convert(l.offset);let se=x.centerPoint.add(K);const re=x.projection.name==="globe"?x.pointCoordinate(se).toLngLat():x.pointLocation(se),ae=o.LngLat.convert(l.center||re);this._normalizeCenter(ae);const Pe=x.project(re),ie=x.project(ae).sub(Pe),Ae=x.zoomScale(B-E);let Se,be;l.around&&(Se=o.LngLat.convert(l.around),be=x.locationPoint(Se));const we=this._zooming||B!==E,Ie=this._rotating||A!==j,Ke=this._pitching||$!==I,st=!x.isPaddingEqual(X),It=bt=>ut=>{if(we&&(bt.zoom=o.number(E,B,ut)),Ie&&(bt.bearing=o.number(A,j,ut)),Ke&&(bt.pitch=o.number(I,$,ut)),st&&(bt.interpolatePadding(D,X,ut),se=bt.centerPoint.add(K)),Se)bt.setLocationAtPoint(Se,be);else{const it=bt.zoomScale(bt.zoom-E),vt=B>E?Math.min(2,Ae):Math.max(.5,Ae),dt=Math.pow(vt,1-ut),nn=bt.unproject(Pe.add(ie.mult(ut*dt)).mult(it));bt.setLocationAtPoint(bt.renderWorldCopies?nn.wrap():nn,se)}return l.preloadOnly||this._fireMoveEvents(p),bt};if(l.preloadOnly){const bt=this._emulate(It,l.duration,x);return this._preloadTiles(bt),this}const Et={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=we,this._rotating=Ie,this._pitching=Ke,this._padding=st,this._easeId=l.easeId,this._prepareEase(p,l.noMoveStart,Et),this._ease(It(x),bt=>{x.recenterOnTerrain(),this._afterEase(p,bt)},l),this}_prepareEase(l,p,x={}){this._moving=!0,this.transform.cameraElevationReference="sea",p||x.moving||this.fire(new o.Event("movestart",l)),this._zooming&&!x.zooming&&this.fire(new o.Event("zoomstart",l)),this._rotating&&!x.rotating&&this.fire(new o.Event("rotatestart",l)),this._pitching&&!x.pitching&&this.fire(new o.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new o.Event("move",l)),this._zooming&&this.fire(new o.Event("zoom",l)),this._rotating&&this.fire(new o.Event("rotate",l)),this._pitching&&this.fire(new o.Event("pitch",l))}_afterEase(l,p){if(this._easeId&&p&&this._easeId===p)return;delete this._easeId,this.transform.cameraElevationReference="ground";const x=this._zooming,E=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new o.Event("zoomend",l)),E&&this.fire(new o.Event("rotateend",l)),A&&this.fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l))}flyTo(l,p){if(!l.essential&&o.exported.prefersReducedMotion){const Rt=o.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Rt,p)}this.stop(),l=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},l);const x=this.transform,E=this.getZoom(),A=this.getBearing(),I=this.getPitch(),D=this.getPadding(),B="zoom"in l?o.clamp(+l.zoom,x.minZoom,x.maxZoom):E,j="bearing"in l?this._normalizeBearing(l.bearing,A):A,$="pitch"in l?+l.pitch:I,X="padding"in l?l.padding:x.padding,K=x.zoomScale(B-E),se=o.pointGeometry.convert(l.offset);let re=x.centerPoint.add(se);const ae=x.pointLocation(re),Pe=o.LngLat.convert(l.center||ae);this._normalizeCenter(Pe);const ie=x.project(ae),Ae=x.project(Pe).sub(ie);let Se=l.curve;const be=Math.max(x.width,x.height),we=be/K,Ie=Ae.mag();if("minZoom"in l){const Rt=o.clamp(Math.min(l.minZoom,E,B),x.minZoom,x.maxZoom),sn=be/x.zoomScale(Rt-E);Se=Math.sqrt(sn/Ie*2)}const Ke=Se*Se;function st(Rt){const sn=(we*we-be*be+(Rt?-1:1)*Ke*Ke*Ie*Ie)/(2*(Rt?we:be)*Ke*Ie);return Math.log(Math.sqrt(sn*sn+1)-sn)}function It(Rt){return(Math.exp(Rt)-Math.exp(-Rt))/2}function Et(Rt){return(Math.exp(Rt)+Math.exp(-Rt))/2}const bt=st(0);let ut=function(Rt){return Et(bt)/Et(bt+Se*Rt)},it=function(Rt){return be*((Et(bt)*(It(sn=bt+Se*Rt)/Et(sn))-It(bt))/Ke)/Ie;var sn},vt=(st(1)-bt)/Se;if(Math.abs(Ie)<1e-6||!isFinite(vt)){if(Math.abs(be-we)<1e-6)return this.easeTo(l,p);const Rt=we<be?-1:1;vt=Math.abs(Math.log(we/be))/Se,it=function(){return 0},ut=function(sn){return Math.exp(Rt*Se*sn)}}l.duration="duration"in l?+l.duration:1e3*vt/("screenSpeed"in l?+l.screenSpeed/Se:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const dt=A!==j,nn=$!==I,hn=!x.isPaddingEqual(X),In=Rt=>sn=>{const _n=sn*vt,Jn=1/ut(_n);Rt.zoom=sn===1?B:E+Rt.scaleZoom(Jn),dt&&(Rt.bearing=o.number(A,j,sn)),nn&&(Rt.pitch=o.number(I,$,sn)),hn&&(Rt.interpolatePadding(D,X,sn),re=Rt.centerPoint.add(se));const hr=sn===1?Pe:Rt.unproject(ie.add(Ae.mult(it(_n))).mult(Jn));return Rt.setLocationAtPoint(Rt.renderWorldCopies?hr.wrap():hr,re),Rt._updateCenterElevation(),l.preloadOnly||this._fireMoveEvents(p),Rt};if(l.preloadOnly){const Rt=this._emulate(In,l.duration,x);return this._preloadTiles(Rt),this}return this._zooming=!0,this._rotating=dt,this._pitching=nn,this._padding=hn,this._prepareEase(p,!1),this._ease(In(x),()=>this._afterEase(p),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,p)}if(!l){const x=this.handlers;x&&x.stop(!1)}return this}_ease(l,p,x){x.animate===!1||x.duration===0?(l(1),p()):(this._easeStart=o.exported.now(),this._easeOptions=x,this._onEaseFrame=l,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,p){l=o.wrap(l,-180,180);const x=Math.abs(l-p);return Math.abs(l-360-p)<x&&(l-=360),Math.abs(l+360-p)<x&&(l+=360),l}_normalizeCenter(l){const p=this.transform;if(!p.renderWorldCopies||p.maxBounds)return;const x=l.lng-p.center.lng;l.lng+=x>180?-360:x<-180?360:0}_emulate(l,p,x){const E=Math.ceil(15*p/1e3),A=[],I=l(x.clone());for(let D=0;D<=E;D++){const B=I(D/E);A.push(B.clone())}return A}}class sa{constructor(l={}){this.options=l,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const p=this.options&&this.options.compact;return this._map=l,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=V.create("button","mapboxgl-ctrl-attrib-button",this._container),V.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),p===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,p){const x=this._map._getUIString(`AttributionControl.${p}`);l.setAttribute("aria-label",x),l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",x)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(l){const x=p.reduce((E,A,I)=>(A.value&&(E+=`${A.key}=${A.value}${I<p.length-1?"&":""}`),E),"?");l.href=`${o.config.FEEDBACK_URL}/${x}${this._map._hash?this._map._hash.getHashString(!0):""}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const p=this._map.style._sourceCaches;for(const E in p){const A=p[E];if(A.used){const I=A.getSource();I.attribution&&l.indexOf(I.attribution)<0&&l.push(I.attribution)}}l.sort((E,A)=>E.length-A.length),l=l.filter((E,A)=>{for(let I=A+1;I<l.length;I++)if(l[I].indexOf(E)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const x=l.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,l.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Sa{constructor(){o.bindAll(["_updateLogo"],this),o.bindAll(["_updateCompact"],this)}onAdd(l){this._map=l,this._container=V.create("div","mapboxgl-ctrl");const p=V.create("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const p in l){const x=l[p].getSource();if(x.hasOwnProperty("mapbox_logo")&&!x.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const p=l[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}}}class Li{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const p=++this._id;return this._queue.push({callback:l,id:p,cancelled:!1}),p}remove(l){const p=this._currentlyRunning,x=p?this._queue.concat(p):this._queue;for(const E of x)if(E.id===l)return void(E.cancelled=!0)}run(l=0){const p=this._currentlyRunning=this._queue;this._queue=[];for(const x of p)if(!x.cancelled&&(x.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function t1(v,l,p){if(v=new o.LngLat(v.lng,v.lat),l){const x=new o.LngLat(v.lng-360,v.lat),E=new o.LngLat(v.lng+360,v.lat),A=360*Math.ceil(Math.abs(v.lng-p.center.lng)/360),I=p.locationPoint(v).distSqr(l),D=l.x<0||l.y<0||l.x>p.width||l.y>p.height;p.locationPoint(x).distSqr(l)<I&&(D||Math.abs(x.lng-p.center.lng)<A)?v=x:p.locationPoint(E).distSqr(l)<I&&(D||Math.abs(E.lng-p.center.lng)<A)&&(v=E)}for(;Math.abs(v.lng-p.center.lng)>180;){const x=p.locationPoint(v);if(x.x>=0&&x.y>=0&&x.x<=p.width&&x.y<=p.height)break;v.lng>p.center.lng?v.lng-=360:v.lng+=360}return v}const ai={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class $c extends o.Evented{constructor(l,p){if(super(),(l instanceof o.window.HTMLElement||p)&&(l=o.extend({element:l},p)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),l&&l.element)this._element=l.element,this._offset=o.pointGeometry.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div");const E=41,A=27,I=V.createSVG("svg",{display:"block",height:E*this._scale+"px",width:A*this._scale+"px",viewBox:`0 0 ${A} ${E}`},this._element),D=V.createSVG("radialGradient",{id:"shadowGradient"},V.createSVG("defs",{},I));V.createSVG("stop",{offset:"10%","stop-opacity":.4},D),V.createSVG("stop",{offset:"100%","stop-opacity":.05},D),V.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),V.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),V.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),V.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=o.pointGeometry.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",E=>{E.preventDefault()}),this._element.addEventListener("mousedown",E=>{E.preventDefault()});const x=this._element.classList;for(const E in ai)x.remove(`mapboxgl-marker-anchor-${E}`);x.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=o.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const E=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[E,-1*(38.1-13.5+E)],"bottom-right":[-E,-1*(38.1-13.5+E)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const p=l.code,x=l.charCode||l.keyCode;p!=="Space"&&p!=="Enter"&&x!==32&&x!==13||this.togglePopup()}_onMapClick(l){const p=l.originalEvent.target,x=this._element;this._popup&&(p===x||x.contains(p))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const l=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(l))return void this._clearFadeTimer();const p=this._map.unproject(l);let x=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const A=this._map.getFreeCameraOptions();if(A.position){const I=A.position.toLngLat();x=I.distanceTo(p)<.9*I.distanceTo(this._lngLat)}}const E=(1-this._map._queryFogOpacity(p))*(x?.2:1);this._element.style.opacity=`${E}`,this._popup&&this._popup._setOpacity(`${E}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(l){const p=this._map.transform;return!!l&&l.x>=0&&l.x<p.width&&l.y>=0&&l.y<p.height}_updateDOM(){const l=this._pos||new o.pointGeometry(0,0),p=this._calculatePitch(),x=this._calculateRotation();this._element.style.transform=`${ai[this._anchor]} translate(${l.x}px, ${l.y}px) rotateX(${p}deg) rotateZ(${x}deg)`}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(l){o.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=t1(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),l===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const l=this._map.transform,p=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&p._rotate(l.angle),this._pitchAlignment==="map"&&(p.y*=Math.cos(l._pitch)),p}getOffset(){return this._offset}setOffset(l){return this._offset=o.pointGeometry.convert(l),this._update(),this}_onMove(l){if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(l){this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Us{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const p=o.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-p)+this._end*p}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,p,x){this._start=this.getValue(p),this._end=l,this._startTime=p,this._endTime=p+x}}const Y3={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Is,HTMLElement:Vs,ImageBitmap:n1}=o.window,K3={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function H1(v){v.parentNode&&v.parentNode.removeChild(v)}const gu={showCompass:!0,showZoom:!0,visualizePitch:!1};class J3{constructor(l,p,x=!1){this._clickTolerance=10,this.element=p,this.mouseRotate=new hs({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,x&&(this.mousePitch=new j1({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),p.addEventListener("mousedown",this.mousedown),p.addEventListener("touchstart",this.touchstart,{passive:!1}),p.addEventListener("touchmove",this.touchmove),p.addEventListener("touchend",this.touchend),p.addEventListener("touchcancel",this.reset)}down(l,p){this.mouseRotate.mousedown(l,p),this.mousePitch&&this.mousePitch.mousedown(l,p),V.disableDrag()}move(l,p){const x=this.map,E=this.mouseRotate.mousemoveWindow(l,p);if(E&&E.bearingDelta&&x.setBearing(x.getBearing()+E.bearingDelta),this.mousePitch){const A=this.mousePitch.mousemoveWindow(l,p);A&&A.pitchDelta&&x.setPitch(x.getPitch()+A.pitchDelta)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(o.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),V.mousePos(this.element,l)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,V.mousePos(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const cl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let ts,Aa=0,ul=!1;const r1={maxWidth:100,unit:"metric"};function Xt(v,l,p){const x=p&&p.maxWidth||100,E=v._containerHeight/2,A=v.unproject([0,E]),I=v.unproject([x,E]),D=A.distanceTo(I);if(p&&p.unit==="imperial"){const B=3.2808*D;B>5280?hl(l,x,B/5280,v._getUIString("ScaleControl.Miles"),v):hl(l,x,B,v._getUIString("ScaleControl.Feet"),v)}else p&&p.unit==="nautical"?hl(l,x,D/1852,v._getUIString("ScaleControl.NauticalMiles"),v):D>=1e3?hl(l,x,D/1e3,v._getUIString("ScaleControl.Kilometers"),v):hl(l,x,D,v._getUIString("ScaleControl.Meters"),v)}function hl(v,l,p,x,E){const A=function(D){const B=Math.pow(10,`${Math.floor(D)}`.length-1);let j=D/B;return j=j>=10?10:j>=5?5:j>=3?3:j>=2?2:j>=1?1:function($){const X=Math.pow(10,Math.ceil(-Math.log($)/Math.LN10));return Math.round($*X)/X}(j),B*j}(p),I=A/p;E._requestDomTask(()=>{v.style.width=l*I+"px",v.innerHTML=`${A}&nbsp;${x}`})}const Wc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},X1=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Fi={version:o.version,supported:T,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends es{constructor(v){if((v=o.extend({},K3,v)).minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(v.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(v.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new tl(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies),v),this._interactive=v.interactive,this._minTileCacheSize=v.minTileCacheSize,this._maxTileCacheSize=v.maxTileCacheSize,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=v.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=v.collectResourceTiming,this._optimizeForTerrain=v.optimizeForTerrain,this._renderTaskQueue=new Li,this._domRenderTaskQueue=new Li,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Y3,v.locale),this._clickTolerance=v.clickTolerance,this._cooperativeGestures=v.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Us(0),this._requestManager=new o.RequestManager(v.transformRequest,v.accessToken,v.testMode),this._silenceAuthErrors=!!v.testMode,typeof v.container=="string"){if(this._container=o.window.document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof Vs))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),v.maxBounds&&this.setMaxBounds(v.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ps(this,v),this._localFontFamily=v.localFontFamily,this._localIdeographFontFamily=v.localIdeographFontFamily,v.style&&this.setStyle(v.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),v.projection&&this.setProjection(v.projection),this._hash=v.hash&&new nl(typeof v.hash=="string"&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,o.extend({},v.fitBoundsOptions,{duration:0})))),this.resize(),v.attributionControl&&this.addControl(new sa({customAttribution:v.customAttribution})),this._logoControl=new Sa,this.addControl(this._logoControl,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new o.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new o.Event(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(v,l){if(l===void 0&&(l=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=v.onAdd(this);this._controls.push(v);const x=this._controlPositions[l];return l.indexOf("bottom")!==-1?x.insertBefore(p,x.firstChild):x.appendChild(p),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(v);return l>-1&&this._controls.splice(l,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(v){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new o.Event("movestart",v)).fire(new o.Event("move",v)),this.fire(new o.Event("resize",v)),l&&this.fire(new o.Event("moveend",v)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(v){return this.transform.setMaxBounds(o.LngLatBounds.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v?this.setZoom(v):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v?this.setZoom(v):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v?this.setPitch(v):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v?this.setPitch(v):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}getProjection(){return this.transform.getProjection()}setProjection(v){return this._lazyInitEmptyStyle(),typeof v=="string"&&(v={name:v}),this._runtimeProjection=v,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(v){return this.transform.locationPoint3D(o.LngLat.convert(v))}unproject(v){return this.transform.pointLocation3D(o.pointGeometry.convert(v))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(v,l,p){if(v==="mouseenter"||v==="mouseover"){let x=!1;const E=I=>{const D=l.filter(j=>this.getLayer(j)),B=D.length?this.queryRenderedFeatures(I.point,{layers:D}):[];B.length?x||(x=!0,p.call(this,new mi(v,this,I.originalEvent,{features:B}))):x=!1},A=()=>{x=!1};return{layers:new Set(l),listener:p,delegates:{mousemove:E,mouseout:A}}}if(v==="mouseleave"||v==="mouseout"){let x=!1;const E=I=>{const D=l.filter(B=>this.getLayer(B));(D.length?this.queryRenderedFeatures(I.point,{layers:D}):[]).length?x=!0:x&&(x=!1,p.call(this,new mi(v,this,I.originalEvent)))},A=I=>{x&&(x=!1,p.call(this,new mi(v,this,I.originalEvent)))};return{layers:new Set(l),listener:p,delegates:{mousemove:E,mouseout:A}}}{const x=E=>{const A=l.filter(D=>this.getLayer(D)),I=A.length?this.queryRenderedFeatures(E.point,{layers:A}):[];I.length&&(E.features=I,p.call(this,E),delete E.features)};return{layers:new Set(l),listener:p,delegates:{[v]:x}}}}on(v,l,p){if(p===void 0)return super.on(v,l);Array.isArray(l)||(l=[l]);const x=this._createDelegatedListener(v,l,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(x);for(const E in x.delegates)this.on(E,x.delegates[E]);return this}once(v,l,p){if(p===void 0)return super.once(v,l);Array.isArray(l)||(l=[l]);const x=this._createDelegatedListener(v,l,p);for(const E in x.delegates)this.once(E,x.delegates[E]);return this}off(v,l,p){if(p===void 0)return super.off(v,l);l=new Set(Array.isArray(l)?l:[l]);const x=(A,I)=>{if(A.size!==I.size)return!1;for(const D of A)if(!I.has(D))return!1;return!0},E=this._delegatedListeners?this._delegatedListeners[v]:void 0;return E&&(A=>{for(let I=0;I<A.length;I++){const D=A[I];if(D.listener===p&&x(D.layers,l)){for(const B in D.delegates)this.off(B,D.delegates[B]);return A.splice(I,1),this}}})(E),this}queryRenderedFeatures(v,l){return this.style?(l!==void 0||v===void 0||v instanceof o.pointGeometry||Array.isArray(v)||(l=v,v=void 0),this.style.queryRenderedFeatures(v=v||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(v,l){return this.style.querySourceFeatures(v,l)}queryTerrainElevation(v,l){const p=this.transform.elevation;return p?(l=o.extend({},{exaggerated:!0},l),p.getAtPoint(o.MercatorCoordinate.fromLngLat(v),null,l.exaggerated)):null}setStyle(v,l){return(l=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&v?(this._diffStyle(v,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(v,l))}_getUIString(v){const l=this._locale[v];if(l==null)throw new Error(`Missing UI string '${v}'`);return l}_updateStyle(v,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),v&&(this.style=new oi(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v):this.style.loadJSON(v)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new oi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,l){if(typeof v=="string"){const p=this._requestManager.normalizeStyleURL(v),x=this._requestManager.transformRequest(p,o.ResourceType.Style);o.getJSON(x,(E,A)=>{E?this.fire(new o.ErrorEvent(E)):A&&this._updateDiff(A,l)})}else typeof v=="object"&&this._updateDiff(v,l)}_updateDiff(v,l){try{this.style.setState(v)&&this._update(!0)}catch(p){o.warnOnce(`Unable to perform style diff: ${p.message||p.error||p}.  Rebuilding the style from scratch.`),this._updateStyle(v,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(v,l){return this._lazyInitEmptyStyle(),this.style.addSource(v,l),this._update(!0)}isSourceLoaded(v){const l=this.style&&this.style._getSourceCaches(v);if(l.length!==0)return l.every(p=>p.loaded());this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${v}'`)))}areTilesLoaded(){const v=this.style&&this.style._sourceCaches;for(const l in v){const p=v[l]._tiles;for(const x in p){const E=p[x];if(E.state!=="loaded"&&E.state!=="errored")return!1}}return!0}addSourceType(v,l,p){return this._lazyInitEmptyStyle(),this.style.addSourceType(v,l,p)}removeSource(v){return this.style.removeSource(v),this._updateTerrain(),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,l,{pixelRatio:p=1,sdf:x=!1,stretchX:E,stretchY:A,content:I}={}){if(this._lazyInitEmptyStyle(),l instanceof Is||n1&&l instanceof n1){const{width:D,height:B,data:j}=o.exported.getImageData(l);this.style.addImage(v,{data:new o.RGBAImage({width:D,height:B},j),pixelRatio:p,stretchX:E,stretchY:A,content:I,sdf:x,version:0})}else{if(l.width===void 0||l.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:B,data:j}=l,$=l;this.style.addImage(v,{data:new o.RGBAImage({width:D,height:B},new Uint8Array(j)),pixelRatio:p,stretchX:E,stretchY:A,content:I,sdf:x,version:0,userImage:$}),$.onAdd&&$.onAdd(this,v)}}}updateImage(v,l){const p=this.style.getImage(v);if(!p)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=l instanceof Is||n1&&l instanceof n1?o.exported.getImageData(l):l,{width:E,height:A,data:I}=x;return E===void 0||A===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):E!==p.data.width||A!==p.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(p.data.replace(I,!(l instanceof Is||n1&&l instanceof n1)),void this.style.updateImage(v,p))}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v,l){o.getImage(this._requestManager.transformRequest(v,o.ResourceType.Image),(p,x)=>{l(p,x instanceof Is?o.exported.getImageData(x):x)})}listImages(){return this.style.listImages()}addLayer(v,l){return this._lazyInitEmptyStyle(),this.style.addLayer(v,l),this._update(!0)}moveLayer(v,l){return this.style.moveLayer(v,l),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}setLayerZoomRange(v,l,p){return this.style.setLayerZoomRange(v,l,p),this._update(!0)}setFilter(v,l,p={}){return this.style.setFilter(v,l,p),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,l,p,x={}){return this.style.setPaintProperty(v,l,p,x),this._update(!0)}getPaintProperty(v,l){return this.style.getPaintProperty(v,l)}setLayoutProperty(v,l,p,x={}){return this.style.setLayoutProperty(v,l,p,x),this._update(!0)}getLayoutProperty(v,l){return this.style.getLayoutProperty(v,l)}setLight(v,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(v){return this._lazyInitEmptyStyle(),!v&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(v),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){this.transform.projection.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(v){return this._lazyInitEmptyStyle(),this.style.setFog(v),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(v){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(v),this.transform):0}setFeatureState(v,l){return this.style.setFeatureState(v,l),this._update()}removeFeatureState(v,l){return this.style.removeFeatureState(v,l),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}_updateContainerDimensions(){if(!this._container)return;const v=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let p,x=this._container;for(;x&&!p;){const E=o.window.getComputedStyle(x).transform;E&&E!=="none"&&(p=E.match(/matrix.*\((.+)\)/)[1].split(", ")),x=x.parentElement}p?(this._containerWidth=p[0]&&p[0]!=="0"?Math.abs(v/p[0]):v,this._containerHeight=p[3]&&p[3]!=="0"?Math.abs(l/p[3]):l):(this._containerWidth=v,this._containerHeight=l)}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const v=this._container;v.classList.add("mapboxgl-map"),(this._missingCSSCanary=V.create("div","mapboxgl-canary",v)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=V.create("div","mapboxgl-canvas-container",v);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=V.create("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const p=this._controlContainer=V.create("div","mapboxgl-control-container",v),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{x[E]=V.create("div",`mapboxgl-ctrl-${E}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,l){const p=o.exported.devicePixelRatio||1;this._canvas.width=p*Math.ceil(v),this._canvas.height=p*Math.ceil(l),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${l}px`}_addMarker(v){this._markers.push(v)}_removeMarker(v){const l=this._markers.indexOf(v);l!==-1&&this._markers.splice(l,1)}_setupPainter(){const v=o.extend({},T.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl",v)||this._canvas.getContext("experimental-webgl",v);l?(o.storeAuthState(l,!0),this.painter=new W3(l,this.transform),this.on("data",p=>{p.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(l)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(v){v.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:v}))}_contextRestored(v){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:v}))}_onMapScroll(v){if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_requestDomTask(v){!this.loaded()||this.loaded()&&!this.isMoving()?v():this._domRenderTaskQueue.add(v)}_render(v){let l;const p=this.painter.context.extTimerQuery,x=o.exported.now();this.listens("gpu-timing-frame")&&(l=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,l));let E=this._updateAverageElevation(x);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._domRenderTaskQueue.run(v),this._removed)return;this._updateProjection();let A=!1;const I=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,j=this.transform.pitch,$=o.exported.now();this.style.zoomHistory.update(B,$);const X=new o.EvaluationParameters(B,{now:$,fadeDuration:I,pitch:j,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),K=X.crossFadingFactor();K===1&&K===this._crossFadingFactor||(A=!0,this._crossFadingFactor=K),this.style.update(X)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,I,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||A)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const B=o.exported.now()-x;p.endQueryEXT(p.TIME_ELAPSED_EXT,l),setTimeout(()=>{const j=p.getQueryObjectEXT(l,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(l),this.fire(new o.Event("gpu-timing-frame",{cpuTime:B,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const B=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(B);this.fire(new o.Event("gpu-timing-layer",{layerTimes:j}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(D||this._repaint)this.triggerRepaint();else{const B=!this.isMoving()&&this.loaded();if(B&&(E=this._updateAverageElevation(x,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),B&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const v of this._markers)v._update()}_updateAverageElevation(v,l=!1){const p=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&p(0);if((l||v-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(v)){const x=this.transform.averageElevation;let E=this.transform.sampleAverageElevation();isNaN(E)?E=0:this._averageElevationLastSampledAt=v;const A=Math.abs(x-E);if(A>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(E),p(E);this._averageElevation.easeTo(E,v,300)}else if(A>1e-4)return this._averageElevation.jumpTo(E),p(E)}return!!this._averageElevation.isEasing(v)&&p(this._averageElevation.getValue(v))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,v=>{if(v&&(v.message===o.AUTH_ERR_MSG||v.status===401)){const l=this.painter.context.gl;o.storeAuthState(l,!1),this._logoControl instanceof Sa&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const v=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const p=this.painter.context.gl,x=p.createFramebuffer();function E(A){p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,A,0);const I=new Uint8Array(p.drawingBufferWidth*p.drawingBufferHeight*4);return p.readPixels(0,0,p.drawingBufferWidth,p.drawingBufferHeight,p.RGBA,p.UNSIGNED_BYTE,I),I}return p.bindFramebuffer(p.FRAMEBUFFER,x),this._canvasPixelComparison(E(v),l.canvasCopies.map(E),l.timeStamps)}_canvasPixelComparison(v,l,p){let x=p[1]-p[0];const E=v.length/4;for(let A=0;A<l.length;A++){const I=l[A];let D=0;for(let B=0;B<I.length;B+=4)I[B]===v[B]&&I[B+1]===v[B+1]&&I[B+2]===v[B+2]&&I[B+3]===v[B+3]&&(D+=1);x+=(p[A+2]-p[A+1])*(1-D/E)}return x}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));const v=this.painter.context.gl.getExtension("WEBGL_lose_context");v&&v.loseContext(),H1(this._canvasContainer),H1(this._controlContainer),H1(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(v){this._renderNextFrame=this._renderNextFrame||v,this.style&&!this._frame&&(this._frame=o.exported.frame(l=>{const p=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,p&&this._render(l)}))}_preloadTiles(v){const l=this.style&&Object.values(this.style._sourceCaches)||[];return o.asyncAll(l,(p,x)=>p._preloadTiles(v,x),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(v){this._trackResize&&this.resize({originalEvent:v})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(v){this._showTerrainWireframe!==v&&(this._showTerrainWireframe=v,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(v){this._speedIndexTiming!==v&&(this._speedIndexTiming=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}_setCacheLimits(v,l){o.setCacheLimits(v,l)}get version(){return o.version}},NavigationControl:class{constructor(v){this.options=o.extend({},gu,v),this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),V.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),V.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=V.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const v=this._map.getZoom(),l=v===this._map.getMaxZoom(),p=v===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const v=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=v)})}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new J3(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,l){const p=V.create("button",v,this._container);return p.type="button",p.addEventListener("click",l),p}_setButtonTitle(v,l){const p=this._map._getUIString(`NavigationControl.${l}`);v.setAttribute("aria-label",p),v.firstElementChild&&v.firstElementChild.setAttribute("title",p)}},GeolocateControl:class extends o.Evented{constructor(v){super(),this.options=o.extend({},cl,v),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=ba(this._updateMarkerRotation,20)}onAdd(v){var l;return this._map=v,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),l=this._setupUI,ts!==void 0?l(ts):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(p=>{ts=p.state!=="denied",l(ts)}):(ts=!!o.window.navigator.geolocation,l(ts)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Aa=0,ul=!1}_isOutOfMapMaxBounds(v){const l=this._map.getMaxBounds(),p=v.coords;return l&&(p.longitude<l.getWest()||p.longitude>l.getEast()||p.latitude<l.getSouth()||p.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(v){if(this._map){if(this._isOutOfMapMaxBounds(v))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",v)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=v,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(v),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(v),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",v)),this._finish()}}_updateCamera(v){const l=new o.LngLat(v.coords.longitude,v.coords.latitude),p=v.coords.accuracy,x=this._map.getBearing(),E=o.extend({bearing:x},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(p),E,{geolocateSource:!0})}_updateMarker(v){if(v){const l=new o.LngLat(v.coords.longitude,v.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=v.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const v=this._map._containerHeight/2,l=this._map.unproject([0,v]),p=this._map.unproject([100,v]),x=l.distanceTo(p)/100,E=Math.ceil(2*this._accuracy/x);this._circleElement.style.width=`${E}px`,this._circleElement.style.height=`${E}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(v){if(this._map){if(this.options.trackUserLocation)if(v.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(v.code===3&&ul)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",v)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(v){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=V.create("button","mapboxgl-ctrl-geolocate",this._container),V.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",v===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","mapboxgl-user-location"),this._dotElement.appendChild(V.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(V.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new $c({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=V.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $c({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(v){this._userLocationDotMarker&&(v.webkitCompassHeading?this._heading=v.webkitCompassHeading:v.absolute===!0&&(this._heading=-1*v.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Aa--,ul=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Aa++,Aa>1?(v={maximumAge:6e5,timeout:0},ul=!0):(v=this.options.positionOptions,ul=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const v=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&v()}).catch(console.error):v()}_clearWatch(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:sa,ScaleControl:class{constructor(v){this.options=o.extend({},r1,v),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Xt(this._map,this._container,this.options)}onAdd(v){return this._map=v,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(v){this.options.unit=v,Xt(this._map,this._container,this.options)}},FullscreenControl:class{constructor(v){this._fullscreen=!1,v&&v.container&&(v.container instanceof o.window.HTMLElement?this._container=v.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const v=this._fullscreenButton=V.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);V.create("span","mapboxgl-ctrl-icon",v).setAttribute("aria-hidden",!0),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",v)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(v){super(),this.options=o.extend(Object.create(Wc),v),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(v&&v.className?v.className.trim().split(/\s+/):[])}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=o.LngLat.convert(v),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(o.window.document.createTextNode(v))}setHTML(v){const l=o.window.document.createDocumentFragment(),p=o.window.document.createElement("body");let x;for(p.innerHTML=v;x=p.firstChild,x;)l.appendChild(x);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._classList.add(v),this._container&&this._updateClassList(),this}removeClassName(v){return this._classList.delete(v),this._container&&this._updateClassList(),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){let l;return this._classList.delete(v)?l=!1:(this._classList.add(v),l=!0),this._container&&this._updateClassList(),l}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(v){this._update(v.point)}_onMouseMove(v){this._update(v.point)}_onDrag(v){this._update(v.point)}_getAnchor(v){if(this.options.anchor)return this.options.anchor;const l=this._pos,p=this._container.offsetWidth,x=this._container.offsetHeight;let E;return E=l.y+v.bottom.y<x?["top"]:l.y>this._map.transform.height-x?["bottom"]:[],l.x<p/2?E.push("left"):l.x>this._map.transform.width-p/2&&E.push("right"),E.length===0?"bottom":E.join("-")}_updateClassList(){const v=[...this._classList];v.push("mapboxgl-popup"),this._anchor&&v.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&v.push("mapboxgl-popup-track-pointer"),this._container.className=v.join(" ")}_update(v){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=V.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=V.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=t1(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||v){const l=this._pos=this._trackPointer&&v?v:this._map.project(this._lngLat),p=function(A){if(A||(A=new o.pointGeometry(0,0)),typeof A=="number"){const I=Math.round(Math.sqrt(.5*Math.pow(A,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,A),"top-left":new o.pointGeometry(I,I),"top-right":new o.pointGeometry(-I,I),bottom:new o.pointGeometry(0,-A),"bottom-left":new o.pointGeometry(I,-I),"bottom-right":new o.pointGeometry(-I,-I),left:new o.pointGeometry(A,0),right:new o.pointGeometry(-A,0)}}if(A instanceof o.pointGeometry||Array.isArray(A)){const I=o.pointGeometry.convert(A);return{center:I,top:I,"top-left":I,"top-right":I,bottom:I,"bottom-left":I,"bottom-right":I,left:I,right:I}}return{center:o.pointGeometry.convert(A.center||[0,0]),top:o.pointGeometry.convert(A.top||[0,0]),"top-left":o.pointGeometry.convert(A["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(A["top-right"]||[0,0]),bottom:o.pointGeometry.convert(A.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(A["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(A["bottom-right"]||[0,0]),left:o.pointGeometry.convert(A.left||[0,0]),right:o.pointGeometry.convert(A.right||[0,0])}}(this.options.offset),x=this._anchor=this._getAnchor(p),E=l.add(p[x]).round();this._map._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${ai[x]} translate(${E.x}px,${E.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(X1);v&&v.focus()}_onClose(){this.remove()}_setOpacity(v){this._content&&(this._content.style.opacity=v),this._tip&&(this._tip.style.opacity=v)}},Marker:$c,Style:oi,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:Q0,Evented:o.Evented,config:o.config,prewarm:function(){Le().acquire(Re)},clearPrewarmedResources:function(){const v=Ve;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Re),Ve=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(v){o.config.ACCESS_TOKEN=v},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(v){o.config.API_URL=v},get workerCount(){return $e.workerCount},set workerCount(v){$e.workerCount=v},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(v){o.config.MAX_PARALLEL_IMAGE_REQUESTS=v},clearStorage(v){o.clearTileCache(v)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Fi});var m=u;return m})}(t7)),t7.exports}var mE=pE();const w1=L2(mE);var gE=1e-7;function k9(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function by(n,e){if(n===e)return!0;if(k9(n)&&k9(e)){if(n.length!==e.length)return!1;for(var t=0;t<n.length;++t)if(!by(n[t],e[t]))return!1;return!0}return Math.abs(n-e)<=gE}function R8(n,e,t){return Math.max(e,Math.min(t,n))}function y7(n,e,t){return k9(n)?n.map(function(r,s){return y7(r,e[s],t)}):t*e+(1-t)*n}function Ml(n,e){if(!n)throw new Error(e||"react-map-gl: assertion failed.")}function Fp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Np(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Fp(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Fp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var R0={minZoom:0,maxZoom:24,minPitch:0,maxPitch:85},k5={pitch:0,bearing:0,altitude:1.5},Bp=5,_E=1.2,q4=function(){function n(e){var t=e.width,r=e.height,s=e.latitude,u=e.longitude,f=e.zoom,m=e.bearing,o=m===void 0?k5.bearing:m,T=e.pitch,C=T===void 0?k5.pitch:T,R=e.altitude,O=R===void 0?k5.altitude:R,U=e.maxZoom,V=U===void 0?R0.maxZoom:U,Y=e.minZoom,ee=Y===void 0?R0.minZoom:Y,le=e.maxPitch,Ee=le===void 0?R0.maxPitch:le,ue=e.minPitch,_e=ue===void 0?R0.minPitch:ue,Me=e.transitionDuration,Fe=e.transitionEasing,yt=e.transitionInterpolator,xt=e.transitionInterruption,ht=e.startPanLngLat,kt=e.startZoomLngLat,Bt=e.startRotatePos,Vt=e.startBearing,$t=e.startPitch,Ct=e.startZoom;P3(this,n),Ml(Number.isFinite(t),"`width` must be supplied"),Ml(Number.isFinite(r),"`height` must be supplied"),Ml(Number.isFinite(u),"`longitude` must be supplied"),Ml(Number.isFinite(s),"`latitude` must be supplied"),Ml(Number.isFinite(f),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:t,height:r,latitude:s,longitude:u,zoom:f,bearing:o,pitch:C,altitude:O,maxZoom:V,minZoom:ee,maxPitch:Ee,minPitch:_e,transitionDuration:Me,transitionEasing:Fe,transitionInterpolator:yt,transitionInterruption:xt}),this._state={startPanLngLat:ht,startZoomLngLat:kt,startRotatePos:Bt,startBearing:Vt,startPitch:$t,startZoom:Ct}}return I3(n,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(t){var r=t.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(r)})}},{key:"pan",value:function(t){var r=t.pos,s=t.startPos,u=this._state.startPanLngLat||this._unproject(s);if(!u)return this;var f=this._calculateNewLngLat({startPanLngLat:u,pos:r}),m=Hi(f,2),o=m[0],T=m[1];return this._getUpdatedMapState({longitude:o,latitude:T})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){var r=t.pos;return this._getUpdatedMapState({startRotatePos:r,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var r=t.pos,s=t.deltaAngleX,u=s===void 0?0:s,f=t.deltaAngleY,m=f===void 0?0:f,o=this._state,T=o.startRotatePos,C=o.startBearing,R=o.startPitch;if(!Number.isFinite(C)||!Number.isFinite(R))return this;var O;return r?O=this._calculateNewPitchAndBearing(Np(Np({},this._getRotationParams(r,T)),{},{startBearing:C,startPitch:R})):O={bearing:C+u,pitch:R+m},this._getUpdatedMapState(O)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var r=t.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(r),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var r=t.pos,s=t.startPos,u=t.scale;Ml(u>0,"`scale` must be a positive number");var f=this._state,m=f.startZoom,o=f.startZoomLngLat;Number.isFinite(m)||(m=this._viewportProps.zoom,o=this._unproject(s)||this._unproject(r)),Ml(o,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var T=this._calculateNewZoom({scale:u,startZoom:m||0}),C=new O0(Object.assign({},this._viewportProps,{zoom:T})),R=C.getMapCenterByLngLatPosition({lngLat:o,pos:r}),O=Hi(R,2),U=O[0],V=O[1];return this._getUpdatedMapState({zoom:T,longitude:U,latitude:V})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(t){return new n(Object.assign({},this._viewportProps,this._state,t))}},{key:"_applyConstraints",value:function(t){var r=t.maxZoom,s=t.minZoom,u=t.zoom;t.zoom=R8(u,s,r);var f=t.maxPitch,m=t.minPitch,o=t.pitch;return t.pitch=R8(o,m,f),Object.assign(t,zT(t)),t}},{key:"_unproject",value:function(t){var r=new O0(this._viewportProps);return t&&r.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var r=t.startPanLngLat,s=t.pos,u=new O0(this._viewportProps);return u.getMapCenterByLngLatPosition({lngLat:r,pos:s})}},{key:"_calculateNewZoom",value:function(t){var r=t.scale,s=t.startZoom,u=this._viewportProps,f=u.maxZoom,m=u.minZoom,o=s+Math.log2(r);return R8(o,m,f)}},{key:"_calculateNewPitchAndBearing",value:function(t){var r=t.deltaScaleX,s=t.deltaScaleY,u=t.startBearing,f=t.startPitch;s=R8(s,-1,1);var m=this._viewportProps,o=m.minPitch,T=m.maxPitch,C=u+180*r,R=f;return s>0?R=f+s*(T-f):s<0&&(R=f-s*(o-f)),{pitch:R,bearing:C}}},{key:"_getRotationParams",value:function(t,r){var s=t[0]-r[0],u=t[1]-r[1],f=t[1],m=r[1],o=this._viewportProps,T=o.width,C=o.height,R=s/T,O=0;return u>0?Math.abs(C-m)>Bp&&(O=u/(m-C)*_E):u<0&&m>Bp&&(O=1-f/m),O=Math.min(1,Math.max(-1,O)),{deltaScaleX:R,deltaScaleY:O}}}]),n}();function yE(n){return n[0].toLowerCase()+n.slice(1)}function vE(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:R0;for(var t in e){var r=t.slice(0,3),s=yE(t.slice(3));if(r==="min"&&n[s]<e[t]||r==="max"&&n[s]>e[t])return!1}return!0}function zp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Up(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?zp(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):zp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var hu=lt.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),Lh=hu.Provider;function xE(n){var e=n.value,t=n.children,r=lt.useState(null),s=Hi(r,2),u=s[0],f=s[1],m=lt.useContext(hu);return e=Up(Up({setMap:f},m),{},{map:m&&m.map||u},e),lt.createElement(Lh,{value:e},t)}hu.Provider=xE;var O9=typeof window<"u"?lt.useLayoutEffect:lt.useEffect;function m6(n,e){var t=e.longitude,r=e.latitude;return n&&n.queryTerrainElevation&&n.queryTerrainElevation([t,r])||0}function Vp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Il(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Vp(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Vp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var bE="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",wy="A valid API access token is required to use Mapbox data";function wE(){}function Ty(n){var e=n.map,t=n.props,r=n.width,s=n.height,u=Il(Il(Il({},t),t.viewState),{},{width:r,height:s});return u.position=[0,0,m6(e,u)],new O0(u)}var TE=401,jp={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},EE=Object.assign({},V0.propTypes,{width:et.oneOfType([et.number,et.string]),height:et.oneOfType([et.number,et.string]),onResize:et.func,disableTokenWarning:et.bool,visible:et.bool,className:et.string,style:et.object,visibilityConstraints:et.object}),SE=Object.assign({},V0.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:wE,className:"",style:null,visibilityConstraints:R0});function AE(){var n={position:"absolute",left:0,top:0};return lt.createElement("div",{key:"warning",id:"no-token-warning",style:n},lt.createElement("h3",{key:"header"},wy),lt.createElement("div",{key:"text"},"For information on setting up your basemap, read"),lt.createElement("a",{key:"link",href:bE},"Note on Map Tokens"))}function CE(n){return{getMap:function(){return n.current&&n.current.getMap()},queryRenderedFeatures:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=n.current&&n.current.getMap();return s&&s.queryRenderedFeatures(t,r)}}}var wc=lt.forwardRef(function(n,e){var t=lt.useState(!0),r=Hi(t,2),s=r[0],u=r[1],f=lt.useState({width:0,height:0}),m=Hi(f,2),o=m[0],T=m[1],C=lt.useRef(null),R=lt.useRef(null),O=lt.useRef(null),U=lt.useRef(null),V=lt.useContext(hu);O9(function(){if(wc.supported()){var kt=new V0(Il(Il(Il({},n),o),{},{mapboxgl:w1,container:R.current,onError:function($t){var Ct=$t.error&&$t.error.status||$t.status;Ct===TE&&s&&(console.error(wy),u(!1)),n.onError($t)}}));C.current=kt,V&&V.setMap&&V.setMap(kt.getMap());var Bt=new oE(function(Vt){if(Vt[0].contentRect){var $t=Vt[0].contentRect,Ct=$t.width,xn=$t.height;T({width:Ct,height:xn}),n.onResize({width:Ct,height:xn})}});return Bt.observe(O.current),function(){kt.finalize(),C.current=null,Bt.disconnect()}}},[]),O9(function(){C.current&&C.current.setProps(Il(Il({},n),o))});var Y=C.current&&C.current.getMap();lt.useImperativeHandle(e,function(){return CE(C)},[]);var ee=lt.useCallback(function(kt){var Bt=kt.target;Bt===U.current&&Bt.scrollTo(0,0)},[]),le=Y&&lt.createElement(Lh,{value:Il(Il({},V),{},{viewport:V.viewport||Ty(Il({map:Y,props:n},o)),map:Y,container:V.container||O.current})},lt.createElement("div",{key:"map-overlays",className:"overlays",ref:U,style:jp,onScroll:ee},n.children)),Ee=n.className,ue=n.width,_e=n.height,Me=n.style,Fe=n.visibilityConstraints,yt=Object.assign({position:"relative"},Me,{width:ue,height:_e}),xt=n.visible&&vE(n.viewState||n,Fe),ht=Object.assign({},jp,{visibility:xt?"inherit":"hidden"});return lt.createElement("div",{key:"map-container",ref:O,style:yt},lt.createElement("div",{key:"map-mapbox",ref:R,style:ht,className:Ee}),le,!s&&!n.disableTokenWarning&&lt.createElement(AE,null))});wc.supported=function(){return w1&&w1.supported()};wc.propTypes=EE;wc.defaultProps=SE;function PE(n,e){var t;if(typeof Symbol>"u"||n[Symbol.iterator]==null){if(Array.isArray(n)||(t=IE(n))||e){t&&(n=t);var r=0,s=function(){};return{s,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(T){throw T},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,f=!1,m;return{s:function(){t=n[Symbol.iterator]()},n:function(){var T=t.next();return u=T.done,T},e:function(T){f=!0,m=T},f:function(){try{!u&&t.return!=null&&t.return()}finally{if(f)throw m}}}}function IE(n,e){if(n){if(typeof n=="string")return $p(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return $p(n,e)}}function $p(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}var Ey=function(){function n(){P3(this,n),Dn(this,"propNames",[])}return I3(n,[{key:"arePropsEqual",value:function(t,r){var s=PE(this.propNames||[]),u;try{for(s.s();!(u=s.n()).done;){var f=u.value;if(!by(t[f],r[f]))return!1}}catch(m){s.e(m)}finally{s.f()}return!0}},{key:"initializeProps",value:function(t,r){return{start:t,end:r}}},{key:"interpolateProps",value:function(t,r,s){Ml(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(t,r){return r.transitionDuration}}]),n}();function dc(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function D9(n,e){return D9=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},D9(n,e)}function Fh(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&D9(n,e)}function L9(n){"@babel/helpers - typeof";return L9=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L9(n)}function Nh(n,e){if(e&&(L9(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dc(n)}function A3(n){return A3=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},A3(n)}var ME={longitude:1,bearing:1};function v7(n){return Number.isFinite(n)||Array.isArray(n)}function RE(n){return n in ME}function F9(n,e,t){return RE(n)&&Math.abs(t-e)>180&&(t=t<0?t+360:t-360),t}function O5(n,e){var t;if(typeof Symbol>"u"||n[Symbol.iterator]==null){if(Array.isArray(n)||(t=kE(n))||e){t&&(n=t);var r=0,s=function(){};return{s,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(T){throw T},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,f=!1,m;return{s:function(){t=n[Symbol.iterator]()},n:function(){var T=t.next();return u=T.done,T},e:function(T){f=!0,m=T},f:function(){try{!u&&t.return!=null&&t.return()}finally{if(f)throw m}}}}function kE(n,e){if(n){if(typeof n=="string")return Wp(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Wp(n,e)}}function Wp(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function OE(n){var e=DE();return function(){var r=A3(n),s;if(e){var u=A3(this).constructor;s=Reflect.construct(r,arguments,u)}else s=r.apply(this,arguments);return Nh(this,s)}}function DE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var LE=["longitude","latitude","zoom","bearing","pitch"],FE=["latitude","longitude","zoom","width","height"],Hp=["bearing","pitch"],NE={speed:1.2,curve:1.414};(function(n){Fh(t,n);var e=OE(t);function t(){var r,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return P3(this,t),r=e.call(this),Dn(dc(r),"propNames",LE),r.props=Object.assign({},NE,s),r}return I3(t,[{key:"initializeProps",value:function(s,u){var f={},m={},o=O5(FE),T;try{for(o.s();!(T=o.n()).done;){var C=T.value,R=s[C],O=u[C];Ml(v7(R)&&v7(O),"".concat(C," must be supplied for transition")),f[C]=R,m[C]=F9(C,R,O)}}catch(Ee){o.e(Ee)}finally{o.f()}var U=O5(Hp),V;try{for(U.s();!(V=U.n()).done;){var Y=V.value,ee=s[Y]||0,le=u[Y]||0;f[Y]=ee,m[Y]=F9(Y,ee,le)}}catch(Ee){U.e(Ee)}finally{U.f()}return{start:f,end:m}}},{key:"interpolateProps",value:function(s,u,f){var m=VT(s,u,f,this.props),o=O5(Hp),T;try{for(o.s();!(T=o.n()).done;){var C=T.value;m[C]=y7(s[C],u[C],f)}}catch(R){o.e(R)}finally{o.f()}return m}},{key:"getDuration",value:function(s,u){var f=u.transitionDuration;return f==="auto"&&(f=jT(s,u,this.props)),f}}]),t})(Ey);function Xp(n,e){var t;if(typeof Symbol>"u"||n[Symbol.iterator]==null){if(Array.isArray(n)||(t=BE(n))||e){t&&(n=t);var r=0,s=function(){};return{s,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(T){throw T},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,f=!1,m;return{s:function(){t=n[Symbol.iterator]()},n:function(){var T=t.next();return u=T.done,T},e:function(T){f=!0,m=T},f:function(){try{!u&&t.return!=null&&t.return()}finally{if(f)throw m}}}}function BE(n,e){if(n){if(typeof n=="string")return Zp(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Zp(n,e)}}function Zp(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function zE(n){var e=UE();return function(){var r=A3(n),s;if(e){var u=A3(this).constructor;s=Reflect.construct(r,arguments,u)}else s=r.apply(this,arguments);return Nh(this,s)}}function UE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var VE=["longitude","latitude","zoom","bearing","pitch"],p2=function(n){Fh(t,n);var e=zE(t);function t(){var r,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return P3(this,t),r=e.call(this),Array.isArray(s)&&(s={transitionProps:s}),r.propNames=s.transitionProps||VE,s.around&&(r.around=s.around),r}return I3(t,[{key:"initializeProps",value:function(s,u){var f={},m={};if(this.around){f.around=this.around;var o=new O0(s).unproject(this.around);Object.assign(m,u,{around:new O0(u).project(o),aroundLngLat:o})}var T=Xp(this.propNames),C;try{for(T.s();!(C=T.n()).done;){var R=C.value,O=s[R],U=u[R];Ml(v7(O)&&v7(U),"".concat(R," must be supplied for transition")),f[R]=O,m[R]=F9(R,O,U)}}catch(V){T.e(V)}finally{T.f()}return{start:f,end:m}}},{key:"interpolateProps",value:function(s,u,f){var m={},o=Xp(this.propNames),T;try{for(o.s();!(T=o.n()).done;){var C=T.value;m[C]=y7(s[C],u[C],f)}}catch(Y){o.e(Y)}finally{o.f()}if(u.around){var R=new O0(Object.assign({},u,m)).getMapCenterByLngLatPosition({lngLat:u.aroundLngLat,pos:y7(s.around,u.around,f)}),O=Hi(R,2),U=O[0],V=O[1];m.longitude=U,m.latitude=V}return m}}]),t}(Ey),m2=function(){};function jE(n,e){var t=n(e);return function(r){return 1/(1-t)*(n(r*(1-e)+e)-t)}}var g2={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},$E={transitionDuration:0,transitionEasing:function(e){return e},transitionInterpolator:new p2,transitionInterruption:g2.BREAK,onTransitionStart:m2,onTransitionInterrupt:m2,onTransitionEnd:m2},Bh=function(){function n(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};P3(this,n),Dn(this,"_animationFrame",null),Dn(this,"_onTransitionFrame",function(){e._animationFrame=requestAnimationFrame(e._onTransitionFrame),e._updateViewport()}),this.props=null,this.onViewportChange=t.onViewportChange||m2,this.onStateChange=t.onStateChange||m2,this.time=t.getTime||Date.now}return I3(n,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(t){var r=this.props;if(this.props=t,!r||this._shouldIgnoreViewportChange(r,t))return!1;if(this._isTransitionEnabled(t)){var s=Object.assign({},r),u=Object.assign({},t);if(this._isTransitionInProgress()&&(r.onTransitionInterrupt(),this.state.interruption===g2.SNAP_TO_END?Object.assign(s,this.state.endProps):Object.assign(s,this.state.propsInTransition),this.state.interruption===g2.UPDATE)){var f=this.time(),m=(f-this.state.startTime)/this.state.duration;u.transitionDuration=this.state.duration-(f-this.state.startTime),u.transitionEasing=jE(this.state.easing,m),u.transitionInterpolator=s.transitionInterpolator}return u.onTransitionStart(),this._triggerTransition(s,u),!0}return this._isTransitionInProgress()&&(r.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return!!this._animationFrame}},{key:"_isTransitionEnabled",value:function(t){var r=t.transitionDuration,s=t.transitionInterpolator;return(r>0||r==="auto")&&!!s}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(t,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(t,r){return t?this._isTransitionInProgress()?this.state.interruption===g2.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(t,r):!0:!0}},{key:"_triggerTransition",value:function(t,r){Ml(this._isTransitionEnabled(r)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var s=r.transitionInterpolator,u=s.getDuration?s.getDuration(t,r):r.transitionDuration;if(u!==0){var f=r.transitionInterpolator.initializeProps(t,r),m={inTransition:!0,isZooming:t.zoom!==r.zoom,isPanning:t.longitude!==r.longitude||t.latitude!==r.latitude,isRotating:t.bearing!==r.bearing||t.pitch!==r.pitch};this.state={duration:u,easing:r.transitionEasing,interpolator:r.transitionInterpolator,interruption:r.transitionInterruption,startTime:this.time(),startProps:f.start,endProps:f.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(m)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var t=this.time(),r=this.state,s=r.startTime,u=r.duration,f=r.easing,m=r.interpolator,o=r.startProps,T=r.endProps,C=!1,R=(t-s)/u;R>=1&&(R=1,C=!0),R=f(R);var O=m.interpolateProps(o,T,R),U=new q4(Object.assign({},this.props,O));this.state.propsInTransition=U.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),C&&(this._endTransition(),this.props.onTransitionEnd())}}]),n}();Dn(Bh,"defaultProps",$E);var D5={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var qp;function WE(){return qp||(qp=1,function(n){(function(e,t,r,s){var u=["","webkit","Moz","MS","ms","o"],f=t.createElement("div"),m="function",o=Math.round,T=Math.abs,C=Date.now;function R(Q,fe,ke){return setTimeout(ue(Q,ke),fe)}function O(Q,fe,ke){return Array.isArray(Q)?(U(Q,ke[fe],ke),!0):!1}function U(Q,fe,ke){var ge;if(Q)if(Q.forEach)Q.forEach(fe,ke);else if(Q.length!==s)for(ge=0;ge<Q.length;)fe.call(ke,Q[ge],ge,Q),ge++;else for(ge in Q)Q.hasOwnProperty(ge)&&fe.call(ke,Q[ge],ge,Q)}function V(Q,fe,ke){var ge="DEPRECATED METHOD: "+fe+`
`+ke+` AT 
`;return function(){var He=new Error("get-stack-trace"),Jt=He&&He.stack?He.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",bn=e.console&&(e.console.warn||e.console.log);return bn&&bn.call(e.console,ge,Jt),Q.apply(this,arguments)}}var Y;typeof Object.assign!="function"?Y=function(fe){if(fe===s||fe===null)throw new TypeError("Cannot convert undefined or null to object");for(var ke=Object(fe),ge=1;ge<arguments.length;ge++){var He=arguments[ge];if(He!==s&&He!==null)for(var Jt in He)He.hasOwnProperty(Jt)&&(ke[Jt]=He[Jt])}return ke}:Y=Object.assign;var ee=V(function(fe,ke,ge){for(var He=Object.keys(ke),Jt=0;Jt<He.length;)(!ge||ge&&fe[He[Jt]]===s)&&(fe[He[Jt]]=ke[He[Jt]]),Jt++;return fe},"extend","Use `assign`."),le=V(function(fe,ke){return ee(fe,ke,!0)},"merge","Use `assign`.");function Ee(Q,fe,ke){var ge=fe.prototype,He;He=Q.prototype=Object.create(ge),He.constructor=Q,He._super=ge,ke&&Y(He,ke)}function ue(Q,fe){return function(){return Q.apply(fe,arguments)}}function _e(Q,fe){return typeof Q==m?Q.apply(fe&&fe[0]||s,fe):Q}function Me(Q,fe){return Q===s?fe:Q}function Fe(Q,fe,ke){U(kt(fe),function(ge){Q.addEventListener(ge,ke,!1)})}function yt(Q,fe,ke){U(kt(fe),function(ge){Q.removeEventListener(ge,ke,!1)})}function xt(Q,fe){for(;Q;){if(Q==fe)return!0;Q=Q.parentNode}return!1}function ht(Q,fe){return Q.indexOf(fe)>-1}function kt(Q){return Q.trim().split(/\s+/g)}function Bt(Q,fe,ke){if(Q.indexOf&&!ke)return Q.indexOf(fe);for(var ge=0;ge<Q.length;){if(ke&&Q[ge][ke]==fe||!ke&&Q[ge]===fe)return ge;ge++}return-1}function Vt(Q){return Array.prototype.slice.call(Q,0)}function $t(Q,fe,ke){for(var ge=[],He=[],Jt=0;Jt<Q.length;){var bn=Q[Jt][fe];Bt(He,bn)<0&&ge.push(Q[Jt]),He[Jt]=bn,Jt++}return ge=ge.sort(function(vr,wr){return vr[fe]>wr[fe]}),ge}function Ct(Q,fe){for(var ke,ge,He=fe[0].toUpperCase()+fe.slice(1),Jt=0;Jt<u.length;){if(ke=u[Jt],ge=ke?ke+He:fe,ge in Q)return ge;Jt++}return s}var xn=1;function Oe(){return xn++}function ce(Q){var fe=Q.ownerDocument||Q;return fe.defaultView||fe.parentWindow||e}var ve=/mobile|tablet|ip(ad|hone|od)|android/i,rt="ontouchstart"in e,at=Ct(e,"PointerEvent")!==s,Ne=rt&&ve.test(navigator.userAgent),Be="touch",ot="pen",Ft="mouse",Dt="kinect",vn=25,un=1,fn=2,yn=4,Tn=8,Qr=1,Or=2,as=4,Xi=8,Ht=16,pn=Or|as,hi=Xi|Ht,xo=pn|hi,Vo=["x","y"],to=["clientX","clientY"];function En(Q,fe){var ke=this;this.manager=Q,this.callback=fe,this.element=Q.element,this.target=Q.options.inputTarget,this.domHandler=function(ge){_e(Q.options.enable,[Q])&&ke.handler(ge)},this.init()}En.prototype={handler:function(){},init:function(){this.evEl&&Fe(this.element,this.evEl,this.domHandler),this.evTarget&&Fe(this.target,this.evTarget,this.domHandler),this.evWin&&Fe(ce(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&yt(this.element,this.evEl,this.domHandler),this.evTarget&&yt(this.target,this.evTarget,this.domHandler),this.evWin&&yt(ce(this.element),this.evWin,this.domHandler)}};function no(Q){var fe,ke=Q.options.inputClass;return ke?fe=ke:at?fe=xs:Ne?fe=W:rt?fe=Re:fe=gr,new fe(Q,_s)}function _s(Q,fe,ke){var ge=ke.pointers.length,He=ke.changedPointers.length,Jt=fe&un&&ge-He===0,bn=fe&(yn|Tn)&&ge-He===0;ke.isFirst=!!Jt,ke.isFinal=!!bn,Jt&&(Q.session={}),ke.eventType=fe,jo(Q,ke),Q.emit("hammer.input",ke),Q.recognize(ke),Q.session.prevInput=ke}function jo(Q,fe){var ke=Q.session,ge=fe.pointers,He=ge.length;ke.firstInput||(ke.firstInput=wo(fe)),He>1&&!ke.firstMultiple?ke.firstMultiple=wo(fe):He===1&&(ke.firstMultiple=!1);var Jt=ke.firstInput,bn=ke.firstMultiple,Pn=bn?bn.center:Jt.center,vr=fe.center=$o(ge);fe.timeStamp=C(),fe.deltaTime=fe.timeStamp-Jt.timeStamp,fe.angle=io(Pn,vr),fe.distance=ro(Pn,vr),bo(ke,fe),fe.offsetDirection=Mi(fe.deltaX,fe.deltaY);var wr=Wo(fe.deltaTime,fe.deltaX,fe.deltaY);fe.overallVelocityX=wr.x,fe.overallVelocityY=wr.y,fe.overallVelocity=T(wr.x)>T(wr.y)?wr.x:wr.y,fe.scale=bn?ys(bn.pointers,ge):1,fe.rotation=bn?To(bn.pointers,ge):0,fe.maxPointers=ke.prevInput?fe.pointers.length>ke.prevInput.maxPointers?fe.pointers.length:ke.prevInput.maxPointers:fe.pointers.length,ur(ke,fe);var Oi=Q.element;xt(fe.srcEvent.target,Oi)&&(Oi=fe.srcEvent.target),fe.target=Oi}function bo(Q,fe){var ke=fe.center,ge=Q.offsetDelta||{},He=Q.prevDelta||{},Jt=Q.prevInput||{};(fe.eventType===un||Jt.eventType===yn)&&(He=Q.prevDelta={x:Jt.deltaX||0,y:Jt.deltaY||0},ge=Q.offsetDelta={x:ke.x,y:ke.y}),fe.deltaX=He.x+(ke.x-ge.x),fe.deltaY=He.y+(ke.y-ge.y)}function ur(Q,fe){var ke=Q.lastInterval||fe,ge=fe.timeStamp-ke.timeStamp,He,Jt,bn,Pn;if(fe.eventType!=Tn&&(ge>vn||ke.velocity===s)){var vr=fe.deltaX-ke.deltaX,wr=fe.deltaY-ke.deltaY,Oi=Wo(ge,vr,wr);Jt=Oi.x,bn=Oi.y,He=T(Oi.x)>T(Oi.y)?Oi.x:Oi.y,Pn=Mi(vr,wr),Q.lastInterval=fe}else He=ke.velocity,Jt=ke.velocityX,bn=ke.velocityY,Pn=ke.direction;fe.velocity=He,fe.velocityX=Jt,fe.velocityY=bn,fe.direction=Pn}function wo(Q){for(var fe=[],ke=0;ke<Q.pointers.length;)fe[ke]={clientX:o(Q.pointers[ke].clientX),clientY:o(Q.pointers[ke].clientY)},ke++;return{timeStamp:C(),pointers:fe,center:$o(fe),deltaX:Q.deltaX,deltaY:Q.deltaY}}function $o(Q){var fe=Q.length;if(fe===1)return{x:o(Q[0].clientX),y:o(Q[0].clientY)};for(var ke=0,ge=0,He=0;He<fe;)ke+=Q[He].clientX,ge+=Q[He].clientY,He++;return{x:o(ke/fe),y:o(ge/fe)}}function Wo(Q,fe,ke){return{x:fe/Q||0,y:ke/Q||0}}function Mi(Q,fe){return Q===fe?Qr:T(Q)>=T(fe)?Q<0?Or:as:fe<0?Xi:Ht}function ro(Q,fe,ke){ke||(ke=Vo);var ge=fe[ke[0]]-Q[ke[0]],He=fe[ke[1]]-Q[ke[1]];return Math.sqrt(ge*ge+He*He)}function io(Q,fe,ke){ke||(ke=Vo);var ge=fe[ke[0]]-Q[ke[0]],He=fe[ke[1]]-Q[ke[1]];return Math.atan2(He,ge)*180/Math.PI}function To(Q,fe){return io(fe[1],fe[0],to)+io(Q[1],Q[0],to)}function ys(Q,fe){return ro(fe[0],fe[1],to)/ro(Q[0],Q[1],to)}var Ho={mousedown:un,mousemove:fn,mouseup:yn},fi="mousedown",Eo="mousemove mouseup";function gr(){this.evEl=fi,this.evWin=Eo,this.pressed=!1,En.apply(this,arguments)}Ee(gr,En,{handler:function(fe){var ke=Ho[fe.type];ke&un&&fe.button===0&&(this.pressed=!0),ke&fn&&fe.which!==1&&(ke=yn),this.pressed&&(ke&yn&&(this.pressed=!1),this.callback(this.manager,ke,{pointers:[fe],changedPointers:[fe],pointerType:Ft,srcEvent:fe}))}});var Zi={pointerdown:un,pointermove:fn,pointerup:yn,pointercancel:Tn,pointerout:Tn},Xo={2:Be,3:ot,4:Ft,5:Dt},vs="pointerdown",so="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(vs="MSPointerDown",so="MSPointerMove MSPointerUp MSPointerCancel");function xs(){this.evEl=vs,this.evWin=so,En.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Ee(xs,En,{handler:function(fe){var ke=this.store,ge=!1,He=fe.type.toLowerCase().replace("ms",""),Jt=Zi[He],bn=Xo[fe.pointerType]||fe.pointerType,Pn=bn==Be,vr=Bt(ke,fe.pointerId,"pointerId");Jt&un&&(fe.button===0||Pn)?vr<0&&(ke.push(fe),vr=ke.length-1):Jt&(yn|Tn)&&(ge=!0),!(vr<0)&&(ke[vr]=fe,this.callback(this.manager,Jt,{pointers:ke,changedPointers:[fe],pointerType:bn,srcEvent:fe}),ge&&ke.splice(vr,1))}});var bs={touchstart:un,touchmove:fn,touchend:yn,touchcancel:Tn},qi="touchstart",Gi="touchstart touchmove touchend touchcancel";function ii(){this.evTarget=qi,this.evWin=Gi,this.started=!1,En.apply(this,arguments)}Ee(ii,En,{handler:function(fe){var ke=bs[fe.type];if(ke===un&&(this.started=!0),!!this.started){var ge=Zo.call(this,fe,ke);ke&(yn|Tn)&&ge[0].length-ge[1].length===0&&(this.started=!1),this.callback(this.manager,ke,{pointers:ge[0],changedPointers:ge[1],pointerType:Be,srcEvent:fe})}}});function Zo(Q,fe){var ke=Vt(Q.touches),ge=Vt(Q.changedTouches);return fe&(yn|Tn)&&(ke=$t(ke.concat(ge),"identifier")),[ke,ge]}var Ri={touchstart:un,touchmove:fn,touchend:yn,touchcancel:Tn},de="touchstart touchmove touchend touchcancel";function W(){this.evTarget=de,this.targetIds={},En.apply(this,arguments)}Ee(W,En,{handler:function(fe){var ke=Ri[fe.type],ge=G.call(this,fe,ke);ge&&this.callback(this.manager,ke,{pointers:ge[0],changedPointers:ge[1],pointerType:Be,srcEvent:fe})}});function G(Q,fe){var ke=Vt(Q.touches),ge=this.targetIds;if(fe&(un|fn)&&ke.length===1)return ge[ke[0].identifier]=!0,[ke,ke];var He,Jt,bn=Vt(Q.changedTouches),Pn=[],vr=this.target;if(Jt=ke.filter(function(wr){return xt(wr.target,vr)}),fe===un)for(He=0;He<Jt.length;)ge[Jt[He].identifier]=!0,He++;for(He=0;He<bn.length;)ge[bn[He].identifier]&&Pn.push(bn[He]),fe&(yn|Tn)&&delete ge[bn[He].identifier],He++;if(Pn.length)return[$t(Jt.concat(Pn),"identifier"),Pn]}var he=2500,ye=25;function Re(){En.apply(this,arguments);var Q=ue(this.handler,this);this.touch=new W(this.manager,Q),this.mouse=new gr(this.manager,Q),this.primaryTouch=null,this.lastTouches=[]}Ee(Re,En,{handler:function(fe,ke,ge){var He=ge.pointerType==Be,Jt=ge.pointerType==Ft;if(!(Jt&&ge.sourceCapabilities&&ge.sourceCapabilities.firesTouchEvents)){if(He)$e.call(this,ke,ge);else if(Jt&&Le.call(this,ge))return;this.callback(fe,ke,ge)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function $e(Q,fe){Q&un?(this.primaryTouch=fe.changedPointers[0].identifier,Ve.call(this,fe)):Q&(yn|Tn)&&Ve.call(this,fe)}function Ve(Q){var fe=Q.changedPointers[0];if(fe.identifier===this.primaryTouch){var ke={x:fe.clientX,y:fe.clientY};this.lastTouches.push(ke);var ge=this.lastTouches,He=function(){var Jt=ge.indexOf(ke);Jt>-1&&ge.splice(Jt,1)};setTimeout(He,he)}}function Le(Q){for(var fe=Q.srcEvent.clientX,ke=Q.srcEvent.clientY,ge=0;ge<this.lastTouches.length;ge++){var He=this.lastTouches[ge],Jt=Math.abs(fe-He.x),bn=Math.abs(ke-He.y);if(Jt<=ye&&bn<=ye)return!0}return!1}var Ye=Ct(f.style,"touchAction"),ft=Ye!==s,_t="compute",Tt="auto",qt="manipulation",Kt="none",tn="pan-x",on="pan-y",Sn=Xn();function ir(Q,fe){this.manager=Q,this.set(fe)}ir.prototype={set:function(Q){Q==_t&&(Q=this.compute()),ft&&this.manager.element.style&&Sn[Q]&&(this.manager.element.style[Ye]=Q),this.actions=Q.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Q=[];return U(this.manager.recognizers,function(fe){_e(fe.options.enable,[fe])&&(Q=Q.concat(fe.getTouchAction()))}),yr(Q.join(" "))},preventDefaults:function(Q){var fe=Q.srcEvent,ke=Q.offsetDirection;if(this.manager.session.prevented){fe.preventDefault();return}var ge=this.actions,He=ht(ge,Kt)&&!Sn[Kt],Jt=ht(ge,on)&&!Sn[on],bn=ht(ge,tn)&&!Sn[tn];if(He){var Pn=Q.pointers.length===1,vr=Q.distance<2,wr=Q.deltaTime<250;if(Pn&&vr&&wr)return}if(!(bn&&Jt)&&(He||Jt&&ke&pn||bn&&ke&hi))return this.preventSrc(fe)},preventSrc:function(Q){this.manager.session.prevented=!0,Q.preventDefault()}};function yr(Q){if(ht(Q,Kt))return Kt;var fe=ht(Q,tn),ke=ht(Q,on);return fe&&ke?Kt:fe||ke?fe?tn:on:ht(Q,qt)?qt:Tt}function Xn(){if(!ft)return!1;var Q={},fe=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ke){Q[ke]=fe?e.CSS.supports("touch-action",ke):!0}),Q}var sr=1,$r=2,ki=4,br=8,Zr=br,oo=16,Yi=32;function ls(Q){this.options=Y({},this.defaults,Q||{}),this.id=Oe(),this.manager=null,this.options.enable=Me(this.options.enable,!0),this.state=sr,this.simultaneous={},this.requireFail=[]}ls.prototype={defaults:{},set:function(Q){return Y(this.options,Q),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Q){if(O(Q,"recognizeWith",this))return this;var fe=this.simultaneous;return Q=di(Q,this),fe[Q.id]||(fe[Q.id]=Q,Q.recognizeWith(this)),this},dropRecognizeWith:function(Q){return O(Q,"dropRecognizeWith",this)?this:(Q=di(Q,this),delete this.simultaneous[Q.id],this)},requireFailure:function(Q){if(O(Q,"requireFailure",this))return this;var fe=this.requireFail;return Q=di(Q,this),Bt(fe,Q)===-1&&(fe.push(Q),Q.requireFailure(this)),this},dropRequireFailure:function(Q){if(O(Q,"dropRequireFailure",this))return this;Q=di(Q,this);var fe=Bt(this.requireFail,Q);return fe>-1&&this.requireFail.splice(fe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Q){return!!this.simultaneous[Q.id]},emit:function(Q){var fe=this,ke=this.state;function ge(He){fe.manager.emit(He,Q)}ke<br&&ge(fe.options.event+qo(ke)),ge(fe.options.event),Q.additionalEvent&&ge(Q.additionalEvent),ke>=br&&ge(fe.options.event+qo(ke))},tryEmit:function(Q){if(this.canEmit())return this.emit(Q);this.state=Yi},canEmit:function(){for(var Q=0;Q<this.requireFail.length;){if(!(this.requireFail[Q].state&(Yi|sr)))return!1;Q++}return!0},recognize:function(Q){var fe=Y({},Q);if(!_e(this.options.enable,[this,fe])){this.reset(),this.state=Yi;return}this.state&(Zr|oo|Yi)&&(this.state=sr),this.state=this.process(fe),this.state&($r|ki|br|oo)&&this.tryEmit(fe)},process:function(Q){},getTouchAction:function(){},reset:function(){}};function qo(Q){return Q&oo?"cancel":Q&br?"end":Q&ki?"move":Q&$r?"start":""}function ga(Q){return Q==Ht?"down":Q==Xi?"up":Q==Or?"left":Q==as?"right":""}function di(Q,fe){var ke=fe.manager;return ke?ke.get(Q):Q}function Nr(){ls.apply(this,arguments)}Ee(Nr,ls,{defaults:{pointers:1},attrTest:function(Q){var fe=this.options.pointers;return fe===0||Q.pointers.length===fe},process:function(Q){var fe=this.state,ke=Q.eventType,ge=fe&($r|ki),He=this.attrTest(Q);return ge&&(ke&Tn||!He)?fe|oo:ge||He?ke&yn?fe|br:fe&$r?fe|ki:$r:Yi}});function Ei(){Nr.apply(this,arguments),this.pX=null,this.pY=null}Ee(Ei,Nr,{defaults:{event:"pan",threshold:10,pointers:1,direction:xo},getTouchAction:function(){var Q=this.options.direction,fe=[];return Q&pn&&fe.push(on),Q&hi&&fe.push(tn),fe},directionTest:function(Q){var fe=this.options,ke=!0,ge=Q.distance,He=Q.direction,Jt=Q.deltaX,bn=Q.deltaY;return He&fe.direction||(fe.direction&pn?(He=Jt===0?Qr:Jt<0?Or:as,ke=Jt!=this.pX,ge=Math.abs(Q.deltaX)):(He=bn===0?Qr:bn<0?Xi:Ht,ke=bn!=this.pY,ge=Math.abs(Q.deltaY))),Q.direction=He,ke&&ge>fe.threshold&&He&fe.direction},attrTest:function(Q){return Nr.prototype.attrTest.call(this,Q)&&(this.state&$r||!(this.state&$r)&&this.directionTest(Q))},emit:function(Q){this.pX=Q.deltaX,this.pY=Q.deltaY;var fe=ga(Q.direction);fe&&(Q.additionalEvent=this.options.event+fe),this._super.emit.call(this,Q)}});function cs(){Nr.apply(this,arguments)}Ee(cs,Nr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Kt]},attrTest:function(Q){return this._super.attrTest.call(this,Q)&&(Math.abs(Q.scale-1)>this.options.threshold||this.state&$r)},emit:function(Q){if(Q.scale!==1){var fe=Q.scale<1?"in":"out";Q.additionalEvent=this.options.event+fe}this._super.emit.call(this,Q)}});function si(){ls.apply(this,arguments),this._timer=null,this._input=null}Ee(si,ls,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Tt]},process:function(Q){var fe=this.options,ke=Q.pointers.length===fe.pointers,ge=Q.distance<fe.threshold,He=Q.deltaTime>fe.time;if(this._input=Q,!ge||!ke||Q.eventType&(yn|Tn)&&!He)this.reset();else if(Q.eventType&un)this.reset(),this._timer=R(function(){this.state=Zr,this.tryEmit()},fe.time,this);else if(Q.eventType&yn)return Zr;return Yi},reset:function(){clearTimeout(this._timer)},emit:function(Q){this.state===Zr&&(Q&&Q.eventType&yn?this.manager.emit(this.options.event+"up",Q):(this._input.timeStamp=C(),this.manager.emit(this.options.event,this._input)))}});function ws(){Nr.apply(this,arguments)}Ee(ws,Nr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Kt]},attrTest:function(Q){return this._super.attrTest.call(this,Q)&&(Math.abs(Q.rotation)>this.options.threshold||this.state&$r)}});function pi(){Nr.apply(this,arguments)}Ee(pi,Nr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:pn|hi,pointers:1},getTouchAction:function(){return Ei.prototype.getTouchAction.call(this)},attrTest:function(Q){var fe=this.options.direction,ke;return fe&(pn|hi)?ke=Q.overallVelocity:fe&pn?ke=Q.overallVelocityX:fe&hi&&(ke=Q.overallVelocityY),this._super.attrTest.call(this,Q)&&fe&Q.offsetDirection&&Q.distance>this.options.threshold&&Q.maxPointers==this.options.pointers&&T(ke)>this.options.velocity&&Q.eventType&yn},emit:function(Q){var fe=ga(Q.offsetDirection);fe&&this.manager.emit(this.options.event+fe,Q),this.manager.emit(this.options.event,Q)}});function Xa(){ls.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Ee(Xa,ls,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[qt]},process:function(Q){var fe=this.options,ke=Q.pointers.length===fe.pointers,ge=Q.distance<fe.threshold,He=Q.deltaTime<fe.time;if(this.reset(),Q.eventType&un&&this.count===0)return this.failTimeout();if(ge&&He&&ke){if(Q.eventType!=yn)return this.failTimeout();var Jt=this.pTime?Q.timeStamp-this.pTime<fe.interval:!0,bn=!this.pCenter||ro(this.pCenter,Q.center)<fe.posThreshold;this.pTime=Q.timeStamp,this.pCenter=Q.center,!bn||!Jt?this.count=1:this.count+=1,this._input=Q;var Pn=this.count%fe.taps;if(Pn===0)return this.hasRequireFailures()?(this._timer=R(function(){this.state=Zr,this.tryEmit()},fe.interval,this),$r):Zr}return Yi},failTimeout:function(){return this._timer=R(function(){this.state=Yi},this.options.interval,this),Yi},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Zr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ts(Q,fe){return fe=fe||{},fe.recognizers=Me(fe.recognizers,Ts.defaults.preset),new Yo(Q,fe)}Ts.VERSION="2.0.7",Ts.defaults={domEvents:!1,touchAction:_t,enable:!0,inputTarget:null,inputClass:null,preset:[[ws,{enable:!1}],[cs,{enable:!1},["rotate"]],[pi,{direction:pn}],[Ei,{direction:pn},["swipe"]],[Xa],[Xa,{event:"doubletap",taps:2},["tap"]],[si]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Go=1,Es=2;function Yo(Q,fe){this.options=Y({},Ts.defaults,fe||{}),this.options.inputTarget=this.options.inputTarget||Q,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Q,this.input=no(this),this.touchAction=new ir(this,this.options.touchAction),S1(this,!0),U(this.options.recognizers,function(ke){var ge=this.add(new ke[0](ke[1]));ke[2]&&ge.recognizeWith(ke[2]),ke[3]&&ge.requireFailure(ke[3])},this)}Yo.prototype={set:function(Q){return Y(this.options,Q),Q.touchAction&&this.touchAction.update(),Q.inputTarget&&(this.input.destroy(),this.input.target=Q.inputTarget,this.input.init()),this},stop:function(Q){this.session.stopped=Q?Es:Go},recognize:function(Q){var fe=this.session;if(!fe.stopped){this.touchAction.preventDefaults(Q);var ke,ge=this.recognizers,He=fe.curRecognizer;(!He||He&&He.state&Zr)&&(He=fe.curRecognizer=null);for(var Jt=0;Jt<ge.length;)ke=ge[Jt],fe.stopped!==Es&&(!He||ke==He||ke.canRecognizeWith(He))?ke.recognize(Q):ke.reset(),!He&&ke.state&($r|ki|br)&&(He=fe.curRecognizer=ke),Jt++}},get:function(Q){if(Q instanceof ls)return Q;for(var fe=this.recognizers,ke=0;ke<fe.length;ke++)if(fe[ke].options.event==Q)return fe[ke];return null},add:function(Q){if(O(Q,"add",this))return this;var fe=this.get(Q.options.event);return fe&&this.remove(fe),this.recognizers.push(Q),Q.manager=this,this.touchAction.update(),Q},remove:function(Q){if(O(Q,"remove",this))return this;if(Q=this.get(Q),Q){var fe=this.recognizers,ke=Bt(fe,Q);ke!==-1&&(fe.splice(ke,1),this.touchAction.update())}return this},on:function(Q,fe){if(Q!==s&&fe!==s){var ke=this.handlers;return U(kt(Q),function(ge){ke[ge]=ke[ge]||[],ke[ge].push(fe)}),this}},off:function(Q,fe){if(Q!==s){var ke=this.handlers;return U(kt(Q),function(ge){fe?ke[ge]&&ke[ge].splice(Bt(ke[ge],fe),1):delete ke[ge]}),this}},emit:function(Q,fe){this.options.domEvents&&Za(Q,fe);var ke=this.handlers[Q]&&this.handlers[Q].slice();if(!(!ke||!ke.length)){fe.type=Q,fe.preventDefault=function(){fe.srcEvent.preventDefault()};for(var ge=0;ge<ke.length;)ke[ge](fe),ge++}},destroy:function(){this.element&&S1(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function S1(Q,fe){var ke=Q.element;if(ke.style){var ge;U(Q.options.cssProps,function(He,Jt){ge=Ct(ke.style,Jt),fe?(Q.oldCssProps[ge]=ke.style[ge],ke.style[ge]=He):ke.style[ge]=Q.oldCssProps[ge]||""}),fe||(Q.oldCssProps={})}}function Za(Q,fe){var ke=t.createEvent("Event");ke.initEvent(Q,!0,!0),ke.gesture=fe,fe.target.dispatchEvent(ke)}Y(Ts,{INPUT_START:un,INPUT_MOVE:fn,INPUT_END:yn,INPUT_CANCEL:Tn,STATE_POSSIBLE:sr,STATE_BEGAN:$r,STATE_CHANGED:ki,STATE_ENDED:br,STATE_RECOGNIZED:Zr,STATE_CANCELLED:oo,STATE_FAILED:Yi,DIRECTION_NONE:Qr,DIRECTION_LEFT:Or,DIRECTION_RIGHT:as,DIRECTION_UP:Xi,DIRECTION_DOWN:Ht,DIRECTION_HORIZONTAL:pn,DIRECTION_VERTICAL:hi,DIRECTION_ALL:xo,Manager:Yo,Input:En,TouchAction:ir,TouchInput:W,MouseInput:gr,PointerEventInput:xs,TouchMouseInput:Re,SingleTouchInput:ii,Recognizer:ls,AttrRecognizer:Nr,Tap:Xa,Pan:Ei,Swipe:pi,Pinch:cs,Rotate:ws,Press:si,on:Fe,off:yt,each:U,merge:le,extend:ee,assign:Y,inherit:Ee,bindFn:ue,prefixed:Ct});var qa=typeof e<"u"?e:typeof self<"u"?self:{};qa.Hammer=Ts,n.exports?n.exports=Ts:e[r]=Ts})(window,document,"Hammer")}(D5)),D5.exports}var HE=WE();const da=L2(HE),Sy=1,Ay=2,N9=4,XE={mousedown:Sy,mousemove:Ay,mouseup:N9};function ZE(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return!0;return!1}function qE(n){const e=n.prototype.handler;n.prototype.handler=function(r){const s=this.store;r.button>0&&r.type==="pointerdown"&&(ZE(s,u=>u.pointerId===r.pointerId)||s.push(r)),e.call(this,r)}}function GE(n){n.prototype.handler=function(t){let r=XE[t.type];r&Sy&&t.button>=0&&(this.pressed=!0),r&Ay&&t.which===0&&(r=N9),this.pressed&&(r&N9&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}qE(da.PointerEventInput);GE(da.MouseInput);const YE=da.Manager,KE=da?[[da.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[da.Rotate,{enable:!1}],[da.Pinch,{enable:!1}],[da.Swipe,{enable:!1}],[da.Pan,{threshold:0,enable:!1}],[da.Press,{enable:!1}],[da.Tap,{event:"doubletap",taps:2,enable:!1}],[da.Tap,{event:"anytap",enable:!1}],[da.Tap,{enable:!1}]]:null,Gp={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},JE={doubletap:["tap"]},QE={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},zh={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},eS={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Yp={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},tS=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",U4=typeof window<"u"?window:global;let Cy=!1;try{const n={get passive(){return Cy=!0,!0}};U4.addEventListener("test",n,n),U4.removeEventListener("test",n,n)}catch{}const nS=tS.indexOf("firefox")!==-1,{WHEEL_EVENTS:rS}=zh,Kp="wheel",Jp=4.000244140625,iS=40,sS=.25;let oS=class{constructor(e,t,r={}){this.element=e,this.callback=t,this.options=Object.assign({enable:!0},r),this.events=rS.concat(r.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,Cy?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===Kp&&(this.options.enable=t)}handleEvent(e){if(!this.options.enable)return;let t=e.deltaY;U4.WheelEvent&&(nS&&e.deltaMode===U4.WheelEvent.DOM_DELTA_PIXEL&&(t/=U4.devicePixelRatio),e.deltaMode===U4.WheelEvent.DOM_DELTA_LINE&&(t*=iS));const r={x:e.clientX,y:e.clientY};t!==0&&t%Jp===0&&(t=Math.floor(t/Jp)),e.shiftKey&&t&&(t=t*sS),this._onWheel(e,-t,r)}_onWheel(e,t,r){this.callback({type:Kp,center:r,delta:t,srcEvent:e,pointerType:"mouse",target:e.target})}};const{MOUSE_EVENTS:aS}=zh,Qp="pointermove",em="pointerover",tm="pointerout",nm="pointerleave";let lS=class{constructor(e,t,r={}){this.element=e,this.callback=t,this.pressed=!1,this.options=Object.assign({enable:!0},r),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=aS.concat(r.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===Qp&&(this.enableMoveEvent=t),e===em&&(this.enableOverEvent=t),e===tm&&(this.enableOutEvent=t),e===nm&&(this.enableLeaveEvent=t)}handleEvent(e){this.handleOverEvent(e),this.handleOutEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this.callback({type:em,srcEvent:e,pointerType:"mouse",target:e.target})}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this.callback({type:tm,srcEvent:e,pointerType:"mouse",target:e.target})}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this.callback({type:nm,srcEvent:e,pointerType:"mouse",target:e.target})}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this.callback({type:Qp,srcEvent:e,pointerType:"mouse",target:e.target});break;case"mouseup":this.pressed=!1;break}}};const{KEY_EVENTS:cS}=zh,rm="keydown",im="keyup";let uS=class{constructor(e,t,r={}){this.element=e,this.callback=t,this.options=Object.assign({enable:!0},r),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=cS.concat(r.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=r.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===rm&&(this.enableDownEvent=t),e===im&&(this.enableUpEvent=t)}handleEvent(e){const t=e.target||e.srcElement;t.tagName==="INPUT"&&t.type==="text"||t.tagName==="TEXTAREA"||(this.enableDownEvent&&e.type==="keydown"&&this.callback({type:rm,srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&e.type==="keyup"&&this.callback({type:im,srcEvent:e,key:e.key,target:e.target}))}};const sm="contextmenu";let hS=class{constructor(e,t,r={}){this.element=e,this.callback=t,this.options=Object.assign({enable:!0},r),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===sm&&(this.options.enable=t)}handleEvent(e){this.options.enable&&this.callback({type:sm,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}};const B9=1,x7=2,z9=4,fS={pointerdown:B9,pointermove:x7,pointerup:z9,mousedown:B9,mousemove:x7,mouseup:z9},dS=1,pS=2,mS=3,gS=0,_S=1,yS=2,vS=1,xS=2,bS=4;function wS(n){const e=fS[n.srcEvent.type];if(!e)return null;const{buttons:t,button:r,which:s}=n.srcEvent;let u=!1,f=!1,m=!1;return e===z9||e===x7&&!Number.isFinite(t)?(u=s===dS,f=s===pS,m=s===mS):e===x7?(u=!!(t&vS),f=!!(t&bS),m=!!(t&xS)):e===B9&&(u=r===gS,f=r===_S,m=r===yS),{leftButton:u,middleButton:f,rightButton:m}}function TS(n,e){const{srcEvent:t}=n;if(!n.center&&!Number.isFinite(t.clientX))return null;const r=n.center||{x:t.clientX,y:t.clientY},s=e.getBoundingClientRect(),u=s.width/e.offsetWidth||1,f=s.height/e.offsetHeight||1,m={x:(r.x-s.left-e.clientLeft)/u,y:(r.y-s.top-e.clientTop)/f};return{center:r,offsetCenter:m}}const om={srcElement:"root",priority:0};let ES=class{constructor(e){this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this),this._active=!1}isEmpty(){return!this._active}add(e,t,r,s=!1,u=!1){const{handlers:f,handlersByElement:m}=this;r&&(typeof r!="object"||r.addEventListener)&&(r={srcElement:r}),r=r?Object.assign({},om,r):om;let o=m.get(r.srcElement);o||(o=[],m.set(r.srcElement,o));const T={type:e,handler:t,srcElement:r.srcElement,priority:r.priority};s&&(T.once=!0),u&&(T.passive=!0),f.push(T),this._active=this._active||!T.passive;let C=o.length-1;for(;C>=0&&!(o[C].priority>=T.priority);)C--;o.splice(C+1,0,T)}remove(e,t){const{handlers:r,handlersByElement:s}=this;for(let u=r.length-1;u>=0;u--){const f=r[u];if(f.type===e&&f.handler===t){r.splice(u,1);const m=s.get(f.srcElement);m.splice(m.indexOf(f),1),m.length===0&&s.delete(f.srcElement)}}this._active=r.some(u=>!u.passive)}handleEvent(e){if(this.isEmpty())return;const t=this._normalizeEvent(e);let r=e.srcEvent.target;for(;r&&r!==t.rootElement;){if(this._emit(t,r),t.handled)return;r=r.parentNode}this._emit(t,"root")}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let s=!1;const u=()=>{e.handled=!0},f=()=>{e.handled=!0,s=!0},m=[];for(let o=0;o<r.length;o++){const{type:T,handler:C,once:R}=r[o];if(C(Object.assign({},e,{type:T,stopPropagation:u,stopImmediatePropagation:f})),R&&m.push(r[o]),s)break}for(let o=0;o<m.length;o++){const{type:T,handler:C}=m[o];this.remove(T,C)}}}_normalizeEvent(e){const t=this.eventManager.element;return Object.assign({},e,wS(e),TS(e,t),{handled:!1,rootElement:t})}};const SS={events:null,recognizers:null,recognizerOptions:{},Manager:YE,touchAction:"none",tabIndex:0};let AS=class{constructor(e=null,t={}){this.options=Object.assign({},SS,t),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);const{events:r}=t;r&&this.on(r)}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,r=t.Manager;this.manager=new r(e,{touchAction:t.touchAction,recognizers:t.recognizers||KE}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(Gp).forEach(s=>{const u=this.manager.get(s);u&&Gp[s].forEach(f=>{u.recognizeWith(f)})});for(const s in t.recognizerOptions){const u=this.manager.get(s);if(u){const f=t.recognizerOptions[s];delete f.enable,u.set(f)}}this.wheelInput=new oS(e,this._onOtherEvent,{enable:!1}),this.moveInput=new lS(e,this._onOtherEvent,{enable:!1}),this.keyInput=new uS(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new hS(e,this._onOtherEvent,{enable:!1});for(const[s,u]of this.events)u.isEmpty()||(this._toggleRecognizer(u.recognizerName,!0),this.manager.on(s,u.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const s=r.get(e);if(s&&s.options.enable!==t){s.set({enable:t});const u=JE[e];u&&!this.options.recognizers&&u.forEach(f=>{const m=r.get(f);t?(m.requireFailure(e),s.dropRequireFailure(f)):m.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,r,s,u){if(typeof e!="string"){r=t;for(const C in e)this._addEventHandler(C,e[C],r,s,u);return}const{manager:f,events:m}=this,o=Yp[e]||e;let T=m.get(o);T||(T=new ES(this),m.set(o,T),T.recognizerName=eS[o]||o,f&&f.on(o,T.handleEvent)),T.add(e,t,r,s,u),T.isEmpty()||this._toggleRecognizer(T.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const f in e)this._removeEventHandler(f,e[f]);return}const{events:r}=this,s=Yp[e]||e,u=r.get(s);if(u&&(u.remove(e,t),u.isEmpty())){const{recognizerName:f}=u;let m=!1;for(const o of r.values())if(o.recognizerName===f&&!o.isEmpty()){m=!0;break}m||this._toggleRecognizer(f,!1)}}_onBasicInput(e){const{srcEvent:t}=e,r=QE[t.type];r&&this.manager.emit(r,e)}_onOtherEvent(e){this.manager.emit(e.type,e)}};function am(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function yo(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?am(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):am(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var A0={transitionDuration:0},pc={transitionDuration:300,transitionEasing:function(e){return e},transitionInterpolator:new p2,transitionInterruption:g2.BREAK},k8=300,O8=function(e){return 1-(1-e)*(1-e)},M4={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Py=function(){function n(){var e=this;P3(this,n),Dn(this,"events",[]),Dn(this,"scrollZoom",!0),Dn(this,"dragPan",!0),Dn(this,"dragRotate",!0),Dn(this,"doubleClickZoom",!0),Dn(this,"touchZoom",!0),Dn(this,"touchRotate",!1),Dn(this,"keyboard",!0),Dn(this,"_interactionState",{isDragging:!1}),Dn(this,"_events",{}),Dn(this,"_setInteractionState",function(t){Object.assign(e._interactionState,t),e.onStateChange&&e.onStateChange(e._interactionState)}),Dn(this,"_onTransition",function(t,r){e.onViewportChange(t,e._interactionState,r)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new Bh({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return I3(n,[{key:"handleEvent",value:function(t){this.mapState=this.getMapState();var r=this._eventStartBlocked;switch(t.type){case"panstart":return r?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return r?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return r?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var r=t.offsetCenter,s=r.x,u=r.y;return[s,u]}},{key:"isFunctionKeyPressed",value:function(t){var r=t.srcEvent;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}},{key:"blockEvents",value:function(t){var r=this,s=setTimeout(function(){r._eventStartBlocked===s&&(r._eventStartBlocked=null)},t);this._eventStartBlocked=s}},{key:"updateViewport",value:function(t,r,s){var u=this.mapState instanceof q4?this.mapState.getViewportProps():this.mapState,f=yo(yo({},t.getViewportProps()),r),m=Object.keys(f).some(function(o){return u[o]!==f[o]});this._state=t.getState(),this._setInteractionState(s),m&&this.onViewportChange(f,this._interactionState,u)}},{key:"getMapState",value:function(t){return new q4(yo(yo(yo({},this.mapStateProps),this._state),t))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(t){var r=t.onViewportChange,s=t.onStateChange,u=t.eventManager,f=u===void 0?this.eventManager:u,m=t.isInteractive,o=m===void 0?!0:m,T=t.scrollZoom,C=T===void 0?this.scrollZoom:T,R=t.dragPan,O=R===void 0?this.dragPan:R,U=t.dragRotate,V=U===void 0?this.dragRotate:U,Y=t.doubleClickZoom,ee=Y===void 0?this.doubleClickZoom:Y,le=t.touchZoom,Ee=le===void 0?this.touchZoom:le,ue=t.touchRotate,_e=ue===void 0?this.touchRotate:ue,Me=t.keyboard,Fe=Me===void 0?this.keyboard:Me;this.onViewportChange=r,this.onStateChange=s;var yt=this.mapStateProps||{},xt=yt.height!==t.height||yt.width!==t.width;this.mapStateProps=t,xt&&(this.mapState=yt,this.updateViewport(new q4(t))),this._transitionManager.processViewportChange(t),this.eventManager!==f&&(this.eventManager=f,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(M4.WHEEL,o&&!!C),this.toggleEvents(M4.PAN,o&&!!(O||V)),this.toggleEvents(M4.PINCH,o&&!!(Ee||_e)),this.toggleEvents(M4.TRIPLE_PAN,o&&!!_e),this.toggleEvents(M4.DOUBLE_TAP,o&&!!ee),this.toggleEvents(M4.KEYBOARD,o&&!!Fe),this.scrollZoom=C,this.dragPan=O,this.dragRotate=V,this.doubleClickZoom=ee,this.touchZoom=Ee,this.touchRotate=_e,this.keyboard=Fe}},{key:"toggleEvents",value:function(t,r){var s=this;this.eventManager&&t.forEach(function(u){s._events[u]!==r&&(s._events[u]=r,r?s.eventManager.on(u,s.handleEvent):s.eventManager.off(u,s.handleEvent))})}},{key:"_onPanStart",value:function(t){var r=this.getCenter(t);this._panRotate=this.isFunctionKeyPressed(t)||t.rightButton;var s=this._panRotate?this.mapState.rotateStart({pos:r}):this.mapState.panStart({pos:r});return this.updateViewport(s,A0,{isDragging:!0}),!0}},{key:"_onPan",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotate(t):this._onPanMove(t):!1}},{key:"_onPanEnd",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotateEnd(t):this._onPanMoveEnd(t):!1}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var r=this.getCenter(t),s=this.mapState.pan({pos:r});return this.updateViewport(s,A0,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(t){if(this.dragPan){var r=this.dragPan.inertia,s=r===void 0?k8:r;if(s&&t.velocity){var u=this.getCenter(t),f=[u[0]+t.velocityX*s/2,u[1]+t.velocityY*s/2],m=this.mapState.pan({pos:f}).panEnd();return this.updateViewport(m,yo(yo({},pc),{},{transitionDuration:s,transitionEasing:O8}),{isDragging:!1,isPanning:!0}),!0}}var o=this.mapState.panEnd();return this.updateViewport(o,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var r=this.getCenter(t),s=this.mapState.rotate({pos:r});return this.updateViewport(s,A0,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(t){if(this.dragRotate){var r=this.dragRotate.inertia,s=r===void 0?k8:r;if(s&&t.velocity){var u=this.getCenter(t),f=[u[0]+t.velocityX*s/2,u[1]+t.velocityY*s/2],m=this.mapState.rotate({pos:f}).rotateEnd();return this.updateViewport(m,yo(yo({},pc),{},{transitionDuration:s,transitionEasing:O8}),{isDragging:!1,isRotating:!0}),!0}}var o=this.mapState.panEnd();return this.updateViewport(o,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;var r=this.scrollZoom,s=r.speed,u=s===void 0?.01:s,f=r.smooth,m=f===void 0?!1:f;t.preventDefault();var o=this.getCenter(t),T=t.delta,C=2/(1+Math.exp(-Math.abs(T*u)));T<0&&C!==0&&(C=1/C);var R=this.mapState.zoom({pos:o,scale:C});return R.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(R,yo(yo({},pc),{},{transitionInterpolator:new p2({around:o}),transitionDuration:m?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(t){var r=this.getCenter(t),s=this.mapState.zoomStart({pos:r}).rotateStart({pos:r});return this._startPinchRotation=t.rotation,this._lastPinchEvent=t,this.updateViewport(s,A0,{isDragging:!0}),!0}},{key:"_onPinch",value:function(t){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var r=this.mapState;if(this.touchZoom){var s=t.scale,u=this.getCenter(t);r=r.zoom({pos:u,scale:s})}if(this.touchRotate){var f=t.rotation;r=r.rotate({deltaAngleX:this._startPinchRotation-f})}return this.updateViewport(r,A0,{isDragging:!0,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!!this.touchRotate}),this._lastPinchEvent=t,!0}},{key:"_onPinchEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchZoom){var r=this.touchZoom.inertia,s=r===void 0?k8:r,u=this._lastPinchEvent;if(s&&u&&t.scale!==u.scale){var f=this.getCenter(t),m=this.mapState.rotateEnd(),o=Math.log2(t.scale),T=(o-Math.log2(u.scale))/(t.deltaTime-u.deltaTime),C=Math.pow(2,o+T*s/2);return m=m.zoom({pos:f,scale:C}).zoomEnd(),this.updateViewport(m,yo(yo({},pc),{},{transitionInterpolator:new p2({around:f}),transitionDuration:s,transitionEasing:O8}),{isDragging:!1,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!1}),this.blockEvents(s),!0}}var R=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(R,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(t){var r=this.getCenter(t),s=this.mapState.rotateStart({pos:r});return this.updateViewport(s,A0,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(t){if(!this.isDragging()||!this.touchRotate)return!1;var r=this.getCenter(t);r[0]-=t.deltaX;var s=this.mapState.rotate({pos:r});return this.updateViewport(s,A0,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchRotate){var r=this.touchRotate.inertia,s=r===void 0?k8:r;if(s&&t.velocityY){var u=this.getCenter(t),f=[u[0],u[1]+=t.velocityY*s/2],m=this.mapState.rotate({pos:f});return this.updateViewport(m,yo(yo({},pc),{},{transitionDuration:s,transitionEasing:O8}),{isDragging:!1,isRotating:!0}),this.blockEvents(s),!1}}var o=this.mapState.rotateEnd();return this.updateViewport(o,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var r=this.getCenter(t),s=this.isFunctionKeyPressed(t),u=this.mapState.zoom({pos:r,scale:s?.5:2});return this.updateViewport(u,Object.assign({},pc,{transitionInterpolator:new p2({around:r})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var r=this.isFunctionKeyPressed(t),s=this.keyboard,u=s.zoomSpeed,f=u===void 0?2:u,m=s.moveSpeed,o=m===void 0?100:m,T=s.rotateSpeedX,C=T===void 0?15:T,R=s.rotateSpeedY,O=R===void 0?10:R,U=this.mapStateProps,V;switch(t.srcEvent.keyCode){case 189:r?V=this.getMapState({zoom:U.zoom-Math.log2(f)-1}):V=this.getMapState({zoom:U.zoom-Math.log2(f)});break;case 187:r?V=this.getMapState({zoom:U.zoom+Math.log2(f)+1}):V=this.getMapState({zoom:U.zoom+Math.log2(f)});break;case 37:r?V=this.getMapState({bearing:U.bearing-C}):V=this.mapState.pan({pos:[o,0],startPos:[0,0]});break;case 39:r?V=this.getMapState({bearing:U.bearing+C}):V=this.mapState.pan({pos:[-o,0],startPos:[0,0]});break;case 38:r?V=this.getMapState({pitch:U.pitch+O}):V=this.mapState.pan({pos:[0,o],startPos:[0,0]});break;case 40:r?V=this.getMapState({pitch:U.pitch-O}):V=this.mapState.pan({pos:[0,-o],startPos:[0,0]});break;default:return!1}return this.updateViewport(V,pc)}}]),n}();function lm(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function hc(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?lm(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):lm(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var CS=Object.assign({},wc.propTypes,{maxZoom:et.number,minZoom:et.number,maxPitch:et.number,minPitch:et.number,onViewStateChange:et.func,onViewportChange:et.func,onInteractionStateChange:et.func,transitionDuration:et.oneOfType([et.number,et.string]),transitionInterpolator:et.object,transitionInterruption:et.number,transitionEasing:et.func,onTransitionStart:et.func,onTransitionInterrupt:et.func,onTransitionEnd:et.func,scrollZoom:et.oneOfType([et.bool,et.object]),dragPan:et.oneOfType([et.bool,et.object]),dragRotate:et.oneOfType([et.bool,et.object]),doubleClickZoom:et.bool,touchZoom:et.oneOfType([et.bool,et.object]),touchRotate:et.oneOfType([et.bool,et.object]),keyboard:et.oneOfType([et.bool,et.object]),onHover:et.func,onClick:et.func,onDblClick:et.func,onContextMenu:et.func,onMouseDown:et.func,onMouseMove:et.func,onMouseUp:et.func,onTouchStart:et.func,onTouchMove:et.func,onTouchEnd:et.func,onMouseEnter:et.func,onMouseLeave:et.func,onMouseOut:et.func,onWheel:et.func,touchAction:et.string,eventRecognizerOptions:et.object,clickRadius:et.number,interactiveLayerIds:et.array,getCursor:et.func,controller:et.instanceOf(Py)}),PS=function(e){var t=e.isDragging,r=e.isHovering;return t?"grabbing":r?"pointer":"grab"},IS=Object.assign({},wc.defaultProps,R0,Bh.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(e){return e.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:PS});function Uh(n){if(n.lngLat||!n.offsetCenter)return n;var e=n.offsetCenter,t=e.x,r=e.y;if(!Number.isFinite(t)||!Number.isFinite(r))return n;var s=[t,r];if(n.point=s,this.map){var u=this.map.unproject(s);n.lngLat=[u.lng,u.lat]}return n}function Iy(n){var e=this.map;if(!e||!n)return null;var t={},r=this.props.clickRadius;this.props.interactiveLayerIds&&(t.layers=this.props.interactiveLayerIds);try{return e.queryRenderedFeatures(r?[[n[0]-r,n[1]+r],[n[0]+r,n[1]-r]]:n,t)}catch{return null}}function vc(n,e){var t=this.props[n];t&&t(Uh.call(this,e))}function MS(n){vc.call(this,n.pointerType==="touch"?"onTouchStart":"onMouseDown",n)}function RS(n){vc.call(this,n.pointerType==="touch"?"onTouchEnd":"onMouseUp",n)}function kS(n){if(vc.call(this,n.pointerType==="touch"?"onTouchMove":"onMouseMove",n),!this.state.isDragging){var e=this.props,t=e.onHover,r=e.interactiveLayerIds,s;n=Uh.call(this,n),(r||t)&&(s=Iy.call(this,n.point));var u=!!(r&&s&&s.length>0),f=u&&!this.state.isHovering,m=!u&&this.state.isHovering;(t||f)&&(n.features=s,t&&t(n)),f&&vc.call(this,"onMouseEnter",n),m&&vc.call(this,"onMouseLeave",n),(f||m)&&this.setState({isHovering:u})}}function cm(n){var e=this.props,t=e.onClick,r=e.onNativeClick,s=e.onDblClick,u=e.doubleClickZoom,f=[],m=s||u;switch(n.type){case"anyclick":f.push(r),m||f.push(t);break;case"click":m&&f.push(t);break}f=f.filter(Boolean),f.length&&(n=Uh.call(this,n),n.features=Iy.call(this,n.point),f.forEach(function(o){return o(n)}))}function OS(n){return{getMap:n.current&&n.current.getMap,queryRenderedFeatures:n.current&&n.current.queryRenderedFeatures}}var Vh=lt.forwardRef(function(n,e){var t=lt.useContext(hu),r=lt.useMemo(function(){return n.controller||new Py},[]),s=lt.useMemo(function(){return new AS(null,{touchAction:n.touchAction,recognizerOptions:n.eventRecognizerOptions})},[]),u=lt.useRef(null),f=lt.useRef(null),m=lt.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),o=m.current;o.props=n,o.map=f.current&&f.current.getMap(),o.setState=function(Fe){o.state=hc(hc({},o.state),Fe),u.current.style.cursor=n.getCursor(o.state)};var T=!0,C,R,O=function(yt,xt,ht){if(T){C=[yt,xt,ht];return}var kt=o.props,Bt=kt.onViewStateChange,Vt=kt.onViewportChange;Object.defineProperty(yt,"position",{get:function(){return[0,0,m6(o.map,yt)]}}),Bt&&Bt({viewState:yt,interactionState:xt,oldViewState:ht}),Vt&&Vt(yt,xt,ht)};lt.useImperativeHandle(e,function(){return OS(f)},[]);var U=lt.useMemo(function(){return hc(hc({},t),{},{eventManager:s,container:t.container||u.current})},[t,u.current]);U.onViewportChange=O,U.viewport=t.viewport||Ty(o),o.viewport=U.viewport;var V=function(yt){var xt=yt.isDragging,ht=xt===void 0?!1:xt;if(ht!==o.state.isDragging&&o.setState({isDragging:ht}),T){R=yt;return}var kt=o.props.onInteractionStateChange;kt&&kt(yt)},Y=function(){o.width&&o.height&&r.setOptions(hc(hc(hc({},o.props),o.props.viewState),{},{isInteractive:!!(o.props.onViewStateChange||o.props.onViewportChange),onViewportChange:O,onStateChange:V,eventManager:s,width:o.width,height:o.height}))},ee=function(yt){var xt=yt.width,ht=yt.height;o.width=xt,o.height=ht,Y(),o.props.onResize({width:xt,height:ht})};lt.useEffect(function(){return s.setElement(u.current),s.on({pointerdown:MS.bind(o),pointermove:kS.bind(o),pointerup:RS.bind(o),pointerleave:vc.bind(o,"onMouseOut"),click:cm.bind(o),anyclick:cm.bind(o),dblclick:vc.bind(o,"onDblClick"),wheel:vc.bind(o,"onWheel"),contextmenu:vc.bind(o,"onContextMenu")}),function(){s.destroy()}},[]),O9(function(){C&&O.apply(void 0,iT(C)),R&&V(R)}),Y();var le=n.width,Ee=n.height,ue=n.style,_e=n.getCursor,Me=lt.useMemo(function(){return hc(hc({position:"relative"},ue),{},{width:le,height:Ee,cursor:_e(o.state)})},[ue,le,Ee,_e,o.state]);return(!C||!o._child)&&(o._child=lt.createElement(Lh,{value:U},lt.createElement("div",{key:"event-canvas",ref:u,style:Me},lt.createElement(wc,p7({},n,{width:"100%",height:"100%",style:null,onResize:ee,ref:f}))))),T=!1,o._child});Vh.supported=wc.supported;Vh.propTypes=CS;Vh.defaultProps=IS;et.string.isRequired,et.string;var DS=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade","sky"];et.oneOf(DS).isRequired,et.string,et.string,et.string;var M3={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},Fl={captureScroll:et.bool,captureDrag:et.bool,captureClick:et.bool,captureDoubleClick:et.bool,capturePointerMove:et.bool};function LS(n){var e=n.containerRef.current,t=n.context.eventManager;if(!(!e||!t)){var r={wheel:function(u){var f=n.props;f.captureScroll&&u.stopPropagation(),f.onScroll&&f.onScroll(u,n)},panstart:function(u){var f=n.props;f.captureDrag&&u.stopPropagation(),f.onDragStart&&f.onDragStart(u,n)},anyclick:function(u){var f=n.props;f.captureClick&&u.stopPropagation(),f.onNativeClick&&f.onNativeClick(u,n)},click:function(u){var f=n.props;f.captureClick&&u.stopPropagation(),f.onClick&&f.onClick(u,n)},dblclick:function(u){var f=n.props;f.captureDoubleClick&&u.stopPropagation(),f.onDoubleClick&&f.onDoubleClick(u,n)},pointermove:function(u){var f=n.props;f.capturePointerMove&&u.stopPropagation(),f.onPointerMove&&f.onPointerMove(u,n)}};return t.watch(r,e),function(){t.off(r)}}}function R3(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=lt.useContext(hu),t=lt.useRef(null),r=lt.useRef({props:n,state:{},context:e,containerRef:t}),s=r.current;return s.props=n,s.context=e,lt.useEffect(function(){return LS(s)},[e.eventManager]),s}function FS(n){var e=NS();return function(){var r=A3(n),s;if(e){var u=A3(this).constructor;s=Reflect.construct(r,arguments,u)}else s=r.apply(this,arguments);return Nh(this,s)}}function NS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function BS(n){var e=n.instance,t=R3(n),r=t.context,s=t.containerRef;return e._context=r,e._containerRef=s,e._render()}var My=function(n){Fh(t,n);var e=FS(t);function t(){var r;P3(this,t);for(var s=arguments.length,u=new Array(s),f=0;f<s;f++)u[f]=arguments[f];return r=e.call.apply(e,[this].concat(u)),Dn(dc(r),"_context",{}),Dn(dc(r),"_containerRef",lt.createRef()),Dn(dc(r),"_onScroll",function(m){}),Dn(dc(r),"_onDragStart",function(m){}),Dn(dc(r),"_onDblClick",function(m){}),Dn(dc(r),"_onClick",function(m){}),Dn(dc(r),"_onPointerMove",function(m){}),r}return I3(t,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return lt.createElement(BS,p7({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),t}(lt.PureComponent);Dn(My,"propTypes",Fl);Dn(My,"defaultProps",M3);function um(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function hm(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?um(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):um(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var zS=Object.assign({},Fl,{draggable:et.bool,onDrag:et.func,onDragEnd:et.func,onDragStart:et.func,offsetLeft:et.number,offsetTop:et.number}),US=Object.assign({},M3,{draggable:!1,offsetLeft:0,offsetTop:0});function Ry(n){var e=n.offsetCenter,t=e.x,r=e.y;return[t,r]}function VS(n,e){var t=n.center,r=t.x,s=t.y;if(e){var u=e.getBoundingClientRect();return[u.left-r,u.top-s]}return null}function jh(n,e,t,r){var s=n[0]+e[0]-t.offsetLeft,u=n[1]+e[1]-t.offsetTop;return r.viewport.unproject([s,u])}function jS(n,e){var t=e.props,r=e.callbacks,s=e.state,u=e.context,f=e.containerRef,m=t.draggable;if(m){n.stopPropagation();var o=Ry(n),T=VS(n,f.current);if(s.setDragPos(o),s.setDragOffset(T),r.onDragStart&&T){var C=Object.assign({},n);C.lngLat=jh(o,T,t,u),r.onDragStart(C)}}}function $S(n,e){var t=e.props,r=e.callbacks,s=e.state,u=e.context;n.stopPropagation();var f=Ry(n);s.setDragPos(f);var m=s.dragOffset;if(r.onDrag&&m){var o=Object.assign({},n);o.lngLat=jh(f,m,t,u),r.onDrag(o)}}function WS(n,e){var t=e.props,r=e.callbacks,s=e.state,u=e.context;n.stopPropagation();var f=s.dragPos,m=s.dragOffset;if(s.setDragPos(null),s.setDragOffset(null),r.onDragEnd&&f&&m){var o=Object.assign({},n);o.lngLat=jh(f,m,t,u),r.onDragEnd(o)}}function HS(n,e){var t=e.state;n.stopPropagation(),t.setDragPos(null),t.setDragOffset(null)}function XS(n){var e=n.context.eventManager;if(!(!e||!n.state.dragPos)){var t={panmove:function(s){return $S(s,n)},panend:function(s){return WS(s,n)},pancancel:function(s){return HS(s,n)}};return e.watch(t),function(){e.off(t)}}}function ZS(n){var e=lt.useState(null),t=Hi(e,2),r=t[0],s=t[1],u=lt.useState(null),f=Hi(u,2),m=f[0],o=f[1],T=R3(hm(hm({},n),{},{onDragStart:jS}));return T.callbacks=n,T.state.dragPos=r,T.state.setDragPos=s,T.state.dragOffset=m,T.state.setDragOffset=o,lt.useEffect(function(){return XS(T)},[T.context.eventManager,!!r]),T}var fm=typeof window<"u"&&window.devicePixelRatio||1,C2=function(e){return Math.round(e*fm)/fm},dm=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(e===null)return t;var s=r==="x"?e.offsetWidth:e.offsetHeight;return C2(t/100*s)/s*100};function pm(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function qS(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pm(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):pm(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var GS=Object.assign({},zS,{className:et.string,longitude:et.number.isRequired,latitude:et.number.isRequired,style:et.object}),YS=Object.assign({},US,{className:""});function KS(n){var e=n.props,t=n.state,r=n.context,s=e.longitude,u=e.latitude,f=e.offsetLeft,m=e.offsetTop,o=t.dragPos,T=t.dragOffset,C=r.viewport,R=r.map;if(o&&T)return[o[0]+T[0],o[1]+T[1]];var O=m6(R,{longitude:s,latitude:u}),U=C.project([s,u,O]),V=Hi(U,2),Y=V[0],ee=V[1];return Y+=f,ee+=m,[Y,ee]}function $h(n){var e=ZS(n),t=e.state,r=e.containerRef,s=n.children,u=n.className,f=n.draggable,m=n.style,o=t.dragPos,T=KS(e),C=Hi(T,2),R=C[0],O=C[1],U="translate(".concat(C2(R),"px, ").concat(C2(O),"px)"),V=f?o?"grabbing":"grab":"auto",Y=lt.useMemo(function(){var le=qS({position:"absolute",left:0,top:0,transform:U,cursor:V},m);return lt.createElement("div",{className:"mapboxgl-marker ".concat(u),ref:e.containerRef,style:le},s)},[s,u]),ee=r.current;return ee&&(ee.style.transform=U,ee.style.cursor=V),Y}$h.defaultProps=YS;$h.propTypes=GS;lt.memo($h);var P2={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},JS=Object.keys(P2);function QS(n){var e=n.x,t=n.y,r=n.width,s=n.height,u=n.selfWidth,f=n.selfHeight,m=n.anchor,o=n.padding,T=o===void 0?0:o,C=P2[m],R=C.x,O=C.y,U=t-O*f,V=U+f,Y=Math.max(0,T-U)+Math.max(0,V-s+T);if(Y>0){var ee=O,le=Y;for(O=0;O<=1;O+=.5)U=t-O*f,V=U+f,Y=Math.max(0,T-U)+Math.max(0,V-s+T),Y<le&&(le=Y,ee=O);O=ee}var Ee=.5;O===.5&&(R=Math.floor(R),Ee=1);var ue=e-R*u,_e=ue+u,Me=Math.max(0,T-ue)+Math.max(0,_e-r+T);if(Me>0){var Fe=R,yt=Me;for(R=0;R<=1;R+=Ee)ue=e-R*u,_e=ue+u,Me=Math.max(0,T-ue)+Math.max(0,_e-r+T),Me<yt&&(yt=Me,Fe=R);R=Fe}return JS.find(function(xt){var ht=P2[xt];return ht.x===R&&ht.y===O})||m}var eA=Object.assign({},Fl,{className:et.string,longitude:et.number.isRequired,latitude:et.number.isRequired,altitude:et.number,offsetLeft:et.number,offsetTop:et.number,tipSize:et.number,closeButton:et.bool,closeOnClick:et.bool,anchor:et.oneOf(Object.keys(P2)),dynamicPosition:et.bool,sortByDepth:et.bool,onClose:et.func}),tA=Object.assign({},M3,{className:"",offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function nA(n,e,t,r){var s=Hi(r,2),u=s[0],f=s[1],m=n.anchor,o=n.dynamicPosition,T=n.tipSize;return t&&o?QS({x:u,y:f,anchor:m,padding:T,width:e.width,height:e.height,selfWidth:t.clientWidth,selfHeight:t.clientHeight}):m}function rA(n,e,t,r,s){var u=Hi(r,3),f=u[0],m=u[1],o=u[2],T=n.offsetLeft,C=n.offsetTop,R=n.sortByDepth,O=P2[s],U=f+T,V=m+C,Y=dm(t,-O.x*100),ee=dm(t,-O.y*100,"y"),le={position:"absolute",transform:`
      translate(`.concat(Y,"%, ").concat(ee,`%)
      translate(`).concat(C2(U),"px, ").concat(C2(V),`px)
    `),display:void 0,zIndex:void 0};return R&&(o>1||o<-1||f<0||f>e.width||m<0||m>e.height?le.display="none":le.zIndex=Math.floor((1-o)/2*1e5)),le}function Wh(n){var e=lt.useRef(null),t=R3(n),r=t.context,s=t.containerRef,u=lt.useState(!1),f=Hi(u,2),m=f[1];lt.useEffect(function(){m(!0)},[e.current]),lt.useEffect(function(){if(r.eventManager&&n.closeOnClick){var Me=function(){return t.props.onClose()};return r.eventManager.on("anyclick",Me),function(){r.eventManager.off("anyclick",Me)}}},[r.eventManager,n.closeOnClick]);var o=r.viewport,T=r.map,C=n.className,R=n.longitude,O=n.latitude,U=n.tipSize,V=n.closeButton,Y=n.children,ee=n.altitude;ee===void 0&&(ee=m6(T,{longitude:R,latitude:O}));var le=o.project([R,O,ee]),Ee=nA(n,o,e.current,le),ue=rA(n,o,s.current,le,Ee),_e=lt.useCallback(function(Me){t.props.onClose();var Fe=t.context.eventManager;Fe&&Fe.once("click",function(yt){return yt.stopPropagation()},Me.target)},[]);return lt.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(Ee," ").concat(C),style:ue,ref:s},lt.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:U}}),lt.createElement("div",{key:"content",ref:e,className:"mapboxgl-popup-content"},V&&lt.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:_e},""),Y))}Wh.propTypes=eA;Wh.defaultProps=tA;lt.memo(Wh);function mm(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function iA(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mm(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):mm(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var sA=Object.assign({},Fl,{toggleLabel:et.string,className:et.string,style:et.object,compact:et.bool,customAttribution:et.oneOfType([et.string,et.arrayOf(et.string)])}),oA=Object.assign({},M3,{className:"",toggleLabel:"Toggle Attribution"});function aA(n,e,t,r){var s=new w1.AttributionControl(n);return s._map=e,s._container=t,s._innerContainer=r,s._updateAttributions(),s._updateEditLink(),e.on("styledata",s._updateData),e.on("sourcedata",s._updateData),s}function lA(n){n._map.off("styledata",n._updateData),n._map.off("sourcedata",n._updateData)}function Hh(n){var e=R3(n),t=e.context,r=e.containerRef,s=lt.useRef(null),u=lt.useState(!1),f=Hi(u,2),m=f[0],o=f[1];lt.useEffect(function(){var O;return t.map&&(O=aA({customAttribution:n.customAttribution},t.map,r.current,s.current)),function(){return O&&lA(O)}},[t.map]);var T=n.compact===void 0?t.viewport.width<=640:n.compact;lt.useEffect(function(){!T&&m&&o(!1)},[T]);var C=lt.useCallback(function(){return o(function(O){return!O})},[]),R=lt.useMemo(function(){return iA({position:"absolute"},n.style)},[n.style]);return lt.createElement("div",{style:R,className:n.className},lt.createElement("div",{ref:r,"aria-pressed":m,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(T?"mapboxgl-compact":""," ").concat(m?"mapboxgl-compact-show":"")},lt.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:n.toggleLabel,onClick:C}),lt.createElement("div",{ref:s,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}Hh.propTypes=sA;Hh.defaultProps=oA;lt.memo(Hh);function gm(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function cA(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gm(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):gm(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var uA=Object.assign({},Fl,{className:et.string,style:et.object,container:et.object,label:et.string}),hA=Object.assign({},M3,{className:"",container:null,label:"Toggle fullscreen"});function Xh(n){var e=R3(n),t=e.context,r=e.containerRef,s=lt.useState(!1),u=Hi(s,2),f=u[0],m=u[1],o=lt.useState(!1),T=Hi(o,2),C=T[0],R=T[1],O=lt.useState(null),U=Hi(O,2),V=U[0],Y=U[1];lt.useEffect(function(){var Me=new w1.FullscreenControl;Y(Me),R(Me._checkFullscreenSupport());var Fe=function(){var xt=!Me._fullscreen;Me._fullscreen=xt,m(xt)};return _c.addEventListener(Me._fullscreenchange,Fe),function(){_c.removeEventListener(Me._fullscreenchange,Fe)}},[]);var ee=function(){V&&(V._container=n.container||t.container,V._onClickFullscreen())},le=lt.useMemo(function(){return cA({position:"absolute"},n.style)},[n.style]);if(!C)return null;var Ee=n.className,ue=n.label,_e=f?"shrink":"fullscreen";return lt.createElement("div",{style:le,className:Ee},lt.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:r},lt.createElement("button",{key:_e,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(_e),type:"button",title:ue,onClick:ee},lt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}Xh.propTypes=uA;Xh.defaultProps=hA;lt.memo(Xh);var R4;function fA(){return R4!==void 0?Promise.resolve(R4):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(n){return R4=n.state!=="denied",R4}):(R4=!!window.navigator.geolocation,Promise.resolve(R4))}function _m(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function dA(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_m(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):_m(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var ym=function(){},pA=Object.assign({},Fl,{className:et.string,style:et.object,label:et.string,disabledLabel:et.string,auto:et.bool,positionOptions:et.object,fitBoundsOptions:et.object,trackUserLocation:et.bool,showUserLocation:et.bool,showAccuracyCircle:et.bool,showUserHeading:et.bool,onViewStateChange:et.func,onViewportChange:et.func,onGeolocate:et.func}),mA=Object.assign({},M3,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function gA(n){var e=new w1.LngLat(n.coords.longitude,n.coords.latitude),t=n.coords.accuracy,r=e.toBounds(t);return[[r._ne.lng,r._ne.lat],[r._sw.lng,r._sw.lat]]}function _A(n,e,t){var r=new w1.GeolocateControl(e);r._container=_c.createElement("div"),r._map={on:function(){},_getUIString:function(){return""}},r._setupUI(!0),r._map=n.map,r._geolocateButton=t;var s=n.eventManager;return r.options.trackUserLocation&&s&&s.on("panstart",function(){r._watchState==="ACTIVE_LOCK"&&(r._watchState="BACKGROUND",t.classList.add("mapboxgl-ctrl-geolocate-background"),t.classList.remove("mapboxgl-ctrl-geolocate-active"))}),r.on("geolocate",e.onGeolocate),r}function yA(n,e){var t=e.context,r=e.props,s=gA(n),u=t.viewport.fitBounds(s,r.fitBoundsOptions),f=u.longitude,m=u.latitude,o=u.zoom,T=Object.assign({},t.viewport,{longitude:f,latitude:m,zoom:o}),C=new q4(T),R=Object.assign({},C.getViewportProps(),pc),O=r.onViewportChange||t.onViewportChange||ym,U=r.onViewStateChange||t.onViewStateChange||ym;U({viewState:R}),O(R)}function Zh(n){var e=R3(n),t=e.context,r=e.containerRef,s=lt.useRef(null),u=lt.useState(null),f=Hi(u,2),m=f[0],o=f[1],T=lt.useState(!1),C=Hi(T,2),R=C[0],O=C[1];lt.useEffect(function(){var ue;return t.map&&fA().then(function(_e){O(_e),s.current&&(ue=_A(t,n,s.current),ue._updateCamera=function(Me){return yA(Me,e)},o(ue))}),function(){ue&&ue._clearWatch()}},[t.map]);var U=lt.useCallback(function(){m&&(m.options=e.props,m.trigger())},[m]);lt.useEffect(function(){n.auto&&U()},[m,n.auto]),lt.useEffect(function(){m&&m._onZoom()},[t.viewport.zoom]);var V=n.className,Y=n.label,ee=n.disabledLabel,le=n.trackUserLocation,Ee=lt.useMemo(function(){return dA({position:"absolute"},n.style)},[n.style]);return lt.createElement("div",{style:Ee,className:V},lt.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:r},lt.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:s,disabled:!R,"aria-pressed":!le,type:"button",title:R?Y:ee,"aria-label":R?Y:ee,onClick:U},lt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}Zh.propTypes=pA;Zh.defaultProps=mA;lt.memo(Zh);function vA(n,e){for(var t=(n||"").split(".").map(Number),r=e.split(".").map(Number),s=0;s<3;s++){var u=t[s]||0,f=r[s]||0;if(u<f)return-1;if(u>f)return 1}return 0}function vm(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function xA(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vm(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):vm(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var xm=function(){},bA=Object.assign({},Fl,{className:et.string,style:et.object,onViewStateChange:et.func,onViewportChange:et.func,showCompass:et.bool,showZoom:et.bool,zoomInLabel:et.string,zoomOutLabel:et.string,compassLabel:et.string}),wA=Object.assign({},M3,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),TA=1,U9=2;function EA(n){return vA(n,"1.6.0")>=0?U9:TA}function L5(n,e,t){var r=n.viewport,s=new q4(Object.assign({},r,t)),u=Object.assign({},s.getViewportProps(),pc),f=e.onViewportChange||n.onViewportChange||xm,m=e.onViewStateChange||n.onViewStateChange||xm;m({viewState:u}),f(u)}function F5(n,e,t,r){return lt.createElement("button",{key:n,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(n),type:"button",title:e,onClick:t},r||lt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function SA(n){var e=lt.useMemo(function(){return n.map?EA(n.map.version):U9},[n.map]),t=n.viewport.bearing,r={transform:"rotate(".concat(-t,"deg)")};return e===U9?lt.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:r}):lt.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:r})}function qh(n){var e=R3(n),t=e.context,r=e.containerRef,s=function(){L5(t,n,{zoom:t.viewport.zoom+1})},u=function(){L5(t,n,{zoom:t.viewport.zoom-1})},f=function(){L5(t,n,{bearing:0,pitch:0})},m=n.className,o=n.showCompass,T=n.showZoom,C=n.zoomInLabel,R=n.zoomOutLabel,O=n.compassLabel,U=lt.useMemo(function(){return xA({position:"absolute"},n.style)},[n.style]);return lt.createElement("div",{style:U,className:m},lt.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:r},T&&F5("zoom-in",C,s),T&&F5("zoom-out",R,u),o&&F5("compass",O,f,SA(t))))}qh.propTypes=bA;qh.defaultProps=wA;lt.memo(qh);function bm(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function AA(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bm(Object(t),!0).forEach(function(r){Dn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):bm(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var CA=Object.assign({},Fl,{className:et.string,style:et.object,maxWidth:et.number,unit:et.oneOf(["imperial","metric","nautical"])}),PA=Object.assign({},M3,{className:"",maxWidth:100,unit:"metric"});function Gh(n){var e=R3(n),t=e.context,r=e.containerRef,s=lt.useState(null),u=Hi(s,2),f=u[0],m=u[1];lt.useEffect(function(){if(t.map){var T=new w1.ScaleControl;T._map=t.map,T._container=r.current,m(T)}},[t.map]),f&&(f.options=n,f._onMove());var o=lt.useMemo(function(){return AA({position:"absolute"},n.style)},[n.style]);return lt.createElement("div",{style:o,className:n.className},lt.createElement("div",{ref:r,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}Gh.propTypes=CA;Gh.defaultProps=PA;lt.memo(Gh);Object.assign({},Fl,{redraw:et.func.isRequired});Object.assign({},Fl,{redraw:et.func.isRequired,style:et.object});Object.assign({},Fl,{redraw:et.func.isRequired,style:et.object});w1&&w1.setRTLTextPlugin;function b7(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const Yh=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),wm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);wm&&parseFloat(wm[1]);const D8=globalThis,k4=globalThis.process||{},IA=globalThis.navigator||{};function ky(n){var r,s;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function j0(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||ky()}function MA(n){return j0()?ky()?"Electron":(IA.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const Oy="4.1.0";function RA(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class kA{constructor(e,t,r="sessionStorage"){this.storage=RA(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function OA(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function DA(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var w7;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(w7||(w7={}));const LA=10;function Tm(n){return typeof n!="string"?n:(n=n.toUpperCase(),w7[n]||w7.WHITE)}function FA(n,e,t){return!j0&&typeof n=="string"&&(e&&(n=`\x1B[${Tm(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${Tm(t)+LA}m${n}\x1B[49m`)),n}function NA(n,e=["constructor"]){const t=Object.getPrototypeOf(n),r=Object.getOwnPropertyNames(t),s=n;for(const u of r){const f=s[u];typeof f=="function"&&(e.find(m=>u===m)||(s[u]=f.bind(n)))}}function Kh(n,e){if(!n)throw new Error("Assertion failed")}function O4(){var e,t,r;let n;if(j0()&&D8.performance)n=(t=(e=D8==null?void 0:D8.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in k4){const s=(r=k4==null?void 0:k4.hrtime)==null?void 0:r.call(k4);n=s[0]*1e3+s[1]/1e6}else n=Date.now();return n}const D4={debug:j0()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},BA={enabled:!0,level:0};function L4(){}const Em={},Sm={once:!0};class N2{constructor({id:e}={id:""}){this.VERSION=Oy,this._startTs=O4(),this._deltaTs=O4(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new kA(`__probe-${this.id}__`,BA),this.timeStamp(`${this.id} started`),NA(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((O4()-this._startTs).toPrecision(10))}getDelta(){return Number((O4()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,D4.warn,arguments,Sm)}error(e){return this._getLogFunction(0,e,D4.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,D4.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,D4.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,D4.debug||D4.info,arguments,Sm)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||L4,r&&[r],{tag:UA(t)}):L4}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||L4)}group(e,t,r={collapsed:!1}){const s=Am({logLevel:e,message:t,opts:r}),{collapsed:u}=r;return s.method=(u?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||L4)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Dy(e)}_getLogFunction(e,t,r,s,u){if(this._shouldLog(e)){u=Am({logLevel:e,message:t,args:s,opts:u}),r=r||u.method,Kh(r),u.total=this.getTotal(),u.delta=this.getDelta(),this._deltaTs=O4();const f=u.tag||u.message;if(u.once&&f)if(!Em[f])Em[f]=O4();else return L4;return t=zA(this.id,u.message,u),r.bind(console,t,...u.args)}return L4}}N2.VERSION=Oy;function Dy(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return Kh(Number.isFinite(e)&&e>=0),e}function Am(n){const{logLevel:e,message:t}=n;n.logLevel=Dy(e);const r=n.args?Array.from(n.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return Kh(s==="string"||s==="object"),Object.assign(n,{args:r},n.opts)}function zA(n,e,t){if(typeof e=="string"){const r=t.time?DA(OA(t.total)):"";e=t.time?`${n}: ${r}  ${e}`:`${n}: ${e}`,e=FA(e,t.color,t.background)}return e}function UA(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const N5="4.3.3",VA=N5[0]>="0"&&N5[0]<="9"?`v${N5}`:"";function jA(){const n=new N2({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=VA,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const $A=jA();function WA(n,e){return Ly(n||{},e)}function Ly(n,e,t=0){if(t>3)return e;const r={...n};for(const[s,u]of Object.entries(e))u&&typeof u=="object"&&!Array.isArray(u)?r[s]=Ly(r[s]||{},e[s],t+1):r[s]=e[s];return r}const HA="latest";function XA(){var n;return(n=globalThis._loadersgl_)!=null&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const ZA=XA();function C3(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const D0=typeof process!="object"||String(process)!=="[object process]"||process.browser,qA=typeof window<"u"&&typeof window.orientation<"u",Cm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Cm&&parseFloat(Cm[1]);class GA{constructor(e,t){ne(this,"name");ne(this,"workerThread");ne(this,"isRunning",!0);ne(this,"result");ne(this,"_resolve",()=>{});ne(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((r,s)=>{this._resolve=r,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){C3(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){C3(this.isRunning),this.isRunning=!1,this._reject(e)}}class B5{terminate(){}}const z5=new Map;function YA(n){C3(n.source&&!n.url||!n.source&&n.url);let e=z5.get(n.source||n.url);return e||(n.url&&(e=KA(n.url),z5.set(n.url,e)),n.source&&(e=Fy(n.source),z5.set(n.source,e))),C3(e),e}function KA(n){if(!n.startsWith("http"))return n;const e=JA(n);return Fy(e)}function Fy(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function JA(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Ny(n,e=!0,t){const r=t||new Set;if(n){if(Pm(n))r.add(n);else if(Pm(n.buffer))r.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const s in n)Ny(n[s],e,r)}}return t===void 0?Array.from(r):[]}function Pm(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const U5=()=>{};class V9{constructor(e){ne(this,"name");ne(this,"source");ne(this,"url");ne(this,"terminated",!1);ne(this,"worker");ne(this,"onMessage");ne(this,"onError");ne(this,"_loadableURL","");const{name:t,source:r,url:s}=e;C3(r||s),this.name=t,this.source=r,this.url=s,this.onMessage=U5,this.onError=u=>console.log(u),this.worker=D0?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&D0||typeof B5<"u"&&!D0}destroy(){this.onMessage=U5,this.onError=U5,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||Ny(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=YA({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new B5(r,{eval:!1})}else if(this.source)e=new B5(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class QA{constructor(e){ne(this,"name","unnamed");ne(this,"source");ne(this,"url");ne(this,"maxConcurrency",1);ne(this,"maxMobileConcurrency",1);ne(this,"onDebug",()=>{});ne(this,"reuseWorkers",!0);ne(this,"props",{});ne(this,"jobQueue",[]);ne(this,"idleQueue",[]);ne(this,"count",0);ne(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return V9.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,u,f)=>s.done(f),r=(s,u)=>s.error(u)){const s=new Promise(u=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:u}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new GA(t.name,e);e.onMessage=s=>t.onMessage(r,s.type,s.payload),e.onError=s=>t.onError(r,s),t.onStart(r);try{await r.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!D0||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new V9({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return qA?this.maxMobileConcurrency:this.maxConcurrency}}const eC={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},p3=class p3{constructor(e){ne(this,"props");ne(this,"workerPools",new Map);this.props={...eC},this.setProps(e),this.workerPools=new Map}static isSupported(){return V9.isSupported()}static getWorkerFarm(e={}){return p3._workerFarm=p3._workerFarm||new p3({}),p3._workerFarm.setProps(e),p3._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:s}=e;let u=this.workerPools.get(t);return u||(u=new QA({name:t,source:r,url:s}),u.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,u)),u}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};ne(p3,"_workerFarm");let T7=p3;function tC(n,e={}){const t=e[n.id]||{},r=D0?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(D0?s=`modules/${n.module}/dist/${r}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let u=n.version;u==="latest"&&(u=HA);const f=u?`@${u}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${f}/dist/${r}`}return C3(s),s}function nC(n,e=ZA){C3(n,"no worker provided");const t=n.version;return!(!e||!t)}function rC(n,e){return!T7.isSupported()||!D0&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&(e==null?void 0:e.worker)}async function iC(n,e,t,r,s){const u=n.id,f=tC(n,t),o=T7.getWorkerFarm(t).getWorkerPool({name:u,url:f});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const T=await o.startJob("process-on-worker",sC.bind(null,s));return T.postMessage("process",{input:e,options:t,context:r}),await(await T.result).result}async function sC(n,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:s,input:u,options:f}=r;try{const m=await n(u,f);e.postMessage("done",{id:s,result:m})}catch(m){const o=m instanceof Error?m.message:"unknown error";e.postMessage("error",{id:s,error:o})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function oC(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(n),s=new Uint8Array(e);for(let u=0;u<r.length;++u)if(r[u]!==s[u])return!1;return!0}function aC(...n){return lC(n)}function lC(n){const e=n.map(u=>u instanceof ArrayBuffer?new Uint8Array(u):u),t=e.reduce((u,f)=>u+f.byteLength,0),r=new Uint8Array(t);let s=0;for(const u of e)r.set(u,s),s+=u.byteLength;return r.buffer}async function cC(n){const e=[];for await(const t of n)e.push(t);return aC(...e)}function Im(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class Mm{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Im(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Im()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class g6{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let s=this.stats[t];return s||(e instanceof Mm?s=e:s=new Mm(t,r),this.stats[t]=s),s}}let uC="";const Rm={};function hC(n){for(const e in Rm)if(n.startsWith(e)){const t=Rm[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${uC}${n}`),n}function fC(n){return n&&typeof n=="object"&&n.isBuffer}function By(n){if(fC(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function zy(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function dC(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const pC=n=>typeof n=="boolean",_2=n=>typeof n=="function",B2=n=>n!==null&&typeof n=="object",km=n=>B2(n)&&n.constructor==={}.constructor,mC=n=>!!n&&typeof n[Symbol.iterator]=="function",gC=n=>n&&typeof n[Symbol.asyncIterator]=="function",$0=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,W0=n=>typeof Blob<"u"&&n instanceof Blob,_C=n=>n&&typeof n=="object"&&n.isBuffer,yC=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||B2(n)&&_2(n.tee)&&_2(n.cancel)&&_2(n.getReader),vC=n=>B2(n)&&_2(n.read)&&_2(n.pipe)&&pC(n.readable),Uy=n=>yC(n)||vC(n);class xC extends Error{constructor(t,r){super(t);ne(this,"reason");ne(this,"url");ne(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const bC=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,wC=/^([-\w.]+\/[-\w.+]+)/;function Om(n,e){return n.toLowerCase()===e.toLowerCase()}function TC(n){const e=wC.exec(n);return e?e[1]:n}function Dm(n){const e=bC.exec(n);return e?e[1]:""}const Vy=/\?.*/;function EC(n){const e=n.match(Vy);return e&&e[0]}function Jh(n){return n.replace(Vy,"")}function SC(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function _6(n){return $0(n)?n.url:W0(n)?n.name||"":typeof n=="string"?n:""}function Qh(n){if($0(n)){const e=n,t=e.headers.get("content-type")||"",r=Jh(e.url);return TC(t)||Dm(r)}return W0(n)?n.type||"":typeof n=="string"?Dm(n):""}function AC(n){return $0(n)?n.headers["content-length"]||-1:W0(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function jy(n){if($0(n))return n;const e={},t=AC(n);t>=0&&(e["content-length"]=String(t));const r=_6(n),s=Qh(n);s&&(e["content-type"]=s);const u=await IC(n);u&&(e["x-first-bytes"]=u),typeof n=="string"&&(n=new TextEncoder().encode(n));const f=new Response(n,{headers:e});return Object.defineProperty(f,"url",{value:r}),f}async function CC(n){if(!n.ok)throw await PC(n)}async function PC(n){const e=SC(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const r={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");r.reason=!n.bodyUsed&&(s!=null&&s.includes("application/json"))?await n.json():await n.text()}catch{}return new xC(t,r)}async function IC(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(r=>{const s=new FileReader;s.onload=u=>{var f;return r((f=u==null?void 0:u.target)==null?void 0:f.result)},s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${MC(t)}`}return null}function MC(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function RC(n){return!kC(n)&&!OC(n)}function kC(n){return n.startsWith("http:")||n.startsWith("https:")}function OC(n){return n.startsWith("data:")}async function Lm(n,e){var t,r;if(typeof n=="string"){const s=hC(n);return RC(s)&&(t=globalThis.loaders)!=null&&t.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(s,e):await fetch(s,e)}return await jy(n)}const Fm=new N2({id:"loaders.gl"});class DC{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class LC{constructor(){ne(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const $y={fetch:null,mimeType:void 0,nothrow:!1,log:new LC,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Yh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},FC={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Wy(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function Hy(){const n=Wy();return n.globalOptions=n.globalOptions||{...$y},n.globalOptions}function NC(n,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],BC(n,t),UC(e,n,r)}function BC(n,e){Nm(n,null,$y,FC,e);for(const t of e){const r=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},u=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};Nm(r,t.id,s,u,e)}}function Nm(n,e,t,r,s){const u=e||"Top level",f=e?`${e}.`:"";for(const m in n){const o=!e&&B2(n[m]),T=m==="baseUri"&&!e,C=m==="workerUrl"&&e;if(!(m in t)&&!T&&!C){if(m in r)Fm.warn(`${u} loader option '${f}${m}' no longer supported, use '${r[m]}'`)();else if(!o){const R=zC(m,s);Fm.warn(`${u} loader option '${f}${m}' not recognized. ${R}`)()}}}}function zC(n,e){const t=n.toLowerCase();let r="";for(const s of e)for(const u in s.options){if(n===u)return`Did you mean '${s.id}.${u}'?`;const f=u.toLowerCase();(t.startsWith(f)||f.startsWith(t))&&(r=r||`Did you mean '${s.id}.${u}'?`)}return r}function UC(n,e,t){const s={...n.options||{}};return VC(s,t),s.log===null&&(s.log=new DC),Bm(s,Hy()),Bm(s,e),s}function Bm(n,e){for(const t in e)if(t in e){const r=e[t];km(r)&&km(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function VC(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function ef(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n==null?void 0:n.extensions)):!1}function tf(n){b7(n,"null loader"),b7(ef(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n!=null&&n.parseTextSync||n!=null&&n.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const Xy=()=>{const n=Wy();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function jC(n){const e=Xy();n=Array.isArray(n)?n:[n];for(const t of n){const r=tf(t);e.find(s=>r===s)||e.unshift(r)}}function $C(){return Xy()}const WC=/\.([^.]+)$/;async function HC(n,e=[],t,r){if(!Zy(n))return null;let s=zm(n,e,{...t,nothrow:!0},r);if(s)return s;if(W0(n)&&(n=await n.slice(0,10).arrayBuffer(),s=zm(n,e,t,r)),!s&&!(t!=null&&t.nothrow))throw new Error(qy(n));return s}function zm(n,e=[],t,r){if(!Zy(n))return null;if(e&&!Array.isArray(e))return tf(e);let s=[];e&&(s=s.concat(e)),t!=null&&t.ignoreRegisteredLoaders||s.push(...$C()),ZC(s);const u=XC(n,s,t,r);if(!u&&!(t!=null&&t.nothrow))throw new Error(qy(n));return u}function XC(n,e,t,r){const s=_6(n),u=Qh(n),f=Jh(s)||(r==null?void 0:r.url);let m=null,o="";return t!=null&&t.mimeType&&(m=V5(e,t==null?void 0:t.mimeType),o=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),m=m||qC(e,f),o=o||(m?`matched url ${f}`:""),m=m||V5(e,u),o=o||(m?`matched MIME type ${u}`:""),m=m||YC(e,n),o=o||(m?`matched initial data ${Gy(n)}`:""),t!=null&&t.fallbackMimeType&&(m=m||V5(e,t==null?void 0:t.fallbackMimeType),o=o||(m?`matched fallback MIME type ${u}`:"")),o&&$A.log(1,`selectLoader selected ${m==null?void 0:m.name}: ${o}.`),m}function Zy(n){return!(n instanceof Response&&n.status===204)}function qy(n){const e=_6(n),t=Qh(n);let r="No valid loader found (";r+=e?`${zy(e)}, `:"no url provided, ",r+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=n?Gy(n):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function ZC(n){for(const e of n)tf(e)}function qC(n,e){const t=e&&WC.exec(e),r=t&&t[1];return r?GC(n,r):null}function GC(n,e){e=e.toLowerCase();for(const t of n)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function V5(n,e){var t;for(const r of n)if((t=r.mimeTypes)!=null&&t.some(s=>Om(e,s))||Om(e,`application/x.${r.id}`))return r;return null}function YC(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(KC(e,t))return t}else if(ArrayBuffer.isView(e)){if(Um(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&Um(e,0,t))return t;return null}function KC(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>n.startsWith(r))}function Um(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>JC(n,e,t,s))}function JC(n,e,t,r){if(r instanceof ArrayBuffer)return oC(r,n,r.byteLength);switch(typeof r){case"function":return r(n);case"string":const s=j9(n,e,r.length);return r===s;default:return!1}}function Gy(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?j9(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?j9(n,0,e):""}function j9(n,e,t){if(n.byteLength<e+t)return"";const r=new DataView(n);let s="";for(let u=0;u<t;u++)s+=String.fromCharCode(r.getUint8(e+u));return s}const QC=256*1024;function*eP(n,e){const t=(e==null?void 0:e.chunkSize)||QC;let r=0;const s=new TextEncoder;for(;r<n.length;){const u=Math.min(n.length-r,t),f=n.slice(r,r+u);r+=u,yield s.encode(f)}}const tP=256*1024;function*nP(n,e={}){const{chunkSize:t=tP}=e;let r=0;for(;r<n.byteLength;){const s=Math.min(n.byteLength-r,t),u=new ArrayBuffer(s),f=new Uint8Array(n,r,s);new Uint8Array(u).set(f),r+=s,yield u}}const rP=1024*1024;async function*iP(n,e){const t=(e==null?void 0:e.chunkSize)||rP;let r=0;for(;r<n.size;){const s=r+t,u=await n.slice(r,s).arrayBuffer();r=s,yield u}}function Vm(n,e){return Yh?sP(n,e):oP(n)}async function*sP(n,e){const t=n.getReader();let r;try{for(;;){const s=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:u,value:f}=await s;if(u)return;yield By(f)}}catch{t.releaseLock()}}async function*oP(n,e){for await(const t of n)yield By(t)}function aP(n,e){if(typeof n=="string")return eP(n,e);if(n instanceof ArrayBuffer)return nP(n,e);if(W0(n))return iP(n,e);if(Uy(n))return Vm(n,e);if($0(n))return Vm(n.body,e);throw new Error("makeIterator")}const Yy="Cannot convert supplied data type";function lP(n,e,t){if(e.text&&typeof n=="string")return n;if(_C(n)&&(n=n.buffer),n instanceof ArrayBuffer){const r=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let r=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==r.byteLength)&&(r=r.slice(n.byteOffset,n.byteOffset+s)),r}throw new Error(Yy)}async function cP(n,e,t){const r=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||r)return lP(n,e);if(W0(n)&&(n=await jy(n)),$0(n)){const s=n;return await CC(s),e.binary?await s.arrayBuffer():await s.text()}if(Uy(n)&&(n=aP(n,t)),mC(n)||gC(n))return cC(n);throw new Error(Yy)}function Ky(n,e){const t=Hy(),r=n||t;return typeof r.fetch=="function"?r.fetch:B2(r.fetch)?s=>Lm(s,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:Lm}function uP(n,e,t){if(t)return t;const r={fetch:Ky(e,n),...n};if(r.url){const s=Jh(r.url);r.baseUrl=s,r.queryString=EC(r.url),r.filename=zy(s),r.baseUrl=dC(s)}return Array.isArray(r.loaders)||(r.loaders=null),r}function hP(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:void 0}async function E7(n,e,t,r){e&&!Array.isArray(e)&&!ef(e)&&(r=void 0,t=e,e=void 0),n=await n,t=t||{};const s=_6(n),f=hP(e,r),m=await HC(n,f,t);return m?(t=NC(t,m,f,s),r=uP({url:s,_parse:E7,loaders:f},t,r||null),await fP(m,n,t,r)):null}async function fP(n,e,t,r){if(nC(n),t=WA(n.options,t),$0(e)){const u=e,{ok:f,redirected:m,status:o,statusText:T,type:C,url:R}=u,O=Object.fromEntries(u.headers.entries());r.response={headers:O,ok:f,redirected:m,status:o,statusText:T,type:C,url:R}}e=await cP(e,n,t);const s=n;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,r);if(rC(n,t))return await iC(n,e,t,r,E7);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,r);if(s.parse)return await s.parse(e,t,r);throw C3(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function S7(n,e,t,r){let s,u;!Array.isArray(e)&&!ef(e)?(s=[],u=e):(s=e,u=t);const f=Ky(u);let m=n;return typeof n=="string"&&(m=await f(n)),W0(n)&&(m=await f(n)),Array.isArray(s)?await E7(m,s,u):await E7(m,s,u)}const dP="4.3.3";var ty;const pP=(ty=globalThis.loaders)==null?void 0:ty.parseImageNode,$9=typeof Image<"u",W9=typeof ImageBitmap<"u",mP=!!pP,H9=Yh?!0:mP;function gP(n){switch(n){case"auto":return W9||$9||H9;case"imagebitmap":return W9;case"image":return $9;case"data":return H9;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function _P(){if(W9)return"imagebitmap";if($9)return"image";if(H9)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function yP(n){const e=xP(n);if(!e)throw new Error("Not an image");return e}function vP(n){switch(yP(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function xP(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const bP=/^data:image\/svg\+xml/,wP=/\.svg((\?|#).*)?$/;function nf(n){return n&&(bP.test(n)||wP.test(n))}function TP(n,e){if(nf(e)){let r=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(u){throw new Error(u.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return Jy(n,e)}function Jy(n,e){if(nf(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function Qy(n,e,t){const r=TP(n,t),s=self.URL||self.webkitURL,u=typeof r!="string"&&s.createObjectURL(r);try{return await EP(u||r,e)}finally{u&&s.revokeObjectURL(u)}}async function EP(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,s)=>{try{t.onload=()=>r(t),t.onerror=u=>{const f=u instanceof Error?u.message:"error";s(new Error(f))}}catch(u){s(u)}})}const SP={};let jm=!0;async function AP(n,e,t){let r;nf(t)?r=await Qy(n,e,t):r=Jy(n,t);const s=e&&e.imagebitmap;return await CP(r,s)}async function CP(n,e=null){if((PP(e)||!jm)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),jm=!1}return await createImageBitmap(n)}function PP(n){for(const e in n||SP)return!1;return!0}function IP(n){return!OP(n,"ftyp",4)||!(n[8]&96)?null:MP(n)}function MP(n){switch(RP(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function RP(n,e,t){return String.fromCharCode(...n.slice(e,t))}function kP(n){return[...n].map(e=>e.charCodeAt(0))}function OP(n,e,t=0){const r=kP(e);for(let s=0;s<r.length;++s)if(r[s]!==n[s+t])return!1;return!0}const v1=!1,y2=!0;function ev(n){const e=z2(n);return LP(e)||BP(e)||FP(e)||NP(e)||DP(e)}function DP(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=IP(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function LP(n){const e=z2(n);return e.byteLength>=24&&e.getUint32(0,v1)===2303741511?{mimeType:"image/png",width:e.getUint32(16,v1),height:e.getUint32(20,v1)}:null}function FP(n){const e=z2(n);return e.byteLength>=10&&e.getUint32(0,v1)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,y2),height:e.getUint16(8,y2)}:null}function NP(n){const e=z2(n);return e.byteLength>=14&&e.getUint16(0,v1)===16973&&e.getUint32(2,y2)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,y2),height:e.getUint32(22,y2)}:null}function BP(n){const e=z2(n);if(!(e.byteLength>=3&&e.getUint16(0,v1)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:s}=zP();let u=2;for(;u+9<e.byteLength;){const f=e.getUint16(u,v1);if(s.has(f))return{mimeType:"image/jpeg",height:e.getUint16(u+5,v1),width:e.getUint16(u+7,v1)};if(!r.has(f))return null;u+=2,u+=e.getUint16(u,v1)}return null}function zP(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function z2(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function UP(n,e){var s;const{mimeType:t}=ev(n)||{},r=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return b7(r),await r(n,t)}async function VP(n,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:u}=t||{},f=jP(s);let m;switch(f){case"imagebitmap":m=await AP(n,e,u);break;case"image":m=await Qy(n,e,u);break;case"data":m=await UP(n);break;default:b7(!1)}return s==="data"&&(m=vP(m)),m}function jP(n){switch(n){case"auto":case"data":return _P();default:return gP(n),n}}const $P=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],WP=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],HP={image:{type:"auto",decode:!0}},XP={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:dP,mimeTypes:WP,extensions:$P,parse:VP,tests:[n=>!!ev(new DataView(n))],options:HP},lr=new N2({id:"deck"});let X9={};function ZP(n){X9=n}function eo(n,e,t,r){lr.level>0&&X9[n]&&X9[n].call(null,e,t,r)}function qP(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const GP={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:qP,parseTextSync:JSON.parse};function YP(){const n="9.1.13",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(lr.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:lr,_registerLoggers:ZP},jC([GP,[XP,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const KP=YP();function rf(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const j5={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function JP(n){const e={};for(const[t,r]of Object.entries(n))e[t]=QP(r);return e}function QP(n){let e=$m(n);if(e!=="object")return{value:n,...j5[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...j5[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=$m(n.value),{...n,...j5[e],type:e}):{type:"object",value:null};throw new Error("props")}function $m(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const eI=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,tI=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,nI={vertex:eI,fragment:tI},Wm=/void\s+main\s*\([^)]*\)\s*\{\n?/,Hm=/}\n?[^{}]*$/,$5=[],n7="__LUMA_INJECT_DECLARATIONS__";function rI(n){const e={vertex:{},fragment:{}};for(const t in n){let r=n[t];const s=iI(t);typeof r=="string"&&(r={order:0,injection:r}),e[s][t]=r}return e}function iI(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function A7(n,e,t,r=!1){const s=e==="vertex";for(const u in t){const f=t[u];f.sort((o,T)=>o.order-T.order),$5.length=f.length;for(let o=0,T=f.length;o<T;++o)$5[o]=f[o].injection;const m=`${$5.join(`
`)}
`;switch(u){case"vs:#decl":s&&(n=n.replace(n7,m));break;case"vs:#main-start":s&&(n=n.replace(Wm,o=>o+m));break;case"vs:#main-end":s&&(n=n.replace(Hm,o=>m+o));break;case"fs:#decl":s||(n=n.replace(n7,m));break;case"fs:#main-start":s||(n=n.replace(Wm,o=>o+m));break;case"fs:#main-end":s||(n=n.replace(Hm,o=>m+o));break;default:n=n.replace(u,o=>o+m)}}return n=n.replace(n7,""),r&&(n=n.replace(/\}\s*$/,u=>u+nI[e])),n}function C7(n){n.map(e=>sI(e))}function sI(n){if(n.instance)return;C7(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:r={}}=n,s={normalizedInjections:rI(r),parsedDeprecations:oI(t)};e&&(s.propValidators=JP(e)),n.instance=s;let u={};e&&(u=Object.entries(e).reduce((f,[m,o])=>{const T=o==null?void 0:o.value;return T&&(f[m]=T),f},{})),n.defaultUniforms={...n.defaultUniforms,...u}}function tv(n,e,t){var r;(r=n.deprecations)==null||r.forEach(s=>{var u;(u=s.regex)!=null&&u.test(e)&&(s.deprecated?t.deprecated(s.old,s.new)():t.removed(s.old,s.new)())})}function oI(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function sf(n){C7(n);const e={},t={};nv({modules:n,level:0,moduleMap:e,moduleDepth:t});const r=Object.keys(t).sort((s,u)=>t[u]-t[s]).map(s=>e[s]);return C7(r),r}function nv(n){const{modules:e,level:t,moduleMap:r,moduleDepth:s}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const u of e)r[u.name]=u,(s[u.name]===void 0||s[u.name]<t)&&(s[u.name]=t);for(const u of e)u.dependencies&&nv({modules:u.dependencies,level:t+1,moduleMap:r,moduleDepth:s})}function aI(n){switch(n==null?void 0:n.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function lI(n,e){var r;if(Number(((r=n.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=Xm(n,cI),n;case"fragment":return n=Xm(n,uI),n;default:throw new Error(e)}}const rv=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],cI=[...rv,[Z9("attribute"),"in $1"],[Z9("varying"),"out $1"]],uI=[...rv,[Z9("varying"),"in $1"]];function Xm(n,e){for(const[t,r]of e)n=n.replace(t,r);return n}function Z9(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function iv(n,e){let t="";for(const r in n){const s=n[r];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[r]){const u=e[r];u.sort((f,m)=>f.order-m.order);for(const f of u)t+=`  ${f.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function sv(n){const e={vertex:{},fragment:{}};for(const t of n){let r,s;typeof t!="string"?(r=t,s=r.hook):(r={},s=t),s=s.trim();const[u,f]=s.split(":"),m=s.replace(/\(.+/,""),o=Object.assign(r,{signature:f});switch(u){case"vs":e.vertex[m]=o;break;case"fs":e.fragment[m]=o;break;default:throw new Error(u)}}return e}function hI(n,e){return{name:fI(n,e),language:"glsl",version:dI(n)}}function fI(n,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return r?r[1]:e}function dI(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const ov=`

${n7}
`,pI=`precision highp float;
`;function mI(n){const e=sf(n.modules||[]);return{source:_I(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:av(e)}}function gI(n){const{vs:e,fs:t}=n,r=sf(n.modules||[]);return{vs:Zm(n.platformInfo,{...n,source:e,stage:"vertex",modules:r}),fs:Zm(n.platformInfo,{...n,source:t,stage:"fragment",modules:r}),getUniforms:av(r)}}function _I(n,e){var Y;const{source:t,stage:r,modules:s,hookFunctions:u=[],inject:f={},log:m}=e;rf(typeof t=="string","shader source must be a string");const o=t;let T="";const C=sv(u),R={},O={},U={};for(const ee in f){const le=typeof f[ee]=="string"?{injection:f[ee],order:0}:f[ee],Ee=/^(v|f)s:(#)?([\w-]+)$/.exec(ee);if(Ee){const ue=Ee[2],_e=Ee[3];ue?_e==="decl"?O[ee]=[le]:U[ee]=[le]:R[ee]=[le]}else U[ee]=[le]}const V=s;for(const ee of V){m&&tv(ee,o,m);const le=lv(ee,"wgsl");T+=le;const Ee=((Y=ee.injections)==null?void 0:Y[r])||{};for(const ue in Ee){const _e=/^(v|f)s:#([\w-]+)$/.exec(ue);if(_e){const Fe=_e[2]==="decl"?O:U;Fe[ue]=Fe[ue]||[],Fe[ue].push(Ee[ue])}else R[ue]=R[ue]||[],R[ue].push(Ee[ue])}}return T+=ov,T=A7(T,r,O),T+=iv(C[r],R),T+=o,T=A7(T,r,U),T}function Zm(n,e){var yt;const{id:t,source:r,stage:s,language:u="glsl",modules:f,defines:m={},hookFunctions:o=[],inject:T={},prologue:C=!0,log:R}=e;rf(typeof r=="string","shader source must be a string");const O=u==="glsl"?hI(r).version:-1,U=n.shaderLanguageVersion,V=O===100?"#version 100":"#version 300 es",ee=r.split(`
`).slice(1).join(`
`),le={};f.forEach(xt=>{Object.assign(le,xt.defines)}),Object.assign(le,m);let Ee="";switch(u){case"wgsl":break;case"glsl":Ee=C?`${V}

// ----- PROLOGUE -------------------------
${yI({id:t,source:r,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${aI(n)}
${s==="fragment"?pI:""}

// ----- APPLICATION DEFINES -------------------------

${vI(le)}

`:`${V}
`;break}const ue=sv(o),_e={},Me={},Fe={};for(const xt in T){const ht=typeof T[xt]=="string"?{injection:T[xt],order:0}:T[xt],kt=/^(v|f)s:(#)?([\w-]+)$/.exec(xt);if(kt){const Bt=kt[2],Vt=kt[3];Bt?Vt==="decl"?Me[xt]=[ht]:Fe[xt]=[ht]:_e[xt]=[ht]}else Fe[xt]=[ht]}for(const xt of f){R&&tv(xt,ee,R);const ht=lv(xt,s);Ee+=ht;const kt=((yt=xt.instance)==null?void 0:yt.normalizedInjections[s])||{};for(const Bt in kt){const Vt=/^(v|f)s:#([\w-]+)$/.exec(Bt);if(Vt){const Ct=Vt[2]==="decl"?Me:Fe;Ct[Bt]=Ct[Bt]||[],Ct[Bt].push(kt[Bt])}else _e[Bt]=_e[Bt]||[],_e[Bt].push(kt[Bt])}}return Ee+="// ----- MAIN SHADER SOURCE -------------------------",Ee+=ov,Ee=A7(Ee,s,Me),Ee+=iv(ue[s],_e),Ee+=ee,Ee=A7(Ee,s,Fe),u==="glsl"&&O!==U&&(Ee=lI(Ee,s)),Ee.trim()}function av(n){return function(t){var s;const r={};for(const u of n){const f=(s=u.getUniforms)==null?void 0:s.call(u,t,r);Object.assign(r,f)}return r}}function yI(n){const{id:e,source:t,stage:r}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function vI(n={}){let e="";for(const t in n){const r=n[t];(r||Number.isFinite(r))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function lv(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:rf(!1)}if(!n.name)throw new Error("Shader module must have a name");const r=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${r}
`),s+=`${t}
`,s}const xI=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,bI=/^\s*\#\s*endif\s*$/;function wI(n,e){var f;const t=n.split(`
`),r=[];let s=!0,u=null;for(const m of t){const o=m.match(xI),T=m.match(bI);o?(u=o[1],s=!!((f=e==null?void 0:e.defines)!=null&&f[u])):T?s=!0:s&&r.push(m)}return r.join(`
`)}const M0=class M0{constructor(){ne(this,"_hookFunctions",[]);ne(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return M0.defaultShaderAssembler=M0.defaultShaderAssembler||new M0,M0.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),r=this._hookFunctions,{source:s,getUniforms:u}=mI({...e,source:e.source,modules:t,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?wI(s):s,getUniforms:u,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),r=this._hookFunctions;return{...gI({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:r}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),r={};let s=0;for(let u=0,f=this._defaultModules.length;u<f;++u){const m=this._defaultModules[u],o=m.name;t[s++]=m,r[o]=!0}for(let u=0,f=e.length;u<f;++u){const m=e[u],o=m.name;r[o]||(t[s++]=m,r[o]=!0)}return t.length=s,C7(t),t}};ne(M0,"defaultShaderAssembler");let P7=M0;const TI=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,EI=`#version 300 es
${TI}`;function SI(n){const{input:e,inputChannels:t,output:r}={};if(!e)return EI;if(!t)throw new Error("inputChannels");const s=AI(t),u=CI(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${r};
void main() {
  ${r} = ${u};
}`}function AI(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function CI(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class PI{constructor(){ne(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new g6({id:e})),this.stats.get(e)}}const cv=new PI,jt=new N2({id:"luma.gl"}),W5={};function y6(n="id"){W5[n]=W5[n]||1;const e=W5[n]++;return`${n}-${e}`}var T9;let Fr=(T9=class{constructor(e,t,r){ne(this,"id");ne(this,"props");ne(this,"userData",{});ne(this,"_device");ne(this,"destroyed",!1);ne(this,"allocatedBytes",0);ne(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=II(t,r);const s=this.props.id!=="undefined"?this.props.id:y6(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},ne(T9,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),T9);function II(n,e){const t={...e};for(const r in n)n[r]!==void 0&&(t[r]=n[r]);return t}const Ds=class Ds extends Fr{constructor(t,r){const s={...r};(r.usage||0)&Ds.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?s.indexType="uint32":r.data instanceof Uint16Array&&(s.indexType="uint16")),delete s.data;super(t,s,Ds.defaultProps);ne(this,"usage");ne(this,"indexType");ne(this,"updateTimestamp");ne(this,"debugData",new ArrayBuffer(0));this.usage=s.usage||0,this.indexType=s.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,r){throw new Error("not implemented")}_setDebugData(t,r,s){const u=ArrayBuffer.isView(t)?t.buffer:t,f=Math.min(t?t.byteLength:s,Ds.DEBUG_DATA_MAX_LENGTH);u===null?this.debugData=new ArrayBuffer(f):r===0&&s===u.byteLength?this.debugData=u.slice(0,f):this.debugData=u.slice(r,r+f)}};ne(Ds,"defaultProps",{...Fr.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),ne(Ds,"MAP_READ",1),ne(Ds,"MAP_WRITE",2),ne(Ds,"COPY_SRC",4),ne(Ds,"COPY_DST",8),ne(Ds,"INDEX",16),ne(Ds,"VERTEX",32),ne(Ds,"UNIFORM",64),ne(Ds,"STORAGE",128),ne(Ds,"INDIRECT",256),ne(Ds,"QUERY_RESOLVE",512),ne(Ds,"DEBUG_DATA_MAX_LENGTH",32);let Jr=Ds;function uv(n){const e=qm[n],t=MI(e),r=n.includes("norm"),s=!r&&!n.startsWith("float"),u=n.startsWith("s");return{dataType:qm[n],byteLength:t,integer:s,signed:u,normalized:r}}function MI(n){return RI[n]}const qm={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},RI={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Ks="texture-compression-bc",Lr="texture-compression-astc",g1="texture-compression-etc2",kI="texture-compression-etc1-webgl",L8="texture-compression-pvrtc-webgl",H5="texture-compression-atc-webgl",F8="float32-renderable-webgl",X5="float16-renderable-webgl",OI="rgb9e5ufloat-renderable-webgl",Z5="snorm8-renderable-webgl",r2="norm16-renderable-webgl",q5="snorm16-renderable-webgl",N8="float32-filterable",Gm="float16-filterable-webgl";function hv(n){const e=DI[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const DI={r8unorm:{},r8snorm:{render:Z5},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Z5},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:X5,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:r2},"r16snorm-webgl":{f:q5},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Z5},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:X5,filter:Gm},"rg16unorm-webgl":{render:r2},"rg16snorm-webgl":{render:q5},r32uint:{},r32sint:{},r32float:{render:F8,filter:N8},rgb9e5ufloat:{channels:"rgb",packed:!0,render:OI},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:F8},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:r2},"rgb16snorm-webgl":{f:r2},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:N8},rgba16uint:{},rgba16sint:{},rgba16float:{render:X5,filter:Gm},"rgba16unorm-webgl":{render:r2},"rgba16snorm-webgl":{render:q5},"rgb32float-webgl":{render:F8,filter:N8},rgba32uint:{},rgba32sint:{},rgba32float:{render:F8,filter:N8},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Ks},"bc1-rgb-unorm-srgb-webgl":{f:Ks},"bc1-rgba-unorm":{f:Ks},"bc1-rgba-unorm-srgb":{f:Ks},"bc2-rgba-unorm":{f:Ks},"bc2-rgba-unorm-srgb":{f:Ks},"bc3-rgba-unorm":{f:Ks},"bc3-rgba-unorm-srgb":{f:Ks},"bc4-r-unorm":{f:Ks},"bc4-r-snorm":{f:Ks},"bc5-rg-unorm":{f:Ks},"bc5-rg-snorm":{f:Ks},"bc6h-rgb-ufloat":{f:Ks},"bc6h-rgb-float":{f:Ks},"bc7-rgba-unorm":{f:Ks},"bc7-rgba-unorm-srgb":{f:Ks},"etc2-rgb8unorm":{f:g1},"etc2-rgb8unorm-srgb":{f:g1},"etc2-rgb8a1unorm":{f:g1},"etc2-rgb8a1unorm-srgb":{f:g1},"etc2-rgba8unorm":{f:g1},"etc2-rgba8unorm-srgb":{f:g1},"eac-r11unorm":{f:g1},"eac-r11snorm":{f:g1},"eac-rg11unorm":{f:g1},"eac-rg11snorm":{f:g1},"astc-4x4-unorm":{f:Lr},"astc-4x4-unorm-srgb":{f:Lr},"astc-5x4-unorm":{f:Lr},"astc-5x4-unorm-srgb":{f:Lr},"astc-5x5-unorm":{f:Lr},"astc-5x5-unorm-srgb":{f:Lr},"astc-6x5-unorm":{f:Lr},"astc-6x5-unorm-srgb":{f:Lr},"astc-6x6-unorm":{f:Lr},"astc-6x6-unorm-srgb":{f:Lr},"astc-8x5-unorm":{f:Lr},"astc-8x5-unorm-srgb":{f:Lr},"astc-8x6-unorm":{f:Lr},"astc-8x6-unorm-srgb":{f:Lr},"astc-8x8-unorm":{f:Lr},"astc-8x8-unorm-srgb":{f:Lr},"astc-10x5-unorm":{f:Lr},"astc-10x5-unorm-srgb":{f:Lr},"astc-10x6-unorm":{f:Lr},"astc-10x6-unorm-srgb":{f:Lr},"astc-10x8-unorm":{f:Lr},"astc-10x8-unorm-srgb":{f:Lr},"astc-10x10-unorm":{f:Lr},"astc-10x10-unorm-srgb":{f:Lr},"astc-12x10-unorm":{f:Lr},"astc-12x10-unorm-srgb":{f:Lr},"astc-12x12-unorm":{f:Lr},"astc-12x12-unorm-srgb":{f:Lr},"pvrtc-rgb4unorm-webgl":{f:L8},"pvrtc-rgba4unorm-webgl":{f:L8},"pvrtc-rbg2unorm-webgl":{f:L8},"pvrtc-rgba2unorm-webgl":{f:L8},"etc1-rbg-unorm-webgl":{f:kI},"atc-rgb-unorm-webgl":{f:H5},"atc-rgba-unorm-webgl":{f:H5},"atc-rgbai-unorm-webgl":{f:H5}},LI=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],FI=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function fv(n){return LI.some(e=>n.startsWith(e))}function of(n){let e=NI(n);if(fv(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=BI(n);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const t=FI.exec(n);if(t){const[,r,s,u,f,m]=t,o=`${u}${s}`,T=uv(o),C=T.byteLength*8,R=r.length,O=[C,R>=2?C:0,R>=3?C:0,R>=4?C:0];e={format:n,attachment:e.attachment,dataType:T.dataType,components:R,channels:r,integer:T.integer,signed:T.signed,normalized:T.normalized,bitsPerChannel:O,bytesPerPixel:T.byteLength*r.length,packed:e.packed,srgb:e.srgb},m==="-webgl"&&(e.webgl=!0),f==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function NI(n){var u;const e=hv(n),t=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((u=e.channels)==null?void 0:u.length)||1,bytesPerPixel:t,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function BI(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,r,s]=t;return{blockWidth:Number(r),blockHeight:Number(s)}}return null}function zI(n){const e=hv(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=of(n),s=n.startsWith("depth")||n.startsWith("stencil"),u=r==null?void 0:r.signed,f=r==null?void 0:r.integer,m=r==null?void 0:r.webgl;return t.render&&(t.render=!u),t.filter&&(t.filter=!s&&!u&&!f&&!m),t}class UI{}class VI{constructor(e=[],t){ne(this,"features");ne(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const Q7=class Q7{constructor(e){ne(this,"id");ne(this,"props");ne(this,"userData",{});ne(this,"statsManager",cv);ne(this,"timestamp",0);ne(this,"_reused",!1);ne(this,"_lumaData",{});this.props={...Q7.defaultProps,...e},this.id=this.props.id||y6(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=zI(e),r=f=>(typeof f=="string"?this.features.has(f):f)??!0,s=r(t.create),u={format:e,create:s,render:s&&r(t.render),filter:s&&r(t.filter),blend:s&&r(t.blend),store:s&&r(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(u)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return fv(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Jr.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":jt.warn("indices buffer content must be of integer type")()),t}};ne(Q7,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>jt.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:jt.get("debug")||void 0,debugShaders:jt.get("debug-shaders")||void 0,debugFramebuffers:!!jt.get("debug-framebuffers"),debugWebGL:!!jt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let T3=Q7;const jI=j0()&&typeof document<"u",$I=()=>jI&&document.readyState==="complete",WI="set luma.log.level=1 (or higher) to trace rendering",Ym="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",m3=class m3{constructor(){ne(this,"stats",cv);ne(this,"log",jt);ne(this,"VERSION","9.1.9");ne(this,"spector");ne(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw jt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),jt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");jt.error("This version of luma.gl has already been initialized")()}jt.log(1,`${this.VERSION} - ${WI}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,r])=>r).filter(r=>{var s;return(s=r.isSupported)==null?void 0:s.call(r)}).map(r=>r.type)}getBestAvailableAdapter(e=[]){var r,s,u,f;const t=this.getAdapterMap(e);return(s=(r=t.get("webgpu"))==null?void 0:r.isSupported)!=null&&s.call(r)?"webgpu":(f=(u=t.get("webgl"))==null?void 0:u.isSupported)!=null&&f.call(u)?"webgl":null}setDefaultDeviceProps(e){Object.assign(m3.defaultProps,e)}async createDevice(e={}){var m;e={...m3.defaultProps,...e},e.waitForPageLoad&&await m3.pageLoaded;const t=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const u=(this.getAdapterMap(e.adapters)||t).get(r),f=await((m=u==null?void 0:u.create)==null?void 0:m.call(u,e));if(f)return f;throw new Error(Ym)}async attachDevice(e){var f;const t=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await m3.pageLoaded,e.handle===null&&(r="unknown");const s=t.get(r),u=await((f=s==null?void 0:s.attach)==null?void 0:f.call(s,null));if(u)return u;throw new Error(Ym)}enforceWebGL2(e=!0,t=[]){var u;const s=this.getAdapterMap(t).get("webgl");s||jt.warn("enforceWebGL2: webgl adapter not found")(),(u=s==null?void 0:s.enforceWebGL2)==null||u.call(s,e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const r of e)t.set(r.type,r);return t}registerDevices(e){jt.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const r=t.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}};ne(m3,"defaultProps",{...T3.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),ne(m3,"pageLoaded",HI().then(()=>{jt.probe(2,"DOM is loaded")()}));let q9=m3;const G9=new q9;function HI(){return $I()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class XI{}const e6=class e6{constructor(e){ne(this,"id");ne(this,"props");ne(this,"canvas");ne(this,"htmlCanvas");ne(this,"offscreenCanvas");ne(this,"type");ne(this,"width",1);ne(this,"height",1);ne(this,"resizeObserver");ne(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...e6.defaultProps,...e},e=this.props,!j0()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=qI(e.canvas):this.canvas=e.canvas;else{const t=GI(e),r=ZI((e==null?void 0:e.container)||null);r.insertBefore(t,r.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const r of t)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return r?t/r:1}catch{return 1}}cssToDevicePixels(e,t=!0){const r=this.cssToDeviceRatio(),[s,u]=this.getDrawingBufferSize();return YI(e,r,s,u,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let r="width"in t?t.width:this.htmlCanvas.clientWidth,s="height"in t?t.height:this.htmlCanvas.clientHeight;(!r||!s)&&(jt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const u=this._canvasSizeInfo;if(u.clientWidth!==r||u.clientHeight!==s||u.devicePixelRatio!==e){let f=e;const m=Math.floor(r*f),o=Math.floor(s*f);if(this.htmlCanvas.width=m,this.htmlCanvas.height=o,this.device.gl){const[C,R]=this.getDrawingBufferSize();(C!==m||R!==o)&&(f=Math.min(C/r,R/s),this.htmlCanvas.width=Math.floor(r*f),this.htmlCanvas.height=Math.floor(s*f),jt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};ne(e6,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let Y9=e6;function ZI(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function qI(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function GI(n){const{width:e,height:t}=n,r=document.createElement("canvas");return r.id=y6("lumagl-auto-created-canvas"),r.width=e||1,r.height=t||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(t)?`${t}px`:"100%",r}function YI(n,e,t,r,s){const u=n,f=Km(u[0],e,t);let m=Jm(u[1],e,r,s),o=Km(u[0]+1,e,t);const T=o===t-1?o:o-1;o=Jm(u[1]+1,e,r,s);let C;return s?(o=o===0?o:o+1,C=m,m=o):C=o===r-1?o:o-1,{x:f,y:m,width:Math.max(T-f+1,1),height:Math.max(C-m+1,1)}}function Km(n,e,t){return Math.min(Math.round(n*e),t-1)}function Jm(n,e,t,r){return r?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const Ls=class Ls extends Fr{constructor(t,r){r=Ls.normalizeProps(t,r);super(t,r,Ls.defaultProps);ne(this,"dimension");ne(this,"format");ne(this,"width");ne(this,"height");ne(this,"depth");ne(this,"mipLevels");ne(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const s=Ls.getTextureDataSize(this.props.data);this.width=(s==null?void 0:s.width)||1,this.height=(s==null?void 0:s.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Ls.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const r=t==null?void 0:t.data;return ArrayBuffer.isView(r)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return Ls.getTextureDataSize(t[0]);if(Ls.isExternalImage(t))return Ls.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const s=Object.values(t)[0];return{width:s.width,height:s.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,r){let s;return ArrayBuffer.isView(t)?s=[{data:t,width:r.width,height:r.height}]:Array.isArray(t)?s=t:s=[t],s}static getMipLevelCount(t,r){return Math.floor(Math.log2(Math.max(t,r)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,r){var o,T;const s={...r},u=((T=(o=t==null?void 0:t.props)==null?void 0:o._resourceDefaults)==null?void 0:T.texture)||{};Object.assign(s,u);const{width:f,height:m}=s;return typeof f=="number"&&(s.width=Math.max(1,Math.ceil(f))),typeof m=="number"&&(s.height=Math.max(1,Math.ceil(m))),s}};ne(Ls,"COPY_SRC",1),ne(Ls,"COPY_DST",2),ne(Ls,"TEXTURE",4),ne(Ls,"STORAGE",8),ne(Ls,"RENDER_ATTACHMENT",16),ne(Ls,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),ne(Ls,"defaultProps",{...Fr.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),ne(Ls,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let wi=Ls;const t6=class t6 extends Fr{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,t6.defaultProps)}};ne(t6,"defaultProps",{...Fr.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let I7=t6;function KI(n,e,t){let r="";const s=e.split(/\r?\n/),u=n.slice().sort((f,m)=>f.lineNum-m.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let f=0;for(let m=1;m<=s.length;m++)for(r+=dv(s[m-1],m,t);u.length>f&&u[f].lineNum===m;){const o=u[f++];r+=Qm(o,s,o.lineNum,{...t,inlineSource:!1})}return r;case"issues":case"no":for(const m of n)r+=Qm(m,s,m.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return r}}function Qm(n,e,t,r){if(r!=null&&r.inlineSource){const u=JI(e,t),f=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${u}${f}${n.type.toUpperCase()}: ${n.message}

`}const s=n.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function JI(n,e,t){let r="";for(let s=e-2;s<=e;s++){const u=n[s-1];u!==void 0&&(r+=dv(u,e,t))}return r}function dv(n,e,t){const r=t!=null&&t.html?eM(n):n;return`${QI(String(e),4)}: ${r}${t!=null&&t.html?"<br/>":`
`}`}function QI(n,e){let t="";for(let r=n.length;r<e;++r)t+=" ";return t+n}function eM(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const n6=class n6 extends Fr{constructor(t,r){r={...r,debugShaders:r.debugShaders||t.props.debugShaders||"errors"};super(t,{id:tM(r),...r},n6.defaultProps);ne(this,"stage");ne(this,"source");ne(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();t==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(t){var T;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=pv(this.source),s=`${this.stage} ${r}`;let u=KI(t,this.source,{showSourceCode:"all",html:!0});const f=this.getTranslatedSource();f&&(u+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${f}</pre></code>`);const m=document.createElement("Button");m.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${u}
</pre></code>`,m.style.top="10px",m.style.left="10px",m.style.position="absolute",m.style.zIndex="9999",m.style.width="100%",m.style.textAlign="left",document.body.appendChild(m),(T=document.getElementsByClassName("luma-compiler-log-error")[0])==null||T.scrollIntoView(),m.onclick=()=>{const C=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(C)}}};ne(n6,"defaultProps",{...Fr.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let M7=n6;function tM(n){return pv(n.source)||n.id||y6(`unnamed ${n.stage}-shader`)}function pv(n,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return r?r[1]:e}const E2=class E2 extends Fr{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=E2.normalizeProps(e,t),super(e,t,E2.defaultProps)}static normalizeProps(e,t){var u,f;const r=((f=(u=e==null?void 0:e.props)==null?void 0:u._resourceDefaults)==null?void 0:f.sampler)||{};return{...t,...r}}};ne(E2,"defaultProps",{...Fr.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let R7=E2;const r6=class r6 extends Fr{constructor(t,r={}){super(t,r,r6.defaultProps);ne(this,"width");ne(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const r=this.colorAttachments.map(u=>u.texture.clone(t)),s=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:s})}resize(t){let r=!t;if(t){const[s,u]=Array.isArray(t)?t:[t.width,t.height];r=r||u!==this.height||s!==this.width,this.width=s,this.height=u}r&&(jt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,s)=>{if(typeof r=="string"){const u=this.createColorTexture(r,s);return this.attachResource(u),u.view}return r instanceof wi?r.view:r});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof wi?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:wi.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:wi.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,r){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const u=this.colorAttachments[s].texture.clone({width:t,height:r});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=u.view,this.attachResource(u.view)}if(this.depthStencilAttachment){const s=this.depthStencilAttachment.texture.clone({width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}this.updateAttachments()}};ne(r6,"defaultProps",{...Fr.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let k7=r6;const i6=class i6 extends Fr{constructor(t,r){super(t,r,i6.defaultProps);ne(this,"shaderLayout");ne(this,"bufferLayout");ne(this,"linkStatus","pending");ne(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};ne(i6,"defaultProps",{...Fr.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let eu=i6;const Pl=class Pl extends Fr{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Pl.normalizeProps(e,t),super(e,t,Pl.defaultProps)}static normalizeProps(e,t){var u;return{...(u=e.props._resourceDefaults)==null?void 0:u.renderPass,...t}}};ne(Pl,"defaultClearColor",[0,0,0,1]),ne(Pl,"defaultClearDepth",1),ne(Pl,"defaultClearStencil",0),ne(Pl,"defaultProps",{...Fr.defaultProps,framebuffer:null,parameters:void 0,clearColor:Pl.defaultClearColor,clearColors:void 0,clearDepth:Pl.defaultClearDepth,clearStencil:Pl.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let K9=Pl;const s6=class s6 extends Fr{constructor(t,r){super(t,r,s6.defaultProps);ne(this,"hash","");ne(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};ne(s6,"defaultProps",{...Fr.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let O7=s6;const o6=class o6 extends Fr{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,o6.defaultProps)}};ne(o6,"defaultProps",{...Fr.defaultProps,measureExecutionTime:void 0});let J9=o6;const a6=class a6 extends Fr{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,a6.defaultProps)}};ne(a6,"defaultProps",{...Fr.defaultProps});let Q9=a6;function nM(n){const[e,t]=iM[n],r=e==="i32"||e==="u32",s=e!=="u32",u=sM[e]*t,f=rM(e,t);return{dataType:e,components:t,defaultVertexFormat:f,byteLength:u,integer:r,signed:s}}function rM(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const iM={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},sM={f32:4,f16:2,i32:4,u32:4};function mv(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,r]=n.split("x"),s=t,u=r?parseInt(r):1,f=uv(s),m={type:s,components:u,byteLength:f.byteLength*u,integer:f.integer,signed:f.signed,normalized:f.normalized};return e&&(m.webglOnly=!0),m}function gv(n,e){const t={};for(const r of n.attributes){const s=aM(n,e,r.name);s&&(t[r.name]=s)}return t}function oM(n,e,t=16){const r=gv(n,e),s=new Array(t).fill(null);for(const u of Object.values(r))s[u.location]=u;return s}function aM(n,e,t){const r=lM(n,t),s=cM(e,t);if(!r)return null;const u=nM(r.type),f=(s==null?void 0:s.vertexFormat)||u.defaultVertexFormat,m=mv(f);return{attributeName:(s==null?void 0:s.attributeName)||r.name,bufferName:(s==null?void 0:s.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:u.dataType,shaderComponents:u.components,vertexFormat:f,bufferDataType:m.type,bufferComponents:m.components,normalized:m.normalized,integer:u.integer,stepMode:(s==null?void 0:s.stepMode)||r.stepMode||"vertex",byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function lM(n,e){const t=n.attributes.find(r=>r.name===e);return t||jt.warn(`shader layout attribute "${e}" not present in shader`),t||null}function cM(n,e){uM(n);let t=hM(n,e);return t||(t=fM(n,e),t)?t:(jt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function uM(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&jt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function hM(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function fM(n,e){var t;for(const r of n){let s=r.byteStride;if(typeof r.byteStride!="number")for(const f of r.attributes||[]){const m=mv(f.format);s+=m.byteLength}const u=(t=r.attributes)==null?void 0:t.find(f=>f.attribute===e);if(u)return{attributeName:u.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:u.format,byteOffset:u.byteOffset,byteStride:s}}return null}const l6=class l6 extends Fr{constructor(t,r){super(t,r,l6.defaultProps);ne(this,"maxVertexAttributes");ne(this,"attributeInfos");ne(this,"indexBuffer",null);ne(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:s,bufferLayout:u}=r.renderPipeline||{};if(!s||!u)throw new Error("VertexArray");this.attributeInfos=oM(s,u,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,r){this.device.reportError(new Error("constant attributes not supported"))}};ne(l6,"defaultProps",{...Fr.defaultProps,renderPipeline:null});let eh=l6;const c6=class c6 extends Fr{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,c6.defaultProps)}};ne(c6,"defaultProps",{...Fr.defaultProps,layout:void 0,buffers:{}});let th=c6;const u6=class u6 extends Fr{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,u6.defaultProps)}};ne(u6,"defaultProps",{...Fr.defaultProps,type:void 0,count:void 0});let nh=u6;const dM={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function pM(n){return dM[n]}function mM(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let B8;function _v(n){return(!B8||B8.byteLength<n)&&(B8=new ArrayBuffer(n)),B8}function gM(n,e){const t=_v(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function _M(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function D7(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":_M(n)}const eg=1024;class yM{constructor(e){ne(this,"layout",{});ne(this,"byteLength");let t=0;for(const[s,u]of Object.entries(e)){const f=pM(u),{type:m,components:o}=f;t=mM(t,o);const T=t;t+=o,this.layout[s]={type:m,size:o,offset:T}}t+=(4-t%4)%4;const r=t*4;this.byteLength=Math.max(r,eg)}getData(e){const t=Math.max(this.byteLength,eg),r=_v(t),s={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[u,f]of Object.entries(e)){const m=this.layout[u];if(!m){jt.warn(`Supplied uniform value ${u} not present in uniform block layout`)();continue}const{type:o,size:T,offset:C}=m,R=s[o];if(T===1){if(typeof f!="number"&&typeof f!="boolean"){jt.warn(`Supplied value for single component uniform ${u} is not a number: ${f}`)();continue}R[C]=Number(f)}else{if(!D7(f)){jt.warn(`Supplied value for multi component / array uniform ${u} is not a numeric array: ${f}`)();continue}R.set(f,C)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function vM(n,e,t=16){if(n!==e)return!1;const r=n,s=e;if(!D7(r))return!1;if(D7(s)&&r.length===s.length){for(let u=0;u<r.length;++u)if(s[u]!==r[u])return!1}return!0}function xM(n){return D7(n)?n.slice():n}class bM{constructor(e){ne(this,"name");ne(this,"uniforms",{});ne(this,"modifiedUniforms",{});ne(this,"modified",!0);ne(this,"bindingLayout",{});ne(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(u=>u.type==="uniform"&&u.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const s=r;for(const u of s.uniforms||[])this.bindingLayout[u.name]=u}}setUniforms(e){for(const[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){vM(this.uniforms[e],t)||(this.uniforms[e]=xM(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class wM{constructor(e){ne(this,"uniformBlocks",new Map);ne(this,"uniformBufferLayouts",new Map);ne(this,"uniformBuffers",new Map);for(const[t,r]of Object.entries(e)){const s=t,u=new yM(r.uniformTypes||{});this.uniformBufferLayouts.set(s,u);const f=new bM({name:t});f.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(s,f)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[r,s]of Object.entries(e))(t=this.uniformBlocks.get(r))==null||t.setUniforms(s);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var r,s;const t=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(s=this.uniformBufferLayouts.get(e))==null?void 0:s.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);const s=this.getUniformBufferByteLength(t),u=e.createBuffer({usage:Jr.UNIFORM|Jr.COPY_DST,byteLength:s}),f=this.getUniformBufferData(t);return u.write(f),u}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const r=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:Jr.UNIFORM|Jr.COPY_DST,byteLength:r});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(t);e||(e=r)}return e&&jt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var u;const t=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),s=!1;if(r&&(t!=null&&t.needsRedraw)){s||(s=t.needsRedraw);const f=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(f);const m=(u=this.uniformBlocks.get(e))==null?void 0:u.getAllUniforms();jt.log(4,`Writing to uniform buffer ${String(e)}`,f,m)()}return s}}function yv(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function vv(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function TM(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let s=yv(n);if(s==="uint8"&&t&&r===1)return"unorm8-webgl";if(s==="uint8"&&t&&r===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${r}`}if(s==="uint16"||s==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${r}`}return r===1?s:`${s}x${r}`}class G5{constructor(e){ne(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,t){const r=[...e];for(const s of t){const u=r.findIndex(f=>f.name===s.name);u<0?r.push(s):r[u]=s}return r}getBufferIndex(e){const t=this.bufferLayouts.findIndex(r=>r.name===e);return t===-1&&jt.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function EM(n,e){const t=Object.fromEntries(n.attributes.map(s=>[s.name,s.location])),r=e.slice();return r.sort((s,u)=>{const f=s.attributes?s.attributes.map(C=>C.attribute):[s.name],m=u.attributes?u.attributes.map(C=>C.attribute):[u.name],o=Math.min(...f.map(C=>t[C])),T=Math.min(...m.map(C=>t[C]));return o-T}),r}class Va{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class tg{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class _3 extends Va{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class E3 extends Va{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class rh extends Va{constructor(e,t,r){super(e,r),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class B0 extends Va{constructor(e,t,r,s){super(e,r),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var d3;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(d3||(d3={}));class z8{constructor(e,t,r,s,u,f,m){this.name=e,this.type=t,this.group=r,this.binding=s,this.attributes=u,this.resourceType=f,this.access=m}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class SM{constructor(e,t){this.name=e,this.type=t}}class AM{constructor(e,t,r,s){this.name=e,this.type=t,this.locationType=r,this.location=s,this.interpolation=null}}class ng{constructor(e,t,r,s){this.name=e,this.type=t,this.locationType=r,this.location=s}}class CM{constructor(e,t,r,s){this.name=e,this.type=t,this.attributes=r,this.id=s}}class PM{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}}class IM{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}}class MM{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const xv=new Float32Array(1),RM=new Int32Array(xv.buffer),Js=new Uint16Array(1);function kM(n){xv[0]=n;const e=RM[0],t=e>>31&1;let r=e>>23&255,s=8388607&e;if(r===255)return Js[0]=t<<15|31744|(s!==0?512:0),Js[0];if(r===0){if(s===0)return Js[0]=t<<15,Js[0];s|=8388608;let u=113;for(;!(8388608&s);)s<<=1,u--;return r=127-u,s&=8388607,r>0?(s=(s>>126-r)+(s>>127-r&1),Js[0]=t<<15|r<<10|s>>13,Js[0]):(Js[0]=t<<15,Js[0])}return r=r-127+15,r>=31?(Js[0]=t<<15|31744,Js[0]):r<=0?r<-10?(Js[0]=t<<15,Js[0]):(s=(8388608|s)>>1-r,Js[0]=t<<15|s>>13,Js[0]):(s>>=13,Js[0]=t<<15|r<<10|s,Js[0])}const af=new Uint32Array(1),bv=new Float32Array(af.buffer,0,1);function rg(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return af[0]=e,bv[0]}function OM(n,e,t,r,s,u,f,m,o){const T=r*(f>>=s)*(u>>=s)+t*f+e*m;switch(o){case"r8unorm":return[Sr(n,T,"8unorm",1)[0]];case"r8snorm":return[Sr(n,T,"8snorm",1)[0]];case"r8uint":return[Sr(n,T,"8uint",1)[0]];case"r8sint":return[Sr(n,T,"8sint",1)[0]];case"rg8unorm":{const C=Sr(n,T,"8unorm",2);return[C[0],C[1]]}case"rg8snorm":{const C=Sr(n,T,"8snorm",2);return[C[0],C[1]]}case"rg8uint":{const C=Sr(n,T,"8uint",2);return[C[0],C[1]]}case"rg8sint":{const C=Sr(n,T,"8sint",2);return[C[0],C[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const C=Sr(n,T,"8unorm",4);return[C[0],C[1],C[2],C[3]]}case"rgba8snorm":{const C=Sr(n,T,"8snorm",4);return[C[0],C[1],C[2],C[3]]}case"rgba8uint":{const C=Sr(n,T,"8uint",4);return[C[0],C[1],C[2],C[3]]}case"rgba8sint":{const C=Sr(n,T,"8sint",4);return[C[0],C[1],C[2],C[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const C=Sr(n,T,"8unorm",4);return[C[2],C[1],C[0],C[3]]}case"r16uint":return[Sr(n,T,"16uint",1)[0]];case"r16sint":return[Sr(n,T,"16sint",1)[0]];case"r16float":return[Sr(n,T,"16float",1)[0]];case"rg16uint":{const C=Sr(n,T,"16uint",2);return[C[0],C[1]]}case"rg16sint":{const C=Sr(n,T,"16sint",2);return[C[0],C[1]]}case"rg16float":{const C=Sr(n,T,"16float",2);return[C[0],C[1]]}case"rgba16uint":{const C=Sr(n,T,"16uint",4);return[C[0],C[1],C[2],C[3]]}case"rgba16sint":{const C=Sr(n,T,"16sint",4);return[C[0],C[1],C[2],C[3]]}case"rgba16float":{const C=Sr(n,T,"16float",4);return[C[0],C[1],C[2],C[3]]}case"r32uint":return[Sr(n,T,"32uint",1)[0]];case"r32sint":return[Sr(n,T,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Sr(n,T,"32float",1)[0]];case"rg32uint":{const C=Sr(n,T,"32uint",2);return[C[0],C[1]]}case"rg32sint":{const C=Sr(n,T,"32sint",2);return[C[0],C[1]]}case"rg32float":{const C=Sr(n,T,"32float",2);return[C[0],C[1]]}case"rgba32uint":{const C=Sr(n,T,"32uint",4);return[C[0],C[1],C[2],C[3]]}case"rgba32sint":{const C=Sr(n,T,"32sint",4);return[C[0],C[1],C[2],C[3]]}case"rgba32float":{const C=Sr(n,T,"32float",4);return[C[0],C[1],C[2],C[3]]}case"rg11b10ufloat":{const C=new Uint32Array(n.buffer,T,1)[0],R=(4192256&C)>>11,O=(4290772992&C)>>22;return[rg(2047&C),rg(R),function(U){const V=112+(U>>5&31)<<23|(31&U)<<18;return af[0]=V,bv[0]}(O),1]}}return null}function Sr(n,e,t,r){const s=[0,0,0,0];for(let T=0;T<r;++T)switch(t){case"8unorm":s[T]=n[e]/255,e++;break;case"8snorm":s[T]=n[e]/255*2-1,e++;break;case"8uint":s[T]=n[e],e++;break;case"8sint":s[T]=n[e]-127,e++;break;case"16uint":s[T]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":s[T]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":s[T]=(u=n[e]|n[e+1]<<8,f=void 0,m=void 0,o=void 0,f=(32768&u)>>15,o=1023&u,(m=(31744&u)>>10)==0?(f?-1:1)*Math.pow(2,-14)*(o/Math.pow(2,10)):m==31?o?NaN:1/0*(f?-1:1):(f?-1:1)*Math.pow(2,m-15)*(1+o/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":s[T]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":s[T]=new Float32Array(n.buffer,e,1)[0],e+=4}var u,f,m,o;return s}function Pr(n,e,t,r,s){for(let u=0;u<r;++u)switch(t){case"8unorm":n[e]=255*s[u],e++;break;case"8snorm":n[e]=.5*(s[u]+1)*255,e++;break;case"8uint":n[e]=s[u],e++;break;case"8sint":n[e]=s[u]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=s[u],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=s[u],e+=2;break;case"16float":{const f=kM(s[u]);new Uint16Array(n.buffer,e,1)[0]=f,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=s[u],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=s[u],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=s[u],e+=4}return s}const Y5={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Ha{constructor(){this.id=Ha._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(L7.instance);for(const r of e)r instanceof Array?this.searchBlock(r,t):r.search(t);t(F7.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Ha._id=0;class L7 extends Ha{}L7.instance=new L7;class F7 extends Ha{}F7.instance=new F7;const wv=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class ri extends Ha{constructor(){super()}}class I2 extends ri{constructor(e,t,r,s,u,f){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=s,this.startLine=u,this.endLine=f}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class DM extends ri{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Tv extends ri{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class ih extends ri{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Ev extends ri{constructor(e,t,r,s){super(),this.init=e,this.condition=t,this.increment=r,this.body=s}get astNodeType(){return"for"}search(e){var t,r,s;(t=this.init)===null||t===void 0||t.search(e),(r=this.condition)===null||r===void 0||r.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class yc extends ri{constructor(e,t,r,s,u){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=s,this.value=u}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class lf extends ri{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class v2 extends ri{constructor(e,t,r,s,u){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=s,this.value=u}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class r7 extends ri{constructor(e,t,r,s,u){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=s,this.value=u}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var V4,l2,nt,qe;(n=>{n.increment="++",n.decrement="--"})(V4||(V4={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(V4||(V4={}));class Sv extends ri{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(l2||(l2={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(l2||(l2={}));class Av extends ri{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class cf extends ri{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return wv.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class Cv extends ri{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class Pv extends ri{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class Iv extends ri{constructor(e,t,r,s){super(),this.condition=e,this.body=t,this.elseif=r,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Mv extends ri{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class LM extends ri{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class FM extends ri{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Rv extends ri{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class uf extends ri{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class NM extends ri{constructor(){super()}get astNodeType(){return"discard"}}class kv extends ri{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class Ov extends ri{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class At extends ri{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const s=At._priority.get(t.name);At._priority.get(e[r].name)<s&&(t=e[r])}return t.name==="x32"?At.i32:t}getTypeName(){return this.name}}At.x32=new At("x32"),At.f32=new At("f32"),At.i32=new At("i32"),At.u32=new At("u32"),At.f16=new At("f16"),At.bool=new At("bool"),At.void=new At("void"),At._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class ig extends At{constructor(e){super(e)}}class mc extends At{constructor(e,t,r,s){super(e),this.members=t,this.startLine=r,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class Je extends At{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}Je.vec2f=new Je("vec2",At.f32,null),Je.vec3f=new Je("vec3",At.f32,null),Je.vec4f=new Je("vec4",At.f32,null),Je.vec2i=new Je("vec2",At.i32,null),Je.vec3i=new Je("vec3",At.i32,null),Je.vec4i=new Je("vec4",At.i32,null),Je.vec2u=new Je("vec2",At.u32,null),Je.vec3u=new Je("vec3",At.u32,null),Je.vec4u=new Je("vec4",At.u32,null),Je.vec2h=new Je("vec2",At.f16,null),Je.vec3h=new Je("vec3",At.f16,null),Je.vec4h=new Je("vec4",At.f16,null),Je.vec2b=new Je("vec2",At.bool,null),Je.vec3b=new Je("vec3",At.bool,null),Je.vec4b=new Je("vec4",At.bool,null),Je.mat2x2f=new Je("mat2x2",At.f32,null),Je.mat2x3f=new Je("mat2x3",At.f32,null),Je.mat2x4f=new Je("mat2x4",At.f32,null),Je.mat3x2f=new Je("mat3x2",At.f32,null),Je.mat3x3f=new Je("mat3x3",At.f32,null),Je.mat3x4f=new Je("mat3x4",At.f32,null),Je.mat4x2f=new Je("mat4x2",At.f32,null),Je.mat4x3f=new Je("mat4x3",At.f32,null),Je.mat4x4f=new Je("mat4x4",At.f32,null),Je.mat2x2h=new Je("mat2x2",At.f16,null),Je.mat2x3h=new Je("mat2x3",At.f16,null),Je.mat2x4h=new Je("mat2x4",At.f16,null),Je.mat3x2h=new Je("mat3x2",At.f16,null),Je.mat3x3h=new Je("mat3x3",At.f16,null),Je.mat3x4h=new Je("mat3x4",At.f16,null),Je.mat4x2h=new Je("mat4x2",At.f16,null),Je.mat4x3h=new Je("mat4x3",At.f16,null),Je.mat4x4h=new Je("mat4x4",At.f16,null),Je.mat2x2i=new Je("mat2x2",At.i32,null),Je.mat2x3i=new Je("mat2x3",At.i32,null),Je.mat2x4i=new Je("mat2x4",At.i32,null),Je.mat3x2i=new Je("mat3x2",At.i32,null),Je.mat3x3i=new Je("mat3x3",At.i32,null),Je.mat3x4i=new Je("mat3x4",At.i32,null),Je.mat4x2i=new Je("mat4x2",At.i32,null),Je.mat4x3i=new Je("mat4x3",At.i32,null),Je.mat4x4i=new Je("mat4x4",At.i32,null),Je.mat2x2u=new Je("mat2x2",At.u32,null),Je.mat2x3u=new Je("mat2x3",At.u32,null),Je.mat2x4u=new Je("mat2x4",At.u32,null),Je.mat3x2u=new Je("mat3x2",At.u32,null),Je.mat3x3u=new Je("mat3x3",At.u32,null),Je.mat3x4u=new Je("mat3x4",At.u32,null),Je.mat4x2u=new Je("mat4x2",At.u32,null),Je.mat4x3u=new Je("mat4x3",At.u32,null),Je.mat4x4u=new Je("mat4x4",At.u32,null);class i7 extends At{constructor(e,t,r,s){super(e),this.storage=t,this.type=r,this.access=s}get astNodeType(){return"pointer"}}class x2 extends At{constructor(e,t,r,s){super(e),this.attributes=t,this.format=r,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class c2 extends At{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}}class Nl extends Ha{constructor(){super(),this.postfix=null}}class z0 extends Nl{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class y1 extends Nl{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class hf extends Nl{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return wv.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class ma extends Nl{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class Dv extends Nl{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class ss extends Nl{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof Ze}get isVector(){return this.value instanceof Te||this.value instanceof Cn}get scalarValue(){return this.value instanceof Ze?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Te||this.value instanceof Cn?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Lv extends Nl{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class tu extends Nl{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Fv extends Nl{constructor(){super()}}class $i extends Fv{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Cl extends Fv{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?At.f32:e.name==="u32"||t.name==="u32"?At.u32:At.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Nv extends Ha{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class s7 extends Nl{constructor(){super()}get astNodeType(){return"default"}}class Bv extends Nv{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class zv extends Nv{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class sg extends Ha{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}}class BM extends Ha{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class og extends Ha{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}}class Uv extends Ha{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Wa{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Wa._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,r,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Wa._id=0;class sh extends Wa{constructor(){super(new Va("void",null),null)}toString(){return"void"}}sh.void=new sh;class F4 extends Wa{constructor(e){super(new rh("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,r,s){this.reference.setDataValue(e,t,r,s)}getSubData(e,t,r){return t?this.reference.getSubData(e,t,r):this}toString(){return`&${this.reference.toString()}`}}class Ze extends Wa{constructor(e,t,r=null){super(t,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new Ze(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ze(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ze(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,r,s){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(t instanceof Ze))return void console.error("SetDataValue: Invalid value",t);let u=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?u=Math.floor(u):this.typeInfo.name==="bool"&&(u=u?1:0),this.data[0]=u}getSubData(e,t,r){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function zM(n,e,t){const r=e.length;return r===2?t==="f32"?new Te(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new Te(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new Te(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new Te(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):r===3?t==="f32"?new Te(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new Te(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new Te(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new Te(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):r===4?t==="f32"?new Te(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new Te(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new Te(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new Te(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class Te extends Wa{constructor(e,t,r=null){if(super(t,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new Te(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Te(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Te(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,r,s){r instanceof z0?console.error("TODO: Set vector postfix"):t instanceof Te?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof B0)s=this.typeInfo.format||s;else{const f=this.typeInfo.name;f==="vec2f"||f==="vec3f"||f==="vec4f"?s=e.getTypeInfo("f32"):f==="vec2i"||f==="vec3i"||f==="vec4i"?s=e.getTypeInfo("i32"):f==="vec2b"||f==="vec3b"||f==="vec4b"?s=e.getTypeInfo("bool"):f==="vec2u"||f==="vec3u"||f==="vec4u"?s=e.getTypeInfo("u32"):f==="vec2h"||f==="vec3h"||f==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${f}`)}let u=this;for(;t!==null&&u!==null;){if(t instanceof tu){const f=t.index;let m=-1;if(f instanceof ss){if(!(f.value instanceof Ze))return console.error(`GetSubData: Invalid array index ${f.value}`),null;m=f.value.value}else{const o=e.evalExpression(f,r);if(!(o instanceof Ze))return console.error("GetSubData: Unknown index type",f),null;m=o.value}if(m<0||m>=u.data.length)return console.error("GetSubData: Index out of range",m),null;if(u.data instanceof Float32Array){const o=new Float32Array(u.data.buffer,u.data.byteOffset+4*m,1);return new Ze(o,s)}if(u.data instanceof Int32Array){const o=new Int32Array(u.data.buffer,u.data.byteOffset+4*m,1);return new Ze(o,s)}if(u.data instanceof Uint32Array){const o=new Uint32Array(u.data.buffer,u.data.byteOffset+4*m,1);return new Ze(o,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof z0))return console.error("GetSubData: Unknown postfix",t),null;{const f=t.value.toLowerCase();if(f.length===1){let o=0;if(f==="x"||f==="r")o=0;else if(f==="y"||f==="g")o=1;else if(f==="z"||f==="b")o=2;else{if(f!=="w"&&f!=="a")return console.error(`GetSubData: Unknown member ${f}`),null;o=3}if(this.data instanceof Float32Array){let T=new Float32Array(this.data.buffer,this.data.byteOffset+4*o,1);return new Ze(T,s,this)}if(this.data instanceof Int32Array){let T=new Int32Array(this.data.buffer,this.data.byteOffset+4*o,1);return new Ze(T,s,this)}if(this.data instanceof Uint32Array){let T=new Uint32Array(this.data.buffer,this.data.byteOffset+4*o,1);return new Ze(T,s,this)}}const m=[];for(const o of f)o==="x"||o==="r"?m.push(this.data[0]):o==="y"||o==="g"?m.push(this.data[1]):o==="z"||o==="b"?m.push(this.data[2]):o==="w"||o==="a"?m.push(this.data[3]):console.error(`GetDataValue: Unknown member ${o}`);u=zM(e,m,s.name)}t=t.postfix}return u}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Cn extends Wa{constructor(e,t,r=null){super(t,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Cn(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,r,s){r instanceof z0?console.error("TODO: Set matrix postfix"):t instanceof Cn?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof B0)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(t instanceof tu){const u=t.index;let f=-1;if(u instanceof ss){if(!(u.value instanceof Ze))return console.error(`GetDataValue: Invalid array index ${u.value}`),null;f=u.value.value}else{const T=e.evalExpression(u,r);if(!(T instanceof Ze))return console.error("GetDataValue: Unknown index type",u),null;f=T.value}if(f<0||f>=this.data.length)return console.error("GetDataValue: Index out of range",f),null;const m=s.endsWith("h")?"h":"f";let o;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")o=new Te(new Float32Array(this.data.buffer,this.data.byteOffset+2*f*4,2),e.getTypeInfo(`vec2${m}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")o=new Te(new Float32Array(this.data.buffer,this.data.byteOffset+3*f*4,3),e.getTypeInfo(`vec3${m}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;o=new Te(new Float32Array(this.data.buffer,this.data.byteOffset+4*f*4,4),e.getTypeInfo(`vec4${m}`))}return t.postfix?o.getSubData(e,t.postfix,r):o}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Ti extends Wa{constructor(e,t,r=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Ti(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,r,s){if(t===null)return void console.log("setDataValue: NULL data.");let u=this.offset,f=this.typeInfo;for(;r;){if(r instanceof tu)if(f instanceof E3){const m=r.index;if(m instanceof ss){if(!(m.value instanceof Ze))return void console.error(`SetDataValue: Invalid index type ${m.value}`);u+=m.value.value*f.stride}else{const o=e.evalExpression(m,s);if(!(o instanceof Ze))return void console.error("SetDataValue: Unknown index type",m);u+=o.value*f.stride}f=f.format}else console.error(`SetDataValue: Type ${f.getTypeName()} is not an array`);else{if(!(r instanceof z0))return void console.error("SetDataValue: Unknown postfix type",r);{const m=r.value;if(f instanceof _3){let o=!1;for(const T of f.members)if(T.name===m){u+=T.offset,f=T.type,o=!0;break}if(!o)return void console.error(`SetDataValue: Member ${m} not found`)}else if(f instanceof Va){const o=f.getTypeName();let T=0;if(m==="x"||m==="r")T=0;else if(m==="y"||m==="g")T=1;else if(m==="z"||m==="b")T=2;else{if(m!=="w"&&m!=="a")return void console.error(`SetDataValue: Unknown member ${m}`);T=3}if(!(t instanceof Ze))return void console.error("SetDataValue: Invalid value",t);const C=t.value;return o==="vec2f"?void(new Float32Array(this.buffer,u,2)[T]=C):o==="vec3f"?void(new Float32Array(this.buffer,u,3)[T]=C):o==="vec4f"?void(new Float32Array(this.buffer,u,4)[T]=C):o==="vec2i"?void(new Int32Array(this.buffer,u,2)[T]=C):o==="vec3i"?void(new Int32Array(this.buffer,u,3)[T]=C):o==="vec4i"?void(new Int32Array(this.buffer,u,4)[T]=C):o==="vec2u"?void(new Uint32Array(this.buffer,u,2)[T]=C):o==="vec3u"?void(new Uint32Array(this.buffer,u,3)[T]=C):o==="vec4u"?void(new Uint32Array(this.buffer,u,4)[T]=C):void console.error(`SetDataValue: Type ${o} is not a struct`)}}}r=r.postfix}this.setData(e,t,f,u,s)}setData(e,t,r,s,u){const f=r.getTypeName();if(f!=="f32"&&f!=="f16")if(f!=="i32"&&f!=="atomic<i32>"&&f!=="x32")if(f!=="u32"&&f!=="atomic<u32>")if(f!=="bool")if(f!=="vec2f"&&f!=="vec2h")if(f!=="vec3f"&&f!=="vec3h")if(f!=="vec4f"&&f!=="vec4h")if(f!=="vec2i")if(f!=="vec3i")if(f!=="vec4i")if(f!=="vec2u")if(f!=="vec3u")if(f!=="vec4u")if(f!=="vec2b")if(f!=="vec3b")if(f!=="vec4b")if(f!=="mat2x2f"&&f!=="mat2x2h")if(f!=="mat2x3f"&&f!=="mat2x3h")if(f!=="mat2x4f"&&f!=="mat2x4h")if(f!=="mat3x2f"&&f!=="mat3x2h")if(f!=="mat3x3f"&&f!=="mat3x3h")if(f!=="mat3x4f"&&f!=="mat3x4h")if(f!=="mat4x2f"&&f!=="mat4x2h")if(f!=="mat4x3f"&&f!=="mat4x3h")if(f!=="mat4x4f"&&f!=="mat4x4h")if(t instanceof Ti){if(r===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",f,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${f}`);else{const m=new Float32Array(this.buffer,s,16);t instanceof Cn?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3],m[4]=t.data[4],m[5]=t.data[5],m[6]=t.data[6],m[7]=t.data[7],m[8]=t.data[8],m[9]=t.data[9],m[10]=t.data[10],m[11]=t.data[11],m[12]=t.data[12],m[13]=t.data[13],m[14]=t.data[14],m[15]=t.data[15]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3],m[4]=t[4],m[5]=t[5],m[6]=t[6],m[7]=t[7],m[8]=t[8],m[9]=t[9],m[10]=t[10],m[11]=t[11],m[12]=t[12],m[13]=t[13],m[14]=t[14],m[15]=t[15])}else{const m=new Float32Array(this.buffer,s,12);t instanceof Cn?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3],m[4]=t.data[4],m[5]=t.data[5],m[6]=t.data[6],m[7]=t.data[7],m[8]=t.data[8],m[9]=t.data[9],m[10]=t.data[10],m[11]=t.data[11]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3],m[4]=t[4],m[5]=t[5],m[6]=t[6],m[7]=t[7],m[8]=t[8],m[9]=t[9],m[10]=t[10],m[11]=t[11])}else{const m=new Float32Array(this.buffer,s,8);t instanceof Cn?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3],m[4]=t.data[4],m[5]=t.data[5],m[6]=t.data[6],m[7]=t.data[7]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3],m[4]=t[4],m[5]=t[5],m[6]=t[6],m[7]=t[7])}else{const m=new Float32Array(this.buffer,s,12);t instanceof Cn?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3],m[4]=t.data[4],m[5]=t.data[5],m[6]=t.data[6],m[7]=t.data[7],m[8]=t.data[8],m[9]=t.data[9],m[10]=t.data[10],m[11]=t.data[11]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3],m[4]=t[4],m[5]=t[5],m[6]=t[6],m[7]=t[7],m[8]=t[8],m[9]=t[9],m[10]=t[10],m[11]=t[11])}else{const m=new Float32Array(this.buffer,s,9);t instanceof Cn?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3],m[4]=t.data[4],m[5]=t.data[5],m[6]=t.data[6],m[7]=t.data[7],m[8]=t.data[8]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3],m[4]=t[4],m[5]=t[5],m[6]=t[6],m[7]=t[7],m[8]=t[8])}else{const m=new Float32Array(this.buffer,s,6);t instanceof Cn?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3],m[4]=t.data[4],m[5]=t.data[5]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3],m[4]=t[4],m[5]=t[5])}else{const m=new Float32Array(this.buffer,s,8);t instanceof Cn?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3],m[4]=t.data[4],m[5]=t.data[5],m[6]=t.data[6],m[7]=t.data[7]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3],m[4]=t[4],m[5]=t[5],m[6]=t[6],m[7]=t[7])}else{const m=new Float32Array(this.buffer,s,6);t instanceof Cn?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3],m[4]=t.data[4],m[5]=t.data[5]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3],m[4]=t[4],m[5]=t[5])}else{const m=new Float32Array(this.buffer,s,4);t instanceof Cn?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3])}else{const m=new Uint32Array(this.buffer,s,4);t instanceof Te?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3])}else{const m=new Uint32Array(this.buffer,s,3);t instanceof Te?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2]):(m[0]=t[0],m[1]=t[1],m[2]=t[2])}else{const m=new Uint32Array(this.buffer,s,2);t instanceof Te?(m[0]=t.data[0],m[1]=t.data[1]):(m[0]=t[0],m[1]=t[1])}else{const m=new Uint32Array(this.buffer,s,4);t instanceof Te?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3])}else{const m=new Uint32Array(this.buffer,s,3);t instanceof Te?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2]):(m[0]=t[0],m[1]=t[1],m[2]=t[2])}else{const m=new Uint32Array(this.buffer,s,2);t instanceof Te?(m[0]=t.data[0],m[1]=t.data[1]):(m[0]=t[0],m[1]=t[1])}else{const m=new Int32Array(this.buffer,s,4);t instanceof Te?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3])}else{const m=new Int32Array(this.buffer,s,3);t instanceof Te?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2]):(m[0]=t[0],m[1]=t[1],m[2]=t[2])}else{const m=new Int32Array(this.buffer,s,2);t instanceof Te?(m[0]=t.data[0],m[1]=t.data[1]):(m[0]=t[0],m[1]=t[1])}else{const m=new Float32Array(this.buffer,s,4);t instanceof Te?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2],m[3]=t.data[3]):(m[0]=t[0],m[1]=t[1],m[2]=t[2],m[3]=t[3])}else{const m=new Float32Array(this.buffer,s,3);t instanceof Te?(m[0]=t.data[0],m[1]=t.data[1],m[2]=t.data[2]):(m[0]=t[0],m[1]=t[1],m[2]=t[2])}else{const m=new Float32Array(this.buffer,s,2);t instanceof Te?(m[0]=t.data[0],m[1]=t.data[1]):(m[0]=t[0],m[1]=t[1])}else t instanceof Ze&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof Ze&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof Ze&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof Ze&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,r){var s,u,f;if(t===null)return this;let m=this.offset,o=this.typeInfo;for(;t;){if(t instanceof tu){const C=t.index,R=C instanceof Nl?e.evalExpression(C,r):C;let O=0;if(R instanceof Ze?O=R.value:typeof R=="number"?O=R:console.error("GetDataValue: Invalid index type",C),o instanceof E3)m+=O*o.stride,o=o.format;else{const U=o.getTypeName();U==="mat4x4"||U==="mat4x4f"||U==="mat4x4h"?(m+=16*O,o=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${o.getTypeName()} is not an array`)}}else{if(!(t instanceof z0))return console.error("GetDataValue: Unknown postfix type",t),null;{const C=t.value;if(o instanceof _3){let R=!1;for(const O of o.members)if(O.name===C){m+=O.offset,o=O.type,R=!0;break}if(!R)return console.error(`GetDataValue: Member ${C} not found`),null}else if(o instanceof Va){const R=o.getTypeName();if(R==="vec2f"||R==="vec3f"||R==="vec4f"||R==="vec2i"||R==="vec3i"||R==="vec4i"||R==="vec2u"||R==="vec3u"||R==="vec4u"||R==="vec2b"||R==="vec3b"||R==="vec4b"||R==="vec2h"||R==="vec3h"||R==="vec4h"||R==="vec2"||R==="vec3"||R==="vec4"){if(C.length>0&&C.length<5){let O="f";const U=[];for(let V=0;V<C.length;++V){const Y=C[V].toLowerCase();let ee=0;if(Y==="x"||Y==="r")ee=0;else if(Y==="y"||Y==="g")ee=1;else if(Y==="z"||Y==="b")ee=2;else{if(Y!=="w"&&Y!=="a")return console.error(`Unknown member ${C}`),null;ee=3}if(C.length===1){if(R.endsWith("f"))return this.buffer.byteLength<m+4*ee+4?(console.log("Insufficient buffer data"),null):new Ze(new Float32Array(this.buffer,m+4*ee,1),e.getTypeInfo("f32"),this);if(R.endsWith("h"))return new Ze(new Float32Array(this.buffer,m+4*ee,1),e.getTypeInfo("f16"),this);if(R.endsWith("i"))return new Ze(new Int32Array(this.buffer,m+4*ee,1),e.getTypeInfo("i32"),this);if(R.endsWith("b"))return new Ze(new Int32Array(this.buffer,m+4*ee,1),e.getTypeInfo("bool"),this);if(R.endsWith("u"))return new Ze(new Uint32Array(this.buffer,m+4*ee,1),e.getTypeInfo("i32"),this)}if(R==="vec2f")U.push(new Float32Array(this.buffer,m,2)[ee]);else if(R==="vec3f"){if(m+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const le=new Float32Array(this.buffer,m,3);U.push(le[ee])}else if(R==="vec4f")U.push(new Float32Array(this.buffer,m,4)[ee]);else if(R==="vec2i")O="i",U.push(new Int32Array(this.buffer,m,2)[ee]);else if(R==="vec3i")O="i",U.push(new Int32Array(this.buffer,m,3)[ee]);else if(R==="vec4i")O="i",U.push(new Int32Array(this.buffer,m,4)[ee]);else if(R==="vec2u"){O="u";const le=new Uint32Array(this.buffer,m,2);U.push(le[ee])}else R==="vec3u"?(O="u",U.push(new Uint32Array(this.buffer,m,3)[ee])):R==="vec4u"&&(O="u",U.push(new Uint32Array(this.buffer,m,4)[ee]))}return U.length===2?o=e.getTypeInfo(`vec2${O}`):U.length===3?o=e.getTypeInfo(`vec3${O}`):U.length===4?o=e.getTypeInfo(`vec4${O}`):console.error(`GetDataValue: Invalid vector length ${U.length}`),new Te(U,o,null)}return console.error(`GetDataValue: Unknown member ${C}`),null}return console.error(`GetDataValue: Type ${R} is not a struct`),null}}}t=t.postfix}const T=o.getTypeName();return T==="f32"?new Ze(new Float32Array(this.buffer,m,1),o,this):T==="i32"?new Ze(new Int32Array(this.buffer,m,1),o,this):T==="u32"?new Ze(new Uint32Array(this.buffer,m,1),o,this):T==="vec2f"?new Te(new Float32Array(this.buffer,m,2),o,this):T==="vec3f"?new Te(new Float32Array(this.buffer,m,3),o,this):T==="vec4f"?new Te(new Float32Array(this.buffer,m,4),o,this):T==="vec2i"?new Te(new Int32Array(this.buffer,m,2),o,this):T==="vec3i"?new Te(new Int32Array(this.buffer,m,3),o,this):T==="vec4i"?new Te(new Int32Array(this.buffer,m,4),o,this):T==="vec2u"?new Te(new Uint32Array(this.buffer,m,2),o,this):T==="vec3u"?new Te(new Uint32Array(this.buffer,m,3),o,this):T==="vec4u"?new Te(new Uint32Array(this.buffer,m,4),o,this):o instanceof B0&&o.name==="atomic"?((s=o.format)===null||s===void 0?void 0:s.name)==="u32"?new Ze(new Uint32Array(this.buffer,m,1)[0],o.format,this):((u=o.format)===null||u===void 0?void 0:u.name)==="i32"?new Ze(new Int32Array(this.buffer,m,1)[0],o.format,this):(console.error(`GetDataValue: Invalid atomic format ${(f=o.format)===null||f===void 0?void 0:f.name}`),null):new Ti(this.buffer,o,m,this)}toString(){let e="";if(this.typeInfo instanceof E3)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof _3?e+="{...}":e="[...]";return e}}class gc extends Wa{constructor(e,t,r,s){super(t,null),this.data=e,this.descriptor=r,this.view=s}clone(){return new gc(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.width)!==null&&t!==void 0?t:0}get height(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<t.length;++r)t[r]=Math.max(1,t[r]>>e);return t}get texelByteSize(){const e=this.format,t=Y5[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Y5[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Y5[e],r=this.width;if(!e||r<=0||!t)return-1;const s=this.height,u=this.depthOrArrayLayers,f=this.dimension;return r/t.blockWidth*(f==="1d"?1:s/t.blockHeight)*t.bytesPerBlock*u}getPixel(e,t,r=0,s=0){const u=this.texelByteSize,f=this.bytesPerRow,m=this.height,o=this.data[s];return OM(new Uint8Array(o),e,t,r,s,m,f,u,this.format)}setPixel(e,t,r,s,u){const f=this.texelByteSize,m=this.bytesPerRow,o=this.height,T=this.data[s];(function(C,R,O,U,V,Y,ee,le,Ee,ue){const _e=U*(ee>>=V)*(Y>>=V)+O*ee+R*le;switch(Ee){case"r8unorm":return void Pr(C,_e,"8unorm",1,ue);case"r8snorm":return void Pr(C,_e,"8snorm",1,ue);case"r8uint":return void Pr(C,_e,"8uint",1,ue);case"r8sint":return void Pr(C,_e,"8sint",1,ue);case"rg8unorm":return void Pr(C,_e,"8unorm",2,ue);case"rg8snorm":return void Pr(C,_e,"8snorm",2,ue);case"rg8uint":return void Pr(C,_e,"8uint",2,ue);case"rg8sint":return void Pr(C,_e,"8sint",2,ue);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Pr(C,_e,"8unorm",4,ue);case"rgba8snorm":return void Pr(C,_e,"8snorm",4,ue);case"rgba8uint":return void Pr(C,_e,"8uint",4,ue);case"rgba8sint":return void Pr(C,_e,"8sint",4,ue);case"r16uint":return void Pr(C,_e,"16uint",1,ue);case"r16sint":return void Pr(C,_e,"16sint",1,ue);case"r16float":return void Pr(C,_e,"16float",1,ue);case"rg16uint":return void Pr(C,_e,"16uint",2,ue);case"rg16sint":return void Pr(C,_e,"16sint",2,ue);case"rg16float":return void Pr(C,_e,"16float",2,ue);case"rgba16uint":return void Pr(C,_e,"16uint",4,ue);case"rgba16sint":return void Pr(C,_e,"16sint",4,ue);case"rgba16float":return void Pr(C,_e,"16float",4,ue);case"r32uint":return void Pr(C,_e,"32uint",1,ue);case"r32sint":return void Pr(C,_e,"32sint",1,ue);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Pr(C,_e,"32float",1,ue);case"rg32uint":return void Pr(C,_e,"32uint",2,ue);case"rg32sint":return void Pr(C,_e,"32sint",2,ue);case"rg32float":return void Pr(C,_e,"32float",2,ue);case"rgba32uint":return void Pr(C,_e,"32uint",4,ue);case"rgba32sint":return void Pr(C,_e,"32sint",4,ue);case"rgba32float":return void Pr(C,_e,"32float",4,ue);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(T),e,t,r,s,o,m,f,this.format,u)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(qe||(qe={}));class Ge{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}}class pe{}nt=pe,pe.none=new Ge("",qe.reserved,""),pe.eof=new Ge("EOF",qe.token,""),pe.reserved={asm:new Ge("asm",qe.reserved,"asm"),bf16:new Ge("bf16",qe.reserved,"bf16"),do:new Ge("do",qe.reserved,"do"),enum:new Ge("enum",qe.reserved,"enum"),f16:new Ge("f16",qe.reserved,"f16"),f64:new Ge("f64",qe.reserved,"f64"),handle:new Ge("handle",qe.reserved,"handle"),i8:new Ge("i8",qe.reserved,"i8"),i16:new Ge("i16",qe.reserved,"i16"),i64:new Ge("i64",qe.reserved,"i64"),mat:new Ge("mat",qe.reserved,"mat"),premerge:new Ge("premerge",qe.reserved,"premerge"),regardless:new Ge("regardless",qe.reserved,"regardless"),typedef:new Ge("typedef",qe.reserved,"typedef"),u8:new Ge("u8",qe.reserved,"u8"),u16:new Ge("u16",qe.reserved,"u16"),u64:new Ge("u64",qe.reserved,"u64"),unless:new Ge("unless",qe.reserved,"unless"),using:new Ge("using",qe.reserved,"using"),vec:new Ge("vec",qe.reserved,"vec"),void:new Ge("void",qe.reserved,"void")},pe.keywords={array:new Ge("array",qe.keyword,"array"),atomic:new Ge("atomic",qe.keyword,"atomic"),bool:new Ge("bool",qe.keyword,"bool"),f32:new Ge("f32",qe.keyword,"f32"),i32:new Ge("i32",qe.keyword,"i32"),mat2x2:new Ge("mat2x2",qe.keyword,"mat2x2"),mat2x3:new Ge("mat2x3",qe.keyword,"mat2x3"),mat2x4:new Ge("mat2x4",qe.keyword,"mat2x4"),mat3x2:new Ge("mat3x2",qe.keyword,"mat3x2"),mat3x3:new Ge("mat3x3",qe.keyword,"mat3x3"),mat3x4:new Ge("mat3x4",qe.keyword,"mat3x4"),mat4x2:new Ge("mat4x2",qe.keyword,"mat4x2"),mat4x3:new Ge("mat4x3",qe.keyword,"mat4x3"),mat4x4:new Ge("mat4x4",qe.keyword,"mat4x4"),ptr:new Ge("ptr",qe.keyword,"ptr"),sampler:new Ge("sampler",qe.keyword,"sampler"),sampler_comparison:new Ge("sampler_comparison",qe.keyword,"sampler_comparison"),struct:new Ge("struct",qe.keyword,"struct"),texture_1d:new Ge("texture_1d",qe.keyword,"texture_1d"),texture_2d:new Ge("texture_2d",qe.keyword,"texture_2d"),texture_2d_array:new Ge("texture_2d_array",qe.keyword,"texture_2d_array"),texture_3d:new Ge("texture_3d",qe.keyword,"texture_3d"),texture_cube:new Ge("texture_cube",qe.keyword,"texture_cube"),texture_cube_array:new Ge("texture_cube_array",qe.keyword,"texture_cube_array"),texture_multisampled_2d:new Ge("texture_multisampled_2d",qe.keyword,"texture_multisampled_2d"),texture_storage_1d:new Ge("texture_storage_1d",qe.keyword,"texture_storage_1d"),texture_storage_2d:new Ge("texture_storage_2d",qe.keyword,"texture_storage_2d"),texture_storage_2d_array:new Ge("texture_storage_2d_array",qe.keyword,"texture_storage_2d_array"),texture_storage_3d:new Ge("texture_storage_3d",qe.keyword,"texture_storage_3d"),texture_depth_2d:new Ge("texture_depth_2d",qe.keyword,"texture_depth_2d"),texture_depth_2d_array:new Ge("texture_depth_2d_array",qe.keyword,"texture_depth_2d_array"),texture_depth_cube:new Ge("texture_depth_cube",qe.keyword,"texture_depth_cube"),texture_depth_cube_array:new Ge("texture_depth_cube_array",qe.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Ge("texture_depth_multisampled_2d",qe.keyword,"texture_depth_multisampled_2d"),texture_external:new Ge("texture_external",qe.keyword,"texture_external"),u32:new Ge("u32",qe.keyword,"u32"),vec2:new Ge("vec2",qe.keyword,"vec2"),vec3:new Ge("vec3",qe.keyword,"vec3"),vec4:new Ge("vec4",qe.keyword,"vec4"),bitcast:new Ge("bitcast",qe.keyword,"bitcast"),block:new Ge("block",qe.keyword,"block"),break:new Ge("break",qe.keyword,"break"),case:new Ge("case",qe.keyword,"case"),continue:new Ge("continue",qe.keyword,"continue"),continuing:new Ge("continuing",qe.keyword,"continuing"),default:new Ge("default",qe.keyword,"default"),diagnostic:new Ge("diagnostic",qe.keyword,"diagnostic"),discard:new Ge("discard",qe.keyword,"discard"),else:new Ge("else",qe.keyword,"else"),enable:new Ge("enable",qe.keyword,"enable"),fallthrough:new Ge("fallthrough",qe.keyword,"fallthrough"),false:new Ge("false",qe.keyword,"false"),fn:new Ge("fn",qe.keyword,"fn"),for:new Ge("for",qe.keyword,"for"),function:new Ge("function",qe.keyword,"function"),if:new Ge("if",qe.keyword,"if"),let:new Ge("let",qe.keyword,"let"),const:new Ge("const",qe.keyword,"const"),loop:new Ge("loop",qe.keyword,"loop"),while:new Ge("while",qe.keyword,"while"),private:new Ge("private",qe.keyword,"private"),read:new Ge("read",qe.keyword,"read"),read_write:new Ge("read_write",qe.keyword,"read_write"),return:new Ge("return",qe.keyword,"return"),requires:new Ge("requires",qe.keyword,"requires"),storage:new Ge("storage",qe.keyword,"storage"),switch:new Ge("switch",qe.keyword,"switch"),true:new Ge("true",qe.keyword,"true"),alias:new Ge("alias",qe.keyword,"alias"),type:new Ge("type",qe.keyword,"type"),uniform:new Ge("uniform",qe.keyword,"uniform"),var:new Ge("var",qe.keyword,"var"),override:new Ge("override",qe.keyword,"override"),workgroup:new Ge("workgroup",qe.keyword,"workgroup"),write:new Ge("write",qe.keyword,"write"),r8unorm:new Ge("r8unorm",qe.keyword,"r8unorm"),r8snorm:new Ge("r8snorm",qe.keyword,"r8snorm"),r8uint:new Ge("r8uint",qe.keyword,"r8uint"),r8sint:new Ge("r8sint",qe.keyword,"r8sint"),r16uint:new Ge("r16uint",qe.keyword,"r16uint"),r16sint:new Ge("r16sint",qe.keyword,"r16sint"),r16float:new Ge("r16float",qe.keyword,"r16float"),rg8unorm:new Ge("rg8unorm",qe.keyword,"rg8unorm"),rg8snorm:new Ge("rg8snorm",qe.keyword,"rg8snorm"),rg8uint:new Ge("rg8uint",qe.keyword,"rg8uint"),rg8sint:new Ge("rg8sint",qe.keyword,"rg8sint"),r32uint:new Ge("r32uint",qe.keyword,"r32uint"),r32sint:new Ge("r32sint",qe.keyword,"r32sint"),r32float:new Ge("r32float",qe.keyword,"r32float"),rg16uint:new Ge("rg16uint",qe.keyword,"rg16uint"),rg16sint:new Ge("rg16sint",qe.keyword,"rg16sint"),rg16float:new Ge("rg16float",qe.keyword,"rg16float"),rgba8unorm:new Ge("rgba8unorm",qe.keyword,"rgba8unorm"),rgba8unorm_srgb:new Ge("rgba8unorm_srgb",qe.keyword,"rgba8unorm_srgb"),rgba8snorm:new Ge("rgba8snorm",qe.keyword,"rgba8snorm"),rgba8uint:new Ge("rgba8uint",qe.keyword,"rgba8uint"),rgba8sint:new Ge("rgba8sint",qe.keyword,"rgba8sint"),bgra8unorm:new Ge("bgra8unorm",qe.keyword,"bgra8unorm"),bgra8unorm_srgb:new Ge("bgra8unorm_srgb",qe.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Ge("rgb10a2unorm",qe.keyword,"rgb10a2unorm"),rg11b10float:new Ge("rg11b10float",qe.keyword,"rg11b10float"),rg32uint:new Ge("rg32uint",qe.keyword,"rg32uint"),rg32sint:new Ge("rg32sint",qe.keyword,"rg32sint"),rg32float:new Ge("rg32float",qe.keyword,"rg32float"),rgba16uint:new Ge("rgba16uint",qe.keyword,"rgba16uint"),rgba16sint:new Ge("rgba16sint",qe.keyword,"rgba16sint"),rgba16float:new Ge("rgba16float",qe.keyword,"rgba16float"),rgba32uint:new Ge("rgba32uint",qe.keyword,"rgba32uint"),rgba32sint:new Ge("rgba32sint",qe.keyword,"rgba32sint"),rgba32float:new Ge("rgba32float",qe.keyword,"rgba32float"),static_assert:new Ge("static_assert",qe.keyword,"static_assert")},pe.tokens={decimal_float_literal:new Ge("decimal_float_literal",qe.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new Ge("hex_float_literal",qe.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new Ge("int_literal",qe.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Ge("uint_literal",qe.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new Ge("name",qe.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new Ge("ident",qe.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Ge("and",qe.token,"&"),and_and:new Ge("and_and",qe.token,"&&"),arrow:new Ge("arrow ",qe.token,"->"),attr:new Ge("attr",qe.token,"@"),forward_slash:new Ge("forward_slash",qe.token,"/"),bang:new Ge("bang",qe.token,"!"),bracket_left:new Ge("bracket_left",qe.token,"["),bracket_right:new Ge("bracket_right",qe.token,"]"),brace_left:new Ge("brace_left",qe.token,"{"),brace_right:new Ge("brace_right",qe.token,"}"),colon:new Ge("colon",qe.token,":"),comma:new Ge("comma",qe.token,","),equal:new Ge("equal",qe.token,"="),equal_equal:new Ge("equal_equal",qe.token,"=="),not_equal:new Ge("not_equal",qe.token,"!="),greater_than:new Ge("greater_than",qe.token,">"),greater_than_equal:new Ge("greater_than_equal",qe.token,">="),shift_right:new Ge("shift_right",qe.token,">>"),less_than:new Ge("less_than",qe.token,"<"),less_than_equal:new Ge("less_than_equal",qe.token,"<="),shift_left:new Ge("shift_left",qe.token,"<<"),modulo:new Ge("modulo",qe.token,"%"),minus:new Ge("minus",qe.token,"-"),minus_minus:new Ge("minus_minus",qe.token,"--"),period:new Ge("period",qe.token,"."),plus:new Ge("plus",qe.token,"+"),plus_plus:new Ge("plus_plus",qe.token,"++"),or:new Ge("or",qe.token,"|"),or_or:new Ge("or_or",qe.token,"||"),paren_left:new Ge("paren_left",qe.token,"("),paren_right:new Ge("paren_right",qe.token,")"),semicolon:new Ge("semicolon",qe.token,";"),star:new Ge("star",qe.token,"*"),tilde:new Ge("tilde",qe.token,"~"),underscore:new Ge("underscore",qe.token,"_"),xor:new Ge("xor",qe.token,"^"),plus_equal:new Ge("plus_equal",qe.token,"+="),minus_equal:new Ge("minus_equal",qe.token,"-="),times_equal:new Ge("times_equal",qe.token,"*="),division_equal:new Ge("division_equal",qe.token,"/="),modulo_equal:new Ge("modulo_equal",qe.token,"%="),and_equal:new Ge("and_equal",qe.token,"&="),or_equal:new Ge("or_equal",qe.token,"|="),xor_equal:new Ge("xor_equal",qe.token,"^="),shift_right_equal:new Ge("shift_right_equal",qe.token,">>="),shift_left_equal:new Ge("shift_left_equal",qe.token,"<<=")},pe.simpleTokens={"@":nt.tokens.attr,"{":nt.tokens.brace_left,"}":nt.tokens.brace_right,":":nt.tokens.colon,",":nt.tokens.comma,"(":nt.tokens.paren_left,")":nt.tokens.paren_right,";":nt.tokens.semicolon},pe.literalTokens={"&":nt.tokens.and,"&&":nt.tokens.and_and,"->":nt.tokens.arrow,"/":nt.tokens.forward_slash,"!":nt.tokens.bang,"[":nt.tokens.bracket_left,"]":nt.tokens.bracket_right,"=":nt.tokens.equal,"==":nt.tokens.equal_equal,"!=":nt.tokens.not_equal,">":nt.tokens.greater_than,">=":nt.tokens.greater_than_equal,">>":nt.tokens.shift_right,"<":nt.tokens.less_than,"<=":nt.tokens.less_than_equal,"<<":nt.tokens.shift_left,"%":nt.tokens.modulo,"-":nt.tokens.minus,"--":nt.tokens.minus_minus,".":nt.tokens.period,"+":nt.tokens.plus,"++":nt.tokens.plus_plus,"|":nt.tokens.or,"||":nt.tokens.or_or,"*":nt.tokens.star,"~":nt.tokens.tilde,_:nt.tokens.underscore,"^":nt.tokens.xor,"+=":nt.tokens.plus_equal,"-=":nt.tokens.minus_equal,"*=":nt.tokens.times_equal,"/=":nt.tokens.division_equal,"%=":nt.tokens.modulo_equal,"&=":nt.tokens.and_equal,"|=":nt.tokens.or_equal,"^=":nt.tokens.xor_equal,">>=":nt.tokens.shift_right_equal,"<<=":nt.tokens.shift_left_equal},pe.regexTokens={decimal_float_literal:nt.tokens.decimal_float_literal,hex_float_literal:nt.tokens.hex_float_literal,int_literal:nt.tokens.int_literal,uint_literal:nt.tokens.uint_literal,ident:nt.tokens.ident},pe.storage_class=[nt.keywords.function,nt.keywords.private,nt.keywords.workgroup,nt.keywords.uniform,nt.keywords.storage],pe.access_mode=[nt.keywords.read,nt.keywords.write,nt.keywords.read_write],pe.sampler_type=[nt.keywords.sampler,nt.keywords.sampler_comparison],pe.sampled_texture_type=[nt.keywords.texture_1d,nt.keywords.texture_2d,nt.keywords.texture_2d_array,nt.keywords.texture_3d,nt.keywords.texture_cube,nt.keywords.texture_cube_array],pe.multisampled_texture_type=[nt.keywords.texture_multisampled_2d],pe.storage_texture_type=[nt.keywords.texture_storage_1d,nt.keywords.texture_storage_2d,nt.keywords.texture_storage_2d_array,nt.keywords.texture_storage_3d],pe.depth_texture_type=[nt.keywords.texture_depth_2d,nt.keywords.texture_depth_2d_array,nt.keywords.texture_depth_cube,nt.keywords.texture_depth_cube_array,nt.keywords.texture_depth_multisampled_2d],pe.texture_external_type=[nt.keywords.texture_external],pe.any_texture_type=[...nt.sampled_texture_type,...nt.multisampled_texture_type,...nt.storage_texture_type,...nt.depth_texture_type,...nt.texture_external_type],pe.texel_format=[nt.keywords.r8unorm,nt.keywords.r8snorm,nt.keywords.r8uint,nt.keywords.r8sint,nt.keywords.r16uint,nt.keywords.r16sint,nt.keywords.r16float,nt.keywords.rg8unorm,nt.keywords.rg8snorm,nt.keywords.rg8uint,nt.keywords.rg8sint,nt.keywords.r32uint,nt.keywords.r32sint,nt.keywords.r32float,nt.keywords.rg16uint,nt.keywords.rg16sint,nt.keywords.rg16float,nt.keywords.rgba8unorm,nt.keywords.rgba8unorm_srgb,nt.keywords.rgba8snorm,nt.keywords.rgba8uint,nt.keywords.rgba8sint,nt.keywords.bgra8unorm,nt.keywords.bgra8unorm_srgb,nt.keywords.rgb10a2unorm,nt.keywords.rg11b10float,nt.keywords.rg32uint,nt.keywords.rg32sint,nt.keywords.rg32float,nt.keywords.rgba16uint,nt.keywords.rgba16sint,nt.keywords.rgba16float,nt.keywords.rgba32uint,nt.keywords.rgba32sint,nt.keywords.rgba32float],pe.const_literal=[nt.tokens.int_literal,nt.tokens.uint_literal,nt.tokens.decimal_float_literal,nt.tokens.hex_float_literal,nt.keywords.true,nt.keywords.false],pe.literal_or_ident=[nt.tokens.ident,nt.tokens.int_literal,nt.tokens.uint_literal,nt.tokens.decimal_float_literal,nt.tokens.hex_float_literal,nt.tokens.name],pe.element_count_expression=[nt.tokens.int_literal,nt.tokens.uint_literal,nt.tokens.ident],pe.template_types=[nt.keywords.vec2,nt.keywords.vec3,nt.keywords.vec4,nt.keywords.mat2x2,nt.keywords.mat2x3,nt.keywords.mat2x4,nt.keywords.mat3x2,nt.keywords.mat3x3,nt.keywords.mat3x4,nt.keywords.mat4x2,nt.keywords.mat4x3,nt.keywords.mat4x4,nt.keywords.atomic,nt.keywords.bitcast,...nt.any_texture_type],pe.attribute_name=[nt.tokens.ident,nt.keywords.block,nt.keywords.diagnostic],pe.assignment_operators=[nt.tokens.equal,nt.tokens.plus_equal,nt.tokens.minus_equal,nt.tokens.times_equal,nt.tokens.division_equal,nt.tokens.modulo_equal,nt.tokens.and_equal,nt.tokens.or_equal,nt.tokens.xor_equal,nt.tokens.shift_right_equal,nt.tokens.shift_left_equal],pe.increment_operators=[nt.tokens.plus_plus,nt.tokens.minus_minus];class ag{constructor(e,t,r,s,u){this.type=e,this.lexeme=t,this.line=r,this.start=s,this.end=u}toString(){return this.lexeme}isTemplateType(){return pe.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==pe.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class UM{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ag(pe.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let f=1;for(;f>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),f--,f==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),f++)}return!0}}const t=pe.simpleTokens[e];if(t)return this._addToken(t),!0;let r=pe.none;const s=this._isAlpha(e),u=e==="_";if(this._isAlphaNumeric(e)){let f=this._peekAhead();for(;this._isAlphaNumeric(f);)e+=this._advance(),f=this._peekAhead()}if(s){const f=pe.keywords[e];if(f)return this._addToken(f),!0}if(s||u)return this._addToken(pe.tokens.ident),!0;for(;;){let f=this._findType(e);const m=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(m=="=")return this._current++,e+=m,this._addToken(pe.tokens.minus_equal),!0;if(m=="-")return this._current++,e+=m,this._addToken(pe.tokens.minus_minus),!0;const o=this._tokens.length-1;if((pe.literal_or_ident.indexOf(this._tokens[o].type)!=-1||this._tokens[o].type==pe.tokens.paren_right)&&m!=">")return this._addToken(f),!0}if(e==">"&&(m==">"||m=="=")){let o=!1,T=this._tokens.length-1;for(let C=0;C<5&&T>=0&&pe.assignment_operators.indexOf(this._tokens[T].type)===-1;++C,--T)if(this._tokens[T].type===pe.tokens.less_than){T>0&&this._tokens[T-1].isArrayOrTemplateType()&&(o=!0);break}if(o)return this._addToken(f),!0}if(f===pe.none){let o=e,T=0;const C=2;for(let R=0;R<C;++R)if(o+=this._peekAhead(R),f=this._findType(o),f!==pe.none){T=R;break}if(f===pe.none)return r!==pe.none&&(this._current--,this._addToken(r),!0);e=o,this._current+=T+1}if(r=f,this._isAtEnd())break;e+=this._advance()}return r!==pe.none&&(this._addToken(r),!0)}_findType(e){for(const r in pe.regexTokens){const s=pe.regexTokens[r];if(this._match(e,s.rule))return s}return pe.literalTokens[e]||pe.none}_match(e,t){const r=t.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new ag(e,t,this._line,this._start,this._current))}}function Yt(n){return Array.isArray(n)||(n==null?void 0:n.buffer)instanceof ArrayBuffer}const N7=new Float32Array(1),VM=new Uint32Array(N7.buffer),jM=new Uint32Array(N7.buffer),B7=new Int32Array(1),$M=new Float32Array(B7.buffer),WM=new Uint32Array(B7.buffer),z7=new Uint32Array(1),HM=new Float32Array(z7.buffer),XM=new Int32Array(z7.buffer);function lg(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return N7[0]=n,VM[0];if(t==="u32")return N7[0]=n,jM[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return B7[0]=n,$M[0];if(t==="u32")return B7[0]=n,WM[0]}else if(e==="u32"){if(t==="f32")return z7[0]=n,HM[0];if(t==="i32"||t==="x32")return z7[0]=n,XM[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class ZM{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class U8{constructor(e,t){this.align=e,this.size=t}}class x1{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new MM,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof I2&&this._functions.set(t.name,new ZM(t));for(const t of e)if(t instanceof mc){const r=this.getTypeInfo(t,null);r instanceof _3&&this.structs.push(r)}for(const t of e)if(t instanceof uf)this.aliases.push(this._getAliasInfo(t));else if(t instanceof lf){const r=t,s=this._getAttributeNum(r.attributes,"id",0),u=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new CM(r.name,u,r.attributes,s))}else if(this._isUniformVar(t)){const r=t,s=this._getAttributeNum(r.attributes,"group",0),u=this._getAttributeNum(r.attributes,"binding",0),f=this.getTypeInfo(r.type,r.attributes),m=new z8(r.name,f,s,u,r.attributes,d3.Uniform,r.access);m.access||(m.access="read"),this.uniforms.push(m)}else if(this._isStorageVar(t)){const r=t,s=this._getAttributeNum(r.attributes,"group",0),u=this._getAttributeNum(r.attributes,"binding",0),f=this.getTypeInfo(r.type,r.attributes),m=this._isStorageTexture(f),o=new z8(r.name,f,s,u,r.attributes,m?d3.StorageTexture:d3.Storage,r.access);o.access||(o.access="read"),this.storage.push(o)}else if(this._isTextureVar(t)){const r=t,s=this._getAttributeNum(r.attributes,"group",0),u=this._getAttributeNum(r.attributes,"binding",0),f=this.getTypeInfo(r.type,r.attributes),m=this._isStorageTexture(f),o=new z8(r.name,f,s,u,r.attributes,m?d3.StorageTexture:d3.Texture,r.access);o.access||(o.access="read"),m?this.storage.push(o):this.textures.push(o)}else if(this._isSamplerVar(t)){const r=t,s=this._getAttributeNum(r.attributes,"group",0),u=this._getAttributeNum(r.attributes,"binding",0),f=this.getTypeInfo(r.type,r.attributes),m=new z8(r.name,f,s,u,r.attributes,d3.Sampler,r.access);this.samplers.push(m)}for(const t of e)if(t instanceof I2){const r=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),u=this._getAttribute(t,"compute"),f=r||s||u,m=new IM(t.name,f==null?void 0:f.name,t.attributes);m.attributes=t.attributes,m.startLine=t.startLine,m.endLine=t.endLine,this.functions.push(m),this._functions.get(t.name).info=m,f&&(this._functions.get(t.name).inUse=!0,m.inUse=!0,m.resources=this._findResources(t,!!f),m.inputs=this._getInputs(t.args),m.outputs=this._getOutputs(t.returnType),this.entry[f.name].push(m)),m.arguments=t.args.map(o=>new PM(o.name,this.getTypeInfo(o.type,o.attributes),o.attributes)),m.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(r=>{var s,u,f;if(r instanceof Uv){if(r.value)if(Yt(r.value))for(const m of r.value)for(const o of this.overrides)m===o.name&&((s=t.info)===null||s===void 0||s.overrides.push(o));else for(const m of this.overrides)r.value===m.name&&((u=t.info)===null||u===void 0||u.overrides.push(m))}else if(r instanceof ma)for(const m of this.overrides)r.name===m.name&&((f=t.info)===null||f===void 0||f.overrides.push(m))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(const s of e.calls){const u=(r=this._functions.get(s.name))===null||r===void 0?void 0:r.info;u&&t.add(u)}}findResource(e,t,r){if(r){for(const s of this.entry.compute)if(s.name===r){for(const u of s.resources)if(u.group==e&&u.binding==t)return u}for(const s of this.entry.vertex)if(s.name===r){for(const u of s.resources)if(u.group==e&&u.binding==t)return u}for(const s of this.entry.fragment)if(s.name===r){for(const u of s.resources)if(u.group==e&&u.binding==t)return u}}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const r=[],s=this,u=[];return e.search(f=>{if(f instanceof L7)u.push({});else if(f instanceof F7)u.pop();else if(f instanceof yc){const m=f;t&&m.type!==null&&this._markStructsFromAST(m.type),u.length>0&&(u[u.length-1][m.name]=m)}else if(f instanceof y1){const m=f;t&&m.type!==null&&this._markStructsFromAST(m.type)}else if(f instanceof v2){const m=f;t&&m.type!==null&&this._markStructsFromAST(m.type),u.length>0&&(u[u.length-1][m.name]=m)}else if(f instanceof ma){const m=f;if(u.length>0&&u[u.length-1][m.name])return;const o=s._findResource(m.name);o&&r.push(o)}else if(f instanceof hf){const m=f,o=s._functions.get(m.name);o&&(t&&(o.inUse=!0),e.calls.add(o.node),o.resources===null&&(o.resources=s._findResources(o.node,t)),r.push(...o.resources))}else if(f instanceof cf){const m=f,o=s._functions.get(m.name);o&&(t&&(o.inUse=!0),e.calls.add(o.node),o.resources===null&&(o.resources=s._findResources(o.node,t)),r.push(...o.resources))}}),[...new Map(r.map(f=>[f.name,f])).values()]}getBindGroups(){const e=[];function t(r,s){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),s>=e[r].length&&(e[r].length=s+1)}for(const r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof mc)this._getStructOutputs(e,t);else{const r=this._getOutputInfo(e);r!==null&&t.push(r)}return t}_getStructOutputs(e,t){for(const r of e.members)if(r.type instanceof mc)this._getStructOutputs(r.type,t);else{const s=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(s!==null){const u=this.getTypeInfo(r.type,r.type.attributes),f=this._parseInt(s.value),m=new ng(r.name,u,s.name,f);t.push(m)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new ng("",r,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const r of e)if(r.type instanceof mc)this._getStructInputs(r.type,t);else{const s=this._getInputInfo(r);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const r of e.members)if(r.type instanceof mc)this._getStructInputs(r.type,t);else{const s=this._getInputInfo(r);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),u=this._parseInt(t.value),f=new AM(e.name,s,t.name,u);return r!==null&&(f.interpolation=this._parseString(r.value)),f}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new SM(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof i7){const s=e.type?this.getTypeInfo(e.type,e.attributes):null,u=new rh(e.name,s,t);return this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof x2){const s=e,u=s.format?this.getTypeInfo(s.format,s.attributes):null,f=new E3(s.name,t);return f.format=u,f.count=s.count,this._types.set(e,f),this._updateTypeInfo(f),f}if(e instanceof mc){const s=e,u=new _3(s.name,t);u.startLine=s.startLine,u.endLine=s.endLine;for(const f of s.members){const m=this.getTypeInfo(f.type,f.attributes);u.members.push(new tg(f.name,m,f.attributes))}return this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof c2){const s=e,u=s.format instanceof At,f=s.format?u?this.getTypeInfo(s.format,null):new Va(s.format,null):null,m=new B0(s.name,f,t,s.access);return this._types.set(e,m),this._updateTypeInfo(m),m}if(e instanceof Je){const s=e,u=s.format?this.getTypeInfo(s.format,null):null,f=new B0(s.name,u,t,s.access);return this._types.set(e,f),this._updateTypeInfo(f),f}const r=new Va(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,s;const u=this._getTypeSize(e);if(e.size=(t=u==null?void 0:u.size)!==null&&t!==void 0?t:0,e instanceof E3&&e.format){const f=this._getTypeSize(e.format);e.stride=Math.max((r=f==null?void 0:f.size)!==null&&r!==void 0?r:0,(s=f==null?void 0:f.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof rh&&this._updateTypeInfo(e.format),e instanceof _3&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let r=0,s=0,u=0,f=0;for(let m=0,o=e.members.length;m<o;++m){const T=e.members[m],C=this._getTypeSize(T);if(!C)continue;(t=this._getAlias(T.type.name))!==null&&t!==void 0||T.type;const R=C.align,O=C.size;r=this._roundUp(R,r+s),s=O,u=r,f=Math.max(f,R),T.offset=r,T.size=O,this._updateTypeInfo(T.type)}e.size=this._roundUp(f,u+s),e.align=f}_getTypeSize(e){var t,r;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),u=this._getAttributeNum(e.attributes,"align",0);if(e instanceof tg&&(e=e.type),e instanceof Va){const f=this._getAlias(e.name);f!==null&&(e=f)}{const f=x1._typeInfo[e.name];if(f!==void 0){const m=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new U8(Math.max(u,f.align/m),Math.max(s,f.size/m))}}{const f=x1._typeInfo[e.name.substring(0,e.name.length-1)];if(f){const m=e.name[e.name.length-1]==="h"?2:1;return new U8(Math.max(u,f.align/m),Math.max(s,f.size/m))}}if(e instanceof E3){let f=e,m=8,o=8;const T=this._getTypeSize(f.format);return T!==null&&(o=T.size,m=T.align),o=f.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(m,o)),s&&(o=s),new U8(Math.max(u,m),Math.max(s,o))}if(e instanceof _3){let f=0,m=0,o=0,T=0,C=0;for(const R of e.members){const O=this._getTypeSize(R.type);O!==null&&(f=Math.max(O.align,f),o=this._roundUp(O.align,o+T),T=O.size,C=o)}return m=this._roundUp(f,C+T),new U8(Math.max(u,f),Math.max(s,m))}return null}_isUniformVar(e){return e instanceof yc&&e.storage=="uniform"}_isStorageVar(e){return e instanceof yc&&e.storage=="storage"}_isTextureVar(e){return e instanceof yc&&e.type!==null&&x1._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof yc&&e.type!==null&&x1._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const r=e;if(!r||!r.attributes)return null;const s=r.attributes;for(let u of s)if(u.name==t)return u;return null}_getAttributeNum(e,t,r){if(e===null)return r;for(let s of e)if(s.name==t){let u=s!==null&&s.value!==null?s.value:r;return u instanceof Array&&(u=u[0]),typeof u=="number"?u:typeof u=="string"?parseInt(u):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}}x1._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},x1._textureTypes=pe.any_texture_type.map(n=>n.name),x1._samplerTypes=pe.sampler_type.map(n=>n.name);let ff=0;class df{constructor(e,t,r){this.id=ff++,this.name=e,this.value=t,this.node=r}clone(){return new df(this.name,this.value,this.node)}}class pf{constructor(e){this.id=ff++,this.name=e.name,this.node=e}clone(){return new pf(this.node)}}class mf{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=ff++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new df(e,t,r??null))}setVariable(e,t,r){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;const r=this.getVariable(e);return(t=r==null?void 0:r.value)!==null&&t!==void 0?t:null}clone(){return new mf(this)}}class qM{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class GM{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const r=this.exec.evalExpression(e.args[0],t);let s=!0;if(r instanceof Te)return r.data.forEach(u=>{u||(s=!1)}),new Ze(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te){const s=r.data.some(u=>u);return new Ze(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof Ze))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof $i&&(r=r.right);const s=this.exec.evalExpression(r,t);if(s instanceof Ti&&s.typeInfo.size===0){const u=s.typeInfo,f=s.buffer.byteLength/u.stride;return new Ze(f,this.getTypeInfo("u32"))}return new Ze(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.abs(u)),r.typeInfo);const s=r;return new Ze(Math.abs(s.value),s.typeInfo)}Acos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.acos(u)),r.typeInfo);const s=r;return new Ze(Math.acos(s.value),r.typeInfo)}Acosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.acosh(u)),r.typeInfo);const s=r;return new Ze(Math.acosh(s.value),r.typeInfo)}Asin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.asin(u)),r.typeInfo);const s=r;return new Ze(Math.asin(s.value),r.typeInfo)}Asinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.asinh(u)),r.typeInfo);const s=r;return new Ze(Math.asinh(s.value),r.typeInfo)}Atan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.atan(u)),r.typeInfo);const s=r;return new Ze(Math.atan(s.value),r.typeInfo)}Atanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.atanh(u)),r.typeInfo);const s=r;return new Ze(Math.atanh(s.value),r.typeInfo)}Atan2(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof Te&&s instanceof Te)return new Te(r.data.map((m,o)=>Math.atan2(m,s.data[o])),r.typeInfo);const u=r,f=s;return new Ze(Math.atan2(u.value,f.value),r.typeInfo)}Ceil(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.ceil(u)),r.typeInfo);const s=r;return new Ze(Math.ceil(s.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),u=this.exec.evalExpression(e.args[2],t);if(r instanceof Te&&s instanceof Te&&u instanceof Te)return new Te(r.data.map((T,C)=>this._clamp(T,s.data[C],u.data[C])),r.typeInfo);const f=r,m=s,o=u;return new Ze(this._clamp(f.value,m.value,o.value),r.typeInfo)}Cos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.cos(u)),r.typeInfo);const s=r;return new Ze(Math.cos(s.value),r.typeInfo)}Cosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.cosh(u)),r.typeInfo);const s=r;return new Ze(Math.cos(s.value),r.typeInfo)}CountLeadingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.clz32(u)),r.typeInfo);const s=r;return new Ze(Math.clz32(s.value),r.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>this._countOneBits(u)),r.typeInfo);const s=r;return new Ze(this._countOneBits(s.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>this._countTrailingZeros(u)),r.typeInfo);const s=r;return new Ze(this._countTrailingZeros(s.value),r.typeInfo)}Cross(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof Te&&s instanceof Te){if(r.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const u=r.data,f=s.data;return new Te([u[1]*f[2]-f[1]*u[2],u[2]*f[0]-f[2]*u[0],u[0]*f[1]-f[0]*u[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const r=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return r instanceof Te?new Te(r.data.map(u=>u*s),r.typeInfo):new Ze(r.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Cn){const s=r.data,u=r.typeInfo.getTypeName(),f=u.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(u==="mat2x2"||u==="mat2x2f"||u==="mat2x2h")return new Ze(s[0]*s[3]-s[1]*s[2],f);if(u==="mat2x3"||u==="mat2x3f"||u==="mat2x3h")return new Ze(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),f);if(u==="mat2x4"||u==="mat2x4f"||u==="mat2x4h")console.error(`TODO: Determinant for ${u}`);else if(u==="mat3x2"||u==="mat3x2f"||u==="mat3x2h")console.error(`TODO: Determinant for ${u}`);else{if(u==="mat3x3"||u==="mat3x3f"||u==="mat3x3h")return new Ze(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),f);u==="mat3x4"||u==="mat3x4f"||u==="mat3x4h"||u==="mat4x2"||u==="mat4x2f"||u==="mat4x2h"||u==="mat4x3"||u==="mat4x3f"||u==="mat4x3h"?console.error(`TODO: Determinant for ${u}`):u!=="mat4x4"&&u!=="mat4x4f"&&u!=="mat4x4h"||console.error(`TODO: Determinant for ${u}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof Te&&s instanceof Te){let m=0;for(let o=0;o<r.data.length;++o)m+=(r.data[o]-s.data[o])*(r.data[o]-s.data[o]);return new Ze(Math.sqrt(m),this.getTypeInfo("f32"))}const u=r,f=s;return new Ze(Math.abs(u.value-f.value),r.typeInfo)}_dot(e,t){let r=0;for(let s=0;s<e.length;++s)r+=t[s]*e[s];return r}Dot(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return r instanceof Te&&s instanceof Te?new Ze(this._dot(r.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.exp(u)),r.typeInfo);const s=r;return new Ze(Math.exp(s.value),r.typeInfo)}Exp2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.pow(2,u)),r.typeInfo);const s=r;return new Ze(Math.pow(2,s.value),r.typeInfo)}ExtractBits(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),u=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(u.typeInfo.name!=="u32"&&u.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const f=s.value,m=u.value;if(r instanceof Te)return new Te(r.data.map(T=>T>>f&(1<<m)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const o=r.value;return new Ze(o>>f&(1<<m)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),u=this.exec.evalExpression(e.args[2],t);if(r instanceof Te&&s instanceof Te&&u instanceof Te){const f=this._dot(s.data,u.data);return new Te(f<0?Array.from(r.data):r.data.map(m=>-m),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>this._firstLeadingBit(u)),r.typeInfo);const s=r;return new Ze(this._firstLeadingBit(s.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>this._firstTrailingBit(u)),r.typeInfo);const s=r;return new Ze(this._firstTrailingBit(s.value),r.typeInfo)}Floor(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.floor(u)),r.typeInfo);const s=r;return new Ze(Math.floor(s.value),r.typeInfo)}Fma(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),u=this.exec.evalExpression(e.args[2],t);if(r instanceof Te&&s instanceof Te&&u instanceof Te)return r.data.length!==s.data.length||r.data.length!==u.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Te(r.data.map((T,C)=>T*s.data[C]+u.data[C]),r.typeInfo);const f=r,m=s,o=u;return new Ze(f.value*m.value+o.value,f.typeInfo)}Fract(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>u-Math.floor(u)),r.typeInfo);const s=r;return new Ze(s.value-Math.floor(s.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),u=this.exec.evalExpression(e.args[2],t),f=this.exec.evalExpression(e.args[3],t);if(u.typeInfo.name!=="u32"&&u.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const m=u.value,o=(1<<f.value)-1<<m,T=~o;if(r instanceof Te&&s instanceof Te)return new Te(r.data.map((O,U)=>O&T|s.data[U]<<m&o),r.typeInfo);const C=r.value,R=s.value;return new Ze(C&T|R<<m&o,r.typeInfo)}InverseSqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>1/Math.sqrt(u)),r.typeInfo);const s=r;return new Ze(1/Math.sqrt(s.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te){let u=0;return r.data.forEach(f=>{u+=f*f}),new Ze(Math.sqrt(u),this.getTypeInfo("f32"))}const s=r;return new Ze(Math.abs(s.value),r.typeInfo)}Log(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.log(u)),r.typeInfo);const s=r;return new Ze(Math.log(s.value),r.typeInfo)}Log2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.log2(u)),r.typeInfo);const s=r;return new Ze(Math.log2(s.value),r.typeInfo)}Max(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof Te&&s instanceof Te)return new Te(r.data.map((m,o)=>Math.max(m,s.data[o])),r.typeInfo);const u=r,f=s;return new Ze(Math.max(u.value,f.value),r.typeInfo)}Min(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof Te&&s instanceof Te)return new Te(r.data.map((m,o)=>Math.min(m,s.data[o])),r.typeInfo);const u=r,f=s;return new Ze(Math.min(u.value,f.value),r.typeInfo)}Mix(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),u=this.exec.evalExpression(e.args[2],t);if(r instanceof Te&&s instanceof Te&&u instanceof Te)return new Te(r.data.map((o,T)=>r.data[T]*(1-u.data[T])+s.data[T]*u.data[T]),r.typeInfo);const f=s,m=u;return new Ze(r.value*(1-m.value)+f.value*m.value,r.typeInfo)}Modf(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof Te&&s instanceof Te)return new Te(r.data.map((f,m)=>f%s.data[m]),r.typeInfo);const u=s;return new Ze(r.value%u.value,r.typeInfo)}Normalize(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te){const s=this.Length(e,t).value;return new Te(r.data.map(u=>u/s),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof Te&&s instanceof Te)return new Te(r.data.map((m,o)=>Math.pow(m,s.data[o])),r.typeInfo);const u=r,f=s;return new Ze(Math.pow(u.value,f.value),r.typeInfo)}QuantizeToF16(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof Te?new Te(r.data.map(s=>s),r.typeInfo):new Ze(r.value,r.typeInfo)}Radians(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof Te?new Te(r.data.map(s=>s*Math.PI/180),r.typeInfo):new Ze(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof Te&&s instanceof Te){const u=this._dot(r.data,s.data);return new Te(r.data.map((f,m)=>f-2*u*s.data[m]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),u=this.exec.evalExpression(e.args[2],t);if(r instanceof Te&&s instanceof Te&&u instanceof Ze){const f=this._dot(s.data,r.data);return new Te(r.data.map((m,o)=>{const T=1-u.value*u.value*(1-f*f);if(T<0)return 0;const C=Math.sqrt(T);return u.value*m-(u.value*f+C)*s.data[o]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.round(u)),r.typeInfo);const s=r;return new Ze(Math.round(s.value),r.typeInfo)}Saturate(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.min(Math.max(u,0),1)),r.typeInfo);const s=r;return new Ze(Math.min(Math.max(s.value,0),1),r.typeInfo)}Sign(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.sign(u)),r.typeInfo);const s=r;return new Ze(Math.sign(s.value),r.typeInfo)}Sin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.sin(u)),r.typeInfo);const s=r;return new Ze(Math.sin(s.value),r.typeInfo)}Sinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.sinh(u)),r.typeInfo);const s=r;return new Ze(Math.sinh(s.value),r.typeInfo)}_smoothstep(e,t,r){const s=Math.min(Math.max((r-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),u=this.exec.evalExpression(e.args[2],t);if(u instanceof Te&&r instanceof Te&&s instanceof Te)return new Te(u.data.map((T,C)=>this._smoothstep(r.data[C],s.data[C],T)),u.typeInfo);const f=r,m=s,o=u;return new Ze(this._smoothstep(f.value,m.value,o.value),u.typeInfo)}Sqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.sqrt(u)),r.typeInfo);const s=r;return new Ze(Math.sqrt(s.value),r.typeInfo)}Step(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof Te&&r instanceof Te)return new Te(s.data.map((f,m)=>f<r.data[m]?0:1),s.typeInfo);const u=r;return new Ze(s.value<u.value?0:1,u.typeInfo)}Tan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.tan(u)),r.typeInfo);const s=r;return new Ze(Math.tan(s.value),r.typeInfo)}Tanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.tanh(u)),r.typeInfo);const s=r;return new Ze(Math.tanh(s.value),r.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof Cn))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const u=r.data;return new Cn([u[0],u[2],u[1],u[3]],s)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const u=r.data;return new Cn([u[0],u[3],u[6],u[1],u[4],u[7]],s)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const u=r.data;return new Cn([u[0],u[4],u[8],u[12],u[1],u[5],u[9],u[13]],s)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const u=r.data;return new Cn([u[0],u[3],u[1],u[4],u[2],u[5]],s)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const u=r.data;return new Cn([u[0],u[3],u[6],u[1],u[4],u[7],u[2],u[5],u[8]],s)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const u=r.data;return new Cn([u[0],u[4],u[8],u[12],u[1],u[5],u[9],u[13],u[2],u[6],u[10],u[14]],s)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const u=r.data;return new Cn([u[0],u[4],u[1],u[5],u[2],u[6]],s)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const u=r.data;return new Cn([u[0],u[4],u[8],u[1],u[5],u[9],u[2],u[6],u[10]],s)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const u=r.data;return new Cn([u[0],u[4],u[8],u[12],u[1],u[5],u[9],u[13],u[2],u[6],u[10],u[14],u[3],u[7],u[11],u[15]],s)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Te)return new Te(r.data.map(u=>Math.trunc(u)),r.typeInfo);const s=r;return new Ze(Math.trunc(s.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const r=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(r instanceof ma){const u=r.name,f=t.getVariableValue(u);if(f instanceof gc){if(s<0||s>=f.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const m=f.getMipLevelSize(s),o=f.dimension;return o==="1d"?new Ze(m[0],this.getTypeInfo("u32")):o==="3d"?new Te(m,this.getTypeInfo("vec3u")):o==="2d"?new Te(m.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${o} not found. Line ${e.line}`),null)}return console.error(`Texture ${u} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const r=e.args[0],s=this.exec.evalExpression(e.args[1],t),u=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof Te)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof ma){const f=r.name,m=t.getVariableValue(f);if(m instanceof gc){const o=Math.floor(s.data[0]),T=Math.floor(s.data[1]);if(o<0||o>=m.width||T<0||T>=m.height)return console.error(`Texture ${f} out of bounds. Line ${e.line}`),null;const C=m.getPixel(o,T,0,u);return C===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Te(C,this.getTypeInfo("vec4f"))}return console.error(`Texture ${f} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const r=e.args[0];if(r instanceof ma){const s=r.name,u=t.getVariableValue(s);return u instanceof gc?new Ze(u.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const r=e.args[0];if(r instanceof ma){const s=r.name,u=t.getVariableValue(s);return u instanceof gc?new Ze(u.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const r=e.args[0];if(r instanceof ma){const s=r.name,u=t.getVariableValue(s);return u instanceof gc?new Ze(u.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const r=e.args[0],s=this.exec.evalExpression(e.args[1],t),u=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,f=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(f.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof Te)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof ma){const m=r.name,o=t.getVariableValue(m);if(o instanceof gc){const T=o.getMipLevelSize(0),C=Math.floor(s.data[0]),R=Math.floor(s.data[1]);return C<0||C>=T[0]||R<0||R>=T[1]?(console.error(`Texture ${m} out of bounds. Line ${e.line}`),null):(o.setPixel(C,R,0,u,Array.from(f)),null)}return console.error(`Texture ${m} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof $i&&(r=r.right);const s=this.exec.getVariableName(r,t);return t.getVariable(s).value.getSubData(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof $i&&(r=r.right);const s=this.exec.getVariableName(r,t),u=t.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,t),o=u.value.getSubData(this.exec,r.postfix,t);return o instanceof Ze&&m instanceof Ze&&(o.value=m.value),u.value instanceof Ti&&u.value.setDataValue(this.exec,o,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof $i&&(r=r.right);const s=this.exec.getVariableName(r,t),u=t.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,t),o=u.value.getSubData(this.exec,r.postfix,t),T=new Ze(o.value,o.typeInfo);return o instanceof Ze&&m instanceof Ze&&(o.value+=m.value),u.value instanceof Ti&&u.value.setDataValue(this.exec,o,r.postfix,t),T}AtomicSub(e,t){let r=e.args[0];r instanceof $i&&(r=r.right);const s=this.exec.getVariableName(r,t),u=t.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,t),o=u.value.getSubData(this.exec,r.postfix,t),T=new Ze(o.value,o.typeInfo);return o instanceof Ze&&m instanceof Ze&&(o.value-=m.value),u.value instanceof Ti&&u.value.setDataValue(this.exec,o,r.postfix,t),T}AtomicMax(e,t){let r=e.args[0];r instanceof $i&&(r=r.right);const s=this.exec.getVariableName(r,t),u=t.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,t),o=u.value.getSubData(this.exec,r.postfix,t),T=new Ze(o.value,o.typeInfo);return o instanceof Ze&&m instanceof Ze&&(o.value=Math.max(o.value,m.value)),u.value instanceof Ti&&u.value.setDataValue(this.exec,o,r.postfix,t),T}AtomicMin(e,t){let r=e.args[0];r instanceof $i&&(r=r.right);const s=this.exec.getVariableName(r,t),u=t.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,t),o=u.value.getSubData(this.exec,r.postfix,t),T=new Ze(o.value,o.typeInfo);return o instanceof Ze&&m instanceof Ze&&(o.value=Math.min(o.value,m.value)),u.value instanceof Ti&&u.value.setDataValue(this.exec,o,r.postfix,t),T}AtomicAnd(e,t){let r=e.args[0];r instanceof $i&&(r=r.right);const s=this.exec.getVariableName(r,t),u=t.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,t),o=u.value.getSubData(this.exec,r.postfix,t),T=new Ze(o.value,o.typeInfo);return o instanceof Ze&&m instanceof Ze&&(o.value=o.value&m.value),u.value instanceof Ti&&u.value.setDataValue(this.exec,o,r.postfix,t),T}AtomicOr(e,t){let r=e.args[0];r instanceof $i&&(r=r.right);const s=this.exec.getVariableName(r,t),u=t.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,t),o=u.value.getSubData(this.exec,r.postfix,t),T=new Ze(o.value,o.typeInfo);return o instanceof Ze&&m instanceof Ze&&(o.value=o.value|m.value),u.value instanceof Ti&&u.value.setDataValue(this.exec,o,r.postfix,t),T}AtomicXor(e,t){let r=e.args[0];r instanceof $i&&(r=r.right);const s=this.exec.getVariableName(r,t),u=t.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,t),o=u.value.getSubData(this.exec,r.postfix,t),T=new Ze(o.value,o.typeInfo);return o instanceof Ze&&m instanceof Ze&&(o.value=o.value^m.value),u.value instanceof Ti&&u.value.setDataValue(this.exec,o,r.postfix,t),T}AtomicExchange(e,t){let r=e.args[0];r instanceof $i&&(r=r.right);const s=this.exec.getVariableName(r,t),u=t.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,t),o=u.value.getSubData(this.exec,r.postfix,t),T=new Ze(o.value,o.typeInfo);return o instanceof Ze&&m instanceof Ze&&(o.value=m.value),u.value instanceof Ti&&u.value.setDataValue(this.exec,o,r.postfix,t),T}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const K5={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},vo={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Qs extends qM{constructor(e,t){var r;super(),this.ast=e??[],this.reflection=new x1,this.reflection.updateAST(this.ast),this.context=(r=t==null?void 0:t.clone())!==null&&r!==void 0?r:new mf,this.builtins=new GM(this),this.typeInfo={bool:this.getTypeInfo(At.bool),i32:this.getTypeInfo(At.i32),u32:this.getTypeInfo(At.u32),f32:this.getTypeInfo(At.f32),f16:this.getTypeInfo(At.f16),vec2f:this.getTypeInfo(Je.vec2f),vec2u:this.getTypeInfo(Je.vec2u),vec2i:this.getTypeInfo(Je.vec2i),vec2h:this.getTypeInfo(Je.vec2h),vec3f:this.getTypeInfo(Je.vec3f),vec3u:this.getTypeInfo(Je.vec3u),vec3i:this.getTypeInfo(Je.vec3i),vec3h:this.getTypeInfo(Je.vec3h),vec4f:this.getTypeInfo(Je.vec4f),vec4u:this.getTypeInfo(Je.vec4u),vec4i:this.getTypeInfo(Je.vec4i),vec4h:this.getTypeInfo(Je.vec4h),mat2x2f:this.getTypeInfo(Je.mat2x2f),mat2x3f:this.getTypeInfo(Je.mat2x3f),mat2x4f:this.getTypeInfo(Je.mat2x4f),mat3x2f:this.getTypeInfo(Je.mat3x2f),mat3x3f:this.getTypeInfo(Je.mat3x3f),mat3x4f:this.getTypeInfo(Je.mat3x4f),mat4x2f:this.getTypeInfo(Je.mat4x2f),mat4x3f:this.getTypeInfo(Je.mat4x3f),mat4x4f:this.getTypeInfo(Je.mat4x4f)}}getVariableValue(e){var t,r;const s=(r=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&r!==void 0?r:null;if(s===null)return null;if(s instanceof Ze)return s.value;if(s instanceof Te||s instanceof Cn)return Array.from(s.data);if(s instanceof Ti&&s.typeInfo instanceof E3){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,s){const u=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,u),this._execStatements(this.ast,u);const f=u.getFunction(e);if(!f)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const m=t[0],o=t[1],T=t[2],C=this.getTypeInfo("vec3u");u.setVariable("@num_workgroups",new Te(t,C));for(const R in r)for(const O in r[R]){const U=r[R][O];u.variables.forEach(V=>{var Y;const ee=V.node;if(ee!=null&&ee.attributes){let le=null,Ee=null;for(const ue of ee.attributes)ue.name==="binding"?le=ue.value:ue.name==="group"&&(Ee=ue.value);if(O==le&&R==Ee)if(U.texture!==void 0&&U.descriptor!==void 0){const ue=new gc(U.texture,this.getTypeInfo(ee.type),U.descriptor,(Y=U.texture.view)!==null&&Y!==void 0?Y:null);V.value=ue}else U.uniform!==void 0?V.value=new Ti(U.uniform,this.getTypeInfo(ee.type)):V.value=new Ti(U,this.getTypeInfo(ee.type))}})}for(let R=0;R<T;++R)for(let O=0;O<o;++O)for(let U=0;U<m;++U)u.setVariable("@workgroup_id",new Te([U,O,R],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(f,[U,O,R],u)}execStatement(e,t){if(e instanceof Mv)return this.evalExpression(e.value,t);if(e instanceof kv){if(e.condition){const r=this.evalExpression(e.condition,t);if(!(r instanceof Ze))throw new Error("Invalid break-if condition");if(!r.value)return null}return Qs._breakObj}if(e instanceof Ov)return Qs._continueObj;if(e instanceof v2)this._let(e,t);else if(e instanceof yc)this._var(e,t);else if(e instanceof r7)this._const(e,t);else if(e instanceof I2)this._function(e,t);else{if(e instanceof Iv)return this._if(e,t);if(e instanceof Pv)return this._switch(e,t);if(e instanceof Ev)return this._for(e,t);if(e instanceof Tv)return this._while(e,t);if(e instanceof Cv)return this._loop(e,t);if(e instanceof ih){const r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof Av)this._assign(e,t);else if(e instanceof Sv)this._increment(e,t);else{if(e instanceof mc)return null;if(e instanceof lf){const r=e.name;t.getVariable(r)===null&&t.setVariable(r,new Ze(0,this.getTypeInfo("u32")))}else if(e instanceof cf)this._call(e,t);else{if(e instanceof Rv||e instanceof uf)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Cl?this._evalBinaryOp(e,t):e instanceof ss?this._evalLiteral(e,t):e instanceof ma?this._evalVariable(e,t):e instanceof hf?this._evalCall(e,t):e instanceof y1?this._evalCreate(e,t):e instanceof Dv?this._evalConst(e,t):e instanceof Lv?this._evalBitcast(e,t):e instanceof $i?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof At){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let r=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,t){for(const r in e){const s=e[r],u=this.reflection.getOverrideInfo(r);u!==null?(u.type===null&&(u.type=this.getTypeInfo("u32")),u.type.name==="u32"||u.type.name==="i32"||u.type.name==="f32"||u.type.name==="f16"?t.setVariable(r,new Ze(s,u.type)):u.type.name==="bool"?t.setVariable(r,new Ze(s?1:0,u.type)):u.type.name==="vec2"||u.type.name==="vec3"||u.type.name==="vec4"||u.type.name==="vec2f"||u.type.name==="vec3f"||u.type.name==="vec4f"||u.type.name==="vec2i"||u.type.name==="vec3i"||u.type.name==="vec4i"||u.type.name==="vec2u"||u.type.name==="vec3u"||u.type.name==="vec4u"||u.type.name==="vec2h"||u.type.name==="vec3h"||u.type.name==="vec4h"?t.setVariable(r,new Te(s,u.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){const s=[1,1,1];for(const C of e.node.attributes)if(C.name==="workgroup_size"){if(C.value.length>0){const R=r.getVariableValue(C.value[0]);s[0]=R instanceof Ze?R.value:parseInt(C.value[0])}if(C.value.length>1){const R=r.getVariableValue(C.value[1]);s[1]=R instanceof Ze?R.value:parseInt(C.value[1])}if(C.value.length>2){const R=r.getVariableValue(C.value[2]);s[2]=R instanceof Ze?R.value:parseInt(C.value[2])}}const u=this.getTypeInfo("vec3u"),f=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new Te(s,u));const m=s[0],o=s[1],T=s[2];for(let C=0,R=0;C<T;++C)for(let O=0;O<o;++O)for(let U=0;U<m;++U,++R){const V=[U,O,C],Y=[U+t[0]*s[0],O+t[1]*s[1],C+t[2]*s[2]];r.setVariable("@local_invocation_id",new Te(V,u)),r.setVariable("@global_invocation_id",new Te(Y,u)),r.setVariable("@local_invocation_index",new Ze(R,f)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(const r of e.node.args)for(const s of r.attributes)if(s.name==="builtin"){const u=`@${s.value}`,f=t.getVariable(u);f!==void 0&&t.variables.set(r.name,f)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof $i;)e=e.right;return e instanceof ma?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const r of e){if(r instanceof Array){const u=t.clone(),f=this._execStatements(r,u);if(f)return f;continue}const s=this.execStatement(r,t);if(s)return s}return null}_call(e,t){const r=t.clone();r.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let u=0;u<s.node.args.length;++u){const f=s.node.args[u],m=this.evalExpression(e.args[u],r);r.setVariable(f.name,m,f)}this._execStatements(s.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const r=this.getVariableName(e.variable,t),s=t.getVariable(r);s?e.operator==="++"?s.value instanceof Ze?s.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof Ze?s.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof ma){const r=this.getVariableName(e,t),s=t.getVariable(r);return s===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,t)}if(e instanceof $i){if(e.operator==="*"){const r=this._getVariableData(e.right,t);return r instanceof F4?r.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,t);return new F4(r)}}return null}_assign(e,t){let r=null,s="<var>",u=null;if(e.variable instanceof $i){const o=this._getVariableData(e.variable,t),T=this.evalExpression(e.value,t),C=e.operator;if(C==="="){if(o instanceof Ze||o instanceof Te||o instanceof Cn){if(T instanceof Ze||T instanceof Te||T instanceof Cn&&o.data.length===T.data.length)return void o.data.set(T.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(o instanceof Ti&&T instanceof Ti&&o.buffer.byteLength-o.offset>=T.buffer.byteLength-T.offset)return void(o.buffer.byteLength%4==0?new Uint32Array(o.buffer,o.offset,o.typeInfo.size/4).set(new Uint32Array(T.buffer,T.offset,T.typeInfo.size/4)):new Uint8Array(o.buffer,o.offset,o.typeInfo.size).set(new Uint8Array(T.buffer,T.offset,T.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(C==="+=")return o instanceof Ze||o instanceof Te||o instanceof Cn?T instanceof Ze||T instanceof Te||T instanceof Cn?void o.data.set(T.data.map((R,O)=>o.data[O]+R)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(C==="-=")return(o instanceof Ze||o instanceof Te||o instanceof Cn)&&(T instanceof Ze||T instanceof Te||T instanceof Cn)?void o.data.set(T.data.map((R,O)=>o.data[O]-R)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof $i){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,t);const o=t.getVariable(s);if(!(o&&o.value instanceof F4))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);r=o.value.reference;let T=e.variable.postfix;if(!T){let C=e.variable.right;for(;C instanceof $i;){if(C.postfix){T=C.postfix;break}C=C.right}}T&&(r=r.getSubData(this,T,t))}}else{u=e.variable.postfix,s=this.getVariableName(e.variable,t);const o=t.getVariable(s);if(o===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);r=o.value}if(r instanceof F4&&(r=r.reference),r===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const f=this.evalExpression(e.value,t),m=e.operator;if(m==="=")if(r instanceof Ti)r.setDataValue(this,f,u,t);else if(u){if(!(r instanceof Te||r instanceof Cn))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(u instanceof tu){const o=this.evalExpression(u.index,t).value;if(r instanceof Te){if(!(f instanceof Ze))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[o]=f.value}else{if(!(r instanceof Cn))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const T=this.evalExpression(u.index,t).value;if(T<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(f instanceof Te))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const C=r.typeInfo.getTypeName();if(C==="mat2x2"||C==="mat2x2f"||C==="mat2x2h"){if(!(T<2&&f.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[2*T]=f.data[0],r.data[2*T+1]=f.data[1]}else if(C==="mat2x3"||C==="mat2x3f"||C==="mat2x3h"){if(!(T<2&&f.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[3*T]=f.data[0],r.data[3*T+1]=f.data[1],r.data[3*T+2]=f.data[2]}else if(C==="mat2x4"||C==="mat2x4f"||C==="mat2x4h"){if(!(T<2&&f.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[4*T]=f.data[0],r.data[4*T+1]=f.data[1],r.data[4*T+2]=f.data[2],r.data[4*T+3]=f.data[3]}else if(C==="mat3x2"||C==="mat3x2f"||C==="mat3x2h"){if(!(T<3&&f.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[2*T]=f.data[0],r.data[2*T+1]=f.data[1]}else if(C==="mat3x3"||C==="mat3x3f"||C==="mat3x3h"){if(!(T<3&&f.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[3*T]=f.data[0],r.data[3*T+1]=f.data[1],r.data[3*T+2]=f.data[2]}else if(C==="mat3x4"||C==="mat3x4f"||C==="mat3x4h"){if(!(T<3&&f.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[4*T]=f.data[0],r.data[4*T+1]=f.data[1],r.data[4*T+2]=f.data[2],r.data[4*T+3]=f.data[3]}else if(C==="mat4x2"||C==="mat4x2f"||C==="mat4x2h"){if(!(T<4&&f.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[2*T]=f.data[0],r.data[2*T+1]=f.data[1]}else if(C==="mat4x3"||C==="mat4x3f"||C==="mat4x3h"){if(!(T<4&&f.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[3*T]=f.data[0],r.data[3*T+1]=f.data[1],r.data[3*T+2]=f.data[2]}else{if(C!=="mat4x4"&&C!=="mat4x4f"&&C!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(T<4&&f.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[4*T]=f.data[0],r.data[4*T+1]=f.data[1],r.data[4*T+2]=f.data[2],r.data[4*T+3]=f.data[3]}}}}}else if(u instanceof z0){const o=u.value;if(!(r instanceof Te))return void console.error(`Invalid assignment to ${o}. Variable ${s} is not a vector. Line ${e.line}`);if(f instanceof Ze){if(o.length>1)return void console.error(`Invalid assignment to ${o} for variable ${s}. Line ${e.line}`);if(o==="x")r.data[0]=f.value;else if(o==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${o} for variable ${s}. Line ${e.line}`);r.data[1]=f.value}else if(o==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${o} for variable ${s}. Line ${e.line}`);r.data[2]=f.value}else if(o==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${o} for variable ${s}. Line ${e.line}`);r.data[3]=f.value}}else{if(!(f instanceof Te))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(o.length!==f.data.length)return void console.error(`Invalid assignment to ${o} for variable ${s}. Line ${e.line}`);for(let T=0;T<o.length;++T){const C=o[T];if(C==="x"||C==="r")r.data[0]=f.data[T];else if(C==="y"||C==="g"){if(f.data.length<2)return void console.error(`Invalid assignment to ${C} for variable ${s}. Line ${e.line}`);r.data[1]=f.data[T]}else if(C==="z"||C==="b"){if(f.data.length<3)return void console.error(`Invalid assignment to ${C} for variable ${s}. Line ${e.line}`);r.data[2]=f.data[T]}else{if(C!=="w"&&C!=="a")return void console.error(`Invalid assignment to ${C} for variable ${s}. Line ${e.line}`);if(f.data.length<4)return void console.error(`Invalid assignment to ${C} for variable ${s}. Line ${e.line}`);r.data[3]=f.data[T]}}}}}else r instanceof Ze&&f instanceof Ze?r.value=f.value:r instanceof Te&&f instanceof Te||r instanceof Cn&&f instanceof Cn?r.data.set(f.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`);else{const o=r.getSubData(this,u,t);if(o instanceof Te&&f instanceof Ze){const T=o.data,C=f.value;if(m==="+=")for(let R=0;R<T.length;++R)T[R]+=C;else if(m==="-=")for(let R=0;R<T.length;++R)T[R]-=C;else if(m==="*=")for(let R=0;R<T.length;++R)T[R]*=C;else if(m==="/=")for(let R=0;R<T.length;++R)T[R]/=C;else if(m==="%=")for(let R=0;R<T.length;++R)T[R]%=C;else if(m==="&=")for(let R=0;R<T.length;++R)T[R]&=C;else if(m==="|=")for(let R=0;R<T.length;++R)T[R]|=C;else if(m==="^=")for(let R=0;R<T.length;++R)T[R]^=C;else if(m==="<<=")for(let R=0;R<T.length;++R)T[R]<<=C;else if(m===">>=")for(let R=0;R<T.length;++R)T[R]>>=C;else console.error(`Invalid operator ${m}. Line ${e.line}`)}else if(o instanceof Te&&f instanceof Te){const T=o.data,C=f.data;if(T.length!==C.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(m==="+=")for(let R=0;R<T.length;++R)T[R]+=C[R];else if(m==="-=")for(let R=0;R<T.length;++R)T[R]-=C[R];else if(m==="*=")for(let R=0;R<T.length;++R)T[R]*=C[R];else if(m==="/=")for(let R=0;R<T.length;++R)T[R]/=C[R];else if(m==="%=")for(let R=0;R<T.length;++R)T[R]%=C[R];else if(m==="&=")for(let R=0;R<T.length;++R)T[R]&=C[R];else if(m==="|=")for(let R=0;R<T.length;++R)T[R]|=C[R];else if(m==="^=")for(let R=0;R<T.length;++R)T[R]^=C[R];else if(m==="<<=")for(let R=0;R<T.length;++R)T[R]<<=C[R];else if(m===">>=")for(let R=0;R<T.length;++R)T[R]>>=C[R];else console.error(`Invalid operator ${m}. Line ${e.line}`)}else{if(!(o instanceof Ze&&f instanceof Ze))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);m==="+="?o.value+=f.value:m==="-="?o.value-=f.value:m==="*="?o.value*=f.value:m==="/="?o.value/=f.value:m==="%="?o.value%=f.value:m==="&="?o.value&=f.value:m==="|="?o.value|=f.value:m==="^="?o.value^=f.value:m==="<<="?o.value<<=f.value:m===">>="?o.value>>=f.value:console.error(`Invalid operator ${m}. Line ${e.line}`)}r instanceof Ti&&r.setDataValue(this,o,u,t)}}_function(e,t){const r=new pf(e);t.functions.set(e.name,r)}_const(e,t){let r=null;e.value!==null&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof $i||(r=r.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const u=new y1(e.type,[]);r=this._evalCreate(u,t)}}t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof $i||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof x2||e.type instanceof mc||e.type instanceof Je){const u=new y1(e.type,[]);r=this._evalCreate(u,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof Ze))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const u of e.cases)if(u instanceof Bv)for(const f of u.selectors){if(f instanceof s7){s=u;continue}const m=this.evalExpression(f,t);if(!(m instanceof Ze))return console.error(`Invalid case selector. Line ${e.line}`),null;if(m.value===r.value)return this._execStatements(u.body,t)}else u instanceof zv&&(s=u);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof Ze))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(const s of e.elseif){const u=this.evalExpression(s.condition,t);if(!(u instanceof Ze))return console.error(`Invalid if condition. Line ${e.line}`),null;if(u.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof Ze?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===Qs._breakObj)break;if(r!==null&&r!==Qs._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const r=this._execStatements(e.body,t);if(r===Qs._breakObj)break;if(r===Qs._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Qs._breakObj)break}else if(r!==null)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===Qs._breakObj)break;if(r!==Qs._continueObj&&r!==null)return r}return null}_evalBitcast(e,t){const r=this.evalExpression(e.value,t),s=e.type;if(r instanceof Ze){const u=lg(r.value,r.typeInfo.name,s.name);return new Ze(u,this.getTypeInfo(s))}if(r instanceof Te){const u=r.typeInfo.getTypeName();let f="";if(u.endsWith("f"))f="f32";else if(u.endsWith("i"))f="i32";else if(u.endsWith("u"))f="u32";else if(u.endsWith("b"))f="bool";else{if(!u.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;f="f16"}const m=s.getTypeName();let o="";if(m.endsWith("f"))o="f32";else if(m.endsWith("i"))o="i32";else if(m.endsWith("u"))o="u32";else if(m.endsWith("b"))o="bool";else{if(!m.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${e.line}`),null;o="f16"}const T=function(C,R,O){if(R===O)return C;const U=new Array(C.length);for(let V=0;V<C.length;V++)U[V]=lg(C[V],R,O);return U}(Array.from(r.data),f,o);return new Te(T,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var r;if(e instanceof y1){if(e.type===null)return sh.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const s=e instanceof y1?e.type.name:e.name,u=e instanceof y1?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(u===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(u.size===0)return null;const f=new Ti(new ArrayBuffer(u.size),u,0);if(u instanceof _3){if(e.args)for(let m=0;m<e.args.length;++m){const o=u.members[m],T=e.args[m],C=this.evalExpression(T,t);f.setData(this,C,o.type,o.offset,t)}}else if(u instanceof E3){let m=0;if(e.args)for(let o=0;o<e.args.length;++o){const T=e.args[o],C=this.evalExpression(T,t);u.format===null&&(((r=C.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?u.format=this.getTypeInfo("i32"):u.format=C.typeInfo),f.setData(this,C,u.format,m,t),m+=u.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof y1?f.getSubData(this,e.postfix,t):f}_evalLiteral(e,t){const r=this.getTypeInfo(e.type),s=r.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new Ze(e.scalarValue,r):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const r=t.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const s=Qs._priority.get(t.name);Qs._priority.get(e[r].name)<s&&(t=e[r])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const r=this.evalExpression(e.right,t);if(e.operator==="&")return new F4(r);if(e.operator==="*")return r instanceof F4?r.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=r instanceof Ze?r.value:r instanceof Te?Array.from(r.data):null;switch(e.operator){case"+":{if(Yt(s)){const m=s.map((o,T)=>+o);return new Te(m,r.typeInfo)}const u=s,f=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new Ze(+u,f)}case"-":{if(Yt(s)){const m=s.map((o,T)=>-o);return new Te(m,r.typeInfo)}const u=s,f=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new Ze(-u,f)}case"!":{if(Yt(s)){const m=s.map((o,T)=>o?0:1);return new Te(m,r.typeInfo)}const u=s,f=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new Ze(u?0:1,f)}case"~":{if(Yt(s)){const m=s.map((o,T)=>~o);return new Te(m,r.typeInfo)}const u=s,f=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new Ze(~u,f)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const r=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),u=r instanceof Ze?r.value:r instanceof Te||r instanceof Cn?Array.from(r.data):null,f=s instanceof Ze?s.value:s instanceof Te||s instanceof Cn?Array.from(s.data):null;switch(e.operator){case"+":{if(Yt(u)&&Yt(f)){const C=u,R=f;if(C.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=C.map((U,V)=>U+R[V]);return new Te(O,r.typeInfo)}if(Yt(u)){const C=f,R=u.map((O,U)=>O+C);return new Te(R,r.typeInfo)}if(Yt(f)){const C=u,R=f.map((O,U)=>C+O);return new Te(R,s.typeInfo)}const m=u,o=f,T=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new Ze(m+o,T)}case"-":{if(Yt(u)&&Yt(f)){const C=u,R=f;if(C.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=C.map((U,V)=>U-R[V]);return new Te(O,r.typeInfo)}if(Yt(u)){const C=f,R=u.map((O,U)=>O-C);return new Te(R,r.typeInfo)}if(Yt(f)){const C=u,R=f.map((O,U)=>C-O);return new Te(R,s.typeInfo)}const m=u,o=f,T=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new Ze(m-o,T)}case"*":{if(Yt(u)&&Yt(f)){const C=u,R=f;if(r instanceof Cn&&s instanceof Cn){const O=function(ee,le,Ee,ue){if(vo[le.name]===void 0||vo[ue.name]===void 0)return null;const _e=vo[le.name][0],Me=vo[le.name][1],Fe=vo[ue.name][0];if(_e!==vo[ue.name][1])return null;const yt=new Array(Fe*Me);for(let xt=0;xt<Me;xt++)for(let ht=0;ht<Fe;ht++){let kt=0;for(let Bt=0;Bt<_e;Bt++)kt+=ee[Bt*Me+xt]*Ee[ht*_e+Bt];yt[xt*Fe+ht]=kt}return yt}(C,r.typeInfo,R,s.typeInfo);if(O===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const U=vo[s.typeInfo.name][0],V=vo[r.typeInfo.name][1],Y=this.getTypeInfo(`mat${U}x${V}f`);return new Cn(O,Y)}if(r instanceof Cn&&s instanceof Te){const O=function(U,V,Y,ee){if(vo[V.name]===void 0||K5[ee.name]===void 0)return null;const le=vo[V.name][0],Ee=vo[V.name][1];if(le!==Y.length)return null;const ue=new Array(Ee);for(let _e=0;_e<Ee;_e++){let Me=0;for(let Fe=0;Fe<le;Fe++)Me+=U[Fe*Ee+_e]*Y[Fe];ue[_e]=Me}return ue}(C,r.typeInfo,R,s.typeInfo);return O===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Te(O,s.typeInfo)}if(r instanceof Te&&s instanceof Cn){const O=function(U,V,Y,ee){if(K5[V.name]===void 0||vo[ee.name]===void 0)return null;const le=vo[ee.name][0],Ee=vo[ee.name][1];if(Ee!==U.length)return null;const ue=[];for(let _e=0;_e<le;_e++){let Me=0;for(let Fe=0;Fe<Ee;Fe++)Me+=U[Fe]*Y[Fe*le+_e];ue[_e]=Me}return ue}(C,r.typeInfo,R,s.typeInfo);return O===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Te(O,r.typeInfo)}{if(C.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=C.map((U,V)=>U*R[V]);return new Te(O,r.typeInfo)}}if(Yt(u)){const C=f,R=u.map((O,U)=>O*C);return r instanceof Cn?new Cn(R,r.typeInfo):new Te(R,r.typeInfo)}if(Yt(f)){const C=u,R=f.map((O,U)=>C*O);return s instanceof Cn?new Cn(R,s.typeInfo):new Te(R,s.typeInfo)}const m=u,o=f,T=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new Ze(m*o,T)}case"%":{if(Yt(u)&&Yt(f)){const C=u,R=f;if(C.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=C.map((U,V)=>U%R[V]);return new Te(O,r.typeInfo)}if(Yt(u)){const C=f,R=u.map((O,U)=>O%C);return new Te(R,r.typeInfo)}if(Yt(f)){const C=u,R=f.map((O,U)=>C%O);return new Te(R,s.typeInfo)}const m=u,o=f,T=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new Ze(m%o,T)}case"/":{if(Yt(u)&&Yt(f)){const C=u,R=f;if(C.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=C.map((U,V)=>U/R[V]);return new Te(O,r.typeInfo)}if(Yt(u)){const C=f,R=u.map((O,U)=>O/C);return new Te(R,r.typeInfo)}if(Yt(f)){const C=u,R=f.map((O,U)=>C/O);return new Te(R,s.typeInfo)}const m=u,o=f,T=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new Ze(m/o,T)}case"&":{if(Yt(u)&&Yt(f)){const C=u,R=f;if(C.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=C.map((U,V)=>U&R[V]);return new Te(O,r.typeInfo)}if(Yt(u)){const C=f,R=u.map((O,U)=>O&C);return new Te(R,r.typeInfo)}if(Yt(f)){const C=u,R=f.map((O,U)=>C&O);return new Te(R,s.typeInfo)}const m=u,o=f,T=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new Ze(m&o,T)}case"|":{if(Yt(u)&&Yt(f)){const C=u,R=f;if(C.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=C.map((U,V)=>U|R[V]);return new Te(O,r.typeInfo)}if(Yt(u)){const C=f,R=u.map((O,U)=>O|C);return new Te(R,r.typeInfo)}if(Yt(f)){const C=u,R=f.map((O,U)=>C|O);return new Te(R,s.typeInfo)}const m=u,o=f,T=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new Ze(m|o,T)}case"^":{if(Yt(u)&&Yt(f)){const C=u,R=f;if(C.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=C.map((U,V)=>U^R[V]);return new Te(O,r.typeInfo)}if(Yt(u)){const C=f,R=u.map((O,U)=>O^C);return new Te(R,r.typeInfo)}if(Yt(f)){const C=u,R=f.map((O,U)=>C^O);return new Te(R,s.typeInfo)}const m=u,o=f,T=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new Ze(m^o,T)}case"<<":{if(Yt(u)&&Yt(f)){const C=u,R=f;if(C.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=C.map((U,V)=>U<<R[V]);return new Te(O,r.typeInfo)}if(Yt(u)){const C=f,R=u.map((O,U)=>O<<C);return new Te(R,r.typeInfo)}if(Yt(f)){const C=u,R=f.map((O,U)=>C<<O);return new Te(R,s.typeInfo)}const m=u,o=f,T=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new Ze(m<<o,T)}case">>":{if(Yt(u)&&Yt(f)){const C=u,R=f;if(C.length!==R.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const O=C.map((U,V)=>U>>R[V]);return new Te(O,r.typeInfo)}if(Yt(u)){const C=f,R=u.map((O,U)=>O>>C);return new Te(R,r.typeInfo)}if(Yt(f)){const C=u,R=f.map((O,U)=>C>>O);return new Te(R,s.typeInfo)}const m=u,o=f,T=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new Ze(m>>o,T)}case">":if(Yt(u)&&Yt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=m.map((C,R)=>C>o[R]?1:0);return new Te(T,r.typeInfo)}if(Yt(u)){const m=f,o=u.map((T,C)=>T>m?1:0);return new Te(o,r.typeInfo)}if(Yt(f)){const m=u,o=f.map((T,C)=>m>T?1:0);return new Te(o,s.typeInfo)}return new Ze(u>f?1:0,this.getTypeInfo("bool"));case"<":if(Yt(u)&&Yt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=m.map((C,R)=>C<o[R]?1:0);return new Te(T,r.typeInfo)}if(Yt(u)){const m=f,o=u.map((T,C)=>T<m?1:0);return new Te(o,r.typeInfo)}if(Yt(f)){const m=u,o=f.map((T,C)=>m<T?1:0);return new Te(o,s.typeInfo)}return new Ze(u<f?1:0,this.getTypeInfo("bool"));case"==":if(Yt(u)&&Yt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=m.map((C,R)=>C===o[R]?1:0);return new Te(T,r.typeInfo)}if(Yt(u)){const m=f,o=u.map((T,C)=>T==m?1:0);return new Te(o,r.typeInfo)}if(Yt(f)){const m=u,o=f.map((T,C)=>m==T?1:0);return new Te(o,s.typeInfo)}return new Ze(u===f?1:0,this.getTypeInfo("bool"));case"!=":if(Yt(u)&&Yt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=m.map((C,R)=>C!==o[R]?1:0);return new Te(T,r.typeInfo)}if(Yt(u)){const m=f,o=u.map((T,C)=>T!==m?1:0);return new Te(o,r.typeInfo)}if(Yt(f)){const m=u,o=f.map((T,C)=>m!==T?1:0);return new Te(o,s.typeInfo)}return new Ze(u!==f?1:0,this.getTypeInfo("bool"));case">=":if(Yt(u)&&Yt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=m.map((C,R)=>C>=o[R]?1:0);return new Te(T,r.typeInfo)}if(Yt(u)){const m=f,o=u.map((T,C)=>T>=m?1:0);return new Te(o,r.typeInfo)}if(Yt(f)){const m=u,o=f.map((T,C)=>m>=T?1:0);return new Te(o,s.typeInfo)}return new Ze(u>=f?1:0,this.getTypeInfo("bool"));case"<=":if(Yt(u)&&Yt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=m.map((C,R)=>C<=o[R]?1:0);return new Te(T,r.typeInfo)}if(Yt(u)){const m=f,o=u.map((T,C)=>T<=m?1:0);return new Te(o,r.typeInfo)}if(Yt(f)){const m=u,o=f.map((T,C)=>m<=T?1:0);return new Te(o,s.typeInfo)}return new Ze(u<=f?1:0,this.getTypeInfo("bool"));case"&&":if(Yt(u)&&Yt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=m.map((C,R)=>C&&o[R]?1:0);return new Te(T,r.typeInfo)}if(Yt(u)){const m=f,o=u.map((T,C)=>T&&m?1:0);return new Te(o,r.typeInfo)}if(Yt(f)){const m=u,o=f.map((T,C)=>m&&T?1:0);return new Te(o,s.typeInfo)}return new Ze(u&&f?1:0,this.getTypeInfo("bool"));case"||":if(Yt(u)&&Yt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const T=m.map((C,R)=>C||o[R]?1:0);return new Te(T,r.typeInfo)}if(Yt(u)){const m=f,o=u.map((T,C)=>T||m?1:0);return new Te(o,r.typeInfo)}if(Yt(f)){const m=u,o=f.map((T,C)=>m||T?1:0);return new Te(o,s.typeInfo)}return new Ze(u||f?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=t.clone();r.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let u=0;u<s.node.args.length;++u){const f=s.node.args[u],m=this.evalExpression(e.args[u],r);r.createVariable(f.name,m,f)}return this._execStatements(s.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const r=t.getFunction(e.name);if(r){const s=t.clone();for(let u=0;u<r.node.args.length;++u){const f=r.node.args[u],m=this.evalExpression(e.args[u],s);s.setVariable(f.name,m,f)}return this._execStatements(r.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new Ze(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const r=this.getTypeInfo(e.type),s=e.type.getTypeName(),u=K5[s];if(u===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const f=[];if(e instanceof ss)if(e.isVector){const m=e.vectorValue;for(const o of m)f.push(o)}else f.push(e.scalarValue);else if(e.args)for(const m of e.args){const o=this.evalExpression(m,t);if(o instanceof Te){const T=o.data;for(let C=0;C<T.length;++C){let R=T[C];f.push(R)}}else if(o instanceof Ze){let T=o.value;f.push(T)}}if(e.type instanceof Je&&e.type.format===null&&(e.type.format=Je.f32),f.length===0){const m=new Array(u).fill(0);return new Te(m,r).getSubData(this,e.postfix,t)}if(f.length===1)for(;f.length<u;)f.push(f[0]);return f.length<u?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Te(f.length>u?f.slice(0,u):f,r).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const r=this.getTypeInfo(e.type),s=e.type.getTypeName(),u=vo[s];if(u===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const f=[];if(e instanceof ss)if(e.isVector){const m=e.vectorValue;for(const o of m)f.push(o)}else f.push(e.scalarValue);else if(e.args)for(const m of e.args){const o=this.evalExpression(m,t);o instanceof Te?f.push(...o.data):o instanceof Ze?f.push(o.value):o instanceof Cn&&f.push(...o.data)}if(r instanceof B0&&r.format===null&&(r.format=this.getTypeInfo("f32")),f.length===0){const m=new Array(u[2]).fill(0);return new Cn(m,r).getSubData(this,e.postfix,t)}return f.length!==u[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Cn(f,r).getSubData(this,e.postfix,t)}}Qs._breakObj=new Wa(new Va("BREAK",null),null),Qs._continueObj=new Wa(new Va("CONTINUE",null),null),Qs._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class YM{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class KM{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new YM,this._exec=new Qs,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;t.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const s=r.arrayType,u=r.countNode;if(u instanceof ma){const f=u.name,m=this._context.constants.get(f);if(m)try{const o=m.constEvaluate(this._exec);s.count=o}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of t)r.search(s=>{s instanceof og||s instanceof i7?s.type=this._forwardType(s.type):s instanceof x2?s.format=this._forwardType(s.format):s instanceof yc||s instanceof v2||s instanceof r7?s.type=this._forwardType(s.type):s instanceof I2?s.returnType=this._forwardType(s.returnType):s instanceof sg&&(s.type=this._forwardType(s.type))});return t}_forwardType(e){if(e instanceof ig){const t=this._getType(e.name);if(t)return t}else e instanceof i7?e.type=this._forwardType(e.type):e instanceof x2&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new UM(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==pe.eof}_match(e){if(e instanceof Ge)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const r=t.type;let s=!1;for(const u of e){if(r===u)return!0;u===pe.tokens.name&&(s=!0)}if(s){const u=pe.tokens.name.rule.exec(t.lexeme);if(u&&u.index==0&&u[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===pe.tokens.name){const r=pe.tokens.name.rule.exec(t.lexeme);return r&&r.index==0&&r[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(pe.tokens.semicolon)&&!this._isAtEnd(););if(this._match(pe.keywords.alias)){const t=this._type_alias();return this._consume(pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(pe.keywords.diagnostic)){const t=this._diagnostic();return this._consume(pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(pe.keywords.requires)){const t=this._requires_directive();return this._consume(pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(pe.keywords.enable)){const t=this._enable_directive();return this._consume(pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(pe.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(pe.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(pe.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(pe.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(pe.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(pe.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(pe.keywords.fn))return null;const e=this._currentLine,t=this._consume(pe.tokens.ident,"Expected function name.").toString();this._consume(pe.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(pe.tokens.paren_right))do{if(this._check(pe.tokens.paren_right))break;const m=this._attribute(),o=this._consume(pe.tokens.name,"Expected argument name.").toString();this._consume(pe.tokens.colon,"Expected ':' for argument type.");const T=this._attribute(),C=this._type_decl();C!=null&&(C.attributes=T,r.push(this._updateNode(new sg(o,C,m))))}while(this._match(pe.tokens.comma));this._consume(pe.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(pe.tokens.arrow)){const m=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=m)}const u=this._compound_statement(),f=this._currentLine;return this._updateNode(new I2(t,r,s,u,e,f),e)}_compound_statement(){const e=[];for(this._consume(pe.tokens.brace_left,"Expected '{' for block.");!this._check(pe.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(pe.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(pe.tokens.semicolon)&&!this._isAtEnd(););if(this._check(pe.tokens.attr)&&this._attribute(),this._check(pe.keywords.if))return this._if_statement();if(this._check(pe.keywords.switch))return this._switch_statement();if(this._check(pe.keywords.loop))return this._loop_statement();if(this._check(pe.keywords.for))return this._for_statement();if(this._check(pe.keywords.while))return this._while_statement();if(this._check(pe.keywords.continuing))return this._continuing_statement();if(this._check(pe.keywords.static_assert))return this._static_assert_statement();if(this._check(pe.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(pe.keywords.return))e=this._return_statement();else if(this._check([pe.keywords.var,pe.keywords.let,pe.keywords.const]))e=this._variable_statement();else if(this._match(pe.keywords.discard))e=this._updateNode(new NM);else if(this._match(pe.keywords.break)){const t=this._updateNode(new kv);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t,this._check(pe.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(pe.keywords.continue)){const t=this._updateNode(new Ov);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(pe.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(pe.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new DM(t),e)}_while_statement(){if(!this._match(pe.keywords.while))return null;const e=this._updateNode(new Tv(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(pe.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(pe.keywords.continuing))return null;const t=this._currentLine,r=this._compound_statement();return this._updateNode(new ih(r,e),t)}_for_statement(){if(!this._match(pe.keywords.for))return null;this._consume(pe.tokens.paren_left,"Expected '('.");const e=this._updateNode(new Ev(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(pe.tokens.semicolon)?null:this._for_init(),this._consume(pe.tokens.semicolon,"Expected ';'."),e.condition=this._check(pe.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(pe.tokens.semicolon,"Expected ';'."),e.increment=this._check(pe.tokens.paren_right)?null:this._for_increment(),this._consume(pe.tokens.paren_right,"Expected ')'."),this._check(pe.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(pe.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(pe.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new yc(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(pe.keywords.let)){const e=this._currentLine,t=this._consume(pe.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(pe.tokens.colon)){const u=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=u)}this._consume(pe.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new v2(t,r,null,null,s),e)}if(this._match(pe.keywords.const)){const e=this._currentLine,t=this._consume(pe.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(pe.tokens.colon)){const u=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=u)}this._consume(pe.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return r===null&&s instanceof ss&&(r=s.type),this._updateNode(new r7(t,r,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(pe.increment_operators))return this._current=e,null;const r=this._consume(pe.increment_operators,"Expected increment operator");return this._updateNode(new Sv(r.type===pe.tokens.plus_plus?V4.increment:V4.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(pe.tokens.brace_right))return null;let r=this._match(pe.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const s=this._consume(pe.assignment_operators,"Expected assignment operator."),u=this._short_circuit_or_expression();return this._updateNode(new Av(l2.parse(s.lexeme),e,u),t)}_func_call_statement(){if(!this._check(pe.tokens.ident))return null;const e=this._currentLine,t=this._current,r=this._consume(pe.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):this._updateNode(new cf(r.lexeme,s),e)}_loop_statement(){if(!this._match(pe.keywords.loop))return null;this._check(pe.tokens.attr)&&this._attribute(),this._consume(pe.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new Cv([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof ih){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(pe.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(pe.keywords.switch))return null;const e=this._updateNode(new Pv(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(pe.tokens.attr)&&this._attribute(),this._consume(pe.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(pe.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([pe.keywords.default,pe.keywords.case]);){if(this._match(pe.keywords.case)){const r=this._case_selectors();for(const u of r)if(u instanceof s7){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(pe.tokens.colon),this._check(pe.tokens.attr)&&this._attribute(),this._consume(pe.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(pe.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Bv(r,s)))}if(this._match(pe.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(pe.tokens.colon),this._check(pe.tokens.attr)&&this._attribute(),this._consume(pe.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(pe.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new zv(r)))}}return e}_case_selectors(){const e=[];for(this._match(pe.keywords.default)?e.push(this._updateNode(new s7)):e.push(this._shift_expression());this._match(pe.tokens.comma);)this._match(pe.keywords.default)?e.push(this._updateNode(new s7)):e.push(this._shift_expression());return e}_case_body(){if(this._match(pe.keywords.fallthrough))return this._consume(pe.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(pe.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(pe.tokens.attr)&&this._attribute();const r=this._compound_statement();let s=[];this._match_elseif()&&(this._check(pe.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let u=null;return this._match(pe.keywords.else)&&(this._check(pe.tokens.attr)&&this._attribute(),u=this._compound_statement()),this._updateNode(new Iv(t,r,s,u),e)}_match_elseif(){return this._tokens[this._current].type===pe.keywords.else&&this._tokens[this._current+1].type===pe.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new BM(t,r))),this._match_elseif()&&(this._check(pe.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(pe.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new Mv(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(pe.tokens.or_or);)e=this._updateNode(new Cl(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(pe.tokens.and_and);)e=this._updateNode(new Cl(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(pe.tokens.or);)e=this._updateNode(new Cl(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(pe.tokens.xor);)e=this._updateNode(new Cl(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(pe.tokens.and);)e=this._updateNode(new Cl(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([pe.tokens.equal_equal,pe.tokens.not_equal])?this._updateNode(new Cl(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([pe.tokens.less_than,pe.tokens.greater_than,pe.tokens.less_than_equal,pe.tokens.greater_than_equal]);)e=this._updateNode(new Cl(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([pe.tokens.shift_left,pe.tokens.shift_right]);)e=this._updateNode(new Cl(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([pe.tokens.plus,pe.tokens.minus]);)e=this._updateNode(new Cl(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([pe.tokens.star,pe.tokens.forward_slash,pe.tokens.modulo]);)e=this._updateNode(new Cl(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([pe.tokens.minus,pe.tokens.bang,pe.tokens.tilde,pe.tokens.star,pe.tokens.and])?this._updateNode(new $i(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(pe.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(pe.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new tu(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(pe.tokens.period)){const e=this._consume(pe.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new z0(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return At.void;case"bool":return At.bool;case"i32":return At.i32;case"u32":return At.u32;case"f32":return At.f32;case"f16":return At.f16;case"vec2f":return Je.vec2f;case"vec3f":return Je.vec3f;case"vec4f":return Je.vec4f;case"vec2i":return Je.vec2i;case"vec3i":return Je.vec3i;case"vec4i":return Je.vec4i;case"vec2u":return Je.vec2u;case"vec3u":return Je.vec3u;case"vec4u":return Je.vec4u;case"vec2h":return Je.vec2h;case"vec3h":return Je.vec3h;case"vec4h":return Je.vec4h;case"mat2x2f":return Je.mat2x2f;case"mat2x3f":return Je.mat2x3f;case"mat2x4f":return Je.mat2x4f;case"mat3x2f":return Je.mat3x2f;case"mat3x3f":return Je.mat3x3f;case"mat3x4f":return Je.mat3x4f;case"mat4x2f":return Je.mat4x2f;case"mat4x3f":return Je.mat4x3f;case"mat4x4f":return Je.mat4x4f;case"mat2x2h":return Je.mat2x2h;case"mat2x3h":return Je.mat2x3h;case"mat2x4h":return Je.mat2x4h;case"mat3x2h":return Je.mat3x2h;case"mat3x3h":return Je.mat3x3h;case"mat3x4h":return Je.mat3x4h;case"mat4x2h":return Je.mat4x2h;case"mat4x3h":return Je.mat4x3h;case"mat4x4h":return Je.mat4x4h;case"mat2x2i":return Je.mat2x2i;case"mat2x3i":return Je.mat2x3i;case"mat2x4i":return Je.mat2x4i;case"mat3x2i":return Je.mat3x2i;case"mat3x3i":return Je.mat3x3i;case"mat3x4i":return Je.mat3x4i;case"mat4x2i":return Je.mat4x2i;case"mat4x3i":return Je.mat4x3i;case"mat4x4i":return Je.mat4x4i;case"mat2x2u":return Je.mat2x2u;case"mat2x3u":return Je.mat2x3u;case"mat2x4u":return Je.mat2x4u;case"mat3x2u":return Je.mat3x2u;case"mat3x3u":return Je.mat3x3u;case"mat3x4u":return Je.mat3x4u;case"mat4x2u":return Je.mat4x2u;case"mat4x3u":return Je.mat4x3u;case"mat4x4u":return Je.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(pe.tokens.ident)){const r=this._previous().toString();if(this._check(pe.tokens.paren_left)){const s=this._argument_expression_list(),u=this._getType(r);return u!==null?this._updateNode(new y1(u,s)):this._updateNode(new hf(r,s))}if(this._context.constants.has(r)){const s=this._context.constants.get(r);return this._updateNode(new Dv(r,s.value))}return this._updateNode(new ma(r))}if(this._match(pe.tokens.int_literal)){const r=this._previous().toString();let s=r.endsWith("i")||r.endsWith("i")?At.i32:r.endsWith("u")||r.endsWith("U")?At.u32:At.x32;const u=parseInt(r);return this._validateTypeRange(u,s),this._updateNode(new ss(new Ze(u,this._exec.getTypeInfo(s)),s))}if(this._match(pe.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,At.u32),this._updateNode(new ss(new Ze(r,this._exec.getTypeInfo(At.u32)),At.u32))}if(this._match([pe.tokens.decimal_float_literal,pe.tokens.hex_float_literal])){let r=this._previous().toString(),s=r.endsWith("h");s&&(r=r.substring(0,r.length-1));const u=parseFloat(r);this._validateTypeRange(u,s?At.f16:At.f32);const f=s?At.f16:At.f32;return this._updateNode(new ss(new Ze(u,this._exec.getTypeInfo(f)),f))}if(this._match([pe.keywords.true,pe.keywords.false])){let r=this._previous().toString()===pe.keywords.true.rule;return this._updateNode(new ss(new Ze(r?1:0,this._exec.getTypeInfo(At.bool)),At.bool))}if(this._check(pe.tokens.paren_left))return this._paren_expression();if(this._match(pe.keywords.bitcast)){this._consume(pe.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(pe.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new Lv(r,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new y1(e,t))}_argument_expression_list(){if(!this._match(pe.tokens.paren_left))return null;const e=[];do{if(this._check(pe.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(pe.tokens.comma));return this._consume(pe.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(pe.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(pe.tokens.paren_right),e}_paren_expression(){this._consume(pe.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(pe.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(pe.keywords.struct))return null;const e=this._currentLine,t=this._consume(pe.tokens.ident,"Expected name for struct.").toString();this._consume(pe.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(pe.tokens.brace_right);){const f=this._attribute(),m=this._consume(pe.tokens.name,"Expected variable name.").toString();this._consume(pe.tokens.colon,"Expected ':' for struct member type.");const o=this._attribute(),T=this._type_decl();T!=null&&(T.attributes=o),this._check(pe.tokens.brace_right)?this._match(pe.tokens.comma):this._consume(pe.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new og(m,T,f)))}this._consume(pe.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,u=this._updateNode(new mc(t,r,e,s),e);return this._context.structs.set(t,u),u}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(pe.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof ss){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof ss&&(e.type=e.value.type.name==="x32"?At.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(pe.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(pe.keywords.const))return null;const t=this._consume(pe.tokens.name,"Expected variable name"),r=this._currentLine;let s=null;if(this._match(pe.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}let u=null;this._consume(pe.tokens.equal,"const declarations require an assignment");const f=this._short_circuit_or_expression();try{let o=[At.f32],T=f.constEvaluate(this._exec,o);T instanceof Ze&&this._validateTypeRange(T.value,o[0]),o[0]instanceof Je&&o[0].format===null&&T.typeInfo instanceof B0&&T.typeInfo.format!==null&&(T.typeInfo.format.name==="f16"?o[0].format=At.f16:T.typeInfo.format.name==="f32"?o[0].format=At.f32:T.typeInfo.format.name==="i32"?o[0].format=At.i32:T.typeInfo.format.name==="u32"?o[0].format=At.u32:T.typeInfo.format.name==="bool"?o[0].format=At.bool:console.error(`TODO: impelement template format type ${T.typeInfo.format.name}`)),u=this._updateNode(new ss(T,o[0])),this._exec.context.setVariable(t.toString(),T)}catch{u=f}if(s!==null&&u instanceof ss){if(u.type.name!=="x32"&&s.getTypeName()!==u.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${u.type.name} to ${s.name}. Line:${this._currentLine}`);u.type=s,u.isScalar&&this._validateTypeRange(u.scalarValue,u.type)}else s===null&&u instanceof ss&&(s=(e=u==null?void 0:u.type)!==null&&e!==void 0?e:At.f32,s===At.x32&&(s=At.i32));const m=this._updateNode(new r7(t.toString(),s,"","",u),r);return this._context.constants.set(m.name,m),m}_global_let_decl(){if(!this._match(pe.keywords.let))return null;const e=this._currentLine,t=this._consume(pe.tokens.name,"Expected variable name");let r=null;if(this._match(pe.tokens.colon)){const u=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=u)}let s=null;if(this._match(pe.tokens.equal)&&(s=this._const_expression()),r!==null&&s instanceof ss){if(s.type.name!=="x32"&&r.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${r.name}. Line:${this._currentLine}`);s.type=r}else r===null&&s instanceof ss&&(r=s.type.name==="x32"?At.i32:s.type);return s instanceof ss&&s.isScalar&&this._validateTypeRange(s.scalarValue,r),this._updateNode(new v2(t.toString(),r,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(pe.keywords.var))return null;const e=this._currentLine;let t="",r="";this._match(pe.tokens.less_than)&&(t=this._consume(pe.storage_class,"Expected storage_class.").toString(),this._match(pe.tokens.comma)&&(r=this._consume(pe.access_mode,"Expected access_mode.").toString()),this._consume(pe.tokens.greater_than,"Expected '>'."));const s=this._consume(pe.tokens.name,"Expected variable name");let u=null;if(this._match(pe.tokens.colon)){const f=this._attribute();u=this._type_decl(),u!=null&&(u.attributes=f)}return this._updateNode(new yc(s.toString(),u,t,r,null),e)}_override_decl(){if(!this._match(pe.keywords.override))return null;const e=this._consume(pe.tokens.name,"Expected variable name");let t=null;if(this._match(pe.tokens.colon)){const r=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=r)}return this._updateNode(new lf(e.toString(),t,null))}_diagnostic(){this._consume(pe.tokens.paren_left,"Expected '('");const e=this._consume(pe.tokens.ident,"Expected severity control name.");this._consume(pe.tokens.comma,"Expected ','");let t=this._consume(pe.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(pe.tokens.period)&&(t+=`.${this._consume(pe.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(pe.tokens.paren_right,"Expected ')'"),this._updateNode(new Rv(e.toString(),t))}_enable_directive(){const e=this._consume(pe.tokens.ident,"identity expected.");return this._updateNode(new LM(e.toString()))}_requires_directive(){const e=[this._consume(pe.tokens.ident,"identity expected.").toString()];for(;this._match(pe.tokens.comma);){const t=this._consume(pe.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new FM(e))}_type_alias(){const e=this._consume(pe.tokens.ident,"identity expected.");this._consume(pe.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const r=this._updateNode(new uf(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([pe.tokens.ident,...pe.texel_format,pe.keywords.bool,pe.keywords.f32,pe.keywords.i32,pe.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const s=this._updateNode(new ig(r));return this._forwardTypeCount++,s}return this._updateNode(new At(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(pe.template_types)){let r=this._advance().toString(),s=null,u=null;return this._match(pe.tokens.less_than)&&(s=this._type_decl(),u=null,this._match(pe.tokens.comma)&&(u=this._consume(pe.access_mode,"Expected access_mode for pointer").toString()),this._consume(pe.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Je(r,s,u))}if(this._match(pe.keywords.ptr)){let r=this._previous().toString();this._consume(pe.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(pe.storage_class,"Expected storage_class for pointer");this._consume(pe.tokens.comma,"Expected ',' for pointer.");const u=this._type_decl();let f=null;return this._match(pe.tokens.comma)&&(f=this._consume(pe.access_mode,"Expected access_mode for pointer").toString()),this._consume(pe.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new i7(r,s.toString(),u,f))}const t=this._attribute();if(this._match(pe.keywords.array)){let r=null,s=-1;const u=this._previous();let f=null;if(this._match(pe.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let o="";if(this._match(pe.tokens.comma)){f=this._shift_expression();try{o=f.constEvaluate(this._exec).toString(),f=null}catch{o="1"}}this._consume(pe.tokens.greater_than,"Expected '>' for array."),s=o?parseInt(o):0}const m=this._updateNode(new x2(u.toString(),t,r,s));return f&&this._deferArrayCountEval.push({arrayType:m,countNode:f}),m}return null}_texture_sampler_types(){if(this._match(pe.sampler_type))return this._updateNode(new c2(this._previous().toString(),null,null));if(this._match(pe.depth_texture_type))return this._updateNode(new c2(this._previous().toString(),null,null));if(this._match(pe.sampled_texture_type)||this._match(pe.multisampled_texture_type)){const e=this._previous();this._consume(pe.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(pe.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new c2(e.toString(),t,null))}if(this._match(pe.storage_texture_type)){const e=this._previous();this._consume(pe.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(pe.texel_format,"Invalid texel format.").toString();this._consume(pe.tokens.comma,"Expected ',' after texel format.");const r=this._consume(pe.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(pe.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new c2(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(pe.tokens.attr);){const t=this._consume(pe.attribute_name,"Expected attribute name"),r=this._updateNode(new Uv(t.toString(),null));if(this._match(pe.tokens.paren_left)){if(r.value=this._consume(pe.literal_or_ident,"Expected attribute value").toString(),this._check(pe.tokens.comma)){this._advance();do{const s=this._consume(pe.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(s)}while(this._match(pe.tokens.comma))}this._consume(pe.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class JM extends x1{constructor(e){super(),e&&this.update(e)}update(e){const t=new KM().parse(e);this.updateAST(t)}}function QM(n){var u;const e={attributes:[],bindings:[]};let t;try{t=eR(n)}catch(f){return jt.error(f.message)(),e}for(const f of t.uniforms){const m=[];for(const o of((u=f.type)==null?void 0:u.members)||[])m.push({name:o.name,type:cg(o.type)});e.bindings.push({type:"uniform",name:f.name,group:f.group,location:f.binding,members:m})}for(const f of t.textures)e.bindings.push({type:"texture",name:f.name,group:f.group,location:f.binding});for(const f of t.samplers)e.bindings.push({type:"sampler",name:f.name,group:f.group,location:f.binding});const r=t.entry.vertex[0],s=(r==null?void 0:r.inputs.length)||0;for(let f=0;f<s;f++){const m=r.inputs[f];if(m.locationType==="location"){const o=cg(m.type);e.attributes.push({name:m.name,location:Number(m.location),type:o})}}return e}function cg(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function eR(n){try{return new JM(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const tR={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...tR}};const ja=globalThis.mathgl.config;function nR(n,{precision:e=ja.precision}={}){return n=rR(n),`${parseFloat(n.toPrecision(e))}`}function nu(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function y3(n,e,t){return sR(n,r=>Math.max(e,Math.min(t,r)))}function U7(n,e,t){return nu(n)?n.map((r,s)=>U7(r,e[s],t)):t*e+(1-t)*n}function M2(n,e,t){const r=ja.EPSILON;try{if(n===e)return!0;if(nu(n)&&nu(e)){if(n.length!==e.length)return!1;for(let s=0;s<n.length;++s)if(!M2(n[s],e[s]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=ja.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{ja.EPSILON=r}}function rR(n){return Math.round(n/ja.EPSILON)*ja.EPSILON}function iR(n){return n.clone?n.clone():new Array(n.length)}function sR(n,e,t){if(nu(n)){const r=n;t=t||iR(r);for(let s=0;s<t.length&&s<r.length;++s){const u=typeof n=="number"?n:n[s];t[s]=e(u,s,t)}return t}return e(n)}class Vv extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:nu(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ja)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+nR(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!M2(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const u=e[s],f=typeof t=="number"?t:t[s];this[s]=u+r*(f-u)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ja.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function oR(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function pa(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function J5(n,e,t=""){if(ja.debug&&!oR(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function ug(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class aR extends Vv{get x(){return this[0]}set x(e){this[0]=pa(e)}get y(){return this[1]}set y(e){this[1]=pa(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-e[r];t+=s*s}return pa(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return pa(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return ug(e>=0&&e<this.ELEMENTS,"index is out of range"),pa(this[e])}setComponent(e,t){return ug(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const o7=1e-6;let ru=typeof Float32Array<"u"?Float32Array:Array;function lR(){const n=new ru(2);return ru!=Float32Array&&(n[0]=0,n[1]=0),n}function hg(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function cR(n,e){return n[0]=-e[0],n[1]=-e[1],n}function jv(n,e,t,r){const s=e[0],u=e[1];return n[0]=s+r*(t[0]-s),n[1]=u+r*(t[1]-u),n}function uR(n,e,t){const r=e[0],s=e[1];return n[0]=t[0]*r+t[4]*s+t[12],n[1]=t[1]*r+t[5]*s+t[13],n}(function(){const n=lR();return function(e,t,r,s,u,f){let m,o;for(t||(t=2),r||(r=0),s?o=Math.min(s*t+r,e.length):o=e.length,m=r;m<o;m+=t)n[0]=e[m],n[1]=e[m+1],u(n,n,f),e[m]=n[0],e[m+1]=n[1];return e}})();function hR(n,e,t){const r=e[0],s=e[1],u=t[3]*r+t[7]*s||1;return n[0]=(t[0]*r+t[4]*s)/u,n[1]=(t[1]*r+t[5]*s)/u,n}function $v(n,e,t){const r=e[0],s=e[1],u=e[2],f=t[3]*r+t[7]*s+t[11]*u||1;return n[0]=(t[0]*r+t[4]*s+t[8]*u)/f,n[1]=(t[1]*r+t[5]*s+t[9]*u)/f,n[2]=(t[2]*r+t[6]*s+t[10]*u)/f,n}function fR(n,e,t){const r=e[0],s=e[1];return n[0]=t[0]*r+t[2]*s,n[1]=t[1]*r+t[3]*s,n[2]=e[2],n}function dR(){const n=new ru(3);return ru!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function pR(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function mR(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function gR(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function _R(n,e,t){const r=e[0],s=e[1],u=e[2],f=t[0],m=t[1],o=t[2];return n[0]=s*o-u*m,n[1]=u*f-r*o,n[2]=r*m-s*f,n}function Wv(n,e,t){const r=e[0],s=e[1],u=e[2];let f=t[3]*r+t[7]*s+t[11]*u+t[15];return f=f||1,n[0]=(t[0]*r+t[4]*s+t[8]*u+t[12])/f,n[1]=(t[1]*r+t[5]*s+t[9]*u+t[13])/f,n[2]=(t[2]*r+t[6]*s+t[10]*u+t[14])/f,n}function yR(n,e,t){const r=e[0],s=e[1],u=e[2];return n[0]=r*t[0]+s*t[3]+u*t[6],n[1]=r*t[1]+s*t[4]+u*t[7],n[2]=r*t[2]+s*t[5]+u*t[8],n}function vR(n,e,t){const r=t[0],s=t[1],u=t[2],f=t[3],m=e[0],o=e[1],T=e[2];let C=s*T-u*o,R=u*m-r*T,O=r*o-s*m,U=s*O-u*R,V=u*C-r*O,Y=r*R-s*C;const ee=f*2;return C*=ee,R*=ee,O*=ee,U*=2,V*=2,Y*=2,n[0]=m+C+U,n[1]=o+R+V,n[2]=T+O+Y,n}function xR(n,e,t,r){const s=[],u=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],u[0]=s[0],u[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),u[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),n[0]=u[0]+t[0],n[1]=u[1]+t[1],n[2]=u[2]+t[2],n}function bR(n,e,t,r){const s=[],u=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],u[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),u[1]=s[1],u[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),n[0]=u[0]+t[0],n[1]=u[1]+t[1],n[2]=u[2]+t[2],n}function wR(n,e,t,r){const s=[],u=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],u[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),u[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),u[2]=s[2],n[0]=u[0]+t[0],n[1]=u[1]+t[1],n[2]=u[2]+t[2],n}function TR(n,e){const t=n[0],r=n[1],s=n[2],u=e[0],f=e[1],m=e[2],o=Math.sqrt((t*t+r*r+s*s)*(u*u+f*f+m*m)),T=o&&gR(n,e)/o;return Math.acos(Math.min(Math.max(T,-1),1))}const ER=pR;(function(){const n=dR();return function(e,t,r,s,u,f){let m,o;for(t||(t=3),r||(r=0),s?o=Math.min(s*t+r,e.length):o=e.length,m=r;m<o;m+=t)n[0]=e[m],n[1]=e[m+1],n[2]=e[m+2],u(n,n,f),e[m]=n[0],e[m+1]=n[1],e[m+2]=n[2];return e}})();const Q5=[0,0,0];let V8;class T1 extends aR{static get ZERO(){return V8||(V8=new T1(0,0,0),Object.freeze(V8)),V8}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&nu(e)?this.copy(e):(ja.debug&&(pa(e),pa(t),pa(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ja.debug&&(pa(e.x),pa(e.y),pa(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=pa(e)}angle(e){return TR(this,e)}cross(e){return _R(this,this,e),this.check()}rotateX({radians:e,origin:t=Q5}){return xR(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Q5}){return bR(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Q5}){return wR(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Wv(this,this,e),this.check()}transformAsVector(e){return $v(this,this,e),this.check()}transformByMatrix3(e){return yR(this,this,e),this.check()}transformByMatrix2(e){return fR(this,this,e),this.check()}transformByQuaternion(e){return vR(this,this,e),this.check()}}class SR extends Vv{toString(){let e="[";if(ja.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=pa(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[r+s];return t}setColumn(e,t){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)this[r+s]=t[s];return this}}function AR(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function CR(n,e){if(n===e){const t=e[1],r=e[2],s=e[3],u=e[6],f=e[7],m=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=r,n[9]=u,n[11]=e[14],n[12]=s,n[13]=f,n[14]=m}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function oh(n,e){const t=e[0],r=e[1],s=e[2],u=e[3],f=e[4],m=e[5],o=e[6],T=e[7],C=e[8],R=e[9],O=e[10],U=e[11],V=e[12],Y=e[13],ee=e[14],le=e[15],Ee=t*m-r*f,ue=t*o-s*f,_e=t*T-u*f,Me=r*o-s*m,Fe=r*T-u*m,yt=s*T-u*o,xt=C*Y-R*V,ht=C*ee-O*V,kt=C*le-U*V,Bt=R*ee-O*Y,Vt=R*le-U*Y,$t=O*le-U*ee;let Ct=Ee*$t-ue*Vt+_e*Bt+Me*kt-Fe*ht+yt*xt;return Ct?(Ct=1/Ct,n[0]=(m*$t-o*Vt+T*Bt)*Ct,n[1]=(s*Vt-r*$t-u*Bt)*Ct,n[2]=(Y*yt-ee*Fe+le*Me)*Ct,n[3]=(O*Fe-R*yt-U*Me)*Ct,n[4]=(o*kt-f*$t-T*ht)*Ct,n[5]=(t*$t-s*kt+u*ht)*Ct,n[6]=(ee*_e-V*yt-le*ue)*Ct,n[7]=(C*yt-O*_e+U*ue)*Ct,n[8]=(f*Vt-m*kt+T*xt)*Ct,n[9]=(r*kt-t*Vt-u*xt)*Ct,n[10]=(V*Fe-Y*_e+le*Ee)*Ct,n[11]=(R*_e-C*Fe-U*Ee)*Ct,n[12]=(m*ht-f*Bt-o*xt)*Ct,n[13]=(t*Bt-r*ht+s*xt)*Ct,n[14]=(Y*ue-V*Me-ee*Ee)*Ct,n[15]=(C*Me-R*ue+O*Ee)*Ct,n):null}function PR(n){const e=n[0],t=n[1],r=n[2],s=n[3],u=n[4],f=n[5],m=n[6],o=n[7],T=n[8],C=n[9],R=n[10],O=n[11],U=n[12],V=n[13],Y=n[14],ee=n[15],le=e*f-t*u,Ee=e*m-r*u,ue=t*m-r*f,_e=T*V-C*U,Me=T*Y-R*U,Fe=C*Y-R*V,yt=e*Fe-t*Me+r*_e,xt=u*Fe-f*Me+m*_e,ht=T*ue-C*Ee+R*le,kt=U*ue-V*Ee+Y*le;return o*yt-s*xt+ee*ht-O*kt}function L0(n,e,t){const r=e[0],s=e[1],u=e[2],f=e[3],m=e[4],o=e[5],T=e[6],C=e[7],R=e[8],O=e[9],U=e[10],V=e[11],Y=e[12],ee=e[13],le=e[14],Ee=e[15];let ue=t[0],_e=t[1],Me=t[2],Fe=t[3];return n[0]=ue*r+_e*m+Me*R+Fe*Y,n[1]=ue*s+_e*o+Me*O+Fe*ee,n[2]=ue*u+_e*T+Me*U+Fe*le,n[3]=ue*f+_e*C+Me*V+Fe*Ee,ue=t[4],_e=t[5],Me=t[6],Fe=t[7],n[4]=ue*r+_e*m+Me*R+Fe*Y,n[5]=ue*s+_e*o+Me*O+Fe*ee,n[6]=ue*u+_e*T+Me*U+Fe*le,n[7]=ue*f+_e*C+Me*V+Fe*Ee,ue=t[8],_e=t[9],Me=t[10],Fe=t[11],n[8]=ue*r+_e*m+Me*R+Fe*Y,n[9]=ue*s+_e*o+Me*O+Fe*ee,n[10]=ue*u+_e*T+Me*U+Fe*le,n[11]=ue*f+_e*C+Me*V+Fe*Ee,ue=t[12],_e=t[13],Me=t[14],Fe=t[15],n[12]=ue*r+_e*m+Me*R+Fe*Y,n[13]=ue*s+_e*o+Me*O+Fe*ee,n[14]=ue*u+_e*T+Me*U+Fe*le,n[15]=ue*f+_e*C+Me*V+Fe*Ee,n}function V7(n,e,t){const r=t[0],s=t[1],u=t[2];let f,m,o,T,C,R,O,U,V,Y,ee,le;return e===n?(n[12]=e[0]*r+e[4]*s+e[8]*u+e[12],n[13]=e[1]*r+e[5]*s+e[9]*u+e[13],n[14]=e[2]*r+e[6]*s+e[10]*u+e[14],n[15]=e[3]*r+e[7]*s+e[11]*u+e[15]):(f=e[0],m=e[1],o=e[2],T=e[3],C=e[4],R=e[5],O=e[6],U=e[7],V=e[8],Y=e[9],ee=e[10],le=e[11],n[0]=f,n[1]=m,n[2]=o,n[3]=T,n[4]=C,n[5]=R,n[6]=O,n[7]=U,n[8]=V,n[9]=Y,n[10]=ee,n[11]=le,n[12]=f*r+C*s+V*u+e[12],n[13]=m*r+R*s+Y*u+e[13],n[14]=o*r+O*s+ee*u+e[14],n[15]=T*r+U*s+le*u+e[15]),n}function gf(n,e,t){const r=t[0],s=t[1],u=t[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*u,n[9]=e[9]*u,n[10]=e[10]*u,n[11]=e[11]*u,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function IR(n,e,t,r){let s=r[0],u=r[1],f=r[2],m=Math.sqrt(s*s+u*u+f*f),o,T,C,R,O,U,V,Y,ee,le,Ee,ue,_e,Me,Fe,yt,xt,ht,kt,Bt,Vt,$t,Ct,xn;return m<o7?null:(m=1/m,s*=m,u*=m,f*=m,T=Math.sin(t),o=Math.cos(t),C=1-o,R=e[0],O=e[1],U=e[2],V=e[3],Y=e[4],ee=e[5],le=e[6],Ee=e[7],ue=e[8],_e=e[9],Me=e[10],Fe=e[11],yt=s*s*C+o,xt=u*s*C+f*T,ht=f*s*C-u*T,kt=s*u*C-f*T,Bt=u*u*C+o,Vt=f*u*C+s*T,$t=s*f*C+u*T,Ct=u*f*C-s*T,xn=f*f*C+o,n[0]=R*yt+Y*xt+ue*ht,n[1]=O*yt+ee*xt+_e*ht,n[2]=U*yt+le*xt+Me*ht,n[3]=V*yt+Ee*xt+Fe*ht,n[4]=R*kt+Y*Bt+ue*Vt,n[5]=O*kt+ee*Bt+_e*Vt,n[6]=U*kt+le*Bt+Me*Vt,n[7]=V*kt+Ee*Bt+Fe*Vt,n[8]=R*$t+Y*Ct+ue*xn,n[9]=O*$t+ee*Ct+_e*xn,n[10]=U*$t+le*Ct+Me*xn,n[11]=V*$t+Ee*Ct+Fe*xn,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function Hv(n,e,t){const r=Math.sin(t),s=Math.cos(t),u=e[4],f=e[5],m=e[6],o=e[7],T=e[8],C=e[9],R=e[10],O=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=u*s+T*r,n[5]=f*s+C*r,n[6]=m*s+R*r,n[7]=o*s+O*r,n[8]=T*s-u*r,n[9]=C*s-f*r,n[10]=R*s-m*r,n[11]=O*s-o*r,n}function MR(n,e,t){const r=Math.sin(t),s=Math.cos(t),u=e[0],f=e[1],m=e[2],o=e[3],T=e[8],C=e[9],R=e[10],O=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=u*s-T*r,n[1]=f*s-C*r,n[2]=m*s-R*r,n[3]=o*s-O*r,n[8]=u*r+T*s,n[9]=f*r+C*s,n[10]=m*r+R*s,n[11]=o*r+O*s,n}function Xv(n,e,t){const r=Math.sin(t),s=Math.cos(t),u=e[0],f=e[1],m=e[2],o=e[3],T=e[4],C=e[5],R=e[6],O=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=u*s+T*r,n[1]=f*s+C*r,n[2]=m*s+R*r,n[3]=o*s+O*r,n[4]=T*s-u*r,n[5]=C*s-f*r,n[6]=R*s-m*r,n[7]=O*s-o*r,n}function RR(n,e){const t=e[0],r=e[1],s=e[2],u=e[3],f=t+t,m=r+r,o=s+s,T=t*f,C=r*f,R=r*m,O=s*f,U=s*m,V=s*o,Y=u*f,ee=u*m,le=u*o;return n[0]=1-R-V,n[1]=C+le,n[2]=O-ee,n[3]=0,n[4]=C-le,n[5]=1-T-V,n[6]=U+Y,n[7]=0,n[8]=O+ee,n[9]=U-Y,n[10]=1-T-R,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function kR(n,e,t,r,s,u,f){const m=1/(t-e),o=1/(s-r),T=1/(u-f);return n[0]=u*2*m,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u*2*o,n[6]=0,n[7]=0,n[8]=(t+e)*m,n[9]=(s+r)*o,n[10]=(f+u)*T,n[11]=-1,n[12]=0,n[13]=0,n[14]=f*u*2*T,n[15]=0,n}function OR(n,e,t,r,s){const u=1/Math.tan(e/2);if(n[0]=u/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const f=1/(r-s);n[10]=(s+r)*f,n[14]=2*s*r*f}else n[10]=-1,n[14]=-2*r;return n}const DR=OR;function LR(n,e,t,r,s,u,f){const m=1/(e-t),o=1/(r-s),T=1/(u-f);return n[0]=-2*m,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(e+t)*m,n[13]=(s+r)*o,n[14]=(f+u)*T,n[15]=1,n}const FR=LR;function NR(n,e,t,r){let s,u,f,m,o,T,C,R,O,U;const V=e[0],Y=e[1],ee=e[2],le=r[0],Ee=r[1],ue=r[2],_e=t[0],Me=t[1],Fe=t[2];return Math.abs(V-_e)<o7&&Math.abs(Y-Me)<o7&&Math.abs(ee-Fe)<o7?AR(n):(R=V-_e,O=Y-Me,U=ee-Fe,s=1/Math.sqrt(R*R+O*O+U*U),R*=s,O*=s,U*=s,u=Ee*U-ue*O,f=ue*R-le*U,m=le*O-Ee*R,s=Math.sqrt(u*u+f*f+m*m),s?(s=1/s,u*=s,f*=s,m*=s):(u=0,f=0,m=0),o=O*m-U*f,T=U*u-R*m,C=R*f-O*u,s=Math.sqrt(o*o+T*T+C*C),s?(s=1/s,o*=s,T*=s,C*=s):(o=0,T=0,C=0),n[0]=u,n[1]=o,n[2]=R,n[3]=0,n[4]=f,n[5]=T,n[6]=O,n[7]=0,n[8]=m,n[9]=C,n[10]=U,n[11]=0,n[12]=-(u*V+f*Y+m*ee),n[13]=-(o*V+T*Y+C*ee),n[14]=-(R*V+O*Y+U*ee),n[15]=1,n)}function BR(){const n=new ru(4);return ru!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function zR(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function U2(n,e,t){const r=e[0],s=e[1],u=e[2],f=e[3];return n[0]=t[0]*r+t[4]*s+t[8]*u+t[12]*f,n[1]=t[1]*r+t[5]*s+t[9]*u+t[13]*f,n[2]=t[2]*r+t[6]*s+t[10]*u+t[14]*f,n[3]=t[3]*r+t[7]*s+t[11]*u+t[15]*f,n}(function(){const n=BR();return function(e,t,r,s,u,f){let m,o;for(t||(t=4),r||(r=0),s?o=Math.min(s*t+r,e.length):o=e.length,m=r;m<o;m+=t)n[0]=e[m],n[1]=e[m+1],n[2]=e[m+2],n[3]=e[m+3],u(n,n,f),e[m]=n[0],e[m+1]=n[1],e[m+2]=n[2],e[m+3]=n[3];return e}})();var ah;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(ah||(ah={}));const UR=45*Math.PI/180,VR=1,e9=.1,t9=500,jR=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class E1 extends SR{static get IDENTITY(){return WR()}static get ZERO(){return $R()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return ah}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,s,u,f,m,o,T,C,R,O,U,V,Y,ee){return this[0]=e,this[1]=t,this[2]=r,this[3]=s,this[4]=u,this[5]=f,this[6]=m,this[7]=o,this[8]=T,this[9]=C,this[10]=R,this[11]=O,this[12]=U,this[13]=V,this[14]=Y,this[15]=ee,this.check()}setRowMajor(e,t,r,s,u,f,m,o,T,C,R,O,U,V,Y,ee){return this[0]=e,this[1]=u,this[2]=T,this[3]=U,this[4]=t,this[5]=f,this[6]=C,this[7]=V,this[8]=r,this[9]=m,this[10]=R,this[11]=Y,this[12]=s,this[13]=o,this[14]=O,this[15]=ee,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(jR)}fromObject(e){return this.check()}fromQuaternion(e){return RR(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:s,top:u,near:f=e9,far:m=t9}=e;return m===1/0?HR(this,t,r,s,u,f):kR(this,t,r,s,u,f,m),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:s=[0,1,0]}=e;return NR(this,t,r,s),this.check()}ortho(e){const{left:t,right:r,bottom:s,top:u,near:f=e9,far:m=t9}=e;return FR(this,t,r,s,u,f,m),this.check()}orthographic(e){const{fovy:t=UR,aspect:r=VR,focalDistance:s=1,near:u=e9,far:f=t9}=e;fg(t);const m=t/2,o=s*Math.tan(m),T=o*r;return this.ortho({left:-T,right:T,bottom:-o,top:o,near:u,far:f})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:s=.1,far:u=500}=e;return fg(t),DR(this,t,r,s,u),this.check()}determinant(){return PR(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),s=1/r[0],u=1/r[1],f=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*u,e[2]=this[2]*f,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*u,e[6]=this[6]*f,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*u,e[10]=this[10]*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),s=1/r[0],u=1/r[1],f=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*u,e[2]=this[2]*f,e[3]=this[4]*s,e[4]=this[5]*u,e[5]=this[6]*f,e[6]=this[8]*s,e[7]=this[9]*u,e[8]=this[10]*f,e}transpose(){return CR(this,this),this.check()}invert(){return oh(this,this),this.check()}multiplyLeft(e){return L0(this,e,this),this.check()}multiplyRight(e){return L0(this,this,e),this.check()}rotateX(e){return Hv(this,this,e),this.check()}rotateY(e){return MR(this,this,e),this.check()}rotateZ(e){return Xv(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return IR(this,this,e,t),this.check()}scale(e){return gf(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return V7(this,this,e),this.check()}transform(e,t){return e.length===4?(t=U2(t||[-0,-0,-0,-0],e,this),J5(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let s;switch(r){case 2:s=uR(t||[-0,-0],e,this);break;case 3:s=Wv(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return J5(s,e.length),s}transformAsVector(e,t){let r;switch(e.length){case 2:r=hR(t||[-0,-0],e,this);break;case 3:r=$v(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return J5(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let j8,$8;function $R(){return j8||(j8=new E1([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(j8)),j8}function WR(){return $8||($8=new E1,Object.freeze($8)),$8}function fg(n){if(n>Math.PI*2)throw Error("expected radians")}function HR(n,e,t,r,s,u){const f=2*u/(t-e),m=2*u/(s-r),o=(t+e)/(t-e),T=(s+r)/(s-r),C=-1,R=-1,O=-2*u;return n[0]=f,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=o,n[9]=T,n[10]=C,n[11]=R,n[12]=0,n[13]=0,n[14]=O,n[15]=0,n}function Zv(n,e=[],t=0){const r=Math.fround(n),s=n-r;return e[t]=r,e[t+1]=s,e}function XR(n){return n-Math.fround(n)}function ZR(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let r=0;r<4;++r){const s=t*4+r;Zv(n[r*4+t],e,s*2)}return e}const qR=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,GR={name:"fp32",vs:qR},YR=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,KR={ONE:1},JR={name:"fp64arithmetic",vs:YR,defaultUniforms:KR,uniformTypes:{ONE:"f32"},fp64ify:Zv,fp64LowPart:XR,fp64ifyMatrix4:ZR},QR=[0,1,1,1],ek=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,tk=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,dg={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:QR},vs:ek,fs:tk,getUniforms:nk};function nk(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const r=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=r}if(n.highlightColor){const r=Array.from(n.highlightColor,s=>s/255);Number.isFinite(r[3])||(r[3]=1),t.highlightColor=r}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const pg=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,rk=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,qv=3,ik=255;var R2;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(R2||(R2={}));const a7={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:qv},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:R2.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:rk,vs:pg,fs:pg,getUniforms:sk};function sk(n,e={}){if(n=n&&{...n},!n)return{...a7.defaultUniforms};n.lights&&(n={...n,...ak(n.lights),lights:void 0});const{ambientLight:t,pointLights:r,directionalLights:s}=n||{};if(!(t||r&&r.length>0||s&&s.length>0))return{...a7.defaultUniforms,enabled:0};const f={...a7.defaultUniforms,...e,...ok({ambientLight:t,pointLights:r,directionalLights:s})};return n.enabled!==void 0&&(f.enabled=n.enabled?1:0),f}function ok({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const r={};r.ambientLightColor=n9(n);let s=0;for(const u of e){r.lightType=R2.POINT;const f=s;r[`lightColor${f}`]=n9(u),r[`lightPosition${f}`]=u.position,r[`lightAttenuation${f}`]=u.attenuation||[1,0,0],s++}for(const u of t){r.lightType=R2.DIRECTIONAL;const f=s;r[`lightColor${f}`]=n9(u),r[`lightDirection${f}`]=u.direction,s++}return s>qv&&jt.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=t.length,r.pointLightCount=e.length,r}function ak(n){var t,r;const e={pointLights:[],directionalLights:[]};for(const s of n||[])switch(s.type){case"ambient":e.ambientLight=s;break;case"directional":(t=e.directionalLights)==null||t.push(s);break;case"point":(r=e.pointLights)==null||r.push(s);break}return e}function n9(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(r=>r*t/ik)}const lk=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,ck=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,uk=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,Gv={props:{},name:"gouraudMaterial",vs:ck.replace("phongMaterial","gouraudMaterial"),fs:lk.replace("phongMaterial","gouraudMaterial"),source:uk.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[a7],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...Gv.defaultUniforms,...e}}},mg=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,hk={name:"layer",vs:mg,fs:mg,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},fk=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Yv="#define SMOOTH_EDGE_RADIUS 0.5",dk=`${Yv}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,pk=`${Yv}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Kv={name:"geometry",source:fk,vs:dk,fs:pk},mk=25;var Wi;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(Wi||(Wi={}));var os;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(os||(os={}));var Hn;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(Hn||(Hn={}));const gk="compute",_k="auto",lh="manipulation",l7="none",ch="pan-x",uh="pan-y";function yk(n){if(n.includes(l7))return l7;const e=n.includes(ch),t=n.includes(uh);return e&&t?l7:e||t?e?ch:uh:n.includes(lh)?lh:_k}class vk{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===gk&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return yk(e.join(" "))}}function j7(n){return n.trim().split(/\s+/g)}function r9(n,e,t){if(n)for(const r of j7(e))n.addEventListener(r,t,!1)}function i9(n,e,t){if(n)for(const r of j7(e))n.removeEventListener(r,t,!1)}function gg(n){return(n.ownerDocument||n).defaultView}function xk(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function Jv(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,r=0,s=0;for(;s<e;)t+=n[s].clientX,r+=n[s].clientY,s++;return{x:Math.round(t/e),y:Math.round(r/e)}}function _g(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:Jv(e),deltaX:n.deltaX,deltaY:n.deltaY}}function Qv(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.sqrt(t*t+r*r)}function yg(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.sqrt(t*t+r*r)}function bk(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.atan2(r,t)*180/Math.PI}function vg(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.atan2(r,t)*180/Math.PI}function ex(n,e){return n===e?os.None:Math.abs(n)>=Math.abs(e)?n<0?os.Left:os.Right:e<0?os.Up:os.Down}function wk(n,e){const t=e.center;let r=n.offsetDelta,s=n.prevDelta;const u=n.prevInput;return(e.eventType===Wi.Start||(u==null?void 0:u.eventType)===Wi.End)&&(s=n.prevDelta={x:(u==null?void 0:u.deltaX)||0,y:(u==null?void 0:u.deltaY)||0},r=n.offsetDelta={x:t.x,y:t.y}),{deltaX:s.x+(t.x-r.x),deltaY:s.y+(t.y-r.y)}}function tx(n,e,t){return{x:e/n||0,y:t/n||0}}function Tk(n,e){return yg(e[0],e[1])/yg(n[0],n[1])}function Ek(n,e){return vg(e[1],e[0])-vg(n[1],n[0])}function Sk(n,e){const t=n.lastInterval||e,r=e.timeStamp-t.timeStamp;let s,u,f,m;if(e.eventType!==Wi.Cancel&&(r>mk||t.velocity===void 0)){const o=e.deltaX-t.deltaX,T=e.deltaY-t.deltaY,C=tx(r,o,T);u=C.x,f=C.y,s=Math.abs(C.x)>Math.abs(C.y)?C.x:C.y,m=ex(o,T),n.lastInterval=e}else s=t.velocity,u=t.velocityX,f=t.velocityY,m=t.direction;e.velocity=s,e.velocityX=u,e.velocityY=f,e.direction=m}function Ak(n,e){const{session:t}=n,{pointers:r}=e,{length:s}=r;t.firstInput||(t.firstInput=_g(e)),s>1&&!t.firstMultiple?t.firstMultiple=_g(e):s===1&&(t.firstMultiple=!1);const{firstInput:u,firstMultiple:f}=t,m=f?f.center:u.center,o=e.center=Jv(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-u.timeStamp,e.angle=bk(m,o),e.distance=Qv(m,o);const{deltaX:T,deltaY:C}=wk(t,e);e.deltaX=T,e.deltaY=C,e.offsetDirection=ex(e.deltaX,e.deltaY);const R=tx(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=R.x,e.overallVelocityY=R.y,e.overallVelocity=Math.abs(R.x)>Math.abs(R.y)?R.x:R.y,e.scale=f?Tk(f.pointers,r):1,e.rotation=f?Ek(f.pointers,r):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let O=n.element;return xk(e.srcEvent.target,O)&&(O=e.srcEvent.target),e.target=O,Sk(t,e),e}function Ck(n,e,t){const r=t.pointers.length,s=t.changedPointers.length,u=e&Wi.Start&&r-s===0,f=e&(Wi.End|Wi.Cancel)&&r-s===0;t.isFirst=!!u,t.isFinal=!!f,u&&(n.session={}),t.eventType=e;const m=Ak(n,t);n.emit("hammer.input",m),n.recognize(m),n.session.prevInput=m}let Pk=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){Ck(this.manager,e,t)}init(){r9(this.element,this.evEl,this.domHandler),r9(this.target,this.evTarget,this.domHandler),r9(gg(this.element),this.evWin,this.domHandler)}destroy(){i9(this.element,this.evEl,this.domHandler),i9(this.target,this.evTarget,this.domHandler),i9(gg(this.element),this.evWin,this.domHandler)}};const Ik={pointerdown:Wi.Start,pointermove:Wi.Move,pointerup:Wi.End,pointercancel:Wi.Cancel,pointerout:Wi.Cancel},Mk="pointerdown",Rk="pointermove pointerup pointercancel";class kk extends Pk{constructor(e){super(e),this.evEl=Mk,this.evWin=Rk,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let r=!1;const s=Ik[e.type],u=e.pointerType,f=u==="touch";let m=t.findIndex(o=>o.pointerId===e.pointerId);s&Wi.Start&&(e.buttons||f)?m<0&&(t.push(e),m=t.length-1):s&(Wi.End|Wi.Cancel)&&(r=!0),!(m<0)&&(t[m]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:u,srcEvent:e}),r&&t.splice(m,1))}}const Ok=["","webkit","Moz","MS","ms","o"];function Dk(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const r of Ok){const s=r?r+t:e;if(s in n)return s}}const Lk=1,xg=2,bg={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class Fk{constructor(e,t){this.options={...bg,...t,cssProps:{...bg.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new kk(this),this.touchAction=new vk(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?xg:Lk}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:s}=this;let{curRecognizer:u}=t;(!u||u&&u.state&Hn.Recognized)&&(u=t.curRecognizer=null);let f=0;for(;f<s.length;)r=s[f],t.stopped!==xg&&(!u||r===u||r.canRecognizeWith(u))?r.recognize(e):r.reset(),!u&&r.state&(Hn.Began|Hn.Changed|Hn.Ended)&&(u=t.curRecognizer=r),f++}get(e){const{recognizers:t}=this;for(let r=0;r<t.length;r++)if(t[r].options.event===e)return t[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:r}=this,s=r.indexOf(t);s!==-1&&(r.splice(s,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:r}=this;for(const s of j7(e))r[s]=r[s]||[],r[s].push(t)}off(e,t){if(!e)return;const{handlers:r}=this;for(const s of j7(e))t?r[s]&&r[s].splice(r[s].indexOf(t),1):delete r[s]}emit(e,t){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let u=0;for(;u<r.length;)r[u](s),u++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[r,s]of Object.entries(this.options.cssProps)){const u=Dk(t.style,r);e?(this.oldCssProps[u]=t.style[u],t.style[u]=s):t.style[u]=this.oldCssProps[u]||""}e||(this.oldCssProps={})}}}let Nk=1;function Bk(){return Nk++}function wg(n){return n&Hn.Cancelled?"cancel":n&Hn.Ended?"end":n&Hn.Changed?"move":n&Hn.Began?"start":""}class nx{constructor(e){this.options=e,this.id=Bk(),this.state=Hn.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:r}=this;return r[t.id]||(r[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:r}=this;return r.indexOf(t)===-1&&(r.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const r=this.requireFail.indexOf(t);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Hn.Ended&&this.manager.emit(this.options.event+wg(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Hn.Ended&&this.manager.emit(this.options.event+wg(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Hn.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Hn.Failed|Hn.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Hn.Failed;return}this.state&(Hn.Recognized|Hn.Cancelled|Hn.Failed)&&(this.state=Hn.Possible),this.state=this.process(t),this.state&(Hn.Began|Hn.Changed|Hn.Ended|Hn.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class rx extends nx{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:r}=e,s=t&(Hn.Began|Hn.Changed),u=this.attrTest(e);return s&&(r&Wi.Cancel||!u)?t|Hn.Cancelled:s||u?r&Wi.End?t|Hn.Ended:t&Hn.Began?t|Hn.Changed:Hn.Began:Hn.Failed}}class Tg extends nx{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[lh]}process(e){const{options:t}=this,r=e.pointers.length===t.pointers,s=e.distance<t.threshold,u=e.deltaTime<t.time;if(this.reset(),e.eventType&Wi.Start&&this.count===0)return this.failTimeout();if(s&&u&&r){if(e.eventType!==Wi.End)return this.failTimeout();const f=this.pTime?e.timeStamp-this.pTime<t.interval:!0,m=!this.pCenter||Qv(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!m||!f?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Hn.Recognized,this.tryEmit(this._input)},t.interval),Hn.Began):Hn.Recognized}return Hn.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Hn.Failed},this.options.interval),Hn.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Hn.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const zk=["","start","move","end","cancel","up","down","left","right"];class Eg extends rx{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:os.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&os.Horizontal&&t.push(uh),e&os.Vertical&&t.push(ch),t}getEventNames(){return zk.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let r=!0,{distance:s}=e,{direction:u}=e;const f=e.deltaX,m=e.deltaY;return u&t.direction||(t.direction&os.Horizontal?(u=f===0?os.None:f<0?os.Left:os.Right,r=f!==this.pX,s=Math.abs(e.deltaX)):(u=m===0?os.None:m<0?os.Up:os.Down,r=m!==this.pY,s=Math.abs(e.deltaY))),e.direction=u,r&&s>t.threshold&&!!(u&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Hn.Began)||!(this.state&Hn.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=os[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const Uk=["","start","move","end","cancel","in","out"];class Vk extends rx{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[l7]}getEventNames(){return Uk.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Hn.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class v6{constructor(e,t,r){this.element=e,this.callback=t,this.options=r}}const jk=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",$k=jk.indexOf("firefox")!==-1,Sg=4.000244140625,Wk=40,Hk=.25;class Xk extends v6{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=s=>{if(!this.options.enable)return;let u=s.deltaY;globalThis.WheelEvent&&($k&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(u/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(u*=Wk)),u!==0&&u%Sg===0&&(u=Math.floor(u/Sg)),s.shiftKey&&u&&(u=u*Hk),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-u,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const Ag=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class Zk extends v6{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=u=>{this.handleOverEvent(u),this.handleOutEvent(u),this.handleEnterEvent(u),this.handleLeaveEvent(u),this.handleMoveEvent(u)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,Ag.forEach(u=>e.addEventListener(u,this.handleEvent))}destroy(){Ag.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const Cg=["keydown","keyup"];class qk extends v6{constructor(e,t,r){super(e,t,{enable:!0,tabIndex:0,...r}),this.handleEvent=s=>{const u=s.target||s.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",Cg.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){Cg.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class Gk extends v6{constructor(e,t,r){super(e,t,r),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const Pg=1,hh=2,Ig=4,Yk={pointerdown:Pg,pointermove:hh,pointerup:Ig,mousedown:Pg,mousemove:hh,mouseup:Ig},Kk=0,Jk=1,Qk=2,eO=1,tO=2,nO=4;function rO(n){const e=Yk[n.srcEvent.type];if(!e)return null;const{buttons:t,button:r}=n.srcEvent;let s=!1,u=!1,f=!1;return e===hh?(s=!!(t&eO),u=!!(t&nO),f=!!(t&tO)):(s=r===Kk,u=r===Jk,f=r===Qk),{leftButton:s,middleButton:u,rightButton:f}}function iO(n,e){const t=n.center;if(!t)return null;const r=e.getBoundingClientRect(),s=r.width/e.offsetWidth||1,u=r.height/e.offsetHeight||1,f={x:(t.x-r.left-e.clientLeft)/s,y:(t.y-r.top-e.clientTop)/u};return{center:t,offsetCenter:f}}const sO={srcElement:"root",priority:0};class oO{constructor(e,t){this.handleEvent=r=>{if(this.isEmpty())return;const s=this._normalizeEvent(r);let u=r.srcEvent.target;for(;u&&u!==s.rootElement;){if(this._emit(s,u),s.handled)return;u=u.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,s=!1,u=!1){const{handlers:f,handlersByElement:m}=this,o={...sO,...r};let T=m.get(o.srcElement);T||(T=[],m.set(o.srcElement,T));const C={type:e,handler:t,srcElement:o.srcElement,priority:o.priority};s&&(C.once=!0),u&&(C.passive=!0),f.push(C),this._active=this._active||!C.passive;let R=T.length-1;for(;R>=0&&!(T[R].priority>=C.priority);)R--;T.splice(R+1,0,C)}remove(e,t){const{handlers:r,handlersByElement:s}=this;for(let u=r.length-1;u>=0;u--){const f=r[u];if(f.type===e&&f.handler===t){r.splice(u,1);const m=s.get(f.srcElement);m.splice(m.indexOf(f),1),m.length===0&&s.delete(f.srcElement)}}this._active=r.some(u=>!u.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let s=!1;const u=()=>{e.handled=!0},f=()=>{e.handled=!0,s=!0},m=[];for(let o=0;o<r.length;o++){const{type:T,handler:C,once:R}=r[o];if(C({...e,type:T,stopPropagation:u,stopImmediatePropagation:f}),R&&m.push(r[o]),s)break}for(let o=0;o<m.length;o++){const{type:T,handler:C}=m[o];this.remove(T,C)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...rO(e),...iO(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function aO(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const r=t.shift(),s=t.shift()||{};e=new r(s)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class lO{constructor(e=null,t={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new Fk(e,this.options);for(const r of this.options.recognizers){const{recognizer:s,recognizeWith:u,requireFailure:f}=aO(r);this.manager.add(s),u&&s.recognizeWith(u),f&&s.requireFailure(f)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new Xk(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Zk(e,this._onOtherEvent,{enable:!1}),this.keyInput=new qk(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new Gk(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var u,f,m,o;const{manager:r}=this;if(!r)return;const s=r.get(e);s&&(s.set({enable:t}),r.touchAction.update()),(u=this.wheelInput)==null||u.enableEventType(e,t),(f=this.moveInput)==null||f.enableEventType(e,t),(m=this.keyInput)==null||m.enableEventType(e,t),(o=this.contextmenuInput)==null||o.enableEventType(e,t)}_addEventHandler(e,t,r,s,u){if(typeof e!="string"){r=t;for(const[T,C]of Object.entries(e))this._addEventHandler(T,C,r,s,u);return}const{manager:f,events:m}=this;if(!f)return;let o=m.get(e);if(!o){const T=this._getRecognizerName(e)||e;o=new oO(this,T),m.set(e,o),f&&f.on(e,o.handleEvent)}o.add(e,t,r,s,u),o.isEmpty()||this._toggleRecognizer(o.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[u,f]of Object.entries(e))this._removeEventHandler(u,f);return}const{events:r}=this,s=r.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:u}=s;let f=!1;for(const m of r.values())if(m.recognizerName===u&&!m.isEmpty()){f=!0;break}f||this._toggleRecognizer(u,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(r=>r.getEventNames().includes(e)))==null?void 0:t.options.event}}const mr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(mr,"IDENTITY",{get:()=>(lr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ua={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},xc={common:0,meters:1,pixels:2},fh={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Mg={multipan:[Eg,{threshold:10,direction:os.Vertical,pointers:2}],pinch:[Vk,{},null,["multipan"]],pan:[Eg,{threshold:1},["pinch"],["multipan"]],dblclick:[Tg,{event:"dblclick",taps:2}],click:[Tg,{event:"click"},null,["dblclick"]]};function cO(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}function V2(n){let e={},t;return r=>{for(const s in r)if(!cO(r[s],e[s])){t=n(r),e=r;break}return t}}const Rg=[0,0,0,0],uO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],hO=[0,0,0],sx=[0,0,0],fO=V2(mO);function ox(n,e,t=sx){t.length<3&&(t=[t[0],t[1],0]);let r=t,s,u=!0;switch(e===mr.LNGLAT_OFFSETS||e===mr.METER_OFFSETS?s=t:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case Ua.WEB_MERCATOR:(e===mr.LNGLAT||e===mr.CARTESIAN)&&(s=[0,0,0],u=!1);break;case Ua.WEB_MERCATOR_AUTO_OFFSET:e===mr.LNGLAT?r=s:e===mr.CARTESIAN&&(r=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case Ua.IDENTITY:r=n.position.map(Math.fround),r[2]=r[2]||0;break;case Ua.GLOBE:u=!1,s=null;break;default:u=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:r,offsetMode:u}}function dO(n,e,t){const{viewMatrixUncentered:r,projectionMatrix:s}=n;let{viewMatrix:u,viewProjectionMatrix:f}=n,m=Rg,o=Rg,T=n.cameraPosition;const{geospatialOrigin:C,shaderCoordinateOrigin:R,offsetMode:O}=ox(n,e,t);return O&&(o=n.projectPosition(C||R),T=[T[0]-o[0],T[1]-o[1],T[2]-o[2]],o[3]=1,m=U2([],o,f),u=r||u,f=L0([],s,u),f=L0([],f,uO)),{viewMatrix:u,viewProjectionMatrix:f,projectionCenter:m,originCommon:o,cameraPosCommon:T,shaderCoordinateOrigin:R,geospatialOrigin:C}}function pO({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=mr.DEFAULT,coordinateOrigin:s=sx,autoWrapLongitude:u=!1}){r===mr.DEFAULT&&(r=n.isGeospatial?mr.LNGLAT:mr.CARTESIAN);const f=fO({viewport:n,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:s});return f.wrapLongitude=u,f.modelMatrix=t||ix,f}function mO({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:s,viewProjectionMatrix:u,originCommon:f,cameraPosCommon:m,shaderCoordinateOrigin:o,geospatialOrigin:T}=dO(n,t,r),C=n.getDistanceScales(),R=[n.width*e,n.height*e],O=U2([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,U={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:o,commonOrigin:f.slice(0,3),center:s,pseudoMeters:!!n._pseudoMeters,viewportSize:R,devicePixelRatio:e,focalDistance:O,commonUnitsPerMeter:C.unitsPerMeter,commonUnitsPerWorldUnit:C.unitsPerMeter,commonUnitsPerWorldUnit2:hO,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:u,modelMatrix:ix,cameraPosition:m};if(T){const V=n.getDistanceScales(T);switch(t){case mr.METER_OFFSETS:U.commonUnitsPerWorldUnit=V.unitsPerMeter,U.commonUnitsPerWorldUnit2=V.unitsPerMeter2;break;case mr.LNGLAT:case mr.LNGLAT_OFFSETS:n._pseudoMeters||(U.commonUnitsPerMeter=V.unitsPerMeter),U.commonUnitsPerWorldUnit=V.unitsPerDegree,U.commonUnitsPerWorldUnit2=V.unitsPerDegree2;break;case mr.CARTESIAN:U.commonUnitsPerWorldUnit=[1,1,V.unitsPerMeter[2]],U.commonUnitsPerWorldUnit2=[0,0,V.unitsPerMeter2[2]];break}}return U}const gO=Object.keys(mr).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${mr[n]};`).join(""),_O=Object.keys(Ua).map(n=>`const PROJECTION_MODE_${n}: i32 = ${Ua[n]};`).join(""),yO=Object.keys(xc).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${xc[n]};`).join(""),vO=`${gO}
${_O}
${yO}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,xO=`${vO}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,bO=Object.keys(mr).map(n=>`const int COORDINATE_SYSTEM_${n} = ${mr[n]};`).join(""),wO=Object.keys(Ua).map(n=>`const int PROJECTION_MODE_${n} = ${Ua[n]};`).join(""),TO=Object.keys(xc).map(n=>`const int UNIT_${n.toUpperCase()} = ${xc[n]};`).join(""),EO=`${bO}
${wO}
${TO}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,SO={};function AO(n=SO){return"viewport"in n?pO(n):{}}const _f={name:"project",dependencies:[GR,Kv],source:xO,vs:EO,getUniforms:AO,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},CO=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,PO=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,j2={name:"project32",dependencies:[_f],source:CO,vs:PO};function IO(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function G4(n,e){const t=U2([],e,n);return zR(t,t,1/t[3]),t}function kg(n,e){const t=n%e;return t<0?e+t:t}function dh(n,e,t){return n<e?e:n>t?t:n}function MO(n){return Math.log(n)*Math.LOG2E}const yf=Math.log2||MO;function bc(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const kl=Math.PI,ax=kl/4,$a=kl/180,ph=180/kl,iu=512,$7=4003e4,Og=85.051129,RO=1.5;function kO(n){return yf(n)}function W7(n){const[e,t]=n;bc(Number.isFinite(e)),bc(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*$a,s=t*$a,u=iu*(r+kl)/(2*kl),f=iu*(kl+Math.log(Math.tan(ax+s*.5)))/(2*kl);return[u,f]}function su(n){const[e,t]=n,r=e/iu*(2*kl)-kl,s=2*(Math.atan(Math.exp(t/iu*(2*kl)-kl))-ax);return[r*ph,s*ph]}function OO(n){const{latitude:e}=n;bc(Number.isFinite(e));const t=Math.cos(e*$a);return kO($7*t)-9}function s9(n){const e=Math.cos(n*$a);return iu/$7/e}function mh(n){const{latitude:e,longitude:t,highPrecision:r=!1}=n;bc(Number.isFinite(e)&&Number.isFinite(t));const s=iu,u=Math.cos(e*$a),f=s/360,m=f/u,o=s/$7/u,T={unitsPerMeter:[o,o,o],metersPerUnit:[1/o,1/o,1/o],unitsPerDegree:[f,m,o],degreesPerUnit:[1/f,1/m,1/o]};if(r){const C=$a*Math.tan(e*$a)/u,R=f*C/2,O=s/$7*C,U=O/m*o;T.unitsPerDegree2=[0,R,O],T.unitsPerMeter2=[U,0,U]}return T}function lx(n,e){const[t,r,s]=n,[u,f,m]=e,{unitsPerMeter:o,unitsPerMeter2:T}=mh({longitude:t,latitude:r,highPrecision:!0}),C=W7(n);C[0]+=u*(o[0]+T[0]*f),C[1]+=f*(o[1]+T[1]*f);const R=su(C),O=(s||0)+(m||0);return Number.isFinite(s)||Number.isFinite(m)?[R[0],R[1],O]:R}function DO(n){const{height:e,pitch:t,bearing:r,altitude:s,scale:u,center:f}=n,m=IO();V7(m,m,[0,0,-s]),Hv(m,m,-t*$a),Xv(m,m,r*$a);const o=u/e;return gf(m,m,[o,o,o]),f&&V7(m,m,mR([],f)),m}function LO(n){const{width:e,height:t,altitude:r,pitch:s=0,offset:u,center:f,scale:m,nearZMultiplier:o=1,farZMultiplier:T=1}=n;let{fovy:C=H7(RO)}=n;r!==void 0&&(C=H7(r));const R=C*$a,O=s*$a,U=cx(C);let V=U;f&&(V+=f[2]*m/Math.cos(O)/t);const Y=R*(.5+(u?u[1]:0)/t),ee=Math.sin(Y)*V/Math.sin(dh(Math.PI/2-O-Y,.01,Math.PI-.01)),le=Math.sin(O)*ee+V,Ee=V*10,ue=Math.min(le*T,Ee);return{fov:R,aspect:e/t,focalDistance:U,near:o,far:ue}}function H7(n){return 2*Math.atan(.5/n)*ph}function cx(n){return .5/Math.tan(.5*n*$a)}function ux(n,e){const[t,r,s=0]=n;return bc(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(s)),G4(e,[t,r,s,1])}function vf(n,e,t=0){const[r,s,u]=n;if(bc(Number.isFinite(r)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(u))return G4(e,[r,s,u,1]);const f=G4(e,[r,s,0,1]),m=G4(e,[r,s,1,1]),o=f[2],T=m[2],C=o===T?0:((t||0)-o)/(T-o);return jv([],f,m,C)}function FO(n){const{width:e,height:t,bounds:r,minExtent:s=0,maxZoom:u=24,offset:f=[0,0]}=n,[[m,o],[T,C]]=r,R=NO(n.padding),O=W7([m,dh(C,-85.051129,Og)]),U=W7([T,dh(o,-85.051129,Og)]),V=[Math.max(Math.abs(U[0]-O[0]),s),Math.max(Math.abs(U[1]-O[1]),s)],Y=[e-R.left-R.right-Math.abs(f[0])*2,t-R.top-R.bottom-Math.abs(f[1])*2];bc(Y[0]>0&&Y[1]>0);const ee=Y[0]/V[0],le=Y[1]/V[1],Ee=(R.right-R.left)/2/ee,ue=(R.top-R.bottom)/2/le,_e=[(U[0]+O[0])/2+Ee,(U[1]+O[1])/2+ue],Me=su(_e),Fe=Math.min(u,yf(Math.abs(Math.min(ee,le))));return bc(Number.isFinite(Fe)),{longitude:Me[0],latitude:Me[1],zoom:Fe}}function NO(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(bc(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const Dg=Math.PI/180;function BO(n,e=0){const{width:t,height:r,unproject:s}=n,u={targetZ:e},f=s([0,r],u),m=s([t,r],u);let o,T;const C=n.fovy?.5*n.fovy*Dg:Math.atan(.5/n.altitude),R=(90-n.pitch)*Dg;return C>R-.01?(o=Lg(n,0,e),T=Lg(n,t,e)):(o=s([0,0],u),T=s([t,0],u)),[f,m,T,o]}function Lg(n,e,t){const{pixelUnprojectionMatrix:r}=n,s=G4(r,[e,0,1,1]),u=G4(r,[e,n.height,1,1]),m=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(u[2]-s[2]),o=jv([],s,u,m),T=su(o);return T.push(t),T}const Fg=512;function zO(n){const{width:e,height:t,pitch:r=0}=n;let{longitude:s,latitude:u,zoom:f,bearing:m=0}=n;(s<-180||s>180)&&(s=kg(s+180,360)-180),(m<-180||m>180)&&(m=kg(m+180,360)-180);const o=yf(t/Fg);if(f<=o)f=o,u=0;else{const T=t/2/Math.pow(2,f),C=su([0,T])[1];if(u<C)u=C;else{const R=su([0,Fg-T])[1];u>R&&(u=R)}}return{width:e,height:t,longitude:s,latitude:u,zoom:f,pitch:r,bearing:m}}const hx=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,UO=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,VO=`
${hx}
${UO}
`,jO=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,$O=`
${hx}
${jO}
`,WO=V2(GO),HO=V2(YO),XO=[0,0,0,1],ZO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function qO(n,e){const[t,r,s]=n,u=vf([t,r,s],e);return Number.isFinite(s)?u:[u[0],u[1],0]}function GO({viewport:n,center:e}){return new E1(n.viewProjectionMatrix).invert().transform(e)}function YO({viewport:n,shadowMatrices:e}){const t=[],r=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,u=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(f=>qO(f,r));for(const f of e){const m=f.clone().translate(new T1(n.center).negate()),o=u.map(C=>m.transform(C)),T=new E1().ortho({left:Math.min(...o.map(C=>C[0])),right:Math.max(...o.map(C=>C[0])),bottom:Math.min(...o.map(C=>C[1])),top:Math.max(...o.map(C=>C[1])),near:Math.min(...o.map(C=>-C[2])),far:Math.max(...o.map(C=>-C[2]))});t.push(T.multiplyRight(f))}return t}function KO(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const r=_f.getUniforms(t),s=WO({viewport:t.viewport,center:r.center}),u=[],f=HO({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let o=0;o<n.shadowMatrices.length;o++){const T=f[o],C=T.clone().translate(new T1(t.viewport.center).negate());r.coordinateSystem===mr.LNGLAT&&r.projectionMode===Ua.WEB_MERCATOR?(f[o]=C,u[o]=s):(f[o]=T.clone().multiplyRight(ZO),u[o]=C.transform(s))}const m={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||XO,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let o=0;o<f.length;o++)m[`viewProjectionMatrix${o}`]=f[o],m[`projectCenter${o}`]=u[o];for(let o=0;o<2;o++)m[`shadow_uShadowMap${o}`]=n.shadowMaps&&n.shadowMaps[o]||n.dummyShadowMap;return m}const Ng={name:"shadow",dependencies:[_f],vs:VO,fs:$O,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:KO,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},$2={...dg,defaultUniforms:{...dg.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},JO=[Kv],QO=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],eD=[];function tD(n){const e=P7.getDefaultShaderAssembler();for(const r of JO)e.addDefaultModule(r);const t=n==="glsl"?QO:eD;for(const r of t)e.addShaderHook(r);return e}const nD=[255,255,255],rD=1;let iD=0;class sD{constructor(e={}){this.type="ambient";const{color:t=nD}=e,{intensity:r=rD}=e;this.id=e.id||`ambient-${iD++}`,this.color=t,this.intensity=r}}const oD=[255,255,255],aD=1,lD=[0,0,-1];let cD=0;class Bg{constructor(e={}){this.type="directional";const{color:t=oD}=e,{intensity:r=aD}=e,{direction:s=lD}=e,{_shadow:u=!1}=e;this.id=e.id||`directional-${cD++}`,this.color=t,this.intensity=r,this.type="directional",this.direction=new T1(s).normalize().toArray(),this.shadow=u}getProjectedLight(e){return this}}class uD{constructor(e,t={id:"pass"}){const{id:r}=t;this.id=r,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class xf extends uD{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,r]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,u=e.clearColor??(s?[0,0,0,0]:!1),f=s?1:!1,m=s?0:!1,o=e.colorMask??15,T={viewport:[0,0,t,r]};e.colorMask&&(T.colorMask=o),e.scissorRect&&(T.scissorRect=e.scissorRect);const C=this.device.beginRenderPass({framebuffer:e.target,parameters:T,clearColor:u,clearDepth:f,clearStencil:m});try{return this._drawLayers(C,e)}finally{C.end(),this.device.submit()}}_drawLayers(e,t){const{target:r,shaderModuleProps:s,viewports:u,views:f,onViewportActive:m,clearStack:o=!0}=t;t.pass=t.pass||"unknown",o&&(this._lastRenderIndex=-1);const T=[];for(const C of u){const R=f&&f[C.id];m==null||m(C);const O=this._getDrawLayerParams(C,t),U=C.subViewports||[C];for(const V of U){const Y=this._drawLayersInViewport(e,{target:r,shaderModuleProps:s,viewport:V,view:R,pass:t.pass,layers:t.layers},O);T.push(Y)}}return T}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:s=!1,layerFilter:u,cullRect:f,effects:m,shaderModuleProps:o},T=!1){var V;const C=[],R=fx(this._lastRenderIndex+1),O={layer:t[0],viewport:e,isPicking:s,renderPass:r,cullRect:f},U={};for(let Y=0;Y<t.length;Y++){const ee=t[Y],le=this._shouldDrawLayer(ee,O,u,U),Ee={shouldDrawLayer:le};le&&!T&&(Ee.shouldDrawLayer=!0,Ee.layerRenderIndex=R(ee,le),Ee.shaderModuleProps=this._getShaderModuleProps(ee,m,r,o),Ee.layerParameters={...(V=ee.context.deck)==null?void 0:V.props.parameters,...this.getLayerParameters(ee,Y,e)}),C[Y]=Ee}return C}_drawLayersInViewport(e,{layers:t,shaderModuleProps:r,pass:s,target:u,viewport:f,view:m},o){const T=hD(this.device,{shaderModuleProps:r,target:u,viewport:f});if(m&&m.props.clear){const R=m.props.clear===!0?{color:!0,depth:!0}:m.props.clear;this.device.beginRenderPass({framebuffer:u,parameters:{viewport:T,scissorRect:T},clearColor:R.color?[0,0,0,0]:!1,clearDepth:R.depth?1:!1}).end()}const C={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:T});for(let R=0;R<t.length;R++){const O=t[R],U=o[R],{shouldDrawLayer:V}=U;if(V&&O.props.pickable&&C.pickableCount++,O.isComposite&&C.compositeCount++,O.isDrawable&&U.shouldDrawLayer){const{layerRenderIndex:Y,shaderModuleProps:ee,layerParameters:le}=U;C.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,Y),ee.project&&(ee.project.viewport=f),O.context.renderPass=e;try{O._drawLayer({renderPass:e,shaderModuleProps:ee,uniforms:{layerIndex:Y},parameters:le})}catch(Ee){O.raiseError(Ee,`drawing ${O} to ${s}`)}}}return C}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,r){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let f=e.parent;for(;f;){if(!f.props.visible||!f.filterSubLayer(t))return!1;t.layer=f,f=f.parent}if(r){const m=t.layer.id;if(m in s||(s[m]=r(t)),!s[m])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,r,s){var o,T;const u=this.device.canvasContext.cssToDeviceRatio(),f=((o=e.internalState)==null?void 0:o.propsInTransition)||e.props,m={layer:f,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:u,modelMatrix:f.modelMatrix,coordinateSystem:f.coordinateSystem,coordinateOrigin:f.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const C of t)zg(m,(T=C.getShaderModuleProps)==null?void 0:T.call(C,e,m));return zg(m,this.getShaderModuleProps(e,t,m),s)}}function fx(n=0,e={}){const t={},r=(s,u)=>{const f=s.props._offset,m=s.id,o=s.parent&&s.parent.id;let T;if(o&&!(o in e)&&r(s.parent,!1),o in t){const C=t[o]=t[o]||fx(e[o],e);T=C(s,u),t[m]=C}else Number.isFinite(f)?(T=f+(e[o]||0),t[m]=null):T=n;return u&&T>=n&&(n=T+1),e[m]=T,T};return r}function hD(n,{shaderModuleProps:e,target:t,viewport:r}){var o;const s=((o=e==null?void 0:e.project)==null?void 0:o.devicePixelRatio)??n.canvasContext.cssToDeviceRatio(),[,u]=n.canvasContext.getDrawingBufferSize(),f=t?t.height:u,m=r;return[m.x*s,f-(m.y+m.height)*s,m.width*s,m.height*s]}function zg(n,...e){for(const t of e)if(t)for(const r in t)n[r]?Object.assign(n[r],t[r]):n[r]=t[r];return n}class fD extends xf{constructor(e,t){super(e,t);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),s=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],u=s.width*r,f=s.height*r,m=[1,1,1,1];(u!==t.width||f!==t.height)&&t.resize({width:u,height:f}),super.render({...e,clearColor:m,target:t,pass:"shadow"})}getLayerParameters(e,t,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const dD={color:[255,255,255],intensity:1},Ug=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],pD=[0,0,0,200/255];class dx{constructor(e={}){this.id="lighting-effect",this.shadowColor=pD,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),r._addDefaultShaderModule(Ng),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:r,onViewportActive:s,views:u}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let f=0;f<this.shadowPasses.length;f++)this.shadowPasses[f].render({layers:e,layerFilter:t,viewports:r,onViewportActive:s,views:u,shaderModuleProps:{shadow:{shadowLightId:f,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const r=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(f=>f.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(f=>f.getProjectedLight({layer:e})),pointLights:this.pointLights.map(f=>f.getProjectedLight({layer:e}))},u=e.props.material;return{shadow:r,lighting:s,phongMaterial:u,gouraudMaterial:u}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Ng))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new E1().lookAt({eye:new T1(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new fD(e);this.shadowPasses[t]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new sD(dD),this.directionalLights.push(new Bg(Ug[0]),new Bg(Ug[1])))}}class mD{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:s,padding:u=0,copy:f=!1,initialize:m=!1,maxCount:o}){const T=s||e&&e.constructor||Float32Array,C=t*r+u;if(ArrayBuffer.isView(e)){if(C<=e.length)return e;if(C*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new T(e.buffer,0,C)}let R=1/0;o&&(R=o*r+u);const O=this._allocate(T,C,m,R);return e&&f?O.set(e):m||O.fill(0,0,4),this._release(e),O}release(e){this._release(e)}_allocate(e,t,r,s){let u=Math.max(Math.ceil(t*this.opts.overAlloc),1);u>s&&(u=s);const f=this._pool,m=e.BYTES_PER_ELEMENT*u,o=f.findIndex(T=>T.byteLength>=m);if(o>=0){const T=new e(f.splice(o,1)[0],0,u);return r&&T.fill(0),T}return new e(u)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:s}=r,u=t.findIndex(f=>f.byteLength>=s);u<0?t.push(r):(u>0||t.length<this.opts.poolSize)&&t.splice(u,0,r),t.length>this.opts.poolSize&&t.shift()}}const ou=new mD;function u2(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function gD(n){return[n[12],n[13],n[14]]}function _D(n){return{left:N4(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:N4(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:N4(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:N4(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:N4(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:N4(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const Vg=new T1;function N4(n,e,t,r){Vg.set(n,e,t);const s=Vg.len();return{distance:r/s,normal:new T1(-n/s,-e/s,-t/s)}}function yD(n){return n-Math.fround(n)}let i2;function o9(n,e){const{size:t=1,startIndex:r=0}=e,s=e.endIndex!==void 0?e.endIndex:n.length,u=(s-r)/t;i2=ou.allocate(i2,u,{type:Float32Array,size:t*2});let f=r,m=0;for(;f<s;){for(let o=0;o<t;o++){const T=n[f++];i2[m+o]=T,i2[m+o+t]=yD(T)}m+=t*2}return i2.subarray(0,u*t*2)}function vD(n){let e=null,t=!1;for(const r of n)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const xD=Math.PI/180,bD=u2(),jg=[0,0,0],wD={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function TD({width:n,height:e,orthographic:t,fovyRadians:r,focalDistance:s,padding:u,near:f,far:m}){const o=n/e,T=t?new E1().orthographic({fovy:r,aspect:o,focalDistance:s,near:f,far:m}):new E1().perspective({fovy:r,aspect:o,near:f,far:m});if(u){const{left:C=0,right:R=0,top:O=0,bottom:U=0}=u,V=y3((C+n-R)/2,0,n)-n/2,Y=y3((O+e-U)/2,0,e)-e/2;T[8]-=V*2/n,T[9]+=Y*2/e}return T}class W2{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||wD,this.focalDistance=e.focalDistance||1,this.position=e.position||jg,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ua.WEB_MERCATOR:Ua.WEB_MERCATOR_AUTO_OFFSET:Ua.IDENTITY}equals(e){return e instanceof W2?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&M2(e.projectionMatrix,this.projectionMatrix)&&M2(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),s=ux(r,this.pixelProjectionMatrix),[u,f]=s,m=t?f:this.height-f;return e.length===2?[u,m]:[u,m,s[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[s,u,f]=e,m=t?u:this.height-u,o=r&&r*this.distanceScales.unitsPerMeter[2],T=vf([s,m,f],this.pixelUnprojectionMatrix,o),[C,R,O]=this.unprojectPosition(T);return Number.isFinite(f)?[C,R,O]:Number.isFinite(r)?[C,R,r]:[C,R]}projectPosition(e){const[t,r]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,s]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,s]}projectFlat(e){if(this.isGeospatial){const t=W7(e);return t[1]=y3(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?su(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),s=this.unproject([this.width,0],t),u=this.unproject([0,this.height],t),f=this.unproject([this.width,this.height],t);return[Math.min(r[0],s[0],u[0],f[0]),Math.min(r[1],s[1],u[1],f[1]),Math.max(r[0],s[0],u[0],f[0]),Math.max(r[1],s[1],u[1],f[1])]}getDistanceScales(e){return e&&this.isGeospatial?mh({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:s=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,_D(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=OO({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||mh({latitude:r,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:u,modelMatrix:f}=e;let m=jg;if(u&&(m=f?new E1(f).transformAsVector(u,[]):u),this.isGeospatial){const o=this.projectPosition([t,r,0]);this.center=new T1(m).scale(this.distanceScales.unitsPerMeter).add(o)}else this.center=this.projectPosition(m)}_initMatrices(e){const{viewMatrix:t=bD,projectionMatrix:r=null,orthographic:s=!1,fovyRadians:u,fovy:f=75,near:m=.1,far:o=1e3,padding:T=null,focalDistance:C=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new E1().multiplyRight(t).translate(new T1(this.center).negate()),this.projectionMatrix=r||TD({width:this.width,height:this.height,orthographic:s,fovyRadians:u||f*xD,focalDistance:C,padding:T,near:m,far:o});const R=u2();L0(R,R,this.projectionMatrix),L0(R,R,this.viewMatrix),this.viewProjectionMatrix=R,this.viewMatrixInverse=oh([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=gD(this.viewMatrixInverse);const O=u2(),U=u2();gf(O,O,[this.width/2,-this.height/2,1]),V7(O,O,[1,-1,0]),L0(U,O,this.viewProjectionMatrix),this.pixelProjectionMatrix=U,this.pixelUnprojectionMatrix=oh(u2(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||lr.warn("Pixel project matrix not invertible")()}}W2.displayName="Viewport";class au extends W2{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:s=0,pitch:u=0,bearing:f=0,nearZMultiplier:m=.1,farZMultiplier:o=1.01,nearZ:T,farZ:C,orthographic:R=!1,projectionMatrix:O,repeat:U=!1,worldOffset:V=0,position:Y,padding:ee,legacyMeterSizes:le=!1}=e;let{width:Ee,height:ue,altitude:_e=1.5}=e;const Me=Math.pow(2,s);Ee=Ee||1,ue=ue||1;let Fe,yt=null;if(O)_e=O[5]/2,Fe=H7(_e);else{e.fovy?(Fe=e.fovy,_e=cx(Fe)):Fe=H7(_e);let ht;if(ee){const{top:kt=0,bottom:Bt=0}=ee;ht=[0,y3((kt+ue-Bt)/2,0,ue)-ue/2]}yt=LO({width:Ee,height:ue,scale:Me,center:Y&&[0,0,Y[2]*s9(t)],offset:ht,pitch:u,fovy:Fe,nearZMultiplier:m,farZMultiplier:o}),Number.isFinite(T)&&(yt.near=T),Number.isFinite(C)&&(yt.far=C)}let xt=DO({height:ue,pitch:u,bearing:f,scale:Me,altitude:_e});V&&(xt=new E1().translate([512*V,0,0]).multiplyLeft(xt)),super({...e,width:Ee,height:ue,viewMatrix:xt,longitude:r,latitude:t,zoom:s,...yt,fovy:Fe,focalDistance:_e}),this.latitude=t,this.longitude=r,this.zoom=s,this.pitch=u,this.bearing=f,this.altitude=_e,this.fovy=Fe,this.orthographic=R,this._subViewports=U?[]:null,this._pseudoMeters=le,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let s=t;s<=r;s++){const u=s?new au({...this,worldOffset:s}):this;this._subViewports.push(u)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),s=(e[2]||0)*s9(e[1]);return[t,r,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),s=(e[2]||0)/s9(r);return[t,r,s]}addMetersToLngLat(e,t){return lx(e,t)}panByPosition(e,t){const r=vf(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),u=hg([],s,cR([],r)),f=hg([],this.center,u),[m,o]=this.unprojectFlat(f);return{longitude:m,latitude:o}}getBounds(e={}){const t=BO(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:s}=this,{longitude:u,latitude:f,zoom:m}=FO({width:r,height:s,bounds:e,...t});return new au({width:r,height:s,longitude:u,latitude:f,zoom:m})}}au.displayName="WebMercatorViewport";const $g=[0,0,0];function a9(n,e,t=!1){const r=e.projectPosition(n);if(t&&e instanceof au){const[s,u,f=0]=n,m=e.getDistanceScales([s,u]);r[2]=f*m.unitsPerMeter[2]}return r}function ED(n){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=n;let{coordinateSystem:s,fromCoordinateSystem:u,fromCoordinateOrigin:f}=n;return s===mr.DEFAULT&&(s=e.isGeospatial?mr.LNGLAT:mr.CARTESIAN),u===void 0&&(u=s),f===void 0&&(f=r),{viewport:e,coordinateSystem:s,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:u,fromCoordinateOrigin:f}}function px(n,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:s,offsetMode:u}){let[f,m,o=0]=n;switch(t&&([f,m,o]=U2([],[f,m,o,1],t)),r){case mr.LNGLAT:return a9([f,m,o],e,u);case mr.LNGLAT_OFFSETS:return a9([f+s[0],m+s[1],o+(s[2]||0)],e,u);case mr.METER_OFFSETS:return a9(lx(s,[f,m,o]),e,u);case mr.CARTESIAN:default:return e.isGeospatial?[f+s[0],m+s[1],o+s[2]]:e.projectPosition([f,m,o])}}function SD(n,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:s,modelMatrix:u,fromCoordinateSystem:f,fromCoordinateOrigin:m}=ED(e),{autoOffset:o=!0}=e,{geospatialOrigin:T=$g,shaderCoordinateOrigin:C=$g,offsetMode:R=!1}=o?ox(t,r,s):{},O=px(n,{viewport:t,modelMatrix:u,coordinateSystem:f,coordinateOrigin:m,offsetMode:R});if(R){const U=t.projectPosition(T||C);ER(O,O,U)}return O}let AD=1,CD=1;class mx{constructor(){ne(this,"time",0);ne(this,"channels",new Map);ne(this,"animations",new Map);ne(this,"playing",!1);ne(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:s=1,repeat:u=1}=e,f=AD++,m={time:0,delay:t,duration:r,rate:s,repeat:u};return this._setChannelTime(m,this.time),this.channels.set(f,m),f}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const r=this.animations.values();for(const s of r){const{animation:u,channel:f}=s;u.setTime(this.getTime(f))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=CD++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,s=e.duration*e.repeat;r>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function PD(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function ID(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let MD=0;const RD={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:G9.stats.get(`animation-loop-${MD++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class kD{constructor(e){ne(this,"device",null);ne(this,"canvas",null);ne(this,"props");ne(this,"animationProps",null);ne(this,"timeline",null);ne(this,"stats");ne(this,"cpuTime");ne(this,"gpuTime");ne(this,"frameRate");ne(this,"display");ne(this,"needsRedraw","initialized");ne(this,"_initialized",!1);ne(this,"_running",!1);ne(this,"_animationFrameId",null);ne(this,"_nextFramePromise",null);ne(this,"_resolveNextFrame",null);ne(this,"_cpuStartTime",0);ne(this,"_error",null);if(this.props={...RD,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new g6({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var r,s;if(this.props.onError(e),this._error=Error(),((s=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:s.canvas)instanceof HTMLCanvasElement){const u=document.createElement("h1");u.innerHTML=e.message,u.style.position="absolute",u.style.top="20%",u.style.left="10px",u.style.color="black",u.style.backgroundColor="red",document.body.appendChild(u)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=PD(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(ID(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,r;const e=(r=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:r.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){var u,f,m,o;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((f=(u=this.device)==null?void 0:u.canvasContext)==null?void 0:f.getPixelSize())||[1,1];let r=1;const s=(o=(m=this.device)==null?void 0:m.canvasContext)==null?void 0:o.canvas;return s&&s.clientHeight?r=s.clientWidth/s.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const l9={};function x6(n="id"){l9[n]=l9[n]||1;const e=l9[n]++;return`${n}-${e}`}class Wg{constructor(e){ne(this,"id");ne(this,"userData",{});ne(this,"topology");ne(this,"bufferLayout",[]);ne(this,"vertexCount");ne(this,"indices");ne(this,"attributes");if(this.id=e.id||x6("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Jr.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function OD(n,e){if(e instanceof Wg)return e;const t=DD(n,e),{attributes:r,bufferLayout:s}=LD(n,e);return new Wg({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:r})}function DD(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:Jr.INDEX,data:t})}function LD(n,e){const t=[],r={};for(const[u,f]of Object.entries(e.attributes)){let m=u;switch(u){case"POSITION":m="positions";break;case"NORMAL":m="normals";break;case"TEXCOORD_0":m="texCoords";break;case"COLOR_0":m="colors";break}if(f){r[m]=n.createBuffer({data:f.value,id:`${u}-buffer`});const{value:o,size:T,normalized:C}=f;t.push({name:m,format:TM(o,T,C)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:t,vertexCount:s}}const h6=class h6{constructor(e){ne(this,"device");ne(this,"destroyPolicy");ne(this,"_hashCounter",0);ne(this,"_hashes",{});ne(this,"_renderPipelineCache",{});ne(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new h6(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...eu.defaultProps,...e},r=this._hashRenderPipeline(t);if(!this._renderPipelineCache[r]){const s=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=r,this._renderPipelineCache[r]={pipeline:s,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const t={...O7.defaultProps,...e},r=this._hashComputePipeline(t);if(!this._computePipelineCache[r]){const s=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=r,this._computePipelineCache[r]={pipeline:s,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const t=e.hash,r=e instanceof O7?this._computePipelineCache:this._renderPipelineCache;r[t].useCount--,r[t].useCount===0&&this.destroyPolicy==="unused"&&(r[t].pipeline.destroy(),delete r[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,s="-",u=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${r}V${s}BL${u}`;default:const f=this._getHash(JSON.stringify(e.parameters));return`${t}/${r}V${s}T${e.topology}P${f}BL${u}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};ne(h6,"defaultProps",{...eu.defaultProps});let gh=h6;const f6=class f6{constructor(e){ne(this,"device");ne(this,"destroyPolicy");ne(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new f6(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let r=this._cache[t];if(!r){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:s,useCount:0}}return r.useCount++,r.shader}release(e){const t=this._hashShader(e),r=this._cache[t];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};ne(f6,"defaultProps",{...M7.defaultProps});let _h=f6;function FD(n,e){var s;const t={},r="Values";if(n.attributes.length===0&&!((s=n.varyings)!=null&&s.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const u of n.attributes)if(u){const f=`${u.location} ${u.name}: ${u.type}`;t[`in ${f}`]={[r]:u.stepMode||"vertex"}}for(const u of n.varyings||[]){const f=`${u.location} ${u.name}`;t[`out ${f}`]={[r]:JSON.stringify(u)}}return t}let gs=null,C0=null;function ND(n,{id:e,minimap:t,opaque:r,top:s="0",left:u="0",rgbaScale:f=1}){gs||(gs=document.createElement("canvas"),gs.id=e,gs.title=e,gs.style.zIndex="100",gs.style.position="absolute",gs.style.top=s,gs.style.left=u,gs.style.border="blue 5px solid",gs.style.transform="scaleY(-1)",document.body.appendChild(gs),C0=gs.getContext("2d")),(gs.width!==n.width||gs.height!==n.height)&&(gs.width=n.width/2,gs.height=n.height/2,gs.style.width="400px",gs.style.height="400px");const m=n.device.readPixelsToArrayWebGL(n),o=C0==null?void 0:C0.createImageData(n.width,n.height);if(o){for(let C=0;C<m.length;C+=4)o.data[0+C+0]=m[C+0]*f,o.data[0+C+1]=m[C+1]*f,o.data[0+C+2]=m[C+2]*f,o.data[0+C+3]=r?255:m[C+3]*f;C0==null||C0.putImageData(o,0,0)}}function yh(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!yh(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(const u of r)if(!e.hasOwnProperty(u)||!yh(n[u],e[u],t-1))return!1;return!0}return!1}function BD(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function zD(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function gx(n){return BD(n)||zD(n)}function UD(n){return gx(n)||typeof n=="number"||typeof n=="boolean"}function _x(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];UD(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}class VD{constructor(e,t){ne(this,"options",{disableWarnings:!1});ne(this,"modules");ne(this,"moduleUniforms");ne(this,"moduleBindings");Object.assign(this.options,t);const r=sf(Object.values(e).filter(s=>s.dependencies));for(const s of r)e[s.name]=s;jt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,u]of Object.entries(e))this._addModule(u),u.name&&s!==u.name&&!this.options.disableWarnings&&jt.warn(`Module name: ${s} vs ${u.name}`)()}destroy(){}setProps(e){var t;for(const r of Object.keys(e)){const s=r,u=e[s]||{},f=this.modules[s];if(!f){this.options.disableWarnings||jt.warn(`Module ${r} not found`)();continue}const m=this.moduleUniforms[s],o=this.moduleBindings[s],T=((t=f.getUniforms)==null?void 0:t.call(f,u,m))||u,{uniforms:C,bindings:R}=_x(T);this.moduleUniforms[s]={...m,...C},this.moduleBindings[s]={...o,...R}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[r,s]of Object.entries(this.moduleUniforms))for(const[u,f]of Object.entries(s))e[`${r}.${u}`]={type:(t=this.modules[r].uniformTypes)==null?void 0:t[u],value:String(f)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let jD="";async function $D(n,e){const t=new Image;return t.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",t.src=n.startsWith("http")?n:jD+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class c9{constructor(e,t){ne(this,"device");ne(this,"id");ne(this,"texture");ne(this,"sampler");ne(this,"view");ne(this,"ready");ne(this,"isReady",!1);ne(this,"destroyed",!1);ne(this,"resolveReady",()=>{});ne(this,"rejectReady",()=>{});this.device=e,this.id=t.id||x6("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:$D(t.data)}),this.ready=new Promise((r,s)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=s}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data;let r;try{r=await yx(t)}catch(u){this.rejectReady(u)}if(this.destroyed)return;const s={...e,data:r};this.texture=this.device.createTexture(s),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function yx(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(yx));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),r=Object.keys(e),s={};for(let u=0;u<r.length;u++)s[r[u]]=t[u];return s}return n}const P0=2,WD=1e4,d6=class d6{constructor(e,t){ne(this,"device");ne(this,"id");ne(this,"source");ne(this,"vs");ne(this,"fs");ne(this,"pipelineFactory");ne(this,"shaderFactory");ne(this,"userData",{});ne(this,"parameters");ne(this,"topology");ne(this,"bufferLayout");ne(this,"isInstanced");ne(this,"instanceCount",0);ne(this,"vertexCount");ne(this,"indexBuffer",null);ne(this,"bufferAttributes",{});ne(this,"constantAttributes",{});ne(this,"bindings",{});ne(this,"uniforms",{});ne(this,"vertexArray");ne(this,"transformFeedback",null);ne(this,"pipeline");ne(this,"shaderInputs");ne(this,"_uniformStore");ne(this,"_attributeInfos",{});ne(this,"_gpuGeometry",null);ne(this,"_getModuleUniforms");ne(this,"props");ne(this,"_pipelineNeedsUpdate","newly created");ne(this,"_needsRedraw","initializing");ne(this,"_destroyed",!1);ne(this,"_lastDrawTimestamp",-1);ne(this,"_lastLogTime",0);ne(this,"_logOpen",!1);ne(this,"_drawCount",0);var o,T,C,R;this.props={...d6.defaultProps,...t},t=this.props,this.id=t.id||x6("model"),this.device=e,Object.assign(this.userData,t.userData);const r=Object.fromEntries(((o=this.props.modules)==null?void 0:o.map(O=>[O.name,O]))||[]),s=t.shaderInputs||new VD(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const u=XD(e),f=(((T=this.props.modules)==null?void 0:T.length)>0?this.props.modules:(C=this.shaderInputs)==null?void 0:C.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:O,getUniforms:U}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:u,...this.props,modules:f});this.source=O,this._getModuleUniforms=U,(R=this.props).shaderLayout||(R.shaderLayout=QM(this.source))}else{const{vs:O,fs:U,getUniforms:V}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:u,...this.props,modules:f});this.vs=O,this.fs=U,this._getModuleUniforms=V}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||gh.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||_h.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return jt.info(P0,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings}),vh(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:u}=this.vertexArray,f=u?u.byteLength/(u.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:f,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const t=e&&OD(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const s=new G5(this.bufferLayout);this.bufferLayout=s.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new G5(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){yh(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new wM(this.shaderInputs.modules);for(const[t,r]of Object.entries(this.shaderInputs.modules))if(HD(r)){const s=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const r=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&jt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=EM(this.pipeline.shaderLayout,this.bufferLayout);const s=new G5(this.bufferLayout);for(const[u,f]of Object.entries(e)){const m=s.getBufferLayout(u);if(!m){r||jt.warn(`Model(${this.id}): Missing layout for buffer "${u}".`)();continue}const o=s.getAttributeNamesForBuffer(m);let T=!1;for(const C of o){const R=this._attributeInfos[C];if(R){const O=this.device.type==="webgpu"?s.getBufferIndex(R.bufferName):R.location;this.vertexArray.setBuffer(O,f),T=!0}}!T&&!r&&jt.warn(`Model(${this.id}): Ignoring buffer "${f.id}" for unknown attribute "${u}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[r,s]of Object.entries(e)){const u=this._attributeInfos[r];u?this.vertexArray.setConstantWebGL(u.location,s):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||jt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){vh(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:r}=_x(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof c9&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,r]of Object.entries(this.bindings))r instanceof c9?r.isReady&&(e[t]=r.texture):e[t]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof I7?e=Math.max(e,t.texture.updateTimestamp):t instanceof Jr||t instanceof wi?e=Math.max(e,t.updateTimestamp):t instanceof c9?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof R7||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[r]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===r)&&r!=="positions"&&delete t[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(jt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=r:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:s}),this._attributeInfos=gv(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=jt.level>3?0:WD;jt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,jt.group(P0,`>>> DRAWING MODEL ${this.id}`,{collapsed:jt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=FD(this.pipeline.shaderLayout,this.id);jt.table(P0,e)();const t=this.shaderInputs.getDebugTable();for(const[s,u]of Object.entries(this.uniforms))t[s]={value:u};jt.table(P0,t)();const r=this._getAttributeDebugTable();jt.table(P0,this._attributeInfos)(),jt.table(P0,r)(),jt.groupEnd(P0)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const r=e.props.framebuffer;r&&ND(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,r]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[r.location];e[r.location]={name:t,type:r.shaderType,values:s?this._getBufferOrConstantValues(s,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,r=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){const r=vv(t);return(e instanceof Jr?new r(e.debugData):e).toString()}};ne(d6,"defaultProps",{...eu.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:P7.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Ll=d6;function HD(n){return!!(n.uniformTypes&&!vh(n.uniformTypes))}function XD(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function vh(n){for(const e in n)return!1;return!0}const S2=class S2{constructor(e,t=S2.defaultProps){ne(this,"device");ne(this,"model");ne(this,"transformFeedback");if(!S2.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Ll(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||SI(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Jr)return t.readAsync();const{buffer:r,byteOffset:s=0,byteLength:u=r.byteLength}=t;return r.readAsync(s,u)}};ne(S2,"defaultProps",{...Ll.defaultProps,outputs:void 0,feedbackBuffers:void 0});let k2=S2;class lu{constructor(e){ne(this,"id");ne(this,"topology");ne(this,"vertexCount");ne(this,"indices");ne(this,"attributes");ne(this,"userData",{});const{attributes:t={},indices:r=null,vertexCount:s=null}=e;this.id=e.id||x6("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[u,f]of Object.entries(t)){const m=ArrayBuffer.isView(f)?{value:f}:f;if(!ArrayBuffer.isView(m.value))throw new Error(`${this._print(u)}: must be typed array or object with value as typed array`);if((u==="POSITION"||u==="positions")&&!m.size&&(m.size=3),u==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=m}else this.attributes[u]=m}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const s of Object.values(e)){const{value:u,size:f,constant:m}=s;!m&&u&&f!==void 0&&f>=1&&(r=Math.min(r,u.length/f))}return r}}const ZD={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class vx extends xf{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:s,onViewportActive:u,pickingFBO:f,deviceRect:{x:m,y:o,width:T,height:C},cullRect:R,effects:O,pass:U="picking",pickZ:V,shaderModuleProps:Y}){this.pickZ=V;const ee=this._resetColorEncoder(V),le=[m,o,T,C],Ee=super.render({target:f,layers:e,layerFilter:t,views:r,viewports:s,onViewportActive:u,cullRect:R,effects:O==null?void 0:O.filter(_e=>_e.useInPicking),pass:U,isPicking:!0,shaderModuleProps:Y,clearColor:[0,0,0,0],colorMask:15,scissorRect:le});return this._colorEncoderState=null,{decodePickingColor:ee&&GD.bind(null,ee),stats:Ee}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,t,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,r){const s={...e.props.parameters},{pickable:u,operation:f}=e.props;return!this._colorEncoderState||f.includes("terrain")?s.blend=!1:u&&f.includes("draw")&&(Object.assign(s,ZD),s.blend=!0,s.blendColor=qD(this._colorEncoderState,e,r)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function qD(n,e,t){const{byLayer:r,byAlpha:s}=n;let u,f=r.get(e);return f?(f.viewports.push(t),u=f.a):(u=r.size+1,u<=255?(f={a:u,layer:e,viewports:[t]},r.set(e,f),s[u]=f):(lr.warn("Too many pickable layers, only picking the first 255")(),u=0)),[0,0,0,u/255]}function GD(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const z4={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},X7=Symbol.for("component"),S3=Symbol.for("propTypes"),u9=Symbol.for("deprecatedProps"),Y4=Symbol.for("asyncPropDefaults"),U0=Symbol.for("asyncPropOriginal"),v3=Symbol.for("asyncPropResolved");function bf(n,e=()=>!0){return Array.isArray(n)?xx(n,e,[]):e(n)?[n]:[]}function xx(n,e,t){let r=-1;for(;++r<n.length;){const s=n[r];Array.isArray(s)?xx(s,e,t):e(s)&&t.push(s)}return t}function YD({target:n,source:e,start:t=0,count:r=1}){const s=e.length,u=r*s;let f=0;for(let m=t;f<s;f++)n[m++]=e[f];for(;f<u;)f<u-f?(n.copyWithin(t+f,t,t+f),f*=2):(n.copyWithin(t+f,t,t+u-f),f=u);return n}class KD{constructor(e,t,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let s=e;typeof e=="string"&&(s=S7(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(u=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=u)}).catch(u=>{this._loadCount===r&&(this.isLoaded=!0,this._error=u||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const u of this._subscribers)u.onChange(this.getData())}}class JD{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:s=!0}){let u=this._resources[e];u?u.setData(t,r):(u=new KD(e,t,this._context),this._resources[e]=u),u.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const r in t){const s=t[r],u=this._resources[s.resourceId];u&&u.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:s="default"}){const{_resources:u,protocol:f}=this;e.startsWith(f)&&(e=e.replace(f,""),u[e]||this.add({resourceId:e,data:null,persistent:!1}));const m=u[e];if(this._track(r,s,m,t),m)return m.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,s){const u=this._consumers,f=u[e]=u[e]||{};let m=f[t];const o=m&&m.resourceId&&this._resources[m.resourceId];o&&(o.unsubscribe(m),this.prune()),r&&(m?(m.onChange=s,m.resourceId=r.id):m={onChange:s,resourceId:r.id},f[t]=m,r.subscribe(m))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const QD="layerManager.setLayers",eL="layerManager.activateViewport";class tL{constructor(e,t){var m;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=o=>{eo(eL,this,o),o&&(this.context.viewport=o)};const{deck:r,stats:s,viewport:u,timeline:f}=t||{};this.layers=[],this.resourceManager=new JD({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:tD(((m=e==null?void 0:e.info)==null?void 0:m.shadingLanguage)||"glsl"),defaultShaderModules:[hk],renderPass:void 0,stats:s||new g6({id:"deck.gl"}),viewport:u||new W2({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:f||new mx,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const s=r.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){eo(QD,this,t,e),this._lastRenderedLayers=e;const r=bf(e,Boolean);for(const s of r)s.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(r=>r.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,r=t.findIndex(s=>s.name===e.name);r>=0&&(t.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,r){r.raiseError(t,`${e} of ${r}`)}_updateLayers(e,t){const r={};for(const f of e)r[f.id]?lr.warn(`Multiple old layers with same id ${f.id}`)():r[f.id]=f;if(this._defaultShaderModulesChanged){for(const f of e)f.setNeedsUpdate(),f.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,r,s),this._finalizeOldLayers(r);let u=!1;for(const f of s)if(f.hasUniformTransition()){u=`Uniform transition in ${f}`;break}this._needsUpdate=u,this.layers=s}_updateSublayersRecursively(e,t,r){for(const s of e){s.context=this.context;const u=t[s.id];u===null&&lr.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let f=null;try{this._debug&&u!==s&&s.validateProps(),u?(this._transferLayerState(u,s),this._updateLayer(s)):this._initializeLayer(s),r.push(s),f=s.isComposite?s.getSubLayers():null}catch(m){this._handleError("matching",m,s)}f&&this._updateSublayersRecursively(f,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=z4.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=z4.MATCHED,t!==e&&(e.lifecycle=z4.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=z4.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=z4.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Ol(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!Ol(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(const u of r)if(!e.hasOwnProperty(u)||!Ol(n[u],e[u],t-1))return!1;return!0}return!1}class nL{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),s={x:e[0],y:e[1]};for(let u=r.length-1;u>=0;--u){const f=r[u];if(f.containsPixel(s)){const m=e.slice();return m[0]-=f.x,m[1]-=f.y,f.unproject(m,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=bf(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ol(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):lr.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:u=>{var f;return(f=this.getView(e.id))==null?void 0:f.makeViewport({viewState:u,width:this.width,height:this.height})}})}_updateController(e,t,r,s){const u=e.controller;if(u&&r){const f={...t,...u,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!s||s.constructor!==u.type)&&(s=this._createController(e,f)),s&&s.setProps(f),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let s=e.length;s--;){const u=e[s],f=this.getViewState(u),m=u.makeViewport({viewState:f,width:this.width,height:this.height});let o=t[u.id];const T=!!u.controller;T&&!o&&(r=!0),(r||!T)&&o&&(o.finalize(),o=null),this.controllers[u.id]=this._updateController(u,f,m,o),m&&this._viewports.unshift(m)}for(const s in t){const u=t[s];u&&!this.controllers[s]&&u.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,s)=>!e[s].equals(t[s]))}}const rL=/([0-9]+\.?[0-9]*)(%|px)/;function c3(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=rL.exec(n);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function u3(n,e){return n.relative?Math.round(n.position*e):n.position}class cu{constructor(e){const{id:t,x:r=0,y:s=0,width:u="100%",height:f="100%",padding:m=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=c3(r),this._y=c3(s),this._width=c3(u),this._height=c3(f),this._padding=m&&{left:c3(m.left||0),right:c3(m.right||0),top:c3(m.top||0),bottom:c3(m.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ol(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:r}){r=this.filterViewState(r);const s=this.getDimensions({width:e,height:t});if(!s.height||!s.width)return null;const u=this.getViewportType(r);return new u({...r,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){const r={x:u3(this._x,e),y:u3(this._y,t),width:u3(this._width,e),height:u3(this._height,t)};return this._padding&&(r.padding={left:u3(this._padding.left,e),top:u3(this._padding.top,t),right:u3(this._padding.right,e),bottom:u3(this._padding.bottom,t)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class b6{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(t=this.settings).onStart)==null||r.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:s}=this;this._handle=r.addChannel({delay:r.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Hg=()=>{},xh={BREAK:1,SNAP_TO_END:2,IGNORE:3},iL=n=>n,sL=xh.BREAK;class oL{constructor(e){this._onTransitionUpdate=t=>{const{time:r,settings:{interpolator:s,startProps:u,endProps:f,duration:m,easing:o}}=t,T=o(r/m),C=s.interpolateProps(u,f,T);this.propsInTransition=this.getControllerState({...this.props,...C}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new b6(e.timeline),this.onViewStateChange=e.onViewStateChange||Hg,this.onStateChange=e.onStateChange||Hg}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let s=r;if(this.transition.inProgress){const{interruption:u,endProps:f}=this.transition.settings;s={...r,...u===xh.SNAP_TO_END?f:this.propsInTransition||r}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===xh.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(r),u=t.transitionInterpolator,f=u.getDuration?u.getDuration(e,t):t.transitionDuration;if(f===0)return;const m=u.initializeProps(e,s);this.propsInTransition={};const o={duration:f,easing:t.transitionEasing||iL,interpolator:u,interruption:t.transitionInterruption||sL,startProps:m.start,endProps:m.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(o),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function Fs(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class aL{constructor(e){const{compare:t,extract:r,required:s}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=s}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!M2(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},s={};for(const u of this._propsToExtract)(u in e||u in t)&&(r[u]=e[u],s[u]=t[u]);return this._checkRequiredProps(r),this._checkRequiredProps(s),{start:r,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];Fs(Number.isFinite(r)||Array.isArray(r),`${t} is required for transition`)})}}const lL=["longitude","latitude","zoom","bearing","pitch"],cL=["longitude","latitude","zoom"];class bx extends aL{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:lL,required:cL},super(r.transitionProps),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:s,around:u}=this.opts;if(s&&u){const f=s(e),m=s(t),o=f.unproject(u);r.start.around=u,Object.assign(r.end,{around:m.project(o),aroundPosition:o,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const s={};for(const u of this._propsToExtract)s[u]=U7(e[u]||0,t[u]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const u=this.opts.makeViewport({...t,...s});Object.assign(s,u.panByPosition(t.aroundPosition,U7(e.around,t.around,r)))}return s}}const h3={transitionDuration:0},uL=300,W8=n=>1-(1-n)*(1-n),B4={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},I0={};class hL{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new oL({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-r]}isPointInBounds(e,t){const{width:r,height:s}=this.props;if(t&&t.handled)return!1;const u=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=s;return u&&t&&t.stopPropagation(),u}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?uL:0;const{scrollZoom:r=!0,dragPan:s=!0,dragRotate:u=!0,doubleClickZoom:f=!0,touchZoom:m=!0,touchRotate:o=!1,keyboard:T=!0}=e,C=!!this.onViewStateChange;this.toggleEvents(B4.WHEEL,C&&r),this.toggleEvents(B4.PAN,C),this.toggleEvents(B4.PINCH,C&&(m||o)),this.toggleEvents(B4.MULTI_PAN,C&&o),this.toggleEvents(B4.DOUBLE_CLICK,C&&f),this.toggleEvents(B4.KEYBOARD,C&&T),this.scrollZoom=r,this.dragPan=s,this.dragRotate=u,this.doubleClickZoom=f,this.touchZoom=m,this.touchRotate=o,this.keyboard=T}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,t=null,r={}){const s={...e.getViewportProps(),...t},u=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),u){const f=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:f,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const s=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(s,h3,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,h3,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],u=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:W8},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,h3,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],u=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:W8},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:u}=e;let f=2/(1+Math.exp(-Math.abs(u*r)));u<0&&f!==0&&(f=1/f);const m=this.controllerState.zoom({pos:t,scale:f});return this.updateViewport(m,{...this._getTransitionProps({around:t}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,h3,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,h3,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),s=[r[0],r[1]+=e.velocityY*t/2],u=this.controllerState.rotate({pos:s});this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:W8},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return I0._startPinchRotation=e.rotation,I0._lastPinchEvent=e,this.updateViewport(r,h3,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:I0._startPinchRotation-r})}return this.updateViewport(t,h3,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),I0._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=I0;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const s=this.getCenter(e);let u=this.controllerState.rotateEnd();const f=Math.log2(e.scale),m=(f-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),o=Math.pow(2,f+m*t/2);u=u.zoom({pos:s,scale:o}).zoomEnd(),this.updateViewport(u,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:W8},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return I0._startPinchRotation=null,I0._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:s,rotateSpeedX:u,rotateSpeedY:f}=this.keyboard===!0?{}:this.keyboard,{controllerState:m}=this;let o;const T={};switch(e.srcEvent.code){case"Minus":o=t?m.zoomOut(r).zoomOut(r):m.zoomOut(r),T.isZooming=!0;break;case"Equal":o=t?m.zoomIn(r).zoomIn(r):m.zoomIn(r),T.isZooming=!0;break;case"ArrowLeft":t?(o=m.rotateLeft(u),T.isRotating=!0):(o=m.moveLeft(s),T.isPanning=!0);break;case"ArrowRight":t?(o=m.rotateRight(u),T.isRotating=!0):(o=m.moveRight(s),T.isPanning=!0);break;case"ArrowUp":t?(o=m.rotateUp(f),T.isRotating=!0):(o=m.moveUp(s),T.isPanning=!0);break;case"ArrowDown":t?(o=m.rotateDown(f),T.isRotating=!0):(o=m.moveDown(s),T.isPanning=!0);break;default:return!1}return this.updateViewport(o,this._getTransitionProps(),T),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?h3:e?{...t,transitionInterpolator:new bx({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class fL{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Xg=5,dL=1.2;class pL extends fL{constructor(e){const{width:t,height:r,latitude:s,longitude:u,zoom:f,bearing:m=0,pitch:o=0,altitude:T=1.5,position:C=[0,0,0],maxZoom:R=20,minZoom:O=0,maxPitch:U=60,minPitch:V=0,startPanLngLat:Y,startZoomLngLat:ee,startRotatePos:le,startBearing:Ee,startPitch:ue,startZoom:_e,normalize:Me=!0}=e;Fs(Number.isFinite(u)),Fs(Number.isFinite(s)),Fs(Number.isFinite(f)),super({width:t,height:r,latitude:s,longitude:u,zoom:f,bearing:m,pitch:o,altitude:T,maxZoom:R,minZoom:O,maxPitch:U,minPitch:V,normalize:Me,position:C},{startPanLngLat:Y,startZoomLngLat:ee,startRotatePos:le,startBearing:Ee,startPitch:ue,startZoom:_e}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;const u=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(u)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:s,startBearing:u,startPitch:f}=this.getState();if(!s||u===void 0||f===void 0)return this;let m;return e?m=this._getNewRotation(e,s,f,u):m={bearing:u+t,pitch:f+r},this._getUpdatedState(m)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:s,startZoomLngLat:u}=this.getState();if(u||(s=this.getViewportProps().zoom,u=this._unproject(t)||this._unproject(e)),!u)return this;const{maxZoom:f,minZoom:m}=this.getViewportProps();let o=s+Math.log2(r);o=y3(o,m,f);const T=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...T.panByPosition(u,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:s,longitude:u}=r;return Math.abs(s-t.bearing)>180&&(r.bearing=s<0?s+360:s-360),Math.abs(u-t.longitude)>180&&(r.longitude=u<0?u+360:u-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:s}=e;e.zoom=y3(s,r,t);const{maxPitch:u,minPitch:f,pitch:m}=e;e.pitch=y3(m,f,u);const{normalize:o=!0}=e;return o&&Object.assign(e,zO(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,s){const u=e[0]-t[0],f=e[1]-t[1],m=e[1],o=t[1],{width:T,height:C}=this.getViewportProps(),R=u/T;let O=0;f>0?Math.abs(C-o)>Xg&&(O=f/(o-C)*dL):f<0&&o>Xg&&(O=1-m/o),O=y3(O,-1,1);const{minPitch:U,maxPitch:V}=this.getViewportProps(),Y=s+180*R;let ee=r;return O>0?ee=r+O*(V-r):O<0&&(ee=r-O*(U-r)),{pitch:ee,bearing:Y}}}class mL extends hL{constructor(){super(...arguments),this.ControllerState=pL,this.transition={transitionDuration:300,transitionInterpolator:new bx({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class wf extends cu{constructor(e={}){super(e)}getViewportType(){return au}get ControllerType(){return mL}}wf.displayName="MapView";const gL=new dx;function _L(n,e){const t=n.order??1/0,r=e.order??1/0;return t-r}class yL{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(s=>_L(s,e)>0);r<0?t.push(e):t.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ol(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const r=[];for(const s of e){const u=t[s.id];let f=s;u&&u!==s?u.setProps?(u.setProps(s.props),f=u):u.cleanup(this._context):u||s.setup(this._context),r.push(f),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(s=>s instanceof dx)||this._resolvedEffects.push(gL),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class vL extends xf{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const xL="deckRenderer.renderLayers";class bL{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new vL(e),this.pickLayersPass=new vx(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const s=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const u=t.render({...r,target:s});r.effects&&this._postRender(r.effects,r),this.renderCount++,eo(xL,this,u,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[s]}))});for(const r of e)r.resize(t)}_postRender(e,t){const{renderBuffers:r}=this,s={...t,inputBuffer:r[0],swapBuffer:r[1]};for(const u of e)if(u.postRender){s.target=u.id===this.lastPostProcessEffect?t.target:void 0;const f=u.postRender(s);s.inputBuffer=f,s.swapBuffer=f===r[0]?r[1]:r[0]}}}const wL={pickedColor:null,pickedObjectIndex:-1};function TL({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:r,deviceRadius:s,deviceRect:u}){const{x:f,y:m,width:o,height:T}=u;let C=s*s,R=-1,O=0;for(let U=0;U<T;U++){const V=U+m-r,Y=V*V;if(Y>C)O+=4*o;else for(let ee=0;ee<o;ee++){if(n[O+3]-1>=0){const Ee=ee+f-t,ue=Ee*Ee+Y;ue<=C&&(C=ue,R=O)}O+=4}}if(R>=0){const U=n.slice(R,R+4),V=e(U);if(V){const Y=Math.floor(R/4/o),ee=R/4-Y*o;return{...V,pickedColor:U,pickedX:f+ee,pickedY:m+Y}}lr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return wL}function EL({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let r=0;r<n.length;r+=4)if(n[r+3]-1>=0){const u=n.slice(r,r+4),f=u.join(",");if(!t.has(f)){const m=e(u);m?t.set(f,{...m,color:u}):lr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function wx({pickInfo:n,viewports:e,pixelRatio:t,x:r,y:s,z:u}){let f=e[0];e.length>1&&(f=AL((n==null?void 0:n.pickedViewports)||e,{x:r,y:s}));let m;if(f){const o=[r-f.x,s-f.y];u!==void 0&&(o[2]=u),m=f.unproject(o)}return{color:null,layer:null,viewport:f,index:-1,picked:!1,x:r,y:s,pixel:[r,s],coordinate:m,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function SL(n){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:s}=n,{pickedColor:u,pickedLayer:f,pickedObjectIndex:m}=e,o=f?[f]:[];if(r==="hover"){const R=t.index,O=t.layerId,U=f?f.props.id:null;if(U!==O||m!==R){if(U!==O){const V=s.find(Y=>Y.props.id===O);V&&o.unshift(V)}t.layerId=U,t.index=m,t.info=null}}const T=wx(n),C=new Map;return C.set(null,T),o.forEach(R=>{let O={...T};R===f&&(O.color=u,O.index=m,O.picked=!0),O=Tx({layer:R,info:O,mode:r});const U=O.layer;R===f&&r==="hover"&&(t.info=O),C.set(U.id,O),r==="hover"&&U.updateAutoHighlight(O)}),C}function Tx({layer:n,info:e,mode:t}){for(;n&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:r}),n=n.parent}return e}function AL(n,e){for(let t=n.length-1;t>=0;t--){const r=n[t];if(r.containsPixel(e))return r}return n[0]}class CL{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new vx(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:s},u=this.lastPickedInfo.info){const f=u&&u.layer&&u.layer.id,m=u&&u.viewport&&u.viewport.id,o=f?r.find(O=>O.id===f):null,T=m&&s.find(O=>O.id===m)||s[0],C=T&&T.unproject([e-T.x,t-T.y]);return{...u,...{x:e,y:t,viewport:T,coordinate:C,layer:o}}}_resizeBuffer(){var t,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:r,x:s,y:u,radius:f=0,depth:m=1,mode:o="query",unproject3D:T,onViewportActive:C,effects:R}){const O=this.device.canvasContext.cssToDeviceRatio(),U=this._getPickable(e);if(!U||r.length===0)return{result:[],emptyInfo:wx({viewports:r,x:s,y:u,pixelRatio:O})};this._resizeBuffer();const V=this.device.canvasContext.cssToDevicePixels([s,u],!0),Y=[V.x+Math.floor(V.width/2),V.y+Math.floor(V.height/2)],ee=Math.round(f*O),{width:le,height:Ee}=this.pickingFBO,ue=this._getPickingRect({deviceX:Y[0],deviceY:Y[1],deviceRadius:ee,deviceWidth:le,deviceHeight:Ee}),_e={x:s-f,y:u-f,width:f*2+1,height:f*2+1};let Me;const Fe=[],yt=new Set;for(let xt=0;xt<m;xt++){let ht;if(ue){const Bt=this._drawAndSample({layers:U,views:t,viewports:r,onViewportActive:C,deviceRect:ue,cullRect:_e,effects:R,pass:`picking:${o}`});ht=TL({...Bt,deviceX:Y[0],deviceY:Y[1],deviceRadius:ee,deviceRect:ue})}else ht={pickedColor:null,pickedObjectIndex:-1};let kt;if(ht.pickedLayer&&T&&this.depthFBO){const{pickedColors:Bt}=this._drawAndSample({layers:[ht.pickedLayer],views:t,viewports:r,onViewportActive:C,deviceRect:{x:ht.pickedX,y:ht.pickedY,width:1,height:1},cullRect:_e,effects:R,pass:`picking:${o}:z`},!0);Bt[3]&&(kt=Bt[0])}ht.pickedLayer&&xt+1<m&&(yt.add(ht.pickedLayer),ht.pickedLayer.disablePickingIndex(ht.pickedObjectIndex)),Me=SL({pickInfo:ht,lastPickedInfo:this.lastPickedInfo,mode:o,layers:U,viewports:r,x:s,y:u,z:kt,pixelRatio:O});for(const Bt of Me.values())Bt.layer&&Fe.push(Bt);if(!ht.pickedColor)break}for(const xt of yt)xt.restorePickingColors();return{result:Fe,emptyInfo:Me.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:s,y:u,width:f=1,height:m=1,mode:o="query",maxObjects:T=null,onViewportActive:C,effects:R}){const O=this._getPickable(e);if(!O||r.length===0)return[];this._resizeBuffer();const U=this.device.canvasContext.cssToDeviceRatio(),V=this.device.canvasContext.cssToDevicePixels([s,u],!0),Y=V.x,ee=V.y+V.height,le=this.device.canvasContext.cssToDevicePixels([s+f,u+m],!0),Ee=le.x+le.width,ue=le.y,_e={x:Y,y:ue,width:Ee-Y,height:ee-ue},Me=this._drawAndSample({layers:O,views:t,viewports:r,onViewportActive:C,deviceRect:_e,cullRect:{x:s,y:u,width:f,height:m},effects:R,pass:`picking:${o}`}),Fe=EL(Me),yt=new Map,xt=[],ht=Number.isFinite(T);for(let kt=0;kt<Fe.length&&!(ht&&xt.length>=T);kt++){const Bt=Fe[kt];let Vt={color:Bt.pickedColor,layer:null,index:Bt.pickedObjectIndex,picked:!0,x:s,y:u,pixelRatio:U};Vt=Tx({layer:Bt.pickedLayer,info:Vt,mode:o});const $t=Vt.layer.id;yt.has($t)||yt.set($t,new Set);const Ct=yt.get($t),xn=Vt.object??Vt.index;Ct.has(xn)||(Ct.add(xn),xt.push(Vt))}return xt}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:s,deviceRect:u,cullRect:f,effects:m,pass:o},T=!1){const C=T?this.depthFBO:this.pickingFBO,R={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:s,pickingFBO:C,deviceRect:u,cullRect:f,effects:m,pass:o,pickZ:T,preRenderStats:{},isPicking:!0};for(const Ee of m)Ee.useInPicking&&(R.preRenderStats[Ee.id]=Ee.preRender(R));const{decodePickingColor:O}=this.pickLayersPass.render(R),{x:U,y:V,width:Y,height:ee}=u,le=new(T?Float32Array:Uint8Array)(Y*ee*4);return this.device.readPixelsToArrayWebGL(C,{sourceX:U,sourceY:V,sourceWidth:Y,sourceHeight:ee,target:le}),{pickedColors:le,decodePickingColor:O}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:s,deviceHeight:u}){const f=Math.max(0,e-r),m=Math.max(0,t-r),o=Math.min(s,e+r+1)-f,T=Math.min(u,t+r+1)-m;return o<=0||T<=0?null:{x:f,y:m,width:o,height:T}}}const PL={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},IL="top-left",Zg="__root";class ML{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Ol(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const r of this.resolvedWidgets)t[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)t[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const s=t[r.id];s?s.viewId!==r.viewId||s.placement!==r.placement?(this._remove(s),this._add(r)):r!==s&&(s.setProps(r.props),r=s):this._add(r),t[r.id]=null,this.resolvedWidgets.push(r)}for(const r in t){const s=t[r];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:t=null,placement:r=IL}=e,s=e.onAdd({deck:this.deck,viewId:t});s&&this._getContainer(t,r).append(s),e._element=s}_remove(e){var t;(t=e.onRemove)==null||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var f;const r=e||Zg;let s=this.containers[r];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(f=this.parentElement)==null||f.append(s),this.containers[r]=s);let u=s.querySelector(`.${t}`);return u||(u=document.createElement("div"),u.className=t,u.style.position="absolute",u.style.zIndex="2",Object.assign(u.style,PL[t]),s.append(u)),u}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const r in this.containers){const s=this.lastViewports[r]||null,u=r===Zg||s,f=this.containers[r];u?(f.style.display="block",f.style.left=`${s?s.x:0}px`,f.style.top=`${s?s.y:0}px`,f.style.width=`${s?s.width:e}px`,f.style.height=`${s?s.height:t}px`):f.style.display="none"}}onRedraw({viewports:e,layers:t}){var s,u;const r=e.reduce((f,m)=>(f[m.id]=m,f),{});for(const f of this.getWidgets()){const{viewId:m}=f;if(m){const o=r[m];o&&(f.onViewportChange&&f.onViewportChange(o),(s=f.onRedraw)==null||s.call(f,{viewports:[o],layers:t}))}else{if(f.onViewportChange)for(const o of e)f.onViewportChange(o);(u=f.onRedraw)==null||u.call(f,{viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){var r,s;for(const u of this.getWidgets()){const{viewId:f}=u;(!f||f===((r=e.viewport)==null?void 0:r.id))&&((s=u.onHover)==null||s.call(u,e,t))}}onEvent(e,t){var s,u;const r=fh[t.type];if(r)for(const f of this.getWidgets()){const{viewId:m}=f;(!m||m===((s=e.viewport)==null?void 0:s.id))&&((u=f[r])==null||u.call(f,e,t))}}}const RL={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class kL{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,RL),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,r=t&&t.props.getTooltip;if(!r)return;const s=r(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,t,r){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var j4;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(j4||(j4={}));const Tf={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ji=(n,e,t)=>e?n.enable(t):n.disable(t),qg=(n,e,t)=>n.hint(t,e),fa=(n,e,t)=>n.pixelStorei(t,e),Gg=(n,e,t)=>{const r=t===36006?36009:36008;return n.bindFramebuffer(r,e)},s2=(n,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(s,e)};function h9(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const OL={3042:ji,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:ji,2885:(n,e)=>n.cullFace(e),2929:ji,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:ji,35723:qg,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>{var t;return(t=n.bindTransformFeedback)==null?void 0:t.call(n,36386,e)},34229:(n,e)=>n.bindVertexArray(e),36006:Gg,36010:Gg,34964:s2,36662:s2,36663:s2,35053:s2,35055:s2,2886:(n,e)=>n.frontFace(e),33170:qg,2849:(n,e)=>n.lineWidth(e),32823:ji,32824:"polygonOffset",10752:"polygonOffset",35977:ji,32926:ji,32928:ji,32938:"sampleCoverage",32939:"sampleCoverage",3089:ji,3088:(n,e)=>n.scissor(...e),2960:ji,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:ji,10754:ji,12288:ji,12289:ji,12290:ji,12291:ji,12292:ji,12293:ji,12294:ji,12295:ji,3333:fa,3317:fa,37440:fa,37441:fa,37443:fa,3330:fa,3332:fa,3331:fa,3314:fa,32878:fa,3316:fa,3315:fa,32877:fa,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=h9(e)?e:[e,e];const[t,r]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,r)},stencilFunc:(n,e)=>{e=h9(e)&&e.length===3?[...e,...e]:e;const[t,r,s,u,f,m]=e;n.stencilFuncSeparate(1028,t,r,s),n.stencilFuncSeparate(1029,u,f,m)},stencilOp:(n,e)=>{e=h9(e)&&e.length===3?[...e,...e]:e;const[t,r,s,u,f,m]=e;n.stencilOpSeparate(1028,t,r,s),n.stencilOpSeparate(1029,u,f,m)},viewport:(n,e)=>n.viewport(...e)};function bi(n,e,t){return e[n]!==void 0?e[n]:t[n]}const DL={blendEquation:(n,e,t)=>n.blendEquationSeparate(bi(32777,e,t),bi(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(bi(32969,e,t),bi(32968,e,t),bi(32971,e,t),bi(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(bi(32824,e,t),bi(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(bi(32938,e,t),bi(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,bi(2962,e,t),bi(2967,e,t),bi(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,bi(34816,e,t),bi(36003,e,t),bi(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,bi(2964,e,t),bi(2965,e,t),bi(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,bi(34817,e,t),bi(34818,e,t),bi(34819,e,t))},Yg={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?n({[r]:t}):{valueChanged:!0}},blendColor:(n,e,t,r,s)=>n({32773:new Float32Array([e,t,r,s])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,r,s)=>n({32969:e,32968:t,32971:r,32970:s}),clearColor:(n,e,t,r,s)=>n({3106:new Float32Array([e,t,r,s])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,r,s)=>n({3107:[e,t,r,s]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,r,s)=>n({3088:new Int32Array([e,t,r,s])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,r)=>n({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(n,e,t,r,s)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:s}),stencilOp:(n,e,t,r)=>n({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(n,e,t,r,s)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:s}),viewport:(n,e,t,r,s)=>n({2978:[e,t,r,s]})},_1=(n,e)=>n.isEnabled(e),Kg={3042:_1,2884:_1,2929:_1,3024:_1,32823:_1,32926:_1,32928:_1,3089:_1,2960:_1,35977:_1},LL=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function fu(n,e){if(NL(e))return;const t={};for(const s in e){const u=Number(s),f=OL[s];f&&(typeof f=="string"?t[f]=!0:f(n,e[s],u))}const r=n.state&&n.state.cache;if(r)for(const s in t){const u=DL[s];u(n,e,r)}}function Ex(n,e=Tf){if(typeof e=="number"){const s=e,u=Kg[s];return u?u(n,s):n.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const s of t){const u=Kg[s];r[s]=u?u(n,Number(s)):n.getParameter(Number(s))}return r}function FL(n){fu(n,Tf)}function NL(n){for(const e in n)return!1;return!0}function BL(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&n.length===e.length){for(let s=0;s<n.length;++s)if(n[s]!==e[s])return!1;return!0}return!1}class F0{constructor(e,t){ne(this,"gl");ne(this,"program",null);ne(this,"stateStack",[]);ne(this,"enable",!0);ne(this,"cache",null);ne(this,"log");ne(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];fu(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?Ex(e):Object.assign({},Tf),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,UL(e);for(const r in Yg){const s=Yg[r];zL(e,r,s)}Jg(e,"getParameter"),Jg(e,"isEnabled")}_updateCache(e){let t=!1,r;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const u in e){const f=e[u],m=this.cache[u];BL(f,m)||(t=!0,r=m,s&&!(u in s)&&(s[u]=m),this.cache[u]=f)}return{valueChanged:t,oldValue:r}}}function Jg(n,e){const t=n[e].bind(n);n[e]=function(s){if(s===void 0||LL.has(s))return t(s);const u=F0.get(n);return s in u.cache||(u.cache[s]=t(s)),u.enable?u.cache[s]:t(s)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function zL(n,e,t){if(!n[e])return;const r=n[e].bind(n);n[e]=function(...u){const f=F0.get(n),{valueChanged:m,oldValue:o}=t(f._updateCache,...u);return m&&r(...u),o},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function UL(n){const e=n.useProgram.bind(n);n.useProgram=function(r){const s=F0.get(n);s.program!==r&&(e(r),s.program=r)}}function VL(n,e,t){let r="";const s={preserveDrawingBuffer:!0,...t};let u=null;if(u||(u=n.getContext("webgl2",s)),s.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!u&&!t.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,u=n.getContext("webgl2",s),u.luma||(u.luma={}),u.luma.softwareRenderer=!0),u||(u=n.getContext("webgl",{}),u&&(u=null,r||(r="Your browser only supports WebGL1"))),!u)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:f,onContextRestored:m}=e;return n.addEventListener("webglcontextlost",o=>f(o),!1),n.addEventListener("webglcontextrestored",o=>m(o),!1),u.luma||(u.luma={}),u}function uu(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function jL(n,e){const t=n.getParameter(7936),r=n.getParameter(7937);uu(n,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,u=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),f=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),m=u||t,o=f||r,T=n.getParameter(7938),C=Sx(m,o),R=$L(m,o),O=WL(m,o);return{type:"webgl",gpu:C,gpuType:O,gpuBackend:R,vendor:m,renderer:o,version:T,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Sx(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function $L(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function WL(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(Sx(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function Ax(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const h2="WEBGL_compressed_texture_s3tc",f2="WEBGL_compressed_texture_s3tc_srgb",$4="EXT_texture_compression_rgtc",W4="EXT_texture_compression_bptc",HL="WEBGL_compressed_texture_etc",XL="WEBGL_compressed_texture_astc",ZL="WEBGL_compressed_texture_etc1",qL="WEBGL_compressed_texture_pvrtc",GL="WEBGL_compressed_texture_atc",Qg="EXT_texture_norm16",e_="EXT_render_snorm",YL="EXT_color_buffer_float",Ef={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[e_],"norm16-renderable-webgl":[Qg],"snorm16-renderable-webgl":[Qg,e_],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[h2,f2,$4,W4],"texture-compression-bc5-webgl":[$4],"texture-compression-bc7-webgl":[W4],"texture-compression-etc2":[HL],"texture-compression-astc":[XL],"texture-compression-etc1-webgl":[ZL],"texture-compression-pvrtc-webgl":[qL],"texture-compression-atc-webgl":[GL]};function KL(n){return n in Ef}function JL(n,e,t){return(Ef[e]||[]).every(s=>uu(n,s,t))}const Sf={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:YL,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:h2},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:f2},"bc1-rgba-unorm":{gl:33777,x:h2},"bc1-rgba-unorm-srgb":{gl:35916,x:f2},"bc2-rgba-unorm":{gl:33778,x:h2},"bc2-rgba-unorm-srgb":{gl:35918,x:f2},"bc3-rgba-unorm":{gl:33779,x:h2},"bc3-rgba-unorm-srgb":{gl:35919,x:f2},"bc4-r-unorm":{gl:36283,x:$4},"bc4-r-snorm":{gl:36284,x:$4},"bc5-rg-unorm":{gl:36285,x:$4},"bc5-rg-snorm":{gl:36286,x:$4},"bc6h-rgb-ufloat":{gl:36495,x:W4},"bc6h-rgb-float":{gl:36494,x:W4},"bc7-rgba-unorm":{gl:36492,x:W4},"bc7-rgba-unorm-srgb":{gl:36493,x:W4},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function QL(n,e,t){let r=e.create;const s=Sf[e.format];return(s==null?void 0:s.gl)===void 0&&(r=!1),s!=null&&s.x&&(r=r&&!!uu(n,s.x,t)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function Cx(n){var s;const e=Sf[n],t=nF(n),r=of(n);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||tF(r.channels,r.integer,r.normalized,t),type:r.dataType?Ax(r.dataType):((s=e==null?void 0:e.types)==null?void 0:s[0])||5121,compressed:r.compressed||!1}}function eF(n){switch(of(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function tF(n,e,t,r){if(r===6408||r===6407)return r;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function nF(n){const e=Sf[n],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const t_={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class rF extends VI{constructor(t,r,s){super([],s);ne(this,"gl");ne(this,"extensions");ne(this,"testedFeatures",new Set);this.gl=t,this.extensions=r,uu(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const t=this.getFeatures();for(const r of t)this.has(r)&&(yield r);return[]}has(t){var r;return(r=this.disabledFeatures)!=null&&r[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),KL(t)&&JL(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of t)this.has(r)}getFeatures(){return[...Object.keys(t_),...Object.keys(Ef)]}getWebGLFeature(t){const r=t_[t];return typeof r=="string"?!!uu(this.gl,r,this.extensions):!!r}}class iF extends UI{constructor(t){super();ne(this,"gl");ne(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class b2 extends k7{constructor(t,r){super(t,r);ne(this,"device");ne(this,"gl");ne(this,"handle");ne(this,"colorAttachments",[]);ne(this,"depthStencilAttachment",null);const s=r.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),s||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const s=this.colorAttachments[r];if(s){const u=36064+r;this._attachTextureView(u,s)}}if(this.depthStencilAttachment){const r=eF(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${oF(r)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,r){const{gl:s}=this.device,{texture:u}=r,f=r.props.baseMipLevel,m=r.props.baseArrayLayer;switch(s.bindTexture(u.glTarget,u.handle),u.glTarget){case 35866:case 32879:s.framebufferTextureLayer(36160,t,u.handle,f,m);break;case 34067:const o=sF(m);s.framebufferTexture2D(36160,t,o,u.handle,f);break;case 3553:s.framebufferTexture2D(36160,t,3553,u.handle,f);break;default:throw new Error("Illegal texture type")}s.bindTexture(u.glTarget,null)}}function sF(n){return n<34069?n+34069:n}function oF(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class aF extends Y9{constructor(t,r){super(r);ne(this,"device");ne(this,"format","rgba8unorm");ne(this,"depthStencilFormat","depth24plus");ne(this,"presentationSize");ne(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new b2(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(r,t);return}}commit(){}}async function Px(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",n),new Promise((s,u)=>{r.onload=s,r.onerror=f=>u(new Error(`Unable to load script '${n}': ${f}`)),t.appendChild(r)})}const lF=1;let jr=null,n_=!1;const Af={debugSpectorJS:jt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function cF(n){if(!globalThis.SPECTOR)try{await Px(n.debugSpectorJSUrl||Af.debugSpectorJSUrl)}catch(e){jt.warn(String(e))}}function uF(n){var e;if(n={...Af,...n},!n.debugSpectorJS)return null;if(!jr&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){jt.probe(lF,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;jr=new t,globalThis.luma&&(globalThis.luma.spector=jr)}if(!jr)return null;if(n_||(n_=!0,jr.spyCanvases(),jr==null||jr.onCaptureStarted.add(t=>jt.info("Spector capture started:",t)()),jr==null||jr.onCapture.add(t=>{jt.info("Spector capture complete:",t)(),jr==null||jr.getResultUI(),jr==null||jr.resultView.display(),jr==null||jr.resultView.addCapture(t)})),n.gl){const t=n.gl,r=t.device;jr==null||jr.startCapture(n.gl,500),t.device=r,new Promise(s=>setTimeout(s,2e3)).then(s=>{jt.info("Spector capture stopped after 2 seconds")(),jr==null||jr.stopCapture()})}return jr}const hF="https://unpkg.com/webgl-debug@2.0.1/index.js";function Ix(n){return n.luma=n.luma||{},n.luma}async function fF(){j0()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Px(hF))}function dF(n,e={}){return e.debugWebGL||e.traceWebGL?mF(n,e):pF(n)}function pF(n){const e=Ix(n);return e.realContext?e.realContext:n}function mF(n,e){if(!globalThis.WebGLDebugUtils)return jt.warn("webgl-debug not loaded")(),n;const t=Ix(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...j4,...n});const r=globalThis.WebGLDebugUtils.makeDebugContext(n,gF.bind(null,e),_F.bind(null,e));for(const f in j4)!(f in r)&&typeof j4[f]=="number"&&(r[f]=j4[f]);class s{}Object.setPrototypeOf(r,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,r);const u=Object.create(s);return t.realContext=n,t.debugContext=u,u.debug=!0,u}function r_(n,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function gF(n,e,t,r){r=Array.from(r).map(m=>m===void 0?"undefined":m);const s=globalThis.WebGLDebugUtils.glEnumToString(e),u=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,r),f=`${s} in gl.${t}(${u})`;jt.error(f)();debugger}function _F(n,e,t){let r="";jt.level>=1&&(r=r_(e,t),n.traceWebGL&&jt.log(1,r)());for(const s of t)if(s===void 0){r=r||r_(e,t);debugger}}const f9={};function yF(n="id"){f9[n]=f9[n]||1;const e=f9[n]++;return`${n}-${e}`}class w2 extends Jr{constructor(t,r={}){super(t,r);ne(this,"device");ne(this,"gl");ne(this,"handle");ne(this,"glTarget");ne(this,"glUsage");ne(this,"glIndexType",5123);ne(this,"byteLength");ne(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const s=typeof r=="object"?r.handle:void 0;this.handle=s||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=vF(this.props.usage),this.glUsage=xF(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(t,r=0,s=t.byteLength+r){const u=this.glTarget;this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,s,this.glUsage),this.gl.bufferSubData(u,r,t),this.gl.bindBuffer(u,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(t,r,s),this.trackAllocatedMemory(s)}_initWithByteLength(t){let r=t;t===0&&(r=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,r,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,r,t.byteLength)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}readSyncWebGL(t=0,r){r=r??this.byteLength-t;const s=new Uint8Array(r),u=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,s,u,r),this.gl.bindBuffer(36662,null),this._setDebugData(s,t,r),s}}function vF(n){return n&Jr.INDEX?34963:n&Jr.VERTEX?34962:n&Jr.UNIFORM?35345:34962}function xF(n){return n&Jr.INDEX||n&Jr.VERTEX?35044:n&Jr.UNIFORM?35048:35044}function bF(n){const e=n.split(/\r?\n/),t=[];for(const r of e){if(r.length<=1)continue;const s=r.split(":");if(s.length===2){const[R,O]=s;t.push({message:O.trim(),type:i_(R),lineNum:0,linePos:0});continue}const[u,f,m,...o]=s;let T=parseInt(m,10);isNaN(T)&&(T=0);let C=parseInt(f,10);isNaN(C)&&(C=0),t.push({message:o.join(":").trim(),type:i_(u),lineNum:T,linePos:C})}return t}function i_(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class wF extends M7{constructor(t,r){super(t,r);ne(this,"device");ne(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?bF(t):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,t),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}jt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),jt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async u=>await new Promise(f=>setTimeout(f,u));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function TF(n,e,t,r){if(CF(e))return r(n);const s=n;s.pushState();try{return EF(n,e),fu(s.gl,t),r(n)}finally{s.popState()}}function EF(n,e){const t=n,{gl:r}=t;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(N0("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const u=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,f=N0("provokingVertex",e.provokingVertex,{first:36429,last:36430});u==null||u.provokingVertexWEBGL(f)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const u=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,f=N0("polygonMode",e.polygonMode,{fill:6914,line:6913});u==null||u.polygonModeWEBGL(1028,f),u==null||u.polygonModeWEBGL(1029,f)}e.polygonOffsetLine&&r.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(AF("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(bh("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;r.stencilMaskSeparate(1028,s),r.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&jt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,u=bh("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,u,0,s),r.stencilFuncSeparate(1029,u,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=d9("stencilPassOperation",e.stencilPassOperation),u=d9("stencilFailOperation",e.stencilFailOperation),f=d9("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,u,f,s),r.stencilOpSeparate(1029,u,f,s)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=s_("blendColorOperation",e.blendColorOperation||"add"),u=s_("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(s,u);const f=H8("blendColorSrcFactor",e.blendColorSrcFactor||"one"),m=H8("blendColorDstFactor",e.blendColorDstFactor||"zero"),o=H8("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),T=H8("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(f,m,o,T)}}function bh(n,e){return N0(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function d9(n,e){return N0(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function s_(n,e){return N0(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function H8(n,e){return N0(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function SF(n,e){return`Illegal parameter ${e} for ${n}`}function N0(n,e,t){if(!(e in t))throw new Error(SF(n,e));return t[e]}function AF(n,e){return e}function CF(n){let e=!0;for(const t in n){e=!1;break}return e}function Mx(n){const e={};return n.addressModeU&&(e[10242]=p9(n.addressModeU)),n.addressModeV&&(e[10243]=p9(n.addressModeV)),n.addressModeW&&(e[32882]=p9(n.addressModeW)),n.magFilter&&(e[10240]=wh(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=PF(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=bh("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function p9(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function wh(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function PF(n,e="none"){if(!e)return wh(n);switch(e){case"none":return wh(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class Th extends R7{constructor(t,r){super(t,r);ne(this,"device");ne(this,"handle");ne(this,"parameters");this.device=t,this.parameters=Mx(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[r,s]of Object.entries(t)){const u=Number(r);switch(u){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,u,s);break;default:this.device.gl.samplerParameteri(this.handle,u,s);break}}}}class H4 extends I7{constructor(t,r){super(t,{...wi.defaultProps,...r});ne(this,"device");ne(this,"gl");ne(this,"handle");ne(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const IF="Failed to deduce GL constant from typed array";function MF(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(IF)}}function RF(n,e){const{clamped:t=!0}=e;switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Rx(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function kF(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Z7(n,e,t){if(OF(e))return t(n);const{nocatch:r=!0}=e,s=F0.get(n);s.push(),fu(n,e);let u;if(r)u=t(n),s.pop();else try{u=t(n)}finally{s.pop()}return u}function OF(n){for(const e in n)return!1;return!0}function DF(n,e,t){const{dimension:r,width:s,height:u,depth:f=0}=t,{glInternalFormat:m}=t,o=t.glTarget;switch(r){case"2d-array":case"3d":n.texStorage3D(o,e,m,s,u,f);break;default:n.texStorage2D(o,e,m,s,u)}}function o_(n,e,t,r){const{width:s,height:u}=r,{dimension:f,depth:m=0,mipLevel:o=0}=r,{x:T=0,y:C=0,z:R=0}=r,{glFormat:O,glType:U}=r,V=kx(r.glTarget,f,m),Y=r.flipY?{37440:!0}:{};Z7(n,Y,()=>{switch(f){case"2d-array":case"3d":n.bindTexture(V,e),n.texSubImage3D(V,o,T,C,R,s,u,m,O,U,t),n.bindTexture(V,null);break;case"2d":case"cube":n.bindTexture(V,e),n.texSubImage2D(V,o,T,C,s,u,O,U,t),n.bindTexture(V,null);break;default:throw new Error(f)}})}function a_(n,e,t){const{dimension:r,width:s,height:u,depth:f=0,mipLevel:m=0,byteOffset:o=0}=t,{x:T=0,y:C=0,z:R=0}=t,{glFormat:O,glType:U,compressed:V}=t,Y=kx(t.glTarget,r,f);switch(r){case"2d-array":case"3d":V?n.compressedTexSubImage3D(Y,m,T,C,R,s,u,f,O,e,o):n.texSubImage3D(Y,m,T,C,R,s,u,f,O,U,e,o);break;case"2d":case"cube":V?n.compressedTexSubImage2D(Y,m,T,C,s,u,O,e,o):n.texSubImage2D(Y,m,T,C,s,u,O,U,e,o);break;default:throw new Error(r)}}function LF(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function kx(n,e,t){return e==="cube"?34069+t:n}function FF(n,e){var le;const{sourceX:t=0,sourceY:r=0,sourceAttachment:s=0}=e||{};let{target:u=null,sourceWidth:f,sourceHeight:m,sourceDepth:o,sourceFormat:T,sourceType:C}=e||{};const{framebuffer:R,deleteFramebuffer:O}=Ox(n),{gl:U,handle:V}=R;f||(f=R.width),m||(m=R.height);const Y=(le=R.colorAttachments[s])==null?void 0:le.texture;if(!Y)throw new Error(`Invalid framebuffer attachment ${s}`);o=(Y==null?void 0:Y.depth)||1,T||(T=(Y==null?void 0:Y.glFormat)||6408),C||(C=(Y==null?void 0:Y.glType)||5121),u=zF(u,C,T,f,m),C=C||MF(u);const ee=U.bindFramebuffer(36160,V);return U.readBuffer(36064+s),U.readPixels(t,r,f,m,T,C,u),U.readBuffer(36064),U.bindFramebuffer(36160,ee||null),O&&R.destroy(),u}function NF(n,e){const{target:t,sourceX:r=0,sourceY:s=0,sourceFormat:u=6408,targetByteOffset:f=0}=e||{};let{sourceWidth:m,sourceHeight:o,sourceType:T}=e||{};const{framebuffer:C,deleteFramebuffer:R}=Ox(n);m=m||C.width,o=o||C.height;const O=C;T=T||5121;let U=t;if(!U){const Y=Rx(u),ee=kF(T),le=f+m*o*Y*ee;U=O.device.createBuffer({byteLength:le})}const V=n.device.createCommandEncoder();return V.copyTextureToBuffer({sourceTexture:n,width:m,height:o,origin:[r,s],destinationBuffer:U,byteOffset:f}),V.destroy(),R&&C.destroy(),U}function Ox(n){return n instanceof k7?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:BF(n),deleteFramebuffer:!0}}function BF(n,e){const{device:t,width:r,height:s,id:u}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${u}`,width:r,height:s,colorAttachments:[n]})}function zF(n,e,t,r,s,u){if(n)return n;e||(e=5121);const f=RF(e,{clamped:!1}),m=Rx(t);return new f(r*s*m)}class T2 extends wi{constructor(t,r){super(t,r);ne(this,"device");ne(this,"gl");ne(this,"handle");ne(this,"sampler");ne(this,"view");ne(this,"mipmaps");ne(this,"compressed");ne(this,"glTarget");ne(this,"glFormat");ne(this,"glType");ne(this,"glInternalFormat");ne(this,"textureUnit",0);const s={...this.props};s.data=r.data,this.device=t,this.gl=this.device.gl,this.glTarget=LF(this.props.dimension);const u=Cx(this.props.format);this.glInternalFormat=u.internalFormat,this.glFormat=u.format,this.glType=u.type,this.compressed=u.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(s),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:r,height:s}=t;if(!r||!s){const u=wi.getTextureDataSize(t.data);r=(u==null?void 0:u.width)||1,s=(u==null?void 0:u.height)||1}if(this.width=r,this.height=s,this.depth=t.depth,this.setSampler(t.sampler),this.view=new H4(this.device,{...this.props,texture:this}),this.bind(),DF(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new H4(this.device,{...t,texture:this})}setSampler(t={}){let r;t instanceof Th?(this.sampler=t,r=t.props):(this.sampler=new Th(this.device,t),r=t);const s=Mx(r);this._setSamplerParameters(s)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(jt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(s){jt.warn(`Error generating mipmap for ${this}: ${s.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const r=wi.getExternalImageSize(t.image),s={...wi.defaultCopyExternalImageOptions,...r,...t},{image:u,depth:f,mipLevel:m,x:o,y:T,z:C,flipY:R}=s;let{width:O,height:U}=s;const{dimension:V,glTarget:Y,glFormat:ee,glInternalFormat:le,glType:Ee}=this;if(O=Math.min(O,this.width-o),U=Math.min(U,this.height-T),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return o_(this.device.gl,this.handle,u,{dimension:V,mipLevel:m,x:o,y:T,z:C,width:O,height:U,depth:f,glFormat:ee,glInternalFormat:le,glType:Ee,glTarget:Y,flipY:R}),{width:s.width,height:s.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,r=0){this.bind();const s=wi.normalizeTextureData(t,this);s.length>1&&this.props.mipmaps!==!1&&jt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let u=0;u<s.length;u++){const f=s[u];this._setMipLevel(r,u,f)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),a_(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const s of wi.CubeFaces)this.setTextureCubeFaceData(t[s],s)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,r,s=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&jt.warn(`${this.id} has mipmap and multiple LODs.`)();const u=wi.CubeFaces.indexOf(r);this.setTexture2DData(t,u)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:r,width:s,height:u,pixels:f,data:m,format:o=6408,type:T=5121}=t,{gl:C}=this,R=f||m;this.bind(),R instanceof Promise?R.then(O=>this.setImageDataForFace(Object.assign({},t,{face:r,data:O,pixels:O}))):this.width||this.height?C.texImage2D(r,0,o,s,u,0,o,T,R):C.texImage2D(r,0,o,o,T,R)}_getImageDataMap(t){for(let r=0;r<wi.CubeFaces.length;++r){const s=wi.CubeFaces[r];t[s]&&(t[34069+r]=t[s],delete t[s])}return t}_setSamplerParameters(t){jt.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,s]of Object.entries(t)){const u=Number(r),f=s;switch(u){case 33082:case 33083:this.gl.texParameterf(this.glTarget,u,f);break;case 10241:this.gl.texParameteri(this.glTarget,u,f);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,u,f);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,u,f);break;default:this.gl.texParameteri(this.glTarget,u,f);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,r,s,u=this.glTarget){if(wi.isExternalImage(s)){o_(this.device.gl,this.handle,s,{...this,depth:t,mipLevel:r,glTarget:u,flipY:this.props.flipY});return}if(wi.isTextureLevelData(s)){a_(this.device.gl,s.data,{...this,depth:t,mipLevel:r,glTarget:u});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,null),t}}const UF=[1,2,4,8];class VF extends K9{constructor(t,r){var f;super(t,r);ne(this,"device");ne(this,"glParameters");this.device=t;let s;if(!((f=r==null?void 0:r.parameters)!=null&&f.viewport))if(r!=null&&r.framebuffer){const{width:m,height:o}=r.framebuffer;s=[0,0,m,o]}else{const[m,o]=t.getCanvasContext().getDrawingBufferSize();s=[0,0,m,o]}this.device.pushState(),this.setParameters({viewport:s,...this.props.parameters});const u=this.props.framebuffer;if(u!=null&&u.handle)if(this.props.framebuffer){const m=this.props.framebuffer.colorAttachments.map((o,T)=>36064+T);this.device.gl.drawBuffers(m)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(r.colorMask=UF.map(s=>!!(s&t.colorMask))),this.glParameters=r,fu(this.device.gl,r)}beginOcclusionQuery(t){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((s,u)=>{s&&this.clearColorBuffer(u,s)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,t.clearStencil=this.props.clearStencil),r!==0&&Z7(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){Z7(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function jF(n){return $F.includes(n)}const $F=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Dx={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function Lx(n){const e=Dx[n];if(!e)throw new Error("uniform");const[t,r,,s]=e;return{format:s,components:r,glType:t}}function WF(n){const e=Dx[n];if(!e)throw new Error("attribute");const[,t,,r,s]=e;return{attributeType:r,vertexFormat:s,components:t}}function HF(n,e){const t={attributes:[],bindings:[]};t.attributes=XF(n,e);const r=GF(n,e);for(const m of r){const o=m.uniforms.map(T=>({name:T.name,format:T.format,byteOffset:T.byteOffset,byteStride:T.byteStride,arrayLength:T.arrayLength}));t.bindings.push({type:"uniform",name:m.name,group:0,location:m.location,visibility:(m.vertex?1:0)&(m.fragment?2:0),minBindingSize:m.byteLength,uniforms:o})}const s=qF(n,e);let u=0;for(const m of s)if(jF(m.type)){const{viewDimension:o,sampleType:T}=KF(m.type);t.bindings.push({type:"texture",name:m.name,group:0,location:u,viewDimension:o,sampleType:T}),m.textureUnit=u,u+=1}s.length&&(t.uniforms=s);const f=ZF(n,e);return f!=null&&f.length&&(t.varyings=f),t}function XF(n,e){const t=[],r=n.getProgramParameter(e,35721);for(let s=0;s<r;s++){const u=n.getActiveAttrib(e,s);if(!u)throw new Error("activeInfo");const{name:f,type:m}=u,o=n.getAttribLocation(e,f);if(o>=0){const{attributeType:T}=WF(m),C=/instance/i.test(f)?"instance":"vertex";t.push({name:f,location:o,stepMode:C,type:T})}}return t.sort((s,u)=>s.location-u.location),t}function ZF(n,e){const t=[],r=n.getProgramParameter(e,35971);for(let s=0;s<r;s++){const u=n.getTransformFeedbackVarying(e,s);if(!u)throw new Error("activeInfo");const{name:f,type:m,size:o}=u,{glType:T,components:C}=Lx(m),R={location:s,name:f,type:T,size:o*C};t.push(R)}return t.sort((s,u)=>s.location-u.location),t}function qF(n,e){const t=[],r=n.getProgramParameter(e,35718);for(let s=0;s<r;s++){const u=n.getActiveUniform(e,s);if(!u)throw new Error("activeInfo");const{name:f,size:m,type:o}=u,{name:T,isArray:C}=JF(f);let R=n.getUniformLocation(e,T);const O={location:R,name:T,size:m,type:o,isArray:C};if(t.push(O),O.size>1)for(let U=0;U<O.size;U++){const V=`${T}[${U}]`;R=n.getUniformLocation(e,V);const Y={...O,name:V,location:R};t.push(Y)}}return t}function GF(n,e){const t=(u,f)=>n.getActiveUniformBlockParameter(e,u,f),r=[],s=n.getProgramParameter(e,35382);for(let u=0;u<s;u++){const f={name:n.getActiveUniformBlockName(e,u)||"",location:t(u,35391),byteLength:t(u,35392),vertex:t(u,35396),fragment:t(u,35398),uniformCount:t(u,35394),uniforms:[]},m=t(u,35395)||[],o=n.getActiveUniforms(e,m,35383),T=n.getActiveUniforms(e,m,35384),C=n.getActiveUniforms(e,m,35387),R=n.getActiveUniforms(e,m,35388);for(let O=0;O<f.uniformCount;++O){const U=n.getActiveUniform(e,m[O]);if(!U)throw new Error("activeInfo");f.uniforms.push({name:U.name,format:Lx(o[O]).format,type:o[O],arrayLength:T[O],byteOffset:C[O],byteStride:R[O]})}r.push(f)}return r.sort((u,f)=>u.location-f.location),r}const YF={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function KF(n){const e=YF[n];if(!e)throw new Error("sampler");const[t,r]=e;return{viewDimension:t,sampleType:r}}function JF(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function QF(n,e,t,r){const s=n;let u=r;u===!0&&(u=1),u===!1&&(u=0);const f=typeof u=="number"?[u]:u;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,r);case 5126:return n.uniform1fv(e,f);case 35664:return n.uniform2fv(e,f);case 35665:return n.uniform3fv(e,f);case 35666:return n.uniform4fv(e,f);case 5124:return n.uniform1iv(e,f);case 35667:return n.uniform2iv(e,f);case 35668:return n.uniform3iv(e,f);case 35669:return n.uniform4iv(e,f);case 35670:return n.uniform1iv(e,f);case 35671:return n.uniform2iv(e,f);case 35672:return n.uniform3iv(e,f);case 35673:return n.uniform4iv(e,f);case 5125:return s.uniform1uiv(e,f,1);case 36294:return s.uniform2uiv(e,f,2);case 36295:return s.uniform3uiv(e,f,3);case 36296:return s.uniform4uiv(e,f,4);case 35674:return n.uniformMatrix2fv(e,!1,f);case 35675:return n.uniformMatrix3fv(e,!1,f);case 35676:return n.uniformMatrix4fv(e,!1,f);case 35685:return s.uniformMatrix2x3fv(e,!1,f);case 35686:return s.uniformMatrix2x4fv(e,!1,f);case 35687:return s.uniformMatrix3x2fv(e,!1,f);case 35688:return s.uniformMatrix3x4fv(e,!1,f);case 35689:return s.uniformMatrix4x2fv(e,!1,f);case 35690:return s.uniformMatrix4x3fv(e,!1,f)}throw new Error("Illegal uniform")}function eN(n){return gx(n)!==null||typeof n=="number"||typeof n=="boolean"}function tN(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];eN(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}function nN(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function rN(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const l_=4;class iN extends eu{constructor(t,r){super(t,r);ne(this,"device");ne(this,"handle");ne(this,"vs");ne(this,"fs");ne(this,"introspectedLayout");ne(this,"uniforms",{});ne(this,"bindings",{});ne(this,"varyings",null);ne(this,"_uniformCount",0);ne(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:s,bufferMode:u=35981}=r;s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,u)),this._linkShaders(),jt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=HF(this.device.gl,this.handle),jt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=sN(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,r){for(const[s,u]of Object.entries(t)){const f=this.shaderLayout.bindings.find(m=>m.name===s)||this.shaderLayout.bindings.find(m=>m.name===`${s}Uniforms`);if(!f){const m=this.shaderLayout.bindings.map(o=>`"${o.name}"`).join(", ");r!=null&&r.disableWarnings||jt.warn(`No binding "${s}" in render pipeline "${this.id}", expected one of ${m}`,u)();continue}switch(u||jt.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),f.type){case"uniform":if(!(u instanceof w2)&&!(u.buffer instanceof w2))throw new Error("buffer value");break;case"texture":if(!(u instanceof H4||u instanceof T2||u instanceof b2))throw new Error("texture value");break;case"sampler":jt.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(f.type)}this.bindings[s]=u}}draw(t){var ee;const{renderPass:r,parameters:s=this.props.parameters,topology:u=this.props.topology,vertexArray:f,vertexCount:m,instanceCount:o,isInstanced:T=!1,firstVertex:C=0,transformFeedback:R}=t,O=nN(u),U=!!f.indexBuffer,V=(ee=f.indexBuffer)==null?void 0:ee.glIndexType;if(this.linkStatus!=="success")return jt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return jt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),f.bindBeforeRender(r),R&&R.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const Y=r;return TF(this.device,s,Y.glParameters,()=>{U&&T?this.device.gl.drawElementsInstanced(O,m||0,V,C,o||0):U?this.device.gl.drawElements(O,m||0,V,C):T?this.device.gl.drawArraysInstanced(O,C,m||0,o||0):this.device.gl.drawArrays(O,C,m||0),R&&R.end()}),f.unbindAfterRender(r),!0}setUniformsWebGL(t){const{bindings:r}=tN(t);Object.keys(r).forEach(s=>{jt.warn(`Unsupported value "${JSON.stringify(r[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),jt.time(l_,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),jt.timeEnd(l_,`linkProgram for ${this.id}`)(),jt.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}jt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),jt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(t){var r;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const s=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${s}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async u=>await new Promise(f=>setTimeout(f,u));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(jt.warn(`Binding ${r.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let r=0,s=0;for(const u of this.shaderLayout.bindings){const f=this.bindings[u.name]||this.bindings[u.name.replace(/Uniforms$/,"")];if(!f)throw new Error(`No value for binding ${u.name} in ${this.id}`);switch(u.type){case"uniform":const{name:m}=u,o=t.getUniformBlockIndex(this.handle,m);if(o===4294967295)throw new Error(`Invalid uniform block name ${m}`);t.uniformBlockBinding(this.handle,s,o),f instanceof w2?t.bindBufferBase(35345,s,f.handle):t.bindBufferRange(35345,s,f.buffer.handle,f.offset||0,f.size||f.buffer.byteLength-f.offset),s+=1;break;case"texture":if(!(f instanceof H4||f instanceof T2||f instanceof b2))throw new Error("texture");let T;if(f instanceof H4)T=f.texture;else if(f instanceof T2)T=f;else if(f instanceof b2&&f.colorAttachments[0]instanceof H4)jt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),T=f.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(T.glTarget,T.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${u.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:r,location:s,type:u,textureUnit:f}=t,m=this.uniforms[r]??f;m!==void 0&&QF(this.device.gl,s,u,m)}}}function sN(n,e){const t={...n,attributes:n.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const s=t.attributes.find(u=>u.name===r.name);s?(s.type=r.type||s.type,s.stepMode=r.stepMode||s.stepMode):jt.warn(`shader layout attribute ${r.name} not present in shader`)}return t}class oN extends Q9{constructor(t){super(t,{});ne(this,"device");ne(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const r of t)switch(r.name){case"copy-buffer-to-buffer":aN(this.device,r.options);break;case"copy-buffer-to-texture":lN(this.device,r.options);break;case"copy-texture-to-buffer":cN(this.device,r.options);break;case"copy-texture-to-texture":uN(this.device,r.options);break;default:throw new Error(r.name)}}}function aN(n,e){const t=e.sourceBuffer,r=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,r.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function lN(n,e){throw new Error("Not implemented")}function cN(n,e){const{sourceTexture:t,mipLevel:r=0,aspect:s="all",width:u=e.sourceTexture.width,height:f=e.sourceTexture.height,depthOrArrayLayers:m=0,origin:o=[0,0],destinationBuffer:T,byteOffset:C=0,bytesPerRow:R,rowsPerImage:O}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||m!==0||R||O)throw new Error("not implemented");const{framebuffer:U,destroyFramebuffer:V}=Fx(t);let Y;try{const ee=T,le=u||U.width,Ee=f||U.height,ue=Cx(U.colorAttachments[0].texture.props.format),_e=ue.format,Me=ue.type;n.gl.bindBuffer(35051,ee.handle),Y=n.gl.bindFramebuffer(36160,U.handle),n.gl.readPixels(o[0],o[1],le,Ee,_e,Me,C)}finally{n.gl.bindBuffer(35051,null),Y!==void 0&&n.gl.bindFramebuffer(36160,Y),V&&U.destroy()}}function uN(n,e){const{sourceTexture:t,destinationMipLevel:r=0,origin:s=[0,0],destinationOrigin:u=[0,0],destinationTexture:f}=e;let{width:m=e.destinationTexture.width,height:o=e.destinationTexture.height}=e;const{framebuffer:T,destroyFramebuffer:C}=Fx(t),[R,O]=s,[U,V,Y]=u,ee=n.gl.bindFramebuffer(36160,T.handle);let le=null,Ee;if(f instanceof T2)le=f,m=Number.isFinite(m)?m:le.width,o=Number.isFinite(o)?o:le.height,le.bind(0),Ee=le.glTarget;else throw new Error("invalid destination");switch(Ee){case 3553:case 34067:n.gl.copyTexSubImage2D(Ee,r,U,V,R,O,m,o);break;case 35866:case 32879:n.gl.copyTexSubImage3D(Ee,r,U,V,Y,R,O,m,o);break}le&&le.unbind(),n.gl.bindFramebuffer(36160,ee),C&&T.destroy()}function Fx(n){if(n instanceof wi){const{width:e,height:t,id:r}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class hN extends J9{constructor(t,r){super(t,r);ne(this,"device");ne(this,"commandBuffer");this.device=t,this.commandBuffer=new oN(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,s){}}function fN(n){const{target:e,source:t,start:r=0,count:s=1}=n,u=t.length,f=s*u;let m=0;for(let o=r;m<u;m++)e[o++]=t[m];for(;m<f;)m<f-m?(e.copyWithin(r+m,r,r+m),m*=2):(e.copyWithin(r+m,r,r+f-m),m=f);return n.target}class Cf extends eh{constructor(t,r){super(t,r);ne(this,"device");ne(this,"handle");ne(this,"buffer",null);ne(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return MA()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){const s=r;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:u,type:f,stride:m,offset:o,normalized:T,integer:C,divisor:R}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),C?this.device.gl.vertexAttribIPointer(t,u,f,m,o):this.device.gl.vertexAttribPointer(t,u,f,T,m,o),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,R||0),this.attributes[t]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){const r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);const s=Ax(r.bufferDataType);return{size:r.bufferComponents,type:s,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){const u=Cf.isConstantAttributeZeroSupported(this.device)||t!==0;(r||u)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){const s=dN(r),u=s.byteLength*t,f=s.length*t;if(this.buffer&&u!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${u} !== ${this.buffer.byteLength}.`);let m=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:u}),m=m||!pN(s,this.bufferValue),m){const o=gM(r.constructor,f);fN({target:o,source:s,start:0,count:f}),this.buffer.write(o),this.bufferValue=r}return this.buffer}}function dN(n){return Array.isArray(n)?new Float32Array(n):n}function pN(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class mN extends th{constructor(t,r){super(t,r);ne(this,"device");ne(this,"gl");ne(this,"handle");ne(this,"layout");ne(this,"buffers",{});ne(this,"unusedBuffers",{});ne(this,"bindOnUse",!0);ne(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(rN(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){const s=this._getVaryingIndex(t),{buffer:u,byteLength:f,byteOffset:m}=this._getBufferRange(r);if(s<0){this.unusedBuffers[t]=u,jt.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[s]={buffer:u,byteLength:f,byteOffset:m},this.bindOnUse||this._bindBuffer(s,u,m,f)}getBuffer(t){if(c_(t))return this.buffers[t]||null;const r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof w2)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:r,byteOffset:s=0,byteLength:u=t.buffer.byteLength}=t;return{buffer:r,byteOffset:s,byteLength:u}}_getVaryingIndex(t){if(c_(t))return Number(t);for(const r of this.layout.varyings)if(t===r.name)return r.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:r,byteLength:s,byteOffset:u}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,u,s)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,s=0,u){const f=r&&r.handle;!f||u===void 0?this.gl.bindBufferBase(35982,t,f):this.gl.bindBufferRange(35982,t,f,s,u)}}function c_(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class gN extends nh{constructor(t,r){super(t,r);ne(this,"device");ne(this,"handle");ne(this,"target",null);ne(this,"_queryPending",!1);ne(this,"_pollingPromise",null);if(this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((s,u)=>{const f=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):r++>t?(u("Timed out"),this._pollingPromise=null):requestAnimationFrame(f)};requestAnimationFrame(f)}),this._pollingPromise}}class X4 extends T3{constructor(t){var R,O;super({...t,id:t.id||yF("webgl-device")});ne(this,"type","webgl");ne(this,"handle");ne(this,"features");ne(this,"limits");ne(this,"info");ne(this,"canvasContext");ne(this,"lost");ne(this,"_resolveContextLost");ne(this,"gl");ne(this,"debug",!1);ne(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});ne(this,"_extensions",{});ne(this,"_polyfilled",!1);ne(this,"spectorJS");ne(this,"renderPass",null);ne(this,"_constants");const r=T3._getCanvasContextProps(t);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=(O=(R=r.canvas)==null?void 0:R.gl)==null?void 0:O.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new aF(this,r),this.lost=new Promise(U=>{this._resolveContextLost=U});const u={...t.webgl};r.alphaMode==="premultiplied"&&(u.premultipliedAlpha=!0),t.powerPreference!==void 0&&(u.powerPreference=t.powerPreference);const m=this.props._handle||VL(this.canvasContext.canvas,{onContextLost:U=>{var V;return(V=this._resolveContextLost)==null?void 0:V.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:U=>console.log("WebGL context restored")},u);if(!m)throw new Error("WebGL context creation failed");if(s=m.device,s){if(t._reuseDevices)return jt.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=m,this.gl=m,this.spectorJS=uF({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=jL(this.gl,this._extensions),this.limits=new iF(this.gl),this.features=new rF(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new F0(this.gl,{log:(...U)=>jt.log(1,...U)()}).trackState(this.gl,{copyState:!1});const T=t.debugWebGL||t.debug,C=t.debugWebGL;T&&(this.gl=dF(this.gl,{debugWebGL:T,traceWebGL:C}),jt.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(jt.level=Math.max(jt.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const r=this._normalizeBufferProps(t);return new w2(this,r)}createTexture(t){return new T2(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new Th(this,t)}createShader(t){return new wF(this,t)}createFramebuffer(t){return new b2(this,t)}createVertexArray(t){return new Cf(this,t)}createTransformFeedback(t){return new mN(this,t)}createQuerySet(t){return new gN(this,t)}createRenderPipeline(t){return new iN(this,t)}beginRenderPass(t){return new VF(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new hN(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,r){return FF(t,r)}readPixelsToBufferWebGL(t,r){return NF(t,r)}setParametersWebGL(t){fu(this.gl,t)}getParametersWebGL(t){return Ex(this.gl,t)}withParametersWebGL(t,r){return Z7(this.gl,t,r)}resetWebGL(){jt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),FL(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return QL(this.gl,t,this._extensions)}loseDevice(){var u;let t=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(t=!0,s.loseContext()),(u=this._resolveContextLost)==null||u.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){F0.get(this.gl).push()}popState(){F0.get(this.gl).pop()}setSpectorMetadata(t,r){t.__SPECTOR_Metadata=r}getGLKey(t,r){const s=Number(t);for(const u in this.gl)if(this.gl[u]===s)return`GL.${u}`;return r!=null&&r.emptyIfUnknown?"":String(t)}getGLKeys(t){const r={emptyIfUnknown:!0};return Object.entries(t).reduce((s,[u,f])=>(s[`${u}:${this.getGLKey(u,r)}`]=`${f}:${this.getGLKey(f,r)}`,s),{})}setConstantAttributeWebGL(t,r){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const u=this._constants[t];switch(u&&xN(u,r)&&jt.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:_N(this,t,r);break;case Int32Array:yN(this,t,r);break;case Uint32Array:vN(this,t,r);break;default:throw new Error("constant")}}getExtension(t){return uu(this.gl,t,this._extensions),this._extensions}}function _N(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function yN(n,e,t){n.gl.vertexAttribI4iv(e,t)}function vN(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function xN(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const bN={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},wN=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),TN=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),EN=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function SN(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,r){if(t==="webgl"||t==="experimental-webgl"){const s=this.originalGetContext("webgl2",r);return s instanceof HTMLElement&&AN(s),s}return this.originalGetContext(t,r)}}function AN(n){n.getExtension("EXT_color_buffer_float");const e={...bN,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:wN(n),OES_vertex_array_object:TN(n),ANGLE_instanced_arrays:EN(n)},t=n.getExtension;n.getExtension=function(s){const u=t.call(n,s);return u||(s in e?e[s]:null)};const r=n.getSupportedExtensions;n.getSupportedExtensions=function(){const s=r.apply(n)||[];return s==null?void 0:s.concat(Object.keys(e))}}const X8=1;class CN extends XI{constructor(){super();ne(this,"type","webgl");T3.defaultProps={...T3.defaultProps,...Af},X4.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){SN(t)}async attach(t){if(t instanceof X4)return t;if((t==null?void 0:t.device)instanceof T3)return t.device;if(!PN(t))throw new Error("Invalid WebGL2RenderingContext");return new X4({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){jt.groupCollapsed(X8,"WebGLDevice created")();const r=[];(t.debugWebGL||t.debug)&&r.push(fF()),t.debugSpectorJS&&r.push(cF(t));const s=await Promise.allSettled(r);for(const m of s)m.status==="rejected"&&jt.error(`Failed to initialize debug libraries ${m.reason}`)();const u=new X4(t),f=`${u._reused?"Reusing":"Created"} device with WebGL2 ${u.debug?"debug ":""}context: ${u.info.vendor}, ${u.info.renderer} for canvas: ${u.canvasContext.id}`;return jt.probe(X8,f)(),jt.table(X8,u.info)(),jt.groupEnd(X8)(),u}}function PN(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const u_=new CN;function f3(){}const IN=({isDragging:n})=>n?"grabbing":"grab",Nx={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:f3,onWebGLInitialized:f3,onResize:f3,onViewStateChange:f3,onInteractionStateChange:f3,onBeforeRender:f3,onAfterRender:f3,onLoad:f3,onError:n=>lr.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:IN,getTooltip:null,debug:!1,drawPickingColors:!1};class Pf{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new g6({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:s}=this;if(r.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(r.leftButton||r.rightButton)return;{const u=r.offsetCenter;if(!u)return;s.x=u.x,s.y=u.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=r},this._onEvent=r=>{const s=fh[r.type],u=r.offsetCenter;if(!s||!u||!this.layerManager)return;const f=this.layerManager.getLayers(),m=this.deckPicker.getLastPickedObject({x:u.x,y:u.y,layers:f,viewports:this.getViewports(u)},this._lastPointerDownInfo),{layer:o}=m,T=o&&(o[s]||o.props[s]),C=this.props[s];let R=!1;T&&(R=T.call(o,m,r)),R||(C==null||C(m,r),this.widgetManager.onEvent(m,r))},this._onPointerDown=r=>{var f;if(((f=this.device)==null?void 0:f.type)==="webgpu")return;const s=r.offsetCenter,u=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=u.result[0]||u.emptyInfo},this.props={...Nx,...e},e=this.props,e.viewState&&e.initialViewState&&lr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&lr.error("WebGL1 context not supported.")(),t=u_.attach(e.gl)),t||(t=G9.createDevice({type:"best-available",_reuseDevices:!0,adapters:[u_],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&ou.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,r,s,u,f,m,o,T,C;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(u=this.effectManager)==null||u.finalize(),this.effectManager=null,(f=this.deckRenderer)==null||f.finalize(),this.deckRenderer=null,(m=this.deckPicker)==null||m.finalize(),this.deckPicker=null,(o=this.eventManager)==null||o.destroy(),this.eventManager=null,(T=this.widgetManager)==null||T.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((C=this.canvas.parentElement)==null||C.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&lr.removed("onLayerHover","onHover")(),"onLayerClick"in e&&lr.removed("onLayerClick","onClick")(),e.initialViewState&&!Ol(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),u=this.effectManager.needsRedraw(e),f=this.deckRenderer.needsRedraw(e);return t=t||r||s||u||f,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Fs(this.viewManager),this.viewManager.views}getViewports(e){return Fs(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,r){Fs(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const u=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return s.get(t).timeEnd(),u}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Fs(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var s;if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const u=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=u}if(r||r===0){const u=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((s=e.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=u}}_updateCanvasSize(){var s,u;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,r=e.clientHeight??e.height;(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,(s=this.viewManager)==null||s.setProps({width:t,height:r}),(u=this.layerManager)==null||u.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:r}))}_createAnimationLoop(e,t){const{gl:r,onError:s,useDevicePixels:u}=t;return new kD({device:e,useDevicePixels:u,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:f=>this._setDevice(f.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new wf({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,r,s,u;if(((t=this.device)==null?void 0:t.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:f,emptyInfo:m}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=f.length>0;let o=m,T=!1;for(const C of f)o=C,T=((r=C.layer)==null?void 0:r.onHover(C,e.event))||T;T||((u=(s=this.props).onHover)==null||u.call(s,o,e.event),this.widgetManager.onHover(o,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var s,u;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new mx;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new lO(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Mg).map(f=>{var U;const[m,o,T,C]=Mg[f],R=(U=this.props.eventRecognizerOptions)==null?void 0:U[f],O={...o,...R,event:f};return{recognizer:new m(O),recognizeWith:T,requestFailure:C}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const f in fh)this.eventManager.on(f,this._onEvent);this.viewManager=new nL({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new tL(this.device,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new yL({deck:this,device:this.device}),this.deckRenderer=new bL(this.device),this.deckPicker=new CL(this.device),this.widgetManager=new ML({deck:this,parentElement:(u=this.canvas)==null?void 0:u.parentElement}),this.widgetManager.addDefault(new kL),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var f;const{device:r,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:s});const u={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(f=this.deckRenderer)==null||f.renderLayers(u),u.pass==="screen"&&this.widgetManager.onRedraw({viewports:u.viewports,layers:u.layers}),this.props.onAfterRender({device:r,gl:s})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),lr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=G9.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}Pf.defaultProps=Nx;Pf.VERSION=KP;function MN(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return vv(n)}}const RN=yv;function Z8(n,e,t){const r=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function k0(n){return n.stride||n.size*n.bytesPerElement}function kN(n,e){return n.type===e.type&&n.size===e.size&&k0(n)===k0(e)&&(n.offset||0)===(e.offset||0)}function Eh(n,e){e.offset&&lr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=k0(n),r=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,s=e.elementOffset||0,u=r*t+s*n.bytesPerElement+(n.offset||0);return{...e,offset:u,stride:t}}function ON(n,e){const t=Eh(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class DN{constructor(e,t,r){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,u=s==="float64";let{defaultValue:f}=t;f=Number.isFinite(f)?[f]:f||new Array(this.size).fill(0);let m;u?m="float32":!s&&t.isIndexed?m="uint32":m=s||"float32";let o=MN(s||m);this.doublePrecision=u,u&&t.fp64===!1&&(o=Float32Array),this.value=null,this.settings={...t,defaultType:o,defaultValue:f,logicalType:s,type:m,normalized:m.includes("norm"),size:this.size,bytesPerElement:o.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*k0(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),ou.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const r={};if(this.state.constant){const s=this.value;if(t){const u=Eh(this.getAccessor(),t),f=u.offset/s.BYTES_PER_ELEMENT,m=u.size||this.size;r[e]=s.subarray(f,f+m)}else r[e]=s}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){const r=this.getAccessor(),s=[],u={name:this.id,byteStride:k0(r),attributes:s};if(this.doublePrecision){const f=ON(r,t||{});s.push(Z8(e,{...r,...f.high},this.device.type),Z8(`${e}64Low`,{...r,...f.low},this.device.type))}else if(t){const f=Eh(r,t);s.push(Z8(e,{...r,...f},this.device.type))}else s.push(Z8(e,r,this.device.type));return u}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:s}=this,u=r*s;if(t&&u&&t.length>=u){const f=new Array(s).fill(1/0),m=new Array(s).fill(-1/0);for(let o=0;o<u;)for(let T=0;T<s;T++){const C=t[o++];C<f[T]&&(f[T]=C),C>m[T]&&(m[T]=C)}e=[f,m]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Jr?r={buffer:e}:r=e;const s={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)s.type="float32";else{const f=RN(r.value);s.type=s.normalized?f.replace("int","norm"):f}s.bytesPerElement=r.value.BYTES_PER_ELEMENT,s.stride=k0(s)}if(t.bounds=null,r.constant){let u=r.value;if(u=this._normalizeValue(u,[],0),this.settings.normalized&&(u=this.normalizeConstant(u)),!(!t.constant||!this._areValuesEqual(u,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(u)?u:new Float32Array(u)}else if(r.buffer){const u=r.buffer;t.externalBuffer=u,t.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let u=r.value;t.externalBuffer=null,t.constant=!1,this.value=u;let{buffer:f}=this;const m=k0(s),o=(s.vertexOffset||0)*m;if(this.doublePrecision&&u instanceof Float64Array&&(u=o9(u,s)),this.settings.isIndexed){const C=this.settings.defaultType;u.constructor!==C&&(u=new C(u))}const T=u.byteLength+o+m*2;(!f||f.byteLength<T)&&(f=this._createBuffer(T)),f.write(u,o)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?o9(t,{size:this.size,startIndex:r,endIndex:s}):t.subarray(r,s),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:r}=this,s=r.allocatedValue,u=ou.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=u;const{byteOffset:f}=this;let{buffer:m}=this;return(!m||m.byteLength<u.byteLength+f)&&(m=this._createBuffer(u.byteLength+f),t&&s&&m.write(s instanceof Float64Array?o9(s,this):s,f)),r.allocatedValue=u,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&lr.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:s,size:u}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let f=u;for(;--f>=0;)t[r+f]=s[f];return t}switch(u){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let f=u;for(;--f>=0;)t[r+f]=Number.isFinite(e[f])?e[f]:s[f]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let s=0;s<r;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){var s;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(s=this._buffer)==null?void 0:s.props,id:this.id,usage:(t?Jr.INDEX:Jr.VERTEX)|Jr.COPY_DST,indexType:t?r:void 0,byteLength:e}),this._buffer}}const h_=[],f_=[];function w6(n,e=0,t=1/0){let r=h_;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?r=n:n.length>0&&(f_.length=n.length,r=f_):r=h_,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),s.index=e-1),{iterable:r,objectInfo:s}}function Bx(n){return n&&n[Symbol.asyncIterator]}function zx(n,e){const{size:t,stride:r,offset:s,startIndices:u,nested:f}=e,m=n.BYTES_PER_ELEMENT,o=r?r/m:t,T=s?s/m:0,C=Math.floor((n.length-T)/o);return(R,{index:O,target:U})=>{if(!u){const le=O*o+T;for(let Ee=0;Ee<t;Ee++)U[Ee]=n[le+Ee];return U}const V=u[O],Y=u[O+1]||C;let ee;if(f){ee=new Array(Y-V);for(let le=V;le<Y;le++){const Ee=le*o+T;U=new Array(t);for(let ue=0;ue<t;ue++)U[ue]=n[Ee+ue];ee[le-V]=U}}else if(o===t)ee=n.subarray(V*t+T,Y*t+T);else{ee=new n.constructor((Y-V)*t);let le=0;for(let Ee=V;Ee<Y;Ee++){const ue=Ee*o+T;for(let _e=0;_e<t;_e++)ee[le++]=n[ue+_e]}}return ee}}const LN=[],c7=[[0,1/0]];function FN(n,e){if(n===c7||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],r=n.length;let s=0;for(let u=0;u<r;u++){const f=n[u];f[1]<e[0]?(t.push(f),s=u+1):f[0]>e[1]?t.push(f):e=[Math.min(f[0],e[0]),Math.max(f[1],e[1])]}return t.splice(s,0,e),t}const NN={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function Ux(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...NN[t],...e,...n,type:t}}class Vx extends DN{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:c7}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!kN(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,s=Array.isArray(t)?e[t.find(u=>e[u])]:e[t];return Ux(s,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:s=1/0}=t;this.state.updateRanges=FN(this.state.updateRanges,[r,s])}else this.state.updateRanges=c7}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=LN}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==c7),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:u},settings:{update:f,noAlloc:m}}=this;let o=!0;if(f){for(const[T,C]of u)f.call(s,this,{data:t,startRow:T,endRow:C,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[T,C]of u){const R=Number.isFinite(T)?this.getVertexOffset(T):0,O=Number.isFinite(C)?this.getVertexOffset(C):m||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:R,endOffset:O})}this._checkAttributeArray()}else o=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),o}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:s}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const f=e;Fs(ArrayBuffer.isView(f.value),`invalid ${s.accessor}`);const m=!!f.size&&f.size!==this.size;return r.binaryAccessor=zx(f.value,{size:f.size||this.size,stride:f.stride,offset:f.offset,startIndices:t,nested:m}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=s??"vertex",!t)return r;for(const u in t){const f=super._getBufferLayout(u,t[u]);r.attributes.push(...f.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:s,props:u,numInstances:f}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:m,state:o,value:T,size:C,startIndices:R}=e,{accessor:O,transform:U}=m;let V=o.binaryAccessor||(typeof O=="function"?O:u[O]);typeof V!="function"&&(V=()=>V),Fs(typeof V=="function",`accessor "${O}" is not a function`);let Y=e.getVertexOffset(r);const{iterable:ee,objectInfo:le}=w6(t,r,s);for(const Ee of ee){le.index++;let ue=V(Ee,le);if(U&&(ue=U.call(this,ue)),R){const _e=(le.index<R.length-1?R[le.index+1]:f)-R[le.index];if(ue&&Array.isArray(ue[0])){let Me=Y;for(const Fe of ue)e._normalizeValue(Fe,T,Me),Me+=C}else ue&&ue.length>C?T.set(ue,Y):(e._normalizeValue(ue,le.target,0),YD({target:T,source:le.target,start:Y,count:_e}));Y+=_e*C}else e._normalizeValue(ue,T,Y),Y+=C}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function m9(n){const{source:e,target:t,start:r=0,size:s,getData:u}=n,f=n.end||t.length,m=e.length,o=f-r;if(m>o){t.set(e.subarray(0,o),r);return}if(t.set(e,r),!u)return;let T=m;for(;T<o;){const C=u(T,e);for(let R=0;R<s;R++)t[r+T]=C[R]||0,T++}}function BN({source:n,target:e,size:t,getData:r,sourceStartIndices:s,targetStartIndices:u}){if(!s||!u)return m9({source:n,target:e,size:t,getData:r}),e;let f=0,m=0;const o=r&&((C,R)=>r(C+m,R)),T=Math.min(s.length,u.length);for(let C=1;C<T;C++){const R=s[C]*t,O=u[C]*t;m9({source:n.subarray(f,R),target:e,start:m,end:O,size:t,getData:o}),f=R,m=O}return m<e.length&&m9({source:[],target:e,start:m,size:t,getData:o}),e}function zN(n){const{device:e,settings:t,value:r}=n,s=new Vx(e,t);return s.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function jx(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function $x(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Wx(n){n.push(n.shift())}function UN(n,e){const{doublePrecision:t,settings:r,value:s,size:u}=n,f=t&&s instanceof Float64Array?2:1;let m=0;const{shaderAttributes:o}=n.settings;if(o)for(const T of Object.values(o))m=Math.max(m,T.vertexOffset??0);return(r.noAlloc?s.length:(e+m)*u)*f}function Hx({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function Xx({device:n,buffer:e,attribute:t,fromLength:r,toLength:s,fromStartIndices:u,getData:f=m=>m}){const m=t.doublePrecision&&t.value instanceof Float64Array?2:1,o=t.size*m,T=t.byteOffset,C=t.settings.bytesPerElement<4?T/t.settings.bytesPerElement*4:T,R=t.startIndices,O=u&&R,U=t.isConstant;if(!O&&e&&r>=s)return e;const V=t.value instanceof Float64Array?Float32Array:t.value.constructor,Y=U?t.value:new V(t.getBuffer().readSyncWebGL(T,s*V.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!U){const ue=f;f=(_e,Me)=>t.normalizeConstant(ue(_e,Me))}const ee=U?(ue,_e)=>f(Y,_e):(ue,_e)=>f(Y.subarray(ue+T,ue+T+o),_e),le=e?new Float32Array(e.readSyncWebGL(C,r*4).buffer):new Float32Array(0),Ee=new Float32Array(s);return BN({source:le,target:Ee,sourceStartIndices:u,targetStartIndices:R,size:o,getData:ee}),(!e||e.byteLength<Ee.byteLength+C)&&(e==null||e.destroy(),e=n.createBuffer({byteLength:Ee.byteLength+C,usage:35050})),e.write(Ee,C),e}class Zx{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new b6(r),this.attribute=t,this.attributeInTransition=zN(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=UN(this.attribute,t),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class VN extends Zx{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=HN(e,t)}start(e,t){const r=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:u,attribute:f}=this;Wx(u),u[0]=Xx({device:this.device,buffer:u[0],attribute:f,fromLength:r,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),u[1]=Hx({device:this.device,source:u[0],target:u[1]}),this.setBuffer(u[1]);const{transform:m}=this,o=m.model;let T=Math.floor(this.currentLength/f.size);qx(f)&&(T/=2),o.setVertexCount(T),f.isConstant?(o.setAttributes({aFrom:u[0]}),o.setConstantAttributes({aTo:f.value})):o.setAttributes({aFrom:u[0],aTo:f.getBuffer()}),m.transformFeedback.setBuffers({vCurrent:u[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:r}=this.transition;let s=r/e;t&&(s=t(s));const{model:u}=this.transform,f={time:s};u.shaderInputs.setProps({interpolation:f}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const jN=`uniform interpolationUniforms {
  float time;
} interpolation;
`,d_={name:"interpolation",vs:jN,uniformTypes:{time:"f32"}},$N=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,WN=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function qx(n){return n.doublePrecision&&n.value instanceof Float64Array}function HN(n,e){const t=e.size,r=jx(t),s=$x(t),u=e.getBufferLayout();return qx(e)?new k2(n,{vs:WN,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[JR,d_],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new k2(n,{vs:$N,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:u.attributes[0].format}],modules:[d_],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class XN extends Zx{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=JN(e),this.framebuffer=QN(e,this.texture),this.transform=KN(e,t)}start(e,t){const r=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:u,attribute:f}=this;for(let o=0;o<2;o++)u[o]=Xx({device:this.device,buffer:u[o],attribute:f,fromLength:r,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});u[2]=Hx({device:this.device,source:u[0],target:u[2]}),this.setBuffer(u[1]);const{model:m}=this.transform;m.setVertexCount(Math.floor(this.currentLength/f.size)),f.isConstant?m.setConstantAttributes({aTo:f.value}):m.setAttributes({aTo:f.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:r,transition:s}=this,u=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const f={stiffness:u.stiffness,damping:u.damping};t.model.shaderInputs.setProps({spring:f}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Wx(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const ZN=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,qN={name:"spring",vs:ZN,uniformTypes:{damping:"f32",stiffness:"f32"}},GN=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,YN=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function KN(n,e){const t=jx(e.size),r=$x(e.size);return new k2(n,{vs:GN,fs:YN,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[qN],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function JN(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function QN(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const eB={interpolation:VN,spring:XN};class tB{constructor(e,{id:t,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const s in e){const u=e[s],f=u.getTransitionSetting(t);f&&this._updateAttribute(s,u,f)}for(const s in this.transitions){const u=e[s];(!u||!u.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){const s=this.transitions[e];let u=!s||s.type!==r.type;if(u){s&&this._removeTransition(e);const f=eB[r.type];f?this.transitions[e]=new f({attribute:t,timeline:this.timeline,device:this.device}):(lr.error(`unsupported transition type '${r.type}'`)(),u=!1)}(u||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const p_="attributeManager.invalidate",nB="attributeManager.updateStart",rB="attributeManager.updateEnd",iB="attribute.updateStart",sB="attribute.allocate",oB="attribute.updateEnd";class aB{constructor(e,{id:t="attribute-manager",stats:r,timeline:s}={}){this.mergeBoundsMemoized=V2(vD),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new tB(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);eo(p_,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);eo(p_,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:s,props:u={},buffers:f={},context:m={}}){let o=!1;eo(nB,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const T in this.attributes){const C=this.attributes[T],R=C.settings.accessor;C.startIndices=r,C.numInstances=t,u[T]&&lr.removed(`props.${T}`,`data.attributes.${T}`)(),C.setExternalBuffer(f[T])||C.setBinaryValue(typeof R=="string"?f[R]:void 0,e.startIndices)||typeof R=="string"&&!f[R]&&C.setConstantValue(u[R])||C.needsUpdate()&&(o=!0,this._updateAttribute({attribute:C,numInstances:t,data:e,props:u,context:m})),this.needsRedraw=this.needsRedraw||C.needsRedraw()}o&&eo(rB,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(r=>{var s;return(s=this.attributes[r])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,s={...r.getAttributes()};for(const u in t){const f=t[u];f.needsRedraw(e)&&!r.hasAttribute(u)&&(s[u]=f)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const r in e){const s=e[r],u={...s,id:r,size:s.isIndexed&&1||s.size||1,...t};this.attributes[r]=new Vx(this.device,u)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:s}=this,u=s[e];return u&&u.forEach(f=>{const m=r[f];m&&m.setNeedsUpdate(m.id,t)}),u}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(eo(iB,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&eo(sB,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,eo(oB,t,r))}}class lB extends b6{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:s,easing:u}}=this,f=u(e/s);this._value=U7(t,r,f)}}const m_=1e-5;function g_(n,e,t,r,s){const u=e-n,m=(t-e)*s,o=-u*r;return m+o+u+e}function cB(n,e,t,r,s){if(Array.isArray(t)){const u=[];for(let f=0;f<t.length;f++)u[f]=g_(n[f],e[f],t[f],r,s);return u}return g_(n,e,t,r,s)}function __(n,e){if(Array.isArray(n)){let t=0;for(let r=0;r<n.length;r++){const s=n[r]-e[r];t+=s*s}return Math.sqrt(t)}return Math.abs(n-e)}class uB extends b6{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:s}=this.settings,{_prevValue:u=e,_currValue:f=e}=this;let m=cB(u,f,t,r,s);const o=__(m,t),T=__(m,f);o<m_&&T<m_&&(m=t,this.end()),this._prevValue=f,this._currValue=m}}const hB={interpolation:lB,spring:uB};class fB{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,s){const{transitions:u}=this;if(u.has(e)){const o=u.get(e),{value:T=o.settings.fromValue}=o;t=T,this.remove(e)}if(s=Ux(s),!s)return;const f=hB[s.type];if(!f){lr.error(`unsupported transition type '${s.type}'`)();return}const m=new f(this.timeline);m.start({...s,fromValue:t,toValue:r}),u.set(e,m)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function dB(n){const e=n[S3];for(const t in e){const r=e[t],{validate:s}=r;if(s&&!s(n[t],r))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function pB(n,e){const t=Gx({newProps:n,oldProps:e,propTypes:n[S3],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=gB(n,e);let s=!1;return r||(s=_B(n,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:s,extensionsChanged:yB(n,e),transitionsChanged:mB(n,e)}}function mB(n,e){if(!n.transitions)return!1;const t={},r=n[S3];let s=!1;for(const u in n.transitions){const f=r[u],m=f&&f.type;(m==="number"||m==="color"||m==="array")&&Sh(n[u],e[u],f)&&(t[u]=!0,s=!0)}return s?t:!1}function Gx({newProps:n,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:s="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const u of Object.keys(n))if(!(u in t)){if(!(u in e))return`${s}.${u} added`;const f=Sh(n[u],e[u],r[u]);if(f)return`${s}.${u} ${f}`}for(const u of Object.keys(e))if(!(u in t)){if(!(u in n))return`${s}.${u} dropped`;if(!Object.hasOwnProperty.call(n,u)){const f=Sh(n[u],e[u],r[u]);if(f)return`${s}.${u} ${f}`}}return!1}function Sh(n,e,t){let r=t&&t.equal;return r&&!r(n,e,t)||!r&&(r=n&&e&&n.equals,r&&!r.call(n,e))?"changed deeply":!r&&e!==n?"changed shallowly":null}function gB(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:s}=n;return r?r(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(n.data,e.data)||t),t}function _B(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&y_(n,e,"all"))return{all:!0};const t={};let r=!1;for(const s in n.updateTriggers)s!=="all"&&y_(n,e,s)&&(t[s]=!0,r=!0);return r?t:!1}function yB(n,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=n;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let s=0;s<r.length;s++)if(!r[s].equals(t[s]))return!0;return!1}function y_(n,e,t){let r=n.updateTriggers[t];r=r??{};let s=e.updateTriggers[t];return s=s??{},Gx({oldProps:s,newProps:r,triggerName:t})}const vB="count(): argument not an object",xB="count(): argument not a container";function bB(n){if(!TB(n))throw new Error(vB);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(wB(n))return Object.keys(n).length;throw new Error(xB)}function wB(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function TB(n){return n!==null&&typeof n=="object"}function v_(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(s=>s.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const r={...n.inject};for(const s in e.inject)r[s]=(r[s]||"")+e.inject[s];t.inject=r}return t}const EB={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Ah={};function SB(n,e,t,r){if(t instanceof wi)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const u=e.createTexture({...t,sampler:{...EB,...s,...r},mipmaps:!0});return Ah[u.id]=n,u}function AB(n,e){!e||!(e instanceof wi)||Ah[e.id]===n&&(e.delete(),delete Ah[e.id])}const CB={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||Ch(n)&&(n.length===3||n.length===4)},equal(n,e,t){return Ol(n,e,1)}},accessor:{validate(n,e){const t=q7(n);return t==="function"||t===q7(e.value)},equal(n,e,t){return typeof e=="function"?!0:Ol(n,e,1)}},array:{validate(n,e){return e.optional&&!n||Ch(n)},equal(n,e,t){const{compare:r}=t,s=Number.isInteger(r)?r:r?1:0;return r?Ol(n,e,s):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:r}=t,s=Number.isInteger(r)?r:r?1:0;return r?Ol(n,e,s):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:r}=t.props;return r?r(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const r=t.context;return!r||!r.device?null:SB(t.id,r.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{AB(t.id,n)}}};function PB(n){const e={},t={},r={};for(const[s,u]of Object.entries(n)){const f=u==null?void 0:u.deprecatedFor;if(f)r[s]=Array.isArray(f)?f:[f];else{const m=IB(s,u);e[s]=m,t[s]=m.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function IB(n,e){switch(q7(e)){case"object":return o2(n,e);case"array":return o2(n,{type:"array",value:e,compare:!1});case"boolean":return o2(n,{type:"boolean",value:e});case"number":return o2(n,{type:"number",value:e});case"function":return o2(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function o2(n,e){return"type"in e?{name:n,...CB[e.type],...e}:"value"in e?{name:n,type:q7(e.value),...e}:{name:n,type:"object",value:e}}function Ch(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function q7(n){return Ch(n)?"array":n===null?"null":typeof n}function MB(n,e){let t;for(let u=e.length-1;u>=0;u--){const f=e[u];"extensions"in f&&(t=f.extensions)}const r=Ph(n.constructor,t),s=Object.create(r);s[X7]=n,s[U0]={},s[v3]={};for(let u=0;u<e.length;++u){const f=e[u];for(const m in f)s[m]=f[m]}return Object.freeze(s),s}const RB="_mergedDefaultProps";function Ph(n,e){if(!(n instanceof T6.constructor))return{};let t=RB;if(e)for(const s of e){const u=s.constructor;u&&(t+=`:${u.extensionName||u.name}`)}const r=Yx(n,t);return r||(n[t]=kB(n,e||[]))}function kB(n,e){if(!n.prototype)return null;const r=Object.getPrototypeOf(n),s=Ph(r),u=Yx(n,"defaultProps")||{},f=PB(u),m=Object.assign(Object.create(null),s,f.defaultProps),o=Object.assign(Object.create(null),s==null?void 0:s[S3],f.propTypes),T=Object.assign(Object.create(null),s==null?void 0:s[u9],f.deprecatedProps);for(const C of e){const R=Ph(C.constructor);R&&(Object.assign(m,R),Object.assign(o,R[S3]),Object.assign(T,R[u9]))}return OB(m,n),LB(m,o),DB(m,T),m[S3]=o,m[u9]=T,e.length===0&&!If(n,"_propTypes")&&(n._propTypes=o),m}function OB(n,e){const t=NB(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function DB(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(r){const s=`${this.id}: ${t}`;for(const u of e[t])If(this,u)||(this[u]=r);lr.deprecated(s,e[t].join("/"))()}})}function LB(n,e){const t={},r={};for(const s in e){const u=e[s],{name:f,value:m}=u;u.async&&(t[f]=m,r[f]=FB(f))}n[Y4]=t,n[U0]={},Object.defineProperties(n,r)}function FB(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||Bx(e)?this[U0][n]=e:this[v3][n]=e},get(){if(this[v3]){if(n in this[v3])return this[v3][n]||this[Y4][n];if(n in this[U0]){const e=this[X7]&&this[X7].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[Y4][n]}}return this[Y4][n]}}}function If(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Yx(n,e){return If(n,e)&&n[e]}function NB(n){const e=n.componentName;return e||lr.warn(`${n.name}.componentName not specified`)(),e||n.name}let BB=0;class T6{constructor(...e){this.props=MB(this,e),this.id=this.props.id,this.count=BB++}clone(e){const{props:t}=this,r={};for(const s in t[Y4])s in t[v3]?r[s]=t[v3][s]:s in t[U0]&&(r[s]=t[U0][s]);return new this.constructor({...t,...r,...e})}}T6.componentName="Component";T6.defaultProps={};const zB=Object.freeze({});class UB{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||zB}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[X7]||this.component;const t=e[v3]||{},r=e[U0]||e,s=e[Y4]||{};for(const u in t){const f=t[u];this._createAsyncPropData(u,s[u]),this._updateAsyncProp(u,f),t[u]=this.getAsyncProp(u)}for(const u in r){const f=r[u];this._createAsyncPropData(u,s[u]),this._updateAsyncProp(u,f)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(Bx(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const s=this.asyncProps[e];s&&r>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const s=r.pendingLoadCount;t.then(u=>{this.component&&(u=this._postProcessValue(r,u),this._setAsyncPropValue(e,u,s),this._onResolve(e,u))}).catch(u=>{this._onError(e,u)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const s=r.pendingLoadCount;let u=[],f=0;for await(const m of t){if(!this.component)return;const{dataTransform:o}=this.component.props;o?u=o(m,u):u=u.concat(m),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:f,endRow:u.length}]}),f=u.length,this._setAsyncPropValue(e,u,s)}this._onResolve(e,u)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[S3];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class VB extends UB{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,s=r==null?void 0:r.props.fetch;return s?s(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const s=r.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}const jB="layer.changeFlag",$B="layer.initialize",WB="layer.update",HB="layer.finalize",XB="layer.matched",x_=2**24-1,ZB=Object.freeze([]),qB=V2(({oldViewport:n,viewport:e})=>n.equals(e));let Al=new Uint8ClampedArray(0);const GB={data:{type:"data",value:ZB,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:r,loadOptions:s,signal:u})=>{const{resourceManager:f}=t.context;s=s||t.getLoadOptions(),r=r||t.props.loaders,u&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:u}});let m=f.contains(n);return!m&&!s&&(f.add({resourceId:n,data:S7(n,r),persistent:!1}),m=!0),m?f.subscribe({resourceId:n,onChange:o=>{var T;return(T=t.internalState)==null?void 0:T.reloadAsyncProp(e,o)},consumerId:t.id,requestId:e}):S7(n,r,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:mr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Tc extends T6{constructor(){super(...arguments),this.internalState=null,this.lifecycle=z4.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Fs(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=px(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,u,f]=ux(r,t.pixelProjectionMatrix);return e.length===2?[s,u]:[s,u,f]}unproject(e){return Fs(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Fs(this.internalState);const r=this.internalState.viewport||this.context.viewport;return SD(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===mr.DEFAULT||e===mr.LNGLAT||e===mr.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Fs(e instanceof Uint8Array);const[t,r,s]=e;return t+r*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:bB(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=v_(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=v_(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const s of r)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,u=this.internalState.hasPickingBuffer,f=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(m=>m.getNeedsPickingBuffer.call(this,m));if(u!==f){this.internalState.hasPickingBuffer=f;const{pickingColors:m,instancePickingColors:o}=t.attributes,T=m||o;T&&(f&&T.constant&&(T.constant=!1,t.invalidate(T.id)),!T.value&&!f&&(T.constant=!0,T.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){var r,s,u,f;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(s=(r=this.props).onError)!=null&&s.call(r,e)||(f=(u=this.context)==null?void 0:u.onError)==null||f.call(u,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!qB({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const r in e)e[r].layoutChanged()&&(t=!0);for(const r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const u=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const s in t)Object.defineProperty(r,s,{value:t[s]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor(Al.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>x_&&lr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Al=ou.allocate(Al,t,{size:4,copy:!0,maxCount:Math.max(t,x_)});const s=Math.floor(Al.length/4),u=[0,0,0];for(let f=r;f<s;f++)this.encodePickingColor(f,u),Al[f*4+0]=u[0],Al[f*4+1]=u[1],Al[f*4+2]=u[2],Al[f*4+3]=0}e.value=Al.subarray(0,t*4)}_setModelAttributes(e,t,r=!1){var m;if(!Object.keys(t).length)return;if(r){const o=this.getAttributeManager();e.setBufferLayout(o.getBufferLayouts(e)),t=o.getAttributes()}const s=((m=e.userData)==null?void 0:m.excludeAttributes)||{},u={},f={};for(const o in t){if(s[o])continue;const T=t[o].getValue();for(const C in T){const R=T[C];R instanceof Jr?t[o].settings.isIndexed?e.setIndexBuffer(R):u[C]=R:R&&(f[C]=R)}}e.setAttributes(u),e.setConstantAttributes(f)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:s}=this.getAttributeManager().attributes,u=r||s,f=u&&t.attributes&&t.attributes[u.id];if(f&&f.value){const m=f.value,o=this.encodePickingColor(e);for(let T=0;T<t.length;T++){const C=u.getVertexOffset(T);m[C]===o[0]&&m[C+1]===o[1]&&m[C+2]===o[2]&&this._disablePickingIndex(T)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,s=t||r;if(!s)return;const u=s.getVertexOffset(e),f=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(f-u),u)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Al.buffer&&(r.value=Al.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Fs(!this.internalState),Fs(Number.isFinite(this.props.coordinateSystem)),eo($B,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new VB({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(lr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new fB(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){eo(XB,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(eo(WB,this,e),!e)return;const t=this.props,r=this.context,s=this.internalState,u=r.viewport,f=this._updateUniformTransition();s.propsInTransition=f,r.viewport=s.viewport||u,this.props=f;try{const m=this._getUpdateParams(),o=this.getModels();if(r.device)this.updateState(m);else try{this.updateState(m)}catch{}for(const C of this.props.extensions)C.updateState.call(this,m,C);this.setNeedsRedraw(),this._updateAttributes();const T=this.getModels()[0]!==o[0];this._postUpdate(m,T)}finally{r.viewport=u,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){eo(HB,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:r={},parameters:s={}}){this._updateAttributeTransition();const u=this.props,f=this.context;this.props=this.internalState.propsInTransition||u;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:m}=this.props,o=m&&m(r)||[0,0];f.device instanceof X4&&f.device.setParametersWebGL({polygonOffset:o});for(const T of this.getModels())T.device.type==="webgpu"?T.setParameters({...T.parameters,...s}):T.setParameters(s);if(f.device instanceof X4)f.device.withParametersWebGL(s,()=>{const T={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:s,context:f};for(const C of this.props.extensions)C.draw.call(this,T,C);this.draw(T)});else{const T={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:s,context:f};for(const C of this.props.extensions)C.draw.call(this,T,C);this.draw(T)}}finally{this.props=u}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let u=!1;switch(s){case"dataChanged":const f=e[s],m=t[s];f&&Array.isArray(m)&&(t.dataChanged=Array.isArray(f)?m.concat(f):f,u=!0);default:t[s]||(t[s]=e[s],u=!0)}u&&eo(jB,this,s,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var s;const r=pB(e,t);if(r.updateTriggersChanged)for(const u in r.updateTriggersChanged)r.updateTriggersChanged[u]&&this.invalidateAttribute(u);if(r.transitionsChanged)for(const u in r.transitionsChanged)this.internalState.uniformTransitions.add(u,t[u],e[u],(s=e.transitions)==null?void 0:s[u]);return this.setChangeFlags(r)}validateProps(){dB(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new aB(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:s}=e,u=this.state.model;u!=null&&u.isInstanced&&u.setInstanceCount(this.getNumInstances());const{autoHighlight:f,highlightedObjectIndex:m,highlightColor:o}=r;if(t||s.autoHighlight!==f||s.highlightedObjectIndex!==m||s.highlightColor!==o){const T={};Array.isArray(o)&&(T.highlightColor=o),(t||s.autoHighlight!==f||m!==s.highlightedObjectIndex)&&(T.highlightedObjectColor=Number.isFinite(m)&&m>=0?this.encodePickingColor(m):null),this.setShaderModuleProps({picking:T})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),s=r?r.getNeedsRedraw(e):!1;if(t=t||s,t)for(const u of this.props.extensions)u.onNeedsRedraw.call(this,u);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Tc.defaultProps=GB;Tc.layerName="Layer";const YB="compositeLayer.renderLayers";class Mf extends Tc{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,s)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,s)}return e}getSubLayerProps(e={}){var yt;const{opacity:t,pickable:r,visible:s,parameters:u,getPolygonOffset:f,highlightedObjectIndex:m,autoHighlight:o,highlightColor:T,coordinateSystem:C,coordinateOrigin:R,wrapLongitude:O,positionFormat:U,modelMatrix:V,extensions:Y,fetch:ee,operation:le,_subLayerProps:Ee}=this.props,ue={id:"",updateTriggers:{},opacity:t,pickable:r,visible:s,parameters:u,getPolygonOffset:f,highlightedObjectIndex:m,autoHighlight:o,highlightColor:T,coordinateSystem:C,coordinateOrigin:R,wrapLongitude:O,positionFormat:U,modelMatrix:V,extensions:Y,fetch:ee,operation:le},_e=Ee&&e.id&&Ee[e.id],Me=_e&&_e.updateTriggers,Fe=e.id||"sublayer";if(_e){const xt=this.props[S3],ht=e.type?e.type._propTypes:{};for(const kt in _e){const Bt=ht[kt]||xt[kt];Bt&&Bt.type==="accessor"&&(_e[kt]=this.getSubLayerAccessor(_e[kt]))}}Object.assign(ue,e,_e),ue.id=`${this.props.id}-${Fe}`,ue.updateTriggers={all:(yt=this.props.updateTriggers)==null?void 0:yt.all,...e.updateTriggers,...Me};for(const xt of Y){const ht=xt.getSubLayerProps.call(this,xt);ht&&Object.assign(ue,ht,{updateTriggers:Object.assign(ue.updateTriggers,ht.updateTriggers)})}return ue}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const s=!r||this.needsUpdate();if(s){const u=this.renderLayers();r=bf(u,Boolean),this.internalState.subLayers=r}eo(YB,this,s,r);for(const u of r)u.parent=this}}Mf.layerName="CompositeLayer";class Kx{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=ou,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:r={},getGeometry:s,geometryBuffer:u,positionFormat:f,dataChanged:m,normalize:o=!0}=this.opts;if(this.data=t,this.getGeometry=s,this.positionSize=u&&u.size||(f==="XY"?2:3),this.buffers=r,this.normalize=o,u&&(Fs(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(u),o||(r.vertexPositions=u)),this.geometryBuffer=r.vertexPositions,Array.isArray(m))for(const T of m)this._rebuildGeometry(T);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?zx(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:r,buffers:s,_attributeDefs:u,typedArrayManager:f}=this;for(const m in u)if(m in s)f.release(r[m]),r[m]=null;else{const o=u[m];o.copy=t,r[m]=f.allocate(r[m],e,o)}}_forEachGeometry(e,t,r){const{data:s,getGeometry:u}=this,{iterable:f,objectInfo:m}=w6(s,t,r);for(const o of f){m.index++;const T=u?u(o,m):null;e(T,m.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:r,instanceCount:s}=this;const{data:u,geometryBuffer:f}=this,{startRow:m=0,endRow:o=1/0}=e||{},T={};if(e||(t=[0],r=[0]),this.normalize||!f)this._forEachGeometry((R,O)=>{const U=R&&this.normalizeGeometry(R);T[O]=U,r[O+1]=r[O]+(U?this.getGeometrySize(U):0)},m,o),s=r[r.length-1];else if(r=u.startIndices,s=r[u.length]||0,ArrayBuffer.isView(f))s=s||f.length/this.positionSize;else if(f instanceof Jr){const R=this.positionSize*4;s=s||f.byteLength/R}else if(f.buffer){const R=f.stride||this.positionSize*4;s=s||f.buffer.byteLength/R}else if(f.value){const R=f.value,O=f.stride/R.BYTES_PER_ELEMENT||this.positionSize;s=s||R.length/O}this._allocate(s,!!e),this.indexStarts=t,this.vertexStarts=r,this.instanceCount=s;const C={};this._forEachGeometry((R,O)=>{const U=T[O]||R;C.vertexStart=r[O],C.indexStart=t[O];const V=O<r.length-1?r[O+1]:s;C.geometrySize=V-r[O],C.geometryIndex=O,this.updateGeometryAttributes(U,C)},m,o),this.vertexCount=t[t.length-1]}}const KB=typeof window<"u"?lt.useLayoutEffect:lt.useEffect;function G7(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const JB={position:"absolute",zIndex:-1};function Jx(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>Jx(t,e));if(E6(n)){if(QB(n))return e.style=JB,lt.cloneElement(n,e);if(ez(n))return lt.cloneElement(n,e)}return n}function E6(n){return n&&typeof n=="object"&&"type"in n||!1}function QB(n){var e;return(e=n.props)==null?void 0:e.mapStyle}function ez(n){const e=n.type;return e&&e.deckGLViewProps}function Ih(n){if(typeof n=="function")return lt.createElement(cu,{},n);if(Array.isArray(n))return n.map(Ih);if(E6(n)){if(n.type===lt.Fragment)return Ih(n.props.children);if(G7(n.type,cu))return n}return n}function tz({children:n,layers:e=[],views:t=null}){const r=[],s=[],u={};return lt.Children.forEach(Ih(n),f=>{if(E6(f)){const m=f.type;if(G7(m,Tc)){const o=nz(m,f.props);s.push(o)}else r.push(f);if(G7(m,cu)&&m!==cu&&f.props.id){const o=new m(f.props);u[o.id]=o}}else f&&r.push(f)}),Object.keys(u).length>0&&(Array.isArray(t)?t.forEach(f=>{u[f.id]=f}):t&&(u[t.id]=t),t=Object.values(u)),e=s.length>0?[...s,...e]:e,{layers:e,children:r,views:t}}function nz(n,e){const t={},r=n.defaultProps||{};for(const s in e)r[s]!==e[s]&&(t[s]=e[s]);return new n(t)}const rz=lt.createContext();function iz({children:n,deck:e,ContextProvider:t=rz.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const s={},u=r.views[0].id;for(const f of n){let m=u,o=f;E6(f)&&G7(f.type,cu)&&(m=f.props.id||u,o=f.props.children);const T=r.getViewport(m),C=r.getViewState(m);if(T){C.padding=T.padding;const{x:R,y:O,width:U,height:V}=T;o=Jx(o,{x:R,y:O,width:U,height:V,viewport:T,viewState:C}),s[m]||(s[m]={viewport:T,children:[]}),s[m].children.push(o)}}return Object.keys(s).map(f=>{const{viewport:m,children:o}=s[f],{x:T,y:C,width:R,height:O}=m,U={position:"absolute",left:T,top:C,width:R,height:O},V=`view-${f}`,Y=lt.createElement("div",{key:V,id:V,style:U},...o),ee={deck:e,viewport:m,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:Ee=>{Ee.viewId=f,e._onViewStateChange(Ee)},widgets:[]},le=`view-${f}-context`;return lt.createElement(t,{key:le,value:ee},Y)})}const sz={mixBlendMode:null};function oz({width:n,height:e,style:t}){const r={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},s={left:0,top:0};if(t)for(const u in t)u in sz?s[u]=t[u]:r[u]=t[u];return{containerStyle:r,canvasStyle:s}}function az(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function Qx(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function lz(n,e,t){var s,u,f;const r=new e({...t,_customRender:((f=(u=(s=t.deviceProps)==null?void 0:s.adapters)==null?void 0:u[0])==null?void 0:f.type)==="webgpu"?void 0:m=>{n.redrawReason=m;const o=r.getViewports();n.lastRenderedViewports!==o?n.forceUpdate():Qx(n)}});return r}function cz(n,e){const[t,r]=lt.useState(0),u=lt.useRef({control:null,version:t,forceUpdate:()=>r(Me=>Me+1)}).current,f=lt.useRef(null),m=lt.useRef(null),o=lt.useMemo(()=>tz(n),[n.layers,n.views,n.children]);let T=!0;const C=Me=>{var Fe;return T&&n.viewState?(u.viewStateUpdateRequested=Me,null):(u.viewStateUpdateRequested=null,(Fe=n.onViewStateChange)==null?void 0:Fe.call(n,Me))},R=Me=>{var Fe;T?u.interactionStateUpdateRequested=Me:(u.interactionStateUpdateRequested=null,(Fe=n.onInteractionStateChange)==null||Fe.call(n,Me))},O=lt.useMemo(()=>{const Me={widgets:[],...n,style:null,width:"100%",height:"100%",parent:f.current,canvas:m.current,layers:o.layers,views:o.views,onViewStateChange:C,onInteractionStateChange:R};return delete Me._customRender,u.deck&&u.deck.setProps(Me),Me},[n]);lt.useEffect(()=>{const Me=n.Deck||Pf;return u.deck=lz(u,Me,{...O,parent:f.current,canvas:m.current}),()=>{var Fe;return(Fe=u.deck)==null?void 0:Fe.finalize()}},[]),KB(()=>{Qx(u);const{viewStateUpdateRequested:Me,interactionStateUpdateRequested:Fe}=u;Me&&C(Me),Fe&&R(Fe)}),lt.useImperativeHandle(e,()=>az(u),[]);const U=u.deck&&u.deck.isInitialized?u.deck.getViewports():void 0,{ContextProvider:V,width:Y="100%",height:ee="100%",id:le,style:Ee}=n,{containerStyle:ue,canvasStyle:_e}=lt.useMemo(()=>oz({width:Y,height:ee,style:Ee}),[Y,ee,Ee]);if(!u.viewStateUpdateRequested&&u.lastRenderedViewports===U||u.version!==t){u.lastRenderedViewports=U,u.version=t;const Me=iz({children:o.children,deck:u.deck,ContextProvider:V}),Fe=lt.createElement("canvas",{key:"canvas",id:le||"deckgl-overlay",ref:m,style:_e});u.control=lt.createElement("div",{id:`${le||"deckgl"}-wrapper`,ref:f,style:ue},[Fe,Me])}return T=!1,u.control}const uz=lt.forwardRef(cz),b_=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,hz={name:"icon",vs:b_,fs:b_,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},fz=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,dz=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,pz=1024,mz=4,w_=()=>{},T_={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},gz={x:0,y:0,width:0,height:0};function _z(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function yz(n,e,t,r){const s=Math.min(t/e.width,r/e.height),u=Math.floor(e.width*s),f=Math.floor(e.height*s);return s===1?{image:e,width:u,height:f}:(n.canvas.height=f,n.canvas.width=u,n.clearRect(0,0,u,f),n.drawImage(e,0,0,e.width,e.height,0,0,u,f),{image:n.canvas,width:u,height:f})}function O2(n){return n&&(n.id||n.url)}function vz(n,e,t,r){const{width:s,height:u,device:f}=n,m=f.createTexture({format:"rgba8unorm",width:e,height:t,sampler:r,mipmaps:!0}),o=f.createCommandEncoder();return o.copyTextureToTexture({sourceTexture:n,destinationTexture:m,width:s,height:u}),o.finish(),n.destroy(),m}function E_(n,e,t){for(let r=0;r<e.length;r++){const{icon:s,xOffset:u}=e[r],f=O2(s);n[f]={...s,x:u,y:t}}}function xz({icons:n,buffer:e,mapping:t={},xOffset:r=0,yOffset:s=0,rowHeight:u=0,canvasWidth:f}){let m=[];for(let o=0;o<n.length;o++){const T=n[o],C=O2(T);if(!t[C]){const{height:R,width:O}=T;r+O+e>f&&(E_(t,m,s),r=0,s=u+s+e,u=0,m=[]),m.push({icon:T,xOffset:r}),r=r+O+e,u=Math.max(u,R)}}return m.length>0&&E_(t,m,s),{mapping:t,rowHeight:u,xOffset:r,yOffset:s,canvasWidth:f,canvasHeight:_z(u+s+e)}}function bz(n,e,t){if(!n||!e)return null;t=t||{};const r={},{iterable:s,objectInfo:u}=w6(n);for(const f of s){u.index++;const m=e(f,u),o=O2(m);if(!m)throw new Error("Icon is missing.");if(!m.url)throw new Error("Icon url is missing.");!r[o]&&(!t[o]||m.url!==t[o].url)&&(r[o]={...m,source:f,sourceIndex:u.index})}return r}class wz{constructor(e,{onUpdate:t=w_,onError:r=w_}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=mz,this._canvasWidth=pz,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=r}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?O2(e):e;return this._mapping[t]||gz}setProps({loadOptions:e,autoPacking:t,iconAtlas:r,iconMapping:s,textureParameters:u}){var f;e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),s&&(this._mapping=s),r&&((f=this._texture)==null||f.delete(),this._texture=null,this._externalTexture=r),u&&(this._samplerParameters=u)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(bz(e,t,this._mapping)||{});if(r.length>0){const{mapping:s,xOffset:u,yOffset:f,rowHeight:m,canvasHeight:o}=xz({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=m,this._mapping=s,this._xOffset=u,this._yOffset=f,this._canvasHeight=o,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||T_,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=vz(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||T_)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,S7(r.url,this._loadOptions).then(s=>{var V;const u=O2(r),f=this._mapping[u],{x:m,y:o,width:T,height:C}=f,{image:R,width:O,height:U}=yz(t,s,T,C);(V=this._texture)==null||V.copyExternalImage({image:R,x:m+(T-O)/2,y:o+(C-U)/2,width:O,height:U}),f.width=O,f.height=U,this._texture.generateMipmap(),this.onUpdate()}).catch(s=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const eb=[0,0,0,255],Tz={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:eb},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class S6 extends Tc{getShaders(){return super.getShaders({vs:fz,fs:dz,modules:[j2,$2,hz]})}initializeState(){this.state={iconManager:new wz(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:eb},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var U;super.updateState(e);const{props:t,oldProps:r,changeFlags:s}=e,u=this.getAttributeManager(),{iconAtlas:f,iconMapping:m,data:o,getIcon:T,textureParameters:C}=t,{iconManager:R}=this.state;if(typeof f=="string")return;const O=f||this.internalState.isAsyncPropLoading("iconAtlas");R.setProps({loadOptions:t.loadOptions,autoPacking:!O,iconAtlas:f,iconMapping:O?m:null,textureParameters:C}),O?r.iconMapping!==t.iconMapping&&u.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&R.packIcons(o,T),s.extensionsChanged&&((U=this.state.model)==null||U.destroy(),this.state.model=this._getModel(),u.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:r,sizeMaxPixels:s,sizeUnits:u,billboard:f,alphaCutoff:m}=this.props,{iconManager:o}=this.state,T=o.getTexture();if(T){const C=this.state.model,R={iconsTexture:T,iconsTextureDim:[T.width,T.height],sizeUnits:xc[u],sizeScale:t,sizeMinPixels:r,sizeMaxPixels:s,billboard:f,alphaCutoff:m};C.shaderInputs.setProps({icon:R}),C.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Ll(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new lu({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var r;const t=(r=this.getCurrentLayer())==null?void 0:r.props.onIconError;t?t(e):lr.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:r,anchorX:s=t/2,anchorY:u=r/2}=this.state.iconManager.getIconMapping(e);return[t/2-s,r/2-u]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:r,width:s,height:u}=this.state.iconManager.getIconMapping(e);return[t,r,s,u]}}S6.defaultProps=Tz;S6.layerName="IconLayer";const S_=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Ez={name:"scatterplot",vs:S_,fs:S_,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Sz=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Az=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Cz=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,A_=[0,0,0,255],Pz={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:A_},getLineColor:{type:"accessor",value:A_},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Rf extends Tc{getShaders(){return super.getShaders({vs:Sz,fs:Az,source:Cz,modules:[j2,$2,Ez]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:r,radiusMinPixels:s,radiusMaxPixels:u,stroked:f,filled:m,billboard:o,antialiasing:T,lineWidthUnits:C,lineWidthScale:R,lineWidthMinPixels:O,lineWidthMaxPixels:U}=this.props,V={stroked:f,filled:m,billboard:o,antialiasing:T,radiusUnits:xc[t],radiusScale:r,radiusMinPixels:s,radiusMaxPixels:u,lineWidthUnits:xc[C],lineWidthScale:R,lineWidthMinPixels:O,lineWidthMaxPixels:U},Y=this.state.model;Y.shaderInputs.setProps({scatterplot:V}),Y.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Ll(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new lu({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Rf.defaultProps=Pz;Rf.layerName="ScatterplotLayer";const tb={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function nb(n,e,t={}){return Iz(n,t)!==e?(Rz(n,t),!0):!1}function Iz(n,e={}){return Math.sign(Mz(n,e))}const C_={x:0,y:1,z:2};function Mz(n,e={}){const{start:t=0,end:r=n.length,plane:s="xy"}=e,u=e.size||2;let f=0;const m=C_[s[0]],o=C_[s[1]];for(let T=t,C=r-u;T<r;T+=u)f+=(n[T+m]-n[C+m])*(n[T+o]+n[C+o]),C=T;return f/2}function Rz(n,e){const{start:t=0,end:r=n.length,size:s=2}=e,u=(r-t)/s,f=Math.floor(u/2);for(let m=0;m<f;++m){const o=t+m*s,T=t+(u-1-m)*s;for(let C=0;C<s;++C){const R=n[o+C];n[o+C]=n[T+C],n[T+C]=R}}}function Dl(n,e){const t=e.length,r=n.length;if(r>0){let s=!0;for(let u=0;u<t;u++)if(n[r-t+u]!==e[u]){s=!1;break}if(s)return!1}for(let s=0;s<t;s++)n[r+s]=e[s];return!0}function Mh(n,e){const t=e.length;for(let r=0;r<t;r++)n[r]=e[r]}function D2(n,e,t,r,s=[]){const u=r+e*t;for(let f=0;f<t;f++)s[f]=n[u+f];return s}function Rh(n,e,t,r,s=[]){let u,f;if(t&8)u=(r[3]-n[1])/(e[1]-n[1]),f=3;else if(t&4)u=(r[1]-n[1])/(e[1]-n[1]),f=1;else if(t&2)u=(r[2]-n[0])/(e[0]-n[0]),f=2;else if(t&1)u=(r[0]-n[0])/(e[0]-n[0]),f=0;else return null;for(let m=0;m<n.length;m++)s[m]=(f&1)===m?r[f]:u*(e[m]-n[m])+n[m];return s}function u7(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function rb(n,e){const{size:t=2,broken:r=!1,gridResolution:s=10,gridOffset:u=[0,0],startIndex:f=0,endIndex:m=n.length}=e||{},o=(m-f)/t;let T=[];const C=[T],R=D2(n,0,t,f);let O,U;const V=sb(R,s,u,[]),Y=[];Dl(T,R);for(let ee=1;ee<o;ee++){for(O=D2(n,ee,t,f,O),U=u7(O,V);U;){Rh(R,O,U,V,Y);const le=u7(Y,V);le&&(Rh(R,Y,le,V,Y),U=le),Dl(T,Y),Mh(R,Y),Oz(V,s,U),r&&T.length>t&&(T=[],C.push(T),Dl(T,R)),U=u7(O,V)}Dl(T,O),Mh(R,O)}return r?C:C[0]}const P_=0,kz=1;function ib(n,e=null,t){if(!n.length)return[];const{size:r=2,gridResolution:s=10,gridOffset:u=[0,0],edgeTypes:f=!1}=t||{},m=[],o=[{pos:n,types:f?new Array(n.length/r).fill(kz):null,holes:e||[]}],T=[[],[]];let C=[];for(;o.length;){const{pos:R,types:O,holes:U}=o.shift();Dz(R,r,U[0]||R.length,T),C=sb(T[0],s,u,C);const V=u7(T[1],C);if(V){let Y=I_(R,O,r,0,U[0]||R.length,C,V);const ee={pos:Y[0].pos,types:Y[0].types,holes:[]},le={pos:Y[1].pos,types:Y[1].types,holes:[]};o.push(ee,le);for(let Ee=0;Ee<U.length;Ee++)Y=I_(R,O,r,U[Ee],U[Ee+1]||R.length,C,V),Y[0]&&(ee.holes.push(ee.pos.length),ee.pos=q8(ee.pos,Y[0].pos),f&&(ee.types=q8(ee.types,Y[0].types))),Y[1]&&(le.holes.push(le.pos.length),le.pos=q8(le.pos,Y[1].pos),f&&(le.types=q8(le.types,Y[1].types)))}else{const Y={positions:R};f&&(Y.edgeTypes=O),U.length&&(Y.holeIndices=U),m.push(Y)}}return m}function I_(n,e,t,r,s,u,f){const m=(s-r)/t,o=[],T=[],C=[],R=[],O=[];let U,V,Y;const ee=D2(n,m-1,t,r);let le=Math.sign(f&8?ee[1]-u[3]:ee[0]-u[2]),Ee=e&&e[m-1],ue=0,_e=0;for(let Me=0;Me<m;Me++)U=D2(n,Me,t,r,U),V=Math.sign(f&8?U[1]-u[3]:U[0]-u[2]),Y=e&&e[r/t+Me],V&&le&&le!==V&&(Rh(ee,U,f,u,O),Dl(o,O)&&C.push(Ee),Dl(T,O)&&R.push(Ee)),V<=0?(Dl(o,U)&&C.push(Y),ue-=V):C.length&&(C[C.length-1]=P_),V>=0?(Dl(T,U)&&R.push(Y),_e+=V):R.length&&(R[R.length-1]=P_),Mh(ee,U),le=V,Ee=Y;return[ue?{pos:o,types:e&&C}:null,_e?{pos:T,types:e&&R}:null]}function sb(n,e,t,r){const s=Math.floor((n[0]-t[0])/e)*e+t[0],u=Math.floor((n[1]-t[1])/e)*e+t[1];return r[0]=s,r[1]=u,r[2]=s+e,r[3]=u+e,r}function Oz(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function Dz(n,e,t,r){let s=1/0,u=-1/0,f=1/0,m=-1/0;for(let o=0;o<t;o+=e){const T=n[o],C=n[o+1];s=T<s?T:s,u=T>u?T:u,f=C<f?C:f,m=C>m?C:m}return r[0][0]=s,r[0][1]=f,r[1][0]=u,r[1][1]=m,r}function q8(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}const Lz=85.051129;function Fz(n,e){const{size:t=2,startIndex:r=0,endIndex:s=n.length,normalize:u=!0}=e,f=n.slice(r,s);ob(f,t,0,s-r);const m=rb(f,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(u)for(const o of m)ab(o,t);return m}function Nz(n,e=null,t){const{size:r=2,normalize:s=!0,edgeTypes:u=!1}=t;e=e||[];const f=[],m=[];let o=0,T=0;for(let R=0;R<=e.length;R++){const O=e[R]||n.length,U=T,V=Bz(n,r,o,O);for(let Y=V;Y<O;Y++)f[T++]=n[Y];for(let Y=o;Y<V;Y++)f[T++]=n[Y];ob(f,r,U,T),zz(f,r,U,T,t==null?void 0:t.maxLatitude),o=O,m[R]=T}m.pop();const C=ib(f,m,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:u});if(s)for(const R of C)ab(R.positions,r);return C}function Bz(n,e,t,r){let s=-1,u=-1;for(let f=t+1;f<r;f+=e){const m=Math.abs(n[f]);m>s&&(s=m,u=f-1)}return u}function zz(n,e,t,r,s=Lz){const u=n[t],f=n[r-e];if(Math.abs(u-f)>180){const m=D2(n,0,e,t);m[0]+=Math.round((f-u)/360)*360,Dl(n,m),m[1]=Math.sign(m[1])*s,Dl(n,m),m[0]=u,Dl(n,m)}}function ob(n,e,t,r){let s=n[0],u;for(let f=t;f<r;f+=e){u=n[f];const m=u-s;(m>180||m<-180)&&(u-=Math.round(m/360)*360),n[f]=s=u}}function ab(n,e){let t;const r=n.length/e;for(let u=0;u<r&&(t=n[u*e],(t+180)%360===0);u++);const s=-Math.round(t/360)*360;if(s!==0)for(let u=0;u<r;u++)n[u*e]+=s}function Uz(n,e,t,r){let s;if(Array.isArray(n[0])){const u=n.length*e;s=new Array(u);for(let f=0;f<n.length;f++)for(let m=0;m<e;m++)s[f*e+m]=n[f][m]||0}else s=n;return t?rb(s,{size:e,gridResolution:t}):r?Fz(s,{size:e}):s}const Vz=1,jz=2,g9=4;class $z extends Kx{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?Uz(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(M_(e)){let r=0;for(const s of e)r+=this.getGeometrySize(s);return r}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&M_(e))for(const r of e){const s=this.getGeometrySize(r);t.geometrySize=s,this.updateGeometryAttributes(r,t),t.vertexStart+=s}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const r=this.attributes.segmentTypes,s=e?this.isClosed(e):!1,{vertexStart:u,geometrySize:f}=t;r.fill(0,u,u+f),s?(r[u]=g9,r[u+f-2]=g9):(r[u]+=Vz,r[u+f-2]+=jz),r[u+f-1]=g9}_updatePositions(e,t){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:s,geometrySize:u}=t,f=new Array(3);for(let m=s,o=0;o<u;m++,o++)this.getPointOnPath(e,o,f),r[m*3]=f[0],r[m*3+1]=f[1],r[m*3+2]=f[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,r=[]){const{positionSize:s}=this;t*s>=e.length&&(t+=1-e.length/s);const u=t*s;return r[0]=e[u],r[1]=e[u+1],r[2]=s===3&&e[u+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,r=e.length-t;return e[0]===e[r]&&e[1]===e[r+1]&&(t===2||e[2]===e[r+2])}}function M_(n){return Array.isArray(n[0])}const R_=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,Wz={name:"path",vs:R_,fs:R_,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},Hz=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Xz=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,lb=[0,0,0,255],Zz={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:lb},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},_9={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class kf extends Tc{getShaders(){return super.getShaders({vs:Hz,fs:Xz,modules:[j2,$2,Wz]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:_9,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:_9,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:_9,defaultValue:lb},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:s,target:u})=>this.encodePickingColor(r&&r.__source?r.__source.index:s,u)}}),this.setState({pathTesselator:new $z({fp64:this.use64bitPositions()})})}updateState(e){var f;super.updateState(e);const{props:t,changeFlags:r}=e,s=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:m}=this.state,o=t.data.attributes||{};m.updateGeometry({data:t.data,geometryBuffer:o.getPath,buffers:o,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:m.instanceCount,startIndices:m.vertexStarts}),r.dataChanged||s.invalidateAll()}r.extensionsChanged&&((f=this.state.model)==null||f.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(u=>u.__source.index===r)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:r,billboard:s,miterLimit:u,widthUnits:f,widthScale:m,widthMinPixels:o,widthMaxPixels:T}=this.props,C=this.state.model,R={jointType:Number(t),capType:Number(r),billboard:s,widthUnits:xc[f],widthScale:m,miterLimit:u,widthMinPixels:o,widthMaxPixels:T};C.shaderInputs.setProps({path:R}),C.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Ll(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new lu({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}kf.defaultProps=Zz;kf.layerName="PathLayer";var G8={exports:{}},k_;function qz(){if(k_)return G8.exports;k_=1,G8.exports=n,G8.exports.default=n;function n(Oe,ce,ve){ve=ve||2;var rt=ce&&ce.length,at=rt?ce[0]*ve:Oe.length,Ne=e(Oe,0,at,ve,!0),Be=[];if(!Ne||Ne.next===Ne.prev)return Be;var ot,Ft,Dt,vn,un,fn,yn;if(rt&&(Ne=o(Oe,ce,Ne,ve)),Oe.length>80*ve){ot=Dt=Oe[0],Ft=vn=Oe[1];for(var Tn=ve;Tn<at;Tn+=ve)un=Oe[Tn],fn=Oe[Tn+1],un<ot&&(ot=un),fn<Ft&&(Ft=fn),un>Dt&&(Dt=un),fn>vn&&(vn=fn);yn=Math.max(Dt-ot,vn-Ft),yn=yn!==0?32767/yn:0}return r(Ne,Be,ve,ot,Ft,yn,0),Be}function e(Oe,ce,ve,rt,at){var Ne,Be;if(at===xn(Oe,ce,ve,rt)>0)for(Ne=ce;Ne<ve;Ne+=rt)Be=Vt(Ne,Oe[Ne],Oe[Ne+1],Be);else for(Ne=ve-rt;Ne>=ce;Ne-=rt)Be=Vt(Ne,Oe[Ne],Oe[Ne+1],Be);return Be&&_e(Be,Be.next)&&($t(Be),Be=Be.next),Be}function t(Oe,ce){if(!Oe)return Oe;ce||(ce=Oe);var ve=Oe,rt;do if(rt=!1,!ve.steiner&&(_e(ve,ve.next)||ue(ve.prev,ve,ve.next)===0)){if($t(ve),ve=ce=ve.prev,ve===ve.next)break;rt=!0}else ve=ve.next;while(rt||ve!==ce);return ce}function r(Oe,ce,ve,rt,at,Ne,Be){if(Oe){!Be&&Ne&&U(Oe,rt,at,Ne);for(var ot=Oe,Ft,Dt;Oe.prev!==Oe.next;){if(Ft=Oe.prev,Dt=Oe.next,Ne?u(Oe,rt,at,Ne):s(Oe)){ce.push(Ft.i/ve|0),ce.push(Oe.i/ve|0),ce.push(Dt.i/ve|0),$t(Oe),Oe=Dt.next,ot=Dt.next;continue}if(Oe=Dt,Oe===ot){Be?Be===1?(Oe=f(t(Oe),ce,ve),r(Oe,ce,ve,rt,at,Ne,2)):Be===2&&m(Oe,ce,ve,rt,at,Ne):r(t(Oe),ce,ve,rt,at,Ne,1);break}}}}function s(Oe){var ce=Oe.prev,ve=Oe,rt=Oe.next;if(ue(ce,ve,rt)>=0)return!1;for(var at=ce.x,Ne=ve.x,Be=rt.x,ot=ce.y,Ft=ve.y,Dt=rt.y,vn=at<Ne?at<Be?at:Be:Ne<Be?Ne:Be,un=ot<Ft?ot<Dt?ot:Dt:Ft<Dt?Ft:Dt,fn=at>Ne?at>Be?at:Be:Ne>Be?Ne:Be,yn=ot>Ft?ot>Dt?ot:Dt:Ft>Dt?Ft:Dt,Tn=rt.next;Tn!==ce;){if(Tn.x>=vn&&Tn.x<=fn&&Tn.y>=un&&Tn.y<=yn&&le(at,ot,Ne,Ft,Be,Dt,Tn.x,Tn.y)&&ue(Tn.prev,Tn,Tn.next)>=0)return!1;Tn=Tn.next}return!0}function u(Oe,ce,ve,rt){var at=Oe.prev,Ne=Oe,Be=Oe.next;if(ue(at,Ne,Be)>=0)return!1;for(var ot=at.x,Ft=Ne.x,Dt=Be.x,vn=at.y,un=Ne.y,fn=Be.y,yn=ot<Ft?ot<Dt?ot:Dt:Ft<Dt?Ft:Dt,Tn=vn<un?vn<fn?vn:fn:un<fn?un:fn,Qr=ot>Ft?ot>Dt?ot:Dt:Ft>Dt?Ft:Dt,Or=vn>un?vn>fn?vn:fn:un>fn?un:fn,as=Y(yn,Tn,ce,ve,rt),Xi=Y(Qr,Or,ce,ve,rt),Ht=Oe.prevZ,pn=Oe.nextZ;Ht&&Ht.z>=as&&pn&&pn.z<=Xi;){if(Ht.x>=yn&&Ht.x<=Qr&&Ht.y>=Tn&&Ht.y<=Or&&Ht!==at&&Ht!==Be&&le(ot,vn,Ft,un,Dt,fn,Ht.x,Ht.y)&&ue(Ht.prev,Ht,Ht.next)>=0||(Ht=Ht.prevZ,pn.x>=yn&&pn.x<=Qr&&pn.y>=Tn&&pn.y<=Or&&pn!==at&&pn!==Be&&le(ot,vn,Ft,un,Dt,fn,pn.x,pn.y)&&ue(pn.prev,pn,pn.next)>=0))return!1;pn=pn.nextZ}for(;Ht&&Ht.z>=as;){if(Ht.x>=yn&&Ht.x<=Qr&&Ht.y>=Tn&&Ht.y<=Or&&Ht!==at&&Ht!==Be&&le(ot,vn,Ft,un,Dt,fn,Ht.x,Ht.y)&&ue(Ht.prev,Ht,Ht.next)>=0)return!1;Ht=Ht.prevZ}for(;pn&&pn.z<=Xi;){if(pn.x>=yn&&pn.x<=Qr&&pn.y>=Tn&&pn.y<=Or&&pn!==at&&pn!==Be&&le(ot,vn,Ft,un,Dt,fn,pn.x,pn.y)&&ue(pn.prev,pn,pn.next)>=0)return!1;pn=pn.nextZ}return!0}function f(Oe,ce,ve){var rt=Oe;do{var at=rt.prev,Ne=rt.next.next;!_e(at,Ne)&&Me(at,rt,rt.next,Ne)&&ht(at,Ne)&&ht(Ne,at)&&(ce.push(at.i/ve|0),ce.push(rt.i/ve|0),ce.push(Ne.i/ve|0),$t(rt),$t(rt.next),rt=Oe=Ne),rt=rt.next}while(rt!==Oe);return t(rt)}function m(Oe,ce,ve,rt,at,Ne){var Be=Oe;do{for(var ot=Be.next.next;ot!==Be.prev;){if(Be.i!==ot.i&&Ee(Be,ot)){var Ft=Bt(Be,ot);Be=t(Be,Be.next),Ft=t(Ft,Ft.next),r(Be,ce,ve,rt,at,Ne,0),r(Ft,ce,ve,rt,at,Ne,0);return}ot=ot.next}Be=Be.next}while(Be!==Oe)}function o(Oe,ce,ve,rt){var at=[],Ne,Be,ot,Ft,Dt;for(Ne=0,Be=ce.length;Ne<Be;Ne++)ot=ce[Ne]*rt,Ft=Ne<Be-1?ce[Ne+1]*rt:Oe.length,Dt=e(Oe,ot,Ft,rt,!1),Dt===Dt.next&&(Dt.steiner=!0),at.push(ee(Dt));for(at.sort(T),Ne=0;Ne<at.length;Ne++)ve=C(at[Ne],ve);return ve}function T(Oe,ce){return Oe.x-ce.x}function C(Oe,ce){var ve=R(Oe,ce);if(!ve)return ce;var rt=Bt(ve,Oe);return t(rt,rt.next),t(ve,ve.next)}function R(Oe,ce){var ve=ce,rt=Oe.x,at=Oe.y,Ne=-1/0,Be;do{if(at<=ve.y&&at>=ve.next.y&&ve.next.y!==ve.y){var ot=ve.x+(at-ve.y)*(ve.next.x-ve.x)/(ve.next.y-ve.y);if(ot<=rt&&ot>Ne&&(Ne=ot,Be=ve.x<ve.next.x?ve:ve.next,ot===rt))return Be}ve=ve.next}while(ve!==ce);if(!Be)return null;var Ft=Be,Dt=Be.x,vn=Be.y,un=1/0,fn;ve=Be;do rt>=ve.x&&ve.x>=Dt&&rt!==ve.x&&le(at<vn?rt:Ne,at,Dt,vn,at<vn?Ne:rt,at,ve.x,ve.y)&&(fn=Math.abs(at-ve.y)/(rt-ve.x),ht(ve,Oe)&&(fn<un||fn===un&&(ve.x>Be.x||ve.x===Be.x&&O(Be,ve)))&&(Be=ve,un=fn)),ve=ve.next;while(ve!==Ft);return Be}function O(Oe,ce){return ue(Oe.prev,Oe,ce.prev)<0&&ue(ce.next,Oe,Oe.next)<0}function U(Oe,ce,ve,rt){var at=Oe;do at.z===0&&(at.z=Y(at.x,at.y,ce,ve,rt)),at.prevZ=at.prev,at.nextZ=at.next,at=at.next;while(at!==Oe);at.prevZ.nextZ=null,at.prevZ=null,V(at)}function V(Oe){var ce,ve,rt,at,Ne,Be,ot,Ft,Dt=1;do{for(ve=Oe,Oe=null,Ne=null,Be=0;ve;){for(Be++,rt=ve,ot=0,ce=0;ce<Dt&&(ot++,rt=rt.nextZ,!!rt);ce++);for(Ft=Dt;ot>0||Ft>0&&rt;)ot!==0&&(Ft===0||!rt||ve.z<=rt.z)?(at=ve,ve=ve.nextZ,ot--):(at=rt,rt=rt.nextZ,Ft--),Ne?Ne.nextZ=at:Oe=at,at.prevZ=Ne,Ne=at;ve=rt}Ne.nextZ=null,Dt*=2}while(Be>1);return Oe}function Y(Oe,ce,ve,rt,at){return Oe=(Oe-ve)*at|0,ce=(ce-rt)*at|0,Oe=(Oe|Oe<<8)&16711935,Oe=(Oe|Oe<<4)&252645135,Oe=(Oe|Oe<<2)&858993459,Oe=(Oe|Oe<<1)&1431655765,ce=(ce|ce<<8)&16711935,ce=(ce|ce<<4)&252645135,ce=(ce|ce<<2)&858993459,ce=(ce|ce<<1)&1431655765,Oe|ce<<1}function ee(Oe){var ce=Oe,ve=Oe;do(ce.x<ve.x||ce.x===ve.x&&ce.y<ve.y)&&(ve=ce),ce=ce.next;while(ce!==Oe);return ve}function le(Oe,ce,ve,rt,at,Ne,Be,ot){return(at-Be)*(ce-ot)>=(Oe-Be)*(Ne-ot)&&(Oe-Be)*(rt-ot)>=(ve-Be)*(ce-ot)&&(ve-Be)*(Ne-ot)>=(at-Be)*(rt-ot)}function Ee(Oe,ce){return Oe.next.i!==ce.i&&Oe.prev.i!==ce.i&&!xt(Oe,ce)&&(ht(Oe,ce)&&ht(ce,Oe)&&kt(Oe,ce)&&(ue(Oe.prev,Oe,ce.prev)||ue(Oe,ce.prev,ce))||_e(Oe,ce)&&ue(Oe.prev,Oe,Oe.next)>0&&ue(ce.prev,ce,ce.next)>0)}function ue(Oe,ce,ve){return(ce.y-Oe.y)*(ve.x-ce.x)-(ce.x-Oe.x)*(ve.y-ce.y)}function _e(Oe,ce){return Oe.x===ce.x&&Oe.y===ce.y}function Me(Oe,ce,ve,rt){var at=yt(ue(Oe,ce,ve)),Ne=yt(ue(Oe,ce,rt)),Be=yt(ue(ve,rt,Oe)),ot=yt(ue(ve,rt,ce));return!!(at!==Ne&&Be!==ot||at===0&&Fe(Oe,ve,ce)||Ne===0&&Fe(Oe,rt,ce)||Be===0&&Fe(ve,Oe,rt)||ot===0&&Fe(ve,ce,rt))}function Fe(Oe,ce,ve){return ce.x<=Math.max(Oe.x,ve.x)&&ce.x>=Math.min(Oe.x,ve.x)&&ce.y<=Math.max(Oe.y,ve.y)&&ce.y>=Math.min(Oe.y,ve.y)}function yt(Oe){return Oe>0?1:Oe<0?-1:0}function xt(Oe,ce){var ve=Oe;do{if(ve.i!==Oe.i&&ve.next.i!==Oe.i&&ve.i!==ce.i&&ve.next.i!==ce.i&&Me(ve,ve.next,Oe,ce))return!0;ve=ve.next}while(ve!==Oe);return!1}function ht(Oe,ce){return ue(Oe.prev,Oe,Oe.next)<0?ue(Oe,ce,Oe.next)>=0&&ue(Oe,Oe.prev,ce)>=0:ue(Oe,ce,Oe.prev)<0||ue(Oe,Oe.next,ce)<0}function kt(Oe,ce){var ve=Oe,rt=!1,at=(Oe.x+ce.x)/2,Ne=(Oe.y+ce.y)/2;do ve.y>Ne!=ve.next.y>Ne&&ve.next.y!==ve.y&&at<(ve.next.x-ve.x)*(Ne-ve.y)/(ve.next.y-ve.y)+ve.x&&(rt=!rt),ve=ve.next;while(ve!==Oe);return rt}function Bt(Oe,ce){var ve=new Ct(Oe.i,Oe.x,Oe.y),rt=new Ct(ce.i,ce.x,ce.y),at=Oe.next,Ne=ce.prev;return Oe.next=ce,ce.prev=Oe,ve.next=at,at.prev=ve,rt.next=ve,ve.prev=rt,Ne.next=rt,rt.prev=Ne,rt}function Vt(Oe,ce,ve,rt){var at=new Ct(Oe,ce,ve);return rt?(at.next=rt.next,at.prev=rt,rt.next.prev=at,rt.next=at):(at.prev=at,at.next=at),at}function $t(Oe){Oe.next.prev=Oe.prev,Oe.prev.next=Oe.next,Oe.prevZ&&(Oe.prevZ.nextZ=Oe.nextZ),Oe.nextZ&&(Oe.nextZ.prevZ=Oe.prevZ)}function Ct(Oe,ce,ve){this.i=Oe,this.x=ce,this.y=ve,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(Oe,ce,ve,rt){var at=ce&&ce.length,Ne=at?ce[0]*ve:Oe.length,Be=Math.abs(xn(Oe,0,Ne,ve));if(at)for(var ot=0,Ft=ce.length;ot<Ft;ot++){var Dt=ce[ot]*ve,vn=ot<Ft-1?ce[ot+1]*ve:Oe.length;Be-=Math.abs(xn(Oe,Dt,vn,ve))}var un=0;for(ot=0;ot<rt.length;ot+=3){var fn=rt[ot]*ve,yn=rt[ot+1]*ve,Tn=rt[ot+2]*ve;un+=Math.abs((Oe[fn]-Oe[Tn])*(Oe[yn+1]-Oe[fn+1])-(Oe[fn]-Oe[yn])*(Oe[Tn+1]-Oe[fn+1]))}return Be===0&&un===0?0:Math.abs((un-Be)/Be)};function xn(Oe,ce,ve,rt){for(var at=0,Ne=ce,Be=ve-rt;Ne<ve;Ne+=rt)at+=(Oe[Be]-Oe[Ne])*(Oe[Ne+1]+Oe[Be+1]),Be=Ne;return at}return n.flatten=function(Oe){for(var ce=Oe[0][0].length,ve={vertices:[],holes:[],dimensions:ce},rt=0,at=0;at<Oe.length;at++){for(var Ne=0;Ne<Oe[at].length;Ne++)for(var Be=0;Be<ce;Be++)ve.vertices.push(Oe[at][Ne][Be]);at>0&&(rt+=Oe[at-1].length,ve.holes.push(rt))}return ve},G8.exports}var Gz=qz();const Yz=L2(Gz),Y8=tb.CLOCKWISE,O_=tb.COUNTER_CLOCKWISE,x3={isClosed:!0};function Kz(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function d2(n){return"positions"in n?n.positions:n}function h7(n){return"holeIndices"in n?n.holeIndices:null}function Jz(n){return Array.isArray(n[0])}function Qz(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function eU(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function tU(n,e,t,r){for(let s=0;s<e;s++)if(n[t+s]!==n[r-e+s])return!1;return!0}function D_(n,e,t,r,s){let u=e;const f=t.length;for(let m=0;m<f;m++)for(let o=0;o<r;o++)n[u++]=t[m][o]||0;if(!eU(t))for(let m=0;m<r;m++)n[u++]=t[0][m]||0;return x3.start=e,x3.end=u,x3.size=r,nb(n,s,x3),u}function L_(n,e,t,r,s=0,u,f){u=u||t.length;const m=u-s;if(m<=0)return e;let o=e;for(let T=0;T<m;T++)n[o++]=t[s+T];if(!tU(t,r,s,u))for(let T=0;T<r;T++)n[o++]=t[s+T];return x3.start=e,x3.end=o,x3.size=r,nb(n,f,x3),o}function nU(n,e){Kz(n);const t=[],r=[];if("positions"in n){const{positions:s,holeIndices:u}=n;if(u){let f=0;for(let m=0;m<=u.length;m++)f=L_(t,f,s,e,u[m-1],u[m],m===0?Y8:O_),r.push(f);return r.pop(),{positions:t,holeIndices:r}}n=s}if(!Jz(n))return L_(t,0,n,e,0,t.length,Y8),t;if(!Qz(n)){let s=0;for(const[u,f]of n.entries())s=D_(t,s,f,e,u===0?Y8:O_),r.push(s);return r.pop(),{positions:t,holeIndices:r}}return D_(t,0,n,e,Y8),t}function y9(n,e,t){const r=n.length/3;let s=0;for(let u=0;u<r;u++){const f=(u+1)%r;s+=n[u*3+e]*n[f*3+t],s-=n[f*3+e]*n[u*3+t]}return Math.abs(s/2)}function F_(n,e,t,r){const s=n.length/3;for(let u=0;u<s;u++){const f=u*3,m=n[f+0],o=n[f+1],T=n[f+2];n[f+e]=m,n[f+t]=o,n[f+r]=T}}function rU(n,e,t,r){let s=h7(n);s&&(s=s.map(m=>m/e));let u=d2(n);const f=r&&e===3;if(t){const m=u.length;u=u.slice();const o=[];for(let T=0;T<m;T+=e){o[0]=u[T],o[1]=u[T+1],f&&(o[2]=u[T+2]);const C=t(o);u[T]=C[0],u[T+1]=C[1],f&&(u[T+2]=C[2])}}if(f){const m=y9(u,0,1),o=y9(u,0,2),T=y9(u,1,2);if(!m&&!o&&!T)return[];m>o&&m>T||(o>T?(t||(u=u.slice()),F_(u,0,2,1)):(t||(u=u.slice()),F_(u,2,0,1)))}return Yz(u,s,e)}class iU extends Kx{constructor(e){const{fp64:t,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=nU(e,this.positionSize);return this.opts.resolution?ib(d2(t),h7(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?Nz(d2(t),h7(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(N_(e)){let t=0;for(const r of e)t+=this.getGeometrySize(r);return t}return d2(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&N_(e))for(const r of e){const s=this.getGeometrySize(r);t.geometrySize=s,this.updateGeometryAttributes(r,t),t.vertexStart+=s,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const r=e;this._updateIndices(r,t),this._updatePositions(r,t),this._updateVertexValid(r,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:r,indexStart:s}){const{attributes:u,indexStarts:f,typedArrayManager:m}=this;let o=u.indices;if(!o||!e)return;let T=s;const C=rU(e,this.positionSize,this.opts.preproject,this.opts.full3d);o=m.allocate(o,s+C.length,{copy:!0});for(let R=0;R<C.length;R++)o[T++]=C[R]+r;f[t+1]=s+C.length,u.indices=o}_updatePositions(e,{vertexStart:t,geometrySize:r}){const{attributes:{positions:s},positionSize:u}=this;if(!s||!e)return;const f=d2(e);for(let m=t,o=0;o<r;m++,o++){const T=f[o*u],C=f[o*u+1],R=u>2?f[o*u+2]:0;s[m*3]=T,s[m*3+1]=C,s[m*3+2]=R}}_updateVertexValid(e,{vertexStart:t,geometrySize:r}){const{positionSize:s}=this,u=this.attributes.vertexValid,f=e&&h7(e);if(e&&e.edgeTypes?u.set(e.edgeTypes,t):u.fill(1,t,t+r),f)for(let m=0;m<f.length;m++)u[t+f[m]/s-1]=0;u[t+r-1]=0}}function N_(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}const B_=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,sU={name:"solidPolygon",vs:B_,fs:B_,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},cb=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,oU=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${cb}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,aU=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${cb}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,lU=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Y7=[0,0,0,255],cU={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Y7},getLineColor:{type:"accessor",value:Y7},material:!0},K8={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class Of extends Tc{getShaders(e){return super.getShaders({vs:e==="top"?oU:aU,fs:lU,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[j2,Gv,$2,sU]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&t===mr.DEFAULT&&(t=mr.LNGLAT);let s;t===mr.LNGLAT&&(r?s=e.projectPosition.bind(e):s=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new iU({preproject:s,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const u=this.getAttributeManager(),f=!0;u.remove(["instancePickingColors"]),u.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:f},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:K8,accessor:"getPolygon",update:this.calculatePositions,noAlloc:f,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:f},elevations:{size:1,stepMode:"dynamic",transition:K8,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:K8,accessor:"getFillColor",defaultValue:Y7},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:K8,accessor:"getLineColor",defaultValue:Y7},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(m,{index:o,target:T})=>this.encodePickingColor(m&&m.__source?m.__source.index:o,T)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(u=>u.__source.index===r)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:r,wireframe:s,elevationScale:u}=this.props,{topModel:f,sideModel:m,wireframeModel:o,polygonTesselator:T}=this.state,C={extruded:!!t,elevationScale:u,isWireframe:!1};o&&s&&(o.setInstanceCount(T.instanceCount-1),o.shaderInputs.setProps({solidPolygon:{...C,isWireframe:!0}}),o.draw(this.context.renderPass)),m&&r&&(m.setInstanceCount(T.instanceCount-1),m.shaderInputs.setProps({solidPolygon:C}),m.draw(this.context.renderPass)),f&&r&&(f.setVertexCount(T.vertexCount),f.shaderInputs.setProps({solidPolygon:C}),f.draw(this.context.renderPass))}updateState(e){var m;super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:r,changeFlags:s}=e,u=this.getAttributeManager();(s.extensionsChanged||t.filled!==r.filled||t.extruded!==r.extruded)&&((m=this.state.models)==null||m.forEach(o=>o.destroy()),this.setState(this._getModels()),u.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:u}=this.state,f=e.data.attributes||{};u.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:f.getPolygon,buffers:f,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:u.instanceCount,startIndices:u.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:r}=this.props;let s,u,f;if(t){const m=this.getShaders("top");m.defines.NON_INSTANCED_MODEL=1;const o=this.getAttributeManager().getBufferLayouts({isInstanced:!1});s=new Ll(this.context.device,{...m,id:`${e}-top`,topology:"triangle-list",bufferLayout:o,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const m=this.getAttributeManager().getBufferLayouts({isInstanced:!0});u=new Ll(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:m,geometry:new lu({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),f=new Ll(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:m,geometry:new lu({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[u,f,s].filter(Boolean),topModel:s,sideModel:u,wireframeModel:f}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}Of.defaultProps=cU;Of.layerName="SolidPolygonLayer";function uU({data:n,getIndex:e,dataRange:t,replace:r}){const{startRow:s=0,endRow:u=1/0}=t,f=n.length;let m=f,o=f;for(let O=0;O<f;O++){const U=e(n[O]);if(m>O&&U>=s&&(m=O),U>=u){o=O;break}}let T=m;const R=o-m!==r.length?n.slice(o):void 0;for(let O=0;O<r.length;O++)n[T++]=r[O];if(R){for(let O=0;O<R.length;O++)n[T++]=R[O];n.length=T}return{startRow:m,endRow:m+r.length}}function hU(n,e){if(!n)return null;const t="startIndices"in n?n.startIndices[e]:e,r=n.featureIds.value[t];return t!==-1?fU(n,r,t):null}function fU(n,e,t){const r={properties:{...n.properties[e]}};for(const s in n.numericProps)r.properties[s]=n.numericProps[s].value[t];return r}function dU(n,e){const t={points:null,lines:null,polygons:null};for(const r in t){const s=n[r].globalFeatureIds.value;t[r]=new Uint8ClampedArray(s.length*4);const u=[];for(let f=0;f<s.length;f++)e(s[f],u),t[r][f*4+0]=u[0],t[r][f*4+1]=u[1],t[r][f*4+2]=u[2],t[r][f*4+3]=255}return t}const z_=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,pU={name:"sdf",vs:z_,fs:z_,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},mU=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,v9=192/256,U_=[],gU={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Df extends S6{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,pU],fs:mU}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:r,target:s})=>this.encodePickingColor(r,s)}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;let{outlineColor:s}=t;s!==r.outlineColor&&(s=s.map(u=>u/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!t.sdf&&t.outlineWidth&&lr.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:r,outlineWidth:s}=this.props,{outlineColor:u}=this.state,f=s?Math.max(r,v9*(1-s)):-1,m=this.state.model,o={buffer:v9,outlineBuffer:f,gamma:r,enabled:!!t,outlineColor:u};if(m.shaderInputs.setProps({sdf:o}),super.draw(e),t&&s){const{iconManager:T}=this.state;T.getTexture()&&(m.shaderInputs.setProps({sdf:{...o,outlineBuffer:v9}}),m.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):U_}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):U_}}Df.defaultProps=gU;Df.layerName="MultiIconLayer";const K7=1e20;class _U{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:m="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=r;const o=this.size=e+t*4,T=this._createCanvas(o),C=this.ctx=T.getContext("2d",{willReadFrequently:!0});C.font=`${m} ${f} ${e}px ${u}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Uint16Array(o)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(e),m=Math.ceil(r),o=0,T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),C=Math.min(this.size-this.buffer,m+Math.ceil(s)),R=T+2*this.buffer,O=C+2*this.buffer,U=Math.max(R*O,0),V=new Uint8ClampedArray(U),Y={data:V,width:R,height:O,glyphWidth:T,glyphHeight:C,glyphTop:m,glyphLeft:o,glyphAdvance:t};if(T===0||C===0)return Y;const{ctx:ee,buffer:le,gridInner:Ee,gridOuter:ue}=this;ee.clearRect(le,le,T,C),ee.fillText(e,le,le+m);const _e=ee.getImageData(le,le,T,C);ue.fill(K7,0,U),Ee.fill(0,0,U);for(let Me=0;Me<C;Me++)for(let Fe=0;Fe<T;Fe++){const yt=_e.data[4*(Me*T+Fe)+3]/255;if(yt===0)continue;const xt=(Me+le)*R+Fe+le;if(yt===1)ue[xt]=0,Ee[xt]=K7;else{const ht=.5-yt;ue[xt]=ht>0?ht*ht:0,Ee[xt]=ht<0?ht*ht:0}}V_(ue,0,0,R,O,R,this.f,this.v,this.z),V_(Ee,le,le,T,C,R,this.f,this.v,this.z);for(let Me=0;Me<U;Me++){const Fe=Math.sqrt(ue[Me])-Math.sqrt(Ee[Me]);V[Me]=Math.round(255-255*(Fe/this.radius+this.cutoff))}return Y}}function V_(n,e,t,r,s,u,f,m,o){for(let T=e;T<e+r;T++)j_(n,t*u+T,u,s,f,m,o);for(let T=t;T<t+s;T++)j_(n,T*u+e,1,r,f,m,o)}function j_(n,e,t,r,s,u,f){u[0]=0,f[0]=-1e20,f[1]=K7,s[0]=n[e];for(let m=1,o=0,T=0;m<r;m++){s[m]=n[e+m*t];const C=m*m;do{const R=u[o];T=(s[m]-s[R]+C-R*R)/(m-R)/2}while(T<=f[o]&&--o>-1);o++,u[o]=m,f[o]=T,f[o+1]=K7}for(let m=0,o=0;m<r;m++){for(;f[o+1]<m;)o++;const T=u[o],C=m-T;n[e+m*t]=s[T]+C*C}}const yU=32,vU=[];function xU(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function bU({characterSet:n,getFontWidth:e,fontHeight:t,buffer:r,maxCanvasWidth:s,mapping:u={},xOffset:f=0,yOffset:m=0}){let o=0,T=f;const C=t+r*2;for(const R of n)if(!u[R]){const O=e(R);T+O+r*2>s&&(T=0,o++),u[R]={x:T+r,y:m+o*C+r,width:O,height:C,layoutWidth:O,layoutHeight:t},T+=O+r*2}return{mapping:u,xOffset:T,yOffset:m+o*C,canvasHeight:xU(m+(o+1)*C)}}function ub(n,e,t,r){var u;let s=0;for(let f=e;f<t;f++){const m=n[f];s+=((u=r[m])==null?void 0:u.layoutWidth)||0}return s}function hb(n,e,t,r,s,u){let f=e,m=0;for(let o=e;o<t;o++){const T=ub(n,o,o+1,s);m+T>r&&(f<o&&u.push(o),f=o,m=0),m+=T}return m}function wU(n,e,t,r,s,u){let f=e,m=e,o=e,T=0;for(let C=e;C<t;C++)if((n[C]===" "||n[C+1]===" "||C+1===t)&&(o=C+1),o>m){let R=ub(n,m,o,s);T+R>r&&(f<m&&(u.push(m),f=m,T=0),R>r&&(R=hb(n,m,o,r,s,u),f=u[u.length-1])),m=o,T+=R}return T}function TU(n,e,t,r,s=0,u){u===void 0&&(u=n.length);const f=[];return e==="break-all"?hb(n,s,u,t,r,f):wU(n,s,u,t,r,f),f}function EU(n,e,t,r,s,u){let f=0,m=0;for(let o=e;o<t;o++){const T=n[o],C=r[T];C?(m||(m=C.layoutHeight),s[o]=f+C.layoutWidth/2,f+=C.layoutWidth):(lr.warn(`Missing character: ${T} (${T.codePointAt(0)})`)(),s[o]=f,f+=yU)}u[0]=f,u[1]=m}function SU(n,e,t,r,s){var ee;const u=Array.from(n),f=u.length,m=new Array(f),o=new Array(f),T=new Array(f),C=(t==="break-word"||t==="break-all")&&isFinite(r)&&r>0,R=[0,0],O=[0,0];let U=0,V=0,Y=0;for(let le=0;le<=f;le++){const Ee=u[le];if((Ee===`
`||le===f)&&(Y=le),Y>V){const ue=C?TU(u,t,r,s,V,Y):vU;for(let _e=0;_e<=ue.length;_e++){const Me=_e===0?V:ue[_e-1],Fe=_e<ue.length?ue[_e]:Y;EU(u,Me,Fe,s,m,O);for(let yt=Me;yt<Fe;yt++){m[yt]-O[0]/2;const xt=u[yt],ht=((ee=s[xt])==null?void 0:ee.layoutOffsetY)||0;o[yt]=U+O[1]/2+ht,T[yt]=O[0]}U=U+O[1]*e,R[0]=Math.max(R[0],O[0])}V=Y}Ee===`
`&&(m[V]=0,o[V]=0,T[V]=0,V++)}return R[1]=U,{x:m,y:o,rowWidth:T,size:R}}function AU({value:n,length:e,stride:t,offset:r,startIndices:s,characterSet:u}){const f=n.BYTES_PER_ELEMENT,m=t?t/f:1,o=r?r/f:0,T=s[e]||Math.ceil((n.length-o)/m),C=u&&new Set,R=new Array(e);let O=n;if(m>1||o>0){const U=n.constructor;O=new U(T);for(let V=0;V<T;V++)O[V]=n[V*m+o]}for(let U=0;U<e;U++){const V=s[U],Y=s[U+1]||T,ee=O.subarray(V,Y);R[U]=String.fromCodePoint.apply(null,ee),C&&ee.forEach(C.add,C)}if(C)for(const U of C)u.add(String.fromCodePoint(U));return{texts:R,characterCount:T}}class fb{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function CU(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}const K4={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:CU(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},$_=1024,W_=.9,H_=1.2,db=3;let J7=new fb(db);function PU(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const r=J7.get(n);if(!r)return t;for(const s in r.mapping)t.has(s)&&t.delete(s);return t}function IU(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function X_(n,e,t,r){n.font=`${r} ${t}px ${e}`,n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function MU(n){lr.assert(Number.isFinite(n)&&n>=db,"Invalid cache limit"),J7=new fb(n)}class RU{constructor(){this.props={...K4}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*H_+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=PU(this._key,this.props.characterSet),r=J7.get(this._key);if(r&&t.size===0){this._atlas!==r&&(this._atlas=r);return}const s=this._generateFontAtlas(t,r);this._atlas=s,J7.set(this._key,s)}_generateFontAtlas(e,t){const{fontFamily:r,fontWeight:s,fontSize:u,buffer:f,sdf:m,radius:o,cutoff:T}=this.props;let C=t&&t.data;C||(C=document.createElement("canvas"),C.width=$_);const R=C.getContext("2d",{willReadFrequently:!0});X_(R,r,u,s);const{mapping:O,canvasHeight:U,xOffset:V,yOffset:Y}=bU({getFontWidth:ee=>R.measureText(ee).width,fontHeight:u*H_,buffer:f,characterSet:e,maxCanvasWidth:$_,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(C.height!==U){const ee=R.getImageData(0,0,C.width,C.height);C.height=U,R.putImageData(ee,0,0)}if(X_(R,r,u,s),m){const ee=new _U({fontSize:u,buffer:f,radius:o,cutoff:T,fontFamily:r,fontWeight:`${s}`});for(const le of e){const{data:Ee,width:ue,height:_e,glyphTop:Me}=ee.draw(le);O[le].width=ue,O[le].layoutOffsetY=u*W_-Me;const Fe=R.createImageData(ue,_e);IU(Ee,Fe),R.putImageData(Fe,O[le].x,O[le].y)}}else for(const ee of e)R.fillText(ee,O[ee].x,O[ee].y+f+u*W_);return{xOffset:V,yOffset:Y,mapping:O,data:C,width:C.width,height:C.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:r,buffer:s,sdf:u,radius:f,cutoff:m}=this.props;return u?`${e} ${t} ${r} ${s} ${f} ${m}`:`${e} ${t} ${r} ${s}`}}const Z_=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,kU={name:"textBackground",vs:Z_,fs:Z_,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},OU=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,DU=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,LU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Lf extends Tc{getShaders(){return super.getShaders({vs:OU,fs:DU,modules:[j2,$2,kU]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:r,sizeUnits:s,sizeMinPixels:u,sizeMaxPixels:f,getLineWidth:m}=this.props;let{padding:o,borderRadius:T}=this.props;o.length<4&&(o=[o[0],o[1],o[0],o[1]]),Array.isArray(T)||(T=[T,T,T,T]);const C=this.state.model,R={billboard:t,stroked:!!m,borderRadius:T,padding:o,sizeUnits:xc[s],sizeScale:r,sizeMinPixels:u,sizeMaxPixels:f};C.shaderInputs.setProps({textBackground:R}),C.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Ll(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new lu({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}Lf.defaultProps=LU;Lf.layerName="TextBackgroundLayer";const q_={start:1,middle:0,end:-1},G_={top:1,center:0,bottom:-1},x9=[0,0,0,255],FU=1,NU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:x9},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:K4.characterSet},fontFamily:K4.fontFamily,fontWeight:K4.fontWeight,lineHeight:FU,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:x9},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:x9},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Ff extends Mf{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[r,s]}=this.transformParagraph(e,t);const{fontSize:u}=this.state.fontAtlasManager.props;r/=u,s/=u;const{getTextAnchor:f,getAlignmentBaseline:m}=this.props,o=q_[typeof f=="function"?f(e,t):f],T=G_[typeof m=="function"?m(e,t):m];return[(o-1)*r/2,(T-1)*s/2,r,s]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:r,getAlignmentBaseline:s}=this.props,{x:u,y:f,rowWidth:m,size:[o,T]}=this.transformParagraph(e,t),C=q_[typeof r=="function"?r(e,t):r],R=G_[typeof s=="function"?s(e,t):s],O=u.length,U=new Array(O*2);let V=0;for(let Y=0;Y<O;Y++){const ee=(1-C)*(o-m[Y])/2;U[V++]=(C-1)*o/2+ee+u[Y],U[V++]=(R-1)*T/2+f[Y]}return U}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new RU},this.props.maxWidth>0&&lr.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:r,changeFlags:s}=e;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==r.lineHeight||t.wordBreak!==r.wordBreak||t.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:r}=this.props,{fontAtlasManager:s,characterSet:u}=this.state,f={...e,characterSet:u,fontFamily:t,fontWeight:r};if(!s.mapping)return s.setProps(f),!0;for(const m in f)if(f[m]!==s.props[m])return s.setProps(f),!0;return!1}_updateText(){var o;const{data:e,characterSet:t}=this.props,r=(o=e.attributes)==null?void 0:o.getText;let{getText:s}=this.props,u=e.startIndices,f;const m=t==="auto"&&new Set;if(r&&u){const{texts:T,characterCount:C}=AU({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:u,characterSet:m});f=C,s=(R,{index:O})=>T[O]}else{const{iterable:T,objectInfo:C}=w6(e);u=[0],f=0;for(const R of T){C.index++;const O=Array.from(s(R,C)||"");m&&O.forEach(m.add,m),f+=O.length,u.push(f)}}this.setState({getText:s,startIndices:u,numInstances:f,characterSet:m||t})}transformParagraph(e,t){const{fontAtlasManager:r}=this.state,s=r.mapping,u=this.state.getText,{wordBreak:f,lineHeight:m,maxWidth:o}=this.props,T=u(e,t)||"";return SU(T,m,f,o*r.props.fontSize,s)}renderLayers(){const{startIndices:e,numInstances:t,getText:r,fontAtlasManager:{scale:s,atlas:u,mapping:f},styleVersion:m}=this.state,{data:o,_dataDiff:T,getPosition:C,getColor:R,getSize:O,getAngle:U,getPixelOffset:V,getBackgroundColor:Y,getBorderColor:ee,getBorderWidth:le,backgroundBorderRadius:Ee,backgroundPadding:ue,background:_e,billboard:Me,fontSettings:Fe,outlineWidth:yt,outlineColor:xt,sizeScale:ht,sizeUnits:kt,sizeMinPixels:Bt,sizeMaxPixels:Vt,transitions:$t,updateTriggers:Ct}=this.props,xn=this.getSubLayerClass("characters",Df),Oe=this.getSubLayerClass("background",Lf);return[_e&&new Oe({getFillColor:Y,getLineColor:ee,getLineWidth:le,borderRadius:Ee,padding:ue,getPosition:C,getSize:O,getAngle:U,getPixelOffset:V,billboard:Me,sizeScale:ht,sizeUnits:kt,sizeMinPixels:Bt,sizeMaxPixels:Vt,transitions:$t&&{getPosition:$t.getPosition,getAngle:$t.getAngle,getSize:$t.getSize,getFillColor:$t.getBackgroundColor,getLineColor:$t.getBorderColor,getLineWidth:$t.getBorderWidth,getPixelOffset:$t.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Ct.getPosition,getAngle:Ct.getAngle,getSize:Ct.getSize,getFillColor:Ct.getBackgroundColor,getLineColor:Ct.getBorderColor,getLineWidth:Ct.getBorderWidth,getPixelOffset:Ct.getPixelOffset,getBoundingRect:{getText:Ct.getText,getTextAnchor:Ct.getTextAnchor,getAlignmentBaseline:Ct.getAlignmentBaseline,styleVersion:m}}}),{data:o.attributes&&o.attributes.background?{length:o.length,attributes:o.attributes.background}:o,_dataDiff:T,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new xn({sdf:Fe.sdf,smoothing:Number.isFinite(Fe.smoothing)?Fe.smoothing:K4.smoothing,outlineWidth:yt/(Fe.radius||K4.radius),outlineColor:xt,iconAtlas:u,iconMapping:f,getPosition:C,getColor:R,getSize:O,getAngle:U,getPixelOffset:V,billboard:Me,sizeScale:ht*s,sizeUnits:kt,sizeMinPixels:Bt*s,sizeMaxPixels:Vt*s,transitions:$t&&{getPosition:$t.getPosition,getAngle:$t.getAngle,getColor:$t.getColor,getSize:$t.getSize,getPixelOffset:$t.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Ct.getText,getPosition:Ct.getPosition,getAngle:Ct.getAngle,getColor:Ct.getColor,getSize:Ct.getSize,getPixelOffset:Ct.getPixelOffset,getIconOffsets:{getTextAnchor:Ct.getTextAnchor,getAlignmentBaseline:Ct.getAlignmentBaseline,styleVersion:m}}}),{data:o,_dataDiff:T,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){MU(e)}}Ff.defaultProps=NU;Ff.layerName="TextLayer";const f7={circle:{type:Rf,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:S6,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Ff,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},d7={type:kf,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},kh={type:Of,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function a2({type:n,props:e}){const t={};for(const r in e)t[r]=n.defaultProps[e[r]];return t}function b9(n,e){const{transitions:t,updateTriggers:r}=n.props,s={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const u in e){const f=e[u];let m=n.props[u];u.startsWith("get")&&(m=n.getSubLayerAccessor(m),s.updateTriggers[f]=r[u],t&&(s.transitions[f]=t[u])),s[f]=m}return s}function BU(n){if(Array.isArray(n))return n;switch(lr.assert(n.type,"GeoJSON does not have type"),n.type){case"Feature":return[n];case"FeatureCollection":return lr.assert(Array.isArray(n.features),"GeoJSON does not have features array"),n.features;default:return[{geometry:n}]}}function Y_(n,e,t={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:u=n.length}=t;for(let f=s;f<u;f++){const m=n[f],{geometry:o}=m;if(o)if(o.type==="GeometryCollection"){lr.assert(Array.isArray(o.geometries),"GeoJSON does not have geometries array");const{geometries:T}=o;for(let C=0;C<T.length;C++){const R=T[C];K_(R,r,e,m,f)}}else K_(o,r,e,m,f)}return r}function K_(n,e,t,r,s){const{type:u,coordinates:f}=n,{pointFeatures:m,lineFeatures:o,polygonFeatures:T,polygonOutlineFeatures:C}=e;if(!UU(u,f)){lr.warn(`${u} coordinates are malformed`)();return}switch(u){case"Point":m.push(t({geometry:n},r,s));break;case"MultiPoint":f.forEach(R=>{m.push(t({geometry:{type:"Point",coordinates:R}},r,s))});break;case"LineString":o.push(t({geometry:n},r,s));break;case"MultiLineString":f.forEach(R=>{o.push(t({geometry:{type:"LineString",coordinates:R}},r,s))});break;case"Polygon":T.push(t({geometry:n},r,s)),f.forEach(R=>{C.push(t({geometry:{type:"LineString",coordinates:R}},r,s))});break;case"MultiPolygon":f.forEach(R=>{T.push(t({geometry:{type:"Polygon",coordinates:R}},r,s)),R.forEach(O=>{C.push(t({geometry:{type:"LineString",coordinates:O}},r,s))})});break}}const zU={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function UU(n,e){let t=zU[n];for(lr.assert(t,`Unknown GeoJSON type ${n}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function pb(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function J8(n){return n.geometry.coordinates}function VU(n,e){const t=pb(),{pointFeatures:r,lineFeatures:s,polygonFeatures:u,polygonOutlineFeatures:f}=n;return t.points.data=r,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=J8,t.lines.data=s,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=J8,t.polygons.data=u,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=J8,t.polygonsOutline.data=f,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=J8,t}function jU(n,e){const t=pb(),{points:r,lines:s,polygons:u}=n,f=dU(n,e);return t.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:4,value:f.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},t.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:f.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.lines._pathType="open",t.polygons.data={length:u.polygonIndices.value.length-1,startIndices:u.polygonIndices.value,attributes:{...u.attributes,getPolygon:u.positions,pickingColors:{size:4,value:f.polygons}},properties:u.properties,numericProps:u.numericProps,featureIds:u.featureIds},t.polygons._normalize=!1,u.triangles&&(t.polygons.data.attributes.indices=u.triangles.value),t.polygonsOutline.data={length:u.primitivePolygonIndices.value.length-1,startIndices:u.primitivePolygonIndices.value,attributes:{...u.attributes,getPath:u.positions,instancePickingColors:{size:4,value:f.polygons}},properties:u.properties,numericProps:u.numericProps,featureIds:u.featureIds},t.polygonsOutline._pathType="open",t}const $U=["points","linestrings","polygons"],WU={...a2(f7.circle),...a2(f7.icon),...a2(f7.text),...a2(d7),...a2(kh),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:n=>n.properties.icon},getText:{type:"accessor",value:n=>n.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Nf extends Mf{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:r}=this.props,s=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:s}),s?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const r=jU(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:t}){const r=BU(e.data),s=this.getSubLayerRow.bind(this);let u={};const f={};if(Array.isArray(t.dataChanged)){const o=this.state.features;for(const T in o)u[T]=o[T].slice(),f[T]=[];for(const T of t.dataChanged){const C=Y_(r,s,T);for(const R in o)f[R].push(uU({data:u[R],getIndex:O=>O.__source.index,dataRange:T,replace:C[R]}))}}else u=Y_(r,s);const m=VU(u,f);this.setState({features:u,featuresDiff:f,layerProps:m})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r,sourceLayer:s}=t;return t.featureType=$U.find(u=>s.id.startsWith(`${this.id}-${u}-`)),r>=0&&s.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[r]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,r=e.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(t)===r&&s.updateAutoHighlight(e)}_renderPolygonLayer(){var f;const{extruded:e,wireframe:t}=this.props,{layerProps:r}=this.state,s="polygons-fill",u=this.shouldRenderSubLayer(s,(f=r.polygons)==null?void 0:f.data)&&this.getSubLayerClass(s,kh.type);if(u){const m=b9(this,kh.props),o=e&&t;return o||delete m.getLineColor,m.updateTriggers.lineColors=o,new u(m,this.getSubLayerProps({id:s,updateTriggers:m.updateTriggers}),r.polygons)}return null}_renderLineLayers(){var o,T;const{extruded:e,stroked:t}=this.props,{layerProps:r}=this.state,s="polygons-stroke",u="linestrings",f=!e&&t&&this.shouldRenderSubLayer(s,(o=r.polygonsOutline)==null?void 0:o.data)&&this.getSubLayerClass(s,d7.type),m=this.shouldRenderSubLayer(u,(T=r.lines)==null?void 0:T.data)&&this.getSubLayerClass(u,d7.type);if(f||m){const C=b9(this,d7.props);return[f&&new f(C,this.getSubLayerProps({id:s,updateTriggers:C.updateTriggers}),r.polygonsOutline),m&&new m(C,this.getSubLayerProps({id:u,updateTriggers:C.updateTriggers}),r.lines)]}return null}_renderPointLayers(){var m;const{pointType:e}=this.props,{layerProps:t,binary:r}=this.state;let{highlightedObjectIndex:s}=this.props;!r&&Number.isFinite(s)&&(s=t.points.data.findIndex(o=>o.__source.index===s));const u=new Set(e.split("+")),f=[];for(const o of u){const T=`points-${o}`,C=f7[o],R=C&&this.shouldRenderSubLayer(T,(m=t.points)==null?void 0:m.data)&&this.getSubLayerClass(T,C.type);if(R){const O=b9(this,C.props);let U=t.points;if(o==="text"&&r){const{instancePickingColors:V,...Y}=U.data.attributes;U={...U,data:{...U.data,attributes:Y}}}f.push(new R(O,this.getSubLayerProps({id:T,updateTriggers:O.updateTriggers,highlightedObjectIndex:s}),U))}}return f}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),r=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&t,r,s,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(r,s)=>{const{data:u,index:f}=s,m=hU(u,f);return e(m,s)}}}Nf.layerName="GeoJsonLayer";Nf.defaultProps=WU;const HU=n=>lt.createElement("svg",{fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...n},lt.createElement("path",{fill:"currentColor",d:"M7 11.5h10v1H7z"}),lt.createElement("path",{fill:"currentColor",d:"M11.5 7h1v10h-1z"})),XU=n=>lt.createElement("svg",{fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...n},lt.createElement("path",{fill:"currentColor",d:"M7 11.5h10v1H7z"})),ZU=n=>lt.createElement("svg",{fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...n},lt.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 2h2v4h-2V2zm3 10a2 2 0 11-4 0 2 2 0 014 0zm4 1h4v-2h-4v2zm-5 5v4h-2v-4h2zm-7-5v-2H2v2h4z",fill:"currentColor"}),lt.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 18a6 6 0 100-12 6 6 0 000 12zm0 1a7 7 0 100-14 7 7 0 000 14z",fill:"currentColor"})),qU="FeatureCollection",GU=JSON.parse('[{"type":"Feature","id":662,"properties":{"name":"dma:","latitude":32.404348,"dma":662,"dma1":"Abilene-Sweetwater, TX","longitude":-99.8293625},"geometry":{"type":"Polygon","coordinates":[[[-98.66994209570957,31.701391863686368],[-99.01089973237323,31.47283988608861],[-99.2362785091509,31.482776928592862],[-99.31718371107111,31.410733370437043],[-99.62924663276327,31.467871364836483],[-99.70437289168916,31.57717883238324],[-100.23603564716471,31.582147353635364],[-100.23603564716471,32.081483739473946],[-101.18378229822981,32.08645226072608],[-101.17222441224122,32.963396261726174],[-100.51920385388539,32.963396261726174],[-100.51920385388539,33.39814187128713],[-99.47321517191719,33.39814187128713],[-99.47321517191719,32.95594347984799],[-98.57747900780078,32.953459219221926],[-98.57747900780078,32.5162293490349],[-98.47345803390338,32.51374508840884],[-98.47345803390338,32.30009867456746],[-98.92421558745875,32.078999478847884],[-98.66994209570957,31.701391863686368]]]}},{"type":"Feature","id":525,"properties":{"name":"dma:","latitude":31.5279975,"dma":525,"dma1":"Albany, GA","longitude":-83.7121235},"geometry":{"type":"Polygon","coordinates":[[[-84.63866850555056,31.43309171607161],[-84.78892102340234,31.43557597669767],[-84.82937362436243,31.602021438643867],[-84.54620541764177,31.621895523652366],[-84.59821590459046,31.92000679877988],[-84.44218444374437,31.96720775067507],[-84.33816346984699,31.872805846884688],[-83.92207957425742,31.91255401690169],[-83.96253217521752,32.0317985269527],[-83.61001665256526,32.02931426632664],[-83.61001665256526,31.85293176187619],[-83.1823748709871,31.85293176187619],[-83.00322763816382,31.77591968246825],[-82.83563829132913,31.815667852485248],[-82.83563829132913,31.671580736173617],[-82.62759634353435,31.671580736173617],[-82.59870162856285,31.557304747374737],[-82.62759634353435,31.2740990360036],[-82.69694365946594,31.279067557255726],[-82.67382788748876,31.18466565346535],[-83.04945918211821,31.18466565346535],[-83.1650380420042,31.147401744074408],[-83.19971169997,31.02567297339734],[-84.54042647464746,31.077842446544654],[-84.53464753165316,31.256709211621164],[-84.64444744854485,31.259193472247226],[-84.63866850555056,31.43309171607161]]]}},{"type":"Feature","id":532,"properties":{"name":"dma:","latitude":43.049266,"dma":532,"dma1":"Albany-Schenectady-Troy, NY","longitude":-73.8438695},"geometry":{"type":"Polygon","coordinates":[[[-73.0229930870087,42.74144608590859],[-72.9536457710771,42.63959140024003],[-73.0114352010201,42.378744034503455],[-73.06922463096309,42.38122829512952],[-72.99987731503151,42.31166899759977],[-73.0518878019802,42.04088458935894],[-73.51998218451845,42.05082163186319],[-73.52576112751275,41.978778073707375],[-73.93028713711371,42.07814849874988],[-73.9996344530453,42.177518923792384],[-74.0747607119712,42.09553832313232],[-74.53707615151515,42.20236153005301],[-74.42727623462346,42.348932906990704],[-74.71044444134412,42.517862629562956],[-74.62953923942393,42.62717009710971],[-74.64687606840684,42.82839520782079],[-74.76245492829283,42.86317485658566],[-74.71044444134412,43.28549916301631],[-74.86647590219022,43.34015289678968],[-74.77401281428143,43.486724273727376],[-74.85491801620162,44.07052552085209],[-74.28280265976598,44.12021073337334],[-74.25390794479448,43.968670835183524],[-74.33481314671468,43.92643840454046],[-74.21345534383438,43.80967815511552],[-74.04586599699971,43.7972568519852],[-74.0574238829883,43.74508737883789],[-73.38128755265527,43.80719389448946],[-73.43329803960395,43.586094698769884],[-73.30616129372937,43.628327129412945],[-73.24837186378637,43.553799310631064],[-73.25415080678067,43.315310290529055],[-72.82073008220823,43.30040472677268],[-72.8669616261626,43.11160091919193],[-72.9940983720372,43.119053701070115],[-72.93052999909992,42.73896182528253],[-73.0229930870087,42.74144608590859]]]}},{"type":"Feature","id":790,"properties":{"name":"dma:","latitude":34.4952755,"dma":790,"dma1":"Albuquerque-Santa Fe, NM","longitude":-106.526644},"geometry":{"type":"Polygon","coordinates":[[[-104.02702225142514,31.999503138813882],[-106.379052050105,32.00198739943995],[-106.33859944914491,33.05282964426443],[-106.88759903360335,32.779560975397544],[-107.29790398619862,32.779560975397544],[-107.29790398619862,31.783372464346435],[-108.21097697929793,31.783372464346435],[-108.21097697929793,31.333721291029104],[-109.04892371347134,31.33123703040304],[-109.04892371347134,34.871308422542256],[-109.38988135013501,34.65020922682268],[-109.85219678967897,34.662630529953],[-109.82908101770177,35.66130330163016],[-110.00244930753075,35.66378756225623],[-110.00244930753075,36.99783551845185],[-109.04314477047704,37.00031977907791],[-109.04314477047704,37.484750601160115],[-108.91600802460246,37.631321978097816],[-107.74866153975397,37.641259020602064],[-107.4828301620162,37.638774759976],[-107.4828301620162,37.00031977907791],[-105.72025254875487,36.99535125782579],[-105.77226303570356,37.045036470347036],[-105.74914726372637,37.35060052735274],[-105.29838971017102,37.6586488449845],[-105.18281085028502,37.61641641434144],[-105.13080036333633,37.41022278237824],[-105.15391613531352,36.99535125782579],[-104.00968542244225,36.99535125782579],[-104.00968542244225,36.175545251225124],[-103.79586453165317,36.17306099059906],[-103.79586453165317,36.08611186868687],[-103.36244380708071,36.08611186868687],[-103.3797806360636,35.39797167526753],[-103.63983307080707,35.39051889338934],[-103.63983307080707,35.241463255825586],[-103.85943290459045,35.26382160146015],[-104.12526428232823,35.14209283078308],[-104.13104322532253,34.60549253555356],[-103.94611704950495,34.60549253555356],[-103.94611704950495,34.08379780408041],[-103.84209607560756,34.08131354345435],[-103.84209607560756,33.820466177717776],[-103.71495932973298,33.820466177717776],[-103.72073827272727,33.65650497639764],[-103.5069173819382,33.65650497639764],[-103.51269632493249,33.56955585448545],[-103.05038088538853,33.56955585448545],[-103.06193877137713,32.563430300930094],[-103.18329657425743,32.59075716781678],[-103.25842283318332,32.47151265776578],[-103.4433490090009,32.41934318461846],[-103.54159103990399,32.523682130913095],[-103.81320136063606,32.52865065216522],[-103.72073827272727,32.523682130913095],[-103.72073827272727,31.999503138813882],[-104.02702225142514,31.999503138813882]]]}},{"type":"Feature","id":644,"properties":{"name":"dma:","latitude":31.322628,"dma":644,"dma1":"Alexandria, LA","longitude":-92.61795},"geometry":{"type":"Polygon","coordinates":[[[-93.38798819891989,31.363532418541855],[-92.94878853135313,31.346142594159417],[-92.71763081158116,31.52252509860986],[-92.97190430333033,31.708844645564557],[-92.61938878067807,31.708844645564557],[-92.61938878067807,31.79827802810281],[-92.36511528892889,31.79579376747675],[-92.38245211791178,31.619411263026304],[-92.1628522841284,31.47283988608861],[-92.08194708220822,31.323784248524852],[-92.00104188028803,31.323784248524852],[-91.98948399429943,31.22441382348235],[-91.90857879237925,31.296457381638163],[-91.67742107260726,31.18714991409141],[-91.81611570447045,30.849290468946897],[-92.23797854305431,30.849290468946897],[-92.2784311440144,30.96605071837184],[-92.3882310609061,31.003314627762776],[-92.52114674977497,30.89400716021602],[-93.56135648874887,30.869164553955397],[-93.53824071677167,31.276583296629664],[-93.43999868586859,31.276583296629664],[-93.38798819891989,31.363532418541855]]]}},{"type":"Feature","id":583,"properties":{"name":"dma:","latitude":44.856283,"dma":583,"dma1":"Alpena, MI","longitude":-83.5733565},"geometry":{"type":"Polygon","coordinates":[[[-83.88162697329733,45.20086410571058],[-83.37885893279328,45.20334836633664],[-83.25750112991298,45.024481601260135],[-83.38463787578758,45.07665107440745],[-83.46554307770776,45.00460751625163],[-83.31529055985598,44.88287874557456],[-83.26905901590159,44.7139490230023],[-83.32106950285029,44.512723912291236],[-83.88740591629163,44.50775539103911],[-83.88162697329733,45.20086410571058]]]}},{"type":"Feature","id":634,"properties":{"name":"dma:","latitude":35.4797235,"dma":634,"dma1":"Amarillo, TX","longitude":-102.063253},"geometry":{"type":"Polygon","coordinates":[[[-100.51920385388539,34.314834042304234],[-103.04460194239424,34.31234978167817],[-103.05038088538853,33.56955585448545],[-103.51269632493249,33.56955585448545],[-103.5069173819382,33.65650497639764],[-103.72073827272727,33.65650497639764],[-103.71495932973298,33.820466177717776],[-103.84209607560756,33.820466177717776],[-103.84209607560756,34.08131354345435],[-103.94611704950495,34.08379780408041],[-103.94611704950495,34.60549253555356],[-104.13104322532253,34.60549253555356],[-104.12526428232823,35.14209283078308],[-103.85943290459045,35.26382160146015],[-103.63983307080707,35.241463255825586],[-103.63983307080707,35.39051889338934],[-103.3797806360636,35.39797167526753],[-103.36244380708071,36.08611186868687],[-103.79586453165317,36.08611186868687],[-103.79586453165317,36.17306099059906],[-104.00968542244225,36.175545251225124],[-104.00968542244225,36.99535125782579],[-102.04484480438043,36.99286699719973],[-102.03906586138613,37.39034869736974],[-101.55941359285929,37.387864436743676],[-101.55363464986499,36.99535125782579],[-100.00487792739274,37.002804039703975],[-99.99909898439844,34.22540065976598],[-100.04533052835284,34.230369181018105],[-100.05110947134713,33.83537174147415],[-100.51920385388539,33.83537174147415],[-100.51920385388539,34.314834042304234]]]}},{"type":"Feature","id":524,"properties":{"name":"dma:","latitude":33.9253975,"dma":524,"dma1":"Atlanta, GA","longitude":-84.3335135},"geometry":{"type":"Polygon","coordinates":[[[-85.65576247254725,33.107483378037806],[-85.64420458655866,33.49502803570357],[-85.78289921842185,33.47018542944295],[-85.88692019231922,33.477638211321135],[-85.63842564356435,33.649052194519456],[-85.58641515661566,33.845308783978396],[-85.63842564356435,33.875119911491154],[-85.40148898079808,33.9645532940294],[-85.52862572667266,34.58810271117112],[-84.91605776927693,34.63530366306631],[-84.65600533453346,34.583134189918994],[-84.62133167656765,34.856402858785884],[-84.37283712781277,34.84398155565557],[-84.1879109519952,34.6030082749275],[-84.09544786408641,34.727221306230625],[-84.1763530660066,34.95328902320232],[-83.75449022742274,35.16196691579158],[-83.64469031053105,35.15202987328733],[-83.51755356465647,34.995521453845384],[-83.1014696690669,34.99800571447145],[-83.30373267386739,34.81665468876888],[-83.45976413471347,34.48127950425042],[-83.39041681878187,34.44649985548555],[-83.35574316081608,34.22291639913992],[-83.11302755505551,34.27508587228723],[-82.98589080918092,34.0515024159416],[-82.77784886138613,33.97200607590759],[-82.98589080918092,33.785686528952894],[-82.98589080918092,33.490059514451445],[-83.27483795889589,33.18697971807181],[-83.81805860036003,33.13232598429843],[-83.84117437233724,33.19691676057606],[-84.0434373771377,33.20188528182818],[-84.0434373771377,32.9484906979698],[-84.1243425790579,32.93110087358736],[-84.2052477809781,32.690127592859284],[-84.49997387368737,32.88389992169217],[-85.1818891470147,32.87147861856186],[-85.2338996339634,33.107483378037806],[-85.59219409960997,33.107483378037806],[-85.65576247254725,33.107483378037806]]]}},{"type":"Feature","id":520,"properties":{"name":"dma:","latitude":33.2388275,"dma":520,"dma1":"Augusta, GA","longitude":-81.9064505},"geometry":{"type":"Polygon","coordinates":[[[-82.98589080918092,33.785686528952894],[-82.84719617731773,33.93971068776878],[-82.56402797059707,33.95461625152515],[-82.59292268556855,34.014238506550655],[-82.48312276867686,34.08131354345435],[-82.32709130783078,34.06392371907191],[-82.30397553585358,33.97200607590759],[-82.2461861059106,34.01920702780278],[-82.00924944314431,33.96206903340334],[-81.87633375427544,34.16826266536654],[-81.73186017941794,34.185652489748975],[-81.47180774467446,34.07634502220222],[-81.57004977557756,33.887541214621464],[-81.53537611761176,33.832887480848086],[-81.18863953795379,33.65402071577158],[-81.37356571377137,33.490059514451445],[-80.79567141434143,33.177042675567556],[-80.89391344524452,33.06276668676868],[-80.93436604620462,33.10251485678568],[-81.22331319591959,32.950974958595864],[-81.39668148574857,32.74478132663266],[-81.54115506060606,33.04537686238624],[-81.76653383738373,32.908742527952796],[-81.84166009630962,32.64789516221622],[-82.1479440750075,32.52119787028703],[-82.23462821992199,32.3174884989499],[-82.35598602280228,32.29264589268927],[-82.39065968076807,32.44915431213121],[-82.64493317251726,32.51374508840884],[-82.46578593969397,32.64789516221622],[-82.43689122472247,32.7621711510151],[-82.52357536963696,32.821793406040605],[-82.55247008460846,33.020534256125615],[-82.73739626042604,33.174558414941494],[-82.82408040534054,33.42546873817382],[-83.01478552415242,33.47018542944295],[-82.95121715121512,33.661473497649766],[-82.98589080918092,33.785686528952894]]]}},{"type":"Feature","id":635,"properties":{"name":"dma:","latitude":30.331427,"dma":635,"dma1":"Austin, TX","longitude":-98.0272995},"geometry":{"type":"Polygon","coordinates":[[[-97.14430114521451,29.627034240924093],[-97.3176694350435,29.783542660366038],[-97.61817447074708,29.634487022802283],[-97.86666901950196,29.855586218521854],[-97.99958470837083,29.751247272227225],[-98.02847942334233,29.848133436643664],[-98.3000897440744,30.036937244224422],[-98.4156686039604,29.937566819181917],[-98.58903689378937,30.13879192989299],[-98.58903689378937,30.499009720672067],[-99.48477305790578,30.499009720672067],[-99.48477305790578,30.941208112111212],[-98.4445633189319,30.92133402710271],[-98.43878437593759,31.030641494649466],[-97.91290056345635,31.03561001590159],[-97.82621641854185,30.91139698459846],[-97.2714378910891,30.735014480148017],[-97.15585903120312,30.456777290029002],[-96.96515391239123,30.556147715071507],[-96.74555407860785,30.32014295559556],[-96.64153310471048,30.297784609960996],[-96.79178562256226,30.161150275527554],[-96.64731204770477,30.14624471177118],[-96.57218578877888,29.962409425442544],[-96.87269082448245,29.632002762176217],[-97.14430114521451,29.627034240924093]]]}},{"type":"Feature","id":800,"properties":{"name":"dma:","latitude":35.291006,"dma":800,"dma1":"Bakersfield, CA","longitude":-119.05459},"geometry":{"type":"MultiPolygon","coordinates":[[[[-118.11608527152715,35.74576816291629],[-117.91382226672667,35.60168104660466],[-118.02362218361836,35.51473192469247],[-118.05829584158415,35.24643177707771],[-118.52639022412241,34.97813162946295],[-118.74599005790579,35.067565012001204],[-118.72287428592858,35.025332581358136],[-118.85001103180318,34.96322606570657],[-118.76910582988299,34.88621398629863],[-118.93669517671766,34.93589919881988],[-118.88468468976897,34.78932782188219],[-119.47413687518751,34.90111955005501],[-119.47413687518751,35.07750205450545],[-119.56082102010201,35.08743909700971],[-119.55504207710771,35.17935674017402],[-119.80931556885689,35.26382160146015],[-119.87866288478847,35.440204105910595],[-120.00002068766877,35.440204105910595],[-120.08670483258325,35.61410234973498],[-120.19650474947494,35.61410234973498],[-120.19650474947494,35.78800059355936],[-118.06407478457845,35.79048485418542],[-118.11608527152715,35.74576816291629]]]]}},{"type":"Feature","id":512,"properties":{"name":"dma:","latitude":38.972515,"dma":512,"dma1":"Baltimore, MD","longitude":-76.506469},"geometry":{"type":"MultiPolygon","coordinates":[[[[-75.79110678127813,39.720585164616466],[-75.70442263636363,38.56043545224523],[-75.82578043924391,38.47845485158516],[-75.94713824212421,38.23996583148315],[-76.0164855580558,38.30704086838684],[-75.97603295709571,38.366663123412344],[-76.0627171020102,38.30455660776078],[-76.0511592160216,38.22257600710071],[-76.21874856285629,38.39398999029903],[-76.27653799279928,38.36417886278628],[-76.33432742274226,38.48342337283729],[-76.1205065319532,38.52814006410641],[-76.20719067686768,38.5355928459846],[-76.1494012469247,38.57285675537554],[-76.18407490489048,38.59024657975798],[-76.23608539183918,38.54056136723673],[-76.23608539183918,38.60018362226223],[-76.28231693579357,38.5355928459846],[-76.28809587878789,38.62999474977498],[-76.0222645010501,38.552982670367044],[-75.97025401410141,38.58776231913192],[-75.9355803561356,38.67719570167017],[-75.99914872907291,38.75669204170417],[-75.95291718511851,38.67222718041805],[-76.0280434440444,38.580309537253726],[-76.1494012469247,38.637447531653166],[-76.0916118169817,38.68961700480048],[-76.1782959618962,38.67719570167017],[-76.07427498799879,38.73184943544355],[-76.10316970297029,38.77159760546055],[-76.19563279087909,38.669742919791986],[-76.24186433483348,38.806377254225424],[-76.27075904980498,38.709491089808985],[-76.29965376477648,38.71942813231323],[-76.26498010681068,38.79892447234724],[-76.28809587878789,38.81383003610361],[-76.27653799279928,38.77656612671267],[-76.34010636573657,38.73433369606961],[-76.30543270777078,38.82625133923393],[-76.25342222082207,38.863515248624864],[-76.17251701890189,38.7417864779478],[-76.1262854749475,38.793955951095114],[-76.1782959618962,38.77408186608661],[-76.18985384788479,38.85854672737274],[-76.0627171020102,38.88587359425943],[-76.10316970297029,38.94052732803281],[-76.16673807590759,38.908231939893994],[-76.1494012469247,38.94301158865887],[-76.16095913291329,38.977791237423745],[-76.17251701890189,38.893326376137615],[-76.19563279087909,38.88338933363337],[-76.20719067686768,38.853578206120616],[-76.19563279087909,38.893326376137615],[-76.18407490489048,38.90077915801581],[-76.1782959618962,38.93059028552855],[-76.20141173387339,38.893326376137615],[-76.24764327782779,38.97033845554556],[-75.99914872907291,39.15168948124813],[-76.0627171020102,39.20882747564757],[-76.03960133003301,39.17156356625663],[-76.17251701890189,39.09455148684869],[-76.1205065319532,39.17404782688269],[-76.15518018991898,39.12933113561357],[-76.18985384788479,39.176532087508754],[-76.23030644884489,39.05480331683169],[-76.27653799279928,39.15168948124813],[-76.1494012469247,39.275902512551255],[-76.18985384788479,39.31565068256826],[-75.88356986918691,39.35788311321132],[-76.03960133003301,39.39763128322833],[-75.86045409720973,39.45476927762777],[-75.92402247014701,39.48458040514052],[-75.83155938223823,39.56656100580058],[-76.0049276720672,39.44980075637564],[-75.94713824212421,39.593887872687276],[-76.097390759976,39.534265617661774],[-76.13206441794179,39.492033187018706],[-76.0627171020102,39.44980075637564],[-76.1782959618962,39.377757198219825],[-76.22452750585057,39.4125368469847],[-76.23030644884489,39.350430331333136],[-76.25342222082207,39.37527293759376],[-76.21874856285629,39.474643362636264],[-76.24764327782779,39.46470632013202],[-76.28231693579357,39.29826085818582],[-76.31699059375937,39.390178501350135],[-76.34010636573657,39.390178501350135],[-76.35166425172517,39.407568325732576],[-76.35744319471948,39.41005258635864],[-76.36322213771376,39.4125368469847],[-76.41523262466247,39.38520998009801],[-76.34010636573657,39.3727886769677],[-76.32854847974798,39.33552476757676],[-76.44412733963395,39.32807198569857],[-76.40367473867386,39.24857564566457],[-76.47880099759976,39.32310346444645],[-76.50769571257126,39.30571364006401],[-76.39789579567957,39.23863860316032],[-76.44412733963395,39.19640617251726],[-76.50191676957695,39.20882747564757],[-76.46724311161117,39.263481209420945],[-76.47880099759976,39.275902512551255],[-76.48457994059406,39.251059906290635],[-76.51925359855986,39.223733039403946],[-76.53081148454845,39.26596547004701],[-76.62905351545155,39.27341825192519],[-76.55970619951995,39.236154342534256],[-76.60593774347434,39.18150060876088],[-76.60015880048005,39.15417374187419],[-76.54814831353136,39.21628025752575],[-76.55970619951995,39.14423669936994],[-76.43256945364536,39.13429965686569],[-76.42101156765676,39.08213018371838],[-76.43256945364536,39.05728757745775],[-76.54236937053705,39.109457050605066],[-76.53081148454845,39.067224619962],[-76.39211685268526,39.01008662556256],[-76.45568522562256,38.97530697679768],[-76.54814831353136,39.067224619962],[-76.56548514251425,39.062256098709874],[-76.57126408550855,39.07716166246625],[-76.61749562946295,39.08213018371838],[-76.44990628262826,38.94052732803281],[-76.60593774347434,38.977791237423745],[-76.58860091449145,38.93555880678068],[-76.55970619951995,38.95294863116312],[-76.54814831353136,38.920653243024304],[-76.53081148454845,38.933074546154614],[-76.50769571257126,38.89581063676368],[-76.49035888358836,38.90326341864187],[-76.54814831353136,38.82625133923393],[-76.49035888358836,38.83867264236424],[-76.55970619951995,38.8014087329733],[-76.53081148454845,38.71197535043505],[-76.61749562946295,38.71942813231323],[-76.71573766036605,38.77656612671267],[-76.70417977437744,38.990212540554054],[-77.18961098589858,39.34049328882889],[-77.1087057839784,39.492033187018706],[-77.31096878877888,39.6386045639564],[-77.21850570087008,39.720585164616466],[-75.79110678127813,39.720585164616466]]],[[[-76.33432742274226,39.30322937943795],[-76.35744319471948,39.31068216131614],[-76.36322213771376,39.32807198569857],[-76.32854847974798,39.3131664219422],[-76.33432742274226,39.30322937943795]]],[[[-76.21296961986198,39.01008662556256],[-76.24186433483348,39.02499218931894],[-76.21874856285629,39.05480331683169],[-76.20141173387339,39.01257088618862],[-76.21296961986198,39.01008662556256]]],[[[-76.36900108070807,38.83867264236424],[-76.36322213771376,38.938043067406745],[-76.30543270777078,39.03989775307531],[-76.24764327782779,38.920653243024304],[-76.28231693579357,38.96288567366737],[-76.29965376477648,38.90077915801581],[-76.29387482178217,38.9678541949195],[-76.31699059375937,38.97530697679768],[-76.36900108070807,38.83867264236424]]],[[[-76.50769571257126,38.90326341864187],[-76.49613782658265,38.910716200520056],[-76.49613782658265,38.90326341864187],[-76.50769571257126,38.90326341864187]]],[[[-76.18407490489048,38.865999509250926],[-76.16673807590759,38.90326341864187],[-76.10316970297029,38.88338933363337],[-76.15518018991898,38.893326376137615],[-76.18407490489048,38.865999509250926]]],[[[-76.34010636573657,38.669742919791986],[-76.34588530873087,38.692101265426544],[-76.34010636573657,38.724396653565364],[-76.32276953675367,38.68713274417442],[-76.34010636573657,38.669742919791986]]],[[[-76.15518018991898,38.23996583148315],[-76.17251701890189,38.24741861336134],[-76.22452750585057,38.309525129012904],[-76.23030644884489,38.32443069276928],[-76.23608539183918,38.34430477777778],[-76.15518018991898,38.23996583148315]]],[[[-76.19563279087909,38.31449365026503],[-76.20141173387339,38.326914953395345],[-76.1782959618962,38.33436773527353],[-76.17251701890189,38.326914953395345],[-76.19563279087909,38.31449365026503]]]]}},{"type":"Feature","id":537,"properties":{"name":"dma:","latitude":45.3356845,"dma":537,"dma1":"Bangor, ME","longitude":-68.751059},"geometry":{"type":"MultiPolygon","coordinates":[[[[-69.26668014071407,44.36366827472747],[-69.34758534263426,44.309014540954095],[-69.50939574647464,44.34379418971898],[-69.37070111461145,44.54501930043005],[-69.46894314551454,44.71891754425443],[-69.63075354935494,44.70152771987199],[-69.60763777737773,44.57731468856886],[-69.82145866816681,44.582283209820986],[-69.9948269579958,44.67668511361137],[-70.03527955895589,44.865488921192124],[-70.15085841884189,44.895300048704875],[-70.16241630483049,45.12882054755476],[-70.41668979657965,45.14372611131114],[-70.55538442844284,45.66790510341035],[-70.39935296759676,45.720074576557664],[-70.41668979657965,45.79460239533954],[-70.26065833573358,45.891488559755985],[-70.31844776567657,46.018185851685175],[-70.23754256375636,46.144883143614365],[-70.28955305070507,46.189599834883495],[-70.19131101980199,46.348592514951505],[-70.0583953309331,46.41566755185519],[-70.0237216729673,46.5746602319232],[-68.821701530153,46.572175971297135],[-68.821701530153,46.39579346684669],[-68.43451234953496,46.38088790309031],[-68.43451234953496,45.57847172087209],[-67.73526024722472,45.687779188418844],[-67.42319732553256,45.57847172087209],[-67.41741838253824,45.50145964146415],[-67.50410252745274,45.48903833833384],[-67.41741838253824,45.37724661016102],[-67.48676569846984,45.28036044574458],[-67.34229212361237,45.1263362869287],[-67.28450269366937,45.190927063206324],[-67.16314489078908,45.15863167506751],[-66.9839976579658,44.910205612461255],[-67.06490285988599,44.96237508560857],[-67.07068180288029,44.91517413371338],[-67.17470277677768,44.94746952185219],[-67.13425017581758,44.880394484948496],[-67.22671326372637,44.93256395809581],[-67.15158700480048,44.86300466056606],[-67.16892383378337,44.79344536303631],[-67.10535546084608,44.89281578807881],[-67.07068180288029,44.81580370867087],[-67.0244502589259,44.85058335743575],[-67.05912391689168,44.90772135183519],[-66.94932399999999,44.81828796929693],[-67.20937643474348,44.639421204220426],[-67.39430261056106,44.71891754425443],[-67.40586049654965,44.594704512951296],[-67.42897626852685,44.666748071107115],[-67.45787098349834,44.59718877357736],[-67.46364992649265,44.62203137983799],[-67.53299724242424,44.62203137983799],[-67.53877618541854,44.6543267679768],[-67.57344984338434,44.65929528922893],[-67.56767090039003,44.53259799729973],[-67.66013398829884,44.57234616731674],[-67.71214447524753,44.49781834853486],[-67.73526024722472,44.614578597959806],[-67.79882862016201,44.522660954795484],[-67.77571284818481,44.58973599169917],[-67.78727073417342,44.58973599169917],[-67.78149179117912,44.60464155545555],[-67.78727073417342,44.60464155545555],[-67.79304967716772,44.614578597959806],[-67.81038650615062,44.61954711921193],[-67.8970706510651,44.39347940224023],[-67.9028495940594,44.49284982728273],[-67.9375232520252,44.410869226622665],[-67.9664179669967,44.50775539103911],[-67.9895337389739,44.50527113041305],[-68.03576528292828,44.48291278477848],[-67.9606390240024,44.398447923492355],[-68.06465999789978,44.33385714721473],[-68.09933365586559,44.47546000290029],[-68.19179674377438,44.47297574227423],[-68.18023885778578,44.512723912291236],[-68.25536511671167,44.552472082308235],[-68.19757568676867,44.569861906690676],[-68.24380723072306,44.58725173107311],[-68.29581771767177,44.5549563429343],[-68.21491251575156,44.51769243354336],[-68.22647040174017,44.465522960396044],[-68.31893348964897,44.537566518551856],[-68.27270194569456,44.45807017851786],[-68.35360714761475,44.45807017851786],[-68.42873340654066,44.39596366286629],[-68.42295446354635,44.49781834853486],[-68.50385966546654,44.495334087908795],[-68.45762812151216,44.386026620362045],[-68.56742803840385,44.398447923492355],[-68.53275438043804,44.2295182009201],[-68.74079632823282,44.33385714721473],[-68.82748047314732,44.311498801580164],[-68.76969104320432,44.500302609160926],[-68.80436470117012,44.55992486418643],[-68.81014364416441,44.468007221022106],[-68.995069819982,44.42577479037904],[-68.9488382760276,44.341309929092915],[-69.0181855919592,44.256845067806786],[-69.12220656585659,44.254360807180724],[-69.26668014071407,44.36366827472747]]],[[[-67.61390244434443,44.50278686978699],[-67.61968138733873,44.51769243354336],[-67.61390244434443,44.522660954795484],[-67.60234455835584,44.50775539103911],[-67.61390244434443,44.50278686978699]]],[[[-67.58500772937293,44.44813313601361],[-67.60812350135014,44.48539704540455],[-67.59656561536153,44.49284982728273],[-67.60812350135014,44.500302609160926],[-67.57922878637864,44.5152081729173],[-67.58500772937293,44.44813313601361]]],[[[-68.33627031863186,44.22206541904191],[-68.42295446354635,44.33882566846685],[-68.36516503360336,44.423290529752975],[-68.25536511671167,44.43571183288329],[-68.17445991479147,44.328888625962605],[-68.29581771767177,44.28665619531954],[-68.33049137563756,44.37608957785779],[-68.29003877467747,44.24690802530253],[-68.33627031863186,44.22206541904191]]],[[[-68.9315014470447,44.23200246154616],[-68.9141646180618,44.28168767406741],[-68.9430593330333,44.28168767406741],[-68.879490960096,44.39347940224023],[-68.8621541311131,44.366152535353535],[-68.9315014470447,44.23200246154616]]],[[[-68.67722795529554,44.14753760026003],[-68.73501738523852,44.22206541904191],[-68.67722795529554,44.27423489218923],[-68.73501738523852,44.309014540954095],[-68.60788063936394,44.24193950405041],[-68.64833324032404,44.214612637163725],[-68.59054381038104,44.214612637163725],[-68.56742803840385,44.197222812781284],[-68.58476486738674,44.18480150965097],[-68.59632275337533,44.2096441159116],[-68.67722795529554,44.214612637163725],[-68.61365958235822,44.182317249024905],[-68.67722795529554,44.14753760026003]]],[[[-68.9430593330333,44.26429784968497],[-68.9488382760276,44.27423489218923],[-68.9488382760276,44.27671915281529],[-68.937280390039,44.266782110311034],[-68.9430593330333,44.26429784968497]]],[[[-68.9546172190219,44.24442376467647],[-68.9661751050105,44.251876546554655],[-68.9546172190219,44.271750631563165],[-68.937280390039,44.256845067806786],[-68.9546172190219,44.24442376467647]]],[[[-68.23802828772878,44.251876546554655],[-68.23224934473447,44.266782110311034],[-68.21491251575156,44.254360807180724],[-68.22647040174017,44.256845067806786],[-68.23802828772878,44.251876546554655]]],[[[-68.26692300270027,44.23448672217222],[-68.27270194569456,44.25932932843285],[-68.23802828772878,44.24690802530253],[-68.24958617371738,44.23448672217222],[-68.26692300270027,44.23448672217222]]],[[[-68.32471243264325,44.194738552155215],[-68.33627031863186,44.197222812781284],[-68.33627031863186,44.20715985528553],[-68.31315454665466,44.197222812781284],[-68.32471243264325,44.194738552155215]]],[[[-68.72345949924993,44.197222812781284],[-68.72923844224422,44.20219133403341],[-68.72345949924993,44.20467559465947],[-68.72345949924993,44.197222812781284]]],[[[-68.42295446354635,44.12766351525153],[-68.44029129252925,44.157474642764285],[-68.44607023552355,44.13263203650365],[-68.49808072247225,44.15995890339035],[-68.41139657755775,44.18728577027703],[-68.42295446354635,44.12766351525153]]],[[[-68.36516503360336,44.09785238773878],[-68.35360714761475,44.12766351525153],[-68.33049137563756,44.11027369086909],[-68.35938609060906,44.10778943024303],[-68.36516503360336,44.09785238773878]]]]}},{"type":"Feature","id":716,"properties":{"name":"dma:","latitude":30.4278165,"dma":716,"dma1":"Baton Rouge, LA","longitude":-91.140946},"geometry":{"type":"Polygon","coordinates":[[[-91.72365261656165,31.04306279777978],[-91.64852635763576,31.03561001590159],[-91.66008424362437,30.971019239623963],[-91.56184221272127,31.03809427652765],[-91.62541058565856,31.132496180318032],[-91.46937912481248,31.318815727272728],[-91.23244246204621,31.373469461046106],[-91.11108465916591,31.318815727272728],[-90.55052718871886,31.34862685478548],[-90.56786401770177,30.486588417541753],[-90.40027467086708,30.285363306830682],[-90.91460059735974,30.11394932363236],[-90.96083214131413,29.97731498919892],[-90.88570588238824,29.877944564156415],[-91.08218994419443,29.627034240924093],[-91.2844529489949,29.54753790089009],[-91.2786740060006,29.482947124612462],[-91.41158969486949,29.552506422142216],[-91.55028432673268,29.520211034003403],[-91.55606326972696,29.632002762176217],[-91.66008424362437,29.632002762176217],[-91.61963164266427,29.736341708470846],[-91.87968407740775,29.711499102210222],[-91.62541058565856,29.945019601060107],[-91.46937912481248,29.95495664356436],[-91.38847392289229,29.783542660366038],[-91.09952677317732,29.69907779907991],[-91.09374783018302,29.800932484748476],[-91.23244246204621,29.917692734173418],[-91.22088457605761,30.04190576547655],[-91.46360018181818,30.10152802050205],[-91.47515806780677,30.228225312431242],[-91.59073692769277,30.258036439943993],[-91.64274741464146,30.441871726272627],[-91.75832627452745,30.496525460046005],[-91.73521050255025,30.702719092009204],[-91.81611570447045,30.849290468946897],[-91.72365261656165,31.04306279777978]]]}},{"type":"Feature","id":692,"properties":{"name":"dma:","latitude":30.3724315,"dma":692,"dma1":"Beaumont-Port Arthur, TX","longitude":-94.1330155},"geometry":{"type":"Polygon","coordinates":[[[-94.3530716789679,29.5599592040204],[-94.35885062196219,29.887881606660667],[-94.4397558238824,29.887881606660667],[-94.44553476687668,30.11394932363236],[-94.59578728472847,30.1114650630063],[-94.73448191659166,30.489072678167815],[-94.53799785478547,30.49155693879388],[-94.65935565766577,31.010767409640966],[-93.53246177377737,31.18466565346535],[-93.55557754575457,30.82444786268627],[-93.74050372157215,30.53875789068907],[-93.70005112061206,30.056811329232925],[-93.92542989738973,29.810869527252727],[-93.83874575247525,29.691625017201723],[-94.3530716789679,29.5599592040204]]]}},{"type":"Feature","id":821,"properties":{"name":"dma:","latitude":44.001647,"dma":821,"dma1":"Bend, OR","longitude":-120.9495205},"geometry":{"type":"Polygon","coordinates":[[[-121.97641919171917,43.856879107010705],[-121.86661927482749,43.91153284078408],[-121.76837724392439,44.100336648364845],[-121.84350350285028,44.39099514161417],[-121.23093554545454,44.39347940224023],[-121.10957774257426,44.39099514161417],[-121.10379879957995,44.13760055775578],[-120.98821993969396,44.13263203650365],[-120.98821993969396,43.96121805330533],[-120.74550433393338,43.95873379267927],[-120.74550433393338,43.871784670767084],[-120.38143092529252,43.871784670767084],[-120.37565198229822,43.784835548854886],[-120.26007312241224,43.784835548854886],[-120.26007312241224,43.6978864269427],[-119.89599971377137,43.6978864269427],[-119.89599971377137,43.610937305030504],[-122.00531390669066,43.61590582628263],[-121.97641919171917,43.856879107010705]]]}},{"type":"Feature","id":756,"properties":{"name":"dma:","latitude":45.8919365,"dma":756,"dma1":"Billings, MT","longitude":-108.195493},"geometry":{"type":"Polygon","coordinates":[[[-111.10044847644764,45.02199734063407],[-111.15823790639064,45.05429272877288],[-111.11200636243623,45.10894646254626],[-111.04265904650465,45.07416681378138],[-111.03688010351034,45.352404003900396],[-110.91552230063006,45.352404003900396],[-110.92130124362436,45.52630224772478],[-110.79416449774978,45.590893024002405],[-110.78260661176117,46.19208409550956],[-111.05999587548754,46.19208409550956],[-111.12934319141914,46.27406469616962],[-111.05999587548754,46.40821476997701],[-111.24492205130512,46.43802589748975],[-111.5049744860486,46.81314925202521],[-111.64366911791178,46.842960379537956],[-111.60321651695169,46.89264559205921],[-111.66100594689469,46.91251967706771],[-111.5396481440144,46.91251967706771],[-111.5396481440144,46.999468798979905],[-111.15823790639064,47.011890102110215],[-111.15823790639064,47.08890218151816],[-111.08311164746475,47.08890218151816],[-111.08311164746475,47.00940584148415],[-110.75949083978398,46.900098373937396],[-110.46476474707471,46.67899917821782],[-110.05445979447944,46.74855847574758],[-109.81752313171317,46.69390474197421],[-108.63283981788179,46.74855847574758],[-108.60972404590458,47.09883922402241],[-108.73686079177918,47.09883922402241],[-108.71952396279627,47.270253207220726],[-108.31499795319532,47.314969898489856],[-108.31499795319532,47.583270046104616],[-107.97981925952595,47.58575430673068],[-107.86424039963995,47.456572754175426],[-107.65619845184519,47.652829343634366],[-106.91649374857485,47.67270342864287],[-106.61020976987699,47.7770423749375],[-106.4426204230423,47.9832360069007],[-106.35593627812781,47.95839340064007],[-106.35593627812781,47.868960018101816],[-106.26347319021902,47.868960018101816],[-106.29814684818481,47.354718068506855],[-106.17101010231022,47.354718068506855],[-106.17101010231022,47.18081982468247],[-106.08432595739573,47.18081982468247],[-106.08432595739573,46.8603502039204],[-105.61623157485748,46.83302333703371],[-105.57577897389739,46.659125093209326],[-105.4890948289829,46.659125093209326],[-105.4486422280228,46.56969171067107],[-104.98632678847885,46.53988058315832],[-104.73205329672967,46.611924141314134],[-104.73205329672967,46.48274258875888],[-104.90542158655865,46.48274258875888],[-104.88808475757575,46.13743036173618],[-104.94009524452446,46.13743036173618],[-105.03833727542754,44.9996389949995],[-107.91047194359436,45.00212325562556],[-107.74288259675967,44.71643328362837],[-107.5463985349535,44.67916937423743],[-107.19966195529553,44.44564887538755],[-107.14765146834684,44.16492742464247],[-108.55193461596158,44.16741168526853],[-108.55193461596158,44.08046256335634],[-108.79465022172216,44.08046256335634],[-108.79465022172216,43.99102918081809],[-108.91600802460246,43.99102918081809],[-108.91022908160815,43.90408005890589],[-109.09515525742574,43.90408005890589],[-109.08937631443143,43.817130936993706],[-109.31475509120912,43.81216241574158],[-109.5401338679868,43.96121805330533],[-109.78862841674167,43.80222537323733],[-109.85797573267327,43.829552240124016],[-109.85797573267327,43.95873379267927],[-110.05445979447944,44.00841900520052],[-110.05445979447944,44.13263203650365],[-110.11802816741674,44.13263203650365],[-110.14114393939394,44.27671915281529],[-110.29717540024002,44.42825905100511],[-110.29717540024002,44.54501930043005],[-110.66702775187518,44.582283209820986],[-110.66702775187518,44.666748071107115],[-111.05421693249325,44.666748071107115],[-111.08889059045904,44.48539704540455],[-111.09466953345334,44.78847684178419],[-111.10044847644764,45.02199734063407]]]}},{"type":"Feature","id":746,"properties":{"name":"dma:","latitude":30.651123,"dma":746,"dma1":"Biloxi-Gulfport, MS","longitude":-88.868398},"geometry":{"type":"Polygon","coordinates":[[[-88.39498145184518,30.387217992499252],[-88.48166559675968,30.3176586949695],[-88.60880234263426,30.377280949995],[-88.72438120252025,30.342501301230122],[-88.85151794839484,30.43441894439444],[-89.2907176159616,30.302753131213123],[-89.34272810291029,30.9089127239724],[-88.83418111941194,30.91139698459846],[-88.83418111941194,30.998346106510652],[-88.42387616681668,30.998346106510652],[-88.39498145184518,30.387217992499252]]]}},{"type":"Feature","id":502,"properties":{"name":"dma:","latitude":42.2963485,"dma":502,"dma1":"Binghamton, NY","longitude":-75.4931575},"geometry":{"type":"Polygon","coordinates":[[[-76.24764327782779,42.29676343384339],[-76.29387482178217,42.406070901390144],[-75.86623304020401,42.41600794389439],[-75.88934881218123,42.72405626152616],[-75.29411768376838,42.743930346534654],[-75.41547548664866,42.31415325822583],[-74.72778127032703,42.517862629562956],[-74.42727623462346,42.348932906990704],[-74.53707615151515,42.20236153005301],[-74.45039200660065,42.17006614191419],[-75.15542305190519,41.84959652115212],[-75.25944402580258,41.864502084908494],[-75.35768605670566,41.99865215871587],[-76.55970619951995,42.00113641934194],[-76.53659042754276,42.28185787008701],[-76.24764327782779,42.29676343384339]]]}},{"type":"Feature","id":630,"properties":{"name":"dma:","latitude":33.5031,"dma":630,"dma1":"Birmingham (Anniston and Tuscaloosa), AL","longitude":-86.869635},"geometry":{"type":"Polygon","coordinates":[[[-88.06558170117012,32.78949801790179],[-88.1811605610561,32.83421470917092],[-88.1696026750675,32.99569164986499],[-88.3429709648965,32.99072312861286],[-88.2736236489649,33.534776205720576],[-87.94422389828983,33.52483916321633],[-87.95000284128412,34.02169128842884],[-88.2100552760276,34.058955197819785],[-88.1753816180618,34.32228682418242],[-86.47637237773777,34.30241273917392],[-86.30300408790879,34.098703367836784],[-86.1874252280228,34.18316822912291],[-85.84068864836483,34.200558053505354],[-85.51128889768977,34.52351193489349],[-85.40148898079808,33.9645532940294],[-85.63842564356435,33.875119911491154],[-85.58641515661566,33.845308783978396],[-85.63842564356435,33.649052194519456],[-85.88692019231922,33.477638211321135],[-85.64420458655866,33.49502803570357],[-85.65576247254725,33.107483378037806],[-86.49370920672067,33.10251485678568],[-86.51682497869787,32.93110087358736],[-86.37235140384038,32.752234108510855],[-86.71330904050404,32.6628007259726],[-87.01959301920192,32.6628007259726],[-87.01959301920192,32.836698969796984],[-87.41834008580858,32.87396287918792],[-87.52236105970597,32.481449700270026],[-87.85176081038104,32.53113491279128],[-87.85753975337533,32.620568295329534],[-88.07713958715871,32.61808403470347],[-88.06558170117012,32.78949801790179]]]}},{"type":"Feature","id":559,"properties":{"name":"dma:","latitude":37.6001745,"dma":559,"dma1":"Bluefield-Beckley-Oak Hill, WV","longitude":-80.978172},"geometry":{"type":"Polygon","coordinates":[[[-80.85923978727872,37.17918654415442],[-80.91125027422743,37.072363337233725],[-81.22331319591959,37.0475207309731],[-81.37934465676568,36.95311882718272],[-81.49492351665165,37.015225342834285],[-81.68562863546354,36.93324474217422],[-81.77809172337234,36.958087348434844],[-81.89944952625262,37.13943837413741],[-81.74341806540653,37.26365140544055],[-81.85321798229822,37.288494011701175],[-81.99769155715572,37.47729781928193],[-81.70296546444644,37.700881275627566],[-81.76075489438944,37.755535009400944],[-81.51803928862887,37.785346136913695],[-81.55849188958896,37.95427585948595],[-81.37934465676568,37.969181423242325],[-81.32733416981698,38.182827837083714],[-81.2290921389139,38.26232417711772],[-80.71476621242124,38.07848889078908],[-80.43737694869486,38.26729269836984],[-80.26400865886589,38.04619350265027],[-79.95772468016801,38.0635833270327],[-80.25822971587158,37.755535009400944],[-80.29868231683167,37.69094423312332],[-80.2235560579058,37.628837717471754],[-80.32757703180317,37.56424694119412],[-80.29868231683167,37.50710894679468],[-80.77255564236424,37.3729588729873],[-80.85923978727872,37.43009686738674],[-80.84768190129013,37.34811626672668],[-80.97481864716471,37.29097827232724],[-80.85923978727872,37.17918654415442]]]}},{"type":"Feature","id":757,"properties":{"name":"dma:","latitude":43.632029,"dma":757,"dma1":"Boise, ID","longitude":-117.0232835},"geometry":{"type":"Polygon","coordinates":[[[-118.19699047344734,41.99616789808981],[-118.22588518841884,44.04071439333934],[-118.81533737383738,44.04816717521753],[-118.81533737383738,43.96121805330533],[-119.65906305100509,43.95873379267927],[-119.6706209369937,44.99467047374738],[-118.24322201740173,44.95740656435644],[-118.22588518841884,44.865488921192124],[-118.31834827632763,44.83567779367937],[-118.28367461836183,44.751212932393244],[-118.52061128112811,44.706496241124114],[-118.30679039033903,44.58973599169917],[-118.49749550915091,44.27671915281529],[-118.19121153045305,44.256845067806786],[-117.97161169666967,44.443164614761486],[-117.5902014590459,44.44564887538755],[-117.48618048514851,44.38851088098811],[-117.48618048514851,44.30156175907591],[-117.22034910741074,44.30156175907591],[-117.22612805040504,44.48291278477848],[-117.06431764656466,44.72637032613262],[-116.85627569876988,44.880394484948496],[-116.85049675577558,45.02199734063407],[-116.68868635193519,45.26793914261427],[-116.34194977227722,45.26793914261427],[-116.30727611431143,45.10894646254626],[-116.14546571047104,45.106462201920195],[-115.97209742064206,45.220738190719075],[-114.69495101890189,45.195895584458455],[-114.76429833483348,44.84313057555756],[-114.95500345364536,44.72140180488049],[-115.08791914251425,44.77108701740174],[-115.30751897629763,44.579798949194924],[-115.22661377437743,44.46303869976998],[-115.29018214731472,44.323920104710474],[-114.99545605460546,44.09785238773878],[-115.04746654155416,44.03823013271328],[-114.96656133963396,43.98109213831384],[-114.98967711161116,43.85936336763677],[-114.70650890489048,43.80719389448946],[-114.6833931329133,43.59106322002201],[-114.50424590009001,43.47678723122313],[-114.5331406150615,43.332700114911496],[-114.39444598319832,43.3252473330333],[-114.37710915421542,43.258172296129615],[-114.37710915421542,43.19855004110411],[-115.08791914251425,43.19855004110411],[-115.03590865556555,41.99616789808981],[-117.01808610261025,41.99865215871587],[-118.19699047344734,41.99616789808981]]]}},{"type":"Feature","id":506,"properties":{"name":"dma:","latitude":42.501023,"dma":506,"dma1":"Boston, MA (Manchester, NH)","longitude":-71.460493},"geometry":{"type":"MultiPolygon","coordinates":[[[[-72.93052999909992,42.73896182528253],[-72.9940983720372,43.119053701070115],[-72.8669616261626,43.11160091919193],[-72.84962479717971,43.26314081738174],[-72.43354090159016,43.233329689868995],[-72.43354090159016,43.13644352545255],[-72.15615163786379,43.18116021672168],[-72.17926740984097,43.131475004200425],[-72.04057277797779,43.12899074357436],[-72.0521306639664,43.442007582458245],[-71.85564660216022,43.60845304440444],[-71.82097294419441,43.543862268126816],[-71.72850985628563,43.56373635313532],[-71.64760465436544,43.685465123812385],[-71.52046790849084,43.6978864269427],[-71.53202579447944,43.76496146384639],[-71.26041547374737,43.571189135013505],[-71.1274997848785,43.57367339563957],[-71.11016295589559,43.50659835873588],[-70.9599104380438,43.541378007500754],[-70.9772472670267,43.35754272117212],[-70.80965792019202,43.22339264736474],[-70.9136788940894,43.05197866416642],[-70.83855263516352,43.044525882288234],[-70.85588946414641,43.12153796169618],[-70.71141588928893,43.044525882288234],[-70.83855263516352,42.915344329732974],[-70.80965792019202,42.8209424259426],[-70.86166840714071,42.81348964406441],[-70.80965792019202,42.81597390469047],[-70.76920531923193,42.704182176517655],[-70.8154368631863,42.761320170917095],[-70.83855263516352,42.70169791589159],[-70.59005808640865,42.64207566086609],[-70.65940540234024,42.57996914521453],[-70.92523678007801,42.56754784208421],[-70.83277369216921,42.502957065806584],[-70.9367946660666,42.45575611391139],[-70.90789995109512,42.41600794389439],[-70.9772472670267,42.45078759265927],[-70.9541314950495,42.34396438573857],[-71.098605069907,42.406070901390144],[-70.9656893810381,42.22223561506151],[-70.86744735013501,42.25453100320033],[-70.92523678007801,42.30421621572158],[-70.8847841791179,42.309184736973705],[-70.71719483228323,42.2098143119312],[-70.74031060426043,42.16012909940994],[-70.60161597239724,42.006104940594064],[-70.71141588928893,42.003620679968],[-70.53804759945994,41.92660860056006],[-70.49181605550555,41.780037223622365],[-70.56116337143715,41.77258444174418],[-70.59005808640865,41.750226096109614],[-70.63051068736874,41.737804792979304],[-70.60161597239724,41.762647399239924],[-70.62473174437443,41.765131659865986],[-70.63628963036304,41.73532053235324],[-70.67674223132313,41.74525757485749],[-70.64206857335734,41.722899229222925],[-70.67096328832884,41.693088101710174],[-70.65362645934593,41.71544644734474],[-70.71141588928893,41.7576788779878],[-70.71719483228323,41.67569827732774],[-70.76342637623762,41.722899229222925],[-70.76342637623762,41.64091862856286],[-70.8443315781578,41.62849732543255],[-70.91945783708371,41.78997426612662],[-71.0292577539754,41.780037223622365],[-70.9714683240324,41.86201782428243],[-71.08126824092409,42.09553832313232],[-71.36443644764476,41.98623085558556],[-72.1330358658866,42.03094754685469],[-72.1330358658866,42.162613360036005],[-72.26595155475547,42.18497170567057],[-72.21394106780679,42.31166899759977],[-72.31218309870987,42.34396438573857],[-72.23127789678968,42.661949745874594],[-72.28328838373838,42.721572000900096],[-72.93052999909992,42.73896182528253]]],[[[-70.71141588928893,43.05694718541855],[-70.72875271827183,43.05694718541855],[-70.72297377527752,43.06439996729674],[-70.73453166126612,43.07185274917492],[-70.70563694629462,43.07185274917492],[-70.71141588928893,43.05694718541855]]],[[[-70.9772472670267,42.31166899759977],[-70.9656893810381,42.32409030073008],[-70.9541314950495,42.3290588219822],[-70.9656893810381,42.31415325822583],[-70.9772472670267,42.31166899759977]]],[[[-70.9888051530153,42.31912177947795],[-70.9888051530153,42.32657456135614],[-70.9888051530153,42.3290588219822],[-70.983026210021,42.32657456135614],[-70.9888051530153,42.31912177947795]]],[[[-71.0119209249925,42.309184736973705],[-71.0176998679868,42.31166899759977],[-71.0061419819982,42.321606040104015],[-71.0003630390039,42.31912177947795],[-71.0119209249925,42.309184736973705]]],[[[-70.9367946660666,42.28434213071307],[-70.94835255205521,42.2893106519652],[-70.92523678007801,42.30173195509551],[-70.9367946660666,42.294279173217326],[-70.9367946660666,42.28434213071307]]],[[[-70.56116337143715,41.77258444174418],[-70.30111093669368,41.705509404840484],[-70.01794272997299,41.78749000550056],[-69.9890480150015,41.91418729742975],[-70.06995321692169,41.884376169917],[-70.09306898889889,42.03094754685469],[-70.24910044974497,42.065727195619566],[-70.16241630483049,42.07814849874988],[-69.9948269579958,41.966356770577065],[-69.94281647104711,41.82475391489149],[-69.97171118601861,41.83469095739574],[-69.9832690720072,41.78749000550056],[-69.9370375280528,41.81481687238724],[-69.9254796420642,41.722899229222925],[-69.9312585850585,41.668245495449554],[-69.94859541404139,41.765131659865986],[-69.9948269579958,41.7179307079708],[-69.94281647104711,41.705509404840484],[-69.9659322430243,41.653339931693175],[-70.22020573477347,41.635950107310734],[-70.40513191059105,41.648371410441044],[-70.45714239753976,41.613591761676176],[-70.48603711251124,41.553969506650674],[-70.52648971347134,41.581296373537356],[-70.68830011731173,41.524158379137916],[-70.61317385838584,41.6583084529453],[-70.66518434533452,41.680666798579864],[-70.61895280138015,41.695572362336236],[-70.56116337143715,41.77258444174418]]],[[[-70.01794272997299,41.89182895179518],[-70.0237216729673,41.89928173367338],[-70.00638484398439,41.90176599429944],[-70.00638484398439,41.89928173367338],[-70.01794272997299,41.89182895179518]]],[[[-70.0006059009901,41.54154820352036],[-70.01794272997299,41.551485246024605],[-69.9948269579958,41.568875070407046],[-69.9890480150015,41.60613897979798],[-69.97171118601861,41.64340288918892],[-70.0006059009901,41.54154820352036]]],[[[-70.41668979657965,41.608623240424045],[-70.42246873957396,41.623528804180424],[-70.39935296759676,41.626013064806486],[-70.40513191059105,41.608623240424045],[-70.41668979657965,41.608623240424045]]],[[[-70.45714239753976,41.578812112911294],[-70.46292134053405,41.58378063416342],[-70.46292134053405,41.58874915541554],[-70.45714239753976,41.578812112911294]]],[[[-70.52648971347134,41.54651672477248],[-70.54960548544855,41.553969506650674],[-70.52648971347134,41.57384359165917],[-70.54382654245424,41.551485246024605],[-70.52648971347134,41.54651672477248]]],[[[-70.70563694629462,41.511737076007606],[-70.71141588928893,41.51918985788579],[-70.69985800330033,41.521674118511854],[-70.70563694629462,41.511737076007606]]],[[[-70.68830011731173,41.50428429412942],[-70.69985800330033,41.51422133663367],[-70.67674223132313,41.51670559725973],[-70.67674223132313,41.511737076007606],[-70.68830011731173,41.50428429412942]]],[[[-70.79232109120912,41.44714629972998],[-70.78654214821482,41.47695742724272],[-70.71719483228323,41.51422133663367],[-70.69985800330033,41.509252815381544],[-70.79232109120912,41.44714629972998]]],[[[-70.77498426222621,41.30057492279228],[-70.83277369216921,41.352744395939595],[-70.60161597239724,41.481925948494855],[-70.50915288448846,41.34777587468747],[-70.45136345454546,41.42230369346935],[-70.45136345454546,41.34777587468747],[-70.77498426222621,41.30057492279228]]],[[[-70.83277369216921,41.442177778477856],[-70.83277369216921,41.45708334223423],[-70.80965792019202,41.44963056035604],[-70.80965792019202,41.44466203910392],[-70.83277369216921,41.442177778477856]]],[[[-70.9021210081008,41.42230369346935],[-70.85588946414641,41.44963056035604],[-70.85011052115212,41.43720925722573],[-70.86744735013501,41.42230369346935],[-70.9021210081008,41.42230369346935]]],[[[-70.94835255205521,41.409882390339035],[-70.92523678007801,41.4322407359736],[-70.90789995109512,41.42230369346935],[-70.91945783708371,41.42230369346935],[-70.94835255205521,41.409882390339035]]],[[[-70.0121637869787,41.238468407140715],[-70.11618476087608,41.24095266776678],[-70.22020573477347,41.27573231653166],[-70.06417427392739,41.30802770467047],[-70.0526163879388,41.3924925659566],[-69.96015330003,41.27821657715772],[-70.0121637869787,41.238468407140715]]],[[[-70.25487939273927,41.28815361966197],[-70.26643727872786,41.295606401540155],[-70.27799516471647,41.312996225922596],[-70.24910044974497,41.3055434440444],[-70.24332150675068,41.30057492279228],[-70.25487939273927,41.28815361966197]]],[[[-70.80387897719771,41.24840544964497],[-70.82121580618062,41.25088971027103],[-70.83277369216921,41.25834249214922],[-70.8154368631863,41.26331101340135],[-70.80387897719771,41.24840544964497]]]]}},{"type":"Feature","id":736,"properties":{"name":"dma:","latitude":37.0341725,"dma":736,"dma1":"Bowling Green, KY","longitude":-85.99226},"geometry":{"type":"Polygon","coordinates":[[[-85.2165628049805,36.85374840214021],[-85.303246949895,36.62519642454246],[-85.43616263876388,36.617743642664266],[-85.47083629672967,36.73450389208921],[-85.61530987158716,36.833874317131716],[-85.77134133243324,36.83635857775778],[-85.97938328022802,36.7220825889589],[-86.1354147410741,36.93324474217422],[-86.40702506180618,36.776736322732276],[-86.58039335163517,36.831390056505654],[-86.67285643954395,37.00031977907791],[-86.93868781728173,37.06987907660766],[-86.88089838733873,37.11211150725073],[-86.93868781728173,37.13695411351135],[-86.81733001440143,37.328242181718174],[-86.60928806660667,37.39531721862186],[-86.47059343474348,37.32078939983999],[-86.094962140114,37.330726442344236],[-86.01983588118811,37.39531721862186],[-86.04873059615961,37.44997095239524],[-85.65576247254725,37.42264408550855],[-85.69621507350735,37.300915314831485],[-85.63264670057006,37.12453281038104],[-85.43038369576958,37.146891156015606],[-85.1761102040204,37.313336617961795],[-85.05475240114012,37.256198623562355],[-85.04319451515151,37.186639326032605],[-85.2743522349235,36.89846509340934],[-85.2165628049805,36.85374840214021]]]}},{"type":"Feature","id":514,"properties":{"name":"dma:","latitude":42.42369,"dma":514,"dma1":"Buffalo, NY","longitude":-78.6800405},"geometry":{"type":"MultiPolygon","coordinates":[[[[-79.76124061836182,42.2694365669567],[-79.1486726609661,42.55264227832784],[-79.050430630063,42.69176087338734],[-78.85394656825682,42.78367851655166],[-78.94640965616561,42.97745084538454],[-78.88284128322832,43.02465179727973],[-78.88284128322832,43.029620318531855],[-78.88862022622263,43.044525882288234],[-78.94640965616561,43.07185274917492],[-79.06776745904591,43.086758312931295],[-79.0619885160516,43.26314081738174],[-78.51876787458745,43.372448284928495],[-77.99288406210621,43.36499550305031],[-77.99866300510051,43.13395926482649],[-77.90619991719171,43.13395926482649],[-77.95243146114612,43.03955736103611],[-77.90619991719171,43.02465179727973],[-77.9582104041404,42.66691826712672],[-78.06223137803781,42.532768193319335],[-77.72127374137413,42.47066167766777],[-77.75016845634563,41.99865215871587],[-77.61147382448245,41.99865215871587],[-77.59991593849385,41.47944168786879],[-78.05067349204921,41.47447316661666],[-78.200926009901,41.6185602829283],[-78.95796754215422,41.623528804180424],[-78.91751494119413,41.99865215871587],[-79.76124061836182,41.99865215871587],[-79.76124061836182,42.2694365669567]],[[-78.92329388418841,42.95260823912392],[-78.91751494119413,42.95509249974998],[-78.92907282718272,42.95757676037604],[-78.92907282718272,42.95509249974998],[-78.92329388418841,42.95260823912392]],[[-78.90017811221122,42.91286006910691],[-78.90017811221122,42.93024989348935],[-78.90595705520552,42.932734154115415],[-78.90595705520552,42.93024989348935],[-78.90017811221122,42.91286006910691]]],[[[-79.0619885160516,43.07930553105311],[-79.0735464020402,43.07930553105311],[-79.0735464020402,43.08427405230523],[-79.0619885160516,43.07930553105311]]],[[[-78.94640965616561,42.95757676037604],[-79.01575697209721,42.989872148514856],[-78.99842014311432,43.06439996729674],[-78.90017811221122,43.04204162166217],[-78.94640965616561,42.99484066976698],[-78.94640965616561,42.95757676037604]]],[[[-78.88284128322832,43.02465179727973],[-78.88862022622263,43.03210457915792],[-78.88862022622263,43.03458883978398],[-78.88284128322832,43.029620318531855],[-78.88284128322832,43.02465179727973]]],[[[-78.95796754215422,42.95757676037604],[-78.9637464851485,42.960061021002105],[-78.95796754215422,42.96254528162817],[-78.95796754215422,42.95757676037604]]]]}},{"type":"Feature","id":523,"properties":{"name":"dma:","latitude":44.071301,"dma":523,"dma1":"Burlington, VT-Plattsburgh, NY","longitude":-73.0368725},"geometry":{"type":"Polygon","coordinates":[[[-73.25415080678067,43.315310290529055],[-73.24837186378637,43.553799310631064],[-73.30616129372937,43.628327129412945],[-73.43329803960395,43.586094698769884],[-73.38128755265527,43.80719389448946],[-74.0574238829883,43.74508737883789],[-74.04586599699971,43.7972568519852],[-74.21345534383438,43.80967815511552],[-74.33481314671468,43.92643840454046],[-74.25390794479448,43.968670835183524],[-74.28280265976598,44.12021073337334],[-74.53707615151515,44.100336648364845],[-74.64109712541254,44.952438043104316],[-74.72778127032703,44.99467047374738],[-71.46267847854784,45.01454455875588],[-71.53780473747375,44.99467047374738],[-71.49735213651365,44.90523709120913],[-71.63026782538253,44.751212932393244],[-71.53780473747375,44.58725173107311],[-71.57825733843384,44.50278686978699],[-71.76318351425142,44.40590070537054],[-71.57825733843384,44.254360807180724],[-71.44534164956495,44.24939228592859],[-71.34709961866187,44.07052552085209],[-71.36443644764476,43.91650136203621],[-71.56669945244525,43.89414301640164],[-71.52046790849084,43.6978864269427],[-71.64760465436544,43.685465123812385],[-71.72850985628563,43.56373635313532],[-71.82097294419441,43.543862268126816],[-71.85564660216022,43.60845304440444],[-72.0521306639664,43.442007582458245],[-72.04057277797779,43.12899074357436],[-72.17926740984097,43.131475004200425],[-72.15615163786379,43.18116021672168],[-72.43354090159016,43.13644352545255],[-72.43354090159016,43.233329689868995],[-72.82073008220823,43.25568803550355],[-73.25415080678067,43.315310290529055]]]}},{"type":"Feature","id":754,"properties":{"name":"dma:","latitude":45.979098,"dma":754,"dma1":"Butte-Bozeman, MT","longitude":-112.3609785},"geometry":{"type":"Polygon","coordinates":[[[-111.38361668316831,44.75618145364537],[-111.5165323720372,44.64438972547255],[-111.4703008280828,44.54005077917792],[-112.28513179027902,44.567377646064614],[-112.38915276417642,44.44813313601361],[-112.78212088778878,44.48539704540455],[-112.84568926072606,44.35869975347535],[-113.00172072157216,44.45061739663967],[-113.12885746744674,44.77357127802781],[-113.34267835823582,44.78350832053206],[-113.4755940471047,44.895300048704875],[-113.4524782751275,45.059261250025],[-113.68363599489949,45.253033578857895],[-113.76454119681968,45.52133372647265],[-113.83388851275127,45.52133372647265],[-113.80499379777977,45.60331432713272],[-113.93790948664866,45.69523197029703],[-113.89745688568857,45.76975978907892],[-113.59117290699069,45.849256129112916],[-113.28488892829283,46.03805993669367],[-113.28488892829283,46.22189522302231],[-113.03639437953795,46.22189522302231],[-113.03639437953795,46.73613717261726],[-113.29066787128713,46.80569647014702],[-113.30222575727572,47.17833556405641],[-113.46403616111611,47.17833556405641],[-113.46403616111611,47.60065987048705],[-113.12885746744674,47.58823856735674],[-113.05951015151516,47.48886814231424],[-113.05951015151516,47.17833556405641],[-112.79945771677167,47.17833556405641],[-112.79367877377737,46.830539076407646],[-112.5336263390339,46.83550759765977],[-112.5336263390339,46.69887326322633],[-112.31980544824482,46.656640832583264],[-112.31980544824482,46.42063607310732],[-112.03085829852985,46.56969171067107],[-111.63211123192319,46.56969171067107],[-111.5858796879688,46.78085386388639],[-111.33160619621962,46.6342824869487],[-111.34316408220822,46.544849104410446],[-111.24492205130512,46.43802589748975],[-111.05999587548754,46.40821476997701],[-111.12934319141914,46.27406469616962],[-111.05999587548754,46.19208409550956],[-110.78260661176117,46.19208409550956],[-110.79416449774978,45.590893024002405],[-110.92130124362436,45.52630224772478],[-110.91552230063006,45.352404003900396],[-111.03688010351034,45.352404003900396],[-111.04265904650465,45.07416681378138],[-111.11200636243623,45.10894646254626],[-111.15823790639064,45.05429272877288],[-111.10044847644764,45.02199734063407],[-111.09466953345334,44.48539704540455],[-111.38361668316831,44.75618145364537]]]}},{"type":"Feature","id":767,"properties":{"name":"dma:","latitude":43.412869,"dma":767,"dma1":"Casper-Riverton, WY","longitude":-107.4728085},"geometry":{"type":"Polygon","coordinates":[[[-109.37254452115211,42.94515545724573],[-109.55169175397539,43.01223049414942],[-109.75395475877588,43.46436592809282],[-110.05445979447944,43.46436592809282],[-110.05445979447944,44.00841900520052],[-109.85797573267327,43.95873379267927],[-109.85797573267327,43.829552240124016],[-109.78862841674167,43.80222537323733],[-109.5401338679868,43.96121805330533],[-109.31475509120912,43.81216241574158],[-109.08937631443143,43.817130936993706],[-109.09515525742574,43.90408005890589],[-108.91022908160815,43.90408005890589],[-108.91600802460246,43.99102918081809],[-108.79465022172216,43.99102918081809],[-108.79465022172216,44.08046256335634],[-108.55193461596158,44.08046256335634],[-108.55193461596158,44.16741168526853],[-107.14765146834684,44.16492742464247],[-107.17076724032403,44.39347940224023],[-107.36725130213021,44.55992486418643],[-106.00919969846984,44.56489338543855],[-106.01497864146414,43.49417705560556],[-104.89964264356435,43.499145576857686],[-104.89386370057005,42.60978027272728],[-105.28683182418241,42.604811751475154],[-105.28105288118812,42.43091350765077],[-105.3735159690969,42.2893106519652],[-105.61623157485748,42.30421621572158],[-105.5584421449145,42.43091350765077],[-107.5232827629763,42.43339776827683],[-107.5232827629763,42.26198378507851],[-109.04314477047704,42.264468045704575],[-109.07203948544854,42.69424513401341],[-109.15872363036303,42.74144608590859],[-109.37254452115211,42.94515545724573]]]}},{"type":"Feature","id":637,"properties":{"name":"dma:","latitude":42.331217,"dma":637,"dma1":"Cedar Rapids-Waterloo-Iowa City & Dubuque, IA","longitude":-91.7493605},"geometry":{"type":"Polygon","coordinates":[[[-90.64299027662766,42.50792558705871],[-90.47540092979298,42.38122829512952],[-90.66610604860486,42.38122829512952],[-90.66610604860486,42.294279173217326],[-90.89726376837683,42.294279173217326],[-90.89726376837683,41.596201937293735],[-91.36535815091509,41.5986861979198],[-91.3711370939094,41.42230369346935],[-91.48671595379537,41.424787954095414],[-91.48671595379537,41.16145632773278],[-92.41134683288328,41.16145632773278],[-92.41134683288328,41.509252815381544],[-92.2957679729973,41.509252815381544],[-92.2957679729973,41.86201782428243],[-92.76386235553555,41.86201782428243],[-92.76964129852985,42.2098143119312],[-93.00079901830182,42.2098143119312],[-93.02391479027902,42.90789154785479],[-92.55582040774077,42.90789154785479],[-92.55582040774077,43.21345560486049],[-92.08194708220822,43.21345560486049],[-92.08194708220822,43.501629837483755],[-91.2151056330633,43.501629837483755],[-91.209326690069,43.35257419992],[-91.05907417221722,43.258172296129615],[-91.1804319750975,43.0668842279228],[-91.06485311521152,42.75138312841285],[-90.70655864956495,42.63710713961397],[-90.64299027662766,42.50792558705871]]]}},{"type":"Feature","id":648,"properties":{"name":"dma:","latitude":39.9606635,"dma":648,"dma1":"Champaign & Springfield-Decatur, IL","longitude":-89.0627055},"geometry":{"type":"Polygon","coordinates":[[[-90.59675873267327,39.790144462146216],[-90.58520084668467,39.87709358405841],[-89.99574866126613,39.87212506280628],[-89.98419077527753,40.12800390729073],[-89.60278053765376,40.12055112541255],[-89.60278053765376,40.31929197549755],[-88.45854982478247,40.28202806610661],[-88.45854982478247,40.61740325062507],[-88.2331710480048,40.61740325062507],[-88.2447289339934,40.99501086578658],[-87.52814000270027,41.009916429542955],[-87.53391894569457,39.88206210531054],[-87.93844495529552,39.87957784468447],[-88.00779227122712,39.17404782688269],[-88.36030779387939,39.17156356625663],[-88.36030779387939,38.910716200520056],[-88.80528640444044,38.910716200520056],[-88.80528640444044,39.21628025752575],[-89.14046509810981,39.21628025752575],[-89.14046509810981,39.347946070707074],[-89.53343322172216,39.347946070707074],[-89.53343322172216,39.52432857515752],[-90.302032639964,39.519360053905395],[-90.37137995589558,39.75288055275528],[-90.59675873267327,39.790144462146216]]]}},{"type":"Feature","id":519,"properties":{"name":"dma:","latitude":33.181204,"dma":519,"dma1":"Charleston, SC","longitude":-80.042272},"geometry":{"type":"MultiPolygon","coordinates":[[[[-80.66853466846685,32.67025350785079],[-80.82456612931293,32.69758037473748],[-81.0846185640564,33.02550277737774],[-80.93436604620462,33.10251485678568],[-80.89391344524452,33.06276668676868],[-80.89391344524452,33.12487320242025],[-80.50094532163216,33.333551095009504],[-80.42581906270627,33.25653901560156],[-80.26978760186019,33.28635014311431],[-80.2235560579058,33.447827083808384],[-80.1021982550255,33.49751229632963],[-79.99817728112811,33.76829670457046],[-79.85370370627062,33.89250973587359],[-79.49540924062407,33.775749486448646],[-79.35093566576657,33.81549765646565],[-79.1024411170117,33.57204011511151],[-79.0041990861086,33.57204011511151],[-79.0851042880288,33.477638211321135],[-79.14289371797179,33.393173350035006],[-79.17178843294329,33.20685380308031],[-79.28736729282929,33.34100387688769],[-79.1891252619262,33.17207415431543],[-79.45495663966396,33.05779816551655],[-79.42028298169816,33.06276668676868],[-79.41450403870387,33.01556573487349],[-79.49540924062407,33.00066017111711],[-79.45495663966396,33.07270372927293],[-79.56475655655565,33.01804999549955],[-79.61676704350435,32.953459219221926],[-79.57631444254426,32.906258267326734],[-79.74390378937893,32.87147861856186],[-79.80169321932193,32.81434062416242],[-79.75546167536754,32.80937210291029],[-79.93460890819082,32.8019193210321],[-79.89415630723073,32.690127592859284],[-80.41426117671767,32.47151265776578],[-80.66853466846685,32.67025350785079]]],[[[-79.72078801740173,32.82676192729273],[-79.72656696039604,32.84663601230123],[-79.70345118841884,32.849120272927294],[-79.70345118841884,32.836698969796984],[-79.72078801740173,32.82676192729273]]],[[[-79.80747216231623,32.77459245414542],[-79.74968273237323,32.80937210291029],[-79.73812484638464,32.82676192729273],[-79.71500907440745,32.81434062416242],[-79.80747216231623,32.77459245414542]]],[[[-79.84792476327632,32.75471836913692],[-79.86526159225923,32.76713967226723],[-79.81325110531053,32.77459245414542],[-79.81903004830482,32.76713967226723],[-79.84792476327632,32.75471836913692]]],[[[-79.97506150915092,32.64044238033804],[-79.90571419321932,32.67522202910291],[-79.89415630723073,32.68764333223322],[-79.89993525022501,32.69758037473748],[-79.88837736423642,32.68764333223322],[-79.88837736423642,32.6826748109811],[-79.91727207920792,32.665284986598664],[-79.97506150915092,32.64044238033804]]]]}},{"type":"Feature","id":564,"properties":{"name":"dma:","latitude":38.376208,"dma":564,"dma1":"Charleston-Huntington, WV","longitude":-82.039491},"geometry":{"type":"Polygon","coordinates":[[[-83.19971169997,38.1704065339534],[-83.30373267386739,38.2101547039704],[-83.40197470477048,38.39150572967297],[-83.58112193759376,38.42876963906391],[-83.63891136753675,38.669742919791986],[-83.51177462166217,38.70203830793079],[-83.28639584488448,38.60018362226223],[-83.26905901590159,39.01505514681469],[-83.2112695859586,38.96040141304131],[-82.80674357635763,38.94798010991099],[-82.74895414641463,39.36782015571558],[-82.28663870687069,39.38520998009801],[-82.28085976387638,39.4721591020102],[-82.1652809039904,39.46719058075808],[-82.1595019609961,39.55662396329633],[-82.04970204410441,39.55165544204421],[-82.0554809870987,39.45973779887989],[-81.84743903930394,39.44980075637564],[-81.85321798229822,39.31813494319432],[-81.72030229342934,39.26844973067307],[-81.74919700840084,39.09455148684869],[-81.58160766156615,39.02499218931894],[-81.2984394548455,39.18646913001301],[-81.25220791089109,39.034929231823185],[-81.03260807710771,39.01257088618862],[-81.00371336213621,38.84612542424243],[-81.0557238490849,38.793955951095114],[-80.9863765331533,38.71694387168717],[-80.61074523852385,38.90574767926793],[-80.44315589168917,38.77159760546055],[-80.68009255445544,38.50329745784579],[-80.62808206750674,38.35424182028203],[-80.46049272067206,38.2499028739874],[-80.71476621242124,38.07848889078908],[-81.2290921389139,38.26232417711772],[-81.32733416981698,38.182827837083714],[-81.37934465676568,37.969181423242325],[-81.55849188958896,37.95427585948595],[-81.51803928862887,37.785346136913695],[-81.76075489438944,37.755535009400944],[-81.70296546444644,37.700881275627566],[-81.87055481128112,37.53692007430743],[-82.56402797059707,37.19657636853685],[-82.72583837443744,37.258682884188424],[-82.76051203240324,37.42512834613461],[-83.25750112991298,37.678522929993],[-83.26905901590159,37.767956312531254],[-83.1303643840384,37.89216934383438],[-82.96277503720373,37.90707490759076],[-83.02634341014101,38.008929593259325],[-83.26905901590159,38.068551848284834],[-83.19971169997,38.1704065339534]]]}},{"type":"Feature","id":517,"properties":{"name":"dma:","latitude":35.477172,"dma":517,"dma1":"Charlotte, NC","longitude":-80.76953},"geometry":{"type":"Polygon","coordinates":[[[-81.48914457365737,35.03030110261027],[-81.40823937173718,35.04520666636664],[-81.36778677077707,35.16445117641764],[-81.76653383738373,35.17935674017402],[-81.69140757845784,35.579322700970096],[-81.82432326732673,35.57435417971797],[-81.87055481128112,35.7184412960296],[-81.98613367116712,35.807874678567856],[-81.92256529822981,35.937056231123115],[-82.0323652151215,35.94202475237524],[-82.07859675907591,36.10101743244324],[-81.85321798229822,36.337022191919196],[-81.70874440744075,36.334537931293134],[-81.67984969246925,36.58793251515152],[-81.35044994179418,36.575511212021205],[-81.24642896789679,36.389191665066505],[-81.36200782778278,36.364349058805885],[-81.54693400360036,36.118407256825684],[-81.32733416981698,35.994194225522556],[-80.69165044044405,36.051332219921996],[-80.70898726942694,35.852591369836986],[-80.33335597479748,35.72092555665567],[-80.1079771980198,35.46007819091909],[-80.0501877680768,35.37064480838084],[-80.07330354005401,35.14209283078308],[-79.68033541644164,35.17687247954795],[-79.46073558265826,35.04272240574058],[-79.57053549954995,34.99303719321932],[-79.61676704350435,34.814170428142816],[-79.93460890819082,34.80423338563857],[-79.77857744734473,34.61542957805781],[-79.83058793429342,34.53096471677168],[-80.28712443084308,34.36700351545154],[-80.40848223372336,34.61542957805781],[-80.55295580858086,34.56077584428443],[-80.55873475157516,34.48873228612862],[-80.73788198439843,34.48127950425042],[-80.74366092739274,34.540901759275926],[-80.87657661626162,34.458921158615865],[-80.87657661626162,34.543386019901995],[-81.42557620072007,34.570712886788684],[-81.48914457365737,35.03030110261027]]]}},{"type":"Feature","id":584,"properties":{"name":"dma:","latitude":38.1802125,"dma":584,"dma1":"Charlottesville, VA","longitude":-78.4610955},"geometry":{"type":"Polygon","coordinates":[[[-78.33962064176418,38.62751048914892],[-78.085347150015,38.326914953395345],[-78.33962064176418,38.22009174647465],[-78.36851535673567,38.185312097709776],[-78.20670495289528,38.13314262456246],[-78.49565210261025,37.76298779127913],[-78.64590462046205,37.73317666376638],[-78.83660973927392,38.04867776327633],[-78.33962064176418,38.62751048914892]]]}},{"type":"Feature","id":575,"properties":{"name":"dma:","latitude":35.204094,"dma":575,"dma1":"Chattanooga, TN","longitude":-84.7884855},"geometry":{"type":"Polygon","coordinates":[[[-85.60375198559856,34.98558441134114],[-85.86380442034203,34.9880686719672],[-85.88692019231922,35.51721618531853],[-85.45927841074106,35.54702731283129],[-85.25701540594059,35.765642247924795],[-85.0316366291629,35.74576816291629],[-84.78314208040804,35.8252645029503],[-84.52886858865887,35.62900791349135],[-84.40173184278427,35.34331794149415],[-84.49419493069307,35.28617994709471],[-84.34394241284127,35.20419934643465],[-84.03187949114911,35.29114846834683],[-83.96831111821183,35.21910491019102],[-83.69092185448545,35.24394751645165],[-84.00298477617761,34.9880686719672],[-84.1763530660066,34.95328902320232],[-84.09544786408641,34.727221306230625],[-84.1879109519952,34.6030082749275],[-84.37283712781277,34.84398155565557],[-84.62133167656765,34.856402858785884],[-84.65600533453346,34.583134189918994],[-84.91605776927693,34.63530366306631],[-85.52862572667266,34.58810271117112],[-85.60375198559856,34.98558441134114]]]}},{"type":"Feature","id":759,"properties":{"name":"dma:","latitude":41.8048825,"dma":759,"dma1":"Cheyenne, WY-Scottsbluff, NE","longitude":-104.3206125},"geometry":{"type":"Polygon","coordinates":[[[-103.36244380708071,42.003620679968],[-103.368222750075,41.6980566229623],[-104.05013802340234,41.6980566229623],[-104.05591696639664,41.00246364766477],[-105.27527393819382,40.997495126412645],[-105.28105288118812,41.65582419231924],[-104.65114809480949,41.653339931693175],[-104.65692703780377,42.60978027272728],[-104.05013802340234,42.61226453335334],[-104.05013802340234,42.00113641934194],[-103.36244380708071,42.003620679968]]]}},{"type":"Feature","id":602,"properties":{"name":"dma:","latitude":41.615065,"dma":602,"dma1":"Chicago, IL","longitude":-87.8455645},"geometry":{"type":"Polygon","coordinates":[[[-86.98491936123612,40.913030265126515],[-86.98491936123612,40.838502446344634],[-87.10049822112211,40.838502446344634],[-87.10049822112211,40.73664776067607],[-87.52814000270027,40.73664776067607],[-87.52814000270027,41.009916429542955],[-88.2447289339934,40.99501086578658],[-88.2505078769877,41.11425537583759],[-88.93242315031503,41.1068025939594],[-88.93242315031503,40.927935828882894],[-89.04800201020102,40.92545156825683],[-89.04800201020102,41.10431833333334],[-89.163580870087,41.10431833333334],[-89.16935981308131,41.62849732543255],[-88.93820209330933,41.62849732543255],[-88.93820209330933,42.15267631753176],[-88.70704437353734,42.15267631753176],[-88.70704437353734,42.493020023302336],[-87.79975032343233,42.493020023302336],[-87.81130820942094,42.22968839693969],[-87.66683463456346,42.06075867436744],[-87.57437154665466,41.780037223622365],[-87.41834008580858,41.64091862856286],[-86.52260392169217,41.76016313861386],[-86.52260392169217,41.4322407359736],[-86.64396172457245,41.4322407359736],[-86.93290887428742,41.23598414651465],[-86.93290887428742,40.913030265126515],[-86.98491936123612,40.913030265126515]]]}},{"type":"Feature","id":868,"properties":{"name":"dma:","latitude":40.3359675,"dma":868,"dma1":"Chico-Redding, CA","longitude":-122.350166},"geometry":{"type":"Polygon","coordinates":[[[-123.40959705430542,41.17884615211521],[-122.94150267176717,40.99252660516052],[-122.89527112781278,41.027306253925396],[-122.95883950075007,41.181330412741275],[-122.802808039904,41.20368875837584],[-122.57165032013201,41.367649959695974],[-122.47918723222323,41.32044900780078],[-122.49652406120612,41.18381467336734],[-121.32917757635764,41.18381467336734],[-121.32917757635764,40.44598926742675],[-121.49676692319231,40.44598926742675],[-121.47365115121512,40.35158736363637],[-121.34073546234623,40.3093549329933],[-121.44475643624362,40.1901104229423],[-121.36963017731773,40.085771476647665],[-121.42741960726072,39.89945192969297],[-121.07490408460846,39.59637213331334],[-121.16158822952295,39.519360053905395],[-121.30606180438043,39.519360053905395],[-121.40430383528353,39.34049328882889],[-121.90707187578758,39.30322937943795],[-121.88973504680467,39.38272571947195],[-122.01109284968497,39.4125368469847],[-122.7392396669667,39.38272571947195],[-122.7334607239724,39.58146656955696],[-122.88371324182418,39.5789823089309],[-122.93572372877287,39.97894826972698],[-123.54251274317431,40.00130661536154],[-123.54251274317431,40.73416350005001],[-123.6234179450945,40.927935828882894],[-123.45004965526552,40.94284139263927],[-123.40959705430542,41.17884615211521]]]}},{"type":"Feature","id":515,"properties":{"name":"dma:","latitude":39.0338655,"dma":515,"dma1":"Cincinnati, OH","longitude":-84.357866},"geometry":{"type":"Polygon","coordinates":[[[-83.28639584488448,38.60018362226223],[-83.61579559555955,38.68464848354836],[-83.64469031053105,38.52565580348035],[-83.92785851725172,38.49336041534154],[-83.99720583318332,38.42131685718572],[-84.1705741230123,38.48590763346335],[-84.2052477809781,38.58279379787979],[-84.41328972877287,38.565403973497354],[-84.79469996639664,38.339336256525655],[-85.07786817311731,38.577825276627664],[-84.93917354125412,38.652353095409545],[-85.02585768616862,38.7616605629563],[-85.19922597599759,38.692101265426544],[-85.2050049189919,38.91320046114612],[-85.44772052475247,38.91320046114612],[-85.44194158175817,39.19640617251726],[-85.29746800690069,39.26844973067307],[-85.29746800690069,39.52432857515752],[-85.03741557215722,39.52681283578358],[-85.0316366291629,39.72803794649465],[-84.81203679537953,39.72555368586859],[-84.81781573837384,39.56656100580058],[-83.57534299459945,39.54420266016602],[-83.59267982358236,39.377757198219825],[-83.37307998979898,39.377757198219825],[-83.38463787578758,39.05480331683169],[-83.26905901590159,39.01505514681469],[-83.28639584488448,38.60018362226223]]]}},{"type":"Feature","id":598,"properties":{"name":"dma:","latitude":38.93329,"dma":598,"dma1":"Clarksburg-Weston, WV","longitude":-80.309074},"geometry":{"type":"Polygon","coordinates":[[[-81.0557238490849,38.793955951095114],[-81.00949230513052,38.97033845554556],[-81.25220791089109,39.034929231823185],[-81.32733416981698,39.149205220622065],[-81.29266051185118,39.223733039403946],[-81.22331319591959,39.308197900690075],[-80.93436604620462,39.390178501350135],[-80.88813450225022,39.293292336933696],[-80.71476621242124,39.42992667136714],[-80.51828215061505,39.434895192619265],[-80.42581906270627,39.64108882458246],[-80.14842979897989,39.606309175817586],[-79.89415630723073,39.434895192619265],[-79.83636687728773,39.24112286378638],[-79.28736729282929,39.18895339063907],[-79.32781989378938,38.98275975867587],[-79.51852501260126,38.89084211551155],[-79.59365127152715,38.66229013791379],[-79.78435639033904,38.736817956695674],[-79.86526159225923,38.550498409740975],[-80.35069280378038,38.34430477777778],[-80.36225068976898,38.225060267726775],[-80.66275572547255,38.41137981468147],[-80.68009255445544,38.50329745784579],[-80.44893483468346,38.749239259825984],[-80.47205060666067,38.83370412111211],[-80.66853466846685,38.893326376137615],[-80.9863765331533,38.71694387168717],[-81.0557238490849,38.793955951095114]]]}},{"type":"Feature","id":510,"properties":{"name":"dma:","latitude":41.0958885,"dma":510,"dma1":"Cleveland-Akron (Canton), OH","longitude":-81.71123},"geometry":{"type":"MultiPolygon","coordinates":[[[[-80.91702921722171,40.726710718171816],[-80.86501873027302,40.5552967349735],[-80.92280816021602,40.5552967349735],[-80.94014498919893,40.42363092179218],[-81.269544739874,40.43356796429643],[-81.33889205580559,40.214953029202924],[-81.62206026252625,40.22240581108111],[-81.61628131953195,40.3689771880188],[-81.71452335043504,40.371461448644865],[-81.70874440744075,40.44598926742675],[-82.1826177329733,40.455926309930994],[-82.176838789979,40.572686559355944],[-82.62181740054005,40.55032821372137],[-82.62759634353435,40.70932089378938],[-82.72583837443744,40.711805154415444],[-82.72583837443744,40.99501086578658],[-82.82985934833482,40.997495126412645],[-82.84719617731773,41.42975647534754],[-82.90498560726073,41.42975647534754],[-82.70272260246024,41.46453612411241],[-82.66227000150015,41.43472499659966],[-82.48890171167116,41.38007126282629],[-82.00924944314431,41.51670559725973],[-81.74341806540653,41.48937873037304],[-81.28110262586259,41.765131659865986],[-80.51828215061505,41.97629381308131],[-80.51828215061505,41.499315772877296],[-81.00371336213621,41.50180003350336],[-80.99793441914191,40.9875580839084],[-81.0846185640564,40.9875580839084],[-81.0846185640564,40.726710718171816],[-80.91702921722171,40.726710718171816]]],[[[-82.69694365946594,41.58378063416342],[-82.73739626042604,41.60365471917192],[-82.67382788748876,41.623528804180424],[-82.67960683048304,41.596201937293735],[-82.69694365946594,41.58378063416342]]],[[[-82.61603845754576,41.42975647534754],[-82.67382788748876,41.46205186348635],[-82.69694365946594,41.48937873037304],[-82.68538577347735,41.4918629909991],[-82.61603845754576,41.42975647534754]]]]}},{"type":"Feature","id":752,"properties":{"name":"dma:","latitude":38.061384,"dma":752,"dma1":"Colorado Springs-Pueblo, CO","longitude":-104.0271685},"geometry":{"type":"Polygon","coordinates":[[[-102.03906586138613,37.39034869736974],[-102.04484480438043,36.99286699719973],[-105.15391613531352,36.99535125782579],[-105.18281085028502,37.61641641434144],[-105.29838971017102,37.6586488449845],[-105.4948737719772,37.584121026202624],[-105.4313053990399,37.842484131313135],[-105.47753694299429,37.87974804070407],[-105.28105288118812,37.90210638633864],[-105.17125296429643,38.01886663576358],[-105.04989516141615,37.91452768946895],[-105.04989516141615,38.25735565586559],[-105.81849457965797,38.27474548024803],[-106.01497864146414,38.441190942194225],[-105.87628400960097,38.60018362226223],[-105.96874709750975,38.694585526052606],[-105.32728442514251,38.69706978667867],[-105.3330633681368,39.12933113561357],[-104.05013802340234,39.12933113561357],[-104.05591696639664,38.523171542854286],[-103.17173868826882,38.52565580348035],[-103.16018080228022,39.03741349244925],[-102.04484480438043,39.047350534953495],[-102.04484480438043,38.269776958995905],[-102.74409690669066,38.26729269836984],[-102.74987584968497,37.643743281228126],[-102.03906586138613,37.643743281228126],[-102.03906586138613,37.39034869736974]]]}},{"type":"Feature","id":546,"properties":{"name":"dma:","latitude":33.896366,"dma":546,"dma1":"Columbia, SC","longitude":-80.9102195},"geometry":{"type":"Polygon","coordinates":[[[-81.18863953795379,33.65402071577158],[-81.41401831473146,33.731032795179516],[-81.57004977557756,33.87263565086509],[-81.47180774467446,34.07634502220222],[-81.73186017941794,34.185652489748975],[-81.87055481128112,34.13596727722772],[-81.94568107020702,34.203042314131416],[-81.64517603450345,34.53344897739774],[-81.54115506060606,34.444015594859486],[-81.42557620072007,34.49370080738074],[-81.41979725772578,34.573197147414746],[-80.87657661626162,34.543386019901995],[-80.87657661626162,34.458921158615865],[-80.74366092739274,34.540901759275926],[-80.73788198439843,34.48127950425042],[-80.55873475157516,34.48873228612862],[-80.55295580858086,34.56077584428443],[-80.40848223372336,34.61542957805781],[-80.28134548784878,34.357066472947295],[-80.17732451395139,34.36700351545154],[-80.11375614101411,34.22788492039204],[-80.14842979897989,34.143420059105914],[-79.89415630723073,33.98691163966397],[-79.97506150915092,33.947163469646966],[-79.87681947824782,33.8850569539954],[-80.31024020282028,33.26399179747975],[-80.43737694869486,33.25902327622762],[-80.50094532163216,33.333551095009504],[-80.80145035733574,33.177042675567556],[-80.94592393219321,33.30870848874888],[-81.37356571377137,33.490059514451445],[-81.28688156885688,33.56458733323333],[-81.18863953795379,33.65402071577158]]]}},{"type":"Feature","id":604,"properties":{"name":"dma:","latitude":38.8629485,"dma":604,"dma1":"Columbia-Jefferson City, MO","longitude":-92.26804},"geometry":{"type":"Polygon","coordinates":[[[-91.44048440984099,39.31813494319432],[-91.41158969486949,39.14175243874388],[-91.26133717701771,39.13926817811782],[-91.26711612001199,38.84364116361637],[-91.41736863786377,38.84612542424243],[-91.41736863786377,38.709491089808985],[-91.64274741464146,38.70452256855686],[-91.63118952865287,38.05116202390239],[-92.51536780678067,38.02135089638964],[-92.64250455265525,38.212638964596465],[-93.00657796129613,38.185312097709776],[-93.07592527722773,38.25983991649165],[-93.04703056225623,38.97282271617162],[-92.85054650045004,39.23118582128213],[-93.2781882820282,39.45725353825383],[-93.2666303960396,39.703195340234025],[-92.68873609660966,39.6982268189819],[-92.69451503960396,39.61127769706971],[-92.3015469159916,39.606309175817586],[-92.31310480198019,39.347946070707074],[-91.44048440984099,39.31813494319432]]]}},{"type":"Feature","id":522,"properties":{"name":"dma:","latitude":32.2969995,"dma":522,"dma1":"Columbus, GA","longitude":-84.8353915},"geometry":{"type":"MultiPolygon","coordinates":[[[[-85.43038369576958,32.01440870257026],[-85.40726792379238,32.138621733873386],[-85.43616263876388,32.496355264026406],[-85.69621507350735,32.580820125312535],[-85.69621507350735,32.69758037473748],[-85.59219409960997,32.72739150225023],[-85.59219409960997,33.107483378037806],[-85.2338996339634,33.107483378037806],[-85.1818891470147,32.87147861856186],[-84.47685810171018,32.87644713981398],[-84.0549952631263,32.635473859085906],[-84.00298477617761,32.53113491279128],[-84.1127846930693,32.51374508840884],[-84.25147932493249,32.3969848389839],[-84.2572582679268,32.295130153315334],[-84.02610054815482,32.1709171220122],[-83.92207957425742,31.91255401690169],[-84.33816346984699,31.872805846884688],[-84.44218444374437,31.96720775067507],[-84.59821590459046,31.92000679877988],[-84.54620541764177,31.621895523652366],[-84.81781573837384,31.619411263026304],[-84.81781573837384,31.500166752975296],[-85.0316366291629,31.485261189218924],[-85.1529944320432,31.773435421842187],[-85.2165628049805,31.701391863686368],[-85.41882580978097,31.706360384938495],[-85.41882580978097,31.619411263026304],[-85.74822556045604,31.616927002400242],[-85.64998352955296,31.91255401690169],[-85.58641515661566,31.99701887818782],[-85.43038369576958,32.01440870257026]]],[[[-84.0549952631263,32.52119787028703],[-84.04921632013202,32.52119787028703],[-84.00876371917192,32.52119787028703],[-84.0145426621662,32.496355264026406],[-84.0549952631263,32.52119787028703]]]]}},{"type":"Feature","id":535,"properties":{"name":"dma:","latitude":39.9719715,"dma":535,"dma1":"Columbus, OH","longitude":-82.734151},"geometry":{"type":"Polygon","coordinates":[[[-83.88162697329733,40.81862836133614],[-83.49443779267926,40.81862836133614],[-83.49443779267926,40.701868111911196],[-83.44242730573058,40.686962548154824],[-83.11302755505551,40.701868111911196],[-83.11302755505551,40.99252660516052],[-82.72583837443744,40.99501086578658],[-82.72583837443744,40.711805154415444],[-82.62759634353435,40.70932089378938],[-82.62181740054005,40.55032821372137],[-82.176838789979,40.572686559355944],[-82.1826177329733,40.455926309930994],[-81.70874440744075,40.44598926742675],[-81.71452335043504,40.371461448644865],[-81.61628131953195,40.3689771880188],[-81.66829180648065,40.1503622529253],[-82.1883966759676,40.16775207730773],[-82.23462821992199,39.914357493449344],[-82.1595019609961,39.90938897219722],[-82.17105984698469,39.81995558965897],[-82.07859675907591,39.77027037713772],[-81.63939709150915,39.75288055275528],[-81.58738660456046,39.58643509080908],[-81.71452335043504,39.58395083018302],[-81.70874440744075,39.479611883888396],[-81.82432326732673,39.44980075637564],[-82.0554809870987,39.45973779887989],[-82.04970204410441,39.55165544204421],[-82.1595019609961,39.55662396329633],[-82.1652809039904,39.46719058075808],[-82.28085976387638,39.4721591020102],[-82.28663870687069,39.38520998009801],[-82.74895414641463,39.36782015571558],[-82.80674357635763,38.94798010991099],[-83.2112695859586,38.96040141304131],[-83.38463787578758,39.05480331683169],[-83.37307998979898,39.377757198219825],[-83.59267982358236,39.377757198219825],[-83.57534299459945,39.54420266016602],[-83.66780608250825,39.549171181418146],[-83.64469031053105,39.77275463776378],[-83.58690088058805,39.76778611651166],[-83.50599567866786,40.01124365786579],[-83.51755356465647,40.50809578307831],[-83.88162697329733,40.53293838933894],[-83.88162697329733,40.81862836133614]]]}},{"type":"Feature","id":673,"properties":{"name":"dma:","latitude":33.9623585,"dma":673,"dma1":"Columbus-Tupelo-West Point, MS","longitude":-88.939003},"geometry":{"type":"Polygon","coordinates":[[[-88.3429709648965,32.99072312861286],[-88.34874990789078,32.9286166129613],[-89.3196123309331,32.93110087358736],[-89.31383338793879,33.28635014311431],[-89.64323313861385,33.28635014311431],[-89.64901208160816,33.403110392539254],[-89.78770671347135,33.41553169566957],[-89.78770671347135,33.676379061406145],[-89.50453850675066,33.676379061406145],[-89.50453850675066,33.86766712961296],[-89.92640134533454,33.89747825712571],[-89.93218028832882,34.16329414411442],[-89.24448607200719,34.160809883488355],[-89.24448607200719,34.598039753675366],[-88.71860225952595,34.595555493049304],[-88.71860225952595,34.757032433743376],[-88.36608673687368,34.754548173117314],[-88.36608673687368,34.995521453845384],[-88.198497390039,34.995521453845384],[-88.10025535913591,34.89118250755076],[-88.2100552760276,34.058955197819785],[-87.95000284128412,34.02169128842884],[-87.94422389828983,33.52483916321633],[-88.2736236489649,33.534776205720576],[-88.3429709648965,32.99072312861286]]]}},{"type":"Feature","id":600,"properties":{"name":"dma:","latitude":27.6933695,"dma":600,"dma1":"Corpus Christi, TX","longitude":-97.8595055},"geometry":{"type":"MultiPolygon","coordinates":[[[[-98.95311030243025,26.78504008470847],[-98.95311030243025,27.26947090679068],[-98.79707884158415,27.266986646164618],[-98.80285778457846,28.056981525252525],[-98.33476340204021,28.056981525252525],[-98.33476340204021,28.61345590549055],[-98.09782673927393,28.787354149314933],[-98.00536365136513,28.69046798489849],[-97.77420593159316,28.668109639263925],[-97.69330072967297,28.541412347334735],[-97.44480618091809,28.402293752275227],[-97.3754588649865,28.38738818851885],[-97.16163797419742,28.553833650465045],[-96.76289090759076,28.424652097909792],[-96.86113293849385,28.41471505540554],[-96.79178562256226,28.32031315161516],[-96.91314342544254,28.13647786528653],[-96.90736448244824,28.151383429042905],[-96.93048025442545,28.124056562156216],[-96.95937496939693,28.121572301530154],[-96.96515391239123,28.126540822782278],[-96.91314342544254,28.27062793909391],[-96.97671179837984,28.131509344034402],[-97.02872228532853,28.151383429042905],[-97.00560651335132,28.19361585968597],[-97.02294334233423,28.20603716281628],[-97.25988000510051,28.07933987088709],[-97.15585903120312,28.04952874337434],[-97.18475374617461,27.970032403340333],[-97.12696431623162,28.059465785878587],[-97.01716439933993,28.104182477147717],[-97.19053268916892,27.82346102640264],[-97.2714378910891,27.883083281428142],[-97.55460609780978,27.87066197829783],[-97.3812378079808,27.835882329532954],[-97.36390097899789,27.73899616511651],[-97.24254317611761,27.691795213221322],[-97.3003326060606,27.627204436943693],[-97.4101325229523,27.324124640564058],[-97.50837455385539,27.274439428042804],[-97.53726926882688,27.28189220992099],[-97.54304821182117,27.284376470547056],[-97.47947983888389,27.34896724682468],[-97.4679219528953,27.455790453745376],[-97.49681666786678,27.46821175687569],[-97.56038504080408,27.408589501850184],[-97.47370089588958,27.39616819871987],[-97.61239552775277,27.284376470547056],[-97.68752178667867,27.40362098059806],[-97.76842698859886,27.45330619311931],[-97.65284812871286,27.304250555555555],[-97.77998487458746,27.279407949294928],[-97.42169040894089,27.26201812491249],[-97.50837455385539,27.088119881088108],[-97.47947983888389,26.998686498549855],[-97.56038504080408,26.998686498549855],[-97.57194292679267,26.98378093479348],[-97.52571138283828,26.881926249124913],[-97.58927975577558,26.8496308609861],[-97.47370089588958,26.75771321782178],[-97.44480618091809,26.598720537753774],[-97.98802682238224,26.61611036213621],[-97.98802682238224,26.780071563456346],[-98.95311030243025,26.78504008470847]],[[-96.94203814041404,28.255722375337534],[-96.93048025442545,28.268143678467847],[-96.94203814041404,28.258206635963596],[-96.94203814041404,28.255722375337534]]],[[[-96.98249074137414,28.124056562156216],[-96.99404862736273,28.12902508340834],[-96.99982757035704,28.131509344034402],[-96.97671179837984,28.126540822782278],[-96.98249074137414,28.124056562156216]]],[[[-97.04605911431143,27.838366590159016],[-97.05183805730573,27.85327215391539],[-96.97093285538554,27.96754814271427],[-96.98249074137414,27.98493796709671],[-96.96515391239123,28.019717615861587],[-96.86113293849385,28.059465785878587],[-97.04605911431143,27.838366590159016]]],[[[-97.07495382928292,27.84333511141114],[-97.08651171527153,27.85327215391539],[-97.08073277227723,27.863209196419643],[-97.06339594329432,27.845819372037205],[-97.07495382928292,27.84333511141114]]],[[[-97.16163797419742,27.676889649464947],[-97.18475374617461,27.696763734473446],[-97.16741691719172,27.731543383238325],[-97.13852220222022,27.73651190449045],[-97.06917488628862,27.828429547654764],[-97.10384854425442,27.830913808280826],[-97.04605911431143,27.83339806890689],[-97.16163797419742,27.676889649464947]]],[[[-97.20209057515751,27.614783133813383],[-97.19631163216322,27.684342431343133],[-97.17897480318032,27.68931095259526],[-97.16741691719172,27.674405388838885],[-97.20209057515751,27.614783133813383]]],[[[-97.28877472007201,26.601204798379836],[-97.39279569396939,26.862052164116413],[-97.39279569396939,27.20488013051305],[-97.35812203600359,27.371325592459247],[-97.22520634713472,27.587456266926694],[-97.25988000510051,27.657015564456444],[-97.20209057515751,27.614783133813383],[-97.3754588649865,27.10054118421842],[-97.28877472007201,26.601204798379836]]],[[[-97.44480618091809,27.115446747974797],[-97.45058512391239,27.12538379047905],[-97.44480618091809,27.12786805110511],[-97.44480618091809,27.152710657365738],[-97.44480618091809,27.115446747974797]]],[[[-97.47370089588958,26.968875371037104],[-97.47947983888389,27.001170759175917],[-97.45636406690669,27.00365501980198],[-97.45058512391239,26.988749456045603],[-97.47370089588958,26.968875371037104]]],[[[-97.3003326060606,26.601204798379836],[-97.3350062640264,26.626047404640463],[-97.346564150015,26.695606702170217],[-97.3176694350435,26.653374271527152],[-97.3003326060606,26.601204798379836]]]]}},{"type":"Feature","id":623,"properties":{"name":"dma:","latitude":32.702473,"dma":623,"dma1":"Dallas-Ft. Worth, TX","longitude":-97.098903},"geometry":{"type":"Polygon","coordinates":[[[-95.44529190489048,31.842994719371937],[-95.2719236150615,31.592084396139615],[-95.74001799759975,31.505135274227424],[-95.74001799759975,31.65419091179118],[-96.2370070951095,31.413217631063105],[-96.49705952985298,31.79579376747675],[-96.71665936363635,31.815667852485248],[-96.93048025442545,31.708844645564557],[-97.03450122832282,31.86286880438044],[-97.60661658475847,31.587115874887488],[-97.68752178667867,31.71132890619062],[-98.27119502910291,31.41570189168917],[-98.49079486288629,31.723750209320933],[-98.66994209570957,31.701391863686368],[-98.92421558745875,32.078999478847884],[-98.47345803390338,32.30009867456746],[-98.47345803390338,32.51374508840884],[-98.57747900780078,32.5162293490349],[-98.57747900780078,32.953459219221926],[-98.42722648994899,32.953459219221926],[-98.4214475469547,33.46770116881689],[-97.97646893639364,33.46770116881689],[-97.97646893639364,33.890025475247526],[-97.83199536153614,33.85773008710871],[-97.67018495769577,33.9918801609161],[-97.58927975577558,33.902446778377836],[-97.46214300990098,33.9049310390039],[-97.42746935193519,33.820466177717776],[-97.20786951815181,33.91486808150815],[-97.19053268916892,33.760843922692274],[-97.12696431623162,33.716127231423144],[-97.04605911431143,33.817981917091714],[-97.08651171527153,33.85524582648265],[-96.94203814041404,33.94964773027303],[-96.94203814041404,33.41553169566957],[-96.84379610951095,33.405594653165316],[-96.38725961296129,33.39814187128713],[-96.38148066996699,33.72606427392739],[-96.17921766516652,33.75835966206621],[-96.14454400720072,33.83785600210021],[-95.93650205940594,33.887541214621464],[-95.76891271257125,33.845308783978396],[-95.59554442274228,33.94219494839484],[-95.54353393579358,33.88008843274328],[-95.3123762160216,33.88008843274328],[-95.30659727302731,32.963396261726174],[-95.66489173867387,32.96091200110011],[-95.59554442274228,32.478965439643964],[-95.44529190489048,32.352268147714774],[-95.49152344884487,32.23302363766377],[-95.42795507590759,32.01689296319632],[-95.44529190489048,31.842994719371937]]]}},{"type":"Feature","id":682,"properties":{"name":"dma:","latitude":41.5680725,"dma":682,"dma1":"Davenport, IA-Rock Island-Moline, IL","longitude":-90.4412815},"geometry":{"type":"Polygon","coordinates":[[[-91.48671595379537,41.16145632773278],[-91.48671595379537,41.424787954095414],[-91.3711370939094,41.42230369346935],[-91.36535815091509,41.5986861979198],[-90.89726376837683,41.596201937293735],[-90.89726376837683,42.294279173217326],[-90.66610604860486,42.294279173217326],[-90.66610604860486,42.38122829512952],[-90.47540092979298,42.38122829512952],[-90.64299027662766,42.50792558705871],[-89.92640134533454,42.505441326432646],[-89.92062240234023,42.19739300880089],[-89.68946468256826,42.19987726942695],[-89.63167525262526,41.58378063416342],[-89.16935981308131,41.58626489478948],[-89.163580870087,41.310511965296534],[-89.46408590579057,41.23349988588859],[-89.46408590579057,41.14903502460247],[-89.63745419561957,41.14903502460247],[-89.63745419561957,41.23349988588859],[-89.86861191539154,41.23349988588859],[-89.86861191539154,41.14903502460247],[-89.98419077527753,41.14903502460247],[-89.98419077527753,40.711805154415444],[-90.44650621482148,40.714289415041506],[-90.44650621482148,40.62734029312932],[-91.1862109180918,40.63727733563357],[-91.11108465916591,40.69689959065907],[-91.39425286588659,40.80869131883189],[-91.71787367356735,40.813659840084014],[-91.71787367356735,41.16394058835884],[-91.48671595379537,41.16145632773278]]]}},{"type":"Feature","id":542,"properties":{"name":"dma:","latitude":40.1392235,"dma":542,"dma1":"Dayton, OH","longitude":-84.3547855},"geometry":{"type":"Polygon","coordinates":[[[-84.81781573837384,39.56656100580058],[-84.81203679537953,39.72555368586859],[-85.187668090009,39.71561664336434],[-85.19922597599759,40.003790875987605],[-84.81203679537953,40.003790875987605],[-84.80047890939093,40.729194978797885],[-83.88162697329733,40.644730117511756],[-83.88162697329733,40.53293838933894],[-83.51755356465647,40.50809578307831],[-83.50599567866786,40.01124365786579],[-83.58690088058805,39.76778611651166],[-83.64469031053105,39.77275463776378],[-83.66780608250825,39.549171181418146],[-84.81781573837384,39.56656100580058]]]}},{"type":"Feature","id":751,"properties":{"name":"dma:","latitude":40.9981425,"dma":751,"dma1":"Denver, CO","longitude":-108.925452},"geometry":{"type":"MultiPolygon","coordinates":[[[[-106.01497864146414,43.49417705560556],[-106.02653652745275,44.99467047374738],[-105.09034776237624,44.9996389949995],[-105.07878987638763,43.499145576857686],[-106.01497864146414,43.49417705560556]]],[[[-109.04892371347134,40.99997938703871],[-107.91625088658866,41.00246364766477],[-107.92780877257725,41.66079271357136],[-107.5117248769877,41.6583084529453],[-107.5232827629763,42.43339776827683],[-105.5584421449145,42.43091350765077],[-105.61623157485748,42.30421621572158],[-105.3735159690969,42.2893106519652],[-105.28105288118812,42.43091350765077],[-105.28683182418241,42.604811751475154],[-104.89386370057005,42.60978027272728],[-104.89964264356435,43.499145576857686],[-104.05591696639664,43.50411409810982],[-104.05013802340234,42.61226453335334],[-104.65692703780377,42.60978027272728],[-104.65114809480949,41.653339931693175],[-105.28105288118812,41.65582419231924],[-105.27527393819382,40.997495126412645],[-104.05591696639664,41.00246364766477],[-104.05013802340234,41.3924925659566],[-102.63429698979897,41.439693517851794],[-102.67474959075908,42.006104940594064],[-102.06796057635763,42.008589201220126],[-102.06796057635763,41.74277331423143],[-101.98705537443743,41.74277331423143],[-101.98705537443743,41.39497682658266],[-101.27046644314431,41.39497682658266],[-101.24735067116711,41.00494790829083],[-102.05062374737474,41.00494790829083],[-102.04484480438043,39.047350534953495],[-103.16018080228022,39.03741349244925],[-103.17173868826882,38.52565580348035],[-104.05591696639664,38.523171542854286],[-104.05013802340234,39.12933113561357],[-105.3330633681368,39.12933113561357],[-105.32728442514251,38.69706978667867],[-105.96874709750975,38.694585526052606],[-105.87628400960097,38.60018362226223],[-106.01497864146414,38.441190942194225],[-105.81849457965797,38.27474548024803],[-105.04989516141615,38.25735565586559],[-105.04989516141615,37.91452768946895],[-105.17125296429643,38.01886663576358],[-105.28105288118812,37.90210638633864],[-105.47753694299429,37.89216934383438],[-105.4313053990399,37.842484131313135],[-105.48331588598859,37.57666824432444],[-105.75492620672067,37.345632006100615],[-105.77226303570356,37.045036470347036],[-105.72025254875487,36.99535125782579],[-107.4828301620162,37.00031977907791],[-107.4828301620162,37.638774759976],[-107.97404031653164,37.638774759976],[-107.85846145664566,37.77540909440944],[-107.99137714551455,37.85738969506951],[-109.04314477047704,37.882232301330134],[-109.04314477047704,38.15301670957096],[-107.94514560156016,38.15301670957096],[-107.93936665856586,38.22009174647465],[-108.13007177737774,38.33188347464747],[-107.5001669909991,38.30207234713472],[-107.5001669909991,38.669742919791986],[-108.37856632613261,38.667258659165924],[-108.37856632613261,38.82873559985999],[-108.14162966336633,38.90574767926793],[-107.97981925952595,39.05977183808381],[-107.71976682478248,39.064740359335936],[-107.37880918811881,39.26844973067307],[-107.4654933330333,39.31565068256826],[-107.43081967506751,39.365335895089515],[-109.04892371347134,39.36782015571558],[-109.04892371347134,40.99997938703871]]],[[[-103.36244380708071,42.003620679968],[-103.4433490090009,42.09056980188019],[-103.5069173819382,42.99980919101911],[-102.79032845064506,42.99980919101911],[-102.69786536273627,42.003620679968],[-103.36244380708071,42.003620679968]]],[[[-116.6020022070207,39.161626523752375],[-116.5846653780378,40.99997938703871],[-116.15702359645964,40.99997938703871],[-116.15702359645964,40.667088463146314],[-116.00099213561356,40.12800390729073],[-115.82184490279028,40.12055112541255],[-115.81606595979598,39.593887872687276],[-115.90852904770477,39.46470632013202],[-115.90852904770477,39.161626523752375],[-116.6020022070207,39.161626523752375]]],[[[-102.74987584968497,37.643743281228126],[-102.74409690669066,38.26729269836984],[-102.04484480438043,38.269776958995905],[-102.03906586138613,37.643743281228126],[-102.74987584968497,37.643743281228126]]]]}},{"type":"Feature","id":679,"properties":{"name":"dma:","latitude":41.8822865,"dma":679,"dma1":"Des Moines-Ames, IA","longitude":-93.6950785},"geometry":{"type":"Polygon","coordinates":[[[-94.46865053885388,40.9006089619962],[-94.46865053885388,41.07202294519452],[-94.46865053885388,41.156487806480655],[-94.69980825862586,41.15897206710672],[-94.69980825862586,41.50428429412942],[-95.04076589528952,41.50428429412942],[-95.04076589528952,41.60117045854586],[-95.09277638223821,41.60117045854586],[-95.09277638223821,42.2098143119312],[-94.85583971947194,42.2098143119312],[-94.91362914941493,42.91037580848085],[-94.44553476687668,42.90789154785479],[-94.44553476687668,43.501629837483755],[-93.97166144134414,43.499145576857686],[-93.97166144134414,42.90789154785479],[-93.02391479027902,42.90789154785479],[-93.00079901830182,42.2098143119312],[-92.76964129852985,42.2098143119312],[-92.76386235553555,41.86201782428243],[-92.2957679729973,41.86201782428243],[-92.2957679729973,41.509252815381544],[-92.41134683288328,41.509252815381544],[-92.41134683288328,41.16145632773278],[-92.64250455265525,41.16145632773278],[-92.63672560966097,40.59007638373838],[-93.37643031293129,40.58013934123413],[-93.3648724269427,40.26712250235024],[-93.76361949354936,40.26463824172418],[-93.77517737953795,40.57765508060807],[-94.91362914941493,40.575170819982006],[-94.93096597839784,40.9006089619962],[-94.46865053885388,40.9006089619962]]]}},{"type":"Feature","id":505,"properties":{"name":"dma:","latitude":42.7069935,"dma":505,"dma1":"Detroit, MI","longitude":-83.2883905},"geometry":{"type":"MultiPolygon","coordinates":[[[[-83.48287990669067,41.73283627172718],[-83.76026917041705,41.722899229222925],[-83.77182705640564,42.08311702000201],[-84.1301215220522,42.07317997749776],[-84.1590162370237,42.776225734673474],[-83.68514291149114,42.78367851655166],[-83.69092185448545,42.87062763846385],[-83.45398519171917,42.875596159715975],[-83.45976413471347,43.233329689868995],[-83.34996421782178,43.23581395049506],[-83.35574316081608,43.32276307240724],[-83.1014696690669,43.327731593659365],[-83.11880649804979,43.67552808130814],[-82.60448057155716,43.690433645064516],[-82.41955439573957,42.97496658475848],[-82.51779642664266,42.62717009710971],[-82.72583837443744,42.68182383088309],[-82.88186983528352,42.493020023302336],[-82.89342772127213,42.38619681638164],[-83.0783538970897,42.31415325822583],[-83.14192227002701,42.24210970007001],[-83.19971169997,42.08560128062807],[-83.18815381398139,42.03343180748075],[-83.37885893279328,41.894313212421245],[-83.42509047674767,41.740289053605366],[-83.44820624872487,41.78997426612662],[-83.48287990669067,41.73283627172718]]],[[[-82.63915422952294,42.594874708970906],[-82.67382788748876,42.60978027272728],[-82.58714374257426,42.617233054605464],[-82.60448057155716,42.59735896959697],[-82.63915422952294,42.594874708970906]]],[[[-82.60448057155716,42.550158017701776],[-82.66804894449444,42.572516363336334],[-82.60448057155716,42.594874708970906],[-82.59292268556855,42.61226453335334],[-82.52357536963696,42.6147487939794],[-82.60448057155716,42.550158017701776]]],[[[-82.67382788748876,42.575000623962396],[-82.65649105850585,42.594874708970906],[-82.63915422952294,42.592390448344844],[-82.65649105850585,42.57996914521453],[-82.67382788748876,42.575000623962396]]],[[[-82.67960683048304,42.535252453945404],[-82.65071211551154,42.560095060206024],[-82.64493317251726,42.560095060206024],[-82.66804894449444,42.537736714571466],[-82.67960683048304,42.535252453945404]]],[[[-83.00322763816382,42.334027343234325],[-82.97433292319232,42.351417167616766],[-82.95121715121512,42.348932906990704],[-82.96277503720373,42.33899586448645],[-83.00322763816382,42.334027343234325]]],[[[-83.1650380420042,42.08808554125413],[-83.17659592799279,42.122865190019006],[-83.14192227002701,42.20236153005301],[-83.1361433270327,42.1303179718972],[-83.1650380420042,42.08808554125413]]],[[[-83.1534801560156,42.09056980188019],[-83.1534801560156,42.09553832313232],[-83.14770121302129,42.09553832313232],[-83.1534801560156,42.09056980188019]]],[[[-83.1534801560156,42.09056980188019],[-83.1534801560156,42.08560128062807],[-83.1592590990099,42.08560128062807],[-83.1592590990099,42.09056980188019],[-83.1534801560156,42.09056980188019]]],[[[-83.48287990669067,41.73283627172718],[-83.47132202070208,41.737804792979304],[-83.46554307770776,41.74277331423143],[-83.47132202070208,41.73283627172718],[-83.48287990669067,41.73283627172718]]],[[[-83.45398519171917,41.73283627172718],[-83.46554307770776,41.73283627172718],[-83.45976413471347,41.740289053605366],[-83.45398519171917,41.740289053605366],[-83.45398519171917,41.73283627172718]]]]}},{"type":"Feature","id":606,"properties":{"name":"dma:","latitude":31.2429535,"dma":606,"dma1":"Dothan, AL","longitude":-85.412413},"geometry":{"type":"Polygon","coordinates":[[[-85.00274191419142,31.000830367136714],[-86.1874252280228,30.99337758525853],[-86.1469726270627,31.616927002400242],[-85.41882580978097,31.619411263026304],[-85.41882580978097,31.706360384938495],[-85.2165628049805,31.701391863686368],[-85.1529944320432,31.773435421842187],[-85.0316366291629,31.485261189218924],[-84.79469996639664,31.500166752975296],[-84.78892102340234,31.43557597669767],[-84.63866850555056,31.43309171607161],[-84.64444744854485,31.256709211621164],[-84.91605776927693,31.256709211621164],[-84.92183671227122,31.07287392529253],[-84.73113159345934,31.070389664666468],[-84.77158419441943,30.836869165816584],[-84.86404728232823,30.712656134513452],[-85.00274191419142,31.000830367136714]]]}},{"type":"Feature","id":676,"properties":{"name":"dma:","latitude":47.169647,"dma":676,"dma1":"Duluth, MN-Superior, WI","longitude":-91.7104225},"geometry":{"type":"MultiPolygon","coordinates":[[[[-92.02993659525953,45.64057823652366],[-92.04727342424242,46.157304446744675],[-92.2957679729973,46.157304446744675],[-92.289989030003,46.418151812481256],[-93.05280950525052,46.418151812481256],[-93.05280950525052,46.157304446744675],[-93.43421974287429,46.15482018611861],[-93.42844079987998,46.246737829282935],[-93.80985103750375,46.249222089909],[-93.77517737953795,47.30254859535954],[-94.02945087128712,47.35223380788079],[-94.09301924422442,47.478931099809984],[-94.41664005190519,47.44415145104511],[-94.42819793789378,48.701187327832784],[-93.83874575247525,48.62914376967697],[-93.78673526552654,48.51486778087809],[-93.25507251005101,48.64156507280728],[-92.95456747434743,48.631628030303034],[-92.63672560966097,48.54219464776478],[-92.71185186858685,48.462698307730776],[-92.45757837683769,48.41301309520953],[-92.37089423192319,48.21924076637664],[-92.2668732580258,48.249051893889394],[-92.2610943150315,48.35587510081009],[-92.05305236723672,48.35835936143615],[-91.96058927932793,48.234146330133015],[-91.56184221272127,48.107449038203825],[-91.56762115571557,48.0428582619262],[-91.26711612001199,48.077637910691074],[-90.88570588238824,48.24656763326333],[-90.75279019351936,48.09005921382139],[-90.14600117911792,48.11241755945595],[-89.89750663036304,47.98820452815282],[-89.49298062076207,48.005594352535255],[-90.77590596549655,47.60562839173918],[-91.46360018181818,47.13113461216122],[-92.08772602520253,46.7932751670167],[-92.16863122712272,46.716263087608766],[-92.09928391119112,46.74855847574758],[-91.99526293729372,46.67899917821782],[-91.79299993249325,46.69390474197421],[-90.85681116741674,46.96220488958896],[-90.75279019351936,46.88767707080709],[-90.94349531233124,46.587081535053514],[-90.70077970657066,46.669062135713574],[-90.75856913651364,46.70632604510452],[-90.43494832883289,46.56223892879288],[-89.86283297239723,46.76594830013002],[-89.86283297239723,46.59205005630564],[-89.74147516951695,46.59205005630564],[-89.74147516951695,46.50510093439344],[-89.36584387488749,46.50510093439344],[-89.36584387488749,46.333686951195126],[-88.99021258025803,46.333686951195126],[-88.99021258025803,46.09768219171917],[-89.92640134533454,46.29890730243025],[-89.92640134533454,45.98092194229423],[-90.67766393459345,45.98092194229423],[-90.67766393459345,45.63809397589759],[-92.02993659525953,45.64057823652366]],[[-92.04727342424242,46.713778826982704],[-92.05883131023103,46.72123160886089],[-92.06461025322531,46.72123160886089],[-92.05305236723672,46.713778826982704],[-92.04727342424242,46.713778826982704]]],[[[-90.96083214131413,46.96220488958896],[-90.98394791329133,46.98456323522353],[-90.93193742634263,47.00195305960597],[-90.93193742634263,46.96468915021502],[-90.96083214131413,46.96220488958896]]],[[[-90.85681116741674,46.97711045334534],[-90.87414799639964,46.98456323522353],[-90.87992693939394,46.99201601710172],[-90.85103222442244,46.98456323522353],[-90.85681116741674,46.97711045334534]]],[[[-90.79902173747374,46.969657671467154],[-90.80480068046805,46.972141932093216],[-90.78746385148514,46.97711045334534],[-90.78746385148514,46.969657671467154],[-90.79902173747374,46.969657671467154]]],[[[-90.78168490849085,46.75352699699971],[-90.61987450465045,46.872771507050714],[-90.56786401770177,46.84792890079008],[-90.67766393459345,46.8206020339034],[-90.78168490849085,46.75352699699971]]],[[[-92.01837870927093,46.70632604510452],[-92.02993659525953,46.70881030573058],[-92.05883131023103,46.73116865136514],[-92.09350496819681,46.77836960326033],[-92.01837870927093,46.70632604510452]]]]}},{"type":"Feature","id":765,"properties":{"name":"dma:","latitude":31.840946,"dma":765,"dma1":"El Paso, TX","longitude":-105.6619505},"geometry":{"type":"Polygon","coordinates":[[[-104.98054784548455,30.628191273227323],[-105.21748450825082,30.80705803830383],[-105.4024106840684,30.85177472957296],[-105.95141026852684,31.363532418541855],[-106.20568376027603,31.467871364836483],[-106.4195046510651,31.751077076207622],[-107.29790398619862,31.783372464346435],[-107.29790398619862,32.779560975397544],[-106.88759903360335,32.779560975397544],[-106.33859944914491,33.05282964426443],[-106.379052050105,32.00198739943995],[-104.02702225142514,31.999503138813882],[-104.10214851035103,31.105169313431343],[-104.98054784548455,30.628191273227323]]]}},{"type":"Feature","id":565,"properties":{"name":"dma:","latitude":42.0595215,"dma":565,"dma1":"Elmira, NY","longitude":-77.1441155},"geometry":{"type":"Polygon","coordinates":[[[-76.92955855115511,42.00113641934194],[-76.87176912121211,41.596201937293735],[-76.95845326612661,41.551485246024605],[-77.59991593849385,41.54154820352036],[-77.61147382448245,41.99865215871587],[-77.75016845634563,41.99865215871587],[-77.72127374137413,42.535252453945404],[-77.14337944194419,42.577484884588465],[-77.14337944194419,42.4955042839284],[-76.96423220912091,42.45824037453745],[-76.90066383618361,42.463208895789585],[-76.9122217221722,42.54270523582359],[-76.69262188838883,42.547673757075714],[-76.69262188838883,42.28434213071307],[-76.53659042754276,42.28185787008701],[-76.55970619951995,42.00113641934194],[-76.92955855115511,42.00113641934194]]]}},{"type":"Feature","id":516,"properties":{"name":"dma:","latitude":41.8794375,"dma":516,"dma1":"Erie, PA","longitude":-79.717601},"geometry":{"type":"Polygon","coordinates":[[[-79.76124061836182,42.2694365669567],[-79.76124061836182,41.99865215871587],[-78.91751494119413,41.99865215871587],[-78.91751494119413,41.83965947864787],[-78.95796754215422,41.623528804180424],[-79.83058793429342,41.62104454355436],[-79.99817728112811,41.48937873037304],[-80.51828215061505,41.48937873037304],[-80.51828215061505,41.97629381308131],[-79.76124061836182,42.2694365669567]]]}},{"type":"Feature","id":801,"properties":{"name":"dma:","latitude":43.6937855,"dma":801,"dma1":"Eugene, OR","longitude":-123.1256445},"geometry":{"type":"Polygon","coordinates":[[[-124.47870150825082,42.95509249974998],[-124.38623842034202,43.330215854285434],[-124.32267004740474,43.35008993929394],[-124.33422793339334,43.31779455115512],[-124.30533321842184,43.28549916301631],[-124.24176484548454,43.42461775807581],[-124.21864907350735,43.37990106680668],[-124.16663858655865,43.36251124242425],[-124.18975435853585,43.471818709971004],[-124.23020695949594,43.46933444934494],[-124.23598590249024,43.432070539954],[-124.27643850345034,43.41964923682369],[-124.32267004740474,43.360026981798185],[-124.33422793339334,43.35505846054606],[-124.34578581938193,43.360026981798185],[-124.20131224452444,43.66559103880388],[-124.11462809960996,44.27671915281529],[-123.77367046294628,44.284171934693475],[-123.8141230639064,44.34379418971898],[-123.7158810330033,44.36118401410141],[-123.7216599759976,44.43322757225723],[-123.594523230123,44.43322757225723],[-123.60030217311731,44.72140180488049],[-123.14954461956195,44.72140180488049],[-123.07441836063606,44.65929528922893],[-123.25934453645364,44.55992486418643],[-123.16688144854486,44.199707073407346],[-122.90682901380137,44.199707073407346],[-122.86637641284128,44.2891404559456],[-122.38094520132013,44.2096441159116],[-121.79149301590158,44.24690802530253],[-121.77415618691869,44.09039960586059],[-121.97641919171917,43.856879107010705],[-121.96486130573057,43.628327129412945],[-122.14978748154815,43.52150392249226],[-121.97641919171917,43.26065655675568],[-122.07466122262225,43.0668842279228],[-122.28270317041704,43.0668842279228],[-122.28270317041704,42.99732493039305],[-122.56009243414341,42.94018693599361],[-122.79702909690968,42.778709995299536],[-123.23044982148214,42.70169791589159],[-123.7158810330033,42.73896182528253],[-123.7794494059406,42.801068340934094],[-124.13196492859285,42.66691826712672],[-124.14352281458146,42.848269292829286],[-124.21864907350735,42.932734154115415],[-124.47870150825082,42.95509249974998]]]}},{"type":"Feature","id":802,"properties":{"name":"dma:","latitude":41.001389,"dma":802,"dma1":"Eureka, CA","longitude":-123.908896},"geometry":{"type":"MultiPolygon","coordinates":[[[[-123.54251274317431,40.00130661536154],[-124.07417549864986,40.0236649609961],[-124.36312264836484,40.257185459845985],[-124.40935419231923,40.43853648554856],[-124.32844899039904,40.614918989999005],[-124.23598590249024,40.756521845684574],[-124.25910167446744,40.69689959065907],[-124.08573338463846,40.83104966446645],[-124.15508070057005,40.86334505260527],[-124.20131224452444,40.781364451945194],[-124.23598590249024,40.76645888818882],[-124.12040704260426,40.9875580839084],[-124.16663858655865,41.12916093959396],[-124.06261761266126,41.442177778477856],[-124.14930175757576,41.7179307079708],[-124.25332273147315,41.77010018111812],[-124.21287013051305,41.99865215871587],[-123.51939697119711,42.00113641934194],[-123.70432314701469,41.82972243614362],[-123.6580916030603,41.71296218671868],[-123.7216599759976,41.596201937293735],[-123.61186005910591,41.46205186348635],[-123.6638705460546,41.38255552345235],[-123.47894437023702,41.3726184809481],[-123.40959705430542,41.17884615211521],[-123.45004965526552,40.94284139263927],[-123.6234179450945,40.927935828882894],[-123.54251274317431,40.73416350005001],[-123.54251274317431,40.00130661536154]]],[[[-124.17819647254726,40.80869131883189],[-124.16663858655865,40.81862836133614],[-124.15508070057005,40.81862836133614],[-124.15508070057005,40.816144100710076],[-124.17819647254726,40.80869131883189]]],[[[-124.16663858655865,40.80869131883189],[-124.16085964356435,40.813659840084014],[-124.15508070057005,40.81117557945795],[-124.16085964356435,40.80869131883189],[-124.16663858655865,40.80869131883189]]]]}},{"type":"Feature","id":649,"properties":{"name":"dma:","latitude":37.8233245,"dma":649,"dma1":"Evansville, IN","longitude":-87.5662395},"geometry":{"type":"Polygon","coordinates":[[[-87.85176081038104,37.318305139213926],[-87.79975032343233,37.38289591549155],[-88.14070796009601,37.586605286828686],[-88.1580447890789,37.66610162686269],[-88.03090804320432,37.800251700670074],[-88.0886974731473,37.82261004630463],[-88.03090804320432,37.83751561006101],[-88.13492901710171,37.91701195009502],[-88.371865679868,37.90955916821682],[-88.371865679868,38.254871395239526],[-88.70126543054306,38.25735565586559],[-88.70126543054306,38.60515214351435],[-87.64949780558055,38.567888234123416],[-87.74196089348935,38.413864075307536],[-87.42411902880288,38.54056136723673],[-86.68441432553254,38.52565580348035],[-86.67863538253826,38.26232417711772],[-86.45903554875488,38.20767044334434],[-86.43014083378338,38.07848889078908],[-86.67863538253826,37.79279891879188],[-86.57461440864085,37.55182563806381],[-86.66707749654965,37.54934137743775],[-86.60928806660667,37.39531721862186],[-86.81733001440143,37.328242181718174],[-86.93868781728173,37.13695411351135],[-86.89245627332733,37.089753161616166],[-87.11783505010501,37.045036470347036],[-87.25075073897389,37.04006794909491],[-87.33165594089408,37.156828198519854],[-87.52236105970597,37.10465872537254],[-87.67839252055205,37.14937541664167],[-87.79975032343233,37.27855696919692],[-87.85176081038104,37.318305139213926]]]}},{"type":"Feature","id":724,"properties":{"name":"dma:","latitude":47.659799,"dma":724,"dma1":"Fargo-Valley City, ND","longitude":-97.1383975},"geometry":{"type":"Polygon","coordinates":[[[-99.00512078937894,45.94117377227723],[-99.03401550435044,46.629313965696575],[-99.45009939993999,46.63179822632264],[-99.47899411491149,47.327391201620166],[-99.2651732241224,47.327391201620166],[-99.2998468820882,47.84660167246725],[-99.81417280858085,47.84660167246725],[-99.84884646654665,48.020499916291634],[-99.84884646654665,48.37078066456647],[-99.4905520009001,48.37078066456647],[-99.52522565886588,48.9992986029603],[-95.15634475517551,48.9992986029603],[-95.15056581218121,49.384359],[-94.81538711851185,49.31976822372238],[-94.68825037263726,48.778199407240734],[-94.42819793789378,48.701187327832784],[-94.42819793789378,48.3682964039404],[-95.20835524212421,48.365812143314336],[-95.21413418511851,48.53971038713872],[-95.60132336573658,48.53971038713872],[-95.58976547974797,48.020499916291634],[-95.2314710141014,48.020499916291634],[-95.27770255805581,47.92112949124913],[-95.19101841314131,47.87144427872788],[-95.14478686918692,46.10761923422343],[-96.265901810081,46.10761923422343],[-96.265901810081,46.02067011231124],[-96.57796473177318,46.02067011231124],[-96.56062790279027,45.93620525102511],[-99.00512078937894,45.94117377227723]]]}},{"type":"Feature","id":513,"properties":{"name":"dma:","latitude":43.643882,"dma":513,"dma1":"Flint-Saginaw-Bay City, MI","longitude":-83.847331},"geometry":{"type":"Polygon","coordinates":[[[-83.32106950285029,44.512723912291236],[-83.33262738883889,44.33634140784079],[-83.53489039363936,44.251876546554655],[-83.57534299459945,44.04816717521753],[-83.84117437233724,43.99599770207021],[-83.90474274527452,43.91898562266227],[-83.95675323222322,43.759992942594266],[-83.84695331533153,43.64074843254326],[-83.68514291149114,43.58112617751776],[-83.32684844584458,43.884205973897394],[-83.33262738883889,43.90408005890589],[-83.39619576177617,43.90656431953196],[-83.40775364776476,43.91153284078408],[-83.40775364776476,43.91650136203621],[-82.96277503720373,44.068041260226025],[-82.74317520342035,43.99102918081809],[-82.60448057155716,43.71030773007301],[-83.11880649804979,43.67552808130814],[-83.1014696690669,43.327731593659365],[-83.35574316081608,43.32276307240724],[-83.34996421782178,43.23581395049506],[-83.45976413471347,43.233329689868995],[-83.45398519171917,42.875596159715975],[-83.69092185448545,42.87062763846385],[-83.68514291149114,42.78367851655166],[-84.36127924182418,42.776225734673474],[-84.36705818481849,43.119053701070115],[-84.83515256735674,43.119053701070115],[-84.84671045334534,43.46685018871888],[-85.0836471161116,43.46685018871888],[-85.0894260591059,43.814646676367644],[-84.60399484758476,43.814646676367644],[-84.60977379057906,44.15995890339035],[-84.36705818481849,44.15995890339035],[-84.36705818481849,44.50775539103911],[-83.32106950285029,44.512723912291236]]]}},{"type":"Feature","id":866,"properties":{"name":"dma:","latitude":36.846642,"dma":866,"dma1":"Fresno-Visalia, CA","longitude":-119.613123},"geometry":{"type":"Polygon","coordinates":[[[-120.67037807500749,36.13828134183419],[-120.5952518160816,36.48856209010901],[-121.21937765946595,36.91088639653965],[-121.24827237443743,37.089753161616166],[-120.96510416771677,37.345632006100615],[-120.98244099669967,37.40028573987399],[-120.38720986828683,37.63380623872388],[-120.39298881128113,37.683491451245125],[-120.31208360936094,37.653680323732374],[-120.34097832433243,37.72572388188819],[-120.08092588958895,37.827578567556756],[-119.80931556885689,37.755535009400944],[-119.53770524812481,37.9045906469647],[-119.26031598439843,37.72572388188819],[-119.12162135253524,37.73317666376638],[-119.01760037863787,37.584121026202624],[-118.79800054485449,37.48723486178618],[-118.6650848559856,37.15434393789379],[-118.43970607920792,37.059942034103415],[-118.36457982028202,36.69227146144615],[-118.09874844254425,36.346959234423444],[-117.98316958265826,35.86749693359336],[-118.00628535463547,35.78800059355936],[-120.21384157845785,35.79048485418542],[-120.32364149534953,35.909729364236426],[-120.67037807500749,36.13828134183419]]]}},{"type":"Feature","id":571,"properties":{"name":"dma:","latitude":26.5720265,"dma":571,"dma1":"Ft. Myers-Naples, FL","longitude":-81.6230635},"geometry":{"type":"MultiPolygon","coordinates":[[[[-82.25774399189919,26.944032764776477],[-82.25774399189919,27.030981886688668],[-82.0554809870987,27.030981886688668],[-82.0554809870987,27.33903020432043],[-81.56427083258325,27.341514464946496],[-81.56427083258325,27.03346614731473],[-81.269544739874,27.03346614731473],[-81.1713027089709,27.209848651765178],[-80.94592393219321,27.209848651765178],[-80.87079767326733,27.14774213611361],[-80.87079767326733,25.806241398039802],[-81.34467099879987,25.80375713741374],[-81.65095497749775,25.932938689968996],[-81.80120749534953,26.08944710941094],[-81.85321798229822,26.444696378937895],[-82.01502838613861,26.48692880958096],[-82.00924944314431,26.521708458345834],[-81.92834424122412,26.544066803980396],[-81.77809172337234,26.70802800530053],[-82.0323652151215,26.52667697959796],[-82.061259930093,26.951485546654666],[-82.2057335049505,26.961422589158914],[-82.1595019609961,26.857083642864286],[-82.1479440750075,26.790008605960594],[-82.1595019609961,26.780071563456346],[-82.1595019609961,26.82230399409941],[-82.28085976387638,26.817335472847283],[-82.33864919381938,26.894347552255226],[-82.31553342184219,26.8695049459946],[-82.29819659285928,26.894347552255226],[-82.35598602280228,26.94651702540254],[-82.25774399189919,26.944032764776477]],[[-81.99191261416141,26.491897330833083],[-81.99191261416141,26.494381591459145],[-81.99769155715572,26.491897330833083],[-81.99191261416141,26.491897330833083]]],[[[-82.37332285178518,26.94651702540254],[-82.36176496579657,26.93657998289829],[-82.36176496579657,26.924158679767977],[-82.34442813681369,26.896831812881288],[-82.37332285178518,26.94651702540254]]],[[[-82.35598602280228,26.92664294039404],[-82.36176496579657,26.9291272010201],[-82.35598602280228,26.934095722272225],[-82.35598602280228,26.92664294039404]]],[[[-82.26352293489349,26.717965047804782],[-82.26930187788778,26.787524345334532],[-82.28085976387638,26.809882690969097],[-82.26352293489349,26.79497712721272],[-82.26930187788778,26.79249286658666],[-82.25774399189919,26.742807654065405],[-82.25196504890488,26.747776175317533],[-82.26352293489349,26.717965047804782]]],[[[-82.25774399189919,26.75771321782178],[-82.26352293489349,26.76268173907391],[-82.2461861059106,26.772618781578156],[-82.2461861059106,26.76268173907391],[-82.25774399189919,26.75771321782178]]],[[[-82.25774399189919,26.75771321782178],[-82.25774399189919,26.750260435943595],[-82.25774399189919,26.75522895719572],[-82.26352293489349,26.75771321782178],[-82.25774399189919,26.75771321782178]]],[[[-82.22307033393339,26.611141840884088],[-82.22884927692769,26.633500186518653],[-82.24040716291628,26.645921489648963],[-82.25774399189919,26.67821687778778],[-82.25196504890488,26.70802800530053],[-82.22307033393339,26.611141840884088]]],[[[-82.1652809039904,26.695606702170217],[-82.176838789979,26.70057522342234],[-82.17105984698469,26.70554374467447],[-82.1479440750075,26.703059484048403],[-82.1652809039904,26.70554374467447],[-82.1652809039904,26.695606702170217]]],[[[-82.0843757020702,26.48941307020702],[-82.1826177329733,26.68070113841384],[-82.1595019609961,26.703059484048403],[-82.06703887308731,26.611141840884088],[-82.0843757020702,26.48941307020702]]],[[[-82.0728178160816,26.628531665266525],[-82.07859675907591,26.633500186518653],[-82.07859675907591,26.635984447144715],[-82.07859675907591,26.638468707770777],[-82.06703887308731,26.63101592589259],[-82.0728178160816,26.628531665266525],[-82.0728178160816,26.6235631440144],[-82.0728178160816,26.626047404640463],[-82.0728178160816,26.628531665266525]]],[[[-82.0728178160816,26.628531665266525],[-82.06703887308731,26.628531665266525],[-82.06703887308731,26.626047404640463],[-82.0728178160816,26.628531665266525]]],[[[-82.19995456195619,26.55648810711071],[-82.22307033393339,26.588783495249523],[-82.22307033393339,26.606173319631964],[-82.2057335049505,26.58629923462346],[-82.19995456195619,26.55648810711071]]],[[[-82.07859675907591,26.42233803330333],[-82.176838789979,26.47202324582458],[-82.1826177329733,26.476991767076708],[-82.1883966759676,26.491897330833083],[-82.19995456195619,26.551519585858586],[-82.1826177329733,26.47947602770277],[-82.01502838613861,26.454633421442143],[-82.07859675907591,26.42233803330333]]],[[[-82.061259930093,26.494381591459145],[-82.061259930093,26.49935011271127],[-82.06703887308731,26.501834373337335],[-82.0554809870987,26.496865852085207],[-82.061259930093,26.494381591459145]]],[[[-81.95146001320131,26.467054724572456],[-81.93990212721272,26.464570463946394],[-81.93990212721272,26.457117682068205],[-81.95146001320131,26.457117682068205],[-81.95146001320131,26.467054724572456]]],[[[-81.88789164026403,26.40246394829483],[-81.89367058325833,26.404948208920892],[-81.90522846924692,26.42482229392939],[-81.96301789918991,26.454633421442143],[-81.96879684218422,26.45960194269427],[-81.96879684218422,26.464570463946394],[-81.96301789918991,26.45960194269427],[-81.92834424122412,26.44966490019002],[-81.91678635523553,26.437243597059705],[-81.90522846924692,26.43227507580758],[-81.88789164026403,26.40246394829483]]],[[[-81.87055481128112,26.377621342034203],[-81.88211269726972,26.39501116641664],[-81.88211269726972,26.407432469546954],[-81.86477586828683,26.39252690579058],[-81.87055481128112,26.377621342034203]]],[[[-81.85321798229822,26.360231517651766],[-81.86477586828683,26.36520003890389],[-81.86477586828683,26.37513708140814],[-81.86477586828683,26.377621342034203],[-81.85321798229822,26.360231517651766]]],[[[-81.67407074947494,25.900643301830183],[-81.72608123642364,25.90809608370837],[-81.74919700840084,25.952812774977495],[-81.74341806540653,25.967718338733874],[-81.67407074947494,25.900643301830183]]]]}},{"type":"Feature","id":670,"properties":{"name":"dma:","latitude":35.5031505,"dma":670,"dma1":"Ft. Smith-Fayetteville-Springdale-Rogers, AR","longitude":-94.202877},"geometry":{"type":"Polygon","coordinates":[[[-93.69427217761776,35.76812650855086],[-93.71160900660065,35.37561332963297],[-93.43421974287429,35.42778280278028],[-93.42266185688568,35.32841237773778],[-93.2781882820282,35.31847533523353],[-93.2781882820282,35.211652128312835],[-93.70583006360636,35.13464004890489],[-93.71160900660065,34.744611130613066],[-93.87919835343534,34.66511479057906],[-94.45709265286528,34.72970556685669],[-94.46287159585958,34.50860637113712],[-94.93674492139213,34.50612211051105],[-94.93674492139213,34.68002035433543],[-95.05810272427243,34.68002035433543],[-95.05810272427243,34.85391859815982],[-94.92518703540354,34.94335198069807],[-94.92518703540354,35.20171508580859],[-94.81538711851185,35.20171508580859],[-94.81538711851185,35.32344385648565],[-95.08699743924393,35.46256245154515],[-95.12745004020402,35.6389449559956],[-94.47442948184818,35.6389449559956],[-94.61890305670568,36.49849913261326],[-93.86764046744673,36.49849913261326],[-93.86764046744673,36.307211064406445],[-93.65959851965196,36.30224254315432],[-93.58447226072607,36.15567116621662],[-93.44577762886288,36.08114334743475],[-93.52090388778878,35.76315798729873],[-93.69427217761776,35.76812650855086]]]}},{"type":"Feature","id":509,"properties":{"name":"dma:","latitude":41.0334615,"dma":509,"dma1":"Ft. Wayne, IN","longitude":-85.1430895},"geometry":{"type":"Polygon","coordinates":[[[-84.39595289978998,40.684478287528755],[-84.80047890939093,40.729194978797885],[-84.80625785238524,40.3093549329933],[-85.2165628049805,40.30687067236724],[-85.19922597599759,40.56771803810381],[-85.44772052475247,40.56771803810381],[-85.44772052475247,40.654667160016004],[-85.93893067926793,40.65218289938994],[-85.94470962226222,41.042211817681775],[-85.68465718751875,41.0471803389339],[-85.65576247254725,41.524158379137916],[-85.1934470330033,41.52664263976398],[-85.19922597599759,41.76016313861386],[-84.80625785238524,41.76016313861386],[-84.80625785238524,41.253373970897094],[-84.34394241284127,41.20865727962797],[-84.34394241284127,40.99004234453446],[-84.40173184278427,40.99004234453446],[-84.33816346984699,40.858376531353144],[-84.39595289978998,40.684478287528755]]]}},{"type":"Feature","id":592,"properties":{"name":"dma:","latitude":29.4735495,"dma":592,"dma1":"Gainesville, FL","longitude":-82.7294775},"geometry":{"type":"MultiPolygon","coordinates":[[[[-82.75473308940894,29.001000563156317],[-82.80674357635763,29.16744602510251],[-83.05523812511251,29.1748988069807],[-83.05523812511251,29.239489583258326],[-83.11880649804979,29.31650166266627],[-83.14192227002701,29.323954444544455],[-83.1534801560156,29.31650166266627],[-83.1650380420042,29.323954444544455],[-83.2228274719472,29.425809130213022],[-83.39619576177617,29.517726773377337],[-83.40775364776476,29.666782410941096],[-83.32106950285029,29.823290830383037],[-82.89342772127213,29.825775091009103],[-82.78940674737473,29.935082558555855],[-82.65071211551154,29.825775091009103],[-82.52357536963696,29.945019601060107],[-82.1306072460246,29.83571213351335],[-82.04970204410441,29.733857447844784],[-82.0554809870987,29.440714693969397],[-82.40799650975097,29.485431385238524],[-82.40221756675668,29.2146469769977],[-82.53513325562557,29.2146469769977],[-82.53513325562557,29.045717254425444],[-82.75473308940894,29.001000563156317]]],[[[-83.1245854410441,29.276753492649267],[-83.1592590990099,29.294143317031704],[-83.14192227002701,29.321470183918393],[-83.11302755505551,29.296627577657766],[-83.1245854410441,29.276753492649267]]],[[[-83.03212235313532,29.150056200720073],[-83.03212235313532,29.155024721972197],[-83.02634341014101,29.15750898259826],[-83.02634341014101,29.155024721972197],[-83.03212235313532,29.150056200720073]]],[[[-83.0379012961296,29.135150636963697],[-83.04368023912392,29.14757194009401],[-83.05523812511251,29.13763489758976],[-83.04945918211821,29.15750898259826],[-83.0379012961296,29.135150636963697]]],[[[-83.03212235313532,29.150056200720073],[-83.03212235313532,29.14011915821582],[-83.0379012961296,29.142603418841883],[-83.03212235313532,29.150056200720073]]],[[[-83.05523812511251,29.127697855085508],[-83.04945918211821,29.13763489758976],[-83.0379012961296,29.14011915821582],[-83.04945918211821,29.132666376337635],[-83.05523812511251,29.127697855085508]]],[[[-83.0667960111011,29.095402466946695],[-83.07257495409542,29.097886727572757],[-83.0783538970897,29.10037098819882],[-83.0610170681068,29.10285524882488],[-83.0667960111011,29.095402466946695]]],[[[-83.03212235313532,29.095402466946695],[-83.03212235313532,29.097886727572757],[-83.02634341014101,29.095402466946695],[-83.03212235313532,29.095402466946695]]],[[[-83.03212235313532,29.095402466946695],[-83.0379012961296,29.095402466946695],[-83.03212235313532,29.097886727572757],[-83.03212235313532,29.095402466946695]]]]}},{"type":"Feature","id":798,"properties":{"name":"dma:","latitude":46.836368,"dma":798,"dma1":"Glendive, MT","longitude":-105.065505},"geometry":{"type":"Polygon","coordinates":[[[-105.96296815451545,47.18081982468247],[-105.96296815451545,47.09387070277028],[-105.88784189558956,47.09387070277028],[-105.83005246564656,47.09387070277028],[-105.83583140864086,47.18081982468247],[-105.40818962706271,47.18081982468247],[-105.3619580831083,47.78946367806781],[-105.23482133723373,47.79194793869388],[-105.23482133723373,47.70251455615562],[-104.98054784548455,47.70251455615562],[-104.98054784548455,47.61556543424343],[-104.59335866486649,47.61556543424343],[-104.59335866486649,47.52861631233124],[-104.5124534629463,47.52861631233124],[-104.5124534629463,47.354718068506855],[-104.4199903750375,47.354718068506855],[-104.448885090009,47.31745415911592],[-104.33908517311731,47.2454106009601],[-104.30441151515151,47.04170122962297],[-104.4315482610261,46.89016133143315],[-104.60491655085508,46.8603502039204],[-104.60491655085508,46.68396769946995],[-104.04435908040804,46.64173526882689],[-104.04435908040804,45.88155151725173],[-104.13682216831683,45.88155151725173],[-104.13682216831683,45.96850063916392],[-104.391095660066,45.97098489978998],[-104.391095660066,46.05544976107611],[-104.5182324059406,46.05544976107611],[-104.5182324059406,46.13743036173618],[-104.88808475757575,46.13743036173618],[-104.90542158655865,46.48274258875888],[-104.73205329672967,46.48274258875888],[-104.73205329672967,46.611924141314134],[-104.98632678847885,46.53988058315832],[-105.4486422280228,46.56969171067107],[-105.4890948289829,46.659125093209326],[-105.57577897389739,46.659125093209326],[-105.61623157485748,46.83302333703371],[-106.08432595739573,46.8603502039204],[-106.08432595739573,47.18081982468247],[-105.96296815451545,47.18081982468247]]]}},{"type":"Feature","id":773,"properties":{"name":"dma:","latitude":38.425681,"dma":773,"dma1":"Grand Junction-Montrose, CO","longitude":-108.2153545},"geometry":{"type":"MultiPolygon","coordinates":[[[[-109.04892371347134,39.36782015571558],[-107.43081967506751,39.365335895089515],[-107.4654933330333,39.31565068256826],[-107.37880918811881,39.26844973067307],[-107.71976682478248,39.064740359335936],[-107.97981925952595,39.05977183808381],[-108.14162966336633,38.90574767926793],[-108.37856632613261,38.82873559985999],[-108.37856632613261,38.667258659165924],[-107.5001669909991,38.669742919791986],[-107.5001669909991,38.30207234713472],[-108.13007177737774,38.33188347464747],[-107.93936665856586,38.22009174647465],[-107.94514560156016,38.15301670957096],[-109.04314477047704,38.15301670957096],[-109.04892371347134,39.36782015571558]]],[[[-109.04314477047704,37.882232301330134],[-108.25720852325233,37.89465360446045],[-108.21097697929793,37.82012578567857],[-107.99137714551455,37.85738969506951],[-107.86424039963995,37.755535009400944],[-107.97404031653164,37.638774759976],[-108.91600802460246,37.631321978097816],[-109.04314477047704,37.484750601160115],[-109.04314477047704,37.882232301330134]]]]}},{"type":"Feature","id":563,"properties":{"name":"dma:","latitude":42.7892405,"dma":563,"dma1":"Grand Rapids-Kalamazoo-Battle Creek, MI","longitude":-85.624075},"geometry":{"type":"Polygon","coordinates":[[[-85.78867816141613,41.76016313861386],[-85.76556238943894,42.06821145624563],[-86.2220988859886,42.07069571687169],[-86.2220988859886,42.24459396069607],[-86.36657246084607,42.24210970007001],[-86.24521465796579,42.48805150205021],[-86.210541,42.86317485658566],[-86.25677254395438,43.09172683418342],[-86.53994075067507,43.6183900869087],[-86.43014083378338,43.81961519761977],[-85.56329938463847,43.814646676367644],[-85.56329938463847,43.46933444934494],[-84.84671045334534,43.46685018871888],[-84.83515256735674,42.77125721342135],[-85.07208923012301,42.77125721342135],[-85.07786817311731,42.59735896959697],[-85.07208923012301,42.42097646514652],[-84.71957370747074,42.42097646514652],[-84.70801582148215,42.07069571687169],[-84.82359468136814,42.07317997749776],[-84.82359468136814,41.76016313861386],[-85.78867816141613,41.76016313861386]]]}},{"type":"Feature","id":755,"properties":{"name":"dma:","latitude":47.838823,"dma":755,"dma1":"Great Falls, MT","longitude":-109.9362935},"geometry":{"type":"Polygon","coordinates":[[[-111.78814269276927,46.915003937693776],[-111.78814269276927,47.12865035153516],[-112.04241618451844,47.19324112781278],[-112.04819512751274,47.51619500920093],[-112.28513179027902,47.50625796669668],[-112.55096316801679,47.652829343634366],[-112.85724714671467,47.63047099799981],[-112.98438389258925,47.953424879387946],[-112.88036291869187,47.97826748564857],[-112.98438389258925,48.119870341334135],[-113.23287844134413,48.16955555385539],[-113.23865738433844,48.24656763326333],[-113.38890990219022,48.34096953705371],[-113.35423624422442,48.42295013771378],[-113.481372990099,48.45276126522653],[-113.46981510411041,48.54716316901691],[-113.75298331083108,48.6142382059206],[-113.70097282388238,48.71609289158917],[-113.75876225382538,48.81794757725773],[-114.00147785958596,48.83285314101411],[-114.07082517551754,48.9992986029603],[-106.11322067236723,48.9992986029603],[-106.15367327332733,48.82291609850986],[-106.02075758445844,48.82291609850986],[-106.02075758445844,48.562068732773284],[-105.80693669366937,48.564552993399346],[-105.84161035163515,48.010562873787386],[-106.39638887908791,48.06521660756076],[-106.4195046510651,47.95839340064007],[-106.5004098529853,47.95839340064007],[-106.61020976987699,47.7770423749375],[-106.91649374857485,47.67270342864287],[-107.65619845184519,47.652829343634366],[-107.86424039963995,47.456572754175426],[-107.97981925952595,47.58575430673068],[-108.31499795319532,47.583270046104616],[-108.31499795319532,47.314969898489856],[-108.71952396279627,47.270253207220726],[-108.73686079177918,47.09883922402241],[-108.60972404590458,47.09883922402241],[-108.63283981788179,46.74855847574758],[-109.81752313171317,46.69390474197421],[-110.05445979447944,46.74855847574758],[-110.46476474707471,46.67899917821782],[-110.75949083978398,46.900098373937396],[-111.08311164746475,47.00940584148415],[-111.08311164746475,47.08890218151816],[-111.15823790639064,47.08890218151816],[-111.15823790639064,47.011890102110215],[-111.5396481440144,46.999468798979905],[-111.5396481440144,46.91251967706771],[-111.66100594689469,46.91251967706771],[-111.78814269276927,46.915003937693776]]]}},{"type":"Feature","id":658,"properties":{"name":"dma:","latitude":44.7644785,"dma":658,"dma1":"Green Bay-Appleton, WI","longitude":-88.2017},"geometry":{"type":"MultiPolygon","coordinates":[[[[-89.59700159465946,43.98109213831384],[-89.59700159465946,44.24690802530253],[-89.2271492430243,44.24442376467647],[-89.22137030003,45.02945012251226],[-88.98443363726372,45.02945012251226],[-88.98443363726372,45.118883505050505],[-88.64347600060006,45.11639924442444],[-88.67814965856586,45.379730870787085],[-88.42965510981098,45.37724661016102],[-88.42387616681668,45.722558837183726],[-88.0598027581758,45.71262179467948],[-87.99623438523852,45.79460239533954],[-87.69572934953496,45.722558837183726],[-87.69572934953496,45.89894134163417],[-87.61482414761477,45.89894134163417],[-87.61482414761477,45.98589046354636],[-87.36632959885989,45.98589046354636],[-87.3258769978998,45.551144853985406],[-87.2680875679568,45.538723550855096],[-87.59748731863186,45.151178893189325],[-87.63216097659766,44.97728064936494],[-87.84020292439243,44.93256395809581],[-88.04824487218721,44.55992486418643],[-87.92688706930693,44.535082257925794],[-87.58015048964896,44.853067618061814],[-87.43567691479149,44.89281578807881],[-87.38366642784278,44.83319353305331],[-87.40678219981999,44.91268987308732],[-87.2391928529853,45.16856871757176],[-87.1698455370537,45.15366315381539],[-87.06004562016201,45.29775027012702],[-86.97336147524751,45.24309653635364],[-87.04270879117911,45.22819097259726],[-87.04848773417342,45.08907237753776],[-87.1236139930993,45.066714031903196],[-87.46457162976297,44.5549563429343],[-87.54547683168317,44.32143584408441],[-87.51080317371736,44.19225429152915],[-87.64371886258625,44.10530516961697],[-87.73040300750074,43.89165875577558],[-88.16382373207321,43.89165875577558],[-88.16382373207321,43.543862268126816],[-88.40076039483948,43.543862268126816],[-88.40076039483948,43.63081139003901],[-89.24448607200719,43.643232693169324],[-89.24448607200719,43.76744572447245],[-89.16935981308131,43.76496146384639],[-89.16935981308131,43.9835763989399],[-89.59700159465946,43.98109213831384]]],[[[-86.83466684338433,45.40208921642164],[-86.82888790039004,45.42941608330834],[-86.81155107140714,45.42196330143015],[-86.80577212841284,45.40705773767377],[-86.83466684338433,45.40208921642164]]],[[[-86.87511944434443,45.33004565826583],[-86.92135098829883,45.35488826452646],[-86.95602464626462,45.34246696139614],[-86.93868781728173,45.42196330143015],[-86.84044578637864,45.39712069516952],[-86.87511944434443,45.33004565826583]]],[[[-86.89823521632164,45.295266009500956],[-86.93290887428742,45.33252991889189],[-86.93290887428742,45.33998270077008],[-86.89823521632164,45.3126558338834],[-86.89823521632164,45.295266009500956]]],[[[-86.94446676027601,45.30271879137914],[-86.95602464626462,45.305203052005204],[-86.96180358925892,45.3126558338834],[-86.95024570327033,45.3126558338834],[-86.94446676027601,45.30271879137914]]],[[[-87.3258769978998,45.15614741444145],[-87.37788748484849,45.178505760076014],[-87.37788748484849,45.19837984508452],[-87.33743488388839,45.21080114821483],[-87.3258769978998,45.15614741444145]]]]}},{"type":"Feature","id":518,"properties":{"name":"dma:","latitude":35.994693,"dma":518,"dma1":"Greensboro-High Point-Winston Salem, NC","longitude":-80.4077355},"geometry":{"type":"Polygon","coordinates":[[[-81.67984969246925,36.58793251515152],[-81.54115506060606,36.7022085039504],[-81.0441659630963,36.80654745024503],[-80.83612401530152,36.558121387638764],[-80.61074523852385,36.558121387638764],[-80.59340840954096,36.662460333933396],[-80.48938743564356,36.650039030803086],[-80.34491386078608,36.833874317131716],[-80.07330354005401,36.846295620262026],[-80.05596671107111,36.54321582388239],[-79.1371147749775,36.54073156325633],[-79.1544516039604,36.24262028812882],[-79.25847257785779,36.24262028812882],[-79.23535680588058,35.8451385879588],[-79.54164078457845,35.84265432733274],[-79.55319867056706,35.51473192469247],[-79.77279850435043,35.51224766406641],[-79.61676704350435,35.16445117641764],[-80.07330354005401,35.14209283078308],[-80.0501877680768,35.37064480838084],[-80.1079771980198,35.46007819091909],[-80.33335597479748,35.72092555665567],[-80.70898726942694,35.852591369836986],[-80.69165044044405,36.051332219921996],[-81.32733416981698,35.994194225522556],[-81.54693400360036,36.118407256825684],[-81.36200782778278,36.364349058805885],[-81.24642896789679,36.389191665066505],[-81.35044994179418,36.575511212021205],[-81.67984969246925,36.58793251515152]]]}},{"type":"Feature","id":545,"properties":{"name":"dma:","latitude":35.342169,"dma":545,"dma1":"Greenville-New Bern-Washington, NC","longitude":-76.9754245},"geometry":{"type":"MultiPolygon","coordinates":[[[[-78.200926009901,34.73715834873487],[-78.16625235193519,35.18929378267827],[-77.83107365826582,35.17687247954795],[-77.82529471527153,35.57186991909191],[-77.35142138973897,35.82029598169817],[-77.40921081968196,35.99916274677468],[-77.23006358685868,36.10350169306931],[-77.29941090279027,36.20784063936394],[-76.73307448934892,36.24262028812882],[-76.72151660336033,35.937056231123115],[-76.16673807590759,35.994194225522556],[-76.01070661506151,35.95693031613162],[-76.07427498799879,35.922150667366736],[-76.1089486459646,35.951961794879495],[-76.1205065319532,35.951961794879495],[-76.1262854749475,35.94699327362736],[-76.06849604500451,35.909729364236426],[-76.01070661506151,35.922150667366736],[-76.03960133003301,35.68366164726473],[-76.1262854749475,35.681177386638666],[-75.90090669816982,35.668756083508356],[-75.88356986918691,35.57435417971797],[-76.1494012469247,35.32841237773778],[-76.35166425172517,35.41536149964997],[-76.34588530873087,35.34828646274627],[-76.40367473867386,35.34828646274627],[-76.39789579567957,35.43275132403241],[-76.52503254155415,35.395487414641465],[-76.58860091449145,35.50727914281428],[-76.48457994059406,35.50479488218822],[-76.44990628262826,35.554480094709476],[-76.62905351545155,35.51970044594459],[-76.57126408550855,35.38803463276328],[-77.0740321260126,35.51970044594459],[-76.9700111521152,35.43523558465847],[-76.48457994059406,35.311022553355336],[-76.49035888358836,35.21910491019102],[-76.54814831353136,35.24394751645165],[-76.59437985748575,35.238978995199524],[-76.51925359855986,35.20668360706071],[-76.52503254155415,35.184325261426146],[-76.61171668646864,35.22158917081708],[-76.61171668646864,35.17935674017402],[-76.63483245844584,35.17438821892189],[-76.65216928742873,35.19923082518252],[-76.65794823042305,35.20419934643465],[-76.66950611641164,35.20419934643465],[-76.77352709030903,35.13464004890489],[-76.53659042754276,35.14954561266127],[-76.80242180528052,34.96571032633263],[-76.98734798109811,35.06508075137514],[-77.0335795250525,35.137124309530954],[-77.0740321260126,35.15202987328733],[-77.0740321260126,35.16196691579158],[-77.0855900120012,35.16445117641764],[-76.96423220912091,34.99303719321932],[-76.76196920432042,34.916025113811386],[-76.78508497629763,34.89366676817682],[-76.76196920432042,34.86137138003801],[-76.70417977437744,34.955773283828385],[-76.68684294539455,34.898635289428945],[-76.62905351545155,34.89615102880288],[-76.63483245844584,34.9880686719672],[-76.51925359855986,34.88869824692469],[-76.58282197149714,34.9880686719672],[-76.50191676957695,34.95328902320232],[-76.43834839663967,35.05762796949695],[-76.46724311161117,34.96322606570657],[-76.43834839663967,34.90360381068107],[-76.40367473867386,34.96322606570657],[-76.40945368166817,34.93589919881988],[-76.31121165076507,34.90608807130713],[-76.40367473867386,34.88621398629863],[-76.51347465556555,34.71976852435244],[-76.60593774347434,34.78932782188219],[-76.65216928742873,34.712315742474246],[-76.72151660336033,34.799264864386444],[-76.77930603330333,34.754548173117314],[-76.69262188838883,34.71480000310031],[-76.90644277917792,34.73218982748275],[-77.09136895499549,34.67256757245725],[-77.0740321260126,34.712315742474246],[-77.1029268409841,34.71728426372638],[-77.1144847269727,34.742126869987004],[-77.1087057839784,34.75206391249125],[-77.1144847269727,34.754548173117314],[-77.1549373279328,34.77193799749975],[-77.12026366996699,34.687473136213626],[-77.21850570087008,34.652693487448744],[-77.31674773177318,34.54835454115412],[-77.40343187668768,34.585618450545056],[-77.31674773177318,34.63281940244025],[-77.39765293369337,34.71728426372638],[-77.36297927572757,34.72473704560456],[-77.35142138973897,34.73467408810881],[-77.43232659165916,34.75206391249125],[-77.36875821872187,34.640272184318434],[-77.44966342064205,34.612945317431745],[-77.36297927572757,34.543386019901995],[-77.53056862256226,34.4564368979898],[-77.68082114041404,34.71976852435244],[-78.1142418649865,34.7222527849785],[-78.200926009901,34.73715834873487]]],[[[-76.72729554635464,36.24262028812882],[-76.72151660336033,36.24262028812882],[-76.72729554635464,36.2301989849985],[-76.72729554635464,36.24262028812882]]],[[[-76.0049276720672,35.06508075137514],[-75.98181190009001,35.12221874577458],[-75.76221206630663,35.196746564556456],[-75.9644750711071,35.09986040014002],[-76.0049276720672,35.06508075137514]]],[[[-75.75065418031804,35.18929378267827],[-75.75643312331232,35.194262303930394],[-75.75065418031804,35.194262303930394],[-75.75065418031804,35.18929378267827]]],[[[-76.06849604500451,35.067565012001204],[-76.0569381590159,35.070049272627266],[-76.0511592160216,35.06508075137514],[-76.06849604500451,35.05762796949695],[-76.06849604500451,35.067565012001204]]],[[[-76.06849604500451,35.067565012001204],[-76.07427498799879,35.06508075137514],[-76.07427498799879,35.067565012001204],[-76.06849604500451,35.07253353325333],[-76.06849604500451,35.067565012001204]]],[[[-76.1262854749475,35.00048997509751],[-76.1262854749475,35.00297423572357],[-76.0511592160216,35.052659448244825],[-76.04538027302729,35.05514370887089],[-76.0511592160216,35.070049272627266],[-76.03960133003301,35.06259649074907],[-76.03960133003301,35.05514370887089],[-76.1262854749475,35.00048997509751]]],[[[-76.07427498799879,35.05514370887089],[-76.0800539309931,35.05514370887089],[-76.0858328739874,35.05514370887089],[-76.0800539309931,35.06259649074907],[-76.07427498799879,35.05514370887089]]],[[[-76.29965376477648,34.92347789568957],[-76.38055896669667,34.93093067756776],[-76.31699059375937,34.95825754445445],[-76.35744319471948,35.02284832073207],[-76.31699059375937,35.00297423572357],[-76.33432742274226,35.025332581358136],[-76.29965376477648,35.010427017601764],[-76.29965376477648,34.92347789568957]]],[[[-76.13784336093609,35.00048997509751],[-76.14362230393039,35.00297423572357],[-76.13784336093609,35.00545849634964],[-76.13784336093609,35.00048997509751]]],[[[-76.1782959618962,34.96074180508051],[-76.1782959618962,34.97316310821083],[-76.1262854749475,35.00048997509751],[-76.21296961986198,34.93589919881988],[-76.1782959618962,34.96074180508051]]],[[[-76.1782959618962,34.96074180508051],[-76.18407490489048,34.96571032633263],[-76.1782959618962,34.96322606570657],[-76.1782959618962,34.96074180508051]]],[[[-76.18985384788479,34.955773283828385],[-76.19563279087909,34.955773283828385],[-76.19563279087909,34.95825754445445],[-76.18985384788479,34.96074180508051],[-76.18985384788479,34.955773283828385]]],[[[-76.31121165076507,34.85391859815982],[-76.31699059375937,34.858887119411946],[-76.21296961986198,34.93341493819382],[-76.27653799279928,34.881245465046504],[-76.31121165076507,34.85391859815982]]],[[[-76.53659042754276,34.58064992929293],[-76.55392725652565,34.62536662056206],[-76.53659042754276,34.61046105680568],[-76.43834839663967,34.75951669436944],[-76.32276953675367,34.85391859815982],[-76.53659042754276,34.58064992929293]]],[[[-76.68106400240023,34.70734722122212],[-76.68684294539455,34.71976852435244],[-76.66950611641164,34.727221306230625],[-76.68106400240023,34.71976852435244],[-76.68106400240023,34.70734722122212]]],[[[-76.52503254155415,34.684988875587564],[-76.58282197149714,34.699894439343936],[-76.58860091449145,34.712315742474246],[-76.55970619951995,34.709831481848184],[-76.52503254155415,34.684988875587564]]],[[[-77.0971478979898,34.642756444944496],[-77.062474240024,34.66759905120512],[-76.82553757725773,34.70486296059606],[-76.67528505940594,34.697410178717874],[-77.0971478979898,34.642756444944496]],[[-76.80242180528052,34.697410178717874],[-76.80242180528052,34.70237869997],[-76.81975863426342,34.697410178717874],[-76.80242180528052,34.697410178717874]]],[[[-76.69840083138314,34.699894439343936],[-76.70417977437744,34.70734722122212],[-76.69840083138314,34.712315742474246],[-76.69262188838883,34.70237869997],[-76.69840083138314,34.699894439343936]]],[[[-76.53081148454845,34.627850881188124],[-76.55392725652565,34.64772496619662],[-76.65216928742873,34.68002035433543],[-76.66372717341734,34.68995739683969],[-76.57126408550855,34.66511479057906],[-76.53081148454845,34.642756444944496],[-76.53081148454845,34.627850881188124]]],[[[-77.17227415691569,34.622882359936],[-77.14337944194419,34.642756444944496],[-77.1144847269727,34.640272184318434],[-77.1260426129613,34.63530366306631],[-77.17227415691569,34.622882359936]]],[[[-77.20116887188718,34.61542957805781],[-77.20694781488149,34.622882359936],[-77.20694781488149,34.627850881188124],[-77.1953899288929,34.61542957805781],[-77.20116887188718,34.61542957805781]]],[[[-77.23006358685868,34.595555493049304],[-77.21272675787579,34.622882359936],[-77.20694781488149,34.612945317431745],[-77.17805309990999,34.62039809930993],[-77.23006358685868,34.595555493049304]]],[[[-77.33408456075608,34.53096471677168],[-77.33986350375037,34.53344897739774],[-77.28207407380738,34.56574436553656],[-77.24162147284729,34.595555493049304],[-77.23006358685868,34.59307123242324],[-77.33408456075608,34.53096471677168]]],[[[-77.51901073657365,34.441531334233424],[-77.52478967956796,34.45146837673768],[-77.50745285058505,34.46637394049405],[-77.51323179357937,34.44898411611162],[-77.47277919261926,34.48127950425042],[-77.36875821872187,34.516059153015306],[-77.33986350375037,34.540901759275926],[-77.33986350375037,34.525996195519554],[-77.51901073657365,34.441531334233424]]]]}},{"type":"Feature","id":567,"properties":{"name":"dma:","latitude":35.0526635,"dma":567,"dma1":"Greenville-Spartanburg, SC-Asheville, NC-Anderson,SC","longitude":-82.697701},"geometry":{"type":"Polygon","coordinates":[[[-84.02032160516052,35.412877239023906],[-83.88162697329733,35.51970044594459],[-83.50021673567358,35.56193287658766],[-83.1592590990099,35.765642247924795],[-82.96277503720373,35.79048485418542],[-82.92232243624363,35.92960344924493],[-82.80674357635763,35.92711918861886],[-82.66804894449444,36.05381648054806],[-82.55824902760276,35.95444605550556],[-82.35598602280228,36.11592299619962],[-82.1479440750075,36.1507026449645],[-82.0323652151215,35.94202475237524],[-81.92256529822981,35.937056231123115],[-81.98613367116712,35.807874678567856],[-81.87055481128112,35.7184412960296],[-81.82432326732673,35.57435417971797],[-81.69140757845784,35.579322700970096],[-81.76653383738373,35.17935674017402],[-81.36778677077707,35.16445117641764],[-81.40823937173718,35.04520666636664],[-81.48914457365737,35.03030110261027],[-81.42557620072007,34.49370080738074],[-81.54115506060606,34.444015594859486],[-81.64517603450345,34.53344897739774],[-81.89367058325833,34.299928478547855],[-81.94568107020702,34.203042314131416],[-81.87055481128112,34.13348301660166],[-82.00924944314431,33.96206903340334],[-82.2461861059106,34.01920702780278],[-82.30397553585358,33.97200607590759],[-82.32709130783078,34.06392371907191],[-82.48312276867686,34.08131354345435],[-82.59292268556855,34.014238506550655],[-82.56402797059707,33.95461625152515],[-82.86453300630063,33.98194311841184],[-83.1014696690669,34.16826266536654],[-83.11302755505551,34.27508587228723],[-83.35574316081608,34.22291639913992],[-83.39041681878187,34.44649985548555],[-83.45976413471347,34.48127950425042],[-83.30373267386739,34.81665468876888],[-83.1014696690669,34.99800571447145],[-83.51755356465647,34.995521453845384],[-83.64469031053105,35.15202987328733],[-83.73715339843984,35.15699839453946],[-83.70825868346834,35.25636881958196],[-83.95675323222322,35.21662064956496],[-84.02610054815482,35.29114846834683],[-84.02032160516052,35.412877239023906]]]}},{"type":"Feature","id":647,"properties":{"name":"dma:","latitude":33.585109,"dma":647,"dma1":"Greenwood-Greenville, MS","longitude":-90.4836365},"geometry":{"type":"Polygon","coordinates":[[[-89.74725411251126,33.2143065849585],[-90.31936946894689,33.375783525652565],[-90.2846958109811,33.313677010001],[-90.3656010129013,33.23914919121913],[-90.45228515781578,33.32858257375737],[-90.72967442154214,33.26647605810581],[-90.67766393459345,33.10251485678568],[-90.91460059735974,33.09754633553355],[-90.91460059735974,33.008112952995305],[-91.45782123882388,33.00562869236924],[-91.45204229582959,33.56458733323333],[-91.2440003480348,33.517386381338135],[-91.1284214881488,33.604335503250326],[-91.22088457605761,33.69376888578858],[-91.03595840024002,33.673894800780076],[-91.14575831713171,33.76829670457046],[-90.98972685628563,33.775749486448646],[-91.07063205820582,33.860214347734775],[-91.01284262826283,33.92977364526453],[-91.08796888718871,33.96952181528153],[-90.89148482538253,34.029144070307034],[-90.87414799639964,34.088766325332536],[-90.95505319831983,34.12106171347135],[-90.66032710561055,34.11857745284529],[-90.66032710561055,33.98691163966397],[-90.45228515781578,33.98691163966397],[-90.45228515781578,34.07386076157616],[-90.13444329312931,34.07386076157616],[-90.13444329312931,34.160809883488355],[-89.93218028832882,34.16329414411442],[-89.92640134533454,33.89747825712571],[-89.50453850675066,33.86766712961296],[-89.50453850675066,33.676379061406145],[-89.78770671347135,33.676379061406145],[-89.78770671347135,33.41553169566957],[-89.64901208160816,33.403110392539254],[-89.64323313861385,33.28635014311431],[-89.74725411251126,33.2143065849585]]]}},{"type":"Feature","id":636,"properties":{"name":"dma:","latitude":26.311933,"dma":636,"dma1":"Harlingen-Weslaco-Brownsville-McAllen, TX","longitude":-98.157698},"geometry":{"type":"MultiPolygon","coordinates":[[[[-99.16693119321931,26.571393670867085],[-98.95311030243025,26.78504008470847],[-97.98802682238224,26.780071563456346],[-97.98802682238224,26.61611036213621],[-97.4390272379238,26.598720537753774],[-97.47947983888389,26.454633421442143],[-97.39279569396939,26.41488525142514],[-97.41591146594659,26.350294475147514],[-97.3292273210321,26.352778735773576],[-97.3118904920492,26.11925823692369],[-97.20209057515751,26.077025806280627],[-97.21364846114611,26.06212024252425],[-97.20786951815181,26.042246157515752],[-97.21942740414042,26.034793375637562],[-97.23098529012901,26.06957302440244],[-97.24254317611761,26.072057285028503],[-97.26565894809481,26.06212024252425],[-97.25988000510051,25.99504520562056],[-97.15585903120312,26.000013726872687],[-97.17319586018601,26.057151721272128],[-97.15585903120312,26.05963598189819],[-97.14430114521451,25.957781296229623],[-97.346564150015,25.930454429342934],[-97.36390097899789,25.850958089308932],[-97.40435357995798,25.83853678617862],[-97.66440601470147,26.037277636263624],[-98.14983722622262,26.049698939393938],[-98.4445633189319,26.22359718321832],[-98.66994209570957,26.236018486348634],[-98.80863672757275,26.370168560156014],[-99.08602599129912,26.397495427042703],[-99.16693119321931,26.571393670867085]]],[[[-97.28877472007201,26.601204798379836],[-97.2772168340834,26.56642514961496],[-97.3118904920492,26.56642514961496],[-97.2829957770777,26.568909410241023],[-97.28877472007201,26.601204798379836]]],[[[-97.18475374617461,26.20372309820982],[-97.2714378910891,26.549035325232524],[-97.28877472007201,26.524192718971896],[-97.3292273210321,26.561456628362837],[-97.2714378910891,26.561456628362837],[-97.19631163216322,26.31054630513051],[-97.15585903120312,26.06957302440244],[-97.18475374617461,26.20372309820982]]],[[[-97.20209057515751,26.047214678767876],[-97.20786951815181,26.064604503150314],[-97.19053268916892,26.072057285028503],[-97.19631163216322,26.067088763776376],[-97.20209057515751,26.047214678767876]]]]}},{"type":"Feature","id":566,"properties":{"name":"dma:","latitude":40.2836345,"dma":566,"dma1":"Harrisburg-Lancaster-Lebanon-York, PA","longitude":-76.882001},"geometry":{"type":"Polygon","coordinates":[[[-77.88886308820882,40.39381979427943],[-77.84263154425443,40.55032821372137],[-77.68082114041404,40.729194978797885],[-77.36297927572757,40.84843948884889],[-77.35720033273327,40.701868111911196],[-77.0393584680468,40.67950976627663],[-76.91800066516652,40.60249768686869],[-76.70417977437744,40.657151420642066],[-75.87201198319832,40.13794094979498],[-75.94135929912991,40.10812982228223],[-75.9875908430843,39.87212506280628],[-76.10316970297029,39.72306942524253],[-77.46122130663066,39.720585164616466],[-77.45544236363637,39.971495487848784],[-77.61147382448245,40.232342853585365],[-77.70393691239124,40.26463824172418],[-77.75016845634563,40.37891423052306],[-77.88886308820882,40.39381979427943]]]}},{"type":"Feature","id":569,"properties":{"name":"dma:","latitude":38.4231645,"dma":569,"dma1":"Harrisonburg, VA","longitude":-79.0679395},"geometry":{"type":"Polygon","coordinates":[[[-78.48409421662166,38.42131685718572],[-78.74414665136513,38.21512322522253],[-78.90017811221122,37.94930733823382],[-79.1486726609661,37.88968508320832],[-79.49540924062407,38.09587871517152],[-79.44339875367537,38.16543801270127],[-79.53586184158416,38.155500970197025],[-79.31048306480648,38.41137981468147],[-79.65144070147014,38.59273084038404],[-79.51274606960696,38.7815346479648],[-79.51852501260126,38.89084211551155],[-79.35093566576657,38.95791715241525],[-79.0562095730573,38.7616605629563],[-78.99264120012,38.851093945494554],[-78.64012567746775,38.60515214351435],[-78.69213616441644,38.510750239723976],[-78.48409421662166,38.42131685718572]]]}},{"type":"Feature","id":533,"properties":{"name":"dma:","latitude":41.612664,"dma":533,"dma1":"Hartford & New Haven, CT","longitude":-72.659358},"geometry":{"type":"MultiPolygon","coordinates":[[[[-73.06922463096309,41.30057492279228],[-73.30038235073508,41.4719889059906],[-73.43907698259827,41.4918629909991],[-73.51998218451845,41.665761234823485],[-73.48530852655264,42.05082163186319],[-71.79785717221722,42.023494764976505],[-71.82675188718872,41.34280735343535],[-72.04057277797779,41.34777587468747],[-72.31218309870987,41.27821657715772],[-72.8958563411341,41.24095266776678],[-72.9074142271227,41.29809066216622],[-73.1212351179118,41.17636189148915],[-73.06922463096309,41.30057492279228]],[[-72.32951992769276,41.28070083778378],[-72.32374098469847,41.29063788028803],[-72.34107781368137,41.29809066216622],[-72.33529887068707,41.28566935903591],[-72.32951992769276,41.28070083778378]]],[[[-71.96544651905191,41.32044900780078],[-71.96544651905191,41.32541752905291],[-71.9596675760576,41.32293326842685],[-71.96544651905191,41.32044900780078]]]]}},{"type":"Feature","id":710,"properties":{"name":"dma:","latitude":31.5670435,"dma":710,"dma1":"Hattiesburg-Laurel, MS","longitude":-89.2449615},"geometry":{"type":"Polygon","coordinates":[[[-89.32539127392738,32.223086595159515],[-88.91508632133213,32.223086595159515],[-88.90930737833783,31.8256048949895],[-88.47588665376537,31.89267993189319],[-88.44699193879387,31.43557597669767],[-88.83996006240625,31.43309171607161],[-88.83418111941194,30.91139698459846],[-89.34272810291029,30.9089127239724],[-89.3485070459046,31.010767409640966],[-89.83393825742574,31.000830367136714],[-89.83393825742574,31.075358185918592],[-90.03042231923192,31.174728610961097],[-90.04198020522051,31.395827806680668],[-89.58544370867087,31.43309171607161],[-89.60278053765376,31.5399149229923],[-89.75303305550554,31.609474220522053],[-89.75303305550554,31.773435421842187],[-89.31383338793879,31.803246549354938],[-89.32539127392738,32.223086595159515]]]}},{"type":"Feature","id":766,"properties":{"name":"dma:","latitude":47.1878,"dma":766,"dma1":"Helena, MT","longitude":-112.3319335},"geometry":{"type":"Polygon","coordinates":[[[-111.63211123192319,46.56969171067107],[-112.03085829852985,46.56969171067107],[-112.31980544824482,46.42063607310732],[-112.31980544824482,46.656640832583264],[-112.5336263390339,46.69887326322633],[-112.5336263390339,46.83550759765977],[-112.79367877377737,46.830539076407646],[-112.79945771677167,47.17833556405641],[-113.05951015151516,47.17833556405641],[-113.05951015151516,47.48886814231424],[-113.11729958145814,47.4913524029403],[-113.16353112541253,47.71990438053806],[-113.05951015151516,47.78946367806781],[-113.08840486648664,47.91864523062307],[-112.98438389258925,47.953424879387946],[-112.91503657665766,47.695061774277434],[-112.81679454575458,47.60811265236524],[-112.55096316801679,47.652829343634366],[-112.28513179027902,47.50625796669668],[-112.04819512751274,47.51619500920093],[-112.04241618451844,47.19324112781278],[-111.78814269276927,47.12865035153516],[-111.78814269276927,46.915003937693776],[-111.6205533459346,46.90258263456346],[-111.63789017491749,46.83302333703371],[-111.4991955430543,46.76346403950396],[-111.63789017491749,46.73862143324333],[-111.63211123192319,46.56969171067107]]]}},{"type":"Feature","id":618,"properties":{"name":"dma:","latitude":29.606092,"dma":618,"dma1":"Houston, TX","longitude":-95.6464085},"geometry":{"type":"MultiPolygon","coordinates":[[[[-94.3530716789679,29.5599592040204],[-94.78071346054605,29.53014807650765],[-94.69402931563155,29.654361107810782],[-94.72292403060305,29.788511181618162],[-94.89051337743774,29.66181388968897],[-94.96563963636363,29.70156205970597],[-95.02342906630663,29.552506422142216],[-94.90785020642065,29.497852688368837],[-94.95408175037504,29.47052582148215],[-94.94830280738074,29.418356348334832],[-94.91940809240924,29.448167475847583],[-94.80960817551755,29.363702614561458],[-94.88473443444344,29.38854522082208],[-94.89629232043204,29.304080359535952],[-94.94252386438643,29.314017402040204],[-95.00609223732373,29.27923775327533],[-95.09855532523252,29.1748988069807],[-95.20835524212421,29.212162716371637],[-95.15056581218121,29.179867328232824],[-95.21991312811281,29.01590612691269],[-95.12167109720971,29.070559860686068],[-95.38172353195318,28.864366228722872],[-95.92494417341734,28.702889288028803],[-95.95961783138313,28.625877208620864],[-95.69956539663966,28.725247633663365],[-95.98273360336033,28.596066081108113],[-95.97695466036603,28.615940166116612],[-95.98851254635463,28.63332999049905],[-95.97695466036603,28.63581425112511],[-95.97695466036603,28.6432670330033],[-95.98851254635463,28.6432670330033],[-95.97117571737174,28.658172596759677],[-95.99429148934894,28.6631411180118],[-96.00584937533753,28.645751293629363],[-96.04052303330333,28.653204075507553],[-96.208112380138,28.5836447779778],[-96.22544920912091,28.57867625672567],[-96.23122815211521,28.581160517351734],[-96.2370070951095,28.6432670330033],[-96.17921766516652,28.705373548654865],[-96.17343872217222,28.762511543054305],[-96.3641438409841,28.625877208620864],[-96.38725961296129,28.730216154915492],[-96.4334911569157,28.732700415541554],[-96.3757017269727,28.625877208620864],[-96.46816481488149,28.573707735473548],[-96.49128058685868,28.568739214221424],[-96.4334911569157,28.6035188629863],[-96.4623858718872,28.668109639263925],[-96.48550164386438,28.60600312361236],[-96.56062790279027,28.63581425112511],[-96.83223822352235,29.020874648164817],[-96.93625919741974,29.06310707880788],[-96.56062790279027,29.33637574767477],[-96.87269082448245,29.632002762176217],[-96.57218578877888,29.962409425442544],[-96.64731204770477,30.14624471177118],[-96.79178562256226,30.161150275527554],[-96.73399619261926,30.24313087618762],[-96.3121333540354,30.384733731873187],[-96.17921766516652,30.39467077437744],[-96.14454400720072,30.337532779977998],[-96.08097563426342,30.43193468376838],[-96.19077555115511,30.59838014571457],[-96.16765977917791,30.821963602060208],[-95.63021808070806,30.898975681468148],[-95.43373401890189,31.057968361536155],[-95.39906036093609,30.859227511451145],[-95.24880784308431,30.906428463346337],[-95.2025762991299,30.82444786268627],[-94.84428183348335,31.147401744074408],[-94.56111362676268,31.06293688278828],[-94.65935565766577,31.010767409640966],[-94.53799785478547,30.49155693879388],[-94.73448191659166,30.489072678167815],[-94.59578728472847,30.1114650630063],[-94.44553476687668,30.11394932363236],[-94.4397558238824,29.887881606660667],[-94.35885062196219,29.887881606660667],[-94.3530716789679,29.5599592040204]]],[[[-94.68247142964296,29.45313599709971],[-94.70558720162016,29.435746172717273],[-94.67669248664866,29.475494342734272],[-94.59000834173418,29.492884167116713],[-94.56689256975697,29.532632337133712],[-94.50910313981399,29.520211034003403],[-94.68247142964296,29.45313599709971]]],[[[-94.68247142964296,29.45313599709971],[-94.50332419681968,29.51027399149915],[-94.65357671467146,29.440714693969397],[-94.75759768856885,29.361218353935392],[-94.68247142964296,29.45313599709971]]],[[[-94.79805028952896,29.31153314141414],[-94.82116606150615,29.321470183918393],[-94.80960817551755,29.351281311431144],[-94.77493451755176,29.33637574767477],[-94.79805028952896,29.31153314141414]]],[[[-95.11011321122112,29.08794968506851],[-94.95408175037504,29.229552540754078],[-94.83272394749474,29.27923775327533],[-94.87895549144915,29.27923775327533],[-94.87895549144915,29.294143317031704],[-94.78071346054605,29.314017402040204],[-94.76915557455746,29.33637574767477],[-94.72292403060305,29.33140722642264],[-95.11011321122112,29.08794968506851]]],[[[-94.91940809240924,29.294143317031704],[-94.93096597839784,29.299111838283828],[-94.90207126342634,29.299111838283828],[-94.91362914941493,29.294143317031704],[-94.91940809240924,29.294143317031704]]],[[[-96.93048025442545,28.58612903860386],[-96.66464887668766,28.705373548654865],[-96.64153310471048,28.571223474847486],[-96.4045964419442,28.44204192229223],[-96.66464887668766,28.325281672867288],[-96.89002765346534,28.506632698569856],[-96.93048025442545,28.58612903860386]]],[[[-95.97695466036603,28.615940166116612],[-95.98851254635463,28.588613299229923],[-96.21967026612661,28.49172713481348],[-96.21967026612661,28.511601219821983],[-95.97695466036603,28.615940166116612]]],[[[-96.323691240024,28.424652097909792],[-96.3352491260126,28.437073401040102],[-96.22544920912091,28.494211395439542],[-96.23122815211521,28.484274352935294],[-96.323691240024,28.424652097909792]]],[[[-96.38148066996699,28.39484097039704],[-96.3410280690069,28.43210487978798],[-96.3294701830183,28.424652097909792],[-96.3641438409841,28.399809491649165],[-96.38148066996699,28.39484097039704]]],[[[-96.82068033753376,28.168773253425343],[-96.75133302160216,28.171257514051405],[-96.4045964419442,28.372482624762476],[-96.84957505250524,28.064434307130714],[-96.82068033753376,28.168773253425343]]],[[[-96.79756456555656,28.2780807209721],[-96.78600667956795,28.25075385408541],[-96.80912245154515,28.22094272657266],[-96.79756456555656,28.2780807209721]]]]}},{"type":"Feature","id":691,"properties":{"name":"dma:","latitude":34.7953925,"dma":691,"dma1":"Huntsville-Decatur (Florence), AL","longitude":-86.8583345},"geometry":{"type":"Polygon","coordinates":[[[-88.10025535913591,34.89118250755076],[-88.2042763330333,35.0079427569757],[-87.98467649924993,35.00545849634964],[-88.02512910021002,35.3930031540154],[-87.97311861326132,35.46007819091909],[-87.73618195049505,35.49237357905791],[-87.57437154665466,35.40542445714571],[-87.60326626162616,35.00297423572357],[-86.83466684338433,34.99055293259326],[-86.82888790039004,35.26382160146015],[-86.58039335163517,35.37064480838084],[-86.38968823282329,35.23649473457346],[-86.3203409168917,34.99055293259326],[-85.60375198559856,34.98558441134114],[-85.51128889768977,34.52351193489349],[-85.84068864836483,34.200558053505354],[-86.1874252280228,34.18316822912291],[-86.30300408790879,34.098703367836784],[-86.47637237773777,34.30241273917392],[-88.1753816180618,34.32228682418242],[-88.10025535913591,34.89118250755076]]]}},{"type":"Feature","id":758,"properties":{"name":"dma:","latitude":43.641669,"dma":758,"dma1":"Idaho Falls-Pocatello, ID","longitude":-112.6765315},"geometry":{"type":"Polygon","coordinates":[[[-110.05445979447944,43.37741680618062],[-110.34340694419441,43.37741680618062],[-110.34340694419441,43.290467684268435],[-110.5803436069607,43.290467684268435],[-110.62079620792079,42.709150697769786],[-110.5398910060006,42.276889348834885],[-110.05445979447944,42.27192082758276],[-110.04868085148514,41.57632785228523],[-111.04843798949895,41.578812112911294],[-111.04843798949895,42.51289410831083],[-111.23336416531653,42.478114459545964],[-111.24492205130512,42.60232749084909],[-111.27959570927092,42.55264227832784],[-111.60321651695169,42.589906187718775],[-111.58010074497449,42.42842924702471],[-111.89794260966096,42.41600794389439],[-111.89794260966096,42.25701526382639],[-112.19266870237024,42.351417167616766],[-112.32558439123912,42.32409030073008],[-112.29668967626762,42.44581907140714],[-112.38337382118212,42.502957065806584],[-112.4989526810681,42.502957065806584],[-112.4989526810681,42.41600794389439],[-112.65498414191418,42.41600794389439],[-112.65498414191418,42.3290588219822],[-113.00172072157216,42.32657456135614],[-113.00172072157216,42.58742192709271],[-113.23865738433844,42.62468583648365],[-113.18086795439544,42.761320170917095],[-113.23865738433844,42.761320170917095],[-113.24443632733274,42.848269292829286],[-113.24443632733274,43.11160091919193],[-113.00749966456645,43.11160091919193],[-113.00749966456645,43.28549916301631],[-113.36001518721872,43.28549916301631],[-113.36001518721872,43.36747976367637],[-113.6374044509451,43.36747976367637],[-113.59117290699069,43.46685018871888],[-113.70097282388238,43.58361043814382],[-113.80499379777977,43.571189135013505],[-114.00147785958596,43.76496146384639],[-114.10549883348335,43.742603118211825],[-114.29042500930093,43.886690234523456],[-114.4869090711071,43.90408005890589],[-114.562035330033,43.84445780388039],[-114.81630882178217,43.928922665166525],[-114.81630882178217,43.99351344144415],[-114.97234028262827,43.93885970767077],[-115.04746654155416,44.03823013271328],[-115.02435076957696,44.157474642764285],[-115.29018214731472,44.33385714721473],[-115.22661377437743,44.46303869976998],[-115.30751897629763,44.579798949194924],[-115.11681385748574,44.75618145364537],[-114.94344556765677,44.723886065506555],[-114.72384573387339,44.89033152745275],[-114.72962467686769,45.151178893189325],[-114.5909300450045,45.29775027012702],[-114.79319304980498,45.436868865186526],[-114.79319304980498,45.50891242334234],[-114.66605630393039,45.4716485139514],[-114.4695722421242,45.56605041774178],[-114.33087761026103,45.45922721082108],[-113.98991997359735,45.705169012801285],[-113.80499379777977,45.60331432713272],[-113.83388851275127,45.52133372647265],[-113.76454119681968,45.52133372647265],[-113.74142542484248,45.33004565826583],[-113.4524782751275,45.059261250025],[-113.4524782751275,44.865488921192124],[-113.34267835823582,44.78350832053206],[-113.12885746744674,44.77357127802781],[-113.00749966456645,44.455585917891796],[-112.85724714671467,44.36118401410141],[-112.78212088778878,44.48539704540455],[-112.38915276417642,44.44813313601361],[-112.28513179027902,44.567377646064614],[-111.4703008280828,44.54005077917792],[-111.5165323720372,44.64438972547255],[-111.38361668316831,44.75618145364537],[-111.04843798949895,44.47297574227423],[-111.05421693249325,44.666748071107115],[-110.66702775187518,44.666748071107115],[-110.66702775187518,44.582283209820986],[-110.29139645724572,44.54253503980399],[-110.29717540024002,44.42825905100511],[-110.14114393939394,44.27671915281529],[-110.11802816741674,44.13263203650365],[-110.05445979447944,44.13263203650365],[-110.05445979447944,44.00841900520052],[-110.05445979447944,43.37741680618062]]]}},{"type":"Feature","id":527,"properties":{"name":"dma:","latitude":39.84288,"dma":527,"dma1":"Indianapolis, IN","longitude":-86.1652105},"geometry":{"type":"Polygon","coordinates":[[[-85.44194158175817,39.19640617251726],[-85.80023604740474,39.12933113561357],[-85.86380442034203,39.03989775307531],[-86.3203409168917,39.049834795579564],[-86.30878303090309,38.68713274417442],[-86.68441432553254,38.68713274417442],[-86.68441432553254,39.166595045004506],[-87.05426667716772,39.16907930563057],[-87.05426667716772,39.34297754945495],[-86.94446676027601,39.34297754945495],[-86.93868781728173,39.4721591020102],[-87.01381407620761,39.474643362636264],[-87.00803513321333,39.86715654155416],[-87.08894033513351,39.86715654155416],[-87.08894033513351,39.95410566346635],[-87.44145585778577,39.96155844534454],[-87.41834008580858,40.19259468356836],[-87.09471927812781,40.36649292739274],[-87.09471927812781,40.214953029202924],[-86.69597221152115,40.214953029202924],[-86.69597221152115,40.56274951685169],[-87.09471927812781,40.56274951685169],[-87.09471927812781,40.4758003949395],[-87.52814000270027,40.47828465556556],[-87.52814000270027,40.73664776067607],[-87.10049822112211,40.73664776067607],[-87.10049822112211,40.838502446344634],[-86.98491936123612,40.838502446344634],[-86.98491936123612,40.913030265126515],[-86.17008839903991,40.91054600450045],[-86.17008839903991,40.997495126412645],[-85.94470962226222,40.99997938703871],[-85.93893067926793,40.65218289938994],[-85.44772052475247,40.654667160016004],[-85.44772052475247,40.56771803810381],[-85.19922597599759,40.56771803810381],[-85.2165628049805,40.30687067236724],[-84.80625785238524,40.3093549329933],[-84.81203679537953,40.003790875987605],[-85.19922597599759,40.003790875987605],[-85.2223417479748,39.787660201520154],[-85.187668090009,39.71561664336434],[-85.0316366291629,39.71561664336434],[-85.03741557215722,39.52681283578358],[-85.29746800690069,39.52432857515752],[-85.29746800690069,39.26844973067307],[-85.44194158175817,39.19640617251726]]]}},{"type":"Feature","id":718,"properties":{"name":"dma:","latitude":32.1874215,"dma":718,"dma1":"Jackson, MS","longitude":-90.485657},"geometry":{"type":"Polygon","coordinates":[[[-89.83393825742574,31.000830367136714],[-90.55052718871886,31.000830367136714],[-90.55052718871886,31.34862685478548],[-91.11108465916591,31.318815727272728],[-91.23244246204621,31.373469461046106],[-91.46937912481248,31.318815727272728],[-91.48671595379537,31.229382344734475],[-91.59073692769277,31.192118435343534],[-91.65430530063006,31.249256429742974],[-91.50983172577259,31.284036078507853],[-91.56762115571557,31.423154673567357],[-91.46360018181818,31.380922242924292],[-91.52138961176118,31.52252509860986],[-91.40581075187518,31.589600135513553],[-91.50983172577259,31.63431682678268],[-91.40003180888088,31.619411263026304],[-91.3711370939094,31.746108554955498],[-91.26711612001199,31.751077076207622],[-91.36535815091509,31.761014118711874],[-91.3422423789379,31.845478979998],[-91.2555582340234,31.813183591859186],[-91.1862109180918,31.96223922942294],[-91.07641100120011,32.01689296319632],[-91.1573162031203,32.07403095759576],[-91.08218994419443,32.04670409070907],[-91.00706368526852,32.14359025512552],[-91.16309514611461,32.13365321262126],[-91.16309514611461,32.195759728272826],[-91.04173734323433,32.24296068016802],[-90.99550579927993,32.193275467646764],[-90.87414799639964,32.37214223272328],[-90.99550579927993,32.354752408340836],[-90.97239002730274,32.439217269626965],[-91.11108465916591,32.478965439643964],[-91.09374783018302,32.54852473717372],[-90.98972685628563,32.48890248214822],[-91.08218994419443,32.55597751905191],[-91.00128474227422,32.623052555955596],[-91.14575831713171,32.6031784709471],[-91.05329522922293,32.722422980998104],[-91.16309514611461,32.747265587258724],[-91.16309514611461,32.81185636353636],[-91.06485311521152,32.92364809170917],[-91.11108465916591,32.9882388679868],[-91.17465303210321,32.90128974607461],[-91.20354774707471,32.96091200110011],[-91.16887408910891,33.01059721362137],[-90.91460059735974,33.008112952995305],[-90.91460059735974,33.09754633553355],[-90.68344287758777,33.09754633553355],[-90.72967442154214,33.26647605810581],[-90.55630613171317,33.27144457935793],[-90.55630613171317,33.32858257375737],[-90.45228515781578,33.32858257375737],[-90.41183255685569,33.234180669966996],[-90.2846958109811,33.313677010001],[-90.31936946894689,33.375783525652565],[-89.74725411251126,33.2143065849585],[-89.70102256855685,33.28635014311431],[-89.31383338793879,33.28635014311431],[-89.31383338793879,31.803246549354938],[-89.75303305550554,31.773435421842187],[-89.75303305550554,31.609474220522053],[-89.60278053765376,31.5399149229923],[-89.58544370867087,31.43309171607161],[-90.04198020522051,31.395827806680668],[-90.03042231923192,31.174728610961097],[-89.83393825742574,31.075358185918592],[-89.83393825742574,31.000830367136714]]]}},{"type":"Feature","id":639,"properties":{"name":"dma:","latitude":35.5707925,"dma":639,"dma1":"Jackson, TN","longitude":-88.530231},"geometry":{"type":"Polygon","coordinates":[[[-88.198497390039,34.995521453845384],[-88.37764462286228,34.995521453845384],[-88.36608673687368,35.49237357905791],[-88.59724445664565,35.59174400410041],[-88.81684429042903,35.42778280278028],[-89.07689672517252,35.43026706340634],[-89.07111778217822,35.693598689768976],[-89.01910729522952,35.67124034413442],[-88.91508632133213,35.79793763606361],[-88.70704437353734,35.79048485418542],[-88.65503388658865,36.118407256825684],[-88.2100552760276,36.14573412371237],[-88.1811605610561,35.750736684168416],[-88.2505078769877,35.422814281528154],[-88.0598027581758,35.41784576027603],[-87.97889755625562,35.296116989598964],[-87.98467649924993,35.00545849634964],[-88.198497390039,34.995521453845384]]]}},{"type":"Feature","id":561,"properties":{"name":"dma:","latitude":30.427575,"dma":561,"dma1":"Jacksonville, FL","longitude":-82.006576},"geometry":{"type":"MultiPolygon","coordinates":[[[[-82.04970204410441,29.733857447844784],[-82.1306072460246,29.83571213351335],[-82.52357536963696,29.945019601060107],[-82.65071211551154,29.825775091009103],[-82.80096463336334,29.932598297929793],[-82.79518569036904,30.337532779977998],[-82.69116471647165,30.332564258725874],[-82.64493317251726,30.407092077507752],[-82.72583837443744,30.563600496949697],[-82.41955439573957,30.580990321332134],[-82.48890171167116,30.963566457745777],[-82.70272260246024,31.22441382348235],[-82.62759634353435,31.2740990360036],[-82.62759634353435,31.470355625462545],[-82.40221756675668,31.41570189168917],[-82.22884927692769,31.52997788048805],[-82.061259930093,31.46538710421042],[-82.0323652151215,31.366016679167917],[-81.72608123642364,31.326268509150914],[-81.62206026252625,31.452965801080108],[-81.38512359975996,31.28155181788179],[-81.40823937173718,31.266646254125412],[-81.40823937173718,31.279067557255726],[-81.41979725772578,31.284036078507853],[-81.43135514371437,31.289004599759977],[-81.42557620072007,31.289004599759977],[-81.42557620072007,31.30142590289029],[-81.43135514371437,31.303910163516353],[-81.42557620072007,31.29894164226423],[-81.42557620072007,31.289004599759977],[-81.43135514371437,31.289004599759977],[-81.42557620072007,31.286520339133915],[-81.39668148574857,31.254224950995102],[-81.41979725772578,31.249256429742974],[-81.44291302970296,31.20702399909991],[-81.43135514371437,31.13001191969197],[-81.48336563066306,31.11013783468347],[-81.42557620072007,31.048031319031903],[-81.51803928862887,30.971019239623963],[-81.50648140264026,30.963566457745777],[-81.50648140264026,30.956113675867588],[-81.50648140264026,30.9486608939894],[-81.50070245964596,30.943692372737274],[-81.50648140264026,30.93623959085909],[-81.50648140264026,30.93127106960696],[-81.50070245964596,30.923818287728775],[-81.49492351665165,30.923818287728775],[-81.48336563066306,30.93127106960696],[-81.47180774467446,30.92133402710271],[-81.49492351665165,30.9089127239724],[-81.51803928862887,30.886554378337834],[-81.48336563066306,30.84432194769477],[-81.51803928862887,30.84680620832083],[-81.53537611761176,30.826932123312332],[-81.50070245964596,30.722593177017703],[-81.42557620072007,30.70023483138314],[-81.45447091569156,30.521368066306632],[-81.28688156885688,29.912724212921294],[-81.36200782778278,30.066748371737173],[-81.36778677077707,30.03445298359836],[-81.30421839783978,29.828259351635165],[-81.24642896789679,29.743794490349035],[-81.25220791089109,29.731373187218722],[-81.24642896789679,29.716467623462346],[-81.211755309931,29.67175093219322],[-81.52381823162315,29.622065719671966],[-81.43135514371437,29.398482263326333],[-81.55271294659465,29.353765572057206],[-81.67984969246925,29.323954444544455],[-81.84166009630962,29.520211034003403],[-82.0554809870987,29.47052582148215],[-82.04970204410441,29.733857447844784]]],[[[-81.41979725772578,31.189634174717472],[-81.39668148574857,31.204539738473848],[-81.38512359975996,31.246772169116912],[-81.37934465676568,31.284036078507853],[-81.39090254275428,31.306394424142415],[-81.269544739874,31.29148886038604],[-81.39090254275428,31.132496180318032],[-81.41979725772578,31.154854525952597],[-81.40823937173718,31.174728610961097],[-81.41979725772578,31.18466565346535],[-81.41979725772578,31.189634174717472]]],[[[-81.41979725772578,31.189634174717472],[-81.43135514371437,31.226898084108413],[-81.41979725772578,31.246772169116912],[-81.39668148574857,31.246772169116912],[-81.39668148574857,31.259193472247226],[-81.39668148574857,31.204539738473848],[-81.41979725772578,31.189634174717472]]],[[[-81.42557620072007,31.154854525952597],[-81.43135514371437,31.162307307830783],[-81.41979725772578,31.182181392839283],[-81.40823937173718,31.172244350335035],[-81.42557620072007,31.154854525952597]]],[[[-81.43135514371437,31.013251670267028],[-81.41979725772578,31.03561001590159],[-81.44291302970296,31.09274801030103],[-81.40823937173718,31.12007487718772],[-81.40246042874287,31.07287392529253],[-81.41979725772578,31.020704452145218],[-81.43135514371437,31.013251670267028]]],[[[-81.45447091569156,30.712656134513452],[-81.48336563066306,30.735014480148017],[-81.47180774467446,30.841837687068708],[-81.51226034563456,30.88158585708571],[-81.40823937173718,30.97847202150215],[-81.45447091569156,30.712656134513452]]],[[[-81.50070245964596,30.923818287728775],[-81.48336563066306,30.946176633363336],[-81.50648140264026,30.963566457745777],[-81.44869197269728,30.96605071837184],[-81.50070245964596,30.923818287728775]]],[[[-81.50648140264026,30.829416383938394],[-81.50648140264026,30.82444786268627],[-81.52381823162315,30.819479341434146],[-81.52381823162315,30.836869165816584],[-81.50648140264026,30.829416383938394]]],[[[-81.50648140264026,30.82444786268627],[-81.50648140264026,30.829416383938394],[-81.50070245964596,30.79463673517352],[-81.51803928862887,30.80705803830383],[-81.51803928862887,30.81699508080808],[-81.50648140264026,30.82444786268627]]],[[[-81.24642896789679,29.743794490349035],[-81.25220791089109,29.761184314731473],[-81.28110262586259,29.818322309130913],[-81.2984394548455,29.830743612261227],[-81.29266051185118,29.905271431043104],[-81.2290921389139,29.706530580958095],[-81.24642896789679,29.726404665966598],[-81.24642896789679,29.743794490349035]]]]}},{"type":"Feature","id":574,"properties":{"name":"dma:","latitude":40.673069,"dma":574,"dma1":"Johnstown-Altoona, PA","longitude":-78.328162},"geometry":{"type":"Polygon","coordinates":[[[-77.85996837323732,40.060928870387045],[-78.1315786939694,40.16526781668167],[-78.38007324272428,39.72306942524253],[-79.39138826672666,39.720585164616466],[-79.39716720972098,39.89945192969297],[-79.00997802910291,40.33916606050605],[-78.79615713831383,40.71677367566757],[-78.80771502430242,40.90557748324833],[-79.2180199768977,40.91054600450045],[-79.2064620909091,41.42975647534754],[-79.47807241164116,41.38752404470448],[-79.51274606960696,41.623528804180424],[-78.200926009901,41.6185602829283],[-77.9871051191119,41.47447316661666],[-78.09112609300931,41.21611006150616],[-78.0391156060606,41.15400354585459],[-77.90042097419742,41.253373970897094],[-77.89464203120312,41.17636189148915],[-77.57102122352235,41.067054423942395],[-77.50745285058505,40.96271547764777],[-77.14337944194419,41.04469607830784],[-77.81951577227723,40.58013934123413],[-77.88886308820882,40.39381979427943],[-77.75016845634563,40.37891423052306],[-77.70393691239124,40.26463824172418],[-77.85996837323732,40.060928870387045]]]}},{"type":"Feature","id":734,"properties":{"name":"dma:","latitude":36.0989355,"dma":734,"dma1":"Jonesboro, AR","longitude":-91.1294975},"geometry":{"type":"Polygon","coordinates":[[[-92.15707334113411,36.26001011251125],[-91.56762115571557,36.250073070007005],[-91.56762115571557,36.337022191919196],[-91.45204229582959,36.334537931293134],[-91.45204229582959,36.49849913261326],[-90.1517801221122,36.49849913261326],[-90.06509597719771,36.38422314381438],[-90.07665386318632,36.279884197519756],[-90.37715889888989,35.99667848614862],[-90.29047475397539,35.99667848614862],[-90.2846958109811,35.70105147164717],[-91.03595840024002,35.708504253525355],[-91.03017945724572,35.8848867579758],[-91.46360018181818,35.937056231123115],[-91.75254733153315,35.94202475237524],[-91.85078936243625,35.86749693359336],[-92.11084179717972,35.93208770987099],[-92.05883131023103,36.033942395539555],[-92.19752594209422,36.13331282058206],[-92.15707334113411,36.26001011251125]]]}},{"type":"Feature","id":603,"properties":{"name":"dma:","latitude":37.2695535,"dma":603,"dma1":"Joplin, MO-Pittsburg, KS","longitude":-95.0098365},"geometry":{"type":"Polygon","coordinates":[[[-94.61890305670568,36.66742885518552],[-95.00031329432943,36.66991311581158],[-95.00609223732373,37.00031977907791],[-95.52041816381637,37.00031977907791],[-95.52041816381637,37.38289591549155],[-95.95961783138313,37.387864436743676],[-95.95961783138313,38.041224981398145],[-94.05834558625862,38.03625646014602],[-94.07568241524152,36.49849913261326],[-94.61890305670568,36.49849913261326],[-94.61890305670568,36.66742885518552]]]}},{"type":"Feature","id":616,"properties":{"name":"dma:","latitude":39.3042305,"dma":616,"dma1":"Kansas City, MO","longitude":-94.208994},"geometry":{"type":"Polygon","coordinates":[[[-95.34127093099309,39.65351012771278],[-95.05232378127812,39.62369900020002],[-95.10433426822682,39.534265617661774],[-94.60156622772277,39.531781357035705],[-94.60156622772277,39.747912031503155],[-94.20859810411041,39.74542777087709],[-94.20281916111611,40.033602003500356],[-94.60734517071707,40.03857052475248],[-94.59578728472847,40.386367012401244],[-94.2143770471047,40.38388275177518],[-94.23171387608761,40.572686559355944],[-93.77517737953795,40.57765508060807],[-93.76361949354936,40.26463824172418],[-93.3648724269427,40.26712250235024],[-93.3648724269427,40.033602003500356],[-92.84476755745574,40.03608626412642],[-92.85632544344435,39.70071107960796],[-93.28974616801679,39.68332125522552],[-93.2781882820282,39.45725353825383],[-92.85054650045004,39.23118582128213],[-93.04703056225623,38.97282271617162],[-93.07014633423341,38.53062432473248],[-93.51512494479448,38.51323450035004],[-93.52090388778878,38.20767044334434],[-94.05256664326433,38.21512322522253],[-94.06412452925292,38.0312879388939],[-95.52041816381637,38.03874072077208],[-95.50308133483348,39.05480331683169],[-95.18523947014701,39.04486627432743],[-95.17946052715271,39.41998962886289],[-95.57242865076508,39.41998962886289],[-95.56664970777078,39.65351012771278],[-95.34127093099309,39.65351012771278]]]}},{"type":"Feature","id":557,"properties":{"name":"dma:","latitude":36.112655,"dma":557,"dma1":"Knoxville, TN","longitude":-84.0422025},"geometry":{"type":"Polygon","coordinates":[[[-85.245457519952,36.10101743244324],[-85.1529944320432,36.09853317181718],[-85.0836471161116,36.19541933623363],[-85.0894260591059,36.50098339323932],[-84.94495248424843,36.58047973327333],[-84.73113159345934,36.52582599949995],[-84.78314208040804,36.602838078907894],[-84.59243696159615,36.86368544464447],[-84.2977108688869,36.945666045304534],[-84.35550029882988,36.80903171087109],[-84.28037403990399,36.64258624892489],[-83.93363746024602,36.58793251515152],[-83.95675323222322,36.64507050955096],[-83.58690088058805,36.95560308780878],[-83.45976413471347,36.88355952965297],[-83.1823748709871,37.02019386408641],[-83.1245854410441,37.00528830033004],[-83.14770121302129,36.95311882718272],[-82.93965926522652,37.015225342834285],[-82.85297512031204,36.95560308780878],[-82.90498560726073,36.876106747774784],[-83.07257495409542,36.85374840214021],[-83.1361433270327,36.7419566739674],[-83.67358502550255,36.60035381828183],[-82.82985934833482,36.592901036403646],[-83.0379012961296,36.55066860576058],[-83.28639584488448,36.37925462256226],[-83.24016430093009,36.28236845814582],[-83.17659592799279,36.34199071317132],[-83.1534801560156,36.34199071317132],[-83.08413284008401,36.24510454875488],[-83.1708169849985,36.15567116621662],[-82.89920666426642,35.9445090130013],[-82.99166975217521,35.77309502980298],[-83.1592590990099,35.765642247924795],[-83.50021673567358,35.56193287658766],[-83.88162697329733,35.51970044594459],[-84.02032160516052,35.412877239023906],[-84.04921632013202,35.2737586439644],[-84.34394241284127,35.20419934643465],[-84.49419493069307,35.28617994709471],[-84.40173184278427,35.34331794149415],[-84.52886858865887,35.62900791349135],[-84.78314208040804,35.8252645029503],[-85.0316366291629,35.74576816291629],[-85.2512364629463,35.765642247924795],[-85.245457519952,36.10101743244324]]]}},{"type":"Feature","id":702,"properties":{"name":"dma:","latitude":44.313217,"dma":702,"dma1":"La Crosse-Eau Claire, WI","longitude":-91.197266},"geometry":{"type":"Polygon","coordinates":[[[-92.08194708220822,44.10778943024303],[-92.08194708220822,44.19225429152915],[-91.85656830543054,44.19225429152915],[-91.92591562136214,44.33385714721473],[-92.08194708220822,44.4083849659966],[-92.02993659525953,44.58725173107311],[-91.64852635763576,44.59718877357736],[-91.66586318661865,45.208316887588765],[-91.54450538373837,45.2058326269627],[-91.53872644074407,45.63809397589759],[-90.67766393459345,45.63809397589759],[-90.67766393459345,45.37724661016102],[-90.92615848334833,45.379730870787085],[-90.92615848334833,45.03193438313832],[-90.31359052595259,45.03441864376438],[-90.31359052595259,43.553799310631064],[-90.67188499159916,43.553799310631064],[-90.66610604860486,43.17122317421743],[-91.1573162031203,42.987387887888794],[-91.17465303210321,43.131475004200425],[-91.05907417221722,43.25320377487749],[-91.209326690069,43.35257419992],[-91.2151056330633,43.501629837483755],[-91.72943155955596,43.501629837483755],[-91.72943155955596,43.84694206450645],[-92.08194708220822,43.84694206450645],[-92.08194708220822,44.10778943024303]]]}},{"type":"Feature","id":582,"properties":{"name":"dma:","latitude":40.3451955,"dma":582,"dma1":"Lafayette, IN","longitude":-87.113428},"geometry":{"type":"Polygon","coordinates":[[[-87.52814000270027,40.47828465556556],[-87.09471927812781,40.4758003949395],[-87.09471927812781,40.56274951685169],[-86.69597221152115,40.56274951685169],[-86.69597221152115,40.214953029202924],[-87.09471927812781,40.214953029202924],[-87.09471927812781,40.36649292739274],[-87.41834008580858,40.19259468356836],[-87.40678219981999,40.12800390729073],[-87.53391894569457,40.147877992299236],[-87.52814000270027,40.47828465556556]]]}},{"type":"Feature","id":642,"properties":{"name":"dma:","latitude":30.2379905,"dma":642,"dma1":"Lafayette, LA","longitude":-92.1119525},"geometry":{"type":"MultiPolygon","coordinates":[[[[-92.62516772367236,30.489072678167815],[-92.59627300870088,30.896491420842086],[-92.3882310609061,31.003314627762776],[-92.2784311440144,30.96605071837184],[-92.23797854305431,30.849290468946897],[-91.79877887548756,30.836869165816584],[-91.73521050255025,30.702719092009204],[-91.75832627452745,30.496525460046005],[-91.64274741464146,30.441871726272627],[-91.59073692769277,30.258036439943993],[-91.47515806780677,30.228225312431242],[-91.46360018181818,30.10152802050205],[-91.22088457605761,30.04190576547655],[-91.23244246204621,29.917692734173418],[-91.09374783018302,29.800932484748476],[-91.09952677317732,29.69907779907991],[-91.38847392289229,29.783542660366038],[-91.46937912481248,29.95495664356436],[-91.62541058565856,29.945019601060107],[-91.85656830543054,29.73882596909691],[-91.82767359045904,29.830743612261227],[-91.97214716531653,29.83322787288729],[-92.13973651215122,29.71895188408841],[-92.1339575691569,29.766152835983597],[-92.2033048850885,29.751247272227225],[-92.16863122712272,29.70156205970597],[-92.09928391119112,29.69907779907991],[-92.11084179717972,29.622065719671966],[-92.03571553825383,29.632002762176217],[-92.00682082328233,29.61461293779378],[-92.04727342424242,29.58480181028103],[-92.2957679729973,29.532632337133712],[-92.61938878067807,29.579833289028905],[-92.61360983768377,30.036937244224422],[-92.99502007530754,30.039421504850488],[-92.88522015841585,30.08165393549355],[-92.89099910141013,30.15618175427543],[-92.99502007530754,30.15618175427543],[-93.02969373327332,30.379765210621063],[-93.13371470717071,30.42448190189019],[-92.62516772367236,30.489072678167815]]],[[[-91.82189464746475,29.47301008210821],[-91.96636822232223,29.53014807650765],[-92.03571553825383,29.577349028402843],[-91.90279984938493,29.64193980468047],[-91.70631578757875,29.572380507150715],[-91.82189464746475,29.47301008210821]]]]}},{"type":"Feature","id":643,"properties":{"name":"dma:","latitude":30.2390885,"dma":643,"dma1":"Lake Charles, LA","longitude":-93.2619725},"geometry":{"type":"Polygon","coordinates":[[[-92.61938878067807,29.579833289028905],[-93.19728308010801,29.773605617861786],[-93.83874575247525,29.691625017201723],[-93.92542989738973,29.788511181618162],[-93.70005112061206,30.056811329232925],[-93.74050372157215,30.53875789068907],[-93.55557754575457,30.876617335833586],[-92.59627300870088,30.898975681468148],[-92.62516772367236,30.489072678167815],[-93.13371470717071,30.42448190189019],[-93.02969373327332,30.379765210621063],[-92.99502007530754,30.15618175427543],[-92.89099910141013,30.15618175427543],[-92.88522015841585,30.08165393549355],[-92.99502007530754,30.039421504850488],[-92.61360983768377,30.036937244224422],[-92.61938878067807,29.579833289028905]]]}},{"type":"Feature","id":551,"properties":{"name":"dma:","latitude":42.4074535,"dma":551,"dma1":"Lansing, MI","longitude":-84.602594},"geometry":{"type":"Polygon","coordinates":[[[-84.82359468136814,42.07317997749776],[-84.70801582148215,42.07069571687169],[-84.71957370747074,42.42097646514652],[-85.07208923012301,42.42097646514652],[-85.07208923012301,42.77125721342135],[-84.83515256735674,42.77125721342135],[-84.83515256735674,43.119053701070115],[-84.36705818481849,43.119053701070115],[-84.36127924182418,42.776225734673474],[-84.1590162370237,42.776225734673474],[-84.1301215220522,42.07317997749776],[-84.36127924182418,42.07317997749776],[-84.36127924182418,41.705509404840484],[-84.80625785238524,41.695572362336236],[-84.82359468136814,42.07317997749776]]]}},{"type":"Feature","id":749,"properties":{"name":"dma:","latitude":27.388155,"dma":749,"dma1":"Laredo, TX","longitude":-99.5051385},"geometry":{"type":"Polygon","coordinates":[[[-99.16693119321931,26.571393670867085],[-99.2709521671167,26.84217807910791],[-99.44432045694569,27.023529104810482],[-99.44432045694569,27.25208108240824],[-99.53678354485449,27.31667185868587],[-99.51366777287728,27.56758218191819],[-99.87774118151815,27.798618420142013],[-99.92975166846685,27.979969445844585],[-100.21291987518751,28.196100120312032],[-99.392309969997,28.203552902190218],[-99.38653102700269,28.029654658365835],[-98.80285778457846,28.056981525252525],[-98.79707884158415,27.266986646164618],[-98.95311030243025,27.26947090679068],[-98.95311030243025,26.78504008470847],[-99.16693119321931,26.571393670867085]]]}},{"type":"Feature","id":839,"properties":{"name":"dma:","latitude":37.082759,"dma":839,"dma1":"Las Vegas, NV","longitude":-116.121556},"geometry":{"type":"Polygon","coordinates":[[[-117.16833862046204,36.97050865156516],[-117.16833862046204,38.00147681138114],[-118.19699047344734,38.91816898239824],[-118.19699047344734,39.00014958305831],[-117.33014902430243,39.16411078437844],[-115.90852904770477,39.161626523752375],[-115.00123499759975,38.67719570167017],[-114.04770940354035,38.67719570167017],[-114.04770940354035,36.192935075607565],[-114.15173037743774,36.02400535303531],[-114.24419346534653,36.01655257115712],[-114.40600386918692,36.148218384338435],[-114.75274044884488,36.08611186868687],[-114.66027736093609,35.87246545484549],[-114.71228784788478,35.805390417941794],[-114.67761418991898,35.4998263609361],[-114.5678142730273,35.184325261426146],[-114.64871947494748,35.10234466076608],[-114.63138264596459,35.00297423572357],[-117.16833862046204,36.97050865156516]]]}},{"type":"Feature","id":541,"properties":{"name":"dma:","latitude":37.584915,"dma":541,"dma1":"Lexington, KY","longitude":-83.9929735},"geometry":{"type":"Polygon","coordinates":[[[-85.04319451515151,37.186639326032605],[-85.16455231803181,37.31085235733573],[-85.04319451515151,37.4127070430043],[-85.00274191419142,37.85242117381738],[-85.1472154890489,37.88968508320832],[-85.17033126102609,37.996508290129015],[-85.04897345814581,38.07352036953696],[-84.99696297119712,38.33685199589959],[-84.74846842244224,38.3492732990299],[-84.41328972877287,38.565403973497354],[-84.2052477809781,38.58279379787979],[-84.1705741230123,38.48590763346335],[-83.99720583318332,38.42131685718572],[-83.92785851725172,38.49336041534154],[-83.64469031053105,38.52565580348035],[-83.58112193759376,38.42876963906391],[-83.40197470477048,38.38902146904691],[-83.30373267386739,38.2101547039704],[-83.19971169997,38.1704065339534],[-83.26905901590159,38.05861480578058],[-83.02634341014101,38.008929593259325],[-82.96277503720373,37.912043428842885],[-83.00322763816382,37.859873955695576],[-83.1303643840384,37.89216934383438],[-83.26905901590159,37.767956312531254],[-83.25750112991298,37.678522929993],[-82.76051203240324,37.42512834613461],[-82.70850154545454,37.28600975107511],[-83.04945918211821,37.16924950165017],[-83.04945918211821,37.030130906590664],[-83.11302755505551,36.99286699719973],[-83.1823748709871,37.02019386408641],[-83.20549064296429,37.17670228352836],[-83.39619576177617,37.32078939983999],[-83.47132202070208,37.29097827232724],[-83.55222722262226,37.16676524102411],[-83.51177462166217,36.93821326342635],[-83.58690088058805,36.95560308780878],[-83.58112193759376,36.903433614661466],[-83.78338494239424,36.8015789289929],[-83.95675323222322,36.64507050955096],[-83.93363746024602,36.58793251515152],[-84.2283635529553,36.592901036403646],[-84.35550029882988,36.80903171087109],[-84.2977108688869,36.945666045304534],[-84.36127924182418,36.96305586968697],[-84.59243696159615,36.86368544464447],[-84.77736313741374,36.602838078907894],[-84.99118402820281,36.62022790329033],[-85.06631028712872,36.85871692339234],[-85.2165628049805,36.85374840214021],[-85.2743522349235,36.89846509340934],[-85.04319451515151,37.186639326032605]]]}},{"type":"Feature","id":558,"properties":{"name":"dma:","latitude":40.782607,"dma":558,"dma1":"Lima, OH","longitude":-84.138823},"geometry":{"type":"Polygon","coordinates":[[[-84.39595289978998,40.684478287528755],[-84.39595289978998,40.816144100710076],[-83.88162697329733,40.92048304700471],[-83.88162697329733,40.644730117511756],[-84.39595289978998,40.684478287528755]]]}},{"type":"Feature","id":722,"properties":{"name":"dma:","latitude":41.282784,"dma":722,"dma1":"Lincoln & Hastings-Kearney, NE","longitude":-99.257628},"geometry":{"type":"Polygon","coordinates":[[[-97.3696799219922,40.00130661536154],[-97.3696799219922,39.65351012771278],[-97.93023739243924,39.65351012771278],[-97.93023739243924,39.56656100580058],[-99.62924663276327,39.56656100580058],[-99.62346768976897,40.00130661536154],[-101.322476930093,40.003790875987605],[-101.322476930093,40.35158736363637],[-102.05062374737474,40.34910310301031],[-102.05062374737474,41.00494790829083],[-101.24735067116711,41.00494790829083],[-101.24735067116711,40.69689959065907],[-100.22447776117612,40.699383851285134],[-100.2533724761476,41.740289053605366],[-99.68703606270627,41.740289053605366],[-99.68703606270627,42.08560128062807],[-100.16668833123312,42.08560128062807],[-100.19558304620462,42.99732493039305],[-98.49657380588059,42.99732493039305],[-98.311647630063,42.88304894159417],[-98.30586868706871,42.435882028902896],[-97.83199536153614,42.43836628952896],[-97.83199536153614,41.52664263976398],[-97.70485861566156,41.52664263976398],[-97.70485861566156,41.39497682658266],[-97.60083764176417,41.39497682658266],[-97.60083764176417,41.3328703109311],[-97.3696799219922,41.39497682658266],[-97.3696799219922,41.0471803389339],[-96.4623858718872,41.04469607830784],[-96.4623858718872,40.00130661536154],[-97.3696799219922,40.00130661536154]]]}},{"type":"Feature","id":693,"properties":{"name":"dma:","latitude":34.647081,"dma":693,"dma1":"Little Rock-Pine Bluff, AR","longitude":-92.670434},"geometry":{"type":"Polygon","coordinates":[[[-93.370651369937,33.957100512151214],[-93.82140892349234,34.00926998529853],[-93.82140892349234,34.18316822912291],[-93.92542989738973,34.185652489748975],[-93.93698778337833,34.34961369106911],[-94.2548296480648,34.35458221232123],[-94.2432717620762,34.19310527162716],[-94.46865053885388,34.1906210110011],[-94.45709265286528,34.72970556685669],[-93.87919835343534,34.66511479057906],[-93.71160900660065,34.744611130613066],[-93.70583006360636,35.13464004890489],[-93.2781882820282,35.211652128312835],[-93.2781882820282,35.31847533523353],[-93.42266185688568,35.32841237773778],[-93.43421974287429,35.42778280278028],[-93.71160900660065,35.37561332963297],[-93.69427217761776,35.76812650855086],[-92.94878853135313,35.725894077907796],[-92.94300958835883,36.11592299619962],[-92.41134683288328,36.063753523052306],[-92.4171257758776,35.976804401140114],[-92.3073258589859,35.97432014051405],[-92.3073258589859,36.061269262426244],[-92.19752594209422,36.05878500180018],[-92.19752594209422,36.13331282058206],[-92.05883131023103,36.033942395539555],[-92.11084179717972,35.93208770987099],[-91.85078936243625,35.86749693359336],[-91.75254733153315,35.94202475237524],[-91.03017945724572,35.8848867579758],[-91.04751628622861,35.00048997509751],[-91.15153726012602,35.00297423572357],[-91.15153726012602,34.911056592559255],[-91.10530571617161,34.73467408810881],[-91.04751628622861,34.73467408810881],[-91.00128474227422,34.3371923879388],[-91.05907417221722,34.3371923879388],[-91.11686360216021,34.11857745284529],[-90.86836905340533,34.08131354345435],[-90.98972685628563,34.01920702780278],[-90.96661108430843,33.96206903340334],[-91.08796888718871,33.97200607590759],[-91.01284262826283,33.92977364526453],[-91.07063205820582,33.860214347734775],[-90.98972685628563,33.785686528952894],[-91.13420043114311,33.78320226832683],[-91.14575831713171,33.731032795179516],[-91.03595840024002,33.673894800780076],[-91.22088457605761,33.69376888578858],[-91.1284214881488,33.604335503250326],[-91.2440003480348,33.517386381338135],[-91.45204229582959,33.56458733323333],[-91.45782123882388,33.38820482878288],[-91.98948399429943,33.39814187128713],[-91.97792610831083,33.30125570687069],[-92.1628522841284,33.162137111811184],[-92.2264206570657,33.2540547549755],[-92.44602049084908,33.273928839984],[-92.55004146474647,33.36584648314832],[-93.11637787818782,33.38075204690469],[-93.10481999219922,33.77823374707471],[-93.1799462511251,33.80059209270927],[-93.370651369937,33.957100512151214]]]}},{"type":"Feature","id":803,"properties":{"name":"dma:","latitude":35.132844,"dma":803,"dma1":"Los Angeles, CA","longitude":-116.858513},"geometry":{"type":"MultiPolygon","coordinates":[[[[-119.47413687518751,34.374456297329736],[-119.44524216021601,34.90111955005501],[-119.27765281338134,34.87876120442044],[-119.24297915541554,34.814170428142816],[-118.88468468976897,34.78932782188219],[-118.93669517671766,34.93589919881988],[-118.76910582988299,34.88621398629863],[-118.85001103180318,34.96322606570657],[-118.72287428592858,35.025332581358136],[-118.74599005790579,35.067565012001204],[-118.52639022412241,34.97813162946295],[-118.06407478457845,35.24394751645165],[-118.02362218361836,35.51473192469247],[-117.91382226672667,35.60168104660466],[-118.11608527152715,35.74576816291629],[-117.98316958265826,35.86749693359336],[-118.09874844254425,36.346959234423444],[-118.36457982028202,36.69227146144615],[-118.43970607920792,37.059942034103415],[-118.6650848559856,37.15434393789379],[-118.6650848559856,37.261167144814486],[-118.78644265886588,37.34314774547455],[-118.77488477287729,37.46239225552556],[-117.83291706480648,37.46487651615162],[-114.63138264596459,35.00297423572357],[-114.63716158895889,34.87379268316832],[-114.4695722421242,34.712315742474246],[-114.38288809720972,34.4564368979898],[-114.14017249144914,34.30241273917392],[-114.5273616720672,33.94964773027303],[-114.4926880141014,33.70867444954496],[-114.6256037029703,33.432921520052005],[-115.67737132793279,33.42795299879988],[-116.02988685058506,33.58694567886789],[-116.19747619741975,33.860214347734775],[-116.45752863216322,33.974490336533655],[-116.45752863216322,34.03411259155916],[-116.71758106690669,34.03411259155916],[-116.68290740894089,33.745938358935895],[-116.79270732583258,33.676379061406145],[-116.5673285490549,33.562103072607265],[-116.5384338340834,33.46770116881689],[-117.20879122142213,33.432921520052005],[-117.50929625712571,33.504965078207825],[-117.5959804020402,33.38820482878288],[-118.11608527152715,33.75090688018802],[-118.41081136423642,33.74096983768377],[-118.43970607920792,33.97945885778578],[-118.52639022412241,34.031628330933096],[-118.80377948784879,33.99933294279428],[-119.12740029552955,34.098703367836784],[-119.47413687518751,34.374456297329736]]],[[[-119.37589484428443,34.01175424592459],[-119.37011590129012,34.01672276717672],[-119.35855801530153,34.01672276717672],[-119.36433695829582,34.014238506550655],[-119.37589484428443,34.01175424592459]]],[[[-119.39323167326732,34.001817203420345],[-119.42212638823882,34.00430146404641],[-119.44524216021601,34.014238506550655],[-119.38167378727873,34.01175424592459],[-119.39323167326732,34.001817203420345]]],[[[-118.32412721932192,33.29877144624463],[-118.46282185118511,33.32609831313131],[-118.5032744521452,33.43540578067807],[-118.6072954260426,33.477638211321135],[-118.36457982028202,33.40807891379138],[-118.32412721932192,33.29877144624463]]],[[[-119.46835793219321,33.2143065849585],[-119.5434841911191,33.231696409340934],[-119.5781578490849,33.278897361236126],[-119.42212638823882,33.22921214871487],[-119.46835793219321,33.2143065849585]]],[[[-118.42236925022502,32.8019193210321],[-118.49749550915091,32.851604533553356],[-118.6072954260426,33.032955559255925],[-118.34724299129913,32.821793406040605],[-118.42236925022502,32.8019193210321]]]]}},{"type":"Feature","id":529,"properties":{"name":"dma:","latitude":38.1524665,"dma":529,"dma1":"Louisville, KY","longitude":-85.7750445},"geometry":{"type":"Polygon","coordinates":[[[-86.60928806660667,37.39531721862186],[-86.66707749654965,37.54934137743775],[-86.57461440864085,37.55182563806381],[-86.67863538253826,37.79279891879188],[-86.43014083378338,38.07848889078908],[-86.45903554875488,38.20767044334434],[-86.67863538253826,38.26232417711772],[-86.68441432553254,38.68713274417442],[-86.30878303090309,38.68713274417442],[-86.3203409168917,39.049834795579564],[-85.86380442034203,39.03989775307531],[-85.80023604740474,39.12933113561357],[-85.44194158175817,39.19640617251726],[-85.44772052475247,38.91320046114612],[-85.2050049189919,38.91320046114612],[-85.19922597599759,38.692101265426544],[-85.02585768616862,38.7616605629563],[-84.93917354125412,38.652353095409545],[-85.07786817311731,38.577825276627664],[-84.86982622532253,38.366663123412344],[-84.99696297119712,38.33685199589959],[-85.04897345814581,38.07352036953696],[-85.17033126102609,37.996508290129015],[-85.1472154890489,37.88968508320832],[-85.00274191419142,37.854905434443445],[-85.04319451515151,37.4127070430043],[-85.52862572667266,37.10962724662467],[-85.68465718751875,37.18167080478048],[-85.65576247254725,37.42264408550855],[-86.04873059615961,37.44997095239524],[-86.01983588118811,37.39531721862186],[-86.094962140114,37.330726442344236],[-86.47059343474348,37.32078939983999],[-86.60928806660667,37.39531721862186]]]}},{"type":"Feature","id":651,"properties":{"name":"dma:","latitude":33.4181475,"dma":651,"dma1":"Lubbock, TX","longitude":-101.791018},"geometry":{"type":"Polygon","coordinates":[[[-100.51920385388539,33.39814187128713],[-100.51920385388539,32.963396261726174],[-101.17222441224122,32.963396261726174],[-101.17222441224122,32.523682130913095],[-103.06193877137713,32.52119787028703],[-103.04460194239424,34.31234978167817],[-100.51920385388539,34.314834042304234],[-100.51920385388539,33.39814187128713]]]}},{"type":"Feature","id":503,"properties":{"name":"dma:","latitude":32.6218675,"dma":503,"dma1":"Macon, GA","longitude":-83.3190475},"geometry":{"type":"Polygon","coordinates":[[[-84.0549952631263,32.52119787028703],[-84.0549952631263,32.53113491279128],[-84.00298477617761,32.53113491279128],[-84.00298477617761,32.53361917341734],[-84.0549952631263,32.635473859085906],[-84.2052477809781,32.690127592859284],[-84.1243425790579,32.93110087358736],[-84.0434373771377,32.9484906979698],[-84.0434373771377,33.20188528182818],[-83.84117437233724,33.19691676057606],[-83.81805860036003,33.13232598429843],[-83.32106950285029,33.16958989368937],[-83.0090065811581,33.47018542944295],[-82.82408040534054,33.42546873817382],[-82.73739626042604,33.174558414941494],[-82.55247008460846,33.020534256125615],[-82.52357536963696,32.821793406040605],[-82.43689122472247,32.7621711510151],[-82.46578593969397,32.64789516221622],[-82.64493317251726,32.51374508840884],[-82.38488073777378,32.439217269626965],[-82.40799650975097,32.354752408340836],[-82.65649105850585,32.30009867456746],[-82.54669114161416,31.954786447544755],[-83.00322763816382,31.77591968246825],[-83.1823748709871,31.85293176187619],[-83.61001665256526,31.85293176187619],[-83.61001665256526,32.02931426632664],[-83.96253217521752,32.0317985269527],[-84.02610054815482,32.1709171220122],[-84.2572582679268,32.295130153315334],[-84.25147932493249,32.3969848389839],[-84.0549952631263,32.52119787028703]],[[-84.0549952631263,32.52119787028703],[-84.0145426621662,32.496355264026406],[-84.00876371917192,32.52119787028703],[-84.04921632013202,32.52119787028703],[-84.0549952631263,32.52119787028703]]]}},{"type":"Feature","id":669,"properties":{"name":"dma:","latitude":43.370746,"dma":669,"dma1":"Madison, WI","longitude":-89.9627745},"geometry":{"type":"Polygon","coordinates":[[[-90.64299027662766,42.50792558705871],[-90.70655864956495,42.63710713961397],[-91.05329522922293,42.73896182528253],[-91.14575831713171,42.91037580848085],[-91.15153726012602,42.99235640914092],[-90.66610604860486,43.17122317421743],[-90.67188499159916,43.553799310631064],[-90.31359052595259,43.553799310631064],[-90.31359052595259,44.24939228592859],[-89.90328557335732,44.24939228592859],[-90.02464337623762,44.068041260226025],[-89.78770671347135,43.64074843254326],[-89.60278053765376,43.643232693169324],[-89.59700159465946,43.98109213831384],[-89.16935981308131,43.9835763989399],[-89.16935981308131,43.76496146384639],[-89.24448607200719,43.76744572447245],[-89.24448607200719,43.643232693169324],[-89.00754940924092,43.633295650665076],[-89.01332835223522,42.848269292829286],[-88.77639168946894,42.84330077157716],[-88.77639168946894,42.493020023302336],[-89.92640134533454,42.505441326432646],[-90.64299027662766,42.50792558705871]]]}},{"type":"Feature","id":737,"properties":{"name":"dma:","latitude":43.876563,"dma":737,"dma1":"Mankato, MN","longitude":-94.4376415},"geometry":{"type":"Polygon","coordinates":[[[-94.86161866246624,44.10778943024303],[-95.09855532523252,44.10778943024303],[-95.11011321122112,44.28168767406741],[-94.86739760546054,44.28168767406741],[-94.86739760546054,44.49781834853486],[-94.20859810411041,44.199707073407346],[-94.12769290219022,44.18480150965097],[-94.12769290219022,44.2692663709371],[-93.76939843654365,44.239455243424345],[-93.76939843654365,43.84694206450645],[-94.2490507050705,43.84694206450645],[-94.2490507050705,43.499145576857686],[-94.44553476687668,43.501629837483755],[-94.44553476687668,43.25568803550355],[-94.91362914941493,43.25568803550355],[-94.86161866246624,44.10778943024303]]]}},{"type":"Feature","id":553,"properties":{"name":"dma:","latitude":46.8707415,"dma":553,"dma1":"Marquette, MI","longitude":-87.8765355},"geometry":{"type":"MultiPolygon","coordinates":[[[[-89.1578019270927,47.824243326832686],[-89.2329281860186,47.854054454345444],[-89.18091769906991,47.936035055005505],[-88.42387616681668,48.191913899489954],[-88.60880234263426,48.0428582619262],[-89.1578019270927,47.824243326832686]]],[[[-85.86380442034203,45.96850063916392],[-85.91581490729072,45.91881542664267],[-86.2798883159316,45.94117377227723],[-86.35501457485748,45.792118134713476],[-86.58039335163517,45.71262179467948],[-86.60928806660667,45.60083006650666],[-86.71908798349835,45.677842145914596],[-86.63240383858385,45.78218109220923],[-86.55727757965796,45.77224404970498],[-86.53994075067507,45.88900429912992],[-86.78265635643564,45.859193171617164],[-86.84044578637864,45.722558837183726],[-86.96758253225323,45.66790510341035],[-86.97336147524751,45.916331166016604],[-87.06004562016201,45.70765327342735],[-87.3258769978998,45.551144853985406],[-87.36632959885989,45.98589046354636],[-87.61482414761477,45.98589046354636],[-87.61482414761477,45.89894134163417],[-87.69572934953496,45.89894134163417],[-87.69572934953496,45.722558837183726],[-87.99623438523852,45.79460239533954],[-88.0598027581758,45.71262179467948],[-88.67814965856586,45.722558837183726],[-88.68392860156015,46.01321733043305],[-88.99021258025803,46.09768219171917],[-88.99021258025803,46.333686951195126],[-89.36584387488749,46.333686951195126],[-89.36584387488749,46.50510093439344],[-89.74147516951695,46.50510093439344],[-89.74147516951695,46.59205005630564],[-89.86283297239723,46.59205005630564],[-89.88594874437445,46.76594830013002],[-88.97287575127513,47.00195305960597],[-88.2158342190219,47.44911997229724],[-87.79975032343233,47.47396257855786],[-87.71306617851785,47.40191902040205],[-87.95578178427843,47.387013456645676],[-87.94422389828983,47.33484398349836],[-88.34874990789078,47.07648087838784],[-88.49322348274828,46.75601125762577],[-88.1464869030903,46.967173410841085],[-88.29096047794779,46.8206020339034],[-88.08291853015302,46.9199724589459],[-87.81708715241524,46.89016133143315],[-87.59170837563755,46.783338124512454],[-87.36055065586558,46.50510093439344],[-87.00803513321333,46.5349120619062],[-86.87511944434443,46.43802589748975],[-86.74798269846985,46.48025832813282],[-86.63818278157815,46.41069903060307],[-86.1643094560456,46.669062135713574],[-85.86380442034203,46.69142048134814],[-85.86380442034203,45.96850063916392]]],[[[-86.67285643954395,46.45044720062007],[-86.70753009750975,46.544849104410446],[-86.65551961056104,46.55975466816682],[-86.60928806660667,46.472805546254634],[-86.67285643954395,46.45044720062007]]]]}},{"type":"Feature","id":813,"properties":{"name":"dma:","latitude":42.3097025,"dma":813,"dma1":"Medford-Klamath Falls, OR","longitude":-121.9634415},"geometry":{"type":"Polygon","coordinates":[[[-124.21287013051305,41.99865215871587],[-124.35156476237623,42.1029911050105],[-124.41513313531352,42.252046742574265],[-124.40357524932493,42.62717009710971],[-124.56538565316531,42.835847989698976],[-124.47870150825082,42.95509249974998],[-124.21864907350735,42.932734154115415],[-124.14352281458146,42.848269292829286],[-124.13196492859285,42.66691826712672],[-123.7794494059406,42.801068340934094],[-123.46738648424842,42.69921365526553],[-122.79702909690968,42.778709995299536],[-122.56009243414341,42.94018693599361],[-122.28270317041704,42.99732493039305],[-122.28270317041704,43.0668842279228],[-122.07466122262225,43.0668842279228],[-121.97641919171917,43.26065655675568],[-122.14978748154815,43.52150392249226],[-122.00531390669066,43.61590582628263],[-119.89599971377137,43.610937305030504],[-119.94223125772577,42.746414607160716],[-119.36433695829582,42.74889886778678],[-119.35855801530153,41.99368363746375],[-120.00002068766877,41.99368363746375],[-120.00002068766877,41.18381467336734],[-122.49652406120612,41.18381467336734],[-122.47918723222323,41.32044900780078],[-122.57165032013201,41.367649959695974],[-122.802808039904,41.20368875837584],[-122.95883950075007,41.181330412741275],[-122.90105007080707,41.01488495079508],[-123.03974470267026,41.00494790829083],[-123.38070233933394,41.15151928522853],[-123.48472331323131,41.37758700220022],[-123.6638705460546,41.38255552345235],[-123.61186005910591,41.46205186348635],[-123.7216599759976,41.596201937293735],[-123.6580916030603,41.71296218671868],[-123.70432314701469,41.82972243614362],[-123.51939697119711,42.00113641934194],[-124.21287013051305,41.99865215871587]]]}},{"type":"Feature","id":640,"properties":{"name":"dma:","latitude":35.1946395,"dma":640,"dma1":"Memphis, TN","longitude":-89.757956},"geometry":{"type":"Polygon","coordinates":[[[-90.13444329312931,34.160809883488355],[-90.13444329312931,34.07386076157616],[-90.45228515781578,34.07386076157616],[-90.45228515781578,33.98691163966397],[-90.66032710561055,33.98691163966397],[-90.66032710561055,34.11857745284529],[-91.11686360216021,34.11857745284529],[-91.05907417221722,34.3371923879388],[-91.00128474227422,34.3371923879388],[-91.04751628622861,34.73467408810881],[-91.10530571617161,34.73467408810881],[-91.15153726012602,34.911056592559255],[-91.15153726012602,35.00297423572357],[-91.04751628622861,35.00048997509751],[-91.03595840024002,35.708504253525355],[-90.2846958109811,35.70105147164717],[-90.29047475397539,35.99667848614862],[-89.96107500330032,35.99916274677468],[-89.96107500330032,36.389191665066505],[-89.59122265166516,36.404097228822884],[-89.54499110771077,36.337022191919196],[-89.62011736663666,36.32211662816282],[-89.53343322172216,36.25255733063307],[-89.70680151155116,36.23765176687669],[-89.63167525262526,36.18548229372938],[-88.96131786528653,36.222746203120316],[-88.69548648754875,36.06623778367837],[-88.70704437353734,35.79048485418542],[-88.91508632133213,35.79793763606361],[-89.01910729522952,35.67124034413442],[-89.07111778217822,35.693598689768976],[-89.07689672517252,35.43026706340634],[-88.81684429042903,35.42778280278028],[-88.59724445664565,35.59174400410041],[-88.36608673687368,35.49237357905791],[-88.36608673687368,34.995521453845384],[-88.36608673687368,34.754548173117314],[-88.71860225952595,34.757032433743376],[-88.71860225952595,34.595555493049304],[-89.24448607200719,34.598039753675366],[-89.24448607200719,34.160809883488355],[-90.13444329312931,34.160809883488355]]]}},{"type":"Feature","id":711,"properties":{"name":"dma:","latitude":32.3468715,"dma":711,"dma1":"Meridian, MS","longitude":-88.5817905},"geometry":{"type":"Polygon","coordinates":[[[-88.47588665376537,31.89267993189319],[-88.90930737833783,31.8256048949895],[-88.91508632133213,32.223086595159515],[-89.32539127392738,32.223086595159515],[-89.3196123309331,32.93110087358736],[-88.34874990789078,32.9286166129613],[-88.3429709648965,32.99072312861286],[-88.1696026750675,32.99569164986499],[-88.2100552760276,32.92364809170917],[-88.1811605610561,32.82924618791879],[-88.06558170117012,32.78949801790179],[-88.1175921881188,32.69758037473748],[-88.04246592919291,32.690127592859284],[-88.0598027581758,32.59572568906891],[-87.92688706930693,32.632989598459844],[-87.84020292439243,32.60566273157316],[-87.89799235433543,32.59820994969497],[-87.84598186738674,32.51871360966096],[-88.03668698619862,32.424311705870586],[-88.04246592919291,32.37462649334934],[-87.97311861326132,32.34481536583658],[-87.92688706930693,32.310035717071706],[-87.92688706930693,32.28767737143714],[-88.01935015721571,32.28519311081108],[-88.04246592919291,32.083968000100015],[-88.1175921881188,32.05415687258726],[-88.07136064416441,31.98956609630963],[-88.12337113111312,31.94733366566657],[-88.05402381518152,31.922491059405942],[-88.1811605610561,31.81815211311131],[-88.0886974731473,31.698907603060306],[-88.46432876777678,31.698907603060306],[-88.47588665376537,31.89267993189319]]]}},{"type":"Feature","id":528,"properties":{"name":"dma:","latitude":25.439022,"dma":528,"dma1":"Miami-Fort Lauderdale, FL","longitude":-80.940626},"geometry":{"type":"MultiPolygon","coordinates":[[[[-80.1253140270027,25.900643301830183],[-80.1253140270027,25.920517386838682],[-80.131092969997,25.92797016871687],[-80.31024020282028,25.614953329832982],[-80.31024020282028,25.371495788478846],[-80.42581906270627,25.264672581558155],[-80.41426117671767,25.197597544654464],[-80.35069280378038,25.20256606590659],[-80.36802963276327,25.282062405940593],[-80.25822971587158,25.33423187908791],[-80.38536646174617,25.120585465246524],[-80.44893483468346,25.085805816481646],[-80.49516637863786,25.02121504020402],[-80.56451369456946,24.956624263926393],[-80.58762946654664,24.951655742674266],[-80.38536646174617,25.167786417141713],[-80.45471377767777,25.224924411541153],[-80.43737694869486,25.24231423592359],[-80.49516637863786,25.2149873690369],[-80.45471377767777,25.22244015091509],[-80.43737694869486,25.200081805280526],[-80.42581906270627,25.12803824712471],[-80.51828215061505,25.22244015091509],[-80.67431361146114,25.13797528962896],[-81.1424079939994,25.15784937463746],[-81.1424079939994,25.32677909720972],[-81.11929222202221,25.32677909720972],[-81.09039750705071,25.27709388468847],[-81.06728173507351,25.27709388468847],[-81.06728173507351,25.25970406030603],[-81.0730606780678,25.25970406030603],[-81.06728173507351,25.254735539053904],[-81.02105019111912,25.21995589028903],[-80.99793441914191,25.21250310841084],[-80.90547133123312,25.252251278427842],[-81.1481869369937,25.388885612861284],[-81.0846185640564,25.43111804350435],[-81.211755309931,25.50813012291229],[-81.1597448229823,25.557815335433542],[-81.2290921389139,25.557815335433542],[-81.28688156885688,25.679544106110612],[-81.1828605949595,25.69693393049305],[-81.26376579687968,25.801272876787678],[-81.29266051185118,25.80375713741374],[-80.87079767326733,25.806241398039802],[-80.88235555925593,26.332904650765077],[-80.07330354005401,26.320483347634763],[-80.1253140270027,25.900643301830183]],[[-81.11929222202221,25.376464309730974],[-81.1135132790279,25.376464309730974],[-81.11929222202221,25.378948570357036],[-81.11929222202221,25.376464309730974]]],[[[-80.1253140270027,25.845989568056805],[-80.1253140270027,25.84102104680468],[-80.11953508400839,25.843505307430743],[-80.1253140270027,25.850958089308932],[-80.131092969997,25.863379392439242],[-80.1426508559856,25.863379392439242],[-80.1253140270027,25.86834791369137],[-80.1253140270027,25.900643301830183],[-80.11953508400839,25.850958089308932],[-80.131092969997,25.764008967396737],[-80.1426508559856,25.788851573657364],[-80.1368719129913,25.808725658665868],[-80.1426508559856,25.81120991929193],[-80.131092969997,25.84102104680468],[-80.1253140270027,25.845989568056805]]],[[[-80.1368719129913,25.883253477447745],[-80.131092969997,25.89567478057806],[-80.131092969997,25.89070625932593],[-80.131092969997,25.880769216821683],[-80.1368719129913,25.883253477447745]]],[[[-80.131092969997,25.880769216821683],[-80.1368719129913,25.87083217431743],[-80.1426508559856,25.873316434943494],[-80.1426508559856,25.883253477447745],[-80.131092969997,25.880769216821683]]],[[[-80.1426508559856,25.848473828682867],[-80.1426508559856,25.858410871187118],[-80.1253140270027,25.853442349934994],[-80.1426508559856,25.848473828682867]]],[[[-80.1542087419742,25.843505307430743],[-80.15998768496848,25.843505307430743],[-80.15998768496848,25.855926610561056],[-80.1542087419742,25.843505307430743]]],[[[-80.1253140270027,25.845989568056805],[-80.131092969997,25.845989568056805],[-80.131092969997,25.850958089308932],[-80.1253140270027,25.845989568056805]]],[[[-80.1542087419742,25.843505307430743],[-80.1542087419742,25.848473828682867],[-80.1426508559856,25.848473828682867],[-80.14842979897989,25.843505307430743],[-80.1542087419742,25.843505307430743]]],[[[-80.14842979897989,25.80375713741374],[-80.1426508559856,25.806241398039802],[-80.1426508559856,25.80375713741374],[-80.14842979897989,25.80375713741374]]],[[[-81.34467099879987,25.80375713741374],[-81.30421839783978,25.80375713741374],[-81.32733416981698,25.78388305240524],[-81.34467099879987,25.80375713741374]]],[[[-80.14842979897989,25.80375713741374],[-80.1426508559856,25.80375713741374],[-80.1426508559856,25.801272876787678],[-80.14842979897989,25.801272876787678],[-80.14842979897989,25.80375713741374]]],[[[-81.2984394548455,25.69693393049305],[-81.34467099879987,25.721776536753673],[-81.36778677077707,25.778914531153113],[-81.30999734083409,25.78388305240524],[-81.2984394548455,25.801272876787678],[-81.28110262586259,25.796304355535554],[-81.2984394548455,25.69693393049305]]],[[[-80.1426508559856,25.801272876787678],[-80.1426508559856,25.798788616161616],[-80.14842979897989,25.798788616161616],[-80.1426508559856,25.801272876787678]]],[[[-80.1657666279628,25.788851573657364],[-80.1657666279628,25.793820094909492],[-80.15998768496848,25.788851573657364],[-80.1657666279628,25.788851573657364]]],[[[-80.1715455709571,25.788851573657364],[-80.17732451395139,25.788851573657364],[-80.1715455709571,25.791335834283426],[-80.1715455709571,25.788851573657364]]],[[[-80.1715455709571,25.791335834283426],[-80.1657666279628,25.791335834283426],[-80.1715455709571,25.788851573657364],[-80.1715455709571,25.791335834283426]]],[[[-80.1542087419742,25.78139879177918],[-80.1657666279628,25.78388305240524],[-80.1657666279628,25.786367313031302],[-80.1542087419742,25.78139879177918]]],[[[-80.15998768496848,25.77643027052705],[-80.1657666279628,25.778914531153113],[-80.1657666279628,25.78139879177918],[-80.1542087419742,25.778914531153113],[-80.15998768496848,25.77643027052705]]],[[[-80.1657666279628,25.766493228022803],[-80.17732451395139,25.77394600990099],[-80.1831034569457,25.778914531153113],[-80.15998768496848,25.771461749274927],[-80.1657666279628,25.766493228022803]]],[[[-80.1542087419742,25.78139879177918],[-80.14842979897989,25.78139879177918],[-80.14842979897989,25.77394600990099],[-80.1542087419742,25.78139879177918]]],[[[-81.269544739874,25.749103403640362],[-81.28110262586259,25.764008967396737],[-81.27532368286828,25.77643027052705],[-81.25798685388538,25.75407192489249],[-81.269544739874,25.749103403640362]]],[[[-80.1831034569457,25.764008967396737],[-80.18888239993998,25.768977488648865],[-80.1831034569457,25.768977488648865],[-80.1831034569457,25.764008967396737]]],[[[-80.1426508559856,25.75655618551855],[-80.14842979897989,25.764008967396737],[-80.131092969997,25.761524706770675],[-80.1426508559856,25.75655618551855]]],[[[-80.1657666279628,25.731713579257924],[-80.1831034569457,25.7466191430143],[-80.1426508559856,25.749103403640362],[-80.15998768496848,25.731713579257924],[-80.1657666279628,25.731713579257924]]],[[[-81.27532368286828,25.69693393049305],[-81.28688156885688,25.7267450580058],[-81.25220791089109,25.7466191430143],[-81.25220791089109,25.72426079737974],[-81.2406500249025,25.714323754875487],[-81.27532368286828,25.69693393049305]]],[[[-81.23487108190818,25.71680801550155],[-81.25220791089109,25.7267450580058],[-81.24642896789679,25.741650621762176],[-81.2290921389139,25.7267450580058],[-81.23487108190818,25.71680801550155]]],[[[-81.2290921389139,25.72426079737974],[-81.22331319591959,25.731713579257924],[-81.211755309931,25.7267450580058],[-81.2290921389139,25.72426079737974]]],[[[-80.15998768496848,25.664638542354236],[-80.17732451395139,25.686996887988798],[-80.1542087419742,25.729229318631862],[-80.14842979897989,25.721776536753673],[-80.15998768496848,25.664638542354236]]],[[[-80.17732451395139,25.493224559155916],[-80.18888239993998,25.50564586228623],[-80.17732451395139,25.51806716541654],[-80.17732451395139,25.515582904790477],[-80.17732451395139,25.493224559155916]]],[[[-80.17732451395139,25.493224559155916],[-80.2004402859286,25.416212479747973],[-80.22933500090008,25.39136987348735],[-80.20621922892289,25.416212479747973],[-80.17732451395139,25.493224559155916]]],[[[-80.2524507728773,25.369011527852784],[-80.2524507728773,25.381432830983098],[-80.24089288688869,25.38640135223522],[-80.24089288688869,25.381432830983098],[-80.2524507728773,25.369011527852784]]],[[[-80.24089288688869,25.349137442844285],[-80.25822971587158,25.36404300660066],[-80.22933500090008,25.38640135223522],[-80.22933500090008,25.38391709160916],[-80.24089288688869,25.349137442844285]]],[[[-81.1135132790279,25.319326315331534],[-81.11929222202221,25.331747618461847],[-81.1250711650165,25.331747618461847],[-81.153965879988,25.324294836583658],[-81.1366290510051,25.344168921592157],[-81.1019553930393,25.32677909720972],[-81.1135132790279,25.319326315331534]]],[[[-80.99793441914191,25.2149873690369],[-81.00371336213621,25.229892932793277],[-81.0441659630963,25.23982997529753],[-80.99793441914191,25.282062405940593],[-80.99793441914191,25.2149873690369]]],[[[-81.04994490609062,25.24231423592359],[-81.06728173507351,25.257219799679966],[-81.03260807710771,25.26964110281028],[-81.03260807710771,25.252251278427842],[-81.04994490609062,25.24231423592359]]],[[[-80.61074523852385,24.939234439543952],[-80.61074523852385,24.951655742674266],[-80.59340840954096,24.959108524552455],[-80.58762946654664,24.949171482048204],[-80.61074523852385,24.939234439543952]]],[[[-80.61074523852385,24.939234439543952],[-80.63386101050105,24.91439183328333],[-80.65697678247824,24.897002008900888],[-80.62230312451246,24.94420296079608],[-80.61074523852385,24.939234439543952]]],[[[-80.66853466846685,24.894517748274826],[-80.67431361146114,24.892033487648764],[-80.68009255445544,24.88706496639664],[-80.68009255445544,24.8895492270227],[-80.66853466846685,24.894517748274826]]],[[[-80.74943987038704,24.844832535753575],[-80.73210304140414,24.867190881388137],[-80.69165044044405,24.884580705770578],[-80.70320832643264,24.867190881388137],[-80.74943987038704,24.844832535753575]]],[[[-80.84768190129013,24.80260010511051],[-80.79567141434143,24.844832535753575],[-80.77833458535854,24.839864014501448],[-80.79567141434143,24.812537147614762],[-80.84768190129013,24.80260010511051]]],[[[-80.76099775637564,24.834895493249324],[-80.76677669936993,24.837379753875386],[-80.75521881338133,24.842348275127513],[-80.76099775637564,24.834895493249324]]],[[[-80.90547133123312,24.78272602010201],[-80.89391344524452,24.79266306260626],[-80.88235555925593,24.790178801980197],[-80.89391344524452,24.78272602010201],[-80.90547133123312,24.78272602010201]]],[[[-80.91125027422743,24.76533619571957],[-80.92280816021602,24.76533619571957],[-80.91702921722171,24.780241759475945],[-80.90547133123312,24.770304716971697],[-80.91125027422743,24.76533619571957]]],[[[-80.98059759015902,24.740493589458946],[-80.97481864716471,24.755399153215322],[-80.92280816021602,24.777757498849883],[-80.97481864716471,24.747946371337132],[-80.98059759015902,24.740493589458946]]],[[[-80.99215547614762,24.73800932883288],[-80.9863765331533,24.752914892589256],[-80.9863765331533,24.760367674467446],[-80.98059759015902,24.74546211071107],[-80.99215547614762,24.73800932883288]]],[[[-81.0268291341134,24.72558802570257],[-81.0268291341134,24.730556546954695],[-80.99215547614762,24.747946371337132],[-80.99215547614762,24.73552506820682],[-81.0152712481248,24.733040807580757],[-81.0268291341134,24.72558802570257]]],[[[-81.42557620072007,24.68832411631163],[-81.45447091569156,24.723103765076505],[-81.45447091569156,24.74546211071107],[-81.41979725772578,24.700745419441944],[-81.42557620072007,24.68832411631163]]],[[[-81.36200782778278,24.63118612191219],[-81.36778677077707,24.633670382538252],[-81.35044994179418,24.63863890379038],[-81.35622888478848,24.643607425042504],[-81.33889205580559,24.64112316441644],[-81.33889205580559,24.653544467546755],[-81.37356571377137,24.65106020692069],[-81.39668148574857,24.74546211071107],[-81.32733416981698,24.646091685668566],[-81.36200782778278,24.63118612191219]]],[[[-81.0788396210621,24.68832411631163],[-81.09039750705071,24.703229680068006],[-81.0846185640564,24.713166722572257],[-81.1077343360336,24.703229680068006],[-81.1250711650165,24.70819820132013],[-81.0268291341134,24.73552506820682],[-81.0788396210621,24.68832411631163]]],[[[-81.00949230513052,24.723103765076505],[-81.0152712481248,24.730556546954695],[-80.99215547614762,24.733040807580757],[-81.00949230513052,24.723103765076505]]],[[[-81.0268291341134,24.72558802570257],[-81.00949230513052,24.720619504450443],[-81.02105019111912,24.71565098319832],[-81.0268291341134,24.72558802570257]]],[[[-81.31577628382837,24.673418552555255],[-81.32155522682268,24.690808376937692],[-81.34467099879987,24.705713940694068],[-81.32155522682268,24.700745419441944],[-81.31577628382837,24.673418552555255]]],[[[-81.39668148574857,24.656028728172817],[-81.41979725772578,24.68087133443344],[-81.41401831473146,24.683355595059506],[-81.41979725772578,24.705713940694068],[-81.39668148574857,24.656028728172817]]],[[[-81.1077343360336,24.68832411631163],[-81.1135132790279,24.700745419441944],[-81.0846185640564,24.695776898189816],[-81.096176450045,24.68832411631163],[-81.1077343360336,24.68832411631163]]],[[[-81.47758668766876,24.643607425042504],[-81.52381823162315,24.670934291929193],[-81.50648140264026,24.700745419441944],[-81.46602880168017,24.663481510051003],[-81.47758668766876,24.643607425042504]]],[[[-81.57004977557756,24.6038592550255],[-81.55271294659465,24.628701861286128],[-81.58160766156615,24.65106020692069],[-81.58160766156615,24.670934291929193],[-81.57004977557756,24.646091685668566],[-81.51803928862887,24.628701861286128],[-81.55849188958896,24.693292637563754],[-81.50648140264026,24.643607425042504],[-81.51803928862887,24.618764818781877],[-81.57004977557756,24.6038592550255]]],[[[-81.39668148574857,24.656028728172817],[-81.39668148574857,24.690808376937692],[-81.38512359975996,24.673418552555255],[-81.39090254275428,24.65106020692069],[-81.39668148574857,24.656028728172817]]],[[[-81.44291302970296,24.643607425042504],[-81.46602880168017,24.670934291929193],[-81.44291302970296,24.68583985568557],[-81.43713408670867,24.65106020692069],[-81.44291302970296,24.643607425042504]]],[[[-81.28110262586259,24.653544467546755],[-81.25798685388538,24.675902813181317],[-81.25220791089109,24.673418552555255],[-81.25220791089109,24.665965770677065],[-81.28110262586259,24.653544467546755]]],[[[-81.40823937173718,24.643607425042504],[-81.42557620072007,24.646091685668566],[-81.41979725772578,24.670934291929193],[-81.40246042874287,24.663481510051003],[-81.40823937173718,24.643607425042504]]],[[[-81.31577628382837,24.646091685668566],[-81.32155522682268,24.648575946294628],[-81.2984394548455,24.656028728172817],[-81.31577628382837,24.646091685668566]]],[[[-81.59316554755475,24.616280558155815],[-81.62783920552056,24.63118612191219],[-81.58738660456046,24.656028728172817],[-81.59316554755475,24.643607425042504],[-81.59316554755475,24.616280558155815]]],[[[-81.55271294659465,24.65106020692069],[-81.55849188958896,24.65106020692069],[-81.54115506060606,24.653544467546755],[-81.55271294659465,24.65106020692069]]],[[[-81.57582871857186,24.633670382538252],[-81.58738660456046,24.633670382538252],[-81.58160766156615,24.64112316441644],[-81.57582871857186,24.64112316441644],[-81.57582871857186,24.633670382538252]]],[[[-81.61050237653765,24.586469430643064],[-81.59316554755475,24.596406473147315],[-81.58738660456046,24.616280558155815],[-81.57004977557756,24.60137499439944],[-81.61050237653765,24.586469430643064]]],[[[-81.70874440744075,24.556658303130313],[-81.70296546444644,24.6038592550255],[-81.65095497749775,24.613796297529753],[-81.64517603450345,24.583985170017],[-81.70874440744075,24.556658303130313]]],[[[-81.62206026252625,24.58150090939094],[-81.63361814851484,24.591437951895188],[-81.61628131953195,24.60137499439944],[-81.59894449054906,24.598890733773377],[-81.62206026252625,24.58150090939094]]],[[[-81.79542855235523,24.566595345634564],[-81.80120749534953,24.571563866886688],[-81.79542855235523,24.59392221252125],[-81.79542855235523,24.586469430643064],[-81.79542855235523,24.566595345634564]]],[[[-81.73186017941794,24.556658303130313],[-81.74341806540653,24.559142563756374],[-81.74919700840084,24.588953691269126],[-81.72030229342934,24.576532388138812],[-81.73186017941794,24.556658303130313]]],[[[-81.80698643834384,24.544237],[-81.77231278037803,24.583985170017],[-81.74919700840084,24.571563866886688],[-81.75497595139514,24.55168978187819],[-81.80698643834384,24.544237]]]]}},{"type":"Feature","id":617,"properties":{"name":"dma:","latitude":43.1921015,"dma":617,"dma1":"Milwaukee, WI","longitude":-88.358241},"geometry":{"type":"Polygon","coordinates":[[[-88.40076039483948,43.63081139003901],[-88.40076039483948,43.543862268126816],[-88.16382373207321,43.543862268126816],[-88.16382373207321,43.89165875577558],[-87.73040300750074,43.89165875577558],[-87.70150829252924,43.685465123812385],[-87.90955024032402,43.25071951425143],[-87.89221341134113,43.00974623352336],[-87.75929772247224,42.7811942559256],[-87.79975032343233,42.493020023302336],[-88.77639168946894,42.493020023302336],[-88.77639168946894,42.84330077157716],[-89.01332835223522,42.848269292829286],[-89.00754940924092,43.633295650665076],[-88.40076039483948,43.63081139003901]]]}},{"type":"Feature","id":613,"properties":{"name":"dma:","latitude":46.0197555,"dma":613,"dma1":"Minneapolis-St. Paul, MN","longitude":-94.199023},"geometry":{"type":"Polygon","coordinates":[[[-95.45684979087909,43.501629837483755],[-95.46262873387339,44.194738552155215],[-96.08097563426342,44.197222812781284],[-96.09253352025202,44.62948416171618],[-96.45082798589858,44.63196842234224],[-96.45082798589858,45.30023453075308],[-96.69354359165916,45.41699478017802],[-96.85535399549954,45.605798587758784],[-96.58374367476748,45.819445001600165],[-96.57796473177318,46.02067011231124],[-96.265901810081,46.02067011231124],[-96.265901810081,46.10761923422343],[-95.14478686918692,46.10761923422343],[-95.19101841314131,47.87144427872788],[-95.27770255805581,47.92112949124913],[-95.2314710141014,48.020499916291634],[-95.58976547974797,48.020499916291634],[-95.60132336573658,48.53971038713872],[-95.21413418511851,48.53971038713872],[-95.20835524212421,48.365812143314336],[-94.42819793789378,48.3682964039404],[-94.41664005190519,47.44415145104511],[-94.09301924422442,47.478931099809984],[-94.02945087128712,47.35223380788079],[-93.77517737953795,47.30254859535954],[-93.80985103750375,46.249222089909],[-93.42844079987998,46.246737829282935],[-93.43421974287429,46.15482018611861],[-93.05280950525052,46.157304446744675],[-93.05280950525052,46.418151812481256],[-92.289989030003,46.418151812481256],[-92.2957679729973,46.157304446744675],[-92.04727342424242,46.157304446744675],[-92.02993659525953,45.64057823652366],[-91.53872644074407,45.63809397589759],[-91.54450538373837,45.2058326269627],[-91.66586318661865,45.208316887588765],[-91.64852635763576,44.59718877357736],[-92.02415765226522,44.58973599169917],[-92.08194708220822,44.42825905100511],[-91.92591562136214,44.33385714721473],[-91.85656830543054,44.19225429152915],[-92.3015469159916,44.10778943024303],[-92.3188837449745,44.194738552155215],[-93.04703056225623,44.197222812781284],[-93.04703056225623,43.84942632513252],[-93.64804063366336,43.84694206450645],[-93.64804063366336,43.499145576857686],[-94.2490507050705,43.499145576857686],[-94.2490507050705,43.84694206450645],[-93.76939843654365,43.84694206450645],[-93.76939843654365,44.239455243424345],[-94.12769290219022,44.2692663709371],[-94.12769290219022,44.18480150965097],[-94.20859810411041,44.199707073407346],[-94.86739760546054,44.49781834853486],[-94.86739760546054,44.28168767406741],[-95.11011321122112,44.28168767406741],[-95.09855532523252,44.10778943024303],[-94.86161866246624,44.10778943024303],[-94.85583971947194,43.501629837483755],[-94.91362914941493,43.501629837483755],[-95.45684979087909,43.501629837483755]]]}},{"type":"Feature","id":687,"properties":{"name":"dma:","latitude":46.8731805,"dma":687,"dma1":"Minot-Bismarck-Dickinson(Williston), ND","longitude":-102.71806},"geometry":{"type":"Polygon","coordinates":[[[-99.71593077767777,45.94117377227723],[-99.71593077767777,45.59337728462847],[-100.43251970897089,45.595861545254536],[-100.47875125292529,45.52630224772478],[-100.2764882481248,45.38221513141315],[-100.32849873507351,45.0865881169117],[-100.2764882481248,45.02199734063407],[-100.4094039369937,45.01206029812982],[-100.3978460510051,44.865488921192124],[-100.54809856885689,44.76114997489749],[-100.69835108670867,44.82822501180118],[-100.73302474467447,44.763634235523554],[-101.13755075427542,44.74624441114112],[-101.13755075427542,44.99467047374738],[-101.50162416291629,44.99467047374738],[-101.47272944794479,45.4716485139514],[-101.99861326042604,45.4716485139514],[-101.99861326042604,45.03938716501651],[-102.95791779747975,45.03938716501651],[-102.94058096849685,45.94614229352936],[-104.04435908040804,45.94614229352936],[-104.04435908040804,46.64173526882689],[-104.60491655085508,46.68396769946995],[-104.60491655085508,46.8603502039204],[-104.4315482610261,46.89016133143315],[-104.30441151515151,47.04170122962297],[-104.33908517311731,47.2454106009601],[-104.448885090009,47.31745415911592],[-104.4199903750375,47.354718068506855],[-104.5124534629463,47.354718068506855],[-104.5124534629463,47.52861631233124],[-104.59335866486649,47.52861631233124],[-104.59335866486649,47.61556543424343],[-104.98054784548455,47.61556543424343],[-104.98054784548455,47.70251455615562],[-105.23482133723373,47.70251455615562],[-105.23482133723373,47.79194793869388],[-105.3619580831083,47.78946367806781],[-105.40818962706271,47.18081982468247],[-105.83583140864086,47.18081982468247],[-105.83005246564656,47.09387070277028],[-105.96296815451545,47.09387070277028],[-105.96296815451545,47.18081982468247],[-106.17101010231022,47.18081982468247],[-106.17101010231022,47.354718068506855],[-106.29814684818481,47.354718068506855],[-106.26347319021902,47.868960018101816],[-106.35593627812781,47.868960018101816],[-106.4310625370537,48.020499916291634],[-106.39638887908791,48.06521660756076],[-105.84161035163515,48.010562873787386],[-105.80693669366937,48.564552993399346],[-106.02075758445844,48.562068732773284],[-106.02075758445844,48.82291609850986],[-106.15367327332733,48.82291609850986],[-106.11322067236723,48.9992986029603],[-99.52522565886588,48.9992986029603],[-99.4905520009001,48.37078066456647],[-99.84884646654665,48.37078066456647],[-99.84884646654665,48.020499916291634],[-99.81417280858085,47.84660167246725],[-99.2998468820882,47.84660167246725],[-99.2651732241224,47.327391201620166],[-99.47899411491149,47.327391201620166],[-99.45009939993999,46.63179822632264],[-99.03401550435044,46.629313965696575],[-99.00512078937894,45.94117377227723],[-99.71593077767777,45.94117377227723]]]}},{"type":"Feature","id":762,"properties":{"name":"dma:","latitude":47.229117,"dma":762,"dma1":"Missoula, MT","longitude":-114.464452},"geometry":{"type":"Polygon","coordinates":[[[-114.60248793099309,46.63676674757477],[-114.66605630393039,46.73862143324333],[-114.77007727782778,46.69638900260027],[-114.78741410681067,46.78085386388639],[-114.89721402370236,46.80321220952096],[-114.92610873867386,46.91748819831984],[-115.31907686228622,47.257831904090416],[-115.75827652985298,47.42179310541054],[-115.6311397839784,47.478931099809984],[-115.75827652985298,47.54849039733974],[-115.68892921392138,47.595691349234926],[-115.72360287188718,47.697546034903496],[-116.04722367956795,47.97578322502251],[-116.04722367956795,48.21427224512452],[-115.95476059165917,48.14968146884689],[-115.73516075787579,48.26395745764577],[-115.5444556390639,47.92112949124913],[-115.18616117341733,47.91864523062307],[-115.15726645844585,48.01801565566557],[-115.01279288358836,48.01553139503951],[-115.01857182658266,48.22669354825483],[-114.84520353675367,48.22669354825483],[-114.89143508070806,48.65895489718973],[-114.63716158895889,48.65895489718973],[-114.68917207590759,48.70864010971098],[-114.6140458169817,48.75087254035404],[-114.73540361986198,48.81049479537954],[-114.6833931329133,48.974455996699675],[-114.73540361986198,48.99681434233424],[-114.07082517551754,48.9992986029603],[-114.00147785958596,48.83285314101411],[-113.75876225382538,48.81794757725773],[-113.70097282388238,48.71609289158917],[-113.75298331083108,48.6142382059206],[-113.4755940471047,48.552131690269036],[-113.481372990099,48.45276126522653],[-113.35423624422442,48.42295013771378],[-113.38890990219022,48.34096953705371],[-113.23865738433844,48.24656763326333],[-113.23287844134413,48.16955555385539],[-113.00172072157216,48.12980738383839],[-112.88036291869187,47.97826748564857],[-113.08840486648664,47.91864523062307],[-113.05951015151516,47.78946367806781],[-113.16353112541253,47.72984142304231],[-113.14619429642964,47.595691349234926],[-113.46403616111611,47.60065987048705],[-113.46403616111611,47.17833556405641],[-113.30222575727572,47.17833556405641],[-113.29066787128713,46.80569647014702],[-113.03639437953795,46.73613717261726],[-113.03639437953795,46.22189522302231],[-113.28488892829283,46.22189522302231],[-113.28488892829283,46.03805993669367],[-113.59117290699069,45.849256129112916],[-113.89745688568857,45.76975978907892],[-113.90901477167716,45.6977162309231],[-114.01303574557456,45.69523197029703],[-114.33087761026103,45.45922721082108],[-114.4580143561356,45.561081896489654],[-114.562035330033,45.55859763586359],[-114.4984669570957,45.70268475217522],[-114.5678142730273,45.77472831033104],[-114.38866704020401,45.88900429912992],[-114.51002484308431,46.030607154815485],[-114.4580143561356,46.09519793109311],[-114.5273616720672,46.144883143614365],[-114.47535118511851,46.159788707370744],[-114.32509866726673,46.6541565719572],[-114.60248793099309,46.63676674757477]]]}},{"type":"Feature","id":686,"properties":{"name":"dma:","latitude":31.1061175,"dma":686,"dma1":"Mobile, AL-Pensacola (Ft. Walton Beach), FL","longitude":-87.6151775},"geometry":{"type":"MultiPolygon","coordinates":[[[[-88.39498145184518,30.387217992499252],[-88.42387616681668,30.998346106510652],[-88.83996006240625,30.998346106510652],[-88.83996006240625,31.43309171607161],[-88.44699193879387,31.43557597669767],[-88.46432876777678,31.698907603060306],[-88.0886974731473,31.698907603060306],[-88.1811605610561,31.81815211311131],[-88.05402381518152,31.922491059405942],[-88.12337113111312,31.94733366566657],[-88.07136064416441,31.98956609630963],[-87.66683463456346,31.992050356935696],[-87.62060309060905,31.82808915561556],[-86.90401415931592,31.830573416241627],[-86.86356155835583,31.54736770487049],[-86.70175115451545,31.525009359235924],[-86.66707749654965,31.418186152315233],[-86.70175115451545,31.000830367136714],[-86.38968823282329,30.99337758525853],[-86.39546717581757,30.45429302940294],[-86.49948814971498,30.521368066306632],[-86.49370920672067,30.46174581128113],[-86.63818278157815,30.43193468376838],[-86.60350912361235,30.402123556255624],[-86.77687741344134,30.409576338133814],[-86.95024570327033,30.39467077437744],[-87.1814034230423,30.342501301230122],[-86.87511944434443,30.439387465646565],[-87.01959301920192,30.503978241924194],[-86.99069830423042,30.578506060706072],[-87.09471927812781,30.439387465646565],[-87.10049822112211,30.51888380568057],[-87.18718236603661,30.583474581958196],[-87.175624480048,30.42696616251625],[-87.35477171287128,30.359891125612563],[-87.2680875679568,30.37479668936894],[-87.2680875679568,30.344985561856184],[-87.40100325682567,30.31020591309131],[-87.42989797179717,30.315174434343433],[-87.49924528772877,30.31269017371737],[-87.33743488388839,30.429450423142313],[-87.41256114281427,30.456777290029002],[-87.43567691479149,30.479135635663567],[-87.42989797179717,30.489072678167815],[-87.42989797179717,30.499009720672067],[-87.43567691479149,30.499009720672067],[-87.43567691479149,30.474167114411443],[-87.41834008580858,30.45429302940294],[-87.38944537083708,30.446840247524754],[-87.40100325682567,30.42448190189019],[-87.55125577467746,30.275426264326434],[-87.79975032343233,30.230709573057307],[-88.02512910021002,30.220772530553056],[-87.75351877947794,30.28287904620462],[-87.90955024032402,30.412060598759876],[-87.99623438523852,30.777246910791078],[-88.11181324512451,30.364859646864687],[-88.19271844704471,30.3176586949695],[-88.1869395040504,30.364859646864687],[-88.39498145184518,30.387217992499252]]],[[[-86.39546717581757,30.379765210621063],[-86.50526709270926,30.382249471247125],[-86.51682497869787,30.3971550350035],[-86.43591977677767,30.409576338133814],[-86.39546717581757,30.379765210621063]]],[[[-87.2680875679568,30.315174434343433],[-87.30276122592258,30.330079998099812],[-87.2102981380138,30.322627216221623],[-87.1525087080708,30.344985561856184],[-86.72486692649264,30.402123556255624],[-86.59773018061806,30.402123556255624],[-86.51682497869787,30.387217992499252],[-87.2680875679568,30.315174434343433]]],[[[-87.54547683168317,30.275426264326434],[-87.54547683168317,30.280394785578558],[-87.53391894569457,30.280394785578558],[-87.45301374377438,30.295300349334934],[-87.43567691479149,30.31269017371737],[-87.40678219981999,30.30026887058706],[-87.31431911191119,30.32759573747375],[-87.32009805490549,30.3176586949695],[-87.54547683168317,30.275426264326434]]],[[[-87.53969788868886,30.280394785578558],[-87.50502423072308,30.30026887058706],[-87.45879268676867,30.305237391839185],[-87.48768740174017,30.29281608870887],[-87.53969788868886,30.280394785578558]]],[[[-88.3025183639364,30.228225312431242],[-88.1175921881188,30.265489221822182],[-88.07713958715871,30.248099397439745],[-88.19271844704471,30.248099397439745],[-88.3025183639364,30.228225312431242]]]]}},{"type":"Feature","id":628,"properties":{"name":"dma:","latitude":32.1842885,"dma":628,"dma1":"Monroe, LA-El Dorado, AR","longitude":-91.9321725},"geometry":{"type":"Polygon","coordinates":[[[-92.38245211791178,31.619411263026304],[-92.36511528892889,31.79579376747675],[-92.61938878067807,31.79827802810281],[-92.61938878067807,31.708844645564557],[-92.97768324632463,31.71132890619062],[-92.87366227242724,31.944849405040507],[-92.93723064536454,32.14855877637764],[-92.81587284248425,32.14607451575158],[-92.77542024152415,32.23550789828983],[-92.77542024152415,32.45412283338334],[-92.87944121542154,32.45412283338334],[-92.87944121542154,32.60069421032104],[-92.82743072847285,32.75968689038904],[-92.72340975457546,32.75968689038904],[-92.72340975457546,33.00066017111711],[-92.98924113231323,33.01804999549955],[-92.97768324632463,33.37826778627863],[-92.55004146474647,33.36584648314832],[-92.44602049084908,33.273928839984],[-92.2264206570657,33.2540547549755],[-92.1628522841284,33.162137111811184],[-91.97792610831083,33.30125570687069],[-91.98948399429943,33.39814187128713],[-91.45782123882388,33.38820482878288],[-91.45782123882388,33.00562869236924],[-91.16887408910891,33.00314443174317],[-91.16887408910891,32.89880548544855],[-91.13420043114311,32.98078608610861],[-91.08218994419443,32.963396261726174],[-91.16309514611461,32.752234108510855],[-91.05329522922293,32.71993872037204],[-91.15153726012602,32.62553681658166],[-91.01284262826283,32.64044238033804],[-91.08218994419443,32.55597751905191],[-90.98972685628563,32.49387100340034],[-91.09374783018302,32.54852473717372],[-91.11686360216021,32.48393396089609],[-90.97239002730274,32.439217269626965],[-90.99550579927993,32.354752408340836],[-90.87414799639964,32.37214223272328],[-90.99550579927993,32.193275467646764],[-91.04173734323433,32.24296068016802],[-91.16309514611461,32.195759728272826],[-91.16309514611461,32.13365321262126],[-91.00128474227422,32.14607451575158],[-91.08218994419443,32.04670409070907],[-91.1573162031203,32.07403095759576],[-91.07641100120011,32.01689296319632],[-91.1862109180918,31.96223922942294],[-91.2555582340234,31.813183591859186],[-91.3422423789379,31.845478979998],[-91.36535815091509,31.761014118711874],[-91.26711612001199,31.751077076207622],[-91.3711370939094,31.746108554955498],[-91.40003180888088,31.619411263026304],[-91.51561066876687,31.629348305530556],[-91.40581075187518,31.589600135513553],[-91.52138961176118,31.52252509860986],[-91.46937912481248,31.37595372167217],[-91.57340009870987,31.410733370437043],[-91.51561066876687,31.279067557255726],[-91.65430530063006,31.254224950995102],[-91.56184221272127,31.03809427652765],[-91.66008424362437,30.971019239623963],[-91.64852635763576,31.03561001590159],[-91.72365261656165,31.04306279777978],[-91.68897895859585,31.199571217221724],[-91.90857879237925,31.296457381638163],[-91.98948399429943,31.22441382348235],[-92.02415765226522,31.28155181788179],[-92.38245211791178,31.619411263026304]]]}},{"type":"Feature","id":828,"properties":{"name":"dma:","latitude":36.537526,"dma":828,"dma1":"Monterey-Salinas, CA","longitude":-121.265832},"geometry":{"type":"MultiPolygon","coordinates":[[[[-121.34651440534053,35.795453375437546],[-121.6759141560156,36.163123948094814],[-121.90129293279328,36.307211064406445],[-121.97641919171917,36.58047973327333],[-121.81460878787878,36.6823344189419],[-121.78571407290728,36.804063189618965],[-121.86084033183317,36.93324474217422],[-122.15556642454246,36.975477172817286],[-122.31737682838283,37.186639326032605],[-122.15556642454246,37.216450453545356],[-122.15556642454246,37.27607270857086],[-122.14978748154815,37.28600975107511],[-121.57767212511251,36.89349657215722],[-121.49098798019801,36.98292995469547],[-121.21359871647164,36.960571609060906],[-121.14425140054006,36.83635857775778],[-120.5952518160816,36.48856209010901],[-120.67037807500749,36.13828134183419],[-120.26585206540653,35.897308061106116],[-120.21384157845785,35.79048485418542],[-121.34651440534053,35.795453375437546]]]]}},{"type":"Feature","id":698,"properties":{"name":"dma:","latitude":32.0506805,"dma":698,"dma1":"Montgomery-Selma, AL","longitude":-86.7675715},"geometry":{"type":"Polygon","coordinates":[[[-86.70175115451545,31.000830367136714],[-86.66707749654965,31.418186152315233],[-86.70175115451545,31.525009359235924],[-86.86356155835583,31.54736770487049],[-86.90401415931592,31.830573416241627],[-87.62060309060905,31.82808915561556],[-87.66683463456346,31.992050356935696],[-88.10603430213021,31.999503138813882],[-88.01935015721571,32.28519311081108],[-87.92688706930693,32.28767737143714],[-88.03668698619862,32.43176448774878],[-87.84598186738674,32.54604047654766],[-87.52236105970597,32.481449700270026],[-87.41834008580858,32.87396287918792],[-87.01959301920192,32.836698969796984],[-87.01959301920192,32.6628007259726],[-86.71330904050404,32.6628007259726],[-86.37235140384038,32.752234108510855],[-86.51682497869787,32.93110087358736],[-86.49370920672067,33.10251485678568],[-85.59219409960997,33.107483378037806],[-85.59219409960997,32.72739150225023],[-85.69621507350735,32.69758037473748],[-85.69621507350735,32.580820125312535],[-85.43616263876388,32.496355264026406],[-85.43038369576958,32.01440870257026],[-85.59219409960997,31.994534617561758],[-85.74244661746175,31.619411263026304],[-86.1469726270627,31.616927002400242],[-86.1874252280228,30.99337758525853],[-86.70175115451545,31.000830367136714]]]}},{"type":"Feature","id":570,"properties":{"name":"dma:","latitude":34.2987775,"dma":570,"dma1":"Myrtle Beach-Florence, SC","longitude":-79.419767},"geometry":{"type":"MultiPolygon","coordinates":[[[[-79.35093566576657,34.83901303440344],[-79.1891252619262,34.83404451315132],[-79.0330938010801,34.95328902320232],[-78.92907282718272,34.89118250755076],[-78.80771502430242,34.68995739683969],[-78.84238868226822,34.50860637113712],[-79.0735464020402,34.299928478547855],[-78.55344153255325,33.860214347734775],[-79.0041990861086,33.57204011511151],[-79.1024411170117,33.57204011511151],[-79.35093566576657,33.81549765646565],[-79.49540924062407,33.775749486448646],[-79.94616679417942,33.8850569539954],[-79.97506150915092,33.947163469646966],[-79.89415630723073,33.989395900290035],[-80.14842979897989,34.143420059105914],[-80.11375614101411,34.22788492039204],[-80.17732451395139,34.36700351545154],[-80.28712443084308,34.36451925482548],[-79.83058793429342,34.53096471677168],[-79.77857744734473,34.61542957805781],[-79.93460890819082,34.80423338563857],[-79.61676704350435,34.814170428142816],[-79.51274606960696,35.025332581358136],[-79.36249355175516,34.95825754445445],[-79.35093566576657,34.83901303440344]]]]}},{"type":"Feature","id":659,"properties":{"name":"dma:","latitude":36.07259,"dma":659,"dma1":"Nashville, TN","longitude":-86.631128},"geometry":{"type":"Polygon","coordinates":[[[-87.67839252055205,37.14937541664167],[-87.52236105970597,37.10465872537254],[-87.33165594089408,37.156828198519854],[-87.25075073897389,37.04006794909491],[-86.84622472937293,37.05745777347735],[-86.67285643954395,37.00031977907791],[-86.58039335163517,36.831390056505654],[-86.40702506180618,36.776736322732276],[-86.1989831140114,36.93572900280029],[-86.0660674251425,36.900949354035404],[-86.07184636813682,36.80903171087109],[-85.97938328022802,36.7220825889589],[-85.77134133243324,36.83635857775778],[-85.61530987158716,36.833874317131716],[-85.47083629672967,36.73450389208921],[-85.43616263876388,36.617743642664266],[-85.29746800690069,36.62519642454246],[-85.2338996339634,36.88604379027903],[-85.06631028712872,36.85871692339234],[-84.99696297119712,36.62519642454246],[-84.78314208040804,36.602838078907894],[-84.73113159345934,36.52582599949995],[-85.04897345814581,36.55315286638664],[-85.1183207740774,36.406581489448946],[-85.1009839450945,36.13828134183419],[-85.245457519952,36.10101743244324],[-85.26279434893489,35.72092555665567],[-85.42460475277528,35.566901397839786],[-85.88692019231922,35.51721618531853],[-85.86380442034203,34.9880686719672],[-86.3203409168917,34.99055293259326],[-86.38968823282329,35.23649473457346],[-86.58039335163517,35.37064480838084],[-86.82888790039004,35.26382160146015],[-86.83466684338433,34.99055293259326],[-87.60326626162616,35.00297423572357],[-87.57437154665466,35.40542445714571],[-87.74773983648365,35.49237357905791],[-88.198497390039,35.38058185088509],[-88.2505078769877,35.422814281528154],[-88.1811605610561,35.750736684168416],[-88.2100552760276,36.14573412371237],[-88.52789714071406,36.1507026449645],[-88.51633925472547,36.50098339323932],[-88.05402381518152,36.4960148719872],[-88.1580447890789,36.86616970527053],[-87.76507666546655,36.975477172817286],[-87.67839252055205,37.14937541664167]]]}},{"type":"Feature","id":622,"properties":{"name":"dma:","latitude":29.9723295,"dma":622,"dma1":"New Orleans, LA","longitude":-90.0824885},"geometry":{"type":"MultiPolygon","coordinates":[[[[-91.08218994419443,29.627034240924093],[-90.88570588238824,29.877944564156415],[-90.96083214131413,30.066748371737173],[-90.40027467086708,30.285363306830682],[-90.56786401770177,30.486588417541753],[-90.56786401770177,31.000830367136714],[-89.3485070459046,31.010767409640966],[-89.34272810291029,30.372312428742873],[-89.33117021692169,30.302753131213123],[-89.45830696279629,30.17605583928393],[-89.53921216471647,30.19592992429243],[-89.66056996759676,30.161150275527554],[-89.71835939753976,30.02700020172017],[-89.85705402940295,30.00464185608561],[-89.65479102460246,29.86303900040004],[-89.49298062076207,30.06923263236324],[-89.42941224782479,30.051842807980798],[-89.45830696279629,29.994704813581357],[-89.33694915991599,29.887881606660667],[-89.41785436183619,29.818322309130913],[-89.27338078697869,29.75870005410541],[-89.46986484878488,29.783542660366038],[-89.49298062076207,29.751247272227225],[-89.42363330483047,29.70156205970597],[-89.42941224782479,29.676719453445344],[-89.65479102460246,29.74876301160116],[-89.64323313861385,29.709014841584157],[-89.59700159465946,29.704046320332033],[-89.59700159465946,29.684172235323533],[-89.55077005070507,29.679203714071406],[-89.55077005070507,29.66181388968897],[-89.52765427872788,29.664298150315034],[-89.48720167776777,29.622065719671966],[-89.63745419561957,29.68168797469747],[-89.71835939753976,29.597223113411342],[-89.52187533573357,29.458104518351835],[-89.56232793669366,29.39351374207421],[-89.2676018439844,29.34631279017902],[-89.2618229009901,29.20222567386739],[-89.35428598889888,29.286690535153515],[-89.34272810291029,29.19725715261526],[-89.35428598889888,29.16744602510251],[-89.42941224782479,29.142603418841883],[-89.63745419561957,29.323954444544455],[-89.82815931443145,29.31153314141414],[-89.77614882748274,29.400966523952395],[-89.83393825742574,29.39351374207421],[-89.83393825742574,29.475494342734272],[-89.97841183228323,29.455620257725773],[-90.17489589408942,29.577349028402843],[-90.2326853240324,29.5003369489949],[-90.05931703420342,29.45313599709971],[-90.03620126222623,29.306564620162018],[-90.1402222361236,29.31898592329233],[-90.04775914821482,29.1947728919892],[-90.2211274380438,29.085465424442447],[-90.2731379249925,29.142603418841883],[-90.2384642670267,29.234521062006202],[-90.34826418391839,29.276753492649267],[-90.33092735493548,29.296627577657766],[-90.3367062979298,29.296627577657766],[-90.33092735493548,29.30904888078808],[-90.34826418391839,29.341344268926893],[-90.3367062979298,29.30904888078808],[-90.38293784188419,29.2543951470147],[-90.42916938583858,29.34631279017902],[-90.47540092979298,29.27923775327533],[-90.60831661866186,29.314017402040204],[-90.55052718871886,29.20222567386739],[-90.61409556165617,29.249426625762577],[-90.60253767566756,29.22458401950195],[-90.59675873267327,29.22209975887589],[-90.59097978967897,29.207194195119513],[-90.63143239063906,29.24445810451045],[-90.66032710561055,29.237005322632264],[-90.69500076357636,29.12024507320732],[-90.85681116741674,29.08794968506851],[-90.95505319831983,29.177383067606762],[-91.2786740060006,29.246942365136512],[-91.3480213219322,29.31650166266627],[-91.23244246204621,29.373639657065706],[-91.16887408910891,29.266816450145015],[-91.11686360216021,29.256879407640763],[-91.26711612001199,29.532632337133712],[-91.08218994419443,29.627034240924093]]],[[[-89.59122265166516,30.151213233023302],[-89.62011736663666,30.163634536153616],[-89.53343322172216,30.190961403040305],[-89.53343322172216,30.17605583928393],[-89.59122265166516,30.151213233023302]]],[[[-88.88041266336634,29.87297604290429],[-88.89774949234923,29.885397346034605],[-88.88041266336634,29.89781864916492],[-88.86885477737773,29.885397346034605],[-88.88041266336634,29.87297604290429]]],[[[-88.90352843534353,29.877944564156415],[-88.89774949234923,29.88291308540854],[-88.89197054935494,29.877944564156415],[-88.89774949234923,29.880428824782477],[-88.90352843534353,29.877944564156415]]],[[[-88.91508632133213,29.86303900040004],[-88.92086526432644,29.86303900040004],[-88.90930737833783,29.87297604290429],[-88.90352843534353,29.865523261026105],[-88.91508632133213,29.86303900040004]]],[[[-88.86885477737773,29.753731532853287],[-88.86307583438344,29.778574139113914],[-88.85151794839484,29.77608987848785],[-88.86885477737773,29.753731532853287]]],[[[-89.42363330483047,29.72888892659266],[-89.44097013381338,29.741310229722973],[-89.44674907680768,29.74876301160116],[-89.43519119081908,29.753731532853287],[-89.42363330483047,29.72888892659266]]],[[[-88.89197054935494,29.721436144714474],[-88.88619160636063,29.72888892659266],[-88.87463372037203,29.74876301160116],[-88.86885477737773,29.746278750975097],[-88.89197054935494,29.721436144714474]]],[[[-90.08821174917492,29.465557300230024],[-90.12866435013501,29.492884167116713],[-90.11710646414642,29.50778973087309],[-90.04775914821482,29.497852688368837],[-90.08821174917492,29.465557300230024]]],[[[-90.00152760426042,29.428293390839084],[-90.00152760426042,29.44568321522152],[-90.05931703420342,29.477978603360334],[-90.00152760426042,29.455620257725773],[-90.00152760426042,29.428293390839084]]],[[[-89.2329281860186,29.2543951470147],[-89.24448607200719,29.30904888078808],[-89.1982545280528,29.351281311431144],[-89.1924755850585,29.304080359535952],[-89.2329281860186,29.2543951470147]]],[[[-89.2560439579958,29.199741413241323],[-89.1866966420642,29.30159609890989],[-89.18091769906991,29.32892296579658],[-89.1346861551155,29.28917479577958],[-89.2560439579958,29.199741413241323]]],[[[-89.1924755850585,29.21713123762376],[-89.1982545280528,29.22209975887589],[-89.1346861551155,29.28172201390139],[-89.12312826912691,29.25191088638864],[-89.1578019270927,29.24445810451045],[-89.1924755850585,29.21713123762376]]],[[[-89.27338078697869,29.122729333833384],[-89.33694915991599,29.189804370737075],[-89.3485070459046,29.269300710771077],[-89.2964965589559,29.22209975887589],[-89.27338078697869,29.122729333833384]]],[[[-90.04198020522051,29.199741413241323],[-90.00730654725473,29.239489583258326],[-89.94951711731173,29.264332189518953],[-89.95529606030603,29.2543951470147],[-90.04198020522051,29.199741413241323]]],[[[-89.14624404110411,29.229552540754078],[-89.16935981308131,29.23203680138014],[-89.12312826912691,29.241973843884388],[-89.12312826912691,29.234521062006202],[-89.1346861551155,29.23203680138014],[-89.14624404110411,29.229552540754078]]],[[[-89.20981241404141,29.14757194009401],[-89.2618229009901,29.192288631363137],[-89.1751387560756,29.212162716371637],[-89.1751387560756,29.227068280128012],[-89.15202298409841,29.22209975887589],[-89.14046509810981,29.23203680138014],[-89.12312826912691,29.23203680138014],[-89.20981241404141,29.14757194009401]]],[[[-89.11734932613261,29.20470993449345],[-89.12890721212122,29.207194195119513],[-89.11734932613261,29.209678455745575],[-89.12890721212122,29.209678455745575],[-89.11734932613261,29.212162716371637],[-89.11734932613261,29.20470993449345]]],[[[-89.04800201020102,29.20222567386739],[-89.04222306720672,29.212162716371637],[-89.03644412421241,29.207194195119513],[-89.04222306720672,29.20470993449345],[-89.04800201020102,29.20222567386739]]],[[[-89.01910729522952,29.199741413241323],[-89.02488623822381,29.192288631363137],[-89.03066518121813,29.19725715261526],[-89.03644412421241,29.1947728919892],[-89.03066518121813,29.199741413241323],[-89.02488623822381,29.1947728919892],[-89.01910729522952,29.199741413241323]]],[[[-89.02488623822381,29.18732011011101],[-89.01910729522952,29.199741413241323],[-89.02488623822381,29.189804370737075],[-89.01910729522952,29.184835849484948],[-89.02488623822381,29.18732011011101]]],[[[-89.08845461116111,29.18732011011101],[-89.07111778217822,29.1947728919892],[-89.04800201020102,29.199741413241323],[-89.08845461116111,29.18732011011101]]],[[[-89.02488623822381,29.18732011011101],[-89.04800201020102,29.192288631363137],[-89.04222306720672,29.19725715261526],[-89.04222306720672,29.192288631363137],[-89.02488623822381,29.18732011011101]]],[[[-89.00754940924092,29.182351588858886],[-89.01332835223522,29.182351588858886],[-89.01332835223522,29.192288631363137],[-89.00754940924092,29.18732011011101],[-89.00754940924092,29.182351588858886]]],[[[-89.05378095319531,29.172414546354638],[-89.06533883918391,29.18732011011101],[-89.05378095319531,29.179867328232824],[-89.05955989618963,29.18732011011101],[-89.02488623822381,29.179867328232824],[-89.01910729522952,29.1748988069807],[-89.05378095319531,29.172414546354638]]],[[[-89.08267566816681,29.14757194009401],[-89.11157038313831,29.172414546354638],[-89.07111778217822,29.184835849484948],[-89.09423355415541,29.1748988069807],[-89.08267566816681,29.14757194009401]]],[[[-89.14046509810981,29.1748988069807],[-89.14046509810981,29.179867328232824],[-89.1346861551155,29.179867328232824],[-89.1346861551155,29.177383067606762],[-89.14046509810981,29.1748988069807]]],[[[-89.14046509810981,29.172414546354638],[-89.12890721212122,29.177383067606762],[-89.12312826912691,29.177383067606762],[-89.14046509810981,29.172414546354638]]],[[[-89.02488623822381,29.16744602510251],[-89.03644412421241,29.172414546354638],[-89.01332835223522,29.172414546354638],[-89.02488623822381,29.16744602510251]]],[[[-89.11734932613261,29.150056200720073],[-89.1346861551155,29.16744602510251],[-89.11157038313831,29.1748988069807],[-89.12890721212122,29.16496176447645],[-89.11734932613261,29.150056200720073]]],[[[-89.05378095319531,29.172414546354638],[-89.04800201020102,29.15750898259826],[-89.06533883918391,29.162477503850386],[-89.05955989618963,29.169930285728572],[-89.05378095319531,29.172414546354638]]],[[[-89.163580870087,29.15750898259826],[-89.14046509810981,29.16744602510251],[-89.14046509810981,29.16496176447645],[-89.15202298409841,29.152540461346135],[-89.163580870087,29.15750898259826]]],[[[-89.1346861551155,29.14757194009401],[-89.14624404110411,29.152540461346135],[-89.14624404110411,29.15999324322432],[-89.1346861551155,29.15999324322432],[-89.1346861551155,29.14757194009401]]],[[[-89.163580870087,29.15750898259826],[-89.15202298409841,29.14508767946795],[-89.1751387560756,29.152540461346135],[-89.18091769906991,29.14757194009401],[-89.163580870087,29.15750898259826]]],[[[-89.1346861551155,29.14757194009401],[-89.12890721212122,29.15750898259826],[-89.11734932613261,29.14508767946795],[-89.11157038313831,29.150056200720073],[-89.11734932613261,29.142603418841883],[-89.1346861551155,29.14757194009401]]],[[[-89.08267566816681,29.14757194009401],[-89.07689672517252,29.14757194009401],[-89.07689672517252,29.14508767946795],[-89.07689672517252,29.13018211571157],[-89.08267566816681,29.14757194009401]]],[[[-89.1578019270927,29.142603418841883],[-89.163580870087,29.14757194009401],[-89.1578019270927,29.14508767946795],[-89.1578019270927,29.142603418841883]]],[[[-89.24448607200719,29.135150636963697],[-89.2502650150015,29.14508767946795],[-89.21559135703569,29.13763489758976],[-89.23870712901291,29.127697855085508],[-89.2329281860186,29.10285524882488],[-89.1751387560756,29.028327430043007],[-89.2329281860186,29.105339509450946],[-89.24448607200719,29.135150636963697]]],[[[-89.14046509810981,29.135150636963697],[-89.14624404110411,29.14508767946795],[-89.14046509810981,29.142603418841883],[-89.14046509810981,29.135150636963697]]],[[[-89.04222306720672,29.135150636963697],[-89.03066518121813,29.142603418841883],[-89.02488623822381,29.13763489758976],[-89.04222306720672,29.135150636963697]]],[[[-89.279159729973,29.08794968506851],[-89.2502650150015,29.142603418841883],[-89.24448607200719,29.135150636963697],[-89.24448607200719,29.122729333833384],[-89.2271492430243,29.09043394569457],[-89.2560439579958,29.132666376337635],[-89.2676018439844,29.08298116381638],[-89.279159729973,29.08794968506851]]],[[[-89.21559135703569,29.13763489758976],[-89.2040334710471,29.142603418841883],[-89.20981241404141,29.13018211571157],[-89.21559135703569,29.135150636963697],[-89.21559135703569,29.13763489758976]]],[[[-89.2040334710471,29.142603418841883],[-89.1924755850585,29.14011915821582],[-89.2040334710471,29.135150636963697],[-89.1982545280528,29.13763489758976],[-89.2040334710471,29.142603418841883]]],[[[-89.08845461116111,29.127697855085508],[-89.11157038313831,29.132666376337635],[-89.14046509810981,29.135150636963697],[-89.11734932613261,29.14011915821582],[-89.08845461116111,29.127697855085508]]],[[[-89.163580870087,29.10285524882488],[-89.1866966420642,29.11776081258126],[-89.1924755850585,29.135150636963697],[-89.2040334710471,29.13018211571157],[-89.1866966420642,29.14011915821582],[-89.16935981308131,29.14011915821582],[-89.18091769906991,29.13018211571157],[-89.163580870087,29.10285524882488]]],[[[-89.12890721212122,29.13018211571157],[-89.14624404110411,29.13018211571157],[-89.14624404110411,29.13763489758976],[-89.12890721212122,29.13018211571157]]],[[[-89.05955989618963,29.122729333833384],[-89.04800201020102,29.13018211571157],[-89.03066518121813,29.135150636963697],[-89.04800201020102,29.12024507320732],[-89.05955989618963,29.122729333833384]]],[[[-90.38293784188419,29.10285524882488],[-90.40027467086708,29.105339509450946],[-90.40027467086708,29.107823770077008],[-90.3367062979298,29.125213594459446],[-90.38293784188419,29.10285524882488]]],[[[-89.06533883918391,29.122729333833384],[-89.05955989618963,29.127697855085508],[-89.04800201020102,29.132666376337635],[-89.05378095319531,29.13018211571157],[-89.06533883918391,29.122729333833384]]],[[[-89.07689672517252,29.107823770077008],[-89.09423355415541,29.12024507320732],[-89.11734932613261,29.132666376337635],[-89.08267566816681,29.122729333833384],[-89.07689672517252,29.107823770077008]]],[[[-89.12890721212122,29.13018211571157],[-89.12312826912691,29.13018211571157],[-89.11157038313831,29.12024507320732],[-89.12890721212122,29.13018211571157]]],[[[-89.08845461116111,29.127697855085508],[-89.08845461116111,29.13018211571157],[-89.07689672517252,29.13018211571157],[-89.07689672517252,29.122729333833384],[-89.08845461116111,29.127697855085508]]],[[[-89.20981241404141,29.125213594459446],[-89.1924755850585,29.125213594459446],[-89.1866966420642,29.105339509450946],[-89.1866966420642,29.107823770077008],[-89.2040334710471,29.11776081258126],[-89.20981241404141,29.125213594459446]]],[[[-89.22137030003,29.11776081258126],[-89.22137030003,29.122729333833384],[-89.20981241404141,29.125213594459446],[-89.20981241404141,29.11776081258126],[-89.22137030003,29.11776081258126]]],[[[-89.20981241404141,29.125213594459446],[-89.2040334710471,29.10285524882488],[-89.1866966420642,29.08794968506851],[-89.2040334710471,29.097886727572757],[-89.20981241404141,29.125213594459446]]],[[[-89.12312826912691,29.105339509450946],[-89.12312826912691,29.11030803070307],[-89.14624404110411,29.122729333833384],[-89.11734932613261,29.11776081258126],[-89.11734932613261,29.107823770077008],[-89.12312826912691,29.105339509450946]]],[[[-89.05955989618963,29.122729333833384],[-89.04800201020102,29.115276551955198],[-89.05955989618963,29.08049690319032],[-89.06533883918391,29.107823770077008],[-89.05955989618963,29.122729333833384]]],[[[-89.22137030003,29.11776081258126],[-89.22137030003,29.10285524882488],[-89.2329281860186,29.11030803070307],[-89.22137030003,29.12024507320732],[-89.22137030003,29.11776081258126]]],[[[-89.15202298409841,29.105339509450946],[-89.15202298409841,29.112792291329132],[-89.1578019270927,29.107823770077008],[-89.163580870087,29.11776081258126],[-89.16935981308131,29.12024507320732],[-89.14624404110411,29.112792291329132],[-89.15202298409841,29.105339509450946]]],[[[-89.11157038313831,29.12024507320732],[-89.105791440144,29.12024507320732],[-89.105791440144,29.11030803070307],[-89.105791440144,29.105339509450946],[-89.11157038313831,29.12024507320732]]],[[[-89.14046509810981,29.10285524882488],[-89.1346861551155,29.112792291329132],[-89.12890721212122,29.11030803070307],[-89.1346861551155,29.10285524882488],[-89.14046509810981,29.10285524882488]]],[[[-89.07111778217822,29.10037098819882],[-89.07689672517252,29.11030803070307],[-89.07111778217822,29.107823770077008],[-89.07111778217822,29.10037098819882]]],[[[-89.2964965589559,29.075528381938195],[-89.2907176159616,29.08794968506851],[-89.27338078697869,29.107823770077008],[-89.279159729973,29.092918206320633],[-89.2964965589559,29.075528381938195]]],[[[-90.3656010129013,29.10285524882488],[-90.34826418391839,29.107823770077008],[-90.34248524092409,29.107823770077008],[-90.34248524092409,29.10285524882488],[-90.3656010129013,29.10285524882488]]],[[[-89.21559135703569,29.08298116381638],[-89.21559135703569,29.085465424442447],[-89.20981241404141,29.105339509450946],[-89.21559135703569,29.08298116381638]]],[[[-89.105791440144,29.105339509450946],[-89.105791440144,29.10037098819882],[-89.08845461116111,29.07304412131213],[-89.09423355415541,29.075528381938195],[-89.105791440144,29.105339509450946]]],[[[-89.11157038313831,29.092918206320633],[-89.12312826912691,29.092918206320633],[-89.12890721212122,29.10037098819882],[-89.11157038313831,29.10285524882488],[-89.11157038313831,29.092918206320633]]],[[[-89.06533883918391,29.070559860686068],[-89.07111778217822,29.078012642564257],[-89.07111778217822,29.097886727572757],[-89.07111778217822,29.08049690319032],[-89.06533883918391,29.070559860686068]]],[[[-89.11157038313831,29.092918206320633],[-89.105791440144,29.095402466946695],[-89.105791440144,29.078012642564257],[-89.11734932613261,29.09043394569457],[-89.11734932613261,29.092918206320633],[-89.11157038313831,29.092918206320633]]],[[[-90.26158003900389,29.08049690319032],[-90.2500221530153,29.092918206320633],[-90.244243210021,29.08794968506851],[-90.2558010960096,29.08298116381638],[-90.26158003900389,29.08049690319032]]],[[[-90.44650621482148,29.05317003630363],[-90.46962198679867,29.058138557555758],[-90.52741141674167,29.08049690319032],[-90.53896930273027,29.08794968506851],[-90.45806410081008,29.070559860686068],[-90.44650621482148,29.05317003630363]],[[-90.49273775877587,29.068075600060006],[-90.47540092979298,29.068075600060006],[-90.51007458775877,29.08049690319032],[-90.50429564476448,29.07304412131213],[-90.49273775877587,29.068075600060006]]],[[[-90.2731379249925,29.078012642564257],[-90.2789168679868,29.08298116381638],[-90.2731379249925,29.08794968506851],[-90.2673589819982,29.08049690319032],[-90.2731379249925,29.078012642564257]]],[[[-89.163580870087,29.070559860686068],[-89.163580870087,29.08794968506851],[-89.1578019270927,29.085465424442447],[-89.163580870087,29.070559860686068]]],[[[-89.279159729973,29.08794968506851],[-89.2676018439844,29.08298116381638],[-89.27338078697869,29.085465424442447],[-89.2964965589559,29.068075600060006],[-89.33694915991599,29.018390387538755],[-89.2964965589559,29.070559860686068],[-89.279159729973,29.08794968506851]]],[[[-89.21559135703569,29.055654296929692],[-89.21559135703569,29.058138557555758],[-89.2329281860186,29.085465424442447],[-89.21559135703569,29.070559860686068],[-89.21559135703569,29.058138557555758],[-89.21559135703569,29.055654296929692]]],[[[-89.2560439579958,29.078012642564257],[-89.2618229009901,29.08298116381638],[-89.2502650150015,29.085465424442447],[-89.2560439579958,29.078012642564257]]],[[[-89.2676018439844,29.078012642564257],[-89.2618229009901,29.085465424442447],[-89.2560439579958,29.075528381938195],[-89.2618229009901,29.06310707880788],[-89.2676018439844,29.078012642564257]]],[[[-89.12890721212122,29.068075600060006],[-89.1346861551155,29.075528381938195],[-89.14046509810981,29.08298116381638],[-89.12312826912691,29.070559860686068],[-89.12890721212122,29.068075600060006]]],[[[-90.34248524092409,29.058138557555758],[-90.33092735493548,29.070559860686068],[-90.3251484119412,29.065591339433944],[-90.2962536969697,29.070559860686068],[-90.2846958109811,29.08049690319032],[-90.2789168679868,29.08049690319032],[-90.29047475397539,29.07304412131213],[-90.34248524092409,29.058138557555758]]],[[[-89.2676018439844,29.07304412131213],[-89.27338078697869,29.075528381938195],[-89.28493867296729,29.075528381938195],[-89.2676018439844,29.078012642564257],[-89.2676018439844,29.07304412131213]]],[[[-89.1924755850585,29.068075600060006],[-89.1982545280528,29.07304412131213],[-89.1924755850585,29.075528381938195],[-89.1924755850585,29.068075600060006]]],[[[-89.2676018439844,29.068075600060006],[-89.2676018439844,29.070559860686068],[-89.28493867296729,29.070559860686068],[-89.28493867296729,29.07304412131213],[-89.2676018439844,29.07304412131213],[-89.2676018439844,29.068075600060006]]],[[[-89.30227550195019,29.05317003630363],[-89.30227550195019,29.055654296929692],[-89.28493867296729,29.07304412131213],[-89.279159729973,29.065591339433944],[-89.2907176159616,29.065591339433944],[-89.30227550195019,29.05317003630363]]],[[[-89.31383338793879,29.058138557555758],[-89.31383338793879,29.065591339433944],[-89.30227550195019,29.07304412131213],[-89.31383338793879,29.058138557555758]]],[[[-90.71811653555355,29.045717254425444],[-90.67188499159916,29.070559860686068],[-90.63721133363336,29.070559860686068],[-90.63721133363336,29.065591339433944],[-90.71811653555355,29.045717254425444]]],[[[-89.279159729973,29.065591339433944],[-89.279159729973,29.070559860686068],[-89.2676018439844,29.068075600060006],[-89.2676018439844,29.06310707880788],[-89.279159729973,29.065591339433944]]],[[[-90.43494832883289,29.055654296929692],[-90.44072727182717,29.058138557555758],[-90.45228515781578,29.068075600060006],[-90.44072727182717,29.065591339433944],[-90.43494832883289,29.055654296929692]]],[[[-89.15202298409841,29.055654296929692],[-89.163580870087,29.06310707880788],[-89.1578019270927,29.065591339433944],[-89.14046509810981,29.06062281818182],[-89.14046509810981,29.058138557555758],[-89.15202298409841,29.055654296929692]]],[[[-89.2964965589559,29.05317003630363],[-89.2964965589559,29.06062281818182],[-89.279159729973,29.06310707880788],[-89.279159729973,29.058138557555758],[-89.2964965589559,29.05317003630363]]],[[[-90.90882165436543,29.04323299379938],[-90.96083214131413,29.055654296929692],[-90.96661108430843,29.06062281818182],[-90.92037954035403,29.05317003630363],[-90.90882165436543,29.04323299379938]]],[[[-90.74123230753075,29.048201515051506],[-90.74123230753075,29.06062281818182],[-90.71233759255925,29.05317003630363],[-90.74123230753075,29.048201515051506]]],[[[-90.81635856645664,29.040748733173317],[-90.82213750945094,29.055654296929692],[-90.79902173747374,29.055654296929692],[-90.81057962346235,29.045717254425444],[-90.81635856645664,29.040748733173317]]],[[[-89.15202298409841,29.050685775677568],[-89.1578019270927,29.05317003630363],[-89.163580870087,29.055654296929692],[-89.14624404110411,29.05317003630363],[-89.15202298409841,29.050685775677568]]],[[[-89.1578019270927,29.04323299379938],[-89.16935981308131,29.050685775677568],[-89.1751387560756,29.048201515051506],[-89.1751387560756,29.05317003630363],[-89.1578019270927,29.04323299379938]]],[[[-90.43494832883289,29.055654296929692],[-90.42339044284428,29.048201515051506],[-90.44072727182717,29.05317003630363],[-90.43494832883289,29.055654296929692]]],[[[-89.30227550195019,29.05317003630363],[-89.30227550195019,29.050685775677568],[-89.2964965589559,29.055654296929692],[-89.2964965589559,29.050685775677568],[-89.30805444494449,29.04323299379938],[-89.30227550195019,29.05317003630363]]],[[[-90.82213750945094,29.038264472547255],[-90.83369539543955,29.038264472547255],[-90.84525328142814,29.04323299379938],[-90.83947433843383,29.05317003630363],[-90.82213750945094,29.038264472547255]]],[[[-90.79902173747374,29.038264472547255],[-90.78746385148514,29.050685775677568],[-90.78168490849085,29.050685775677568],[-90.79902173747374,29.038264472547255]]],[[[-90.74123230753075,29.040748733173317],[-90.73545336453645,29.048201515051506],[-90.71811653555355,29.048201515051506],[-90.72389547854786,29.04323299379938],[-90.74123230753075,29.040748733173317]]],[[[-90.90304271137114,29.040748733173317],[-90.90304271137114,29.045717254425444],[-90.86259011041105,29.045717254425444],[-90.87414799639964,29.040748733173317],[-90.90304271137114,29.040748733173317]]],[[[-90.82213750945094,29.038264472547255],[-90.82213750945094,29.045717254425444],[-90.82213750945094,29.040748733173317],[-90.80480068046805,29.038264472547255],[-90.82213750945094,29.038264472547255]]],[[[-89.33694915991599,29.03081169066907],[-89.32539127392738,29.04323299379938],[-89.32539127392738,29.040748733173317],[-89.33694915991599,29.03081169066907]]],[[[-89.1751387560756,29.02584316941694],[-89.16935981308131,29.028327430043007],[-89.163580870087,29.03081169066907],[-89.16935981308131,29.02584316941694],[-89.1751387560756,29.02584316941694]]],[[[-89.34272810291029,29.018390387538755],[-89.3485070459046,29.02335890879088],[-89.33694915991599,29.03081169066907],[-89.34272810291029,29.02335890879088],[-89.34272810291029,29.018390387538755]]],[[[-89.1751387560756,29.02584316941694],[-89.163580870087,29.02335890879088],[-89.16935981308131,29.020874648164817],[-89.1751387560756,29.02584316941694]]],[[[-89.16935981308131,29.013421866286627],[-89.1751387560756,29.018390387538755],[-89.1866966420642,29.020874648164817],[-89.1751387560756,29.020874648164817],[-89.16935981308131,29.013421866286627]]],[[[-89.16935981308131,29.018390387538755],[-89.163580870087,29.020874648164817],[-89.15202298409841,29.008453345034503],[-89.16935981308131,29.018390387538755]]],[[[-89.34272810291029,29.018390387538755],[-89.40629647584758,28.948831090009],[-89.39473858985897,28.978642217521752],[-89.34272810291029,29.018390387538755]]],[[[-89.16935981308131,29.018390387538755],[-89.14624404110411,28.998516302530255],[-89.15202298409841,28.99603204190419],[-89.16935981308131,29.018390387538755]]],[[[-89.34272810291029,29.00596908440844],[-89.34272810291029,29.01590612691269],[-89.33694915991599,29.01590612691269],[-89.33694915991599,29.013421866286627],[-89.34272810291029,29.00596908440844]]],[[[-89.37162281788179,28.971189435643566],[-89.3485070459046,29.00596908440844],[-89.34272810291029,29.00348482378238],[-89.37162281788179,28.971189435643566]]],[[[-89.38318070387038,28.961252393139315],[-89.37162281788179,28.97367369626963],[-89.37162281788179,28.96622091439144],[-89.38318070387038,28.961252393139315]]],[[[-89.40051753285329,28.933925526252626],[-89.38895964686469,28.958768132513253],[-89.37740176087608,28.9687051750175],[-89.38318070387038,28.958768132513253],[-89.37740176087608,28.956283871887187],[-89.38318070387038,28.94634682938294],[-89.40051753285329,28.933925526252626]]]]}},{"type":"Feature","id":501,"properties":{"name":"dma:","latitude":40.839717,"dma":501,"dma1":"New York, NY","longitude":-73.6072985},"geometry":{"type":"MultiPolygon","coordinates":[[[[-74.18456062886288,39.72306942524253],[-74.16144485688568,39.71313238273828],[-74.34059208970896,39.576498048304835],[-74.30013948874887,39.5392341389139],[-74.33481314671468,39.50942301140114],[-74.41571834863487,39.55165544204421],[-74.39260257665767,39.77275463776378],[-74.61220241044104,40.18265764106411],[-74.47928672157215,40.272091023602364],[-74.75089704230423,40.42363092179218],[-74.94160216111611,40.341650321132114],[-75.0629599639964,40.42114666116612],[-75.06873890699069,40.542875431843186],[-75.19587565286528,40.575170819982006],[-75.19587565286528,40.75155332443245],[-75.0514020780078,40.86831357385739],[-75.132307279928,40.99004234453446],[-74.96471793309331,41.09438129082909],[-75.15542305190519,41.14903502460247],[-75.12652833693369,41.253373970897094],[-75.35768605670566,41.238468407140715],[-75.35190711371138,41.367649959695974],[-75.26522296879688,41.37510274157416],[-75.0456231350135,41.61607602230224],[-75.074517849985,41.81481687238724],[-75.1438651659166,41.852080781778184],[-74.45039200660065,42.17006614191419],[-74.0747607119712,42.09553832313232],[-73.9996344530453,42.177518923792384],[-73.93028713711371,42.07814849874988],[-73.52576112751275,41.978778073707375],[-73.48530852655264,42.05082163186319],[-73.51998218451845,41.665761234823485],[-73.43907698259827,41.4918629909991],[-73.30038235073508,41.4719889059906],[-73.06922463096309,41.30057492279228],[-73.10389828892889,41.15400354585459],[-73.19058243384339,41.1862989339934],[-73.58932950045005,41.042211817681775],[-73.76847673327333,40.91551452575258],[-73.80892933423343,40.870797834483454],[-73.78581356225622,40.873282095109516],[-73.80315039123911,40.84843948884889],[-73.82048722022202,40.86831357385739],[-73.82048722022202,40.885703398239826],[-73.82626616321632,40.88818765886589],[-73.81470827722772,40.82359688258826],[-73.79159250525052,40.80620705820583],[-73.93028713711371,40.803722797579766],[-73.90717136513652,40.870797834483454],[-73.92450819411941,40.87825061636164],[-73.97651868106811,40.711805154415444],[-74.0689817689769,40.684478287528755],[-74.14410802790279,40.64721437813782],[-74.08053965496549,40.741616281928195],[-74.1556659138914,40.699383851285134],[-74.28858160276027,40.495674479948],[-73.9822976240624,40.403756836783685],[-74.0747607119712,40.35655588488849],[-73.97651868106811,40.37642996989699],[-74.04586599699971,40.31680771487149],[-74.0111923390339,40.30687067236724],[-73.97651868106811,40.37642996989699],[-73.993855510051,40.46834761306131],[-73.9822976240624,40.443505006800684],[-73.9822976240624,40.43108370367037],[-73.97651868106811,40.40127257615762],[-73.9707397380738,40.34910310301031],[-73.9822976240624,40.26463824172418],[-74.0978764839484,39.765301855885596],[-74.08053965496549,39.93671583908391],[-74.19611851485149,39.94913714221423],[-74.1036554269427,39.92677879657966],[-74.19033957185718,39.765301855885596],[-74.19611851485149,39.7379749889989],[-74.18456062886288,39.72306942524253]],[[-74.0863185979598,39.94168436033604],[-74.04586599699971,40.06589739163917],[-74.13255014191418,40.06589739163917],[-74.0574238829883,40.05099182788279],[-74.14988697089709,40.00627513661367],[-74.0863185979598,39.94168436033604]]],[[[-72.0347938349835,41.25088971027103],[-72.0232359489949,41.27573231653166],[-71.9192149750975,41.29312214091409],[-72.00012017701769,41.253373970897094],[-72.0347938349835,41.25088971027103]]],[[[-73.41018226762677,40.654667160016004],[-73.69335047434743,40.63727733563357],[-73.68757153135314,40.59256064436444],[-73.72802413231324,40.60746620812081],[-73.9418450231023,40.542875431843186],[-73.76847673327333,40.597529165616564],[-73.74536096129613,40.63976159625963],[-73.83782404920493,40.66211994189419],[-73.91872925112511,40.632308814381446],[-73.88405559315932,40.57765508060807],[-73.993855510051,40.57020229872988],[-74.0400870540054,40.62485603250325],[-73.90717136513652,40.79130149444945],[-73.85516087818782,40.759006106310636],[-73.78003461926193,40.79627001570157],[-73.75691884728474,40.76645888818882],[-73.75113990429043,40.838502446344634],[-73.71068730333033,40.79627001570157],[-73.72802413231324,40.86582931323133],[-73.64711893039303,40.801238536953704],[-73.63556104440444,40.90309322262227],[-73.46219275457545,40.858376531353144],[-73.49686641254125,40.927935828882894],[-73.48530852655264,40.94780991389139],[-73.42174015361536,40.883219137613764],[-73.43329803960395,40.90557748324833],[-73.37550860966095,40.913030265126515],[-73.36395072367236,40.89067191949195],[-73.35239283768377,40.89315618011801],[-73.39862438163817,40.95526269576958],[-73.17324560486048,40.89315618011801],[-73.1212351179118,40.97762104140415],[-72.64158284938495,40.98010530203021],[-72.35263569966997,41.141582242724276],[-72.23127789678968,41.16145632773278],[-72.40464618661866,41.07450720582058],[-72.42776195859585,40.97762104140415],[-72.46243561656166,41.00743216891689],[-72.64158284938495,40.91551452575258],[-72.49133033153315,40.895640440744074],[-72.31218309870987,41.042211817681775],[-72.25439366876688,40.99501086578658],[-72.16193058085808,41.054633120812085],[-72.09258326492649,40.99252660516052],[-71.85564660216022,41.07202294519452],[-72.47399350255026,40.838502446344634],[-72.41620407260726,40.86334505260527],[-72.41042512961296,40.873282095109516],[-73.41018226762677,40.654667160016004]]],[[[-72.09836220792079,41.0471803389339],[-72.13881480888088,41.09438129082909],[-72.1330358658866,41.124192418341835],[-72.0752464359436,41.099349812081215],[-72.09836220792079,41.0471803389339]]],[[[-72.27173049774977,41.024821993299334],[-72.31218309870987,41.054633120812085],[-72.35263569966997,41.0471803389339],[-72.35263569966997,41.06457016331633],[-72.36419358565857,41.067054423942395],[-72.34685675667566,41.03972755705571],[-72.38153041464146,41.07202294519452],[-72.33529887068707,41.1068025939594],[-72.27173049774977,41.024821993299334]]],[[[-73.38706649564956,41.09438129082909],[-73.38128755265527,41.099349812081215],[-73.38128755265527,41.09438129082909],[-73.38706649564956,41.09438129082909]]],[[[-72.45087773057305,40.95526269576958],[-72.46243561656166,40.96271547764777],[-72.47399350255026,40.97762104140415],[-72.46821455955595,40.985073823282335],[-72.45087773057305,40.95526269576958]]],[[[-73.66445575937593,40.96519973827383],[-73.67023470237024,40.96768399889989],[-73.65867681638164,40.97513678077809],[-73.66445575937593,40.98258956265627],[-73.65867681638164,40.98010530203021],[-73.66445575937593,40.96519973827383]]],[[[-73.78003461926193,40.8807348769877],[-73.78581356225622,40.883219137613764],[-73.78003461926193,40.88818765886589],[-73.78003461926193,40.885703398239826],[-73.78003461926193,40.8807348769877]]],[[[-73.76847673327333,40.8807348769877],[-73.77425567626761,40.883219137613764],[-73.76847673327333,40.88818765886589],[-73.76847673327333,40.8807348769877]]],[[[-73.76847673327333,40.84595522822283],[-73.77425567626761,40.84843948884889],[-73.77425567626761,40.858376531353144],[-73.76269779027902,40.855892270727075],[-73.76847673327333,40.84595522822283]]],[[[-73.78003461926193,40.838502446344634],[-73.79159250525052,40.84347096759676],[-73.79159250525052,40.858376531353144],[-73.78581356225622,40.85092374947495],[-73.78003461926193,40.838502446344634]]],[[[-72.75138276627663,40.76397462756276],[-72.72826699429943,40.77888019131913],[-72.47977244554455,40.840986706970696],[-72.49710927452745,40.83353392509251],[-72.75138276627663,40.76397462756276]]],[[[-73.936066080108,40.781364451945194],[-73.92450819411941,40.801238536953704],[-73.9129503081308,40.79378575507551],[-73.92450819411941,40.781364451945194],[-73.936066080108,40.781364451945194]]],[[[-73.88405559315932,40.786332973197325],[-73.88983453615361,40.786332973197325],[-73.88983453615361,40.798754276327635],[-73.87249770717071,40.78881723382339],[-73.88405559315932,40.786332973197325]]],[[[-73.95918185208521,40.74906906380639],[-73.9418450231023,40.77391167006701],[-73.9534029090909,40.75403758505851],[-73.95918185208521,40.74906906380639]]],[[[-73.26570869276927,40.61740325062507],[-73.31194023672367,40.61988751125113],[-73.31194023672367,40.62485603250325],[-73.10389828892889,40.657151420642066],[-72.75716170927092,40.768943148814884],[-73.0172141440144,40.67702550565057],[-73.26570869276927,40.61740325062507]]],[[[-74.02275022502249,40.684478287528755],[-74.02275022502249,40.69193106940695],[-74.0111923390339,40.689446808780886],[-74.02275022502249,40.684478287528755]]],[[[-73.19058243384339,40.654667160016004],[-73.20214031983198,40.657151420642066],[-73.20214031983198,40.65963568126813],[-73.19058243384339,40.654667160016004]]],[[[-73.26570869276927,40.644730117511756],[-73.27726657875787,40.64721437813782],[-73.27726657875787,40.64969863876388],[-73.26570869276927,40.65963568126813],[-73.26570869276927,40.644730117511756]]],[[[-73.57777161446145,40.575170819982006],[-73.50264535553555,40.612434729372936],[-73.30616129372937,40.64969863876388],[-73.31771917971797,40.64721437813782],[-73.30038235073508,40.63976159625963],[-73.24837186378637,40.63976159625963],[-73.57777161446145,40.575170819982006]]],[[[-73.30616129372937,40.642245856885694],[-73.29460340774077,40.64969863876388],[-73.28882446474648,40.642245856885694],[-73.30616129372937,40.642245856885694]]],[[[-74.24812900180018,40.495674479948],[-74.24812900180018,40.542875431843186],[-74.21345534383438,40.557780995599565],[-74.18456062886288,40.644730117511756],[-74.0689817689769,40.642245856885694],[-74.11521331293129,40.54784395309531],[-74.24812900180018,40.495674479948]]],[[[-73.83204510621061,40.5950449049905],[-73.82048722022202,40.600013426242626],[-73.82626616321632,40.63976159625963],[-73.81470827722772,40.60746620812081],[-73.82048722022202,40.5950449049905],[-73.83204510621061,40.5950449049905]]],[[[-73.84360299219921,40.62485603250325],[-73.84360299219921,40.632308814381446],[-73.83782404920493,40.632308814381446],[-73.84360299219921,40.62485603250325]]],[[[-73.66445575937593,40.597529165616564],[-73.67023470237024,40.60249768686869],[-73.66445575937593,40.60498194749475],[-73.66445575937593,40.597529165616564]]],[[[-73.69912941734174,40.58262360186019],[-73.75691884728474,40.58262360186019],[-73.57777161446145,40.59256064436444],[-73.58355055745574,40.585107862486254],[-73.69912941734174,40.58262360186019]]],[[[-74.30013948874887,39.501970229522954],[-74.13832908490849,39.69574255835584],[-74.12099225592559,39.77275463776378],[-74.09209754095409,39.7578490740074],[-74.23079217281727,39.56904526642664],[-74.30013948874887,39.501970229522954]]],[[[-74.18456062886288,39.72306942524253],[-74.19033957185718,39.74294351025103],[-74.16144485688568,39.73549072837284],[-74.16722379987999,39.720585164616466],[-74.18456062886288,39.72306942524253]]],[[[-74.20189745784577,39.64854160646065],[-74.20189745784577,39.660962909590964],[-74.19033957185718,39.660962909590964],[-74.19033957185718,39.651025867086716],[-74.20189745784577,39.64854160646065]]]]}},{"type":"Feature","id":544,"properties":{"name":"dma:","latitude":36.608336,"dma":544,"dma1":"Norfolk-Portsmouth-Newport News, VA","longitude":-76.3720915},"geometry":{"type":"MultiPolygon","coordinates":[[[[-75.24210719681969,38.026319417641766],[-75.33457028472847,37.89216934383438],[-75.36346499969997,37.86235821632164],[-75.37502288568857,37.85738969506951],[-75.39813865766575,37.87477951945195],[-75.35190711371138,37.869810998199824],[-75.38080182868288,37.912043428842885],[-75.33457028472847,37.9244647319732],[-75.24210719681969,38.026319417641766]]],[[[-75.37502288568857,38.01638237513752],[-75.43281231563157,37.99153976887689],[-75.68708580738074,37.60896363246325],[-75.67552792139213,37.53195155305531],[-75.80844361026102,37.472329298029805],[-75.72753840834083,37.57666824432444],[-75.80844361026102,37.51207746804681],[-75.97025401410141,37.117080028502855],[-76.0222645010501,37.26613566606661],[-75.9644750711071,37.313336617961795],[-76.0222645010501,37.29843105420542],[-75.9355803561356,37.387864436743676],[-75.9644750711071,37.46736077677768],[-75.88934881218123,37.47978207990799],[-75.9644750711071,37.47481355865587],[-75.9355803561356,37.54685711681168],[-75.84311726822682,37.54934137743775],[-75.83155938223823,37.56673120182018],[-75.94135929912991,37.56176268056806],[-75.83155938223823,37.63380623872388],[-75.89512775517551,37.638774759976],[-75.77376995229523,37.755535009400944],[-75.82000149624963,37.79031465816582],[-75.71020157935794,37.79528317941794],[-75.64663320642063,37.89713786508651],[-75.73331735133513,37.91949621072108],[-75.62351743444344,37.99402402950295],[-75.37502288568857,38.01638237513752]]],[[[-75.40391760066007,37.89713786508651],[-75.32879134173417,37.98160272637264],[-75.31145451275128,37.984086986998705],[-75.34612817071707,37.91949621072108],[-75.38080182868288,37.91701195009502],[-75.40391760066007,37.89713786508651]]],[[[-75.43281231563157,37.93440177447745],[-75.44437020162016,37.941854556355636],[-75.42125442964297,37.94682307760776],[-75.43281231563157,37.93440177447745]]],[[[-75.49638068856885,37.82012578567857],[-75.46170703060307,37.884716561956196],[-75.41547548664866,37.88968508320832],[-75.41547548664866,37.884716561956196],[-75.49638068856885,37.82012578567857]]],[[[-75.97603295709571,37.802735961296136],[-75.99914872907291,37.81018874317432],[-75.99914872907291,37.83254708880888],[-75.98181190009001,37.82261004630463],[-75.97603295709571,37.802735961296136]]],[[[-75.51949646054605,37.79528317941794],[-75.51949646054605,37.825094306930694],[-75.50215963156316,37.81764152505251],[-75.51949646054605,37.79528317941794]]],[[[-76.65216928742873,37.60399511121112],[-76.54236937053705,37.559278419942],[-76.27653799279928,37.472329298029805],[-76.27653799279928,37.31085235733573],[-76.35166425172517,37.442518170517054],[-76.34588530873087,37.370474612361235],[-76.44412733963395,37.45493947364737],[-76.40367473867386,37.36799035173517],[-76.44990628262826,37.38041165486549],[-76.46146416861686,37.39780147924793],[-76.48457994059406,37.402770000500055],[-76.49035888358836,37.4127070430043],[-76.49035888358836,37.41767556425643],[-76.50191676957695,37.41767556425643],[-76.49035888358836,37.36053756985699],[-76.40367473867386,37.33569496359636],[-76.44412733963395,37.33817922422243],[-76.49035888358836,37.31085235733573],[-76.38633790969097,37.26365140544055],[-76.50191676957695,37.24626158105811],[-76.70417977437744,37.44003390989099],[-76.65216928742873,37.60399511121112]]],[[[-76.26498010681068,37.472329298029805],[-76.31699059375937,37.48971912241225],[-76.29965376477648,37.514561728672874],[-76.27653799279928,37.499656164916495],[-76.26498010681068,37.472329298029805]]],[[[-76.89488489318931,37.43009686738674],[-76.75619026132614,37.459907994899496],[-76.58282197149714,37.27607270857086],[-76.39211685268526,37.199060629162915],[-76.45568522562256,37.18167080478048],[-76.44990628262826,37.13446985288529],[-76.29387482178217,37.1270170710071],[-76.34588530873087,37.102174464746476],[-76.35166425172517,37.11459576787679],[-76.36900108070807,37.11956428912892],[-76.36322213771376,37.117080028502855],[-76.37478002370237,37.11956428912892],[-76.38633790969097,37.10962724662467],[-76.36322213771376,37.0475207309731],[-76.28231693579357,37.10714298599861],[-76.27075904980498,37.087268900990104],[-76.30543270777078,37.00031977907791],[-76.42101156765676,36.960571609060906],[-76.65216928742873,37.22141897479748],[-76.87176912121211,37.24129305980598],[-76.89488489318931,37.43009686738674]]],[[[-76.72729554635464,36.24262028812882],[-77.20694781488149,36.24758880938094],[-77.0682531830183,36.49849913261326],[-77.35142138973897,36.5556371270127],[-77.37453716171618,36.63016494579458],[-77.50167390759076,36.66991311581158],[-76.95267432313231,36.945666045304534],[-76.96423220912091,37.05497351285129],[-77.1549373279328,37.11211150725073],[-77.0104637530753,37.2338402779278],[-76.74463237533753,37.146891156015606],[-76.68684294539455,37.19657636853685],[-76.66372717341734,37.045036470347036],[-76.57704302850286,37.02019386408641],[-76.58282197149714,36.99783551845185],[-76.61171668646864,37.0077725609561],[-76.61749562946295,37.00031977907791],[-76.62327457245723,36.99038273657366],[-76.62327457245723,36.98292995469547],[-76.48457994059406,36.95560308780878],[-76.54814831353136,36.831390056505654],[-76.43256945364536,36.90591787528753],[-76.34010636573657,36.861201184018405],[-76.39211685268526,36.85374840214021],[-76.40945368166817,36.833874317131716],[-76.39789579567957,36.82642153525353],[-76.40367473867386,36.81151597149715],[-76.40367473867386,36.80654745024503],[-76.20141173387339,36.821453014001406],[-76.32854847974798,36.876106747774784],[-76.28231693579357,36.888528050905094],[-76.32854847974798,36.96305586968697],[-75.9933697860786,36.91585491779178],[-75.88356986918691,36.60780660016002],[-75.77376995229523,36.2301989849985],[-75.53683328952894,35.79048485418542],[-75.72753840834083,36.0041312680268],[-75.68130686438644,36.01655257115712],[-75.73909629432943,36.04139517741774],[-75.94135929912991,36.72456684958496],[-75.9933697860786,36.56805843014302],[-75.92402247014701,36.56805843014302],[-75.90090669816982,36.48856209010901],[-75.9875908430843,36.4960148719872],[-76.04538027302729,36.615259382038204],[-76.0280434440444,36.5158889569957],[-76.0858328739874,36.50098339323932],[-75.94713824212421,36.36186479817982],[-75.92402247014701,36.42645557445745],[-75.79688572427243,36.0712063049305],[-75.97025401410141,36.332053670667065],[-76.04538027302729,36.35938053755376],[-75.95291718511851,36.28485271877188],[-75.9933697860786,36.20038785748575],[-75.91246458415841,36.165608208720876],[-76.0164855580558,36.18548229372938],[-76.13206441794179,36.29478976127613],[-76.21874856285629,36.30224254315432],[-76.0627171020102,36.14573412371237],[-76.18407490489048,36.12586003870388],[-76.28809587878789,36.222746203120316],[-76.22452750585057,36.09604891119112],[-76.45568522562256,36.20287211811181],[-76.30543270777078,36.09853317181718],[-76.51347465556555,36.006615528652866],[-76.68684294539455,36.061269262426244],[-76.67528505940594,36.277399936893694],[-76.77352709030903,36.36186479817982],[-76.79664286228623,36.35938053755376],[-76.69840083138314,36.29478976127613],[-76.72729554635464,36.24262028812882]]],[[[-76.75041131833183,37.18912358665867],[-76.76774814731473,37.19657636853685],[-76.78508497629763,37.213966192919294],[-76.73307448934892,37.204029150415046],[-76.75041131833183,37.18912358665867]]],[[[-75.9644750711071,37.084784640364035],[-75.97603295709571,37.087268900990104],[-75.97603295709571,37.102174464746476],[-75.95291718511851,37.09472168286829],[-75.9644750711071,37.084784640364035]]],[[[-75.90090669816982,35.668756083508356],[-76.01070661506151,35.668756083508356],[-75.9875908430843,35.88985527922792],[-75.80844361026102,35.95941457675768],[-75.72753840834083,35.822780242324235],[-75.71598052235223,35.69856721102111],[-75.77954889528954,35.68366164726473],[-75.73331735133513,35.624039392239226],[-75.83733832523252,35.57186991909191],[-75.90090669816982,35.668756083508356]]],[[[-75.62929637743774,35.82029598169817],[-75.65241214941494,35.8252645029503],[-75.72753840834083,35.937056231123115],[-75.64663320642063,35.909729364236426],[-75.62929637743774,35.82029598169817]]],[[[-75.75065418031804,35.18929378267827],[-75.51949646054605,35.268790122712275],[-75.46748597359735,35.58180696159616],[-75.52527540354035,35.77557929042904],[-75.45592808760875,35.57186991909191],[-75.48482280258025,35.41536149964997],[-75.53105434653466,35.21662064956496],[-75.75065418031804,35.18929378267827]]]]}},{"type":"Feature","id":740,"properties":{"name":"dma:","latitude":41.394995,"dma":740,"dma1":"North Platte, NE","longitude":-100.836179},"geometry":{"type":"Polygon","coordinates":[[[-101.24735067116711,41.00494790829083],[-101.27046644314431,41.39497682658266],[-101.98705537443743,41.39497682658266],[-101.98705537443743,41.74277331423143],[-101.4264979039904,41.74277331423143],[-101.4264979039904,42.093054062506255],[-99.68703606270627,42.08560128062807],[-99.68703606270627,41.740289053605366],[-100.2533724761476,41.740289053605366],[-100.22447776117612,40.699383851285134],[-101.24735067116711,40.69689959065907],[-101.24735067116711,41.00494790829083]]]}},{"type":"Feature","id":633,"properties":{"name":"dma:","latitude":30.781491,"dma":633,"dma1":"Odessa-Midland, TX","longitude":-103.077288},"geometry":{"type":"Polygon","coordinates":[[[-101.76167659765977,29.781058399739976],[-102.11419212031203,29.793479702870286],[-102.31645512511251,29.880428824782477],[-102.3858024410441,29.761184314731473],[-102.67474959075908,29.743794490349035],[-102.88279153855385,29.34631279017902],[-102.86545470957095,29.22458401950195],[-102.99259145544553,29.179867328232824],[-103.15440185928593,28.971189435643566],[-104.03858013741373,29.31898592329233],[-104.53556923492349,29.666782410941096],[-104.68582175277527,29.93011403730373],[-104.70893752475247,30.23567809430943],[-104.98054784548455,30.628191273227323],[-104.10214851035103,31.105169313431343],[-104.02702225142514,31.999503138813882],[-103.72073827272727,31.999503138813882],[-103.72073827272727,32.523682130913095],[-103.81320136063606,32.52865065216522],[-103.54159103990399,32.523682130913095],[-103.4433490090009,32.41934318461846],[-103.25842283318332,32.47151265776578],[-103.18329657425743,32.59075716781678],[-103.06193877137713,32.52119787028703],[-101.17222441224122,32.523682130913095],[-101.18378229822981,32.08645226072608],[-101.26468750015002,32.08645226072608],[-101.27624538613861,31.08032670717072],[-101.85991862856285,31.08032670717072],[-102.2991182961296,31.085295228422844],[-102.3915813840384,31.087779489048906],[-102.3915813840384,31.085295228422844],[-101.88303440054005,30.926302548354837],[-101.80790814161416,30.702719092009204],[-101.65187668076807,30.620738491349137],[-101.73856082568257,30.421997641264127],[-101.65765562376237,30.342501301230122],[-101.75589765466546,30.287847567456748],[-101.76167659765977,29.781058399739976]]]}},{"type":"Feature","id":650,"properties":{"name":"dma:","latitude":35.667342,"dma":650,"dma1":"Oklahoma City, OK","longitude":-97.9919705},"geometry":{"type":"Polygon","coordinates":[[[-100.00487792739274,37.002804039703975],[-96.75133302160216,36.99783551845185],[-96.75133302160216,36.7817048439844],[-97.06339594329432,36.66742885518552],[-97.05183805730573,36.592901036403646],[-96.89002765346534,36.575511212021205],[-97.03450122832282,36.50595191449145],[-97.03450122832282,36.334537931293134],[-96.82068033753376,36.24758880938094],[-96.82068033753376,36.15815542684268],[-96.62419627572757,36.16063968746875],[-96.62419627572757,35.40045593589359],[-96.43927009990999,35.467530972797285],[-96.43927009990999,35.29114846834683],[-95.98273360336033,35.28866420772077],[-95.98273360336033,35.15202987328733],[-96.08675457725772,35.05017518761876],[-96.09253352025202,34.766969476247624],[-96.4045964419442,34.766969476247624],[-96.4045964419442,34.93341493819382],[-96.52595424482448,34.868824161916194],[-96.69354359165916,34.93341493819382],[-96.72821724962496,34.856402858785884],[-96.93048025442545,34.96322606570657],[-96.93048025442545,34.59307123242324],[-96.82645928052804,34.59307123242324],[-96.87846976747674,34.33222386668667],[-97.3523430930093,34.3769405579558],[-97.3523430930093,34.50612211051105],[-97.56038504080408,34.50612211051105],[-97.56038504080408,34.68002035433543],[-98.08626885328533,34.68002035433543],[-98.09204779627963,34.85391859815982],[-98.82597355655565,34.856402858785884],[-98.82597355655565,34.59307123242324],[-98.99934184638464,34.595555493049304],[-99.10336282028203,34.63778792369237],[-99.03979444734473,34.68995739683969],[-99.16115225022502,34.709831481848184],[-99.18426802220222,34.858887119411946],[-99.4038678559856,34.814170428142816],[-99.4212046849685,34.72473704560456],[-99.66969923372338,34.72473704560456],[-99.66392029072907,34.50612211051105],[-99.99909898439844,34.56077584428443],[-100.00487792739274,37.002804039703975]]]}},{"type":"Feature","id":652,"properties":{"name":"dma:","latitude":41.1056295,"dma":652,"dma1":"Omaha, NE","longitude":-96.150686},"geometry":{"type":"Polygon","coordinates":[[[-97.83199536153614,41.74277331423143],[-97.01716439933993,41.74277331423143],[-97.01716439933993,42.09056980188019],[-96.55484895979598,42.09056980188019],[-96.55484895979598,42.01604198309832],[-96.2716807530753,42.048337371237125],[-96.13298612121213,41.97380955245525],[-96.13876506420641,41.866986345534556],[-95.67067068166816,41.86201782428243],[-95.67067068166816,42.21229857255726],[-95.09277638223821,42.2098143119312],[-95.09277638223821,41.60117045854586],[-95.04076589528952,41.60117045854586],[-95.04076589528952,41.50428429412942],[-94.69980825862586,41.50428429412942],[-94.69980825862586,41.15897206710672],[-94.46865053885388,41.156487806480655],[-94.46865053885388,40.9006089619962],[-94.93096597839784,40.9006089619962],[-94.91362914941493,40.575170819982006],[-95.2025762991299,40.57765508060807],[-95.17946052715271,40.26215398109811],[-95.55509182178217,40.26463824172418],[-95.3932814179418,40.12055112541255],[-95.416397189919,40.04105478537854],[-95.30659727302731,39.99882235473548],[-96.4623858718872,40.00130661536154],[-96.4623858718872,41.04469607830784],[-97.3696799219922,41.0471803389339],[-97.3696799219922,41.39497682658266],[-97.60083764176417,41.3328703109311],[-97.60083764176417,41.39497682658266],[-97.70485861566156,41.39497682658266],[-97.70485861566156,41.52664263976398],[-97.83199536153614,41.52664263976398],[-97.83199536153614,41.74277331423143]]]}},{"type":"Feature","id":534,"properties":{"name":"dma:","latitude":28.6562235,"dma":534,"dma1":"Orlando-Daytona Beach-Melbourne, FL","longitude":-81.4963015},"geometry":{"type":"MultiPolygon","coordinates":[[[[-80.63963995349535,28.409746534153417],[-80.60496629552955,28.419683576657665],[-80.59918735253525,28.57619199609961],[-80.72054515541554,28.40726227352735],[-80.72632409840983,28.60600312361236],[-80.81878718631863,28.650719814881487],[-80.74366092739274,28.397325231023103],[-80.48938743564356,27.85327215391539],[-80.88235555925593,27.82346102640264],[-80.87079767326733,27.64211000070007],[-81.1424079939994,27.64211000070007],[-81.20597636693668,27.820976765776578],[-81.46024985868587,28.039591700870087],[-81.37934465676568,28.012264833983398],[-81.34467099879987,28.084308392139214],[-81.52381823162315,28.143930647164716],[-81.55849188958896,28.258206635963596],[-81.65673392049204,28.258206635963596],[-81.65673392049204,28.34764001850185],[-82.0554809870987,28.312860369736974],[-82.0554809870987,28.52153826232623],[-82.2750808208821,28.653204075507553],[-82.1826177329733,28.822133798079808],[-82.31553342184219,28.97367369626963],[-82.53513325562557,29.040748733173317],[-82.53513325562557,29.2146469769977],[-82.40221756675668,29.2146469769977],[-82.40799650975097,29.485431385238524],[-82.1017125310531,29.418356348334832],[-81.84166009630962,29.520211034003403],[-81.67984969246925,29.323954444544455],[-81.44291302970296,29.38606096019602],[-81.52381823162315,29.622065719671966],[-81.211755309931,29.67175093219322],[-80.91702921722171,29.078012642564257],[-80.94592393219321,29.095402466946695],[-81.02105019111912,29.23203680138014],[-81.02105019111912,29.234521062006202],[-81.0557238490849,29.304080359535952],[-81.09039750705071,29.38854522082208],[-81.096176450045,29.405935045204522],[-81.1019553930393,29.408419305830584],[-80.96903970417041,29.08298116381638],[-80.74943987038704,28.745121718671868],[-80.84768190129013,28.799775452445246],[-80.80722930033002,28.650719814881487],[-80.72632409840983,28.702889288028803],[-80.76099775637564,28.72773189428943],[-80.74943987038704,28.742637458045806],[-80.68587149744974,28.67059389988999],[-80.63386101050105,28.655688336133615],[-80.89391344524452,28.988579260026004],[-80.88235555925593,28.998516302530255],[-80.91702921722171,29.07304412131213],[-80.58185052355236,28.591097559855985],[-80.52406109360936,28.459431746674667],[-80.58185052355236,28.41223079477948],[-80.63963995349535,28.409746534153417]]],[[[-80.98059759015902,29.142603418841883],[-80.98059759015902,29.14508767946795],[-80.97481864716471,29.14757194009401],[-80.98059759015902,29.142603418841883]]],[[[-80.91125027422743,29.013421866286627],[-80.91125027422743,29.01590612691269],[-80.91125027422743,29.010937605660565],[-80.91702921722171,29.02584316941694],[-80.90547133123312,29.03329595129513],[-80.90547133123312,29.02584316941694],[-80.90547133123312,29.02335890879088],[-80.89969238823882,29.02335890879088],[-80.90547133123312,29.02335890879088],[-80.91125027422743,29.013421866286627]]],[[[-80.91125027422743,29.013421866286627],[-80.91702921722171,29.013421866286627],[-80.91702921722171,29.018390387538755],[-80.91702921722171,29.01590612691269],[-80.91125027422743,29.013421866286627]]],[[[-80.63963995349535,28.409746534153417],[-80.58762946654664,28.40726227352735],[-80.58762946654664,28.16380473217322],[-80.45471377767777,27.855756414541453],[-80.61074523852385,28.168773253425343],[-80.61074523852385,28.38490392789279],[-80.63963995349535,28.409746534153417]]],[[[-80.61652418151814,28.161320471547153],[-80.60496629552955,28.141446386538654],[-80.66853466846685,28.265659417841785],[-80.72054515541554,28.40477801290129],[-80.73210304140414,28.40477801290129],[-80.69165044044405,28.40726227352735],[-80.65697678247824,28.40477801290129],[-80.66853466846685,28.374966885388538],[-80.65697678247824,28.30043906660666],[-80.69742938343833,28.40477801290129],[-80.69742938343833,28.367514103510352],[-80.61652418151814,28.161320471547153]]],[[[-80.64541889648964,28.3575770610061],[-80.66275572547255,28.3575770610061],[-80.65119783948396,28.360061321632163],[-80.64541889648964,28.3575770610061]]],[[[-80.64541889648964,28.3575770610061],[-80.62230312451246,28.360061321632163],[-80.61652418151814,28.3575770610061],[-80.64541889648964,28.3575770610061]]]]}},{"type":"Feature","id":631,"properties":{"name":"dma:","latitude":40.384083,"dma":631,"dma1":"Ottumwa, IA-Kirksville, MO","longitude":-92.545142},"geometry":{"type":"Polygon","coordinates":[[[-93.3648724269427,40.26712250235024],[-93.37643031293129,40.58013934123413],[-92.63672560966097,40.59007638373838],[-92.64250455265525,41.16145632773278],[-91.71787367356735,41.16394058835884],[-91.71787367356735,40.597529165616564],[-92.35355740294028,40.597529165616564],[-92.3015469159916,39.606309175817586],[-92.69451503960396,39.61127769706971],[-92.68873609660966,39.6982268189819],[-92.85632544344435,39.70071107960796],[-92.84476755745574,40.03608626412642],[-93.3648724269427,40.033602003500356],[-93.3648724269427,40.26712250235024]]]}},{"type":"Feature","id":632,"properties":{"name":"dma:","latitude":37.2352865,"dma":632,"dma1":"Paducah, KY-Cape Girardeau, MO-Harrisburg, IL","longitude":-89.497325},"geometry":{"type":"Polygon","coordinates":[[[-88.52789714071406,36.1507026449645],[-88.67814965856586,36.061269262426244],[-88.96131786528653,36.222746203120316],[-89.63167525262526,36.18548229372938],[-89.70680151155116,36.24013602750276],[-89.53921216471647,36.24758880938094],[-89.62011736663666,36.32211662816282],[-89.54499110771077,36.337022191919196],[-89.72991728352835,36.42645557445745],[-89.96107500330032,36.389191665066505],[-89.96107500330032,35.99916274677468],[-90.37715889888989,35.99667848614862],[-90.07665386318632,36.279884197519756],[-90.06509597719771,36.38422314381438],[-90.1517801221122,36.49849913261326],[-91.1284214881488,36.49849913261326],[-91.11686360216021,36.82393727462747],[-91.2266635190519,36.82642153525353],[-91.2151056330633,37.087268900990104],[-91.01862157125711,37.09472168286829],[-91.01862157125711,37.144406895389544],[-91.1284214881488,37.199060629162915],[-91.209326690069,37.50214042554256],[-91.3133476639664,37.50462468616862],[-91.3133476639664,37.59405806870687],[-90.77012702250225,37.60399511121112],[-90.75279019351936,37.271104187318734],[-90.55052718871886,37.273588447944796],[-90.53319035973597,37.643743281228126],[-90.14600117911792,37.641259020602064],[-89.84549614341434,37.9045906469647],[-89.67212785358535,37.802735961296136],[-89.59700159465946,37.95427585948595],[-89.59122265166516,38.22009174647465],[-89.14624404110411,38.212638964596465],[-89.14624404110411,38.47348633033304],[-88.70126543054306,38.4759705909591],[-88.70126543054306,38.25735565586559],[-88.371865679868,38.254871395239526],[-88.371865679868,37.90955916821682],[-88.13492901710171,37.91701195009502],[-88.03090804320432,37.83751561006101],[-88.0886974731473,37.82261004630463],[-88.03090804320432,37.800251700670074],[-88.1580447890789,37.66610162686269],[-88.14070796009601,37.586605286828686],[-87.79975032343233,37.38289591549155],[-87.85176081038104,37.318305139213926],[-87.67839252055205,37.15185967726773],[-87.76507666546655,36.975477172817286],[-88.1580447890789,36.86616970527053],[-88.05402381518152,36.4960148719872],[-88.51633925472547,36.50098339323932],[-88.52789714071406,36.1507026449645]]]}},{"type":"Feature","id":804,"properties":{"name":"dma:","latitude":33.72988,"dma":804,"dma1":"Palm Springs, CA","longitude":-116.2354255},"geometry":{"type":"Polygon","coordinates":[[[-116.08767628052804,33.42546873817382],[-116.5904443210321,33.42795299879988],[-116.5673285490549,33.562103072607265],[-116.79270732583258,33.68631610391039],[-116.68290740894089,33.745938358935895],[-116.71758106690669,34.03411259155916],[-116.45752863216322,34.03411259155916],[-116.45752863216322,33.974490336533655],[-116.19747619741975,33.860214347734775],[-116.02988685058506,33.58694567886789],[-115.67737132793279,33.42795299879988],[-116.08767628052804,33.42546873817382]]]}},{"type":"Feature","id":656,"properties":{"name":"dma:","latitude":30.293713,"dma":656,"dma1":"Panama City, FL","longitude":-85.3696325},"geometry":{"type":"MultiPolygon","coordinates":[[[[-86.39546717581757,30.379765210621063],[-86.2509936009601,30.429450423142313],[-86.11229896909691,30.387217992499252],[-86.1989831140114,30.503978241924194],[-86.39546717581757,30.45429302940294],[-86.38968823282329,30.99337758525853],[-85.00274191419142,31.000830367136714],[-84.85826833933393,30.697750570757076],[-84.93339459825982,30.60583292759276],[-84.64444744854485,30.387217992499252],[-84.73691053645365,30.265489221822182],[-84.65600533453346,30.096559499249928],[-84.43640550075007,29.97731498919892],[-84.34394241284127,29.90030290979098],[-84.51153175967596,29.917692734173418],[-84.88716305430543,29.721436144714474],[-84.91605776927693,29.733857447844784],[-84.89872094029403,29.73882596909691],[-84.85826833933393,29.793479702870286],[-84.85248939633964,29.81583804850485],[-84.99118402820281,29.713983362836284],[-85.1183207740774,29.716467623462346],[-85.34947849384938,29.656845368436844],[-85.37837320882088,29.689140756575657],[-85.39571003780378,29.731373187218722],[-85.41304686678669,29.808385266626665],[-85.41882580978097,29.84316491539154],[-85.36103637983798,29.679203714071406],[-85.31480483588359,29.838196394139416],[-85.68465718751875,30.12140210551055],[-85.46505735373538,30.01457889858986],[-85.38993109480947,30.02451594109411],[-85.38993109480947,30.051842807980798],[-85.48239418271827,30.031968722972298],[-85.48817312571256,30.096559499249928],[-85.73088873147314,30.17605583928393],[-85.60375198559856,30.277910524952496],[-85.85224653435344,30.28287904620462],[-85.74244661746175,30.218288269926994],[-85.75400450345035,30.1710873180318],[-85.70777295949594,30.14624471177118],[-85.73666767446744,30.12140210551055],[-86.39546717581757,30.379765210621063]]],[[[-84.66756322052206,29.778574139113914],[-84.58087907560756,29.808385266626665],[-84.57510013261326,29.825775091009103],[-84.58087907560756,29.8059010060006],[-84.66756322052206,29.778574139113914]]],[[[-85.04897345814581,29.58728607090709],[-85.09520500210022,29.627034240924093],[-84.97962614221422,29.607160155915594],[-84.69645793549356,29.768637096609663],[-84.77736313741374,29.691625017201723],[-84.95651037023703,29.612128677167718],[-85.04897345814581,29.58728607090709]]],[[[-85.12409971707172,29.629518501550155],[-85.1818891470147,29.664298150315034],[-85.2223417479748,29.679203714071406],[-85.1125418310831,29.689140756575657],[-85.06631028712872,29.67175093219322],[-85.12409971707172,29.629518501550155]]]]}},{"type":"Feature","id":597,"properties":{"name":"dma:","latitude":39.336078,"dma":597,"dma1":"Parkersburg, WV","longitude":-81.4306435},"geometry":{"type":"Polygon","coordinates":[[[-81.22331319591959,39.308197900690075],[-81.29266051185118,39.18646913001301],[-81.58160766156615,39.02499218931894],[-81.74919700840084,39.09455148684869],[-81.72030229342934,39.26844973067307],[-81.85321798229822,39.31813494319432],[-81.82432326732673,39.49451744764477],[-81.70874440744075,39.479611883888396],[-81.71452335043504,39.58395083018302],[-81.47180774467446,39.58395083018302],[-81.47180774467446,39.646057345834585],[-81.03838702010201,39.57152952705271],[-81.11929222202221,39.45725353825383],[-81.0268291341134,39.46719058075808],[-81.00949230513052,39.350430331333136],[-81.22331319591959,39.308197900690075]]]}},{"type":"Feature","id":675,"properties":{"name":"dma:","latitude":40.6826125,"dma":675,"dma1":"Peoria-Bloomington, IL","longitude":-89.343186},"geometry":{"type":"Polygon","coordinates":[[[-90.44650621482148,40.714289415041506],[-89.98419077527753,40.711805154415444],[-89.98419077527753,41.14903502460247],[-89.86861191539154,41.14903502460247],[-89.86861191539154,41.23349988588859],[-89.63745419561957,41.23349988588859],[-89.63745419561957,41.14903502460247],[-89.46408590579057,41.14903502460247],[-89.46408590579057,41.23349988588859],[-89.163580870087,41.310511965296534],[-89.163580870087,41.10431833333334],[-89.04800201020102,41.10431833333334],[-89.04800201020102,40.92545156825683],[-88.93242315031503,40.927935828882894],[-88.93242315031503,41.1068025939594],[-88.2505078769877,41.11425537583759],[-88.2331710480048,40.61740325062507],[-88.45854982478247,40.61740325062507],[-88.45854982478247,40.28202806610661],[-89.60278053765376,40.31929197549755],[-89.60278053765376,40.12055112541255],[-89.99574866126613,40.10812982228223],[-90.2846958109811,40.05596034913492],[-90.35404312691269,40.12303538603861],[-90.1980116660666,40.18514190169017],[-90.45228515781578,40.1901104229423],[-90.44650621482148,40.714289415041506]]]}},{"type":"Feature","id":504,"properties":{"name":"dma:","latitude":39.8995855,"dma":504,"dma1":"Philadelphia, PA","longitude":-75.3874975},"geometry":{"type":"MultiPolygon","coordinates":[[[[-74.64687606840684,39.23863860316032],[-74.64687606840684,39.236154342534256],[-74.64687606840684,39.233670081908194],[-74.64687606840684,39.22870156065607],[-74.66421289738975,39.22870156065607],[-74.66999184038403,39.20385895439544],[-74.71044444134412,39.18398486938694],[-74.69888655535553,39.15665800250025],[-74.75089704230423,39.149205220622065],[-74.71622338433843,39.1268468749875],[-74.75667598529853,39.13429965686569],[-74.79712858625862,39.092067226222625],[-74.76823387128712,39.05728757745775],[-74.82024435823581,39.05977183808381],[-74.90692850315031,38.950464370537055],[-74.87225484518451,38.94301158865887],[-74.96471793309331,38.93059028552855],[-74.8895916741674,39.15914226312631],[-75.13808622292228,39.179016348134816],[-75.53683328952894,39.45973779887989],[-75.51371751755175,39.56407674517452],[-75.56572800450044,39.561592484548456],[-75.59462271947194,39.46719058075808],[-75.40969654365436,39.263481209420945],[-75.40391760066007,39.067224619962],[-75.34034922772277,39.02002366806681],[-75.31145451275128,38.94549584928493],[-75.72175946534654,38.83121986048605],[-75.79110678127813,39.720585164616466],[-76.1262854749475,39.720585164616466],[-76.13784336093609,39.72555368586859],[-75.9875908430843,39.87212506280628],[-75.94135929912991,40.10812982228223],[-75.87201198319832,40.13794094979498],[-76.43834839663967,40.495674479948],[-76.0164855580558,40.572686559355944],[-75.9933697860786,40.63976159625963],[-75.12074939393939,40.96768399889989],[-75.0514020780078,40.86831357385739],[-75.19587565286528,40.75155332443245],[-75.2016545958596,40.61740325062507],[-75.06873890699069,40.542875431843186],[-75.0571810210021,40.416178139913995],[-74.93004427512751,40.33916606050605],[-74.75089704230423,40.42363092179218],[-74.47928672157215,40.272091023602364],[-74.61220241044104,40.18265764106411],[-74.39260257665767,39.77275463776378],[-74.39260257665767,39.593887872687276],[-74.46194989258926,39.55662396329633],[-74.37526574767477,39.48209614451446],[-74.57174980948095,39.30322937943795],[-74.65265501140114,39.320619203820385],[-74.62953923942393,39.24857564566457],[-74.64687606840684,39.24112286378638],[-74.64687606840684,39.23863860316032]]],[[[-74.38682363366337,39.45725353825383],[-74.39260257665767,39.45973779887989],[-74.39260257665767,39.46719058075808],[-74.38682363366337,39.46470632013202],[-74.38682363366337,39.462222059505955],[-74.38682363366337,39.45725353825383]]],[[[-74.40416046264626,39.3727886769677],[-74.40993940564056,39.40259980448045],[-74.33481314671468,39.44234797449745],[-74.33481314671468,39.4324109319932],[-74.40416046264626,39.3727886769677]]],[[[-74.49084460756075,39.3529145919592],[-74.44461306360637,39.36036737383739],[-74.45617094959496,39.37527293759376],[-74.40993940564056,39.365335895089515],[-74.53707615151515,39.30322937943795],[-74.53707615151515,39.30571364006401],[-74.51973932253225,39.33055624632463],[-74.50818143654365,39.33055624632463],[-74.51396037953795,39.33800902820282],[-74.49084460756075,39.3529145919592]]],[[[-74.49084460756075,39.3529145919592],[-74.49084460756075,39.37527293759376],[-74.46194989258926,39.36036737383739],[-74.48506566456646,39.35788311321132],[-74.49084460756075,39.3529145919592]]],[[[-74.53707615151515,39.31068216131614],[-74.53707615151515,39.31565068256826],[-74.53129720852084,39.320619203820385],[-74.53129720852084,39.31565068256826],[-74.53707615151515,39.31068216131614]]],[[[-74.64687606840684,39.23863860316032],[-74.62953923942393,39.24360712441244],[-74.60642346744675,39.26844973067307],[-74.59486558145815,39.26844973067307],[-74.60064452445243,39.275902512551255],[-74.55441298049806,39.29826085818582],[-74.64687606840684,39.21131173627363],[-74.64687606840684,39.23863860316032]],[[-74.58908663846384,39.27341825192519],[-74.59486558145815,39.275902512551255],[-74.59486558145815,39.27341825192519],[-74.58908663846384,39.27341825192519]]],[[[-74.71622338433843,39.119394093109314],[-74.69888655535553,39.15417374187419],[-74.69888655535553,39.16907930563057],[-74.64687606840684,39.20882747564757],[-74.71622338433843,39.119394093109314]]],[[[-74.78557070027003,39.02002366806681],[-74.73356021332134,39.08958296559656],[-74.74511809930993,39.09455148684869],[-74.72778127032703,39.092067226222625],[-74.71622338433843,39.109457050605066],[-74.71622338433843,39.11690983248325],[-74.70466549834984,39.10200426872687],[-74.78557070027003,39.02002366806681]]],[[[-74.75089704230423,39.10200426872687],[-74.75089704230423,39.11690983248325],[-74.72778127032703,39.11690983248325],[-74.73933915631562,39.11194131123113],[-74.75089704230423,39.10200426872687]]],[[[-74.72200232733273,39.10200426872687],[-74.72778127032703,39.106972789979],[-74.73356021332134,39.109457050605066],[-74.72200232733273,39.104488529352935],[-74.72200232733273,39.10200426872687]]],[[[-74.72200232733273,39.09952000810081],[-74.73356021332134,39.104488529352935],[-74.72778127032703,39.104488529352935],[-74.72200232733273,39.09952000810081]]],[[[-74.79134964326433,39.02996071057106],[-74.79712858625862,39.03741349244925],[-74.77979175727572,39.04238201370137],[-74.77979175727572,39.03989775307531],[-74.79134964326433,39.02996071057106]]],[[[-74.80868647224722,39.00263384368437],[-74.81446541524153,39.005118104310434],[-74.80868647224722,39.03244497119712],[-74.79712858625862,39.01008662556256],[-74.80868647224722,39.00263384368437]]],[[[-74.86647590219022,38.938043067406745],[-74.86069695919592,38.97282271617162],[-74.84336013021303,38.97282271617162],[-74.79712858625862,39.007602364936496],[-74.79712858625862,39.02499218931894],[-74.78557070027003,39.00014958305831],[-74.86647590219022,38.938043067406745]]],[[[-74.83180224422442,38.995181061806186],[-74.83180224422442,39.007602364936496],[-74.82024435823581,38.99766532243225],[-74.82602330123012,38.99766532243225],[-74.83180224422442,38.995181061806186]]],[[[-74.83758118721872,38.98524401930193],[-74.84336013021303,38.992696801180124],[-74.84913907320731,38.995181061806186],[-74.84913907320731,38.99766532243225],[-74.84336013021303,39.005118104310434],[-74.83180224422442,38.992696801180124],[-74.83758118721872,38.98524401930193]]]]}},{"type":"Feature","id":753,"properties":{"name":"dma:","latitude":34.7133875,"dma":753,"dma1":"Phoenix, AZ","longitude":-111.899851},"geometry":{"type":"Polygon","coordinates":[[[-113.33112047224722,32.50380804590459],[-113.33112047224722,33.37826778627863],[-113.95524631563156,33.37826778627863],[-113.95524631563156,33.46521690819082],[-114.26730923732373,33.462732647564756],[-114.26730923732373,33.03047129862986],[-114.66027736093609,33.032955559255925],[-114.70650890489048,33.090093553655365],[-114.72384573387339,33.405594653165316],[-114.5273616720672,33.55216603010301],[-114.5331406150615,33.934742166516656],[-114.41756175517551,34.10864041034104],[-114.12861460546054,34.26266456915692],[-114.38288809720972,34.4564368979898],[-114.4695722421242,34.712315742474246],[-114.63716158895889,34.87379268316832],[-114.64871947494748,35.10234466076608],[-114.5678142730273,35.184325261426146],[-114.67761418991898,35.4998263609361],[-114.71228784788478,35.805390417941794],[-114.66027736093609,35.87246545484549],[-114.75274044884488,36.091080389938995],[-114.40600386918692,36.148218384338435],[-114.24419346534653,36.01655257115712],[-114.14595143444345,36.02648961366137],[-114.04770940354035,36.192935075607565],[-114.05348834653465,37.00031977907791],[-110.00244930753075,36.99783551845185],[-110.00244930753075,35.66378756225623],[-109.82908101770177,35.66130330163016],[-109.85219678967897,34.662630529953],[-109.38988135013501,34.65020922682268],[-109.04892371347134,34.871308422542256],[-109.04892371347134,32.42679596649665],[-110.4532068610861,32.42679596649665],[-110.4532068610861,32.51374508840884],[-113.33112047224722,32.50380804590459]]]}},{"type":"Feature","id":508,"properties":{"name":"dma:","latitude":40.409733,"dma":508,"dma1":"Pittsburgh, PA","longitude":-79.6590145},"geometry":{"type":"Polygon","coordinates":[[[-80.40848223372336,39.718100903990404],[-80.51828215061505,39.720585164616466],[-80.51828215061505,41.124192418341835],[-80.0964193120312,41.06953868456846],[-79.99817728112811,41.17139337023703],[-79.99817728112811,41.50180003350336],[-79.83058793429342,41.62104454355436],[-79.51274606960696,41.623528804180424],[-79.47807241164116,41.38752404470448],[-79.2064620909091,41.42975647534754],[-79.2180199768977,40.91054600450045],[-78.80771502430242,40.90557748324833],[-78.79615713831383,40.71677367566757],[-78.94640965616561,40.44102074617462],[-79.42028298169816,39.85473523842384],[-79.35093566576657,39.787660201520154],[-79.39138826672666,39.720585164616466],[-78.92907282718272,39.72306942524253],[-79.11399900300029,39.4324109319932],[-79.48963029762976,39.193921911891195],[-79.68611435943595,39.27093399129913],[-79.84792476327632,39.24609138503851],[-79.89415630723073,39.434895192619265],[-80.1542087419742,39.61127769706971],[-80.39692434773477,39.63612030333034],[-80.40848223372336,39.718100903990404]]]}},{"type":"Feature","id":820,"properties":{"name":"dma:","latitude":44.191309,"dma":820,"dma1":"Portland, OR","longitude":-120.4498885},"geometry":{"type":"MultiPolygon","coordinates":[[[[-123.7274389189919,46.288970259925996],[-123.7274389189919,46.385856424342435],[-121.52566163816381,46.3883406849685],[-121.52566163816381,46.043028457945795],[-119.86710499879987,46.04054419731973],[-119.86710499879987,45.836834825982606],[-120.00002068766877,45.81199221972197],[-120.00579963066306,45.25800210011002],[-119.75730508190819,45.16856871757176],[-119.79197873987398,44.99467047374738],[-119.6706209369937,44.99467047374738],[-119.65906305100509,43.95873379267927],[-118.81533737383738,43.96121805330533],[-118.81533737383738,44.04816717521753],[-118.22588518841884,44.04071439333934],[-118.19699047344734,41.99616789808981],[-119.35855801530153,41.99368363746375],[-119.36433695829582,42.74889886778678],[-119.94223125772577,42.746414607160716],[-119.89599971377137,43.6978864269427],[-120.26007312241224,43.6978864269427],[-120.26007312241224,43.784835548854886],[-120.37565198229822,43.784835548854886],[-120.38143092529252,43.871784670767084],[-120.74550433393338,43.871784670767084],[-120.74550433393338,43.95873379267927],[-120.98821993969396,43.96121805330533],[-120.98821993969396,44.13263203650365],[-121.10379879957995,44.13760055775578],[-121.10957774257426,44.39099514161417],[-121.84350350285028,44.39347940224023],[-121.79727195889589,44.25932932843285],[-122.38094520132013,44.2096441159116],[-122.86637641284128,44.2891404559456],[-122.90682901380137,44.199707073407346],[-123.16688144854486,44.199707073407346],[-123.25934453645364,44.5549563429343],[-123.07441836063606,44.649358246724674],[-123.14954461956195,44.72140180488049],[-123.60030217311731,44.72140180488049],[-123.594523230123,44.43322757225723],[-123.7216599759976,44.43322757225723],[-123.7158810330033,44.36118401410141],[-123.8141230639064,44.34379418971898],[-123.77367046294628,44.284171934693475],[-124.11462809960996,44.27671915281529],[-124.08573338463846,44.41583774787479],[-124.01060712571257,44.41583774787479],[-124.07995444164416,44.423290529752975],[-124.08573338463846,44.495334087908795],[-124.06839655565557,44.61209433733374],[-124.00482818271827,44.61954711921193],[-124.06839655565557,44.61706285858587],[-124.07417549864986,44.798413884288436],[-123.92970192379238,45.17105297819782],[-124.01060712571257,45.33998270077008],[-123.92970192379238,45.404573477047705],[-123.97593346774677,45.48655407770778],[-123.94703875277527,45.56605041774178],[-123.93548086678668,45.50145964146415],[-123.86613355085508,45.50145964146415],[-123.89502826582658,45.561081896489654],[-123.95859663876388,45.5710189389939],[-123.90080720882088,45.69523197029703],[-123.94125980978097,45.66045232153216],[-123.98171241074107,45.762307007200725],[-123.99327029672966,45.94614229352936],[-123.92970192379238,46.047996979197926],[-124.02216501170116,46.229348004900494],[-123.81990200690069,46.14985166486649],[-123.86613355085508,46.189599834883495],[-123.50206014221422,46.234316526152625],[-123.39803916831683,46.14985166486649],[-123.38070233933394,46.15233592549255],[-123.47316542724272,46.26661191429143],[-123.7274389189919,46.288970259925996]],[[-123.6580916030603,46.172210010501054],[-123.6291968880888,46.18214705300531],[-123.66964948904891,46.177178531753185],[-123.6638705460546,46.172210010501054],[-123.6580916030603,46.172210010501054]]],[[[-117.74623291989198,45.861677432243226],[-117.78668552085207,45.690263449044906],[-117.72889609090909,45.51388094459446],[-117.47462259915991,45.1660844569457],[-117.26658065136513,45.1660844569457],[-117.26658065136513,45.081619595659575],[-116.78114943984399,45.07913533503351],[-116.85627569876988,44.880394484948496],[-117.06431764656466,44.72637032613262],[-117.22612805040504,44.48291278477848],[-117.22034910741074,44.30156175907591],[-117.48618048514851,44.30156175907591],[-117.48618048514851,44.38851088098811],[-117.5902014590459,44.44564887538755],[-117.97161169666967,44.443164614761486],[-118.19121153045305,44.256845067806786],[-118.49749550915091,44.254360807180724],[-118.30679039033903,44.58973599169917],[-118.52061128112811,44.706496241124114],[-118.28367461836183,44.751212932393244],[-118.31834827632763,44.83567779367937],[-118.22588518841884,44.865488921192124],[-118.22588518841884,44.93753247934794],[-118.52061128112811,44.99715473437344],[-118.54950599609961,45.195895584458455],[-118.65352696999699,45.195895584458455],[-118.6997585139514,45.3449512220222],[-118.42814819321931,45.35488826452646],[-118.40503242124213,45.44183738643865],[-118.11608527152715,45.4716485139514],[-118.11608527152715,45.687779188418844],[-117.97161169666967,45.861677432243226],[-117.74623291989198,45.861677432243226]]]]}},{"type":"Feature","id":500,"properties":{"name":"dma:","latitude":44.366668,"dma":500,"dma1":"Portland-Auburn, ME","longitude":-70.1830055},"geometry":{"type":"MultiPolygon","coordinates":[[[[-70.9772472670267,43.35754272117212],[-70.9599104380438,43.541378007500754],[-71.11016295589559,43.50659835873588],[-71.1274997848785,43.57367339563957],[-71.26041547374737,43.571189135013505],[-71.53202579447944,43.76496146384639],[-71.56669945244525,43.89414301640164],[-71.36443644764476,43.91650136203621],[-71.34709961866187,44.07052552085209],[-71.44534164956495,44.24939228592859],[-71.57825733843384,44.254360807180724],[-71.76318351425142,44.40590070537054],[-71.53780473747375,44.58725173107311],[-71.63026782538253,44.751212932393244],[-71.49735213651365,44.90523709120913],[-71.54358368046805,44.98473343124313],[-71.46267847854784,45.01454455875588],[-71.50313107950795,45.05180846814682],[-71.39911010561056,45.20086410571058],[-71.44534164956495,45.235643754475454],[-71.28353124572456,45.30271879137914],[-71.14483661386139,45.24061227572758],[-71.0119209249925,45.347435482648265],[-70.83855263516352,45.233159493849385],[-70.79810003420343,45.42941608330834],[-70.61895280138015,45.40208921642164],[-70.72297377527752,45.516365205220524],[-70.55538442844284,45.66790510341035],[-70.41668979657965,45.14372611131114],[-70.16241630483049,45.12882054755476],[-70.13352158985899,44.85058335743575],[-70.03527955895589,44.865488921192124],[-69.9312585850585,44.609610076707675],[-69.60763777737773,44.57731468856886],[-69.63075354935494,44.70152771987199],[-69.46894314551454,44.71891754425443],[-69.37070111461145,44.54501930043005],[-69.50939574647464,44.34379418971898],[-69.34758534263426,44.309014540954095],[-69.26668014071407,44.36366827472747],[-69.02974347794779,44.24939228592859],[-69.11064867986798,44.11027369086909],[-69.04130136393638,44.09288386648665],[-69.19155388178817,44.00593474457446],[-69.21466965376538,43.93140692579259],[-69.26090119771976,43.91898562266227],[-69.27823802670267,43.953765271427145],[-69.16265916681668,44.068041260226025],[-69.30135379867987,43.953765271427145],[-69.28979591269126,44.00593474457446],[-69.36492217161717,43.9637023139314],[-69.33602745664567,44.05065143584359],[-69.37648005760576,44.09536812711272],[-69.50361680348036,43.8370050220022],[-69.54406940444045,43.92146988328834],[-69.59607989138914,43.81216241574158],[-69.68854297929792,43.88917449514952],[-69.8387954971497,43.700370687568764],[-69.8676902121212,43.91153284078408],[-69.9370375280528,43.85936336763677],[-69.96015330003,43.7972568519852],[-70.0237216729673,43.73018181508151],[-69.94281647104711,43.86681614951496],[-70.09884793189319,43.841973543254326],[-70.31266882268227,43.658138256925696],[-70.22598467776777,43.65316973567357],[-70.19708996279627,43.56622061376138],[-70.37623719561955,43.516535401240134],[-70.33578459465946,43.44697610371038],[-70.56116337143715,43.315310290529055],[-70.68830011731173,43.06439996729674],[-70.82699474917492,43.1265064829483],[-70.8154368631863,43.23829821112112],[-70.9772472670267,43.35754272117212]]],[[[-68.9430593330333,44.11027369086909],[-68.9199435610561,44.14753760026003],[-68.84481730213021,44.18480150965097],[-68.80436470117012,44.157474642764285],[-68.9430593330333,44.11027369086909]]],[[[-68.821701530153,44.03077735083509],[-68.89682778907891,44.11524221212122],[-68.9083856750675,44.09536812711272],[-68.9141646180618,44.09536812711272],[-68.9026067320732,44.1226949939994],[-68.78702787218722,44.09288386648665],[-68.821701530153,44.03077735083509]]],[[[-68.65411218331833,44.00593474457446],[-68.65411218331833,44.06555699959996],[-68.60210169636963,44.085431084608466],[-68.61365958235822,44.01338752645265],[-68.65411218331833,44.00593474457446]]],[[[-68.83325941614162,44.03326161146115],[-68.83903835913591,44.03574587208721],[-68.83325941614162,44.04071439333934],[-68.82748047314732,44.04071439333934],[-68.83325941614162,44.03326161146115]]],[[[-69.11642762286229,43.99599770207021],[-69.12798550885088,43.99599770207021],[-69.12798550885088,44.00096622332234],[-69.11064867986798,44.00096622332234],[-69.11642762286229,43.99599770207021]]],[[[-69.15110128082807,43.986060659565965],[-69.15110128082807,43.99599770207021],[-69.13954339483948,44.00096622332234],[-69.13376445184518,43.99599770207021],[-69.15110128082807,43.986060659565965]]],[[[-69.31869062766276,43.941343968296835],[-69.30713274167417,43.953765271427145],[-69.30135379867987,43.95128101080108],[-69.29557485568557,43.95624953205321],[-69.31869062766276,43.941343968296835]]],[[[-68.9026067320732,43.84942632513252],[-68.9026067320732,43.86930041014102],[-68.8910488460846,43.87675319201921],[-68.8852699030903,43.856879107010705],[-68.9026067320732,43.84942632513252]]],[[[-69.55562729042904,43.83203650075008],[-69.56718517641764,43.84942632513252],[-69.54984834743473,43.86681614951496],[-69.54406940444045,43.85936336763677],[-69.55562729042904,43.83203650075008]]],[[[-69.67698509330933,43.856879107010705],[-69.68276403630364,43.85936336763677],[-69.68276403630364,43.86681614951496],[-69.67698509330933,43.86184762826283],[-69.67698509330933,43.856879107010705]]],[[[-69.94859541404139,43.76744572447245],[-69.94281647104711,43.83203650075008],[-69.8908059840984,43.856879107010705],[-69.8908059840984,43.782351288228824],[-69.91392175607561,43.8370050220022],[-69.94859541404139,43.76744572447245]]],[[[-69.70587980828083,43.8370050220022],[-69.71165875127512,43.84942632513252],[-69.70010086528653,43.85191058575858],[-69.70587980828083,43.841973543254326],[-69.70587980828083,43.8370050220022]]],[[[-69.65964826432642,43.78731980948095],[-69.68276403630364,43.82209945824583],[-69.68854297929792,43.82209945824583],[-69.66542720732073,43.85191058575858],[-69.65964826432642,43.78731980948095]]],[[[-69.56718517641764,43.82458371887189],[-69.56718517641764,43.83203650075008],[-69.56140623342334,43.829552240124016],[-69.56718517641764,43.82458371887189]]],[[[-70.0121637869787,43.81216241574158],[-70.0121637869787,43.82209945824583],[-69.9948269579958,43.82458371887189],[-70.00638484398439,43.814646676367644],[-70.0121637869787,43.81216241574158]]],[[[-69.88502704110411,43.80719389448946],[-69.88502704110411,43.81961519761977],[-69.87924809810981,43.82209945824583],[-69.87924809810981,43.814646676367644],[-69.88502704110411,43.80719389448946]]],[[[-69.68276403630364,43.80967815511552],[-69.68854297929792,43.817130936993706],[-69.68276403630364,43.817130936993706],[-69.68276403630364,43.80967815511552]]],[[[-69.63075354935494,43.80222537323733],[-69.63653249234923,43.80967815511552],[-69.63075354935494,43.814646676367644],[-69.62497460636064,43.80719389448946],[-69.63075354935494,43.80222537323733]]],[[[-70.07573215991599,43.7972568519852],[-70.06417427392739,43.80470963386339],[-70.06417427392739,43.799741112611265],[-70.07573215991599,43.7972568519852]]],[[[-70.00638484398439,43.7177605119512],[-69.97171118601861,43.77489850635064],[-69.94859541404139,43.79477259135914],[-69.9948269579958,43.72272903320332],[-70.00638484398439,43.7177605119512]]],[[[-69.91392175607561,43.77489850635064],[-69.9197006990699,43.782351288228824],[-69.91392175607561,43.78980407010701],[-69.9081428130813,43.77986702760276],[-69.91392175607561,43.77489850635064]]],[[[-70.15085841884189,43.74508737883789],[-70.14507947584758,43.772414245724576],[-70.12196370387039,43.772414245724576],[-70.13352158985899,43.769929985098514],[-70.15085841884189,43.74508737883789]]],[[[-69.32446957065707,43.75502442134214],[-69.31869062766276,43.772414245724576],[-69.30135379867987,43.769929985098514],[-69.31291168466846,43.757508681968204],[-69.32446957065707,43.75502442134214]]],[[[-70.13352158985899,43.75254016071608],[-70.12774264686468,43.76247720322033],[-70.11618476087608,43.76496146384639],[-70.12196370387039,43.759992942594266],[-70.13352158985899,43.75254016071608]]],[[[-70.12774264686468,43.70782346944695],[-70.12774264686468,43.74508737883789],[-70.09884793189319,43.759992942594266],[-70.10462687488749,43.725213293829384],[-70.12774264686468,43.70782346944695]]],[[[-70.11618476087608,43.68298086318632],[-70.11040581788178,43.69540216631664],[-70.09306898889889,43.71030773007301],[-70.09306898889889,43.69291790569058],[-70.11618476087608,43.68298086318632]]],[[[-70.16819524782478,43.67552808130814],[-70.16819524782478,43.69291790569058],[-70.13352158985899,43.702854948194826],[-70.15085841884189,43.68298086318632],[-70.16819524782478,43.67552808130814]]],[[[-70.23754256375636,43.685465123812385],[-70.23176362076208,43.69291790569058],[-70.22598467776777,43.690433645064516],[-70.22598467776777,43.68794938443845],[-70.23754256375636,43.685465123812385]]],[[[-70.20286890579058,43.67304382068207],[-70.19708996279627,43.68794938443845],[-70.19131101980199,43.68794938443845],[-70.19708996279627,43.67304382068207],[-70.20286890579058,43.67304382068207]]],[[[-70.19131101980199,43.65068547504751],[-70.19708996279627,43.66310677817782],[-70.18553207680768,43.67304382068207],[-70.17397419081908,43.66310677817782],[-70.19131101980199,43.65068547504751]]],[[[-70.20864784878488,43.66310677817782],[-70.21442679177918,43.66559103880388],[-70.20864784878488,43.670559560056006],[-70.20286890579058,43.66559103880388],[-70.20864784878488,43.66310677817782]]],[[[-70.20864784878488,43.633295650665076],[-70.20864784878488,43.64074843254326],[-70.20286890579058,43.64820121442145],[-70.19131101980199,43.645716953795386],[-70.20864784878488,43.633295650665076]]],[[[-70.74031060426043,43.074337009800985],[-70.74608954725473,43.08178979167917],[-70.72297377527752,43.07930553105311],[-70.72875271827183,43.07682127042705],[-70.74031060426043,43.074337009800985]]]]}},{"type":"Feature","id":552,"properties":{"name":"dma:","latitude":46.519615,"dma":552,"dma1":"Presque Isle, ME","longitude":-68.9025615},"geometry":{"type":"Polygon","coordinates":[[[-70.0237216729673,46.5746602319232],[-69.9948269579958,46.69638900260027],[-69.22622753975398,47.45905701480149],[-69.04130136393638,47.42676162666267],[-69.05285924992499,47.257831904090416],[-68.9026067320732,47.17833556405641],[-68.23224934473447,47.354718068506855],[-67.78727073417342,47.06654383588359],[-67.78149179117912,45.73001161906191],[-68.43451234953496,45.57847172087209],[-68.43451234953496,46.38088790309031],[-68.821701530153,46.39579346684669],[-68.821701530153,46.572175971297135],[-70.0237216729673,46.5746602319232]]]}},{"type":"Feature","id":521,"properties":{"name":"dma:","latitude":41.620932,"dma":521,"dma1":"Providence, RI-New Bedford, MA","longitude":-71.351281},"geometry":{"type":"MultiPolygon","coordinates":[[[[-70.8443315781578,41.62849732543255],[-70.85588946414641,41.581296373537356],[-70.91945783708371,41.680666798579864],[-70.9541314950495,41.51422133663367],[-71.0350366969697,41.481925948494855],[-71.0697103549355,41.57135933103311],[-71.19684710081009,41.454599081608166],[-71.19684710081009,41.67569827732774],[-71.26619441674167,41.73035201110112],[-71.23729970177018,41.668245495449554],[-71.30086807470747,41.650855671067106],[-71.28353124572456,41.7576788779878],[-71.32398384668467,41.7775529629963],[-71.30086807470747,41.705509404840484],[-71.35865750465047,41.74525757485749],[-71.36443644764476,41.77258444174418],[-71.39333116261626,41.809848351135116],[-71.38755221962197,41.8173011330133],[-71.37021539063906,41.837175218021805],[-71.37021539063906,41.852080781778184],[-71.38177327662765,41.87195486678668],[-71.40488904860486,41.82475391489149],[-71.39333116261626,41.73283627172718],[-71.35287856165615,41.7179307079708],[-71.37599433363337,41.665761234823485],[-71.45112059255925,41.695572362336236],[-71.40488904860486,41.61607602230224],[-71.48001530753075,41.36019717781778],[-71.52624685148515,41.37758700220022],[-71.71695197029703,41.33038605030504],[-71.8614255451545,41.30305918341834],[-71.88454131713172,41.30802770467047],[-71.79785717221722,41.41733517221722],[-71.79785717221722,42.008589201220126],[-71.36443644764476,41.98623085558556],[-71.08126824092409,42.09553832313232],[-70.9714683240324,41.86201782428243],[-71.0292577539754,41.780037223622365],[-70.91945783708371,41.78997426612662],[-70.8443315781578,41.62849732543255]]],[[[-71.32398384668467,41.578812112911294],[-71.35287856165615,41.64091862856286],[-71.34132067566756,41.665761234823485],[-71.30664701770178,41.6185602829283],[-71.32398384668467,41.578812112911294]]],[[[-71.35865750465047,41.650855671067106],[-71.36443644764476,41.650855671067106],[-71.36443644764476,41.66079271357136],[-71.35287856165615,41.6583084529453],[-71.35865750465047,41.650855671067106]]],[[[-71.33554173267326,41.44963056035604],[-71.36443644764476,41.46205186348635],[-71.27775230273028,41.6185602829283],[-71.21996287278728,41.65582419231924],[-71.23729970177018,41.47695742724272],[-71.33554173267326,41.44963056035604]],[[-71.32398384668467,41.50428429412942],[-71.32398384668467,41.51422133663367],[-71.32976278967897,41.51422133663367],[-71.32976278967897,41.509252815381544],[-71.32398384668467,41.50428429412942]],[[-71.32976278967897,41.481925948494855],[-71.32398384668467,41.48689446974698],[-71.32976278967897,41.49434725162517],[-71.32976278967897,41.48937873037304],[-71.32976278967897,41.481925948494855]]],[[[-71.27197335973597,41.635950107310734],[-71.28353124572456,41.638434367936796],[-71.28931018871887,41.64340288918892],[-71.27775230273028,41.648371410441044],[-71.27197335973597,41.635950107310734]]],[[[-70.9136788940894,41.638434367936796],[-70.91945783708371,41.64340288918892],[-70.90789995109512,41.64091862856286],[-70.9136788940894,41.638434367936796]]],[[[-70.82121580618062,41.581296373537356],[-70.8443315781578,41.596201937293735],[-70.83855263516352,41.60613897979798],[-70.8154368631863,41.591233416041604],[-70.82121580618062,41.581296373537356]]],[[[-71.39911010561056,41.44963056035604],[-71.38755221962197,41.556453767276736],[-71.36443644764476,41.57384359165917],[-71.35287856165615,41.47944168786879],[-71.39911010561056,41.44963056035604]]],[[[-71.59559416741675,41.1465507639764],[-71.61293099639964,41.16145632773278],[-71.57825733843384,41.23349988588859],[-71.54358368046805,41.16145632773278],[-71.59559416741675,41.1465507639764]]]]}},{"type":"Feature","id":717,"properties":{"name":"dma:","latitude":40.066065,"dma":717,"dma1":"Quincy, IL-Hannibal, MO-Keokuk, IA","longitude":-91.1726125},"geometry":{"type":"Polygon","coordinates":[[[-90.57942190369036,39.52184431453146],[-90.61409556165617,39.39514702260226],[-90.93771636933693,39.40011554385439],[-91.20354774707471,39.5988563939394],[-91.45782123882388,39.44980075637564],[-91.44048440984099,39.31813494319432],[-92.31310480198019,39.347946070707074],[-92.35355740294028,40.597529165616564],[-91.71787367356735,40.597529165616564],[-91.71787367356735,40.813659840084014],[-91.39425286588659,40.80869131883189],[-91.11108465916591,40.69689959065907],[-91.1862109180918,40.63727733563357],[-90.44650621482148,40.62734029312932],[-90.45228515781578,40.1901104229423],[-90.1980116660666,40.18514190169017],[-90.35404312691269,40.12303538603861],[-90.2846958109811,40.05596034913492],[-89.99574866126613,40.10812982228223],[-89.99574866126613,39.87212506280628],[-90.58520084668467,39.874609323432345],[-90.59675873267327,39.790144462146216],[-90.37137995589558,39.75288055275528],[-90.302032639964,39.519360053905395],[-90.57942190369036,39.52184431453146]]]}},{"type":"Feature","id":560,"properties":{"name":"dma:","latitude":35.72255,"dma":560,"dma1":"Raleigh-Durham (Fayetteville), NC","longitude":-78.4212995},"geometry":{"type":"MultiPolygon","coordinates":[[[[-79.35093566576657,34.83901303440344],[-79.36249355175516,34.95825754445445],[-79.57053549954995,35.06508075137514],[-79.70345118841884,35.253884558955896],[-79.77279850435043,35.51224766406641],[-79.55319867056706,35.51473192469247],[-79.54164078457845,35.84265432733274],[-79.23535680588058,35.8451385879588],[-79.25847257785779,36.24262028812882],[-79.1544516039604,36.24262028812882],[-79.1371147749775,36.54073156325633],[-78.73258876537653,36.54073156325633],[-78.66902039243925,36.689787200820085],[-78.54766258955895,36.62519642454246],[-78.64590462046205,36.69723998269827],[-78.49565210261025,36.891012311531156],[-78.027557720072,36.776736322732276],[-78.0448945490549,36.54321582388239],[-77.0682531830183,36.49849913261326],[-77.23006358685868,36.21529342124212],[-77.29941090279027,36.20784063936394],[-77.23006358685868,36.10350169306931],[-77.40921081968196,35.99916274677468],[-77.35142138973897,35.82029598169817],[-77.82529471527153,35.57186991909191],[-77.83107365826582,35.17687247954795],[-78.16625235193519,35.18929378267827],[-78.200926009901,34.73715834873487],[-78.1142418649865,34.71480000310031],[-78.25293649684968,34.55332306240624],[-78.49565210261025,34.856402858785884],[-78.90595705520552,34.83404451315132],[-79.0330938010801,34.95328902320232],[-79.1891252619262,34.83404451315132],[-79.35093566576657,34.83901303440344]]]]}},{"type":"Feature","id":764,"properties":{"name":"dma:","latitude":43.7649485,"dma":764,"dma1":"Rapid City, SD","longitude":-104.4792695},"geometry":{"type":"MultiPolygon","coordinates":[[[[-104.05013802340234,42.00113641934194],[-104.05591696639664,43.50411409810982],[-105.07878987638763,43.499145576857686],[-105.09034776237624,44.9996389949995],[-105.03833727542754,44.9996389949995],[-105.03833727542754,45.352404003900396],[-104.98632678847885,45.352404003900396],[-104.94009524452446,46.13743036173618],[-104.5182324059406,46.13743036173618],[-104.5182324059406,46.05544976107611],[-104.391095660066,46.05544976107611],[-104.391095660066,45.97098489978998],[-104.13682216831683,45.96850063916392],[-104.13682216831683,45.88155151725173],[-104.04435908040804,45.88155151725173],[-104.04435908040804,45.94614229352936],[-102.94058096849685,45.94614229352936],[-102.95791779747975,45.03938716501651],[-101.99861326042604,45.03938716501651],[-101.99861326042604,45.4716485139514],[-101.47272944794479,45.4716485139514],[-101.50162416291629,44.99467047374738],[-101.13755075427542,44.99467047374738],[-101.16644546924692,44.16741168526853],[-101.04508766636664,44.16741168526853],[-101.04508766636664,43.99599770207021],[-101.06242449534953,43.841973543254326],[-101.23001384218422,43.79477259135914],[-101.23001384218422,42.99732493039305],[-102.08529740534053,42.99980919101911],[-102.03906586138613,42.09553832313232],[-101.4264979039904,42.093054062506255],[-101.4264979039904,41.74277331423143],[-102.06796057635763,41.74277331423143],[-102.06796057635763,42.008589201220126],[-102.67474959075908,42.006104940594064],[-102.63429698979897,41.439693517851794],[-104.05013802340234,41.3924925659566],[-104.05013802340234,41.6980566229623],[-103.368222750075,41.6980566229623],[-103.36244380708071,42.003620679968],[-102.69786536273627,42.003620679968],[-102.79032845064506,42.99980919101911],[-103.5069173819382,42.99980919101911],[-103.4028964080408,42.003620679968],[-104.05013802340234,42.00113641934194]]],[[[-107.74288259675967,44.71643328362837],[-107.91047194359436,45.00212325562556],[-106.02653652745275,44.99467047374738],[-106.00919969846984,44.56489338543855],[-107.36725130213021,44.55992486418643],[-107.74288259675967,44.71643328362837]]]]}},{"type":"Feature","id":811,"properties":{"name":"dma:","latitude":39.4852355,"dma":811,"dma1":"Reno, NV","longitude":-118.959289},"geometry":{"type":"Polygon","coordinates":[[[-119.26609492739274,37.7381451850185],[-119.20252655445545,37.88720082258226],[-119.31232647134713,37.95179159885989],[-119.34700012931293,38.083457412041206],[-119.6301683360336,38.197733400840086],[-119.69951565196519,38.413864075307536],[-119.88444182778278,38.356726080908096],[-120.07514694659466,38.44615946344635],[-120.06358906060606,38.766629084208425],[-120.20806263546355,39.01753940744075],[-120.00002068766877,39.067224619962],[-120.00002068766877,39.72306942524253],[-120.14449426252625,39.708163861486156],[-120.10982060456045,39.93920009970998],[-120.20806263546355,40.085771476647665],[-120.57791498709871,40.28451232673268],[-120.76284116291629,40.31680771487149],[-120.93043050975098,40.19259468356836],[-121.06334619861985,40.257185459845985],[-121.06334619861985,40.44598926742675],[-121.32917757635764,40.44598926742675],[-121.32917757635764,41.18381467336734],[-120.00002068766877,41.18381467336734],[-120.00002068766877,41.99368363746375],[-117.01808610261025,41.99865215871587],[-117.01808610261025,40.99997938703871],[-116.5846653780378,40.99997938703871],[-116.6020022070207,39.161626523752375],[-117.33014902430243,39.16411078437844],[-118.19699047344734,39.00014958305831],[-118.19699047344734,38.91816898239824],[-117.16833862046204,38.00147681138114],[-117.16833862046204,36.97050865156516],[-117.83291706480648,37.46487651615162],[-118.85001103180318,37.47481355865587],[-119.11584240954095,37.73069240314032],[-119.26609492739274,37.7381451850185]]]}},{"type":"Feature","id":556,"properties":{"name":"dma:","latitude":37.4686305,"dma":556,"dma1":"Richmond-Petersburg, VA","longitude":-77.5349825},"geometry":{"type":"Polygon","coordinates":[[[-77.1549373279328,37.11211150725073],[-76.96423220912091,37.05497351285129],[-76.95267432313231,36.945666045304534],[-77.50167390759076,36.66991311581158],[-77.29941090279027,36.545700084508454],[-78.0448945490549,36.54321582388239],[-78.027557720072,36.776736322732276],[-78.48987315961597,36.891012311531156],[-78.44364161566156,37.07981611911191],[-78.69213616441644,37.204029150415046],[-78.59389413351334,37.39780147924793],[-78.83083079627963,37.58908954745475],[-78.61123096249625,37.755535009400944],[-78.49565210261025,37.76298779127913],[-78.25293649684968,38.0635833270327],[-78.20670495289528,38.13314262456246],[-78.36851535673567,38.185312097709776],[-78.28761015481548,38.27226121962197],[-78.22404178187819,38.2300287889789],[-77.77328422832284,38.39398999029903],[-77.71549479837984,38.33685199589959],[-77.95243146114612,38.11823706080608],[-77.65770536843684,37.99153976887689],[-77.36875821872187,38.24741861336134],[-77.24740041584158,38.2499028739874],[-77.25317935883588,38.1902806189619],[-77.062474240024,38.16046949144915],[-77.0278005820582,38.0909101939194],[-76.87754806420642,38.125689842684274],[-76.75041131833183,37.99402402950295],[-76.51925359855986,38.026319417641766],[-76.23608539183918,37.88968508320832],[-76.31699059375937,37.83006282818282],[-76.30543270777078,37.73069240314032],[-76.33432742274226,37.745597966896696],[-76.33432742274226,37.76547205190519],[-76.34010636573657,37.76547205190519],[-76.34010636573657,37.72572388188819],[-76.30543270777078,37.688459972497256],[-76.36900108070807,37.688459972497256],[-76.36900108070807,37.63629049934994],[-76.30543270777078,37.641259020602064],[-76.28809587878789,37.631321978097816],[-76.27653799279928,37.613932153715375],[-76.36322213771376,37.60896363246325],[-76.47302205460545,37.66610162686269],[-76.40945368166817,37.73317666376638],[-76.51347465556555,37.745597966896696],[-76.50769571257126,37.641259020602064],[-76.58860091449145,37.77540909440944],[-76.79664286228623,37.926948992599264],[-76.85443229222922,37.93191751385139],[-76.54236937053705,37.61641641434144],[-76.29965376477648,37.556794159315935],[-76.42101156765676,37.51207746804681],[-76.65216928742873,37.60399511121112],[-76.66950611641164,37.45493947364737],[-76.79664286228623,37.526983031803184],[-76.76774814731473,37.43754964926493],[-76.89488489318931,37.43009686738674],[-76.87754806420642,37.26365140544055],[-76.91800066516652,37.2338402779278],[-76.95845326612661,37.24874584168417],[-76.99312692409241,37.30339957545755],[-77.01624269606961,37.313336617961795],[-77.2242846438644,37.32575792109211],[-76.99312692409241,37.29594679357936],[-77.1549373279328,37.11211150725073]]]}},{"type":"Feature","id":573,"properties":{"name":"dma:","latitude":37.6408795,"dma":573,"dma1":"Roanoke-Lynchburg, VA","longitude":-79.9113685},"geometry":{"type":"Polygon","coordinates":[[[-81.37934465676568,36.95311882718272],[-81.22331319591959,37.0475207309731],[-80.91125027422743,37.072363337233725],[-80.85923978727872,37.17918654415442],[-81.0152712481248,37.27607270857086],[-80.84768190129013,37.34811626672668],[-80.85923978727872,37.43009686738674],[-80.77255564236424,37.3729588729873],[-80.29868231683167,37.50710894679468],[-80.32757703180317,37.56424694119412],[-80.2235560579058,37.628837717471754],[-80.29868231683167,37.69094423312332],[-80.25822971587158,37.755535009400944],[-79.95772468016801,38.0635833270327],[-80.21199817191719,38.03625646014602],[-80.36225068976898,38.11326853955396],[-80.35069280378038,38.34430477777778],[-79.86526159225923,38.550498409740975],[-79.77857744734473,38.739302217321736],[-79.62832492949295,38.679679962296234],[-79.65144070147014,38.59273084038404],[-79.47807241164116,38.4560965059506],[-79.31048306480648,38.41137981468147],[-79.53008289858985,38.1704065339534],[-79.43761981068107,38.16295375207521],[-79.48385135463546,38.08594167266727],[-79.1486726609661,37.88968508320832],[-79.0041990861086,37.882232301330134],[-78.83660973927392,38.04867776327633],[-78.64590462046205,37.73317666376638],[-78.83083079627963,37.58908954745475],[-78.59389413351334,37.39780147924793],[-78.69213616441644,37.204029150415046],[-78.44364161566156,37.07981611911191],[-78.49565210261025,36.891012311531156],[-78.64590462046205,36.69723998269827],[-78.55922047554756,36.64258624892489],[-78.54766258955895,36.62519642454246],[-78.67479933543353,36.68730294019402],[-78.73258876537653,36.54073156325633],[-80.05596671107111,36.54321582388239],[-80.0964193120312,36.776736322732276],[-80.04440882508251,36.79909466836684],[-80.23511394389439,36.87113822652265],[-80.46049272067206,36.73947241334134],[-80.48938743564356,36.650039030803086],[-80.59340840954096,36.662460333933396],[-80.61074523852385,36.558121387638764],[-80.83612401530152,36.558121387638764],[-81.0441659630963,36.80654745024503],[-81.26376579687968,36.764315019601966],[-81.37934465676568,36.95311882718272]]]}},{"type":"Feature","id":538,"properties":{"name":"dma:","latitude":42.9137715,"dma":538,"dma1":"Rochester, NY","longitude":-77.387152},"geometry":{"type":"MultiPolygon","coordinates":[[[[-76.90066383618361,42.463208895789585],[-77.14337944194419,42.4955042839284],[-77.14337944194419,42.577484884588465],[-77.65770536843684,42.57996914521453],[-77.72127374137413,42.47066167766777],[-78.06223137803781,42.532768193319335],[-77.9582104041404,42.66691826712672],[-77.90619991719171,43.02465179727973],[-77.95243146114612,43.03955736103611],[-77.90619991719171,43.13395926482649],[-77.99866300510051,43.13395926482649],[-77.99288406210621,43.36499550305031],[-77.55368439453946,43.23581395049506],[-77.1029268409841,43.290467684268435],[-76.92377960816081,43.21345560486049],[-76.9411164371437,43.275562120512056],[-76.72151660336033,43.34263715741575],[-76.71573766036605,43.02465179727973],[-76.96423220912091,43.01223049414942],[-76.90066383618361,42.463208895789585]]],[[[-76.95845326612661,43.27059359925993],[-76.96423220912091,43.27059359925993],[-76.96423220912091,43.273077859885994],[-76.94689538013802,43.273077859885994],[-76.95845326612661,43.27059359925993]]],[[[-76.9411164371437,43.26065655675568],[-76.94689538013802,43.2656250780078],[-76.94689538013802,43.27059359925993],[-76.9411164371437,43.26314081738174],[-76.9411164371437,43.26065655675568]]],[[[-76.94689538013802,43.25320377487749],[-76.95267432313231,43.25568803550355],[-76.95267432313231,43.258172296129615],[-76.94689538013802,43.26065655675568],[-76.94689538013802,43.25320377487749]]]]}},{"type":"Feature","id":611,"properties":{"name":"dma:","latitude":43.552183,"dma":611,"dma1":"Rochester, MN-Mason City, IA-Austin, MN","longitude":-92.850969},"geometry":{"type":"Polygon","coordinates":[[[-93.02391479027902,42.90789154785479],[-93.97166144134414,42.90789154785479],[-93.97166144134414,43.499145576857686],[-93.64804063366336,43.499145576857686],[-93.64804063366336,43.84694206450645],[-93.04703056225623,43.84942632513252],[-93.04703056225623,44.197222812781284],[-92.39978894689469,44.197222812781284],[-92.3188837449745,44.194738552155215],[-92.3188837449745,44.10778943024303],[-92.08194708220822,44.10778943024303],[-92.08194708220822,43.84694206450645],[-91.72943155955596,43.84694206450645],[-91.72943155955596,43.501629837483755],[-92.08194708220822,43.501629837483755],[-92.08194708220822,43.21345560486049],[-92.55582040774077,43.21345560486049],[-92.55582040774077,42.90789154785479],[-93.02391479027902,42.90789154785479]]]}},{"type":"Feature","id":610,"properties":{"name":"dma:","latitude":42.0453555,"dma":610,"dma1":"Rockford, IL","longitude":-89.316059},"geometry":{"type":"Polygon","coordinates":[[[-89.92640134533454,42.505441326432646],[-88.70704437353734,42.493020023302336],[-88.70704437353734,42.15267631753176],[-88.93820209330933,42.15267631753176],[-88.93820209330933,41.62849732543255],[-89.16935981308131,41.58626489478948],[-89.63167525262526,41.58378063416342],[-89.68946468256826,42.19987726942695],[-89.92062240234023,42.19739300880089],[-89.92640134533454,42.505441326432646]]]}},{"type":"Feature","id":862,"properties":{"name":"dma:","latitude":38.7885185,"dma":862,"dma1":"Sacramento-Stockton-Modesto, CA","longitude":-120.9905465},"geometry":{"type":"MultiPolygon","coordinates":[[[[-122.21335585448544,38.180343576457645],[-122.20757691149115,38.31449365026503],[-122.06310333663366,38.32939921402141],[-122.13822959555955,38.610120664766484],[-122.28848211341133,38.841156902990306],[-122.42139780228023,38.90077915801581],[-122.34049260036004,38.923137503650366],[-122.49074511821182,39.052319056205626],[-122.47340828922891,39.17404782688269],[-122.6814502370237,39.223733039403946],[-122.78547121092109,39.38272571947195],[-122.01109284968497,39.4125368469847],[-121.88973504680467,39.38272571947195],[-121.90707187578758,39.30322937943795],[-121.40430383528353,39.34049328882889],[-121.30606180438043,39.519360053905395],[-121.16158822952295,39.519360053905395],[-121.07490408460846,39.59637213331334],[-121.42741960726072,39.89945192969297],[-121.36963017731773,40.085771476647665],[-121.44475643624362,40.1901104229423],[-121.34073546234623,40.3093549329933],[-121.47365115121512,40.35158736363637],[-121.49676692319231,40.44598926742675],[-121.06334619861985,40.44598926742675],[-121.04023042664267,40.23482711421143],[-120.88997790879088,40.19259468356836],[-120.79751482088209,40.301902151115115],[-120.6530412460246,40.30687067236724],[-120.20806263546355,40.085771476647665],[-120.09826271857186,39.90938897219722],[-120.14449426252625,39.708163861486156],[-120.00002068766877,39.72306942524253],[-120.00002068766877,39.067224619962],[-120.20806263546355,39.02002366806681],[-120.06358906060606,38.766629084208425],[-120.07514694659466,38.44615946344635],[-119.88444182778278,38.356726080908096],[-119.7052945949595,38.4163483359336],[-119.6301683360336,38.197733400840086],[-119.34700012931293,38.083457412041206],[-119.19674761146115,37.8449683919392],[-119.26609492739274,37.7381451850185],[-119.53770524812481,37.9045906469647],[-119.80931556885689,37.755535009400944],[-120.17338897749775,37.800251700670074],[-120.34675726732672,37.72572388188819],[-120.31208360936094,37.653680323732374],[-120.39298881128113,37.683491451245125],[-120.38720986828683,37.63380623872388],[-120.98244099669967,37.40028573987399],[-120.96510416771677,37.345632006100615],[-121.22515660246025,37.13446985288529],[-121.39852489228923,37.14937541664167],[-121.45631432223222,37.25123010231023],[-121.41008277827783,37.38041165486549],[-121.55455635313531,37.541888595559556],[-121.58345106810681,38.09339445454546],[-121.88395610381038,38.04867776327633],[-121.91285081878188,38.083457412041206],[-122.01109284968497,38.08842593329333],[-121.98219813471347,38.11326853955396],[-121.99953496369636,38.140595406440646],[-122.21335585448544,38.180343576457645]]],[[[-122.01109284968497,38.066067587658765],[-122.03998756465646,38.080973151415144],[-122.03998756465646,38.0909101939194],[-121.99953496369636,38.07848889078908],[-122.01109284968497,38.066067587658765]]],[[[-121.98219813471347,38.07600463016302],[-121.98797707770777,38.07848889078908],[-121.99375602070207,38.080973151415144],[-121.98797707770777,38.083457412041206],[-121.98219813471347,38.07600463016302]]],[[[-121.97641919171917,38.071036108910896],[-121.97641919171917,38.07352036953696],[-121.97641919171917,38.07600463016302],[-121.97064024872486,38.071036108910896],[-121.97641919171917,38.071036108910896]]],[[[-121.91285081878188,38.05116202390239],[-121.91285081878188,38.071036108910896],[-121.89551398979897,38.053646284528455],[-121.89551398979897,38.05116202390239],[-121.91285081878188,38.05116202390239]]]]}},{"type":"Feature","id":576,"properties":{"name":"dma:","latitude":38.4437985,"dma":576,"dma1":"Salisbury, MD","longitude":-75.548586},"geometry":{"type":"MultiPolygon","coordinates":[[[[-75.37502288568857,38.01638237513752],[-75.75065418031804,37.99153976887689],[-75.84889621122112,37.9244647319732],[-75.84889621122112,38.0039610720072],[-75.90090669816982,37.97414994449446],[-75.74487523732373,38.08842593329333],[-75.87201198319832,38.06109906640664],[-75.83733832523252,38.125689842684274],[-75.76799100930093,38.13314262456246],[-75.73909629432943,38.167922273327335],[-75.95291718511851,38.17537505520552],[-75.82578043924391,38.21512322522253],[-75.76221206630663,38.28716678337834],[-75.91824352715271,38.26480843774378],[-75.82000149624963,38.48342337283729],[-75.70442263636363,38.56043545224523],[-75.72175946534654,38.83121986048605],[-75.55417011851185,38.836188381738175],[-75.36924394269427,38.96288567366737],[-75.19009670987099,38.806377254225424],[-75.0918546789679,38.80389299359936],[-75.0629599639964,38.65980587728773],[-75.0629599639964,38.610120664766484],[-75.0802967929793,38.694585526052606],[-75.16120199489949,38.70452256855686],[-75.12652833693369,38.64490031353136],[-75.18431776687669,38.667258659165924],[-75.19009670987099,38.65980587728773],[-75.16698093789378,38.634963271027104],[-75.1034125649565,38.634963271027104],[-75.09763362196219,38.62005770727073],[-75.28833874077407,38.595215101010105],[-75.1034125649565,38.550498409740975],[-75.0629599639964,38.610120664766484],[-75.0456231350135,38.4560965059506],[-75.0571810210021,38.41137981468147],[-75.0860757359736,38.32443069276928],[-75.0571810210021,38.42876963906391],[-75.06873890699069,38.43870668156816],[-75.0514020780078,38.46106502720272],[-75.0571810210021,38.50329745784579],[-75.0629599639964,38.510750239723976],[-75.10919150795078,38.38902146904691],[-75.19009670987099,38.43125389968997],[-75.0918546789679,38.32939921402141],[-75.10919150795078,38.326914953395345],[-75.1438651659166,38.28468252275228],[-75.14964410891089,38.24741861336134],[-75.19009670987099,38.2300287889789],[-75.19009670987099,38.20767044334434],[-75.19009670987099,38.25983991649165],[-75.24788613981397,38.2300287889789],[-75.37502288568857,38.01638237513752]]],[[[-75.0860757359736,38.610120664766484],[-75.0918546789679,38.61508918601861],[-75.06873890699069,38.622541967896794],[-75.074517849985,38.610120664766484],[-75.0860757359736,38.610120664766484]]],[[[-75.24788613981397,38.026319417641766],[-75.1727598808881,38.2101547039704],[-75.1034125649565,38.31946217151715],[-75.09763362196219,38.32443069276928],[-75.0918546789679,38.32443069276928],[-75.24788613981397,38.026319417641766]]],[[[-75.9355803561356,38.125689842684274],[-75.95869612811282,38.138111145814584],[-75.94713824212421,38.167922273327335],[-75.92402247014701,38.13562688518852],[-75.9355803561356,38.125689842684274]]],[[[-76.0280434440444,37.969181423242325],[-76.04538027302729,37.97911846574658],[-76.0511592160216,37.996508290129015],[-76.0280434440444,37.99153976887689],[-76.0280434440444,37.969181423242325]]],[[[-76.0222645010501,37.9642129019902],[-76.0222645010501,37.96669716261626],[-76.0222645010501,37.97166568386839],[-76.0164855580558,37.9642129019902],[-76.0222645010501,37.9642129019902]]]]}},{"type":"Feature","id":770,"properties":{"name":"dma:","latitude":40.23193,"dma":770,"dma1":"Salt Lake City, UT","longitude":-112.26407},"geometry":{"type":"Polygon","coordinates":[[[-109.04314477047704,37.00031977907791],[-114.05348834653465,37.00031977907791],[-114.04770940354035,38.67719570167017],[-115.00123499759975,38.67719570167017],[-115.90852904770477,39.161626523752375],[-115.90852904770477,39.46470632013202],[-115.81606595979598,39.593887872687276],[-115.82184490279028,40.12055112541255],[-116.00099213561356,40.12800390729073],[-116.15702359645964,40.667088463146314],[-116.15702359645964,40.99997938703871],[-117.01808610261025,40.99997938703871],[-117.01808610261025,41.99865215871587],[-113.00172072157216,41.99865215871587],[-113.00172072157216,42.32657456135614],[-112.65498414191418,42.3290588219822],[-112.65498414191418,42.41600794389439],[-112.4989526810681,42.41600794389439],[-112.4989526810681,42.502957065806584],[-112.29668967626762,42.45327185328533],[-112.32558439123912,42.32409030073008],[-112.19266870237024,42.351417167616766],[-111.89794260966096,42.25701526382639],[-111.89794260966096,42.41600794389439],[-111.58010074497449,42.42842924702471],[-111.60321651695169,42.589906187718775],[-111.27959570927092,42.55264227832784],[-111.24492205130512,42.60232749084909],[-111.23336416531653,42.478114459545964],[-111.04843798949895,42.51289410831083],[-111.04843798949895,41.578812112911294],[-110.04868085148514,41.57632785228523],[-110.05445979447944,42.27192082758276],[-110.5398910060006,42.276889348834885],[-110.62079620792079,42.709150697769786],[-110.5803436069607,43.290467684268435],[-110.34340694419441,43.290467684268435],[-110.34340694419441,43.37741680618062],[-110.05445979447944,43.37741680618062],[-110.06023873747374,43.46436592809282],[-109.75395475877588,43.46436592809282],[-109.55169175397539,43.01223049414942],[-109.37254452115211,42.94515545724573],[-109.23384988928893,42.76877295279529],[-109.07203948544854,42.69424513401341],[-109.04314477047704,42.264468045704575],[-107.5232827629763,42.26198378507851],[-107.5117248769877,41.6583084529453],[-107.92780877257725,41.66079271357136],[-107.91625088658866,41.00246364766477],[-109.04892371347134,40.99997938703871],[-109.04314477047704,37.882232301330134],[-109.04314477047704,37.00031977907791]]]}},{"type":"Feature","id":661,"properties":{"name":"dma:","latitude":31.186904,"dma":661,"dma1":"San Angelo, TX","longitude":-100.740601},"geometry":{"type":"Polygon","coordinates":[[[-101.75589765466546,30.287847567456748],[-101.65765562376237,30.342501301230122],[-101.73856082568257,30.421997641264127],[-101.65187668076807,30.620738491349137],[-101.80790814161416,30.702719092009204],[-101.87725545754574,30.92133402710271],[-102.3915813840384,31.085295228422844],[-101.27624538613861,31.08032670717072],[-101.26468750015002,32.08645226072608],[-100.23603564716471,32.081483739473946],[-100.23603564716471,31.582147353635364],[-99.70437289168916,31.57717883238324],[-99.51366777287728,31.425638934193422],[-99.09180493429344,31.460418582958297],[-99.09180493429344,30.941208112111212],[-99.48477305790578,30.941208112111212],[-99.48477305790578,30.499009720672067],[-99.3056258250825,30.499009720672067],[-99.2998468820882,30.287847567456748],[-101.75589765466546,30.287847567456748]]]}},{"type":"Feature","id":641,"properties":{"name":"dma:","latitude":29.2651455,"dma":641,"dma1":"San Antonio, TX","longitude":-99.1607395},"geometry":{"type":"MultiPolygon","coordinates":[[[[-99.38653102700269,28.029654658365835],[-99.392309969997,28.203552902190218],[-100.21291987518751,28.196100120312032],[-100.79659311761176,29.246942365136512],[-101.06242449534953,29.458104518351835],[-101.25312961416141,29.520211034003403],[-101.25312961416141,29.62454998029803],[-101.30514010111011,29.577349028402843],[-101.4033821320132,29.771121357235725],[-101.76167659765977,29.781058399739976],[-101.75589765466546,30.287847567456748],[-99.2998468820882,30.287847567456748],[-99.3056258250825,30.499009720672067],[-98.58903689378937,30.499009720672067],[-98.58903689378937,30.13879192989299],[-98.4156686039604,29.937566819181917],[-98.3000897440744,30.036937244224422],[-98.02847942334233,29.848133436643664],[-97.99958470837083,29.751247272227225],[-97.86666901950196,29.855586218521854],[-97.61817447074708,29.634487022802283],[-97.3176694350435,29.783542660366038],[-97.14430114521451,29.627034240924093],[-96.86691188148815,29.632002762176217],[-96.56062790279027,29.33637574767477],[-97.3061115490549,28.864366228722872],[-97.16163797419742,28.782385628062805],[-97.16163797419742,28.553833650465045],[-97.3754588649865,28.38738818851885],[-97.44480618091809,28.402293752275227],[-97.69330072967297,28.541412347334735],[-97.77420593159316,28.668109639263925],[-98.00536365136513,28.69046798489849],[-98.09782673927393,28.787354149314933],[-98.33476340204021,28.61345590549055],[-98.33476340204021,28.056981525252525],[-99.38653102700269,28.029654658365835]]]]}},{"type":"Feature","id":825,"properties":{"name":"dma:","latitude":33.0195915,"dma":825,"dma1":"San Diego, CA","longitude":-116.8402815},"geometry":{"type":"Polygon","coordinates":[[[-116.10501310951095,32.61808403470347],[-117.12210707650765,32.53361917341734],[-117.22612805040504,32.69758037473748],[-117.10477024752475,32.6031784709471],[-117.11632813351335,32.67522202910291],[-117.17989650645065,32.72739150225023],[-117.25502276537654,32.69758037473748],[-117.18567544944494,32.7621711510151],[-117.25502276537654,32.75968689038904],[-117.27813853735373,32.821793406040605],[-117.32437008130813,33.11493615991599],[-117.5959804020402,33.38572056815681],[-117.5786435730573,33.45279560506051],[-117.36482268226823,33.504965078207825],[-117.24346487938793,33.432921520052005],[-116.08767628052804,33.42546873817382],[-116.10501310951095,32.61808403470347]],[[-117.21457016441644,32.76713967226723],[-117.20879122142213,32.76962393289329],[-117.21457016441644,32.78949801790179],[-117.23190699339933,32.77210819351935],[-117.21457016441644,32.76713967226723]],[[-117.23768593639363,32.77210819351935],[-117.23190699339933,32.77459245414542],[-117.23190699339933,32.779560975397544],[-117.24346487938793,32.77707671477148],[-117.23768593639363,32.77210819351935]]]}},{"type":"Feature","id":807,"properties":{"name":"dma:","latitude":38.4477155,"dma":807,"dma1":"San Francisco-Oakland-San Jose, CA","longitude":-122.6193155},"geometry":{"type":"MultiPolygon","coordinates":[[[[-122.7392396669667,39.38272571947195],[-122.75657649594959,39.28583955505551],[-122.47340828922891,39.17404782688269],[-122.49074511821182,39.052319056205626],[-122.34049260036004,38.923137503650366],[-122.42139780228023,38.90077915801581],[-122.28848211341133,38.841156902990306],[-122.16712431053105,38.65483735603561],[-122.06310333663366,38.32939921402141],[-122.20757691149115,38.31449365026503],[-122.21335585448544,38.180343576457645],[-122.06310333663366,38.11823706080608],[-122.12667170957096,38.04619350265027],[-122.40406097329732,38.155500970197025],[-122.49074511821182,38.10830001830183],[-122.44451357425743,37.98657124762477],[-122.53119771917191,37.9443388169817],[-122.43873463126312,37.882232301330134],[-122.52541877617762,37.89713786508651],[-122.47340828922891,37.83751561006101],[-122.52541877617762,37.815157264426446],[-122.92416584278428,38.02880367826783],[-122.92994478577857,38.0909101939194],[-122.96461844374437,37.99153976887689],[-123.02240787368737,37.996508290129015],[-122.94728161476148,38.155500970197025],[-122.99351315871587,38.23996583148315],[-122.89527112781278,38.13314262456246],[-122.83748169786978,38.083457412041206],[-122.82592381188118,38.0909101939194],[-123.06286047464747,38.30207234713472],[-123.13220779057906,38.453612245324535],[-123.7274389189919,38.91816898239824],[-123.6927652610261,39.052319056205626],[-123.82568094989499,39.347946070707074],[-123.79100729192919,39.68580551585159],[-124.02216501170116,40.00130661536154],[-122.93572372877287,39.97894826972698],[-122.88371324182418,39.5789823089309],[-122.7334607239724,39.58146656955696],[-122.7392396669667,39.38272571947195]]],[[[-121.21359871647164,36.960571609060906],[-121.49098798019801,36.98292995469547],[-121.57767212511251,36.89349657215722],[-122.14978748154815,37.28600975107511],[-122.15556642454246,37.216450453545356],[-122.31737682838283,37.186639326032605],[-122.28848211341133,37.11459576787679],[-122.33471365736574,37.117080028502855],[-122.51963983318332,37.52449877117712],[-122.50808194719471,37.785346136913695],[-122.39828203030302,37.80770448254826],[-122.40406097329732,37.63629049934994],[-122.24225056945694,37.50710894679468],[-122.21913479747974,37.541888595559556],[-122.09199805160516,37.442518170517054],[-121.94174553375338,37.4524552130213],[-122.10355593759375,37.499656164916495],[-122.16134536753675,37.67603866936694],[-122.25958739843983,37.740629445644565],[-122.20757691149115,37.73069240314032],[-122.21335585448544,37.758019270027006],[-122.34049260036004,37.8052202219222],[-122.31159788538854,37.89216934383438],[-122.42717674527452,37.9642129019902],[-122.25958739843983,38.05861480578058],[-122.14978748154815,38.02135089638964],[-121.86084033183317,38.066067587658765],[-121.77993512991299,38.01886663576358],[-121.58345106810681,38.09587871517152],[-121.55455635313531,37.541888595559556],[-121.41008277827783,37.38041165486549],[-121.45631432223222,37.25123010231023],[-121.39852489228923,37.14937541664167],[-121.28294603240323,37.18415506540654],[-121.22515660246025,37.13198559225923],[-121.21359871647164,36.960571609060906]],[[-122.24802951245124,37.7778933550355],[-122.24802951245124,37.78286187628763],[-122.25380845544554,37.785346136913695],[-122.25380845544554,37.78286187628763],[-122.24802951245124,37.7778933550355]]],[[[-122.42139780228023,37.85242117381738],[-122.43873463126312,37.854905434443445],[-122.44451357425743,37.859873955695576],[-122.42717674527452,37.869810998199824],[-122.42139780228023,37.85242117381738]]],[[[-122.36938731533152,37.80770448254826],[-122.38094520132013,37.827578567556756],[-122.37516625832583,37.83254708880888],[-122.35782942934293,37.815157264426446],[-122.36938731533152,37.80770448254826]]],[[[-122.23069268346835,37.75056648814882],[-122.28270317041704,37.770440573157316],[-122.33471365736574,37.78286187628763],[-122.32893471437143,37.797767440044005],[-122.23069268346835,37.75056648814882]]]]}},{"type":"Feature","id":855,"properties":{"name":"dma:","latitude":34.844663,"dma":855,"dma1":"Santa Barbara-Santa Maria-San Luis Obispo, CA","longitude":-120.4100205},"geometry":{"type":"MultiPolygon","coordinates":[[[[-121.34651440534053,35.795453375437546],[-120.19650474947494,35.78800059355936],[-120.19650474947494,35.61410234973498],[-120.08670483258325,35.61410234973498],[-120.08670483258325,35.52715322782279],[-120.00002068766877,35.440204105910595],[-119.87866288478847,35.440204105910595],[-119.80931556885689,35.26382160146015],[-119.6648419939994,35.26133734083409],[-119.6648419939994,35.17438821892189],[-119.55504207710771,35.17935674017402],[-119.56082102010201,35.08743909700971],[-119.47413687518751,35.07750205450545],[-119.47413687518751,34.374456297329736],[-120.13871531953195,34.47382672237224],[-120.45077824122411,34.441531334233424],[-120.6530412460246,34.57816566866687],[-120.60103075907591,34.70486296059606],[-120.67037807500749,34.90360381068107],[-120.6472623030303,35.14457709140915],[-120.85530425082509,35.20668360706071],[-120.90153579477948,35.25636881958196],[-120.86108319381938,35.368160547754776],[-120.86686213681368,35.311022553355336],[-120.82640953585359,35.338349420242025],[-120.88997790879088,35.43523558465847],[-121.28872497539754,35.66378756225623],[-121.34651440534053,35.795453375437546]]],[[[-119.81509451185119,33.959584772777276],[-119.91911548574858,34.07634502220222],[-119.52036841914192,34.03411259155916],[-119.56082102010201,33.99436442154216],[-119.81509451185119,33.959584772777276]]],[[[-120.35831515331533,34.014238506550655],[-120.41032564026402,34.031628330933096],[-120.45077824122411,34.029144070307034],[-120.36987303930393,34.07634502220222],[-120.30630466636663,34.029144070307034],[-120.35831515331533,34.014238506550655]]],[[[-120.11559954755475,33.89499399649965],[-120.17916792049205,33.9248051240124],[-120.24851523642364,34.001817203420345],[-120.05781011761175,34.03659685218522],[-119.97690491569156,33.9844273790379],[-120.11559954755475,33.89499399649965]]]]}},{"type":"Feature","id":507,"properties":{"name":"dma:","latitude":32.168191,"dma":507,"dma1":"Savannah, GA","longitude":-81.6330685},"geometry":{"type":"MultiPolygon","coordinates":[[[[-82.35598602280228,32.29264589268927],[-82.23462821992199,32.3174884989499],[-82.1479440750075,32.52119787028703],[-81.84166009630962,32.64789516221622],[-81.76653383738373,32.908742527952796],[-81.54115506060606,33.04537686238624],[-81.41979725772578,32.747265587258724],[-81.0846185640564,33.02550277737774],[-80.82456612931293,32.69758037473748],[-80.66853466846685,32.67025350785079],[-80.51250320762077,32.51374508840884],[-80.75521881338133,32.54852473717372],[-80.81300824332433,32.49387100340034],[-80.85346084428443,32.53113491279128],[-80.76099775637564,32.27774032893289],[-80.78411352835283,32.26035050455046],[-80.79567141434143,32.23053937703771],[-80.78989247134713,32.18830694639464],[-80.89391344524452,32.12868469136914],[-80.91702921722171,32.083968000100015],[-80.89969238823882,32.02186148444844],[-80.84190295829583,32.02434574507451],[-80.84768190129013,31.992050356935696],[-81.0268291341134,31.934912362536256],[-80.93436604620462,31.91006975627563],[-80.99215547614762,31.857900283128313],[-81.1424079939994,31.857900283128313],[-81.1770816519652,31.81815211311131],[-81.1828605949595,31.800762288728876],[-81.1597448229823,31.783372464346435],[-81.1770816519652,31.758529858085808],[-81.1597448229823,31.728718730573057],[-81.27532368286828,31.790825246224625],[-81.1308501080108,31.696423342434244],[-81.1308501080108,31.62686404490449],[-81.29266051185118,31.534946401740175],[-81.26376579687968,31.5200408379838],[-81.33311311281128,31.477808407340735],[-81.34467099879987,31.440544497949794],[-81.29266051185118,31.370985200420044],[-81.33889205580559,31.370985200420044],[-81.33889205580559,31.35856389728973],[-81.32733416981698,31.336205551655166],[-81.33311311281128,31.333721291029104],[-81.33889205580559,31.33123703040304],[-81.43713408670867,31.341174072907293],[-81.37356571377137,31.323784248524852],[-81.40823937173718,31.29148886038604],[-81.62206026252625,31.452965801080108],[-81.72608123642364,31.326268509150914],[-82.0323652151215,31.366016679167917],[-82.061259930093,31.46538710421042],[-82.22884927692769,31.52997788048805],[-82.48312276867686,31.418186152315233],[-82.59870162856285,31.470355625462545],[-82.62759634353435,31.671580736173617],[-82.83563829132913,31.671580736173617],[-82.83563829132913,31.815667852485248],[-82.54091219861985,31.96720775067507],[-82.65649105850585,32.30009867456746],[-82.40799650975097,32.354752408340836],[-82.35598602280228,32.29264589268927]]],[[[-80.74366092739274,32.352268147714774],[-80.81300824332433,32.47399691839184],[-80.74943987038704,32.53858769466947],[-80.68587149744974,32.50132378527853],[-80.72054515541554,32.44418579087909],[-80.69165044044405,32.45412283338334],[-80.66853466846685,32.451638572757275],[-80.66275572547255,32.4367330090009],[-80.74366092739274,32.352268147714774]]],[[[-80.63386101050105,32.255381983298335],[-80.65119783948396,32.4367330090009],[-80.69165044044405,32.4764811790179],[-80.67431361146114,32.50380804590459],[-80.45471377767777,32.409406142114214],[-80.63386101050105,32.255381983298335]]],[[[-80.50094532163216,32.45909135463546],[-80.54139792259227,32.46157561526153],[-80.54717686558655,32.49387100340034],[-80.47782954965496,32.4764811790179],[-80.50094532163216,32.45909135463546]]],[[[-80.45471377767777,32.367173711471146],[-80.46049272067206,32.38704779647965],[-80.43159800570056,32.411890402740276],[-80.45471377767777,32.367173711471146]]],[[[-80.57607158055805,32.27277180768077],[-80.47205060666067,32.38456353585359],[-80.46049272067206,32.3572366689669],[-80.43159800570056,32.39201631773177],[-80.45471377767777,32.32245702020202],[-80.57607158055805,32.27277180768077]]],[[[-80.67431361146114,32.29016163206321],[-80.69742938343833,32.30258293519352],[-80.73788198439843,32.352268147714774],[-80.66853466846685,32.352268147714774],[-80.67431361146114,32.29016163206321]]],[[[-80.78989247134713,32.223086595159515],[-80.77833458535854,32.2578662439244],[-80.76677669936993,32.26035050455046],[-80.76099775637564,32.27277180768077],[-80.74366092739274,32.26531902580258],[-80.78989247134713,32.223086595159515]]],[[[-80.81878718631863,32.108810606360635],[-80.73788198439843,32.267803286428645],[-80.67431361146114,32.23550789828983],[-80.72632409840983,32.15849581888189],[-80.81878718631863,32.108810606360635]]],[[[-80.87657661626162,32.081483739473946],[-80.89391344524452,32.126200430743076],[-80.83612401530152,32.14607451575158],[-80.84190295829583,32.11874764886489],[-80.87657661626162,32.081483739473946]]],[[[-81.1597448229823,31.783372464346435],[-81.1770816519652,31.815667852485248],[-81.03838702010201,31.820636373737376],[-81.1366290510051,31.72126594869487],[-81.1713027089709,31.758529858085808],[-81.1597448229823,31.783372464346435]]],[[[-81.269544739874,31.383406503550354],[-81.30999734083409,31.423154673567357],[-81.29266051185118,31.480292667966797],[-81.29266051185118,31.487745449844986],[-81.19441848094809,31.534946401740175],[-81.269544739874,31.383406503550354]]],[[[-81.30421839783978,31.447997279827984],[-81.32733416981698,31.475324146714673],[-81.29266051185118,31.485261189218924],[-81.29266051185118,31.482776928592862],[-81.30421839783978,31.447997279827984]]],[[[-81.31577628382837,31.428123194819484],[-81.33889205580559,31.445513019201922],[-81.32733416981698,31.455450061706173],[-81.32733416981698,31.460418582958297],[-81.31577628382837,31.428123194819484]]],[[[-81.25220791089109,31.316331466646666],[-81.32155522682268,31.33123703040304],[-81.32733416981698,31.34862685478548],[-81.33889205580559,31.361048157915793],[-81.33311311281128,31.363532418541855],[-81.25220791089109,31.316331466646666]]]]}},{"type":"Feature","id":819,"properties":{"name":"dma:","latitude":47.621239,"dma":819,"dma1":"Seattle-Tacoma, WA","longitude":-121.842349},"geometry":{"type":"MultiPolygon","coordinates":[[[[-120.6588201890189,48.72602993409342],[-120.78595693489349,48.62665950905091],[-120.6299254740474,48.49747795649566],[-120.6472623030303,48.39562327082709],[-120.06358906060606,47.96584618251826],[-119.87288394179417,47.96087766126613],[-119.89599971377137,48.050311043804385],[-119.77464191089109,48.10496477757776],[-119.618610450045,47.99565731003101],[-119.50881053315331,48.08012217131714],[-119.34700012931293,48.050311043804385],[-119.13317923852385,48.152165729472955],[-118.95403200570057,48.020499916291634],[-119.21408444044404,47.88883410311031],[-119.31810541434143,47.627986737373746],[-119.53192630513051,47.52861631233124],[-119.53192630513051,47.44166719041905],[-119.87866288478847,47.43669866916692],[-120.00579963066306,47.31993841974198],[-120.00579963066306,47.22056799469948],[-120.5663571011101,47.30751711661166],[-120.90731473777377,47.424277366036605],[-121.11535668556856,47.59817560986099],[-121.23093554545454,47.56588022172218],[-121.46787220822083,47.367139371637165],[-121.34651440534053,47.28267451035104],[-121.30028286138614,47.14852443654366],[-121.41008277827783,47.11871330903091],[-121.37540912031203,47.05412253275328],[-121.52566163816381,46.872771507050714],[-121.35229334833483,46.713778826982704],[-121.45631432223222,46.52000649814982],[-121.39274594929492,46.39082494559457],[-123.7274389189919,46.385856424342435],[-123.7274389189919,46.288970259925996],[-123.87191249384938,46.23928504740475],[-123.99904923972397,46.31381286618662],[-124.07995444164416,46.26661191429143],[-124.06839655565557,46.6342824869487],[-124.01638606870686,46.37095086058606],[-123.95281769576957,46.36349807870788],[-123.92392298079808,46.42312033373338],[-123.93548086678668,46.457899982498255],[-123.88924932283228,46.41318329122913],[-123.86035460786078,46.418151812481256],[-123.84301777887788,46.3883406849685],[-123.83145989288928,46.3883406849685],[-123.83145989288928,46.37840364246425],[-123.82568094989499,46.37095086058606],[-123.81990200690069,46.37591938183819],[-123.82568094989499,46.3883406849685],[-123.84301777887788,46.3883406849685],[-123.85457566486649,46.42312033373338],[-123.94125980978097,46.46535276437645],[-123.88924932283228,46.515037976897695],[-123.95859663876388,46.63676674757477],[-123.94125980978097,46.61689266256626],[-123.91236509480947,46.611924141314134],[-123.91236509480947,46.60447135943595],[-123.90080720882088,46.59701857755776],[-123.89502826582658,46.599502838183824],[-123.92970192379238,46.6740306569657],[-123.84301777887788,46.716263087608766],[-124.09729127062705,46.73613717261726],[-124.13774387158716,46.90506689518952],[-124.02216501170116,46.83550759765977],[-124.04528078367836,46.89512985268527],[-123.98171241074107,46.92245671957196],[-123.87769143684368,46.9398465439544],[-123.80834412091208,46.969657671467154],[-124.12040704260426,47.04170122962297],[-124.10884915661566,46.942330804580465],[-124.17819647254726,46.92742524082409],[-124.20131224452444,47.2056624309431],[-124.31689110441043,47.354718068506855],[-124.42669102130213,47.742262726172626],[-124.675185570057,47.96584618251826],[-124.732975,48.164587032603265],[-124.6578487410741,48.3285482339234],[-124.7271960570057,48.38320196769678],[-123.98749135373536,48.164587032603265],[-123.32291290939094,48.11241755945595],[-123.24778665046504,48.11490182008201],[-123.15532356255625,48.17203981448145],[-123.14376567656765,48.177008335733575],[-123.10331307560756,48.18446111761177],[-123.18421827752775,48.14719720822083],[-123.06863941764176,48.119870341334135],[-123.01084998769876,48.025468437543765],[-123.03974470267026,48.08012217131714],[-122.91260795679568,48.095027735073515],[-122.88949218481848,47.99068878877888],[-122.82592381188118,48.04782678317832],[-122.88371324182418,48.10496477757776],[-122.75079755295529,48.14222868696871],[-122.802808039904,48.08509069256927],[-122.6814502370237,47.97081470377039],[-122.7045660090009,47.91616096999701],[-122.6063239780978,47.88883410311031],[-122.69300812301229,47.868960018101816],[-122.80858698289829,47.682640471147124],[-122.78547121092109,47.80436924182419],[-122.86059746984698,47.82921184808481],[-122.90105007080707,47.64537656175618],[-123.04552364566456,47.54849039733974],[-123.16110250555055,47.354718068506855],[-123.12064990459045,47.327391201620166],[-123.10331307560756,47.35720232913292],[-123.02818681668167,47.34974954725473],[-122.84326064086409,47.4317301479148],[-123.12064990459045,47.38949771727174],[-122.91838689978998,47.62301821612162],[-122.75079755295529,47.667734907390745],[-122.6063239780978,47.85653871497151],[-122.56587137713771,47.821759066206624],[-122.60054503510351,47.94100357625763],[-122.52541877617762,47.911192448744885],[-122.46762934623462,47.757168289929],[-122.56009243414341,47.76958959305931],[-122.58898714911491,47.69009325302531],[-122.6525555220522,47.74723124742475],[-122.6121029210921,47.56588022172218],[-122.687229180018,47.650345083008304],[-122.7103449519952,47.610596912991305],[-122.62366080708071,47.56588022172218],[-122.6987870660066,47.526132051705176],[-122.5485345481548,47.5907228279828],[-122.49652406120612,47.513710748574866],[-122.58898714911491,47.33732824412442],[-122.5485345481548,47.285158770977105],[-122.6987870660066,47.28267451035104],[-122.62366080708071,47.37210789288929],[-122.62943975007501,47.411856062906296],[-122.7334607239724,47.34478102600261],[-122.7681343819382,47.1659142609261],[-122.82592381188118,47.40688754165417],[-122.83748169786978,47.324906940994104],[-122.92416584278428,47.28267451035104],[-122.93572372877287,47.2056624309431],[-122.99929210171017,47.200693909690976],[-123.00507104470447,47.210630952195224],[-123.06286047464747,47.2056624309431],[-123.01662893069306,47.26031616471648],[-123.09753413261326,47.20814669156916],[-122.99351315871587,47.19324112781278],[-122.93572372877287,47.19820964906491],[-122.96461844374437,47.16839852155216],[-123.05130258865886,47.153492957795784],[-123.08597624662465,47.13361887278728],[-123.01662893069306,47.15100869716972],[-123.02240787368737,47.12119756965697],[-123.05130258865886,47.12119756965697],[-123.08019730363036,47.10877626652666],[-123.08597624662465,47.09883922402241],[-123.08597624662465,47.096354963396344],[-123.01084998769876,47.11622904840485],[-122.94150267176717,47.18081982468247],[-123.01662893069306,47.06157531463147],[-122.92416584278428,47.1460401759176],[-122.93572372877287,47.0789651390139],[-122.89527112781278,47.0466697508751],[-122.90682901380137,47.138587394039405],[-122.84326064086409,47.16343000030004],[-122.86059746984698,47.12119756965697],[-122.82014486888689,47.09387070277028],[-122.81436592589259,47.17833556405641],[-122.7334607239724,47.07151235713572],[-122.5832082061206,47.18827260656066],[-122.53119771917191,47.29261155285529],[-122.5485345481548,47.31745415911592],[-122.37516625832583,47.25534764346435],[-122.44451357425743,47.3050328559856],[-122.32315577137713,47.34974954725473],[-122.42139780228023,47.57581726422643],[-122.34049260036004,47.60314413111311],[-122.43873463126312,47.66276638613862],[-122.39828203030302,47.80436924182419],[-122.31159788538854,47.94597209750975],[-122.14978748154815,48.01553139503951],[-122.34627154335433,48.09999625632564],[-122.39250308730873,48.22917780888089],[-122.47918723222323,48.18446111761177],[-122.35782942934293,48.05527956505651],[-122.51386089018902,48.137260165716576],[-122.53119771917191,48.249051893889394],[-122.39828203030302,48.249051893889394],[-122.36360837233723,48.308674148914896],[-122.55431349114912,48.44530848334834],[-122.6525555220522,48.4080445739574],[-122.7045660090009,48.49747795649566],[-122.47340828922891,48.45276126522653],[-122.56009243414341,48.58442707840784],[-122.42717674527452,48.59933264216422],[-122.50808194719471,48.66889193969398],[-122.48496617521752,48.75087254035404],[-122.5832082061206,48.78813644974498],[-122.6756712940294,48.733482715971604],[-122.6467765790579,48.78316792849286],[-122.79702909690968,48.892475396039615],[-122.75079755295529,48.934707826682676],[-122.82592381188118,48.944644869186924],[-122.75657649594959,49.001782863586364],[-120.84952530783077,48.9992986029603],[-120.6588201890189,48.72602993409342]]],[[[-123.08597624662465,48.97197173607361],[-123.09175518961897,49.001782863586364],[-123.02240787368737,48.97694025732574],[-123.06863941764176,48.9794245179518],[-123.08597624662465,48.97197173607361]]],[[[-122.6063239780978,48.64156507280728],[-122.7161238949895,48.71609289158917],[-122.7161238949895,48.748388279727976],[-122.62943975007501,48.678828982198226],[-122.6063239780978,48.64156507280728]]],[[[-123.03974470267026,48.676344721572164],[-123.07441836063606,48.69870306720672],[-123.01084998769876,48.721061412841294],[-123.00507104470447,48.69621880658066],[-123.03974470267026,48.676344721572164]]],[[[-122.6178818640864,48.6937345459546],[-122.62943975007501,48.69621880658066],[-122.6525555220522,48.7136086309631],[-122.62366080708071,48.71857715221523],[-122.6178818640864,48.6937345459546]]],[[[-122.88949218481848,48.58939559965997],[-123.03396575967597,48.62417524842485],[-122.95306055775578,48.7136086309631],[-122.745018609961,48.66143915781579],[-122.83170275487548,48.59933264216422],[-122.90682901380137,48.6937345459546],[-122.88949218481848,48.58939559965997]]],[[[-123.18421827752775,48.65647063656366],[-123.21889193549355,48.6738604609461],[-123.23622876447645,48.688766024702474],[-123.17266039153915,48.68131324282429],[-123.18421827752775,48.65647063656366]]],[[[-123.10909201860186,48.634112290929096],[-123.13798673357336,48.63659655155516],[-123.16110250555055,48.649017854685475],[-123.11487096159615,48.63908081218122],[-123.10909201860186,48.634112290929096]]],[[[-122.6641134080408,48.606785424042414],[-122.6987870660066,48.61672246654666],[-122.6987870660066,48.621690987798786],[-122.6756712940294,48.62914376967697],[-122.6641134080408,48.606785424042414]]],[[[-122.96461844374437,48.45276126522653],[-123.13220779057906,48.49747795649566],[-123.16688144854486,48.606785424042414],[-123.01084998769876,48.55958447214722],[-122.96461844374437,48.45276126522653]]],[[[-123.18421827752775,48.58442707840784],[-123.20155510651065,48.60181690279029],[-123.17843933453345,48.621690987798786],[-123.17266039153915,48.60181690279029],[-123.18421827752775,48.58442707840784]]],[[[-122.72190283798379,48.53971038713872],[-122.7392396669667,48.58442707840784],[-122.7103449519952,48.606785424042414],[-122.6698923510351,48.56703725402541],[-122.72190283798379,48.53971038713872]]],[[[-122.98773421572157,48.5943641209121],[-123.00507104470447,48.5943641209121],[-122.99351315871587,48.60181690279029],[-122.98773421572157,48.5943641209121]]],[[[-122.94728161476148,48.54716316901691],[-122.97617632973297,48.552131690269036],[-123.01662893069306,48.57945855715572],[-122.90105007080707,48.57945855715572],[-122.94728161476148,48.54716316901691]]],[[[-122.6409976360636,48.52480482338234],[-122.6467765790579,48.58939559965997],[-122.57165032013201,48.52977334463447],[-122.59476609210921,48.53722612651266],[-122.6409976360636,48.52480482338234]]],[[[-122.802808039904,48.53225760526053],[-122.82592381188118,48.5546159508951],[-122.81436592589259,48.58691133903391],[-122.7681343819382,48.55710021152116],[-122.802808039904,48.53225760526053]]],[[[-122.87793429882989,48.41798161646165],[-122.94728161476148,48.46518256835684],[-122.88371324182418,48.57200577527753],[-122.85481852685268,48.447792743974404],[-122.802808039904,48.447792743974404],[-122.87793429882989,48.41798161646165]]],[[[-122.82592381188118,48.48257239273928],[-122.81436592589259,48.49747795649566],[-122.83748169786978,48.51486778087809],[-122.79125015391539,48.52480482338234],[-122.82592381188118,48.48257239273928]]],[[[-122.83170275487548,48.48505665336535],[-122.83170275487548,48.494993695869596],[-122.82592381188118,48.49002517461747],[-122.83170275487548,48.48505665336535]]],[[[-122.38094520132013,47.90373966686669],[-122.47918723222323,47.99565731003101],[-122.5485345481548,47.968330443144325],[-122.6121029210921,48.15464999009902],[-122.76235543894389,48.21675650575058],[-122.6641134080408,48.40059179207921],[-122.50230300420041,48.29873710641065],[-122.7334607239724,48.23166206950695],[-122.6063239780978,48.20681946324633],[-122.54275560516051,48.01553139503951],[-122.52541877617762,48.09751199569958],[-122.37516625832583,48.03540548004801],[-122.38094520132013,47.90373966686669]]],[[[-122.5774292631263,48.39562327082709],[-122.5774292631263,48.39810753145315],[-122.56009243414341,48.40307605270527],[-122.56009243414341,48.39810753145315],[-122.5774292631263,48.39562327082709]]],[[[-122.94728161476148,48.119870341334135],[-122.92994478577857,48.13229164446445],[-122.91260795679568,48.12732312321233],[-122.94150267176717,48.119870341334135],[-122.94728161476148,48.119870341334135]]],[[[-122.69300812301229,48.008078613161324],[-122.72190283798379,48.025468437543765],[-122.75079755295529,48.07266938943895],[-122.6987870660066,48.01801565566557],[-122.69300812301229,48.10496477757776],[-122.69300812301229,48.008078613161324]]],[[[-122.30003999939994,48.005594352535255],[-122.32315577137713,48.008078613161324],[-122.33471365736574,48.020499916291634],[-122.32893471437143,48.0229841769177],[-122.30003999939994,48.005594352535255]]],[[[-122.51386089018902,47.57333300360037],[-122.59476609210921,47.66276638613862],[-122.5485345481548,47.72238864116412],[-122.50230300420041,47.695061774277434],[-122.51386089018902,47.57333300360037]]],[[[-122.48496617521752,47.5311005729573],[-122.49652406120612,47.5311005729573],[-122.50808194719471,47.54352187608761],[-122.48496617521752,47.54352187608761],[-122.48496617521752,47.5311005729573]]],[[[-122.49074511821182,47.329875462246235],[-122.52541877617762,47.39695049914992],[-122.47340828922891,47.511226487948804],[-122.37516625832583,47.387013456645676],[-122.45607146024602,47.342296765376545],[-122.43295568826882,47.387013456645676],[-122.46185040324032,47.40191902040205],[-122.49074511821182,47.329875462246235]]],[[[-122.82592381188118,47.33484398349836],[-122.82014486888689,47.34726528662867],[-122.82014486888689,47.34478102600261],[-122.82592381188118,47.33484398349836]]],[[[-122.6641134080408,47.324906940994104],[-122.6756712940294,47.327391201620166],[-122.6583344650465,47.329875462246235],[-122.6641134080408,47.324906940994104]]],[[[-122.83170275487548,47.314969898489856],[-122.82592381188118,47.3323597228723],[-122.82014486888689,47.329875462246235],[-122.82592381188118,47.31993841974198],[-122.83170275487548,47.314969898489856]]],[[[-122.87793429882989,47.16343000030004],[-122.92416584278428,47.2454106009601],[-122.84903958385839,47.30006433473348],[-122.84326064086409,47.210630952195224],[-122.87793429882989,47.16343000030004]]],[[[-122.6121029210921,47.21808373407342],[-122.6698923510351,47.270253207220726],[-122.6698923510351,47.27770598909892],[-122.58898714911491,47.23298929782979],[-122.6121029210921,47.21808373407342]]],[[[-122.83748169786978,47.25534764346435],[-122.83748169786978,47.270253207220726],[-122.82592381188118,47.270253207220726],[-122.83748169786978,47.25534764346435]]],[[[-122.6698923510351,47.19075686718672],[-122.7161238949895,47.200693909690976],[-122.72768178097809,47.20814669156916],[-122.6756712940294,47.23050503720373],[-122.6698923510351,47.19075686718672]]],[[[-122.88949218481848,47.16839852155216],[-122.92416584278428,47.195725388438845],[-122.92416584278428,47.2255365159516],[-122.90105007080707,47.19324112781278],[-122.88949218481848,47.16839852155216]]],[[[-122.6987870660066,47.12368183028303],[-122.745018609961,47.15100869716972],[-122.7045660090009,47.18827260656066],[-122.6756712940294,47.17336704280429],[-122.6987870660066,47.12368183028303]]],[[[-122.6409976360636,47.14852443654366],[-122.62943975007501,47.16839852155216],[-122.62943975007501,47.16343000030004],[-122.6409976360636,47.14852443654366]]],[[[-123.95859663876388,46.40821476997701],[-123.99904923972397,46.46038424312432],[-123.98749135373536,46.497648152515254],[-123.94703875277527,46.46535276437645],[-123.95859663876388,46.40821476997701]]]]}},{"type":"Feature","id":657,"properties":{"name":"dma:","latitude":34.181478,"dma":657,"dma1":"Sherman, TX-Ada, OK","longitude":-96.2499835},"geometry":{"type":"Polygon","coordinates":[[[-95.3123762160216,33.88008843274328],[-95.54353393579358,33.88008843274328],[-95.59554442274228,33.94219494839484],[-95.76891271257125,33.845308783978396],[-95.93650205940594,33.887541214621464],[-96.14454400720072,33.83785600210021],[-96.17921766516652,33.75835966206621],[-96.38148066996699,33.72606427392739],[-96.38725961296129,33.39814187128713],[-96.94203814041404,33.41553169566957],[-96.94203814041404,33.94964773027303],[-97.08651171527153,33.85524582648265],[-97.04605911431143,33.817981917091714],[-97.12696431623162,33.716127231423144],[-97.19053268916892,33.760843922692274],[-97.20786951815181,33.91486808150815],[-97.3812378079808,33.817981917091714],[-97.48525878187819,33.917352342134215],[-97.56038504080408,33.89747825712571],[-97.56038504080408,34.50612211051105],[-97.3523430930093,34.50612211051105],[-97.3523430930093,34.3769405579558],[-96.87846976747674,34.33222386668667],[-96.82645928052804,34.59307123242324],[-96.93048025442545,34.59307123242324],[-96.93048025442545,34.96571032633263],[-96.72821724962496,34.856402858785884],[-96.69354359165916,34.93341493819382],[-96.52595424482448,34.868824161916194],[-96.4045964419442,34.93341493819382],[-96.4045964419442,34.766969476247624],[-96.09253352025202,34.766969476247624],[-96.09253352025202,34.68002035433543],[-95.88449157245725,34.68002035433543],[-95.88449157245725,34.59307123242324],[-95.51463922082208,34.59307123242324],[-95.51463922082208,34.68002035433543],[-94.93674492139213,34.68002035433543],[-94.93674492139213,34.50612211051105],[-95.04654483828382,34.50612211051105],[-95.04654483828382,34.242790484148415],[-95.15056581218121,34.242790484148415],[-95.15634475517551,33.93722642714272],[-95.2314710141014,33.96206903340334],[-95.3123762160216,33.88008843274328]]]}},{"type":"Feature","id":612,"properties":{"name":"dma:","latitude":32.820852,"dma":612,"dma1":"Shreveport, LA","longitude":-94.0138375},"geometry":{"type":"Polygon","coordinates":[[[-94.50910313981399,31.97466053255326],[-94.60156622772277,31.972176271927193],[-94.49176631083108,32.394500578357835],[-94.69980825862586,32.421827445244524],[-94.67091354365436,32.836698969796984],[-94.72292403060305,32.90377400670067],[-95.15056581218121,32.90128974607461],[-95.12745004020402,33.390689089408944],[-95.30659727302731,33.38075204690469],[-95.3123762160216,33.88008843274328],[-95.2314710141014,33.96206903340334],[-95.15634475517551,33.93722642714272],[-95.15056581218121,34.242790484148415],[-95.04654483828382,34.242790484148415],[-95.04654483828382,34.50612211051105],[-94.46287159585958,34.50860637113712],[-94.46865053885388,34.1906210110011],[-94.2432717620762,34.19310527162716],[-94.2548296480648,34.35458221232123],[-93.93698778337833,34.34961369106911],[-93.92542989738973,34.185652489748975],[-93.82140892349234,34.18316822912291],[-93.82140892349234,34.00926998529853],[-93.370651369937,33.957100512151214],[-93.2781882820282,33.83537174147415],[-93.10481999219922,33.77823374707471],[-93.11637787818782,33.38075204690469],[-92.97768324632463,33.37826778627863],[-92.98924113231323,33.01804999549955],[-92.72340975457546,33.01556573487349],[-92.72340975457546,32.75968689038904],[-92.82743072847285,32.75968689038904],[-92.87944121542154,32.60069421032104],[-92.87944121542154,32.45412283338334],[-92.77542024152415,32.45412283338334],[-92.77542024152415,32.23550789828983],[-92.81587284248425,32.14607451575158],[-92.93723064536454,32.14855877637764],[-92.87366227242724,31.944849405040507],[-92.97768324632463,31.713813166816685],[-92.71763081158116,31.525009359235924],[-92.76386235553555,31.475324146714673],[-92.94878853135313,31.346142594159417],[-93.38798819891989,31.363532418541855],[-93.57869331773176,31.16727582908291],[-94.04100875727573,31.134980440944094],[-93.98321932733273,31.569726050505054],[-94.39930322292228,31.65419091179118],[-94.50910313981399,31.97466053255326]]]}},{"type":"Feature","id":624,"properties":{"name":"dma:","latitude":42.621459,"dma":624,"dma1":"Sioux City, IA","longitude":-96.376337},"geometry":{"type":"Polygon","coordinates":[[[-94.44553476687668,42.90789154785479],[-94.91362914941493,42.91037580848085],[-94.85583971947194,42.2098143119312],[-95.67067068166816,42.21229857255726],[-95.67067068166816,41.86201782428243],[-96.13876506420641,41.866986345534556],[-96.13298612121213,41.97380955245525],[-96.2716807530753,42.048337371237125],[-96.55484895979598,42.01604198309832],[-96.55484895979598,42.09056980188019],[-97.01716439933993,42.09056980188019],[-97.01716439933993,41.74277331423143],[-97.83199536153614,41.74277331423143],[-97.83199536153614,42.43836628952896],[-98.30586868706871,42.435882028902896],[-98.311647630063,42.88304894159417],[-98.01114259435943,42.761320170917095],[-97.84355324752475,42.86814337783779],[-97.3061115490549,42.86814337783779],[-96.80334350855085,42.704182176517655],[-96.80334350855085,43.08427405230523],[-96.43927009990999,43.11408517981799],[-96.55484895979598,43.26065655675568],[-95.3875024749475,43.25568803550355],[-95.3875024749475,43.499145576857686],[-95.03498695229523,43.501629837483755],[-94.91362914941493,43.501629837483755],[-94.91362914941493,43.25568803550355],[-94.44553476687668,43.25568803550355],[-94.44553476687668,42.90789154785479]]]}},{"type":"Feature","id":725,"properties":{"name":"dma:","latitude":44.0133785,"dma":725,"dma1":"Sioux Falls (Mitchell), SD","longitude":-98.735199},"geometry":{"type":"Polygon","coordinates":[[[-101.4264979039904,42.093054062506255],[-102.03906586138613,42.09553832313232],[-102.08529740534053,42.99980919101911],[-101.23001384218422,42.99732493039305],[-101.23001384218422,43.79477259135914],[-101.06242449534953,43.841973543254326],[-101.04508766636664,43.99599770207021],[-101.04508766636664,44.16741168526853],[-101.16644546924692,44.16741168526853],[-101.13755075427542,44.74624441114112],[-100.73302474467447,44.763634235523554],[-100.69835108670867,44.82822501180118],[-100.54809856885689,44.76114997489749],[-100.42096182298229,44.84313057555756],[-100.415182879988,45.00212325562556],[-100.2764882481248,45.02199734063407],[-100.32849873507351,45.094040898789885],[-100.25915141914192,45.24061227572758],[-100.3169408490849,45.31762435513552],[-100.2764882481248,45.38221513141315],[-100.48453019591959,45.551144853985406],[-99.71593077767777,45.59337728462847],[-99.71593077767777,45.94117377227723],[-96.56062790279027,45.93620525102511],[-96.58374367476748,45.819445001600165],[-96.85535399549954,45.605798587758784],[-96.69354359165916,45.41699478017802],[-96.45082798589858,45.30023453075308],[-96.45082798589858,44.63196842234224],[-96.09253352025202,44.62948416171618],[-96.08097563426342,44.197222812781284],[-95.46262873387339,44.194738552155215],[-95.45684979087909,43.501629837483755],[-95.3875024749475,43.499145576857686],[-95.3875024749475,43.25568803550355],[-96.55484895979598,43.26065655675568],[-96.43927009990999,43.11408517981799],[-96.80334350855085,43.08427405230523],[-96.80334350855085,42.704182176517655],[-97.3061115490549,42.86814337783779],[-97.84355324752475,42.86814337783779],[-98.03425836633663,42.76380443154316],[-98.49657380588059,42.99732493039305],[-100.19558304620462,42.99732493039305],[-100.16668833123312,42.08560128062807],[-101.4264979039904,42.093054062506255]]]}},{"type":"Feature","id":588,"properties":{"name":"dma:","latitude":41.576527,"dma":588,"dma1":"South Bend-Elkhart, IN","longitude":-86.062314},"geometry":{"type":"Polygon","coordinates":[[[-86.52260392169217,41.4322407359736],[-86.48793026372637,41.57135933103311],[-86.52260392169217,41.76016313861386],[-86.82310895739573,41.76016313861386],[-86.61506700960095,41.89679747304731],[-86.36657246084607,42.24210970007001],[-86.2220988859886,42.24459396069607],[-86.2220988859886,42.07069571687169],[-85.76556238943894,42.06821145624563],[-85.78867816141613,41.76016313861386],[-85.19922597599759,41.76016313861386],[-85.1934470330033,41.52664263976398],[-85.65576247254725,41.524158379137916],[-85.68465718751875,41.0471803389339],[-86.17008839903991,40.997495126412645],[-86.17008839903991,40.91054600450045],[-86.93290887428742,40.913030265126515],[-86.93290887428742,41.23598414651465],[-86.64396172457245,41.4322407359736],[-86.52260392169217,41.4322407359736]]]}},{"type":"Feature","id":881,"properties":{"name":"dma:","latitude":47.0398515,"dma":881,"dma1":"Spokane, WA","longitude":-117.603633},"geometry":{"type":"Polygon","coordinates":[[[-114.66605630393039,45.4716485139514],[-114.79897199279928,45.49649112021203],[-114.5909300450045,45.29775027012702],[-114.69495101890189,45.195895584458455],[-115.97209742064206,45.220738190719075],[-116.14546571047104,45.106462201920195],[-116.30727611431143,45.10894646254626],[-116.34194977227722,45.26793914261427],[-116.68868635193519,45.26793914261427],[-116.78114943984399,45.07913533503351],[-117.26658065136513,45.081619595659575],[-117.26658065136513,45.1660844569457],[-117.47462259915991,45.1660844569457],[-117.72889609090909,45.51388094459446],[-117.78668552085207,45.690263449044906],[-117.74623291989198,45.861677432243226],[-117.97739063966397,45.861677432243226],[-117.98894852565256,46.20698965926593],[-118.24322201740173,46.29393878117813],[-118.20854835943594,46.73862143324333],[-119.37011590129012,46.73613717261726],[-119.37589484428443,46.67651491759176],[-119.5145894761476,46.726200130113014],[-119.82665239783978,46.62434544444445],[-119.94223125772577,46.6740306569657],[-119.92489442874287,46.81314925202521],[-120.04047328862886,47.07151235713572],[-120.00579963066306,47.31993841974198],[-119.87866288478847,47.43669866916692],[-119.53192630513051,47.44166719041905],[-119.53192630513051,47.52861631233124],[-119.31810541434143,47.627986737373746],[-119.21408444044404,47.88883410311031],[-118.95403200570057,48.020499916291634],[-119.13317923852385,48.152165729472955],[-119.34700012931293,48.050311043804385],[-119.50881053315331,48.08012217131714],[-119.618610450045,47.99565731003101],[-119.77464191089109,48.10496477757776],[-119.89599971377137,48.050311043804385],[-119.87288394179417,47.96087766126613],[-120.06358906060606,47.96584618251826],[-120.6472623030303,48.39562327082709],[-120.6299254740474,48.49747795649566],[-120.78595693489349,48.62665950905091],[-120.6588201890189,48.72602993409342],[-120.75706221992199,48.94712912981299],[-120.88419896579657,48.974455996699675],[-114.72962467686769,49.001782863586364],[-114.73540361986198,48.81049479537954],[-114.6140458169817,48.75087254035404],[-114.68917207590759,48.70864010971098],[-114.63716158895889,48.65895489718973],[-114.89143508070806,48.65895489718973],[-114.84520353675367,48.22669354825483],[-115.01857182658266,48.22669354825483],[-115.01279288358836,48.01553139503951],[-115.15726645844585,48.01801565566557],[-115.18616117341733,47.91864523062307],[-115.27862426132613,47.891318363736374],[-115.527118810081,47.90870818811882],[-115.75827652985298,48.26395745764577],[-115.95476059165917,48.14968146884689],[-116.04722367956795,48.21427224512452],[-116.04722367956795,47.97578322502251],[-115.72360287188718,47.695061774277434],[-115.68892921392138,47.595691349234926],[-115.75827652985298,47.54849039733974],[-115.6311397839784,47.478931099809984],[-115.75827652985298,47.42179310541054],[-115.31907686228622,47.257831904090416],[-114.92610873867386,46.91748819831984],[-114.89721402370236,46.80321220952096],[-114.78741410681067,46.78085386388639],[-114.77007727782778,46.69638900260027],[-114.66605630393039,46.73862143324333],[-114.60248793099309,46.63676674757477],[-114.31931972427242,46.64918805070508],[-114.4695722421242,46.26661191429143],[-114.44645647014701,46.16972574987499],[-114.5273616720672,46.144883143614365],[-114.38866704020401,45.88155151725173],[-114.5678142730273,45.77472831033104],[-114.4984669570957,45.70268475217522],[-114.562035330033,45.55859763586359],[-114.66605630393039,45.4716485139514]]]}},{"type":"Feature","id":619,"properties":{"name":"dma:","latitude":37.1293385,"dma":619,"dma1":"Springfield, MO","longitude":-92.5469955},"geometry":{"type":"Polygon","coordinates":[[[-91.45204229582959,36.49849913261326],[-91.45204229582959,36.334537931293134],[-91.56762115571557,36.337022191919196],[-91.56762115571557,36.250073070007005],[-92.15707334113411,36.26001011251125],[-92.19752594209422,36.05878500180018],[-92.3073258589859,36.061269262426244],[-92.3073258589859,35.97432014051405],[-92.4171257758776,35.976804401140114],[-92.41134683288328,36.063753523052306],[-92.94300958835883,36.11592299619962],[-92.94878853135313,35.725894077907796],[-93.52090388778878,35.73334685978598],[-93.44577762886288,36.08114334743475],[-93.58447226072607,36.15567116621662],[-93.65959851965196,36.30224254315432],[-93.86764046744673,36.307211064406445],[-93.86764046744673,36.49849913261326],[-94.07568241524152,36.49849913261326],[-94.05256664326433,38.21512322522253],[-93.52090388778878,38.20767044334434],[-93.51512494479448,38.51323450035004],[-93.1799462511251,38.53310858535854],[-93.07014633423341,38.53062432473248],[-93.07592527722773,38.25983991649165],[-93.01235690429043,38.1902806189619],[-92.64250455265525,38.212638964596465],[-92.51536780678067,38.02135089638964],[-91.63118952865287,38.05116202390239],[-91.63118952865287,38.15301670957096],[-91.52716855475546,38.15301670957096],[-91.52716855475546,37.78783039753976],[-91.30756872097209,37.78783039753976],[-91.3133476639664,37.700881275627566],[-91.15153726012602,37.698397015001504],[-91.1573162031203,37.58908954745475],[-91.3133476639664,37.59405806870687],[-91.3133476639664,37.50462468616862],[-91.209326690069,37.50214042554256],[-91.1573162031203,37.25371436293629],[-91.01862157125711,37.144406895389544],[-91.01862157125711,37.09472168286829],[-91.2151056330633,37.087268900990104],[-91.2266635190519,36.82642153525353],[-91.11686360216021,36.82393727462747],[-91.1284214881488,36.49849913261326],[-91.45204229582959,36.49849913261326]]]}},{"type":"Feature","id":543,"properties":{"name":"dma:","latitude":42.3856895,"dma":543,"dma1":"Springfield-Holyoke, MA","longitude":-72.6017095},"geometry":{"type":"Polygon","coordinates":[[[-72.28328838373838,42.721572000900096],[-72.23127789678968,42.661949745874594],[-72.31218309870987,42.34396438573857],[-72.21394106780679,42.31166899759977],[-72.26595155475547,42.18497170567057],[-72.1330358658866,42.162613360036005],[-72.1330358658866,42.03094754685469],[-73.0518878019802,42.04088458935894],[-72.99987731503151,42.31166899759977],[-73.06922463096309,42.38122829512952],[-73.0114352010201,42.378744034503455],[-72.9536457710771,42.63959140024003],[-73.0229930870087,42.74144608590859],[-72.28328838373838,42.721572000900096]]]}},{"type":"Feature","id":638,"properties":{"name":"dma:","latitude":40.055305,"dma":638,"dma1":"St. Joseph, MO","longitude":-94.8792055},"geometry":{"type":"Polygon","coordinates":[[[-95.416397189919,40.04105478537854],[-95.47996556285628,40.24227989608961],[-95.55509182178217,40.26463824172418],[-95.17946052715271,40.26215398109811],[-95.2025762991299,40.57765508060807],[-94.23171387608761,40.572686559355944],[-94.2143770471047,40.38388275177518],[-94.59578728472847,40.386367012401244],[-94.60734517071707,40.03857052475248],[-94.20281916111611,40.033602003500356],[-94.20859810411041,39.74542777087709],[-94.60156622772277,39.747912031503155],[-94.60156622772277,39.531781357035705],[-95.10433426822682,39.534265617661774],[-95.05232378127812,39.62369900020002],[-95.34127093099309,39.65351012771278],[-95.34127093099309,39.99882235473548],[-95.416397189919,40.04105478537854]]]}},{"type":"Feature","id":609,"properties":{"name":"dma:","latitude":38.434253,"dma":609,"dma1":"St. Louis, MO","longitude":-90.169254},"geometry":{"type":"Polygon","coordinates":[[[-91.44048440984099,39.31813494319432],[-91.45782123882388,39.44980075637564],[-91.20354774707471,39.5988563939394],[-90.93771636933693,39.40011554385439],[-90.61409556165617,39.39514702260226],[-90.57942190369036,39.52184431453146],[-89.53343322172216,39.52432857515752],[-89.53343322172216,39.347946070707074],[-89.14046509810981,39.347946070707074],[-89.14046509810981,39.21628025752575],[-88.80528640444044,39.21628025752575],[-88.80528640444044,38.910716200520056],[-88.69548648754875,38.91568472177218],[-88.70126543054306,38.4759705909591],[-89.14624404110411,38.47348633033304],[-89.14624404110411,38.212638964596465],[-89.59122265166516,38.22009174647465],[-89.59700159465946,37.95427585948595],[-89.67212785358535,37.802735961296136],[-89.84549614341434,37.9045906469647],[-90.14600117911792,37.641259020602064],[-90.53319035973597,37.643743281228126],[-90.55052718871886,37.273588447944796],[-90.75279019351936,37.271104187318734],[-90.77012702250225,37.60399511121112],[-91.1573162031203,37.58908954745475],[-91.15153726012602,37.698397015001504],[-91.3133476639664,37.700881275627566],[-91.30756872097209,37.78783039753976],[-91.52716855475546,37.78783039753976],[-91.52716855475546,38.15301670957096],[-91.64274741464146,38.15301670957096],[-91.64274741464146,38.70452256855686],[-91.41736863786377,38.709491089808985],[-91.41736863786377,38.84612542424243],[-91.26711612001199,38.84364116361637],[-91.26133717701771,39.13926817811782],[-91.41158969486949,39.14175243874388],[-91.44048440984099,39.31813494319432]]]}},{"type":"Feature","id":555,"properties":{"name":"dma:","latitude":42.9849975,"dma":555,"dma1":"Syracuse, NY","longitude":-76.1014455},"geometry":{"type":"Polygon","coordinates":[[[-76.72151660336033,43.34263715741575],[-76.42101156765676,43.52150392249226],[-76.23608539183918,43.528956704370444],[-76.18407490489048,43.6780123419342],[-76.0222645010501,43.70782346944695],[-75.77376995229523,43.68794938443845],[-75.75643312331232,43.46933444934494],[-75.53105434653466,43.41964923682369],[-75.22477036783678,43.56125209250926],[-75.21899142484249,43.40225941244125],[-75.38658077167716,43.302888987398745],[-75.29989662676267,43.2258769079908],[-75.42125442964297,43.17370743484349],[-75.30567556975697,43.03458883978398],[-75.34034922772277,42.93521841474148],[-75.24788613981397,42.86814337783779],[-75.25366508280828,42.78367851655166],[-75.88934881218123,42.72405626152616],[-75.86623304020401,42.41600794389439],[-76.29387482178217,42.406070901390144],[-76.24764327782779,42.29676343384339],[-76.41523262466247,42.31912177947795],[-76.41523262466247,42.26198378507851],[-76.69262188838883,42.28434213071307],[-76.69262188838883,42.547673757075714],[-76.89488489318931,42.54270523582359],[-76.9815690381038,42.86317485658566],[-76.96423220912091,43.01223049414942],[-76.71573766036605,43.02465179727973],[-76.72151660336033,43.34263715741575]]]}},{"type":"Feature","id":530,"properties":{"name":"dma:","latitude":30.462299,"dma":530,"dma1":"Tallahassee, FL-Thomasville, GA","longitude":-83.675708},"geometry":{"type":"Polygon","coordinates":[[[-84.73691053645365,30.265489221822182],[-84.64444744854485,30.387217992499252],[-84.93339459825982,30.60583292759276],[-84.77158419441943,30.836869165816584],[-84.73113159345934,31.070389664666468],[-84.92183671227122,31.07287392529253],[-84.91605776927693,31.256709211621164],[-84.53464753165316,31.256709211621164],[-84.54042647464746,31.077842446544654],[-83.79494282838283,31.02567297339734],[-83.57534299459945,31.077842446544654],[-83.19971169997,31.02567297339734],[-83.1650380420042,31.147401744074408],[-83.04945918211821,31.18466565346535],[-82.67382788748876,31.18466565346535],[-82.48890171167116,30.963566457745777],[-82.41955439573957,30.580990321332134],[-82.72583837443744,30.563600496949697],[-82.64493317251726,30.39467077437744],[-82.79518569036904,30.337532779977998],[-82.76051203240324,29.974830728572858],[-82.89342772127213,29.828259351635165],[-83.32106950285029,29.823290830383037],[-83.36152210381039,29.669266671567158],[-83.47132202070208,29.689140756575657],[-83.67936396849684,29.922661255425542],[-83.99720583318332,30.106496541754176],[-84.33816346984699,30.074201153615363],[-84.39017395679568,29.99718907420742],[-84.34972135583558,29.969862207320734],[-84.63288956255624,30.066748371737173],[-84.73691053645365,30.265489221822182]]]}},{"type":"Feature","id":539,"properties":{"name":"dma:","latitude":27.9989465,"dma":539,"dma1":"Tampa-St. Petersburg (Sarasota), FL","longitude":-81.8973955},"geometry":{"type":"MultiPolygon","coordinates":[[[[-81.1424079939994,27.64211000070007],[-81.20597636693668,27.49057010251025],[-80.94592393219321,27.209848651765178],[-81.1713027089709,27.209848651765178],[-81.269544739874,27.03346614731473],[-81.56427083258325,27.03346614731473],[-81.56427083258325,27.341514464946496],[-82.0554809870987,27.33903020432043],[-82.0554809870987,27.030981886688668],[-82.25774399189919,27.030981886688668],[-82.25774399189919,26.944032764776477],[-82.40799650975097,27.01110780168017],[-82.37332285178518,26.94651702540254],[-82.47156488268827,27.112962487348735],[-82.44267016771677,27.103025444844484],[-82.50045959765976,27.227238476147615],[-82.54091219861985,27.271955167416742],[-82.54091219861985,27.321640379937993],[-82.57558585658566,27.40610524122412],[-82.69116471647165,27.473180278127813],[-82.56980691359135,27.54770809690969],[-82.62181740054005,27.587456266926694],[-82.47734382568257,27.7464489469947],[-82.39643862376238,27.7663230320032],[-82.41377545274527,27.952642578957896],[-82.48890171167116,27.91786293019302],[-82.47156488268827,27.82346102640264],[-82.53513325562557,27.83339806890689],[-82.52935431263126,27.93773701520152],[-82.69694365946594,28.037107440244025],[-82.73161731743174,27.932768493949396],[-82.58136479957996,27.878114760176018],[-82.67960683048304,27.694279473847384],[-82.75473308940894,27.838366590159016],[-82.84719617731773,27.875630499549956],[-82.82985934833482,27.897988845184518],[-82.82408040534054,27.91786293019302],[-82.82408040534054,27.922831451445145],[-82.81830146234623,27.93028423332333],[-82.80096463336334,27.989906488348836],[-82.78940674737473,27.982453706470647],[-82.77206991839184,28.10666673777378],[-82.80096463336334,28.18616307780778],[-82.66804894449444,28.43458914041404],[-82.63337528652866,28.695436506150614],[-82.63337528652866,28.879271792479248],[-82.77784886138613,28.941378308130815],[-82.75473308940894,29.001000563156317],[-82.47156488268827,29.05317003630363],[-82.31553342184219,28.97367369626963],[-82.17105984698469,28.797291191819184],[-82.2750808208821,28.653204075507553],[-82.0554809870987,28.52153826232623],[-82.0554809870987,28.312860369736974],[-81.65673392049204,28.34764001850185],[-81.65673392049204,28.258206635963596],[-81.55849188958896,28.258206635963596],[-81.52381823162315,28.143930647164716],[-81.34467099879987,28.084308392139214],[-81.37934465676568,28.012264833983398],[-81.46024985868587,28.039591700870087],[-81.20597636693668,27.820976765776578],[-81.1424079939994,27.64211000070007]]],[[[-82.64493317251726,28.854429186218624],[-82.66227000150015,28.88175605310531],[-82.65649105850585,28.886724574357437],[-82.63915422952294,28.879271792479248],[-82.64493317251726,28.864366228722872],[-82.64493317251726,28.854429186218624]]],[[[-82.66227000150015,28.864366228722872],[-82.67382788748876,28.866850489348934],[-82.67382788748876,28.876787531853186],[-82.67382788748876,28.871819010601058],[-82.66227000150015,28.864366228722872]]],[[[-82.69116471647165,28.817165276827684],[-82.72583837443744,28.854429186218624],[-82.66804894449444,28.864366228722872],[-82.67382788748876,28.839523622462245],[-82.66227000150015,28.83207084058406],[-82.69116471647165,28.817165276827684]]],[[[-82.66227000150015,28.82461805870587],[-82.65649105850585,28.829586579957997],[-82.66804894449444,28.844492143714373],[-82.63915422952294,28.849460664966497],[-82.66227000150015,28.82461805870587]]],[[[-82.66227000150015,28.79480693119312],[-82.69116471647165,28.799775452445246],[-82.69116471647165,28.809712494949494],[-82.65649105850585,28.82461805870587],[-82.66227000150015,28.79480693119312]]],[[[-82.68538577347735,28.787354149314933],[-82.68538577347735,28.79480693119312],[-82.66804894449444,28.79480693119312],[-82.67382788748876,28.789838409940995],[-82.67382788748876,28.787354149314933],[-82.68538577347735,28.787354149314933]]],[[[-82.69116471647165,28.769964324932495],[-82.69694365946594,28.779901367436743],[-82.63915422952294,28.789838409940995],[-82.68538577347735,28.779901367436743],[-82.69116471647165,28.769964324932495]]],[[[-82.66227000150015,28.75754302180218],[-82.68538577347735,28.75754302180218],[-82.68538577347735,28.769964324932495],[-82.65649105850585,28.769964324932495],[-82.64493317251726,28.779901367436743],[-82.66227000150015,28.75754302180218]]],[[[-82.66804894449444,28.712826330533055],[-82.67382788748876,28.72773189428943],[-82.66227000150015,28.735184676167616],[-82.65071211551154,28.725247633663365],[-82.66804894449444,28.712826330533055]]],[[[-82.82408040534054,28.054497264626463],[-82.83563829132913,28.064434307130714],[-82.82985934833482,28.084308392139214],[-82.81252251935193,28.06195004650465],[-82.82408040534054,28.054497264626463]]],[[[-82.79518569036904,28.0520130040004],[-82.80096463336334,28.0520130040004],[-82.81252251935193,28.059465785878587],[-82.80096463336334,28.0520130040004],[-82.79518569036904,28.0520130040004]]],[[[-82.79518569036904,28.0520130040004],[-82.78362780438044,28.0520130040004],[-82.78940674737473,28.04952874337434],[-82.79518569036904,28.0520130040004]]],[[[-82.82408040534054,28.009780573357336],[-82.82985934833482,28.019717615861587],[-82.81830146234623,28.047044482748277],[-82.81252251935193,28.032138918991897],[-82.82408040534054,28.009780573357336]]],[[[-82.82408040534054,27.96506388208821],[-82.82985934833482,27.96754814271427],[-82.82985934833482,28.012264833983398],[-82.82985934833482,27.970032403340333],[-82.82408040534054,27.96506388208821]]],[[[-82.81830146234623,27.98493796709671],[-82.82408040534054,27.9923907489749],[-82.81830146234623,27.997359270227022],[-82.81830146234623,27.98742222772277],[-82.81830146234623,27.98493796709671]]],[[[-82.81830146234623,27.98742222772277],[-82.81830146234623,27.997359270227022],[-82.81252251935193,27.98742222772277],[-82.81830146234623,27.98742222772277]]],[[[-82.81830146234623,27.98493796709671],[-82.81252251935193,27.98742222772277],[-82.80674357635763,27.96754814271427],[-82.82408040534054,27.977485185218523],[-82.81830146234623,27.98493796709671]]],[[[-82.78362780438044,27.783712856385637],[-82.82985934833482,27.820976765776578],[-82.84141723432343,27.845819372037205],[-82.85297512031204,27.873146238923894],[-82.85297512031204,27.888051802680266],[-82.83563829132913,27.96506388208821],[-82.82408040534054,27.960095360836085],[-82.84141723432343,27.93773701520152],[-82.84141723432343,27.91041014831483],[-82.83563829132913,27.90792588768877],[-82.84719617731773,27.90792588768877],[-82.83563829132913,27.90047310581058],[-82.84719617731773,27.90047310581058],[-82.84141723432343,27.895504584558456],[-82.84719617731773,27.89053606330633],[-82.84141723432343,27.89053606330633],[-82.84719617731773,27.878114760176018],[-82.84719617731773,27.873146238923894],[-82.78362780438044,27.783712856385637]]],[[[-82.82985934833482,27.91041014831483],[-82.82985934833482,27.915378669566955],[-82.82408040534054,27.915378669566955],[-82.82985934833482,27.91041014831483]]],[[[-82.75473308940894,27.73899616511651],[-82.78362780438044,27.778744335133513],[-82.77784886138613,27.783712856385637],[-82.76629097539754,27.786197117011703],[-82.75473308940894,27.778744335133513],[-82.77206991839184,27.77626007450745],[-82.75473308940894,27.73899616511651]]],[[[-82.41377545274527,27.7663230320032],[-82.41377545274527,27.768807292629262],[-82.41377545274527,27.77377581388139],[-82.40799650975097,27.77377581388139],[-82.41377545274527,27.7663230320032]]],[[[-82.76051203240324,27.758870250125014],[-82.76051203240324,27.771291553255324],[-82.75473308940894,27.771291553255324],[-82.75473308940894,27.7663230320032],[-82.76051203240324,27.758870250125014]]],[[[-82.75473308940894,27.753901728872886],[-82.74895414641463,27.771291553255324],[-82.74317520342035,27.771291553255324],[-82.74895414641463,27.758870250125014],[-82.75473308940894,27.753901728872886]]],[[[-82.76051203240324,27.758870250125014],[-82.74317520342035,27.734027643864387],[-82.73161731743174,27.734027643864387],[-82.74317520342035,27.729059122612263],[-82.72583837443744,27.711669298229822],[-82.73739626042604,27.71912208010801],[-82.73739626042604,27.68185817071707],[-82.74317520342035,27.71912208010801],[-82.76051203240324,27.758870250125014]]],[[[-82.74317520342035,27.7464489469947],[-82.74895414641463,27.748933207620762],[-82.74895414641463,27.753901728872886],[-82.74895414641463,27.751417468246824],[-82.74317520342035,27.7464489469947]]],[[[-82.62759634353435,27.71912208010801],[-82.63915422952294,27.73651190449045],[-82.62759634353435,27.741480425742573],[-82.62759634353435,27.734027643864387],[-82.62759634353435,27.71912208010801]]],[[[-82.73161731743174,27.721606340734073],[-82.73161731743174,27.724090601360135],[-82.72583837443744,27.724090601360135],[-82.73161731743174,27.721606340734073]]],[[[-82.70850154545454,27.714153558855884],[-82.69694365946594,27.71912208010801],[-82.69694365946594,27.71663781948195],[-82.70850154545454,27.714153558855884]]],[[[-82.71428048844885,27.694279473847384],[-82.72005943144313,27.714153558855884],[-82.70850154545454,27.71663781948195],[-82.70850154545454,27.711669298229822],[-82.71428048844885,27.694279473847384]]],[[[-82.69694365946594,27.70918503760376],[-82.69694365946594,27.711669298229822],[-82.70272260246024,27.714153558855884],[-82.69694365946594,27.714153558855884],[-82.69694365946594,27.70918503760376]]],[[[-82.69694365946594,27.70918503760376],[-82.70272260246024,27.706700776977698],[-82.70850154545454,27.70918503760376],[-82.69694365946594,27.70918503760376]]],[[[-82.73161731743174,27.694279473847384],[-82.73739626042604,27.701732255725574],[-82.72583837443744,27.70918503760376],[-82.73161731743174,27.696763734473446],[-82.73161731743174,27.694279473847384]]],[[[-82.71428048844885,27.65204704320432],[-82.73161731743174,27.666952606960695],[-82.72583837443744,27.694279473847384],[-82.72005943144313,27.691795213221322],[-82.71428048844885,27.65204704320432]]],[[[-82.73739626042604,27.612298873187317],[-82.73739626042604,27.644594261326134],[-82.69694365946594,27.639625740074006],[-82.70272260246024,27.62472017631763],[-82.73739626042604,27.612298873187317]]],[[[-82.75473308940894,27.57503496379638],[-82.76051203240324,27.580003485048504],[-82.76629097539754,27.589940527552756],[-82.76051203240324,27.60236183068307],[-82.75473308940894,27.57503496379638]]],[[[-82.62181740054005,27.522865490649064],[-82.62759634353435,27.530318272527253],[-82.64493317251726,27.532802533153315],[-82.60448057155716,27.5402553150315],[-82.62181740054005,27.522865490649064]]],[[[-82.69116471647165,27.445853411241124],[-82.71428048844885,27.500507145014502],[-82.74895414641463,27.53777105440544],[-82.70850154545454,27.522865490649064],[-82.69116471647165,27.445853411241124]]],[[[-82.58714374257426,27.329093161816182],[-82.68538577347735,27.43343210811081],[-82.69116471647165,27.440884889989],[-82.61603845754576,27.378778374337433],[-82.58714374257426,27.329093161816182]]],[[[-82.56980691359135,27.29679777367737],[-82.58714374257426,27.321640379937993],[-82.58714374257426,27.32660890119012],[-82.57558585658566,27.336545943694368],[-82.56980691359135,27.29679777367737]]],[[[-82.56402797059707,27.321640379937993],[-82.56402797059707,27.32660890119012],[-82.55824902760276,27.329093161816182],[-82.55824902760276,27.321640379937993],[-82.56402797059707,27.321640379937993]]],[[[-82.56402797059707,27.31667185868587],[-82.56402797059707,27.31915611931193],[-82.56402797059707,27.321640379937993],[-82.55824902760276,27.321640379937993],[-82.56402797059707,27.31667185868587]]],[[[-82.56402797059707,27.31667185868587],[-82.55824902760276,27.31667185868587],[-82.55824902760276,27.311703337433745],[-82.56402797059707,27.31667185868587]]],[[[-82.51201748364836,27.209848651765178],[-82.56980691359135,27.279407949294928],[-82.55824902760276,27.304250555555555],[-82.54669114161416,27.304250555555555],[-82.55247008460846,27.29182925242524],[-82.51201748364836,27.209848651765178]]],[[[-82.47156488268827,27.112962487348735],[-82.51201748364836,27.207364391139112],[-82.50045959765976,27.180037524252427],[-82.47734382568257,27.140289354235424],[-82.47156488268827,27.112962487348735]]]]}},{"type":"Feature","id":581,"properties":{"name":"dma:","latitude":39.2814045,"dma":581,"dma1":"Terre Haute, IN","longitude":-87.6904085},"geometry":{"type":"Polygon","coordinates":[[[-88.69548648754875,38.91568472177218],[-88.36030779387939,38.910716200520056],[-88.36030779387939,39.17156356625663],[-88.00779227122712,39.17404782688269],[-87.93844495529552,39.87957784468447],[-87.53391894569457,39.88206210531054],[-87.48768740174017,40.147877992299236],[-87.40678219981999,40.12800390729073],[-87.43567691479149,39.95658992409241],[-87.08894033513351,39.95410566346635],[-87.08894033513351,39.86715654155416],[-87.00803513321333,39.86715654155416],[-87.01381407620761,39.474643362636264],[-86.93868781728173,39.4721591020102],[-86.94446676027601,39.34297754945495],[-87.05426667716772,39.34297754945495],[-87.05426667716772,39.16907930563057],[-86.68441432553254,39.166595045004506],[-86.68441432553254,38.52565580348035],[-87.42411902880288,38.54056136723673],[-87.74196089348935,38.413864075307536],[-87.64949780558055,38.567888234123416],[-88.70126543054306,38.60515214351435],[-88.69548648754875,38.91568472177218]]]}},{"type":"Feature","id":547,"properties":{"name":"dma:","latitude":41.384993,"dma":547,"dma1":"Toledo, OH","longitude":-83.7585085},"geometry":{"type":"MultiPolygon","coordinates":[[[[-83.88162697329733,40.92048304700471],[-84.33816346984699,40.858376531353144],[-84.40173184278427,40.99004234453446],[-84.34394241284127,40.99004234453446],[-84.34394241284127,41.20865727962797],[-84.80625785238524,41.253373970897094],[-84.80625785238524,41.695572362336236],[-84.36127924182418,41.705509404840484],[-84.36127924182418,42.07317997749776],[-83.77182705640564,42.08311702000201],[-83.76026917041705,41.722899229222925],[-83.45398519171917,41.73283627172718],[-82.93388032223223,41.51422133663367],[-82.83563829132913,41.58874915541554],[-82.70850154545454,41.536579682268226],[-83.0379012961296,41.46453612411241],[-82.84719617731773,41.42975647534754],[-82.82985934833482,40.997495126412645],[-83.11302755505551,40.99252660516052],[-83.11302755505551,40.701868111911196],[-83.44242730573058,40.686962548154824],[-83.49443779267926,40.701868111911196],[-83.49443779267926,40.81862836133614],[-83.88162697329733,40.81862836133614],[-83.88162697329733,40.92048304700471]]],[[[-82.80674357635763,41.705509404840484],[-82.83563829132913,41.707993665466546],[-82.83563829132913,41.71047792609261],[-82.81252251935193,41.722899229222925],[-82.80674357635763,41.705509404840484]]],[[[-82.81252251935193,41.670729756075616],[-82.82408040534054,41.68563531983199],[-82.81252251935193,41.693088101710174],[-82.77784886138613,41.695572362336236],[-82.81252251935193,41.670729756075616]]],[[[-82.82985934833482,41.69060384108411],[-82.82408040534054,41.693088101710174],[-82.82408040534054,41.69060384108411],[-82.82985934833482,41.69060384108411]]],[[[-82.84719617731773,41.67569827732774],[-82.85297512031204,41.6781825379538],[-82.85875406330632,41.680666798579864],[-82.84719617731773,41.6781825379538],[-82.84719617731773,41.67569827732774]]],[[[-82.84141723432343,41.62849732543255],[-82.83563829132913,41.65582419231924],[-82.79518569036904,41.665761234823485],[-82.82985934833482,41.63346584668467],[-82.84141723432343,41.62849732543255]]]]}},{"type":"Feature","id":605,"properties":{"name":"dma:","latitude":39.0201515,"dma":605,"dma1":"Topeka, KS","longitude":-96.5557205},"geometry":{"type":"Polygon","coordinates":[[[-95.95961783138313,38.1704065339534],[-96.3583648979898,38.17289079457946],[-96.3525859549955,38.520687282228224],[-96.93048025442545,38.523171542854286],[-96.89002765346534,38.87096803050305],[-96.96515391239123,39.13181539623963],[-97.3696799219922,39.13181539623963],[-97.3696799219922,39.30571364006401],[-97.93023739243924,39.30571364006401],[-97.93023739243924,39.65351012771278],[-97.3696799219922,39.65351012771278],[-97.3696799219922,40.00130661536154],[-95.34127093099309,39.99882235473548],[-95.34127093099309,39.65351012771278],[-95.56664970777078,39.65351012771278],[-95.57242865076508,39.41998962886289],[-95.17946052715271,39.41998962886289],[-95.18523947014701,39.04486627432743],[-95.50308133483348,39.05480331683169],[-95.52041816381637,38.03874072077208],[-95.95961783138313,38.041224981398145],[-95.95961783138313,38.1704065339534]]]}},{"type":"Feature","id":540,"properties":{"name":"dma:","latitude":45.119199,"dma":540,"dma1":"Traverse City-Cadillac, MI","longitude":-84.9520115},"geometry":{"type":"MultiPolygon","coordinates":[[[[-85.86380442034203,46.69142048134814],[-85.52284678367838,46.6740306569657],[-84.95651037023703,46.770916821382144],[-85.02585768616862,46.69638900260027],[-85.0316366291629,46.487711110011006],[-84.63288956255624,46.485226849384944],[-84.58087907560756,46.41318329122913],[-84.30348981188118,46.487711110011006],[-84.22258460996099,46.291454520552065],[-84.1821320090009,46.249222089909],[-84.25147932493249,46.17469427112712],[-84.02610054815482,46.132461840484055],[-84.0723320921092,46.09271367046705],[-83.90474274527452,45.96601637853786],[-84.53464753165316,45.96850063916392],[-84.65600533453346,46.05296550045005],[-84.74846842244224,45.83931908660867],[-85.00852085718572,46.00824880918093],[-85.42460475277528,46.102650712971304],[-85.65576247254725,45.96601637853786],[-85.86380442034203,45.96850063916392],[-85.86380442034203,46.69142048134814]]],[[[-84.1243425790579,46.31878138743875],[-84.28615298289829,46.472805546254634],[-84.21680566696669,46.5349120619062],[-84.11856363606361,46.515037976897695],[-84.19368989498949,46.4280888549855],[-84.1243425790579,46.31878138743875]]],[[[-84.34394241284127,46.49267963126313],[-84.37283712781277,46.500132413141316],[-84.37861607080708,46.500132413141316],[-84.34394241284127,46.50261667376738],[-84.33238452685268,46.497648152515254],[-84.34394241284127,46.49267963126313]]],[[[-84.1532372940294,46.214442441144115],[-84.1532372940294,46.229348004900494],[-84.2110267239724,46.286485999299934],[-84.2110267239724,46.32374990869087],[-84.1012268070807,46.25419061116112],[-84.1532372940294,46.214442441144115]]],[[[-83.55222722262226,45.91384690539054],[-83.62735348154816,45.95856359665967],[-83.88162697329733,45.973469160416045],[-83.63313242454245,46.105134973597366],[-83.47132202070208,45.988374724172424],[-83.55222722262226,45.91384690539054]]],[[[-84.61555273357335,45.846771868486854],[-84.65022639153915,45.859193171617164],[-84.64444744854485,45.88403577787779],[-84.60977379057906,45.861677432243226],[-84.61555273357335,45.846771868486854]]],[[[-85.49395206870688,45.77224404970498],[-85.53440466966697,45.79957091659166],[-85.52862572667266,45.82938204410442],[-85.45349946774678,45.79460239533954],[-85.49395206870688,45.77224404970498]]],[[[-84.41906867176718,45.720074576557664],[-84.49997387368737,45.7374644009401],[-84.58665801860187,45.8169607409741],[-84.35550029882988,45.77224404970498],[-84.41906867176718,45.720074576557664]]],[[[-85.37837320882088,45.76975978907892],[-85.40148898079808,45.777212570957104],[-85.36103637983798,45.8169607409741],[-85.33792060786078,45.79460239533954],[-85.37837320882088,45.76975978907892]]],[[[-83.88162697329733,45.20086410571058],[-83.88740591629163,44.50775539103911],[-84.36705818481849,44.50775539103911],[-84.36705818481849,44.15995890339035],[-84.60977379057906,44.15995890339035],[-84.60399484758476,43.814646676367644],[-85.0894260591059,43.814646676367644],[-85.0836471161116,43.46685018871888],[-85.56329938463847,43.46933444934494],[-85.56329938463847,43.814646676367644],[-86.43014083378338,43.81961519761977],[-86.51682497869787,44.05810421772178],[-86.26833042994299,44.34627845034504],[-86.25677254395438,44.69159067736774],[-86.08918319711971,44.741275889888996],[-86.0660674251425,44.90772135183519],[-85.81179393339335,44.94746952185219],[-85.55174149864986,45.21080114821483],[-85.64998352955296,44.86300466056606],[-85.59797304260425,44.766118496149616],[-85.47661523972397,44.992186213121315],[-85.57485727062706,44.76114997489749],[-85.52862572667266,44.74872867176718],[-85.38993109480947,44.94746952185219],[-85.36681532283228,45.27539192449245],[-84.91605776927693,45.392152173917395],[-85.1183207740774,45.54120781148116],[-84.94495248424843,45.71013753405341],[-85.01429980018001,45.762307007200725],[-84.73113159345934,45.78714961346135],[-84.47685810171018,45.65548380028004],[-84.21680566696669,45.63560971527153],[-84.07811103510352,45.48655407770778],[-83.48865884968497,45.35985678577858],[-83.39041681878187,45.208316887588765],[-83.88162697329733,45.20086410571058]]],[[[-85.56329938463847,45.5710189389939],[-85.63264670057006,45.5983458058806],[-85.60953092859285,45.67287362466247],[-85.56907832763275,45.75982274657466],[-85.49973101170116,45.75485422532254],[-85.48817312571256,45.608282848384846],[-85.56329938463847,45.5710189389939]]],[[[-85.69043613051305,45.69523197029703],[-85.70199401650166,45.7374644009401],[-85.69043613051305,45.747401443444346],[-85.63842564356435,45.74243292219222],[-85.69043613051305,45.69523197029703]]],[[[-86.00249905220522,45.05429272877288],[-86.06028848214821,45.10397794129413],[-86.04873059615961,45.15863167506751],[-85.97938328022802,45.138757590059015],[-86.00249905220522,45.05429272877288]]],[[[-86.1354147410741,44.99715473437344],[-86.14119368406841,45.04187142564257],[-86.11807791209121,45.049324207520755],[-86.0776253111311,45.02945012251226],[-86.1354147410741,44.99715473437344]]]]}},{"type":"Feature","id":531,"properties":{"name":"dma:","latitude":36.732483,"dma":531,"dma1":"Tri-Cities, TN-VA","longitude":-82.468517},"geometry":{"type":"MultiPolygon","coordinates":[[[[-81.37934465676568,36.95311882718272],[-81.26376579687968,36.764315019601966],[-81.54115506060606,36.7022085039504],[-81.67984969246925,36.58793251515152],[-81.70874440744075,36.334537931293134],[-81.85321798229822,36.337022191919196],[-82.07859675907591,36.10350169306931],[-82.21151244794478,36.15815542684268],[-82.35598602280228,36.11592299619962],[-82.55824902760276,35.95444605550556],[-82.63337528652866,36.06623778367837],[-82.80674357635763,35.92711918861886],[-82.89920666426642,35.9445090130013],[-83.1708169849985,36.15567116621662],[-83.08413284008401,36.24510454875488],[-83.1534801560156,36.34199071317132],[-83.27483795889589,36.319632367536755],[-83.28061690189018,36.394160186318636],[-83.1245854410441,36.51092043574358],[-82.82985934833482,36.592901036403646],[-83.67358502550255,36.60035381828183],[-83.1361433270327,36.7419566739674],[-83.07257495409542,36.85374840214021],[-82.87609089228923,36.888528050905094],[-82.85297512031204,36.95560308780878],[-82.93965926522652,37.015225342834285],[-83.1534801560156,36.95560308780878],[-83.05523812511251,37.01770960346035],[-83.04945918211821,37.16924950165017],[-82.81830146234623,37.26861992669267],[-82.56402797059707,37.19657636853685],[-82.35598602280228,37.26613566606661],[-81.96879684218422,37.53692007430743],[-81.92834424122412,37.36053756985699],[-81.74341806540653,37.25371436293629],[-81.89944952625262,37.13943837413741],[-81.77809172337234,36.958087348434844],[-81.47180774467446,37.01770960346035],[-81.37934465676568,36.95311882718272]]],[[[-83.20549064296429,37.17670228352836],[-83.1650380420042,37.0673948159816],[-83.40775364776476,36.891012311531156],[-83.51177462166217,36.93821326342635],[-83.55222722262226,37.16676524102411],[-83.39619576177617,37.32078939983999],[-83.20549064296429,37.17670228352836]]]]}},{"type":"Feature","id":789,"properties":{"name":"dma:","latitude":31.923023,"dma":789,"dma1":"Tucson (Sierra Vista), AZ","longitude":-111.1907555},"geometry":{"type":"Polygon","coordinates":[[[-109.04892371347134,32.42679596649665],[-109.04892371347134,31.333721291029104],[-111.07733270447045,31.33123703040304],[-113.33112047224722,32.039251308830885],[-113.33112047224722,32.50380804590459],[-110.4532068610861,32.51374508840884],[-110.4532068610861,32.42679596649665],[-109.04892371347134,32.42679596649665]]]}},{"type":"Feature","id":671,"properties":{"name":"dma:","latitude":35.9900205,"dma":671,"dma1":"Tulsa, OK","longitude":-95.7685615},"geometry":{"type":"Polygon","coordinates":[[[-95.51463922082208,34.68002035433543],[-95.51463922082208,34.59307123242324],[-95.74579694059406,34.59307123242324],[-95.88449157245725,34.59307123242324],[-95.88449157245725,34.68002035433543],[-96.09253352025202,34.68002035433543],[-96.08675457725772,35.05017518761876],[-95.98273360336033,35.15202987328733],[-95.98273360336033,35.28866420772077],[-96.43927009990999,35.29114846834683],[-96.43927009990999,35.467530972797285],[-96.62419627572757,35.40045593589359],[-96.62419627572757,36.16063968746875],[-96.82068033753376,36.15815542684268],[-96.82068033753376,36.24758880938094],[-97.03450122832282,36.334537931293134],[-97.03450122832282,36.50595191449145],[-96.89002765346534,36.575511212021205],[-97.05761700030003,36.592901036403646],[-97.06339594329432,36.6823344189419],[-96.75133302160216,36.7817048439844],[-96.75133302160216,36.99783551845185],[-96.52595424482448,36.99783551845185],[-96.52595424482448,37.30339957545755],[-95.96539677437744,37.29843105420542],[-95.96539677437744,37.385380176117614],[-95.52041816381637,37.38289591549155],[-95.52041816381637,37.00031977907791],[-95.00609223732373,37.00031977907791],[-95.00031329432943,36.66991311581158],[-94.61890305670568,36.66742885518552],[-94.47442948184818,35.6389449559956],[-95.12745004020402,35.6389449559956],[-95.08699743924393,35.46256245154515],[-94.81538711851185,35.32344385648565],[-94.81538711851185,35.20171508580859],[-94.92518703540354,35.20171508580859],[-94.92518703540354,34.94335198069807],[-95.05810272427243,34.85391859815982],[-95.05810272427243,34.68002035433543],[-95.51463922082208,34.68002035433543]]]}},{"type":"Feature","id":760,"properties":{"name":"dma:","latitude":42.994495,"dma":760,"dma1":"Twin Falls, ID","longitude":-114.043651},"geometry":{"type":"Polygon","coordinates":[[[-113.00172072157216,41.99865215871587],[-115.03590865556555,41.99616789808981],[-115.08791914251425,43.19855004110411],[-114.37710915421542,43.19855004110411],[-114.39444598319832,43.3252473330333],[-114.5331406150615,43.332700114911496],[-114.5158037860786,43.4916927949795],[-114.6833931329133,43.59106322002201],[-114.70072996189619,43.80470963386339],[-114.97234028262827,43.84942632513252],[-114.97234028262827,43.93885970767077],[-114.81630882178217,43.99351344144415],[-114.81630882178217,43.928922665166525],[-114.562035330033,43.84445780388039],[-114.4869090711071,43.90408005890589],[-114.29042500930093,43.886690234523456],[-114.10549883348335,43.742603118211825],[-114.00147785958596,43.76496146384639],[-113.80499379777977,43.571189135013505],[-113.70097282388238,43.58361043814382],[-113.59117290699069,43.46685018871888],[-113.6374044509451,43.36747976367637],[-113.36001518721872,43.36747976367637],[-113.36001518721872,43.28549916301631],[-113.00749966456645,43.28549916301631],[-113.00749966456645,43.11160091919193],[-113.24443632733274,43.11160091919193],[-113.24443632733274,42.848269292829286],[-113.23865738433844,42.761320170917095],[-113.18086795439544,42.761320170917095],[-113.23865738433844,42.62468583648365],[-113.00172072157216,42.58742192709271],[-113.00172072157216,41.99865215871587]]]}},{"type":"Feature","id":709,"properties":{"name":"dma:","latitude":32.1070105,"dma":709,"dma1":"Tyler-Longview(Lufkin & Nacogdoches), TX","longitude":-94.8806935},"geometry":{"type":"Polygon","coordinates":[[[-94.84428183348335,31.147401744074408],[-95.2025762991299,30.82444786268627],[-95.24880784308431,30.906428463346337],[-95.39906036093609,30.859227511451145],[-95.43373401890189,31.057968361536155],[-95.63599702370237,30.926302548354837],[-95.68222856765676,30.98592480338034],[-95.63021808070806,31.05051557965797],[-95.77469165556556,31.12007487718772],[-95.65333385268526,31.323784248524852],[-95.74001799759975,31.502651013601362],[-95.65333385268526,31.542399183618365],[-95.2719236150615,31.592084396139615],[-95.2603657290729,31.609474220522053],[-95.44529190489048,31.842994719371937],[-95.44529190489048,32.352268147714774],[-95.59554442274228,32.478965439643964],[-95.66489173867387,32.96091200110011],[-95.30659727302731,32.963396261726174],[-95.300818330033,33.38323630753075],[-95.12745004020402,33.390689089408944],[-95.15056581218121,32.90128974607461],[-94.72292403060305,32.90377400670067],[-94.67091354365436,32.836698969796984],[-94.69980825862586,32.421827445244524],[-94.49176631083108,32.394500578357835],[-94.60156622772277,31.972176271927193],[-94.50910313981399,31.97466053255326],[-94.39930322292228,31.656675172417245],[-93.98321932733273,31.569726050505054],[-94.04100875727573,31.12007487718772],[-94.56111362676268,31.057968361536155],[-94.84428183348335,31.147401744074408]]]}},{"type":"Feature","id":526,"properties":{"name":"dma:","latitude":43.205527,"dma":526,"dma1":"Utica, NY","longitude":-75.026249},"geometry":{"type":"Polygon","coordinates":[[[-75.41547548664866,42.31415325822583],[-75.40391760066007,42.50792558705871],[-75.24210719681969,42.833363729072914],[-75.42125442964297,43.17370743484349],[-75.29989662676267,43.2258769079908],[-75.38658077167716,43.302888987398745],[-75.21899142484249,43.40225941244125],[-75.22477036783678,43.56125209250926],[-75.10919150795078,43.61590582628263],[-75.1727598808881,44.09785238773878],[-74.85491801620162,44.07052552085209],[-74.77401281428143,43.486724273727376],[-74.86647590219022,43.34015289678968],[-74.71044444134412,43.28549916301631],[-74.76245492829283,42.86317485658566],[-74.64687606840684,42.82839520782079],[-74.62953923942393,42.62717009710971],[-74.71044444134412,42.517862629562956],[-75.41547548664866,42.31415325822583]]]}},{"type":"Feature","id":626,"properties":{"name":"dma:","latitude":28.805652,"dma":626,"dma1":"Victoria, TX","longitude":-96.973793},"geometry":{"type":"Polygon","coordinates":[[[-96.89002765346534,28.506632698569856],[-97.16163797419742,28.551349389838983],[-97.16163797419742,28.782385628062805],[-97.20209057515751,28.854429186218624],[-97.3061115490549,28.846976404340435],[-96.97671179837984,29.10285524882488],[-96.83223822352235,29.020874648164817],[-96.64153310471048,28.71779485178518],[-96.93048025442545,28.58612903860386],[-96.89002765346534,28.506632698569856]]]}},{"type":"Feature","id":625,"properties":{"name":"dma:","latitude":31.0795205,"dma":625,"dma1":"Waco-Temple-Bryan, TX","longitude":-97.3521605},"geometry":{"type":"Polygon","coordinates":[[[-95.65333385268526,31.323784248524852],[-95.77469165556556,31.12007487718772],[-95.63021808070806,31.05051557965797],[-95.68222856765676,30.98592480338034],[-95.61288125172517,30.918849766476647],[-96.16765977917791,30.821963602060208],[-96.19077555115511,30.59838014571457],[-96.08097563426342,30.43193468376838],[-96.15610189318932,30.330079998099812],[-96.19655449414941,30.3971550350035],[-96.67620676267626,30.295300349334934],[-96.96515391239123,30.556147715071507],[-97.15585903120312,30.456777290029002],[-97.2714378910891,30.735014480148017],[-97.82621641854185,30.91139698459846],[-97.91290056345635,31.03561001590159],[-98.43878437593759,31.030641494649466],[-98.4445633189319,30.92133402710271],[-99.09180493429344,30.92133402710271],[-99.09180493429344,31.460418582958297],[-98.77974201260126,31.609474220522053],[-98.76240518361836,31.688970560556058],[-98.49079486288629,31.723750209320933],[-98.27119502910291,31.41570189168917],[-97.68752178667867,31.71132890619062],[-97.60661658475847,31.587115874887488],[-97.03450122832282,31.86286880438044],[-96.93048025442545,31.708844645564557],[-96.71665936363635,31.815667852485248],[-96.49705952985298,31.79579376747675],[-96.2370070951095,31.413217631063105],[-95.74001799759975,31.65419091179118],[-95.74001799759975,31.505135274227424],[-95.65333385268526,31.323784248524852]]]}},{"type":"Feature","id":511,"properties":{"name":"dma:","latitude":39.127683,"dma":511,"dma1":"Washington, DC (Hagerstown, MD)","longitude":-77.904362},"geometry":{"type":"MultiPolygon","coordinates":[[[[-76.87754806420642,38.125689842684274],[-77.0278005820582,38.0909101939194],[-77.062474240024,38.16046949144915],[-77.33986350375037,38.252387134613464],[-77.65770536843684,37.99153976887689],[-77.95243146114612,38.11823706080608],[-77.70971585538554,38.366663123412344],[-77.89464203120312,38.38902146904691],[-78.1026839789979,38.312009389638966],[-78.1200208079808,38.441190942194225],[-78.33962064176418,38.62751048914892],[-78.48409421662166,38.42131685718572],[-78.54766258955895,38.426285378437846],[-78.69213616441644,38.510750239723976],[-78.64012567746775,38.60515214351435],[-78.99264120012,38.851093945494554],[-79.0562095730573,38.7616605629563],[-79.35671460876088,38.965369934293435],[-79.30470412181218,39.20882747564757],[-79.46651452565257,39.179016348134816],[-79.48963029762976,39.206343215021505],[-79.11399900300029,39.4324109319932],[-78.92907282718272,39.72306942524253],[-78.38007324272428,39.72306942524253],[-78.1315786939694,40.16526781668167],[-77.85996837323732,40.060928870387045],[-77.66926325442543,40.289480847984805],[-77.45544236363637,39.971495487848784],[-77.46122130663066,39.720585164616466],[-77.21850570087008,39.720585164616466],[-77.31096878877888,39.6386045639564],[-77.1087057839784,39.492033187018706],[-77.1664952139214,39.3131664219422],[-76.69840083138314,38.98275975867587],[-76.69840083138314,38.749239259825984],[-76.53081148454845,38.71197535043505],[-76.50769571257126,38.510750239723976],[-76.38055896669667,38.384052947794785],[-76.42101156765676,38.31946217151715],[-76.48457994059406,38.32939921402141],[-76.48457994059406,38.44367520282029],[-76.50769571257126,38.38902146904691],[-76.64639034443445,38.46851780908091],[-76.66950611641164,38.61757344664467],[-76.70417977437744,38.498328936593666],[-76.51347465556555,38.32443069276928],[-76.37478002370237,38.29710382588259],[-76.32276953675367,38.03625646014602],[-76.41523262466247,38.10581575767577],[-76.43256945364536,38.12072132143214],[-76.44412733963395,38.1505324489449],[-76.40367473867386,38.16046949144915],[-76.40945368166817,38.17289079457946],[-76.44990628262826,38.212638964596465],[-76.46146416861686,38.128174103310336],[-76.50769571257126,38.1704065339534],[-76.53081148454845,38.13314262456246],[-76.55392725652565,38.2101547039704],[-76.68684294539455,38.23251304960496],[-76.62905351545155,38.25983991649165],[-76.62905351545155,38.28468252275228],[-76.72151660336033,38.23251304960496],[-76.69840083138314,38.28468252275228],[-76.72151660336033,38.312009389638966],[-76.77930603330333,38.22754452835284],[-76.80242180528052,38.35921034153416],[-76.91800066516652,38.39398999029903],[-76.83131652025202,38.27474548024803],[-77.01624269606961,38.35921034153416],[-77.0740321260126,38.30704086838684],[-76.96423220912091,38.25735565586559],[-77.0104637530753,38.20021766146615],[-76.76774814731473,38.167922273327335],[-76.73307448934892,38.098362975797585],[-76.69840083138314,38.16046949144915],[-76.65216928742873,38.09587871517152],[-76.64639034443445,38.14804818831884],[-76.61171668646864,38.14804818831884],[-76.51925359855986,38.04370924202421],[-76.64061140144014,37.96669716261626],[-76.87754806420642,38.125689842684274]]],[[[-76.84287440624063,38.254871395239526],[-76.84865334923492,38.25735565586559],[-76.86599017821783,38.269776958995905],[-76.84287440624063,38.26480843774378],[-76.84287440624063,38.254871395239526]]],[[[-76.47302205460545,38.10333149704971],[-76.47880099759976,38.11575280018002],[-76.49613782658265,38.13314262456246],[-76.49613782658265,38.13562688518852],[-76.47302205460545,38.11823706080608],[-76.47302205460545,38.10333149704971]]]]}},{"type":"Feature","id":549,"properties":{"name":"dma:","latitude":44.217164,"dma":549,"dma1":"Watertown, NY","longitude":-75.4894475},"geometry":{"type":"MultiPolygon","coordinates":[[[[-74.64109712541254,44.952438043104316],[-74.53707615151515,44.100336648364845],[-75.0629599639964,44.05065143584359],[-75.1727598808881,44.09785238773878],[-75.10919150795078,43.61590582628263],[-75.53105434653466,43.41964923682369],[-75.75643312331232,43.46933444934494],[-75.77376995229523,43.68794938443845],[-76.20141173387339,43.68049660256026],[-76.29965376477648,43.856879107010705],[-76.21296961986198,43.90159579827983],[-76.20719067686768,43.84942632513252],[-76.06849604500451,43.968670835183524],[-76.20719067686768,43.97612361706171],[-76.1262854749475,44.0630727389739],[-76.27653799279928,44.05313569646965],[-76.20141173387339,44.025808829582964],[-76.27653799279928,43.96121805330533],[-76.29387482178217,44.05810421772178],[-76.36322213771376,44.112757951495155],[-75.86623304020401,44.35124697159716],[-75.73909629432943,44.535082257925794],[-75.41547548664866,44.77357127802781],[-74.97049687608761,44.98224917061707],[-74.80290752925292,45.01454455875588],[-74.64109712541254,44.952438043104316]],[[-76.0627171020102,44.251876546554655],[-76.0511592160216,44.256845067806786],[-76.0511592160216,44.25932932843285],[-76.06849604500451,44.251876546554655],[-76.0627171020102,44.251876546554655]],[[-76.0800539309931,44.24442376467647],[-76.07427498799879,44.24690802530253],[-76.0800539309931,44.24690802530253],[-76.0800539309931,44.24442376467647]]],[[[-76.0280434440444,44.284171934693475],[-76.0569381590159,44.32640436533654],[-75.91824352715271,44.368636795979604],[-75.94135929912991,44.32640436533654],[-76.0280434440444,44.284171934693475]]],[[[-76.13206441794179,44.24939228592859],[-76.1494012469247,44.28665619531954],[-76.07427498799879,44.311498801580164],[-76.0800539309931,44.27423489218923],[-76.13206441794179,44.24939228592859]]],[[[-76.0569381590159,44.284171934693475],[-76.0511592160216,44.29162471657166],[-76.04538027302729,44.296593237823785],[-76.04538027302729,44.2891404559456],[-76.0569381590159,44.284171934693475]]],[[[-76.30543270777078,44.16741168526853],[-76.31121165076507,44.169895945894595],[-76.31121165076507,44.17983298839884],[-76.29387482178217,44.18977003090309],[-76.26498010681068,44.17983298839884],[-76.30543270777078,44.16741168526853]]],[[[-76.37478002370237,44.03326161146115],[-76.36900108070807,44.05065143584359],[-76.34010636573657,44.05313569646965],[-76.35166425172517,44.03823013271328],[-76.37478002370237,44.03326161146115]]],[[[-76.32276953675367,44.03077735083509],[-76.34010636573657,44.03326161146115],[-76.32854847974798,44.043198653965405],[-76.31699059375937,44.05065143584359],[-76.32276953675367,44.03077735083509]]],[[[-76.44412733963395,43.886690234523456],[-76.40945368166817,43.91898562266227],[-76.37478002370237,43.92146988328834],[-76.40367473867386,43.90159579827983],[-76.44412733963395,43.886690234523456]]],[[[-76.35744319471948,43.87923745264527],[-76.34588530873087,43.89414301640164],[-76.31699059375937,43.90408005890589],[-76.31121165076507,43.914017101410145],[-76.29965376477648,43.91898562266227],[-76.32854847974798,43.88172171327133],[-76.35744319471948,43.87923745264527]]]]}},{"type":"Feature","id":705,"properties":{"name":"dma:","latitude":44.9711405,"dma":705,"dma1":"Wausau-Rhinelander, WI","longitude":-89.6752625},"geometry":{"type":"Polygon","coordinates":[[[-89.59700159465946,43.98109213831384],[-89.60278053765376,43.643232693169324],[-89.78770671347135,43.643232693169324],[-90.02464337623762,44.068041260226025],[-89.90328557335732,44.24939228592859],[-90.31936946894689,44.24939228592859],[-90.31359052595259,45.03441864376438],[-90.92615848334833,45.03193438313832],[-90.92615848334833,45.379730870787085],[-90.67766393459345,45.37724661016102],[-90.67766393459345,45.98092194229423],[-89.92640134533454,45.98092194229423],[-89.92640134533454,46.29890730243025],[-88.68392860156015,46.01321733043305],[-88.67814965856586,45.722558837183726],[-88.42387616681668,45.722558837183726],[-88.42965510981098,45.37724661016102],[-88.67814965856586,45.379730870787085],[-88.64347600060006,45.11639924442444],[-88.98443363726372,45.118883505050505],[-88.98443363726372,45.02945012251226],[-89.22137030003,45.02945012251226],[-89.2271492430243,44.24442376467647],[-89.59700159465946,44.24690802530253],[-89.59700159465946,43.98109213831384]]]}},{"type":"Feature","id":548,"properties":{"name":"dma:","latitude":27.096694,"dma":548,"dma1":"West Palm Beach-Ft. Pierce, FL","longitude":-80.6271745},"geometry":{"type":"MultiPolygon","coordinates":[[[[-80.31024020282028,27.485601581258127],[-80.36225068976898,27.669436867586757],[-80.44893483468346,27.86072493579358],[-80.38536646174617,27.741480425742573],[-80.28712443084308,27.473180278127813],[-80.31024020282028,27.485601581258127]]],[[[-80.87079767326733,27.14774213611361],[-81.211755309931,27.52783401190119],[-81.1424079939994,27.64211000070007],[-80.87079767326733,27.64211000070007],[-80.88235555925593,27.82346102640264],[-80.48938743564356,27.85327215391539],[-80.39114540474047,27.684342431343133],[-80.31601914581458,27.428463586858687],[-80.18888239993998,27.1750690030003],[-80.21199817191719,27.214817173017302],[-80.32179808880888,27.23965977927793],[-80.25822971587158,27.1551949179918],[-80.21777711491148,27.20488013051305],[-80.1946613429343,27.180037524252427],[-80.2004402859286,27.172584742374237],[-80.2004402859286,27.1750690030003],[-80.2004402859286,27.172584742374237],[-80.20621922892289,27.172584742374237],[-80.1946613429343,27.165131960496048],[-80.1946613429343,27.162647699869986],[-80.2004402859286,27.152710657365738],[-80.1946613429343,27.145257875487548],[-80.15998768496848,27.162647699869986],[-80.0501877680768,26.864536424742475],[-80.07330354005401,26.33538891139114],[-80.88235555925593,26.332904650765077],[-80.87079767326733,27.14774213611361]]],[[[-80.41426117671767,27.753901728872886],[-80.42004011971197,27.753901728872886],[-80.42004011971197,27.761354510751076],[-80.41426117671767,27.761354510751076],[-80.41426117671767,27.753901728872886]]],[[[-80.39692434773477,27.724090601360135],[-80.41426117671767,27.73899616511651],[-80.41426117671767,27.75638598949895],[-80.39692434773477,27.734027643864387],[-80.39692434773477,27.724090601360135]]],[[[-80.39114540474047,27.711669298229822],[-80.39692434773477,27.71912208010801],[-80.39114540474047,27.721606340734073],[-80.39114540474047,27.71663781948195],[-80.39114540474047,27.711669298229822]]],[[[-80.1542087419742,27.170100481748175],[-80.25822971587158,27.34896724682468],[-80.29290337383739,27.4607589749975],[-80.31601914581458,27.4607589749975],[-80.29868231683167,27.47069601750175],[-80.28712443084308,27.47069601750175],[-80.1542087419742,27.170100481748175]]],[[[-80.04440882508251,26.561456628362837],[-80.04440882508251,26.56642514961496],[-80.0386298820882,26.56642514961496],[-80.04440882508251,26.561456628362837]]]]}},{"type":"Feature","id":554,"properties":{"name":"dma:","latitude":39.96655,"dma":554,"dma1":"Wheeling, WV-Steubenville, OH","longitude":-81.0435735},"geometry":{"type":"Polygon","coordinates":[[[-81.69718652145215,39.75536481338134],[-81.66829180648065,40.22240581108111],[-81.33889205580559,40.214953029202924],[-81.269544739874,40.43356796429643],[-80.94014498919893,40.42363092179218],[-80.85923978727872,40.600013426242626],[-80.51828215061505,40.63976159625963],[-80.51828215061505,39.720585164616466],[-80.40848223372336,39.718100903990404],[-80.39114540474047,39.64357308520852],[-80.49516637863786,39.576498048304835],[-80.51828215061505,39.434895192619265],[-80.71476621242124,39.42992667136714],[-80.88813450225022,39.293292336933696],[-80.90547133123312,39.377757198219825],[-81.00949230513052,39.34546181008101],[-81.0268291341134,39.46719058075808],[-81.11929222202221,39.45725353825383],[-81.03838702010201,39.57152952705271],[-81.45447091569156,39.646057345834585],[-81.47180774467446,39.58395083018302],[-81.58738660456046,39.58643509080908],[-81.63939709150915,39.75288055275528],[-81.69718652145215,39.75536481338134]]]}},{"type":"Feature","id":627,"properties":{"name":"dma:","latitude":33.9059285,"dma":627,"dma1":"Wichita Falls, TX-Lawton, OK","longitude":-99.039775},"geometry":{"type":"Polygon","coordinates":[[[-100.51920385388539,33.83537174147415],[-100.05110947134713,33.83537174147415],[-99.99909898439844,34.56077584428443],[-99.66392029072907,34.50612211051105],[-99.66969923372338,34.72473704560456],[-99.4212046849685,34.72473704560456],[-99.4038678559856,34.814170428142816],[-99.18426802220222,34.858887119411946],[-99.16115225022502,34.709831481848184],[-99.03979444734473,34.68995739683969],[-99.10336282028203,34.63778792369237],[-98.82597355655565,34.59307123242324],[-98.82597355655565,34.856402858785884],[-98.09204779627963,34.85391859815982],[-98.08626885328533,34.68002035433543],[-97.56038504080408,34.68002035433543],[-97.56038504080408,33.899962517751774],[-97.67018495769577,33.9918801609161],[-97.83199536153614,33.85773008710871],[-97.97646893639364,33.890025475247526],[-97.97646893639364,33.46770116881689],[-98.4214475469547,33.46770116881689],[-98.42722648994899,32.953459219221926],[-99.47321517191719,32.95594347984799],[-99.47321517191719,33.39814187128713],[-100.51920385388539,33.39814187128713],[-100.51920385388539,33.83537174147415]]]}},{"type":"Feature","id":678,"properties":{"name":"dma:","latitude":38.672948,"dma":678,"dma1":"Wichita-Hutchinson, KS Plus","longitude":-99.005353},"geometry":{"type":"Polygon","coordinates":[[[-95.96539677437744,37.29843105420542],[-96.52595424482448,37.30339957545755],[-96.52595424482448,36.99783551845185],[-101.55363464986499,36.99535125782579],[-101.55941359285929,37.387864436743676],[-102.03906586138613,37.39034869736974],[-102.05062374737474,40.34910310301031],[-101.322476930093,40.35158736363637],[-101.322476930093,40.003790875987605],[-99.62346768976897,40.00130661536154],[-99.62924663276327,39.56656100580058],[-97.93023739243924,39.56656100580058],[-97.93023739243924,39.30571364006401],[-97.3696799219922,39.30571364006401],[-97.3696799219922,39.13181539623963],[-96.96515391239123,39.13181539623963],[-96.89002765346534,38.87096803050305],[-96.93048025442545,38.523171542854286],[-96.3525859549955,38.520687282228224],[-96.3583648979898,38.17289079457946],[-95.95961783138313,38.1704065339534],[-95.95961783138313,37.387864436743676],[-95.96539677437744,37.29843105420542]]]}},{"type":"Feature","id":577,"properties":{"name":"dma:","latitude":41.2488125,"dma":577,"dma1":"Wilkes Barre-Scranton, PA","longitude":-76.530153},"geometry":{"type":"Polygon","coordinates":[[[-77.9871051191119,41.47447316661666],[-76.87754806420642,41.591233416041604],[-76.92955855115511,42.00113641934194],[-75.35768605670566,41.99865215871587],[-75.25944402580258,41.86201782428243],[-75.074517849985,41.81481687238724],[-75.0456231350135,41.61607602230224],[-75.26522296879688,41.37510274157416],[-75.35190711371138,41.367649959695974],[-75.35768605670566,41.238468407140715],[-75.12652833693369,41.253373970897094],[-75.15542305190519,41.14903502460247],[-74.96471793309331,41.09438129082909],[-75.28833874077407,40.86334505260527],[-75.68708580738074,40.77391167006701],[-75.9933697860786,40.63976159625963],[-76.0164855580558,40.572686559355944],[-76.43834839663967,40.495674479948],[-76.70417977437744,40.657151420642066],[-76.91800066516652,40.60249768686869],[-77.0393584680468,40.67950976627663],[-77.35720033273327,40.701868111911196],[-77.36297927572757,40.84843948884889],[-77.14337944194419,41.04469607830784],[-77.50745285058505,40.96271547764777],[-77.57102122352235,41.067054423942395],[-77.89464203120312,41.17636189148915],[-77.90042097419742,41.253373970897094],[-78.0391156060606,41.15400354585459],[-78.09112609300931,41.21611006150616],[-77.9871051191119,41.47447316661666]]]}},{"type":"Feature","id":550,"properties":{"name":"dma:","latitude":34.3480385,"dma":550,"dma1":"Wilmington, NC","longitude":-78.294559},"geometry":{"type":"MultiPolygon","coordinates":[[[[-79.0735464020402,34.299928478547855],[-78.84238868226822,34.50860637113712],[-78.80771502430242,34.68995739683969],[-78.90017811221122,34.83404451315132],[-78.49565210261025,34.856402858785884],[-78.25293649684968,34.55332306240624],[-78.1142418649865,34.7222527849785],[-77.68082114041404,34.71976852435244],[-77.53634756555655,34.4564368979898],[-77.67504219741974,34.36451925482548],[-77.73283162736274,34.31234978167817],[-77.82529471527153,34.20552657475748],[-77.88308414521453,34.098703367836784],[-77.89464203120312,34.03659685218522],[-77.88308414521453,34.07634502220222],[-77.87152625922593,34.07634502220222],[-77.93509463216321,33.92977364526453],[-77.92931568916892,34.02417554905491],[-78.02177877707771,33.917352342134215],[-78.21826283888389,33.95213199089909],[-78.57655730453045,33.88008843274328],[-79.0735464020402,34.299928478547855]]],[[[-77.51901073657365,34.441531334233424],[-77.64614748244824,34.34961369106911],[-77.65192642544254,34.34712943044305],[-77.58835805250524,34.414204467346735],[-77.51901073657365,34.441531334233424]]],[[[-77.70971585538554,34.29744421792179],[-77.69815796939693,34.344645169816985],[-77.65770536843684,34.34712943044305],[-77.68082114041404,34.33222386668667],[-77.70971585538554,34.29744421792179]]],[[[-77.72705268436843,34.29495995729573],[-77.73283162736274,34.30489699979998],[-77.71549479837984,34.32228682418242],[-77.70971585538554,34.30738126042604],[-77.72705268436843,34.29495995729573]]],[[[-77.76750528532853,34.25272752665266],[-77.75594739933993,34.257696047904794],[-77.75016845634563,34.26266456915692],[-77.74438951335134,34.29495995729573],[-77.71549479837984,34.29247569666967],[-77.76172634233423,34.24527474477448],[-77.76750528532853,34.25272752665266]]],[[[-77.76750528532853,34.25272752665266],[-77.77328422832284,34.24527474477448],[-77.77906317131712,34.24775900540054],[-77.75594739933993,34.26514882978298],[-77.76750528532853,34.25272752665266]]],[[[-77.81373682928293,34.185652489748975],[-77.79062105730573,34.217947877887795],[-77.80795788628862,34.22043213851386],[-77.76750528532853,34.24527474477448],[-77.81373682928293,34.185652489748975]]],[[[-77.80217894329434,34.20552657475748],[-77.81373682928293,34.215463617261726],[-77.81373682928293,34.217947877887795],[-77.79640000030003,34.217947877887795],[-77.80217894329434,34.20552657475748]]],[[[-77.88308414521453,34.07882928282828],[-77.85996837323732,34.143420059105914],[-77.81373682928293,34.18068396849685],[-77.87152625922593,34.07882928282828],[-77.88308414521453,34.07882928282828]]],[[[-78.0159998340834,33.887541214621464],[-78.1200208079808,33.90989956025603],[-78.23559966786678,33.91238382088209],[-78.23559966786678,33.917352342134215],[-78.0564524350435,33.91983660276028],[-78.0159998340834,33.887541214621464]]],[[[-78.36851535673567,33.899962517751774],[-78.38007324272428,33.9049310390039],[-78.23559966786678,33.91983660276028],[-78.23559966786678,33.90741529962997],[-78.36851535673567,33.899962517751774]]],[[[-77.9582104041404,33.84034026272627],[-78.0102208910891,33.86766712961296],[-77.96976829012901,33.877604172117216],[-77.94665251815181,33.917352342134215],[-77.9582104041404,33.84034026272627]]],[[[-78.47253633063306,33.875119911491154],[-78.43786267266726,33.89499399649965],[-78.38585218571856,33.9049310390039],[-78.39163112871287,33.89747825712571],[-78.47253633063306,33.875119911491154]]],[[[-77.96976829012901,33.88008843274328],[-77.98132617611762,33.8850569539954],[-77.98132617611762,33.887541214621464],[-77.9871051191119,33.89250973587359],[-77.96976829012901,33.88008843274328]]],[[[-78.48409421662166,33.887541214621464],[-78.47253633063306,33.887541214621464],[-78.47253633063306,33.88257269336934],[-78.47831527362736,33.877604172117216],[-78.48409421662166,33.887541214621464]]],[[[-78.48409421662166,33.887541214621464],[-78.48987315961597,33.877604172117216],[-78.49565210261025,33.88257269336934],[-78.50143104560456,33.88257269336934],[-78.48409421662166,33.887541214621464]]],[[[-78.53032576057606,33.85773008710871],[-78.51298893159316,33.87263565086509],[-78.51876787458745,33.877604172117216],[-78.48409421662166,33.875119911491154],[-78.53032576057606,33.85773008710871]]],[[[-78.54188364656466,33.875119911491154],[-78.51876787458745,33.86766712961296],[-78.53610470357035,33.8651828689869],[-78.54188364656466,33.860214347734775],[-78.54188364656466,33.875119911491154]]],[[[-78.54188364656466,33.875119911491154],[-78.54766258955895,33.8651828689869],[-78.54188364656466,33.860214347734775],[-78.55922047554756,33.8651828689869],[-78.54188364656466,33.875119911491154]]],[[[-78.54188364656466,33.85027730523053],[-78.54188364656466,33.85773008710871],[-78.52454681758175,33.86269860836084],[-78.53032576057606,33.85524582648265],[-78.54188364656466,33.85027730523053]]]]}},{"type":"Feature","id":810,"properties":{"name":"dma:","latitude":46.29578,"dma":810,"dma1":"Yakima-Pasco-Richland-Kennewick, WA","longitude":-119.748852},"geometry":{"type":"Polygon","coordinates":[[[-119.6706209369937,44.99467047374738],[-119.79197873987398,44.99467047374738],[-119.75730508190819,45.16856871757176],[-120.00579963066306,45.25800210011002],[-120.00002068766877,45.81199221972197],[-119.86710499879987,45.836834825982606],[-119.86710499879987,46.04054419731973],[-121.52566163816381,46.043028457945795],[-121.52566163816381,46.3883406849685],[-121.39274594929492,46.39082494559457],[-121.45631432223222,46.52000649814982],[-121.35229334833483,46.713778826982704],[-121.52566163816381,46.872771507050714],[-121.37540912031203,47.05412253275328],[-121.41008277827783,47.11871330903091],[-121.30028286138614,47.14852443654366],[-121.34651440534053,47.28267451035104],[-121.46787220822083,47.367139371637165],[-121.23093554545454,47.56588022172218],[-121.11535668556856,47.59817560986099],[-120.90731473777377,47.424277366036605],[-120.5663571011101,47.30751711661166],[-120.01157857365736,47.2255365159516],[-120.04047328862886,47.07151235713572],[-119.92489442874287,46.81066499139915],[-119.97112597269727,46.72371586948695],[-119.89599971377137,46.63179822632264],[-119.6243893930393,46.644219529452954],[-119.5145894761476,46.726200130113014],[-119.37011590129012,46.67899917821782],[-119.37011590129012,46.73613717261726],[-118.20854835943594,46.73862143324333],[-118.24322201740173,46.29393878117813],[-117.98894852565256,46.20698965926593],[-117.97161169666967,45.8169607409741],[-118.04673795559556,45.8169607409741],[-118.11608527152715,45.687779188418844],[-118.11608527152715,45.4716485139514],[-118.40503242124213,45.44183738643865],[-118.42814819321931,45.35488826452646],[-118.6997585139514,45.3449512220222],[-118.65352696999699,45.195895584458455],[-118.54950599609961,45.195895584458455],[-118.52061128112811,44.99715473437344],[-119.6706209369937,44.99467047374738]]]}},{"type":"Feature","id":536,"properties":{"name":"dma:","latitude":41.0505515,"dma":536,"dma1":"Youngstown, OH","longitude":-80.543523},"geometry":{"type":"Polygon","coordinates":[[[-79.99817728112811,41.48937873037304],[-79.99817728112811,41.17139337023703],[-80.0964193120312,41.06953868456846],[-80.51828215061505,41.124192418341835],[-80.51828215061505,40.63976159625963],[-80.85923978727872,40.600013426242626],[-80.91702921722171,40.726710718171816],[-81.0846185640564,40.726710718171816],[-81.0846185640564,40.9875580839084],[-80.99793441914191,40.9875580839084],[-81.00371336213621,41.50180003350336],[-80.51828215061505,41.499315772877296],[-79.99817728112811,41.48937873037304]]]}},{"type":"Feature","id":771,"properties":{"name":"dma:","latitude":32.751631,"dma":771,"dma1":"Yuma, AZ-El Centro, CA","longitude":-114.7199745},"geometry":{"type":"Polygon","coordinates":[[[-113.33112047224722,32.50380804590459],[-113.33112047224722,32.039251308830885],[-114.81630882178217,32.49387100340034],[-114.71806679087908,32.71993872037204],[-116.10501310951095,32.61808403470347],[-116.08767628052804,33.42546873817382],[-114.6256037029703,33.432921520052005],[-114.72384573387339,33.405594653165316],[-114.72962467686769,33.30125570687069],[-114.67183524692469,33.25902327622762],[-114.70650890489048,33.0876092930293],[-114.60248793099309,33.02550277737774],[-114.26730923732373,33.03047129862986],[-114.26730923732373,33.462732647564756],[-113.95524631563156,33.46521690819082],[-113.95524631563156,33.37826778627863],[-113.33112047224722,33.37826778627863],[-113.33112047224722,32.50380804590459]]]}},{"type":"Feature","id":596,"properties":{"name":"dma:","latitude":39.961236,"dma":596,"dma1":"Zanesville, OH","longitude":-81.9657085},"geometry":{"type":"Polygon","coordinates":[[[-81.69718652145215,39.75536481338134],[-82.07859675907591,39.77027037713772],[-82.17105984698469,39.81995558965897],[-82.1595019609961,39.90938897219722],[-82.23462821992199,39.914357493449344],[-82.1883966759676,40.16775207730773],[-81.71452335043504,40.15284651355136],[-81.69718652145215,39.75536481338134]]]}}]'),J_={type:qU,features:GU},YU=new wf({repeat:!0}),Q_={latitude:40.2,longitude:-95.8,zoom:3.4,minZoom:0,maxZoom:20,pitch:0,bearing:0},ey=.5,w9="pk.eyJ1IjoiamZyYW50eSIsImEiOiJjam91bzF2YWUxZTFzM3FydnBncWs3dnoyIn0.cXRBg3Vcetu9d-gjstnGig";function KU(n,e,t){const r=f=>[parseInt(f.slice(1,3),16),parseInt(f.slice(3,5),16),parseInt(f.slice(5,7),16)],s=r(n),u=r(e);return[Math.round(s[0]+(u[0]-s[0])*t),Math.round(s[1]+(u[1]-s[1])*t),Math.round(s[2]+(u[2]-s[2])*t)]}function JU(n=50,e="#ffffff",t="#d4f9d0"){return Array.from({length:n},(r,s)=>KU(e,t,s/(n-1)))}function QU(n){const{sigmaData:e,config:t,selectedKpi:r,colorRange:s,kpiLabel:u}=n,[f,m]=fc.useState({...Q_}),[o,T]=fc.useState(null),[C,R]=fc.useState(null),[O,U]=fc.useState(null);fc.useEffect(()=>{e&&Array.isArray(e)&&e.length>0&&console.log("MAPBOX_TOKEN:",w9)},[e]),console.log("Map debug:",{sigmaData:e,selectedKpi:r});const V=fc.useMemo(()=>{const _e={};return Array.isArray(e)&&r&&e.forEach(Me=>{Me.dma!=null&&Me[r]!=null&&(_e[Me.dma]=Me[r])}),_e},[e,r]);console.log("dmaValueMap:",V);const Y=fc.useMemo(()=>{const _e=Object.values(V);if(!_e.length)return null;const Me=Math.min(..._e),Fe=Math.max(..._e),yt=JU(50,(s==null?void 0:s.startColor)||"#ffffff",(s==null?void 0:s.endColor)||"#d4f9d0");function xt(ht,kt,Bt){const Vt=Math.floor((ht-kt)/(Bt-kt+1e-9)*yt.length);return yt[Math.min(Vt,yt.length-1)]}return new Nf({id:"dma-polygons-"+r,data:J_,pickable:!0,stroked:!0,filled:!0,lineWidthMinPixels:1,getFillColor:ht=>{const kt=ht.id!=null?ht.id:ht.properties.dma,Bt=V[kt];if(Bt==null)return[200,200,200,40];const Vt=xt(Bt,Me,Fe);return kt===O?[Math.min(Vt[0]+40,255),Math.min(Vt[1]+40,255),Math.min(Vt[2]+40,255),180]:[...Vt,120]},getLineColor:ht=>(ht.id!=null?ht.id:ht.properties.dma)===O?[200,200,200,50]:[210,210,210,120]})},[J_,V,s,r,O]),ee=()=>{T(null),R(null),U(null)},le=(_e,Me)=>{if(_e&&_e.object&&_e.object.type==="Feature"&&_e.layer&&_e.layer.id.startsWith("dma-polygons")){const Fe=_e.object.id!=null?_e.object.id:_e.object.properties.dma,yt=V[Fe];T({x:_e.x,y:_e.y,dmaId:Fe,value:yt}),R(null)}else R(null),T(null)},Ee=_e=>{if(_e&&_e.object&&_e.object.type==="Feature"&&_e.layer&&_e.layer.id.startsWith("dma-polygons")){const Me=_e.object.id!=null?_e.object.id:_e.object.properties.dma;U(Me)}else U(null)},ue=_e=>{m(Me=>({...Me,zoom:Math.max(Me.minZoom,Math.min(Me.maxZoom,Me.zoom+_e))}))};return Wn.jsxs("div",{onContextMenu:_e=>{_e.preventDefault(),_e.stopPropagation()},children:[Wn.jsxs(uz,{layers:Y?[Y]:[],views:YU,viewState:f,controller:{dragRotate:!1},onViewStateChange:({viewState:_e})=>{m(_e),ee()},onClick:le,onHover:Ee,children:[Wn.jsx(wc,{reuseMaps:!0,mapboxApiAccessToken:w9,preventStyleDiffing:!0},w9),o&&Wn.jsxs("div",{className:"tooltip",style:{position:"fixed",left:o.x,top:o.y},children:[Wn.jsxs("div",{children:["DMA ID: ",o.dmaId]}),Wn.jsxs("div",{children:[u||"Value",": ",o.value]})]})]}),Wn.jsxs("section",{className:"iconsSection",children:[Wn.jsx("div",{className:"icons",children:Wn.jsx("button",{title:"Center data",onClick:()=>m({...Q_}),children:Wn.jsx(ZU,{})})}),Wn.jsxs("div",{className:"icons",style:{marginTop:"8px"},children:[Wn.jsx("button",{title:"Zoom in",onClick:()=>ue(ey),children:Wn.jsx(HU,{})}),Wn.jsx("div",{className:"divider"}),Wn.jsx("button",{title:"Zoom out",onClick:()=>ue(-1*ey),children:Wn.jsx(XU,{})})]})]})]})}function eV({index:n,setIndex:e,count:t,kpiLabels:r=[],startColor:s="#d4f9d0",endColor:u="#27e7b8",minValue:f,maxValue:m}){const o=T=>{e(parseInt(T.target.value,10))};return Wn.jsxs("header",{className:"header",children:[Wn.jsxs("div",{className:"header-left",children:[Wn.jsx("h1",{className:"header-title",children:"DMA Heatmap"}),Wn.jsx("div",{className:"header-kpi-selector",children:Wn.jsx("select",{value:n,onChange:o,className:"header-select",disabled:t<=1,children:r.map((T,C)=>Wn.jsx("option",{value:C,children:T},C))})})]}),Wn.jsxs("div",{className:"header-gradient-bar",children:[f!==void 0&&Wn.jsx("span",{className:"header-min",children:f}),Wn.jsx("div",{className:"header-gradient",style:{background:`linear-gradient(90deg, ${s} 0%, ${u} 100%)`}}),m!==void 0&&Wn.jsx("span",{className:"header-max",children:m})]})]})}function tV({children:n,index:e,count:t}){return t===0?null:Wn.jsx("div",{style:{width:"100%",height:"100%"},children:fc.Children.toArray(n)[e]})}E9.client.config.configureEditorPanel([{name:"source",type:"element"},{name:"dma",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer","string"]},{name:"numeric_value",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer"]},{name:"numeric_value2",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer"]},{name:"numeric_value3",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer"]}]);function nV(){const n=E9.useConfig(),e=E9.useElementData(n.source),[t,r]=lt.useState(null);lt.useEffect(()=>{fetch("https://api64.ipify.org?format=json").then(le=>le.json()).then(le=>r(le.ip)).catch(()=>r("Error fetching IP"))},[]);const s=[{key:"numeric_value",label:"KPI 1",color:"#d4f9d0"},{key:"numeric_value2",label:"KPI 2",color:"#8F94FE"},{key:"numeric_value3",label:"KPI 3",color:"#27e7b8"}],u=lt.useMemo(()=>e?s.filter(le=>{const Ee=n[le.key];return Ee&&e[Ee]&&e[Ee].some(ue=>ue!=null)}):[],[e,n.numeric_value,n.numeric_value2,n.numeric_value3]),f=lt.useMemo(()=>{const le=n.dma;if(!le||!(e!=null&&e[le]))return[];const Ee=[];for(let ue=0;ue<e[le].length;ue++){const _e={dma:e[le][ue]};s.forEach(Me=>{const Fe=n[Me.key];Fe&&e[Fe]&&(_e[Me.key]=e[Fe][ue])}),Ee.push(_e)}return Ee},[n.dma,n.numeric_value,n.numeric_value2,n.numeric_value3,e]),m=le=>{if(le==="dma")return"DMA";const Ee=n[le];if(!Ee)return le;if(Ee.includes("/")){const ue=Ee.split("/");return ue[ue.length-1]}return"Calculated Field"},[o,T]=lt.useState(0),C=u.length,R=u.map(le=>m(le.key)),O=u[o];let U="#d4f9d0",V="#27e7b8",Y,ee;if(O){U=O.key==="numeric_value"?"#d4f9d0":"#ffffff",V=O.key==="numeric_value"?"#27e7b8":O.color;const le=n[O.key];if(le&&e&&e[le]){const Ee=e[le].filter(ue=>ue!=null&&!isNaN(ue));Ee.length>0&&(Y=Math.min(...Ee),ee=Math.max(...Ee))}}return Wn.jsxs("div",{className:"App",style:{height:"100vh",display:"flex",flexDirection:"column"},children:[Wn.jsx(eV,{index:o,setIndex:T,count:C,kpiLabels:R,startColor:U,endColor:V,minValue:Y,maxValue:ee}),Wn.jsxs("div",{style:{flex:1,minHeight:0,padding:0,overflow:"auto",width:"100%"},children:[C===0&&Wn.jsx("div",{style:{color:"#888",textAlign:"center",marginTop:40},children:"[No Numeric KPI Available]"}),C>0&&Wn.jsx(tV,{index:o,setIndex:T,count:C,children:u.map((le,Ee)=>{let ue=le.key==="numeric_value"?"#d4f9d0":"#ffffff",_e=le.key==="numeric_value"?"#27e7b8":le.color;const Me=m(le.key);return Wn.jsxs("div",{className:"map-container",children:[Wn.jsx("div",{className:"map-container-label",children:Me}),Wn.jsx("div",{className:"map-container-map",children:Wn.jsx(QU,{sigmaData:f,config:n,selectedKpi:le.key,colorRange:{startColor:ue,endColor:_e},kpiLabel:Me})}),Wn.jsxs("div",{style:{margin:"16px 0 0 0",display:"flex",flexDirection:"column",alignItems:"center"},children:[Wn.jsx("div",{style:{width:240,height:18,background:`linear-gradient(90deg, ${ue} 0%, ${_e} 100%)`,borderRadius:6,border:"1px solid #eee"}}),Wn.jsxs("div",{style:{width:240,display:"flex",justifyContent:"space-between",fontSize:12,color:"#888",marginTop:2},children:[Wn.jsx("span",{children:"Min"}),Wn.jsx("span",{children:"Max"})]})]})]},le.key)})})]})]})}Mw.render(Wn.jsx(fc.StrictMode,{children:Wn.jsx(nV,{})}),document.getElementById("root"));
