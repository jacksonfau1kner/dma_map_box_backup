import"./mapbox.DCPsyBfg.js";const ht=globalThis,$=globalThis.process||{};function we(e){var i,s;if(typeof window<"u"&&((i=window.process)==null?void 0:i.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function Ot(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||we()}const se="4.1.0";function Se(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch{return null}}class Me{constructor(t,n,i="sessionStorage"){this.storage=Se(i),this.id=t,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let t={};if(this.storage){const n=this.storage.getItem(this.id);t=n?JSON.parse(n):{}}return Object.assign(this.config,t),this}}function Pe(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function ye(e,t=8){const n=Math.max(t-e.length,0);return`${" ".repeat(n)}${e}`}var pt;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(pt||(pt={}));const be=10;function It(e){return typeof e!="string"?e:(e=e.toUpperCase(),pt[e]||pt.WHITE)}function Ae(e,t,n){return!Ot&&typeof e=="string"&&(t&&(e=`\x1B[${It(t)}m${e}\x1B[39m`),n&&(e=`\x1B[${It(n)+be}m${e}\x1B[49m`)),e}function Re(e,t=["constructor"]){const n=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(n),s=e;for(const r of i){const o=s[r];typeof o=="function"&&(t.find(a=>r===a)||(s[r]=o.bind(e)))}}function xt(e,t){if(!e)throw new Error("Assertion failed")}function j(){var t,n,i;let e;if(Ot()&&ht.performance)e=(n=(t=ht==null?void 0:ht.performance)==null?void 0:t.now)==null?void 0:n.call(t);else if("hrtime"in $){const s=(i=$==null?void 0:$.hrtime)==null?void 0:i.call($);e=s[0]*1e3+s[1]/1e6}else e=Date.now();return e}const Y={debug:Ot()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Ce={enabled:!0,level:0};function G(){}const Ut={},Dt={once:!0};class re{constructor({id:t}={id:""}){this.VERSION=se,this._startTs=j(),this._deltaTs=j(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new Me(`__probe-${this.id}__`,Ce),this.timeStamp(`${this.id} started`),Re(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((j()-this._startTs).toPrecision(10))}getDelta(){return Number((j()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,n){this._storage.setConfiguration({[t]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,n){if(!t)throw new Error(n||"Assertion failed")}warn(t){return this._getLogFunction(0,t,Y.warn,arguments,Dt)}error(t){return this._getLogFunction(0,t,Y.error,arguments)}deprecated(t,n){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(t,n){return this.error(`\`${t}\` has been removed. Use \`${n}\` instead`)}probe(t,n){return this._getLogFunction(t,n,Y.log,arguments,{time:!0,once:!0})}log(t,n){return this._getLogFunction(t,n,Y.debug,arguments)}info(t,n){return this._getLogFunction(t,n,console.info,arguments)}once(t,n){return this._getLogFunction(t,n,Y.debug||Y.info,arguments,Dt)}table(t,n,i){return n?this._getLogFunction(t,n,console.table||G,i&&[i],{tag:Ve(n)}):G}time(t,n){return this._getLogFunction(t,n,console.time?console.time:console.info)}timeEnd(t,n){return this._getLogFunction(t,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,n){return this._getLogFunction(t,n,console.timeStamp||G)}group(t,n,i={collapsed:!1}){const s=Zt({logLevel:t,message:n,opts:i}),{collapsed:r}=i;return s.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(t,n,i={}){return this.group(t,n,Object.assign({},i,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||G)}withGroup(t,n,i){this.group(t,n)();try{i()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=oe(t)}_getLogFunction(t,n,i,s,r){if(this._shouldLog(t)){r=Zt({logLevel:t,message:n,args:s,opts:r}),i=i||r.method,xt(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=j();const o=r.tag||r.message;if(r.once&&o)if(!Ut[o])Ut[o]=j();else return G;return n=Le(this.id,r.message,r),i.bind(console,n,...r.args)}return G}}re.VERSION=se;function oe(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return xt(Number.isFinite(t)&&t>=0),t}function Zt(e){const{logLevel:t,message:n}=e;e.logLevel=oe(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==n;);switch(typeof t){case"string":case"function":n!==void 0&&i.unshift(n),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const s=typeof e.message;return xt(s==="string"||s==="object"),Object.assign(e,{args:i},e.opts)}function Le(e,t,n){if(typeof t=="string"){const i=n.time?ye(Pe(n.total)):"";t=n.time?`${e}: ${i}  ${t}`:`${e}: ${t}`,t=Ae(t,n.color,n.background)}return t}function Ve(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}const Fe=new re({id:"deck"}),Ne={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Ne}};const N=globalThis.mathgl.config;function ke(e,{precision:t=N.precision}={}){return e=ve(e),`${parseFloat(e.toPrecision(t))}`}function Q(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Z(e,t,n){return xe(e,i=>Math.max(t,Math.min(n,i)))}function Rt(e,t,n){return Q(e)?e.map((i,s)=>Rt(i,t[s],n)):n*t+(1-n)*e}function ot(e,t,n){const i=N.EPSILON;try{if(e===t)return!0;if(Q(e)&&Q(t)){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(!ot(e[s],t[s]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=N.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{N.EPSILON=i}}function ve(e){return Math.round(e/N.EPSILON)*N.EPSILON}function Oe(e){return e.clone?e.clone():new Array(e.length)}function xe(e,t,n){if(Q(e)){const i=e;n=n||Oe(i);for(let s=0;s<n.length&&s<i.length;++s){const r=typeof e=="number"?e:e[s];n[s]=t(r,s,n)}return n}return t(e)}class ae extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=t[i+n];return this.check()}toArray(t=[],n=0){for(let i=0;i<this.ELEMENTS;++i)t[n+i]=this[i];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Q(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(N)}formatString(t){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+ke(this[i],t);return`${t.printTypes?this.constructor.name:""}[${n}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!ot(this[n],t[n]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==t[n])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,n,i){if(i===void 0)return this.lerp(this,t,n);for(let s=0;s<this.ELEMENTS;++s){const r=t[s],o=typeof n=="number"?n:n[s];this[s]=r+i*(o-r)}return this.check()}min(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(t[n],this[n]);return this.check()}max(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(t[n],this[n]);return this.check()}clamp(t,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t[i]),n[i]);return this.check()}add(...t){for(const n of t)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...t){for(const n of t)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(t){if(typeof t=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;else for(let n=0;n<this.ELEMENTS&&n<t.length;++n)this[n]*=t[n];return this.check()}multiplyByScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;return this.check()}check(){if(N.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)t=t&&Number.isFinite(this[n]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=t;return this.check()}addScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t),n);return this.check()}get elements(){return this}}function ze(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}function F(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function St(e,t,n=""){if(N.debug&&!ze(e,t))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return e}function qt(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class Be extends ae{get x(){return this[0]}set x(t){this[0]=F(t)}get y(){return this[1]}set y(t){this[1]=F(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*this[n];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let n=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-t[i];n+=s*s}return F(n)}dot(t){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*t[i];return F(n)}normalize(){const t=this.magnitude();if(t!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=t;return this.check()}multiply(...t){for(const n of t)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...t){for(const n of t)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return qt(t>=0&&t<this.ELEMENTS,"index is out of range"),F(this[t])}setComponent(t,n){return qt(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=n,this.check()}addVectors(t,n){return this.copy(t).add(n)}subVectors(t,n){return this.copy(t).subtract(n)}multiplyVectors(t,n){return this.copy(t).multiply(n)}addScaledVector(t,n){return this.add(new this.constructor(t).multiplyScalar(n))}}const gt=1e-6;let J=typeof Float32Array<"u"?Float32Array:Array;function Ie(){const e=new J(2);return J!=Float32Array&&(e[0]=0,e[1]=0),e}function Wt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function Ue(e,t){return e[0]=-t[0],e[1]=-t[1],e}function he(e,t,n,i){const s=t[0],r=t[1];return e[0]=s+i*(n[0]-s),e[1]=r+i*(n[1]-r),e}function De(e,t,n){const i=t[0],s=t[1];return e[0]=n[0]*i+n[4]*s+n[12],e[1]=n[1]*i+n[5]*s+n[13],e}(function(){const e=Ie();return function(t,n,i,s,r,o){let a,h;for(n||(n=2),i||(i=0),s?h=Math.min(s*n+i,t.length):h=t.length,a=i;a<h;a+=n)e[0]=t[a],e[1]=t[a+1],r(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}})();function Ze(e,t,n){const i=t[0],s=t[1],r=n[3]*i+n[7]*s||1;return e[0]=(n[0]*i+n[4]*s)/r,e[1]=(n[1]*i+n[5]*s)/r,e}function ce(e,t,n){const i=t[0],s=t[1],r=t[2],o=n[3]*i+n[7]*s+n[11]*r||1;return e[0]=(n[0]*i+n[4]*s+n[8]*r)/o,e[1]=(n[1]*i+n[5]*s+n[9]*r)/o,e[2]=(n[2]*i+n[6]*s+n[10]*r)/o,e}function qe(e,t,n){const i=t[0],s=t[1];return e[0]=n[0]*i+n[2]*s,e[1]=n[1]*i+n[3]*s,e[2]=t[2],e}function We(){const e=new J(3);return J!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function $e(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function je(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ye(e,t,n){const i=t[0],s=t[1],r=t[2],o=n[0],a=n[1],h=n[2];return e[0]=s*h-r*a,e[1]=r*o-i*h,e[2]=i*a-s*o,e}function le(e,t,n){const i=t[0],s=t[1],r=t[2];let o=n[3]*i+n[7]*s+n[11]*r+n[15];return o=o||1,e[0]=(n[0]*i+n[4]*s+n[8]*r+n[12])/o,e[1]=(n[1]*i+n[5]*s+n[9]*r+n[13])/o,e[2]=(n[2]*i+n[6]*s+n[10]*r+n[14])/o,e}function Ge(e,t,n){const i=t[0],s=t[1],r=t[2];return e[0]=i*n[0]+s*n[3]+r*n[6],e[1]=i*n[1]+s*n[4]+r*n[7],e[2]=i*n[2]+s*n[5]+r*n[8],e}function He(e,t,n){const i=n[0],s=n[1],r=n[2],o=n[3],a=t[0],h=t[1],c=t[2];let l=s*c-r*h,u=r*a-i*c,f=i*h-s*a,g=s*f-r*u,d=r*l-i*f,p=i*u-s*l;const m=o*2;return l*=m,u*=m,f*=m,g*=2,d*=2,p*=2,e[0]=a+l+g,e[1]=h+u+d,e[2]=c+f+p,e}function Ke(e,t,n,i){const s=[],r=[];return s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],r[0]=s[0],r[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),r[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e}function Xe(e,t,n,i){const s=[],r=[];return s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],r[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),r[1]=s[1],r[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e}function Qe(e,t,n,i){const s=[],r=[];return s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],r[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),r[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),r[2]=s[2],e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e}function Je(e,t){const n=e[0],i=e[1],s=e[2],r=t[0],o=t[1],a=t[2],h=Math.sqrt((n*n+i*i+s*s)*(r*r+o*o+a*a)),c=h&&je(e,t)/h;return Math.acos(Math.min(Math.max(c,-1),1))}(function(){const e=We();return function(t,n,i,s,r,o){let a,h;for(n||(n=3),i||(i=0),s?h=Math.min(s*n+i,t.length):h=t.length,a=i;a<h;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],r(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();const Mt=[0,0,0];let ct;class tt extends Be{static get ZERO(){return ct||(ct=new tt(0,0,0),Object.freeze(ct)),ct}constructor(t=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&Q(t)?this.copy(t):(N.debug&&(F(t),F(n),F(i)),this[0]=t,this[1]=n,this[2]=i)}set(t,n,i){return this[0]=t,this[1]=n,this[2]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return N.debug&&(F(t.x),F(t.y),F(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=F(t)}angle(t){return Je(this,t)}cross(t){return Ye(this,this,t),this.check()}rotateX({radians:t,origin:n=Mt}){return Ke(this,this,n,t),this.check()}rotateY({radians:t,origin:n=Mt}){return Xe(this,this,n,t),this.check()}rotateZ({radians:t,origin:n=Mt}){return Qe(this,this,n,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return le(this,this,t),this.check()}transformAsVector(t){return ce(this,this,t),this.check()}transformByMatrix3(t){return Ge(this,this,t),this.check()}transformByMatrix2(t){return qe(this,this,t),this.check()}transformByQuaternion(t){return He(this,this,t),this.check()}}class tn extends ae{toString(){let t="[";if(N.printRowMajor){t+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)t+=` ${this[i*this.RANK+n]}`}else{t+="column-major:";for(let n=0;n<this.ELEMENTS;++n)t+=` ${this[n]}`}return t+="]",t}getElementIndex(t,n){return n*this.RANK+t}getElement(t,n){return this[n*this.RANK+t]}setElement(t,n,i){return this[n*this.RANK+t]=F(i),this}getColumn(t,n=new Array(this.RANK).fill(-0)){const i=t*this.RANK;for(let s=0;s<this.RANK;++s)n[s]=this[i+s];return n}setColumn(t,n){const i=t*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=n[s];return this}}function en(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function nn(e,t){if(e===t){const n=t[1],i=t[2],s=t[3],r=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=r,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Ct(e,t){const n=t[0],i=t[1],s=t[2],r=t[3],o=t[4],a=t[5],h=t[6],c=t[7],l=t[8],u=t[9],f=t[10],g=t[11],d=t[12],p=t[13],m=t[14],M=t[15],P=n*a-i*o,E=n*h-s*o,_=n*c-r*o,w=i*h-s*a,T=i*c-r*a,b=s*c-r*h,A=l*p-u*d,R=l*m-f*d,C=l*M-g*d,V=u*m-f*p,v=u*M-g*p,O=f*M-g*m;let y=P*O-E*v+_*V+w*C-T*R+b*A;return y?(y=1/y,e[0]=(a*O-h*v+c*V)*y,e[1]=(s*v-i*O-r*V)*y,e[2]=(p*b-m*T+M*w)*y,e[3]=(f*T-u*b-g*w)*y,e[4]=(h*C-o*O-c*R)*y,e[5]=(n*O-s*C+r*R)*y,e[6]=(m*_-d*b-M*E)*y,e[7]=(l*b-f*_+g*E)*y,e[8]=(o*v-a*C+c*A)*y,e[9]=(i*C-n*v-r*A)*y,e[10]=(d*T-p*_+M*P)*y,e[11]=(u*_-l*T-g*P)*y,e[12]=(a*R-o*V-h*A)*y,e[13]=(n*V-i*R+s*A)*y,e[14]=(p*E-d*w-m*P)*y,e[15]=(l*w-u*E+f*P)*y,e):null}function sn(e){const t=e[0],n=e[1],i=e[2],s=e[3],r=e[4],o=e[5],a=e[6],h=e[7],c=e[8],l=e[9],u=e[10],f=e[11],g=e[12],d=e[13],p=e[14],m=e[15],M=t*o-n*r,P=t*a-i*r,E=n*a-i*o,_=c*d-l*g,w=c*p-u*g,T=l*p-u*d,b=t*T-n*w+i*_,A=r*T-o*w+a*_,R=c*E-l*P+u*M,C=g*E-d*P+p*M;return h*b-s*A+m*R-f*C}function rt(e,t,n){const i=t[0],s=t[1],r=t[2],o=t[3],a=t[4],h=t[5],c=t[6],l=t[7],u=t[8],f=t[9],g=t[10],d=t[11],p=t[12],m=t[13],M=t[14],P=t[15];let E=n[0],_=n[1],w=n[2],T=n[3];return e[0]=E*i+_*a+w*u+T*p,e[1]=E*s+_*h+w*f+T*m,e[2]=E*r+_*c+w*g+T*M,e[3]=E*o+_*l+w*d+T*P,E=n[4],_=n[5],w=n[6],T=n[7],e[4]=E*i+_*a+w*u+T*p,e[5]=E*s+_*h+w*f+T*m,e[6]=E*r+_*c+w*g+T*M,e[7]=E*o+_*l+w*d+T*P,E=n[8],_=n[9],w=n[10],T=n[11],e[8]=E*i+_*a+w*u+T*p,e[9]=E*s+_*h+w*f+T*m,e[10]=E*r+_*c+w*g+T*M,e[11]=E*o+_*l+w*d+T*P,E=n[12],_=n[13],w=n[14],T=n[15],e[12]=E*i+_*a+w*u+T*p,e[13]=E*s+_*h+w*f+T*m,e[14]=E*r+_*c+w*g+T*M,e[15]=E*o+_*l+w*d+T*P,e}function mt(e,t,n){const i=n[0],s=n[1],r=n[2];let o,a,h,c,l,u,f,g,d,p,m,M;return t===e?(e[12]=t[0]*i+t[4]*s+t[8]*r+t[12],e[13]=t[1]*i+t[5]*s+t[9]*r+t[13],e[14]=t[2]*i+t[6]*s+t[10]*r+t[14],e[15]=t[3]*i+t[7]*s+t[11]*r+t[15]):(o=t[0],a=t[1],h=t[2],c=t[3],l=t[4],u=t[5],f=t[6],g=t[7],d=t[8],p=t[9],m=t[10],M=t[11],e[0]=o,e[1]=a,e[2]=h,e[3]=c,e[4]=l,e[5]=u,e[6]=f,e[7]=g,e[8]=d,e[9]=p,e[10]=m,e[11]=M,e[12]=o*i+l*s+d*r+t[12],e[13]=a*i+u*s+p*r+t[13],e[14]=h*i+f*s+m*r+t[14],e[15]=c*i+g*s+M*r+t[15]),e}function zt(e,t,n){const i=n[0],s=n[1],r=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function rn(e,t,n,i){let s=i[0],r=i[1],o=i[2],a=Math.sqrt(s*s+r*r+o*o),h,c,l,u,f,g,d,p,m,M,P,E,_,w,T,b,A,R,C,V,v,O,y,it;return a<gt?null:(a=1/a,s*=a,r*=a,o*=a,c=Math.sin(n),h=Math.cos(n),l=1-h,u=t[0],f=t[1],g=t[2],d=t[3],p=t[4],m=t[5],M=t[6],P=t[7],E=t[8],_=t[9],w=t[10],T=t[11],b=s*s*l+h,A=r*s*l+o*c,R=o*s*l-r*c,C=s*r*l-o*c,V=r*r*l+h,v=o*r*l+s*c,O=s*o*l+r*c,y=r*o*l-s*c,it=o*o*l+h,e[0]=u*b+p*A+E*R,e[1]=f*b+m*A+_*R,e[2]=g*b+M*A+w*R,e[3]=d*b+P*A+T*R,e[4]=u*C+p*V+E*v,e[5]=f*C+m*V+_*v,e[6]=g*C+M*V+w*v,e[7]=d*C+P*V+T*v,e[8]=u*O+p*y+E*it,e[9]=f*O+m*y+_*it,e[10]=g*O+M*y+w*it,e[11]=d*O+P*y+T*it,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ue(e,t,n){const i=Math.sin(n),s=Math.cos(n),r=t[4],o=t[5],a=t[6],h=t[7],c=t[8],l=t[9],u=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=r*s+c*i,e[5]=o*s+l*i,e[6]=a*s+u*i,e[7]=h*s+f*i,e[8]=c*s-r*i,e[9]=l*s-o*i,e[10]=u*s-a*i,e[11]=f*s-h*i,e}function on(e,t,n){const i=Math.sin(n),s=Math.cos(n),r=t[0],o=t[1],a=t[2],h=t[3],c=t[8],l=t[9],u=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=r*s-c*i,e[1]=o*s-l*i,e[2]=a*s-u*i,e[3]=h*s-f*i,e[8]=r*i+c*s,e[9]=o*i+l*s,e[10]=a*i+u*s,e[11]=h*i+f*s,e}function fe(e,t,n){const i=Math.sin(n),s=Math.cos(n),r=t[0],o=t[1],a=t[2],h=t[3],c=t[4],l=t[5],u=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=r*s+c*i,e[1]=o*s+l*i,e[2]=a*s+u*i,e[3]=h*s+f*i,e[4]=c*s-r*i,e[5]=l*s-o*i,e[6]=u*s-a*i,e[7]=f*s-h*i,e}function an(e,t){const n=t[0],i=t[1],s=t[2],r=t[3],o=n+n,a=i+i,h=s+s,c=n*o,l=i*o,u=i*a,f=s*o,g=s*a,d=s*h,p=r*o,m=r*a,M=r*h;return e[0]=1-u-d,e[1]=l+M,e[2]=f-m,e[3]=0,e[4]=l-M,e[5]=1-c-d,e[6]=g+p,e[7]=0,e[8]=f+m,e[9]=g-p,e[10]=1-c-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function hn(e,t,n,i,s,r,o){const a=1/(n-t),h=1/(s-i),c=1/(r-o);return e[0]=r*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r*2*h,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(s+i)*h,e[10]=(o+r)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*r*2*c,e[15]=0,e}function cn(e,t,n,i,s){const r=1/Math.tan(t/2);if(e[0]=r/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0){const o=1/(i-s);e[10]=(s+i)*o,e[14]=2*s*i*o}else e[10]=-1,e[14]=-2*i;return e}const ln=cn;function un(e,t,n,i,s,r,o){const a=1/(t-n),h=1/(i-s),c=1/(r-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(s+i)*h,e[14]=(o+r)*c,e[15]=1,e}const fn=un;function gn(e,t,n,i){let s,r,o,a,h,c,l,u,f,g;const d=t[0],p=t[1],m=t[2],M=i[0],P=i[1],E=i[2],_=n[0],w=n[1],T=n[2];return Math.abs(d-_)<gt&&Math.abs(p-w)<gt&&Math.abs(m-T)<gt?en(e):(u=d-_,f=p-w,g=m-T,s=1/Math.sqrt(u*u+f*f+g*g),u*=s,f*=s,g*=s,r=P*g-E*f,o=E*u-M*g,a=M*f-P*u,s=Math.sqrt(r*r+o*o+a*a),s?(s=1/s,r*=s,o*=s,a*=s):(r=0,o=0,a=0),h=f*a-g*o,c=g*r-u*a,l=u*o-f*r,s=Math.sqrt(h*h+c*c+l*l),s?(s=1/s,h*=s,c*=s,l*=s):(h=0,c=0,l=0),e[0]=r,e[1]=h,e[2]=u,e[3]=0,e[4]=o,e[5]=c,e[6]=f,e[7]=0,e[8]=a,e[9]=l,e[10]=g,e[11]=0,e[12]=-(r*d+o*p+a*m),e[13]=-(h*d+c*p+l*m),e[14]=-(u*d+f*p+g*m),e[15]=1,e)}function dn(){const e=new J(4);return J!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function pn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function ge(e,t,n){const i=t[0],s=t[1],r=t[2],o=t[3];return e[0]=n[0]*i+n[4]*s+n[8]*r+n[12]*o,e[1]=n[1]*i+n[5]*s+n[9]*r+n[13]*o,e[2]=n[2]*i+n[6]*s+n[10]*r+n[14]*o,e[3]=n[3]*i+n[7]*s+n[11]*r+n[15]*o,e}(function(){const e=dn();return function(t,n,i,s,r,o){let a,h;for(n||(n=4),i||(i=0),s?h=Math.min(s*n+i,t.length):h=t.length,a=i;a<h;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],r(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();var Lt;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(Lt||(Lt={}));const mn=45*Math.PI/180,En=1,Pt=.1,yt=500,_n=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class W extends tn{static get IDENTITY(){return wn()}static get ZERO(){return Tn()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Lt}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,n,i,s,r,o,a,h,c,l,u,f,g,d,p,m){return this[0]=t,this[1]=n,this[2]=i,this[3]=s,this[4]=r,this[5]=o,this[6]=a,this[7]=h,this[8]=c,this[9]=l,this[10]=u,this[11]=f,this[12]=g,this[13]=d,this[14]=p,this[15]=m,this.check()}setRowMajor(t,n,i,s,r,o,a,h,c,l,u,f,g,d,p,m){return this[0]=t,this[1]=r,this[2]=c,this[3]=g,this[4]=n,this[5]=o,this[6]=l,this[7]=d,this[8]=i,this[9]=a,this[10]=u,this[11]=p,this[12]=s,this[13]=h,this[14]=f,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(_n)}fromObject(t){return this.check()}fromQuaternion(t){return an(this,t),this.check()}frustum(t){const{left:n,right:i,bottom:s,top:r,near:o=Pt,far:a=yt}=t;return a===1/0?Sn(this,n,i,s,r,o):hn(this,n,i,s,r,o,a),this.check()}lookAt(t){const{eye:n,center:i=[0,0,0],up:s=[0,1,0]}=t;return gn(this,n,i,s),this.check()}ortho(t){const{left:n,right:i,bottom:s,top:r,near:o=Pt,far:a=yt}=t;return fn(this,n,i,s,r,o,a),this.check()}orthographic(t){const{fovy:n=mn,aspect:i=En,focalDistance:s=1,near:r=Pt,far:o=yt}=t;$t(n);const a=n/2,h=s*Math.tan(a),c=h*i;return this.ortho({left:-c,right:c,bottom:-h,top:h,near:r,far:o})}perspective(t){const{fovy:n=45*Math.PI/180,aspect:i=1,near:s=.1,far:r=500}=t;return $t(n),ln(this,n,i,s,r),this.check()}determinant(){return sn(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,n){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),s=1/i[0],r=1/i[1],o=1/i[2];return t[0]=this[0]*s,t[1]=this[1]*r,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*r,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*r,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,n){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),s=1/i[0],r=1/i[1],o=1/i[2];return t[0]=this[0]*s,t[1]=this[1]*r,t[2]=this[2]*o,t[3]=this[4]*s,t[4]=this[5]*r,t[5]=this[6]*o,t[6]=this[8]*s,t[7]=this[9]*r,t[8]=this[10]*o,t}transpose(){return nn(this,this),this.check()}invert(){return Ct(this,this),this.check()}multiplyLeft(t){return rt(this,t,this),this.check()}multiplyRight(t){return rt(this,this,t),this.check()}rotateX(t){return ue(this,this,t),this.check()}rotateY(t){return on(this,this,t),this.check()}rotateZ(t){return fe(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,n){return rn(this,this,t,n),this.check()}scale(t){return zt(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return mt(this,this,t),this.check()}transform(t,n){return t.length===4?(n=ge(n||[-0,-0,-0,-0],t,this),St(n,4),n):this.transformAsPoint(t,n)}transformAsPoint(t,n){const{length:i}=t;let s;switch(i){case 2:s=De(n||[-0,-0],t,this);break;case 3:s=le(n||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return St(s,t.length),s}transformAsVector(t,n){let i;switch(t.length){case 2:i=Ze(n||[-0,-0],t,this);break;case 3:i=ce(n||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return St(i,t.length),i}transformPoint(t,n){return this.transformAsPoint(t,n)}transformVector(t,n){return this.transformAsPoint(t,n)}transformDirection(t,n){return this.transformAsVector(t,n)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,n,i){return this.identity().translate([t,n,i])}}let lt,ut;function Tn(){return lt||(lt=new W([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(lt)),lt}function wn(){return ut||(ut=new W,Object.freeze(ut)),ut}function $t(e){if(e>Math.PI*2)throw Error("expected radians")}function Sn(e,t,n,i,s,r){const o=2*r/(n-t),a=2*r/(s-i),h=(n+t)/(n-t),c=(s+i)/(s-i),l=-1,u=-1,f=-2*r;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=h,e[9]=c,e[10]=l,e[11]=u,e[12]=0,e[13]=0,e[14]=f,e[15]=0,e}var x;(function(e){e[e.Start=1]="Start",e[e.Move=2]="Move",e[e.End=4]="End",e[e.Cancel=8]="Cancel"})(x||(x={}));var L;(function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=4]="Up",e[e.Down=8]="Down",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"})(L||(L={}));var S;(function(e){e[e.Possible=1]="Possible",e[e.Began=2]="Began",e[e.Changed=4]="Changed",e[e.Ended=8]="Ended",e[e.Recognized=8]="Recognized",e[e.Cancelled=16]="Cancelled",e[e.Failed=32]="Failed"})(S||(S={}));const Mn="manipulation",Pn="none",yn="pan-x",bn="pan-y";function An(e,t){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}x.Start,x.Move,x.End,x.Cancel,x.Cancel;let Rn=1;function Cn(){return Rn++}function jt(e){return e&S.Cancelled?"cancel":e&S.Ended?"end":e&S.Changed?"move":e&S.Began?"start":""}class de{constructor(t){this.options=t,this.id=Cn(),this.state=S.Possible,this.simultaneous={},this.requireFail=[]}set(t){return Object.assign(this.options,t),this.manager.touchAction.update(),this}recognizeWith(t){if(Array.isArray(t)){for(const s of t)this.recognizeWith(s);return this}let n;if(typeof t=="string"){if(n=this.manager.get(t),!n)throw new Error(`Cannot find recognizer ${t}`)}else n=t;const{simultaneous:i}=this;return i[n.id]||(i[n.id]=n,n.recognizeWith(this)),this}dropRecognizeWith(t){if(Array.isArray(t)){for(const i of t)this.dropRecognizeWith(i);return this}let n;return typeof t=="string"?n=this.manager.get(t):n=t,n&&delete this.simultaneous[n.id],this}requireFailure(t){if(Array.isArray(t)){for(const s of t)this.requireFailure(s);return this}let n;if(typeof t=="string"){if(n=this.manager.get(t),!n)throw new Error(`Cannot find recognizer ${t}`)}else n=t;const{requireFail:i}=this;return i.indexOf(n)===-1&&(i.push(n),n.requireFailure(this)),this}dropRequireFailure(t){if(Array.isArray(t)){for(const i of t)this.dropRequireFailure(i);return this}let n;if(typeof t=="string"?n=this.manager.get(t):n=t,n){const i=this.requireFail.indexOf(n);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(t=>t.options.enable)}canRecognizeWith(t){return!!this.simultaneous[t.id]}emit(t){if(!t)return;const{state:n}=this;n<S.Ended&&this.manager.emit(this.options.event+jt(n),t),this.manager.emit(this.options.event,t),t.additionalEvent&&this.manager.emit(t.additionalEvent,t),n>=S.Ended&&this.manager.emit(this.options.event+jt(n),t)}tryEmit(t){this.canEmit()?this.emit(t):this.state=S.Failed}canEmit(){let t=0;for(;t<this.requireFail.length;){if(!(this.requireFail[t].state&(S.Failed|S.Possible)))return!1;t++}return!0}recognize(t){const n={...t};if(!this.options.enable){this.reset(),this.state=S.Failed;return}this.state&(S.Recognized|S.Cancelled|S.Failed)&&(this.state=S.Possible),this.state=this.process(n),this.state&(S.Began|S.Changed|S.Ended|S.Cancelled)&&this.tryEmit(n)}getEventNames(){return[this.options.event]}reset(){}}class pe extends de{attrTest(t){const n=this.options.pointers;return n===0||t.pointers.length===n}process(t){const{state:n}=this,{eventType:i}=t,s=n&(S.Began|S.Changed),r=this.attrTest(t);return s&&(i&x.Cancel||!r)?n|S.Cancelled:s||r?i&x.End?n|S.Ended:n&S.Began?n|S.Changed:S.Began:S.Failed}}class Yt extends de{constructor(t={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Mn]}process(t){const{options:n}=this,i=t.pointers.length===n.pointers,s=t.distance<n.threshold,r=t.deltaTime<n.time;if(this.reset(),t.eventType&x.Start&&this.count===0)return this.failTimeout();if(s&&r&&i){if(t.eventType!==x.End)return this.failTimeout();const o=this.pTime?t.timeStamp-this.pTime<n.interval:!0,a=!this.pCenter||An(this.pCenter,t.center)<n.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,!a||!o?this.count=1:this.count+=1,this._input=t,this.count%n.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=S.Recognized,this.tryEmit(this._input)},n.interval),S.Began):S.Recognized}return S.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=S.Failed},this.options.interval),S.Failed}reset(){clearTimeout(this._timer)}emit(t){this.state===S.Recognized&&(t.tapCount=this.count,this.manager.emit(this.options.event,t))}}const Ln=["","start","move","end","cancel","up","down","left","right"];class Gt extends pe{constructor(t={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:L.All,...t}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:t}}=this,n=[];return t&L.Horizontal&&n.push(bn),t&L.Vertical&&n.push(yn),n}getEventNames(){return Ln.map(t=>this.options.event+t)}directionTest(t){const{options:n}=this;let i=!0,{distance:s}=t,{direction:r}=t;const o=t.deltaX,a=t.deltaY;return r&n.direction||(n.direction&L.Horizontal?(r=o===0?L.None:o<0?L.Left:L.Right,i=o!==this.pX,s=Math.abs(t.deltaX)):(r=a===0?L.None:a<0?L.Up:L.Down,i=a!==this.pY,s=Math.abs(t.deltaY))),t.direction=r,i&&s>n.threshold&&!!(r&n.direction)}attrTest(t){return super.attrTest(t)&&(!!(this.state&S.Began)||!(this.state&S.Began)&&this.directionTest(t))}emit(t){this.pX=t.deltaX,this.pY=t.deltaY;const n=L[t.direction].toLowerCase();n&&(t.additionalEvent=this.options.event+n),super.emit(t)}}const Vn=["","start","move","end","cancel","in","out"];class Fn extends pe{constructor(t={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...t})}getTouchAction(){return[Pn]}getEventNames(){return Vn.map(t=>this.options.event+t)}attrTest(t){return super.attrTest(t)&&(Math.abs(t.scale-1)>this.options.threshold||!!(this.state&S.Began))}emit(t){if(t.scale!==1){const n=t.scale<1?"in":"out";t.additionalEvent=this.options.event+n}super.emit(t)}}const Nn=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"";Nn.indexOf("firefox");const bt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0};L.Vertical;function kn(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function X(e,t){const n=ge([],t,e);return pn(n,n,1/n[3]),n}function Ht(e,t){const n=e%t;return n<0?t+n:n}function Vt(e,t,n){return e<t?t:e>n?n:e}function vn(e){return Math.log(e)*Math.LOG2E}const Bt=Math.log2||vn;function B(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const z=Math.PI,me=z/4,k=z/180,Ft=180/z,et=512,Et=4003e4,Kt=85.051129,On=1.5;function xn(e){return Bt(e)}function _t(e){const[t,n]=e;B(Number.isFinite(t)),B(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=t*k,s=n*k,r=et*(i+z)/(2*z),o=et*(z+Math.log(Math.tan(me+s*.5)))/(2*z);return[r,o]}function nt(e){const[t,n]=e,i=t/et*(2*z)-z,s=2*(Math.atan(Math.exp(n/et*(2*z)-z))-me);return[i*Ft,s*Ft]}function zn(e){const{latitude:t}=e;B(Number.isFinite(t));const n=Math.cos(t*k);return xn(Et*n)-9}function At(e){const t=Math.cos(e*k);return et/Et/t}function Nt(e){const{latitude:t,longitude:n,highPrecision:i=!1}=e;B(Number.isFinite(t)&&Number.isFinite(n));const s=et,r=Math.cos(t*k),o=s/360,a=o/r,h=s/Et/r,c={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[o,a,h],degreesPerUnit:[1/o,1/a,1/h]};if(i){const l=k*Math.tan(t*k)/r,u=o*l/2,f=s/Et*l,g=f/a*h;c.unitsPerDegree2=[0,u,f],c.unitsPerMeter2=[g,0,g]}return c}function Bn(e,t){const[n,i,s]=e,[r,o,a]=t,{unitsPerMeter:h,unitsPerMeter2:c}=Nt({longitude:n,latitude:i,highPrecision:!0}),l=_t(e);l[0]+=r*(h[0]+c[0]*o),l[1]+=o*(h[1]+c[1]*o);const u=nt(l),f=(s||0)+(a||0);return Number.isFinite(s)||Number.isFinite(a)?[u[0],u[1],f]:u}function In(e){const{height:t,pitch:n,bearing:i,altitude:s,scale:r,center:o}=e,a=kn();mt(a,a,[0,0,-s]),ue(a,a,-n*k),fe(a,a,i*k);const h=r/t;return zt(a,a,[h,h,h]),o&&mt(a,a,$e([],o)),a}function Un(e){const{width:t,height:n,altitude:i,pitch:s=0,offset:r,center:o,scale:a,nearZMultiplier:h=1,farZMultiplier:c=1}=e;let{fovy:l=Tt(On)}=e;i!==void 0&&(l=Tt(i));const u=l*k,f=s*k,g=Ee(l);let d=g;o&&(d+=o[2]*a/Math.cos(f)/n);const p=u*(.5+(r?r[1]:0)/n),m=Math.sin(p)*d/Math.sin(Vt(Math.PI/2-f-p,.01,Math.PI-.01)),M=Math.sin(f)*m+d,P=d*10,E=Math.min(M*c,P);return{fov:u,aspect:t/n,focalDistance:g,near:h,far:E}}function Tt(e){return 2*Math.atan(.5/e)*Ft}function Ee(e){return .5/Math.tan(.5*e*k)}function Dn(e,t){const[n,i,s=0]=e;return B(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(s)),X(t,[n,i,s,1])}function _e(e,t,n=0){const[i,s,r]=e;if(B(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(r))return X(t,[i,s,r,1]);const o=X(t,[i,s,0,1]),a=X(t,[i,s,1,1]),h=o[2],c=a[2],l=h===c?0:((n||0)-h)/(c-h);return he([],o,a,l)}function Zn(e){const{width:t,height:n,bounds:i,minExtent:s=0,maxZoom:r=24,offset:o=[0,0]}=e,[[a,h],[c,l]]=i,u=qn(e.padding),f=_t([a,Vt(l,-85.051129,Kt)]),g=_t([c,Vt(h,-85.051129,Kt)]),d=[Math.max(Math.abs(g[0]-f[0]),s),Math.max(Math.abs(g[1]-f[1]),s)],p=[t-u.left-u.right-Math.abs(o[0])*2,n-u.top-u.bottom-Math.abs(o[1])*2];B(p[0]>0&&p[1]>0);const m=p[0]/d[0],M=p[1]/d[1],P=(u.right-u.left)/2/m,E=(u.top-u.bottom)/2/M,_=[(g[0]+f[0])/2+P,(g[1]+f[1])/2+E],w=nt(_),T=Math.min(r,Bt(Math.abs(Math.min(m,M))));return B(Number.isFinite(T)),{longitude:w[0],latitude:w[1],zoom:T}}function qn(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(B(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const Xt=Math.PI/180;function Wn(e,t=0){const{width:n,height:i,unproject:s}=e,r={targetZ:t},o=s([0,i],r),a=s([n,i],r);let h,c;const l=e.fovy?.5*e.fovy*Xt:Math.atan(.5/e.altitude),u=(90-e.pitch)*Xt;return l>u-.01?(h=Qt(e,0,t),c=Qt(e,n,t)):(h=s([0,0],r),c=s([n,0],r)),[o,a,c,h]}function Qt(e,t,n){const{pixelUnprojectionMatrix:i}=e,s=X(i,[t,0,1,1]),r=X(i,[t,e.height,1,1]),a=(n*e.distanceScales.unitsPerMeter[2]-s[2])/(r[2]-s[2]),h=he([],s,r,a),c=nt(h);return c.push(n),c}const Jt=512;function $n(e){const{width:t,height:n,pitch:i=0}=e;let{longitude:s,latitude:r,zoom:o,bearing:a=0}=e;(s<-180||s>180)&&(s=Ht(s+180,360)-180),(a<-180||a>180)&&(a=Ht(a+180,360)-180);const h=Bt(n/Jt);if(o<=h)o=h,r=0;else{const c=n/2/Math.pow(2,o),l=nt([0,c])[1];if(r<l)r=l;else{const u=nt([0,Jt-c])[1];r>u&&(r=u)}}return{width:t,height:n,longitude:s,latitude:r,zoom:o,pitch:i,bearing:a}}function st(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function jn(e){return[e[12],e[13],e[14]]}function Yn(e){return{left:H(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:H(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:H(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:H(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:H(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:H(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}const te=new tt;function H(e,t,n,i){te.set(e,t,n);const s=te.len();return{distance:i/s,normal:new tt(-e/s,-t/s,-n/s)}}const Gn=Math.PI/180,Hn=st(),ee=[0,0,0],Kn={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Xn({width:e,height:t,orthographic:n,fovyRadians:i,focalDistance:s,padding:r,near:o,far:a}){const h=e/t,c=n?new W().orthographic({fovy:i,aspect:h,focalDistance:s,near:o,far:a}):new W().perspective({fovy:i,aspect:h,near:o,far:a});if(r){const{left:l=0,right:u=0,top:f=0,bottom:g=0}=r,d=Z((l+e-u)/2,0,e)-e/2,p=Z((f+t-g)/2,0,t)-t/2;c[8]-=d*2/e,c[9]+=p*2/t}return c}class wt{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||Kn,this.focalDistance=t.focalDistance||1,this.position=t.position||ee,this.modelMatrix=t.modelMatrix||null;const{longitude:n,latitude:i}=t;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?bt.WEB_MERCATOR:bt.WEB_MERCATOR_AUTO_OFFSET:bt.IDENTITY}equals(t){return t instanceof wt?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&ot(t.projectionMatrix,this.projectionMatrix)&&ot(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:n=!0}={}){const i=this.projectPosition(t),s=Dn(i,this.pixelProjectionMatrix),[r,o]=s,a=n?o:this.height-o;return t.length===2?[r,a]:[r,a,s[2]]}unproject(t,{topLeft:n=!0,targetZ:i}={}){const[s,r,o]=t,a=n?r:this.height-r,h=i&&i*this.distanceScales.unitsPerMeter[2],c=_e([s,a,o],this.pixelUnprojectionMatrix,h),[l,u,f]=this.unprojectPosition(c);return Number.isFinite(o)?[l,u,f]:Number.isFinite(i)?[l,u,i]:[l,u]}projectPosition(t){const[n,i]=this.projectFlat(t),s=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,s]}unprojectPosition(t){const[n,i]=this.unprojectFlat(t),s=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,s]}projectFlat(t){if(this.isGeospatial){const n=_t(t);return n[1]=Z(n[1],-318,830),n}return t}unprojectFlat(t){return this.isGeospatial?nt(t):t}getBounds(t={}){const n={targetZ:t.z||0},i=this.unproject([0,0],n),s=this.unproject([this.width,0],n),r=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(i[0],s[0],r[0],o[0]),Math.min(i[1],s[1],r[1],o[1]),Math.max(i[0],s[0],r[0],o[0]),Math.max(i[1],s[1],r[1],o[1])]}getDistanceScales(t){return t&&this.isGeospatial?Nt({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:n,width:i=1,height:s=1}){return t<this.x+this.width&&this.x<t+i&&n<this.y+this.height&&this.y<n+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Yn(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,n){return null}_initProps(t){const n=t.longitude,i=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=zn({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Nt({latitude:i,longitude:n}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:r,modelMatrix:o}=t;let a=ee;if(r&&(a=o?new W(o).transformAsVector(r,[]):r),this.isGeospatial){const h=this.projectPosition([n,i,0]);this.center=new tt(a).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(a)}_initMatrices(t){const{viewMatrix:n=Hn,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:r,fovy:o=75,near:a=.1,far:h=1e3,padding:c=null,focalDistance:l=1}=t;this.viewMatrixUncentered=n,this.viewMatrix=new W().multiplyRight(n).translate(new tt(this.center).negate()),this.projectionMatrix=i||Xn({width:this.width,height:this.height,orthographic:s,fovyRadians:r||o*Gn,focalDistance:l,padding:c,near:a,far:h});const u=st();rt(u,u,this.projectionMatrix),rt(u,u,this.viewMatrix),this.viewProjectionMatrix=u,this.viewMatrixInverse=Ct([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=jn(this.viewMatrixInverse);const f=st(),g=st();zt(f,f,[this.width/2,-this.height/2,1]),mt(f,f,[1,-1,0]),rt(g,f,this.viewProjectionMatrix),this.pixelProjectionMatrix=g,this.pixelUnprojectionMatrix=Ct(st(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Fe.warn("Pixel project matrix not invertible")()}}wt.displayName="Viewport";class at extends wt{constructor(t={}){const{latitude:n=0,longitude:i=0,zoom:s=0,pitch:r=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:h=1.01,nearZ:c,farZ:l,orthographic:u=!1,projectionMatrix:f,repeat:g=!1,worldOffset:d=0,position:p,padding:m,legacyMeterSizes:M=!1}=t;let{width:P,height:E,altitude:_=1.5}=t;const w=Math.pow(2,s);P=P||1,E=E||1;let T,b=null;if(f)_=f[5]/2,T=Tt(_);else{t.fovy?(T=t.fovy,_=Ee(T)):T=Tt(_);let R;if(m){const{top:C=0,bottom:V=0}=m;R=[0,Z((C+E-V)/2,0,E)-E/2]}b=Un({width:P,height:E,scale:w,center:p&&[0,0,p[2]*At(n)],offset:R,pitch:r,fovy:T,nearZMultiplier:a,farZMultiplier:h}),Number.isFinite(c)&&(b.near=c),Number.isFinite(l)&&(b.far=l)}let A=In({height:E,pitch:r,bearing:o,scale:w,altitude:_});d&&(A=new W().translate([512*d,0,0]).multiplyLeft(A)),super({...t,width:P,height:E,viewMatrix:A,longitude:i,latitude:n,zoom:s,...b,fovy:T,focalDistance:_}),this.latitude=n,this.longitude=i,this.zoom=s,this.pitch=r,this.bearing=o,this.altitude=_,this.fovy=T,this.orthographic=u,this._subViewports=g?[]:null,this._pseudoMeters=M,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),n=Math.floor((t[0]+180)/360),i=Math.ceil((t[2]-180)/360);for(let s=n;s<=i;s++){const r=s?new at({...this,worldOffset:s}):this;this._subViewports.push(r)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[n,i]=this.projectFlat(t),s=(t[2]||0)*At(t[1]);return[n,i,s]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[n,i]=this.unprojectFlat(t),s=(t[2]||0)/At(i);return[n,i,s]}addMetersToLngLat(t,n){return Bn(t,n)}panByPosition(t,n){const i=_e(n,this.pixelUnprojectionMatrix),s=this.projectFlat(t),r=Wt([],s,Ue([],i)),o=Wt([],this.center,r),[a,h]=this.unprojectFlat(o);return{longitude:a,latitude:h}}getBounds(t={}){const n=Wn(this,t.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(t,n={}){const{width:i,height:s}=this,{longitude:r,latitude:o,zoom:a}=Zn({width:i,height:s,bounds:t,...n});return new at({width:i,height:s,longitude:r,latitude:o,zoom:a})}}at.displayName="WebMercatorViewport";function kt(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!kt(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;for(const r of i)if(!t.hasOwnProperty(r)||!kt(e[r],t[r],n-1))return!1;return!0}return!1}const Qn=/([0-9]+\.?[0-9]*)(%|px)/;function I(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=Qn.exec(e);if(t&&t.length>=3){const n=t[2]==="%",i=parseFloat(t[1]);return{position:n?i/100:i,relative:n}}default:throw new Error(`Could not parse position string ${e}`)}}function U(e,t){return e.relative?Math.round(e.position*t):e.position}class Jn{constructor(t){const{id:n,x:i=0,y:s=0,width:r="100%",height:o="100%",padding:a=null}=t;this.id=n||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=I(i),this._y=I(s),this._width=I(r),this._height=I(o),this._padding=a&&{left:I(a.left||0),right:I(a.right||0),top:I(a.top||0),bottom:I(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.constructor===t.constructor&&kt(this.props,t.props,2)}makeViewport({width:t,height:n,viewState:i}){i=this.filterViewState(i);const s=this.getDimensions({width:t,height:n});if(!s.height||!s.width)return null;const r=this.getViewportType(i);return new r({...i,...this.props,...s})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...t};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return t}getDimensions({width:t,height:n}){const i={x:U(this._x,t),y:U(this._y,n),width:U(this._width,t),height:U(this._height,n)};return this._padding&&(i.padding={left:U(this._padding.left,t),top:U(this._padding.top,n),right:U(this._padding.right,t),bottom:U(this._padding.bottom,n)}),i}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class ti{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){var n,i;this.cancel(),this.settings=t,this._inProgress=!0,(i=(n=this.settings).onStart)==null||i.call(n,this)}end(){var t,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(t=this.settings).onEnd)==null||n.call(t,this))}cancel(){var t,n;this._inProgress&&((n=(t=this.settings).onInterrupt)==null||n.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var t,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:s}=this;this._handle=i.addChannel({delay:i.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(t=this.settings).onUpdate)==null||n.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const ne=()=>{},vt={BREAK:1,SNAP_TO_END:2,IGNORE:3},ei=e=>e,ni=vt.BREAK;class ii{constructor(t){this._onTransitionUpdate=n=>{const{time:i,settings:{interpolator:s,startProps:r,endProps:o,duration:a,easing:h}}=n,c=h(i/a),l=s.interpolateProps(r,o,c);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new ti(t.timeline),this.onViewStateChange=t.onViewStateChange||ne,this.onStateChange=t.onStateChange||ne}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let n=!1;const i=this.props;if(this.props=t,!i||this._shouldIgnoreViewportChange(i,t))return!1;if(this._isTransitionEnabled(t)){let s=i;if(this.transition.inProgress){const{interruption:r,endProps:o}=this.transition.settings;s={...i,...r===vt.SNAP_TO_END?o:this.propsInTransition||i}}this._triggerTransition(s,t),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:n,transitionInterpolator:i}=t;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,n){return this.transition.inProgress?this.transition.settings.interruption===vt.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(t,n):!0}_triggerTransition(t,n){const i=this.getControllerState(t),s=this.getControllerState(n).shortestPathFrom(i),r=n.transitionInterpolator,o=r.getDuration?r.getDuration(t,n):n.transitionDuration;if(o===0)return;const a=r.initializeProps(t,s);this.propsInTransition={};const h={duration:o,easing:n.transitionEasing||ei,interpolator:r,interruption:n.transitionInterruption||ni,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(n)}}}function dt(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class si{constructor(t){const{compare:n,extract:i,required:s}=t;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=s}arePropsEqual(t,n){for(const i of this._propsToCompare)if(!(i in t)||!(i in n)||!ot(t[i],n[i]))return!1;return!0}initializeProps(t,n){const i={},s={};for(const r of this._propsToExtract)(r in t||r in n)&&(i[r]=t[r],s[r]=n[r]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(t,n){return n.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(n=>{const i=t[n];dt(Number.isFinite(i)||Array.isArray(i),`${n} is required for transition`)})}}const ri=["longitude","latitude","zoom","bearing","pitch"],oi=["longitude","latitude","zoom"];class Te extends si{constructor(t={}){const n=Array.isArray(t)?t:t.transitionProps,i=Array.isArray(t)?{}:t;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:ri,required:oi},super(i.transitionProps),this.opts=i}initializeProps(t,n){const i=super.initializeProps(t,n),{makeViewport:s,around:r}=this.opts;if(s&&r){const o=s(t),a=s(n),h=o.unproject(r);i.start.around=r,Object.assign(i.end,{around:a.project(h),aroundPosition:h,width:n.width,height:n.height})}return i}interpolateProps(t,n,i){const s={};for(const r of this._propsToExtract)s[r]=Rt(t[r]||0,n[r]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...n,...s});Object.assign(s,r.panByPosition(n.aroundPosition,Rt(t.around,n.around,i)))}return s}}const D={transitionDuration:0},ai=300,ft=e=>1-(1-e)*(1-e),K={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},q={};class hi{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new ii({...t,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){var t;for(const n in this._events)this._events[n]&&((t=this.eventManager)==null||t.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const n=this._eventStartBlocked;switch(t.type){case"panstart":return n?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return n?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"multipanstart":return n?!1:this._onMultiPanStart(t);case"multipanmove":return this._onMultiPan(t);case"multipanend":return this._onMultiPanEnd(t);case"dblclick":return this._onDoubleClick(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:n,y:i}=this.props,{offsetCenter:s}=t;return[s.x-n,s.y-i]}isPointInBounds(t,n){const{width:i,height:s}=this.props;if(n&&n.handled)return!1;const r=t[0]>=0&&t[0]<=i&&t[1]>=0&&t[1]<=s;return r&&n&&n.stopPropagation(),r}isFunctionKeyPressed(t){const{srcEvent:n}=t;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=n}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:n}=t;this.inertia=Number.isFinite(n)?n:n===!0?ai:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:r=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:h=!1,keyboard:c=!0}=t,l=!!this.onViewStateChange;this.toggleEvents(K.WHEEL,l&&i),this.toggleEvents(K.PAN,l),this.toggleEvents(K.PINCH,l&&(a||h)),this.toggleEvents(K.MULTI_PAN,l&&h),this.toggleEvents(K.DOUBLE_CLICK,l&&o),this.toggleEvents(K.KEYBOARD,l&&c),this.scrollZoom=i,this.dragPan=s,this.dragRotate=r,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=h,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,n){this.eventManager&&t.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(t,n=null,i={}){const s={...t.getViewportProps(),...n},r=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(i),r){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const n=this.getCenter(t);if(!this.isPointInBounds(n,t))return!1;let i=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(s,D,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const n=this.getCenter(t),i=this.controllerState.pan({pos:n});return this.updateViewport(i,D,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:n}=this;if(this.dragPan&&n&&t.velocity){const i=this.getCenter(t),s=[i[0]+t.velocityX*n/2,i[1]+t.velocityY*n/2],r=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ft},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const n=this.getCenter(t),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,D,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:n}=this;if(this.dragRotate&&n&&t.velocity){const i=this.getCenter(t),s=[i[0]+t.velocityX*n/2,i[1]+t.velocityY*n/2],r=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ft},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const n=this.getCenter(t);if(!this.isPointInBounds(n,t))return!1;t.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:r}=t;let o=2/(1+Math.exp(-Math.abs(r*i)));r<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(t){const n=this.getCenter(t);if(!this.isPointInBounds(n,t))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,D,{isDragging:!0}),!0}_onMultiPan(t){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(t);n[0]-=t.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,D,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(t){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&t.velocityY){const i=this.getCenter(t),s=[i[0],i[1]+=t.velocityY*n/2],r=this.controllerState.rotate({pos:s});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ft},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const n=this.getCenter(t);if(!this.isPointInBounds(n,t))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return q._startPinchRotation=t.rotation,q._lastPinchEvent=t,this.updateViewport(i,D,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=t,s=this.getCenter(t);n=n.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=t;n=n.rotate({deltaAngleX:q._startPinchRotation-i})}return this.updateViewport(n,D,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),q._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=q;if(this.touchZoom&&n&&i&&t.scale!==i.scale){const s=this.getCenter(t);let r=this.controllerState.rotateEnd();const o=Math.log2(t.scale),a=(o-Math.log2(i.scale))/(t.deltaTime-i.deltaTime),h=Math.pow(2,o+a*n/2);r=r.zoom({pos:s,scale:h}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:s}),transitionDuration:n,transitionEasing:ft},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return q._startPinchRotation=null,q._lastPinchEvent=null,!0}_onDoubleClick(t){if(!this.doubleClickZoom)return!1;const n=this.getCenter(t);if(!this.isPointInBounds(n,t))return!1;const i=this.isFunctionKeyPressed(t),s=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(t),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:r,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let h;const c={};switch(t.srcEvent.code){case"Minus":h=n?a.zoomOut(i).zoomOut(i):a.zoomOut(i),c.isZooming=!0;break;case"Equal":h=n?a.zoomIn(i).zoomIn(i):a.zoomIn(i),c.isZooming=!0;break;case"ArrowLeft":n?(h=a.rotateLeft(r),c.isRotating=!0):(h=a.moveLeft(s),c.isPanning=!0);break;case"ArrowRight":n?(h=a.rotateRight(r),c.isRotating=!0):(h=a.moveRight(s),c.isPanning=!0);break;case"ArrowUp":n?(h=a.rotateUp(o),c.isRotating=!0):(h=a.moveUp(s),c.isPanning=!0);break;case"ArrowDown":n?(h=a.rotateDown(o),c.isRotating=!0):(h=a.moveDown(s),c.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),c),!0}_getTransitionProps(t){const{transition:n}=this;return!n||!n.transitionInterpolator?D:t?{...n,transitionInterpolator:new Te({...t,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class ci{constructor(t,n){this._viewportProps=this.applyConstraints(t),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const ie=5,li=1.2;class ui extends ci{constructor(t){const{width:n,height:i,latitude:s,longitude:r,zoom:o,bearing:a=0,pitch:h=0,altitude:c=1.5,position:l=[0,0,0],maxZoom:u=20,minZoom:f=0,maxPitch:g=60,minPitch:d=0,startPanLngLat:p,startZoomLngLat:m,startRotatePos:M,startBearing:P,startPitch:E,startZoom:_,normalize:w=!0}=t;dt(Number.isFinite(r)),dt(Number.isFinite(s)),dt(Number.isFinite(o)),super({width:n,height:i,latitude:s,longitude:r,zoom:o,bearing:a,pitch:h,altitude:c,maxZoom:u,minZoom:f,maxPitch:g,minPitch:d,normalize:w,position:l},{startPanLngLat:p,startZoomLngLat:m,startRotatePos:M,startBearing:P,startPitch:E,startZoom:_}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(i,t);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:r,startPitch:o}=this.getState();if(!s||r===void 0||o===void 0)return this;let a;return t?a=this._getNewRotation(t,s,o,r):a={bearing:r+n,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:n,scale:i}){let{startZoom:s,startZoomLngLat:r}=this.getState();if(r||(s=this.getViewportProps().zoom,r=this._unproject(n)||this._unproject(t)),!r)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let h=s+Math.log2(i);h=Z(h,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...c.panByPosition(r,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const n=t.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:r}=i;return Math.abs(s-n.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(r-n.longitude)>180&&(i.longitude=r<0?r+360:r-360),i}applyConstraints(t){const{maxZoom:n,minZoom:i,zoom:s}=t;t.zoom=Z(s,i,n);const{maxPitch:r,minPitch:o,pitch:a}=t;t.pitch=Z(a,o,r);const{normalize:h=!0}=t;return h&&Object.assign(t,$n(t)),t}_zoomFromCenter(t){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:t})}_panFromCenter(t){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+t[0],i/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const n=this.makeViewport(this.getViewportProps());return t&&n.unproject(t)}_getNewRotation(t,n,i,s){const r=t[0]-n[0],o=t[1]-n[1],a=t[1],h=n[1],{width:c,height:l}=this.getViewportProps(),u=r/c;let f=0;o>0?Math.abs(l-h)>ie&&(f=o/(h-l)*li):o<0&&h>ie&&(f=1-a/h),f=Z(f,-1,1);const{minPitch:g,maxPitch:d}=this.getViewportProps(),p=s+180*u;let m=i;return f>0?m=i+f*(d-i):f<0&&(m=i-f*(g-i)),{pitch:m,bearing:p}}}class fi extends hi{constructor(){super(...arguments),this.ControllerState=ui,this.transition={transitionDuration:300,transitionInterpolator:new Te({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];const n=this.props;super.setProps(t),(!n||n.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class gi extends Jn{constructor(t={}){super(t)}getViewportType(){return at}get ControllerType(){return fi}}gi.displayName="MapView";export{gi as M};
