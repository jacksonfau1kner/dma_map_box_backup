import{a as E,b as D,g as P,c as z}from"./vendor.CAFDgmtb.js";import{r as u,R as L}from"./mapbox.DCPsyBfg.js";import{M as R}from"./deck.lVF-a0_D.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();var e=E(),I=D();const M=P(I);var p=z();new R({repeat:!0});function A({index:o,setIndex:s,count:a,kpiLabels:l=[],startColor:n="#d4f9d0",endColor:i="#27e7b8",minValue:r,maxValue:f}){const c=m=>{s(parseInt(m.target.value,10))};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{className:"header-title",children:"DMA Heatmap"}),e.jsx("div",{className:"header-kpi-selector",children:e.jsx("select",{value:o,onChange:c,className:"header-select",disabled:a<=1,children:l.map((m,g)=>e.jsx("option",{value:g,children:m},g))})})]}),e.jsxs("div",{className:"header-gradient-bar",children:[r!==void 0&&e.jsx("span",{className:"header-min",children:r}),e.jsx("div",{className:"header-gradient",style:{background:`linear-gradient(90deg, ${n} 0%, ${i} 100%)`}}),f!==void 0&&e.jsx("span",{className:"header-max",children:f})]})]})}console.log("Starting Sigma plugin initialization...");try{console.log("Configuring editor panel..."),p.client.config.configureEditorPanel([{name:"source",type:"element"},{name:"dma",type:"column",source:"source",allowMultiple:!1,allowedTypes:["string","number","integer"]},{name:"numeric_value",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer"]},{name:"numeric_value2",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer"]},{name:"numeric_value3",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer"]}]),console.log("Plugin configuration successful")}catch(o){console.error("Error in plugin configuration:",o)}function O(){var x,y,j,v;const[o,s]=u.useState(null),[a,l]=u.useState(!0),[n,i]=u.useState("initializing"),[r,f]=u.useState(null),[c,m]=u.useState(null);u.useEffect(()=>{try{p.client.config.update(),i("initialized")}catch(t){console.error("Error initializing plugin:",t),s(t)}},[]);try{const t=p.useConfig();if(console.log("Config loaded:",t),t!=null&&t.source)try{const d=p.useElementData(t.source);if(console.log("Raw Sigma data:",d),d&&typeof d=="object"){const w=(x=t.dma)==null?void 0:x.split("/").pop(),b=(y=t.numeric_value)==null?void 0:y.split("/").pop(),S=(j=t.numeric_value2)==null?void 0:j.split("/").pop(),N=(v=t.numeric_value3)==null?void 0:v.split("/").pop();console.log("Extracted columns:",{dmaColumn:w,numericColumn:b,numericColumn2:S,numericColumn3:N});const C={...t,dmaColumn:w,numericColumn:b,numericColumn2:S,numericColumn3:N};f(C),m(d),i("data loaded"),l(!1)}else console.log("Data is not in expected format:",d),i("invalid data format")}catch(d){console.error("Error loading data:",d),s(d)}else console.log("No source configured yet"),i("waiting for source")}catch(t){console.error("Error loading config:",t),s(t)}const g=()=>{try{if(!c||!(r!=null&&r.dmaColumn))return 0;const t=c[r.dmaColumn];return Array.isArray(t)?t.length:0}catch(t){return console.error("Error getting data length:",t),0}},h=()=>e.jsxs("div",{style:{position:"fixed",bottom:10,left:10,background:"rgba(0,0,0,0.8)",color:"white",padding:10,borderRadius:5,fontSize:12,zIndex:9999,maxWidth:"80%",overflow:"auto"},children:[e.jsxs("div",{children:["Plugin State: ",n]}),e.jsxs("div",{children:["Loading: ",a?"Yes":"No"]}),e.jsxs("div",{children:["Error: ",o?o.message:"None"]}),e.jsxs("div",{children:["Config Present: ",r?"Yes":"No"]}),e.jsxs("div",{children:["Raw Config: ",e.jsx("pre",{children:JSON.stringify(r,null,2)})]}),e.jsx("div",{children:"Processed Columns:"}),e.jsxs("div",{children:["- DMA: ",(r==null?void 0:r.dmaColumn)||"Not set"]}),e.jsxs("div",{children:["- Numeric 1: ",(r==null?void 0:r.numericColumn)||"Not set"]}),e.jsxs("div",{children:["- Numeric 2: ",(r==null?void 0:r.numericColumn2)||"Not set"]}),e.jsxs("div",{children:["- Numeric 3: ",(r==null?void 0:r.numericColumn3)||"Not set"]}),e.jsxs("div",{children:["Data Present: ",c?"Yes":"No"]}),e.jsxs("div",{children:["Available Columns: ",c?Object.keys(c).join(", "):"None"]}),e.jsxs("div",{children:["Data Sample: ",g()," rows"]}),e.jsxs("div",{children:["Raw Data: ",e.jsx("pre",{children:JSON.stringify(c,null,2)})]})]});return a?e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,textAlign:"center"},children:[e.jsx("h2",{children:"Loading Plugin..."}),e.jsxs("div",{children:["Current State: ",n]}),e.jsx(h,{})]}):o?e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,color:"#c62828",background:"#ffebee",textAlign:"center"},children:[e.jsx("h2",{children:"Error Loading Plugin"}),e.jsxs("pre",{style:{whiteSpace:"pre-wrap",maxWidth:"80%"},children:[o.message,o.stack]}),e.jsx(h,{})]}):e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx(A,{}),e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[e.jsx("div",{children:"Plugin loaded successfully!"}),e.jsx("div",{style:{marginTop:10,fontSize:14,color:"#666"},children:r!=null&&r.source?"Source selected":"Please select a source in Sigma"}),(r==null?void 0:r.source)&&e.jsxs("div",{style:{marginTop:5,fontSize:14,color:"#666"},children:["Found ",g()," rows of data"]})]}),e.jsx(h,{})]})}async function T(){console.log("Starting app initialization...");try{console.log("Waiting for Sigma client..."),await new Promise(s=>{window.parent!==window?(console.log("Running in iframe, setting up messaging..."),window.addEventListener("message",a=>{var l;((l=a.data)==null?void 0:l.type)==="sigma-plugin-ready"&&(console.log("Sigma client ready"),s())})):s()});const o=document.getElementById("root");if(!o)throw new Error("Root element not found!");console.log("Initializing React app..."),M.render(e.jsx(L.StrictMode,{children:e.jsx(O,{})}),o),console.log("React app initialized successfully")}catch(o){console.error("Error during initialization:",o);const s=document.getElementById("root");s&&(s.innerHTML=`
        <div style="padding: 20px; color: #c62828; background: #ffebee">
          <h2>Failed to initialize application</h2>
          <pre>${o.message}</pre>
          <div style="margin-top: 20px; font-size: 12px; color: #666;">
            Debug Info:
            <br>In iframe: ${window.parent!==window}
            <br>Location: ${window.location.href}
            <br>Sigma client: ${!!p.client}
          </div>
        </div>
      `)}}T();
