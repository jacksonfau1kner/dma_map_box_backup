import{a as h,b as m,g as x,c as j}from"./vendor.CAFDgmtb.js";import{r as u,R as y}from"./mapbox.DCPsyBfg.js";import{M as v}from"./deck.lVF-a0_D.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const t of n.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&c(t)}).observe(document,{childList:!0,subtree:!0});function l(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(r){if(r.ep)return;r.ep=!0;const n=l(r);fetch(r.href,n)}})();var e=h(),w=m();const E=x(w);var g=j();new v({repeat:!0});function N({index:i,setIndex:s,count:l,kpiLabels:c=[],startColor:r="#d4f9d0",endColor:n="#27e7b8",minValue:t,maxValue:a}){const d=o=>{s(parseInt(o.target.value,10))};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{className:"header-title",children:"DMA Heatmap"}),e.jsx("div",{className:"header-kpi-selector",children:e.jsx("select",{value:i,onChange:d,className:"header-select",disabled:l<=1,children:c.map((o,p)=>e.jsx("option",{value:p,children:o},p))})})]}),e.jsxs("div",{className:"header-gradient-bar",children:[t!==void 0&&e.jsx("span",{className:"header-min",children:t}),e.jsx("div",{className:"header-gradient",style:{background:`linear-gradient(90deg, ${r} 0%, ${n} 100%)`}}),a!==void 0&&e.jsx("span",{className:"header-max",children:a})]})]})}console.log("Starting Sigma plugin initialization...");try{console.log("Configuring editor panel..."),g.client.config.configureEditorPanel([{name:"source",type:"element"},{name:"dma",type:"column",source:"source",allowMultiple:!1,allowedTypes:["string"]}]),console.log("Plugin configuration successful")}catch(i){console.error("Error in plugin configuration:",i)}function b(){const[i,s]=u.useState(null),[l,c]=u.useState(!0),[r,n]=u.useState("initializing");u.useEffect(()=>{try{g.client.config.update(),n("initialized")}catch(o){console.error("Error initializing plugin:",o),s(o)}},[]);let t=null,a=null;try{if(t=g.useConfig(),console.log("Config loaded:",t),t!=null&&t.source)try{a=g.useElementData(t.source),console.log("Data loaded:",a?"Data present":"No data"),a&&(n("data loaded"),c(!1))}catch(o){console.error("Error loading data:",o),s(o)}}catch(o){console.error("Error loading config:",o),s(o)}const d=()=>e.jsxs("div",{style:{position:"fixed",bottom:10,left:10,background:"rgba(0,0,0,0.8)",color:"white",padding:10,borderRadius:5,fontSize:12,zIndex:9999,maxWidth:"80%",overflow:"auto"},children:[e.jsxs("div",{children:["Plugin State: ",r]}),e.jsxs("div",{children:["Loading: ",l?"Yes":"No"]}),e.jsxs("div",{children:["Error: ",i?i.message:"None"]}),e.jsxs("div",{children:["Config Present: ",t?"Yes":"No"]}),e.jsxs("div",{children:["Config Details: ",JSON.stringify(t,null,2)]}),e.jsxs("div",{children:["Data Present: ",a?"Yes":"No"]}),e.jsxs("div",{children:["Data Sample: ",a&&(t!=null&&t.dma)?`${a[t.dma].length} rows`:"No data"]}),e.jsxs("div",{children:["Window Location: ",window.location.href]}),e.jsxs("div",{children:["In iframe: ",window.parent!==window?"Yes":"No"]})]});return l?e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,textAlign:"center"},children:[e.jsx("h2",{children:"Loading Plugin..."}),e.jsxs("div",{children:["Current State: ",r]}),e.jsx(d,{})]}):i?e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,color:"#c62828",background:"#ffebee",textAlign:"center"},children:[e.jsx("h2",{children:"Error Loading Plugin"}),e.jsxs("pre",{style:{whiteSpace:"pre-wrap",maxWidth:"80%"},children:[i.message,i.stack]}),e.jsx(d,{})]}):e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx(N,{}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{children:"Plugin loaded successfully!"})}),e.jsx(d,{})]})}try{console.log("Initializing Sigma client..."),window.parent!==window&&(console.log("Running in iframe, setting up messaging..."),window.addEventListener("message",i=>{i.data&&i.data.type==="sigma-plugin"&&console.log("Received Sigma message:",i.data)}))}catch(i){console.error("Error during initialization:",i)}const f=document.getElementById("root");if(!f)console.error("Root element not found!");else{console.log("Initializing React app...");try{E.render(e.jsx(y.StrictMode,{children:e.jsx(b,{})}),f),console.log("React app initialized successfully")}catch(i){console.error("Failed to initialize React app:",i),f.innerHTML=`
      <div style="padding: 20px; color: #c62828; background: #ffebee">
        <h2>Failed to initialize application</h2>
        <pre>${i.message}</pre>
      </div>
    `}}
