import{a as x,b as y,g as j,c as v}from"./vendor.CAFDgmtb.js";import{r as u,R as w}from"./mapbox.DCPsyBfg.js";import{M as S}from"./deck.lVF-a0_D.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const t of o.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&a(t)}).observe(document,{childList:!0,subtree:!0});function l(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=l(r);fetch(r.href,o)}})();var e=x(),D=y();const E=j(D);var f=v();new S({repeat:!0});function b({index:n,setIndex:s,count:l,kpiLabels:a=[],startColor:r="#d4f9d0",endColor:o="#27e7b8",minValue:t,maxValue:p}){const c=g=>{s(parseInt(g.target.value,10))};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{className:"header-title",children:"DMA Heatmap"}),e.jsx("div",{className:"header-kpi-selector",children:e.jsx("select",{value:n,onChange:c,className:"header-select",disabled:l<=1,children:a.map((g,h)=>e.jsx("option",{value:h,children:g},h))})})]}),e.jsxs("div",{className:"header-gradient-bar",children:[t!==void 0&&e.jsx("span",{className:"header-min",children:t}),e.jsx("div",{className:"header-gradient",style:{background:`linear-gradient(90deg, ${r} 0%, ${o} 100%)`}}),p!==void 0&&e.jsx("span",{className:"header-max",children:p})]})]})}console.log("Starting Sigma plugin initialization...");try{console.log("Configuring editor panel..."),f.client.config.configureEditorPanel([{name:"source",type:"element"},{name:"dma",type:"column",source:"source",allowMultiple:!1,allowedTypes:["string"]}]),console.log("Plugin configuration successful")}catch(n){console.error("Error in plugin configuration:",n)}function N(){const[n,s]=u.useState(null),[l,a]=u.useState(!0),[r,o]=u.useState("initializing"),[t,p]=u.useState(null),[c,g]=u.useState(null);u.useEffect(()=>{try{f.client.config.update(),o("initialized")}catch(i){console.error("Error initializing plugin:",i),s(i)}},[]);try{const i=f.useConfig();if(console.log("Config loaded:",i),i!=null&&i.source)try{const d=f.useElementData(i.source);console.log("Data loaded:",d?"Data present":"No data"),d&&typeof d=="object"?(p(i),g(d),o("data loaded"),a(!1)):console.log("Data is not in expected format:",d)}catch(d){console.error("Error loading data:",d),s(d)}else console.log("No source configured yet")}catch(i){console.error("Error loading config:",i),s(i)}const h=()=>{try{if(!c||!(t!=null&&t.dma)||!c[t.dma])return 0;const i=c[t.dma];return Array.isArray(i)?i.length:0}catch(i){return console.error("Error getting data length:",i),0}},m=()=>e.jsxs("div",{style:{position:"fixed",bottom:10,left:10,background:"rgba(0,0,0,0.8)",color:"white",padding:10,borderRadius:5,fontSize:12,zIndex:9999,maxWidth:"80%",overflow:"auto"},children:[e.jsxs("div",{children:["Plugin State: ",r]}),e.jsxs("div",{children:["Loading: ",l?"Yes":"No"]}),e.jsxs("div",{children:["Error: ",n?n.message:"None"]}),e.jsxs("div",{children:["Config Present: ",t?"Yes":"No"]}),e.jsxs("div",{children:["Config Source: ",(t==null?void 0:t.source)||"Not set"]}),e.jsxs("div",{children:["Config DMA Column: ",(t==null?void 0:t.dma)||"Not set"]}),e.jsxs("div",{children:["Config Details: ",e.jsx("pre",{children:JSON.stringify(t,null,2)})]}),e.jsxs("div",{children:["Data Present: ",c?"Yes":"No"]}),e.jsxs("div",{children:["Data Keys: ",c?Object.keys(c).join(", "):"None"]}),e.jsxs("div",{children:["Data Sample: ",h()," rows"]}),e.jsxs("div",{children:["Window Location: ",window.location.href]}),e.jsxs("div",{children:["In iframe: ",window.parent!==window?"Yes":"No"]})]});return l?e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,textAlign:"center"},children:[e.jsx("h2",{children:"Loading Plugin..."}),e.jsxs("div",{children:["Current State: ",r]}),e.jsx(m,{})]}):n?e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,color:"#c62828",background:"#ffebee",textAlign:"center"},children:[e.jsx("h2",{children:"Error Loading Plugin"}),e.jsxs("pre",{style:{whiteSpace:"pre-wrap",maxWidth:"80%"},children:[n.message,n.stack]}),e.jsx(m,{})]}):e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx(b,{}),e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[e.jsx("div",{children:"Plugin loaded successfully!"}),e.jsx("div",{style:{marginTop:10,fontSize:14,color:"#666"},children:t!=null&&t.source?"Source selected":"Please select a source in Sigma"})]}),e.jsx(m,{})]})}async function C(){console.log("Starting app initialization...");try{console.log("Waiting for Sigma client..."),await new Promise(s=>{window.parent!==window?(console.log("Running in iframe, setting up messaging..."),window.addEventListener("message",l=>{var a;((a=l.data)==null?void 0:a.type)==="sigma-plugin-ready"&&(console.log("Sigma client ready"),s())})):s()});const n=document.getElementById("root");if(!n)throw new Error("Root element not found!");console.log("Initializing React app..."),E.render(e.jsx(w.StrictMode,{children:e.jsx(N,{})}),n),console.log("React app initialized successfully")}catch(n){console.error("Error during initialization:",n);const s=document.getElementById("root");s&&(s.innerHTML=`
        <div style="padding: 20px; color: #c62828; background: #ffebee">
          <h2>Failed to initialize application</h2>
          <pre>${n.message}</pre>
          <div style="margin-top: 20px; font-size: 12px; color: #666;">
            Debug Info:
            <br>In iframe: ${window.parent!==window}
            <br>Location: ${window.location.href}
            <br>Sigma client: ${!!f.client}
          </div>
        </div>
      `)}}C();
