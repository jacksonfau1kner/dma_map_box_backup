import{a as E,b as R,g as L,c as z}from"./vendor.CAFDgmtb.js";import{r as d,R as C}from"./mapbox.DCPsyBfg.js";import{M as I}from"./deck.lVF-a0_D.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();var e=E(),P=R();const M=L(P);var h=z();new I({repeat:!0});function O({index:o,setIndex:l,count:a,kpiLabels:s=[],startColor:n="#d4f9d0",endColor:i="#27e7b8",minValue:r,maxValue:f}){const c=p=>{l(parseInt(p.target.value,10))};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{className:"header-title",children:"DMA Heatmap"}),e.jsx("div",{className:"header-kpi-selector",children:e.jsx("select",{value:o,onChange:c,className:"header-select",disabled:a<=1,children:s.map((p,t)=>e.jsx("option",{value:t,children:p},t))})})]}),e.jsxs("div",{className:"header-gradient-bar",children:[r!==void 0&&e.jsx("span",{className:"header-min",children:r}),e.jsx("div",{className:"header-gradient",style:{background:`linear-gradient(90deg, ${n} 0%, ${i} 100%)`}}),f!==void 0&&e.jsx("span",{className:"header-max",children:f})]})]})}console.log("Configuring editor panel...");h.client.config.configureEditorPanel([{name:"source",type:"element"},{name:"dma",type:"column",source:"source",allowMultiple:!1,allowedTypes:["string","number","integer"]},{name:"numeric_value",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer"]},{name:"numeric_value2",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer"]},{name:"numeric_value3",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer"]}]);function A(){const[o,l]=d.useState(null),[a,s]=d.useState(!0),[n,i]=d.useState("initializing"),[r,f]=d.useState(null),[c,p]=d.useState(null),t=h.useConfig(),m=t!=null&&t.source?h.useElementData(t.source):null;d.useEffect(()=>{var u,v,y,w;try{if(console.log("Config loaded:",t),t!=null&&t.source&&m)if(console.log("Raw Sigma data:",m),typeof m=="object"){const g=(u=t.dma)==null?void 0:u.split("/").pop(),b=(v=t.numeric_value)==null?void 0:v.split("/").pop(),S=(y=t.numeric_value2)==null?void 0:y.split("/").pop(),N=(w=t.numeric_value3)==null?void 0:w.split("/").pop();console.log("Extracted columns:",{dmaColumn:g,numericColumn:b,numericColumn2:S,numericColumn3:N});const D={...t,dmaColumn:g,numericColumn:b,numericColumn2:S,numericColumn3:N};f(D),p(m),i("data loaded"),s(!1)}else console.log("Data is not in expected format:",m),i("invalid data format");else console.log("No source configured yet"),i("waiting for source")}catch(g){console.error("Error processing data:",g),l(g)}},[t,m]);const j=d.useCallback(()=>{try{if(!c||!(r!=null&&r.dmaColumn))return 0;const u=c[r.dmaColumn];return Array.isArray(u)?u.length:0}catch(u){return console.error("Error getting data length:",u),0}},[c,r]),x=d.memo(()=>e.jsxs("div",{style:{position:"fixed",bottom:10,left:10,background:"rgba(0,0,0,0.8)",color:"white",padding:10,borderRadius:5,fontSize:12,zIndex:9999,maxWidth:"80%",overflow:"auto"},children:[e.jsxs("div",{children:["Plugin State: ",n]}),e.jsxs("div",{children:["Loading: ",a?"Yes":"No"]}),e.jsxs("div",{children:["Error: ",o?o.message:"None"]}),e.jsxs("div",{children:["Config Present: ",r?"Yes":"No"]}),e.jsxs("div",{children:["Raw Config: ",e.jsx("pre",{children:JSON.stringify(r,null,2)})]}),e.jsxs("div",{children:["Temp Config: ",e.jsx("pre",{children:JSON.stringify(t,null,2)})]}),e.jsx("div",{children:"Processed Columns:"}),e.jsxs("div",{children:["- DMA: ",(r==null?void 0:r.dmaColumn)||"Not set"]}),e.jsxs("div",{children:["- Numeric 1: ",(r==null?void 0:r.numericColumn)||"Not set"]}),e.jsxs("div",{children:["- Numeric 2: ",(r==null?void 0:r.numericColumn2)||"Not set"]}),e.jsxs("div",{children:["- Numeric 3: ",(r==null?void 0:r.numericColumn3)||"Not set"]}),e.jsxs("div",{children:["Data Present: ",c?"Yes":"No"]}),e.jsxs("div",{children:["Available Columns: ",c?Object.keys(c).join(", "):"None"]}),e.jsxs("div",{children:["Data Sample: ",j()," rows"]}),e.jsxs("div",{children:["Raw Data: ",e.jsx("pre",{children:JSON.stringify(c,null,2)})]}),e.jsxs("div",{children:["Environment: ",window.parent!==window?"Sigma iframe":"Direct browser"]})]}));return a?e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,textAlign:"center"},children:[e.jsx("h2",{children:"Loading Plugin..."}),e.jsxs("div",{children:["Current State: ",n]}),e.jsx(x,{})]}):o?e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,color:"#c62828",background:"#ffebee",textAlign:"center"},children:[e.jsx("h2",{children:"Error Loading Plugin"}),e.jsxs("pre",{style:{whiteSpace:"pre-wrap",maxWidth:"80%"},children:[o.message,o.stack]}),e.jsx(x,{})]}):e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx(O,{}),e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[e.jsx("div",{children:"Plugin loaded successfully!"}),e.jsx("div",{style:{marginTop:10,fontSize:14,color:"#666"},children:r!=null&&r.source?"Source selected":"Please select a source in Sigma"}),(r==null?void 0:r.source)&&e.jsxs("div",{style:{marginTop:5,fontSize:14,color:"#666"},children:["Found ",j()," rows of data"]})]}),e.jsx(x,{})]})}function T(){console.log("Starting app initialization...");const o=document.getElementById("root");if(!o){console.error("Root element not found!");return}try{console.log("Initializing React app...");class l extends C.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,n){console.error("React error caught:",s),console.error("Component stack:",n.componentStack)}render(){var s;return this.state.hasError?e.jsxs("div",{style:{padding:20,color:"#c62828",background:"#ffebee"},children:[e.jsx("h2",{children:"Failed to initialize application"}),e.jsx("pre",{children:(s=this.state.error)==null?void 0:s.message}),e.jsxs("div",{style:{marginTop:20,fontSize:12,color:"#666"},children:["Debug Info:",e.jsx("br",{}),"In iframe: ",window.parent!==window?"Yes":"No",e.jsx("br",{}),"Location: ",window.location.href,e.jsx("br",{}),"Sigma client: ",h.client?"Yes":"No"]})]}):this.props.children}}M.render(e.jsx(C.StrictMode,{children:e.jsx(l,{children:e.jsx(A,{})})}),o),console.log("React app initialized successfully"),window.parent!==window?(console.log("Running in Sigma iframe, setting up message listener..."),window.addEventListener("message",a=>{console.log("Received message:",a.origin,a.data)})):console.log("Running in direct browser mode")}catch(l){console.error("Error during initialization:",l),o.innerHTML=`
      <div style="padding: 20px; color: #c62828; background: #ffebee">
        <h2>Failed to initialize application</h2>
        <pre>${l.message}</pre>
        <div style="margin-top: 20px; font-size: 12px; color: #666;">
          Debug Info:
          <br>In iframe: ${window.parent!==window}
          <br>Location: ${window.location.href}
          <br>Sigma client: ${!!h.client}
        </div>
      </div>
    `}}T();
