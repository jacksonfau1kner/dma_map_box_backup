import{a as D,b as E,g as R,c as L}from"./vendor.CAFDgmtb.js";import{r as p,R as P}from"./mapbox.DCPsyBfg.js";import{M as z}from"./deck.lVF-a0_D.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&d(r)}).observe(document,{childList:!0,subtree:!0});function c(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(n){if(n.ep)return;n.ep=!0;const i=c(n);fetch(n.href,i)}})();var e=D(),I=E();const M=R(I);var f=L();new z({repeat:!0});function A({index:o,setIndex:s,count:c,kpiLabels:d=[],startColor:n="#d4f9d0",endColor:i="#27e7b8",minValue:r,maxValue:g}){const l=u=>{s(parseInt(u.target.value,10))};return e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{className:"header-title",children:"DMA Heatmap"}),e.jsx("div",{className:"header-kpi-selector",children:e.jsx("select",{value:o,onChange:l,className:"header-select",disabled:c<=1,children:d.map((u,m)=>e.jsx("option",{value:m,children:u},m))})})]}),e.jsxs("div",{className:"header-gradient-bar",children:[r!==void 0&&e.jsx("span",{className:"header-min",children:r}),e.jsx("div",{className:"header-gradient",style:{background:`linear-gradient(90deg, ${n} 0%, ${i} 100%)`}}),g!==void 0&&e.jsx("span",{className:"header-max",children:g})]})]})}console.log("Starting Sigma plugin initialization...");console.log("Configuring editor panel...");f.client.config.configureEditorPanel([{name:"source",type:"element"},{name:"dma",type:"column",source:"source",allowMultiple:!1,allowedTypes:["string","number","integer"]},{name:"numeric_value",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer"]},{name:"numeric_value2",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer"]},{name:"numeric_value3",type:"column",source:"source",allowMultiple:!1,allowedTypes:["number","integer"]}]);function O(){var x,v,j,y;const[o,s]=p.useState(null),[c,d]=p.useState(!0),[n,i]=p.useState("initializing"),[r,g]=p.useState(null),[l,u]=p.useState(null);try{const t=f.useConfig();if(console.log("Config loaded:",t),t!=null&&t.source)try{const a=f.useElementData(t.source);if(console.log("Raw Sigma data:",a),a&&typeof a=="object"){const w=(x=t.dma)==null?void 0:x.split("/").pop(),b=(v=t.numeric_value)==null?void 0:v.split("/").pop(),S=(j=t.numeric_value2)==null?void 0:j.split("/").pop(),N=(y=t.numeric_value3)==null?void 0:y.split("/").pop();console.log("Extracted columns:",{dmaColumn:w,numericColumn:b,numericColumn2:S,numericColumn3:N});const C={...t,dmaColumn:w,numericColumn:b,numericColumn2:S,numericColumn3:N};g(C),u(a),i("data loaded"),d(!1)}else console.log("Data is not in expected format:",a),i("invalid data format")}catch(a){console.error("Error loading data:",a),s(a)}else console.log("No source configured yet"),i("waiting for source")}catch(t){console.error("Error loading config:",t),s(t)}const m=()=>{try{if(!l||!(r!=null&&r.dmaColumn))return 0;const t=l[r.dmaColumn];return Array.isArray(t)?t.length:0}catch(t){return console.error("Error getting data length:",t),0}},h=()=>e.jsxs("div",{style:{position:"fixed",bottom:10,left:10,background:"rgba(0,0,0,0.8)",color:"white",padding:10,borderRadius:5,fontSize:12,zIndex:9999,maxWidth:"80%",overflow:"auto"},children:[e.jsxs("div",{children:["Plugin State: ",n]}),e.jsxs("div",{children:["Loading: ",c?"Yes":"No"]}),e.jsxs("div",{children:["Error: ",o?o.message:"None"]}),e.jsxs("div",{children:["Config Present: ",r?"Yes":"No"]}),e.jsxs("div",{children:["Raw Config: ",e.jsx("pre",{children:JSON.stringify(r,null,2)})]}),e.jsx("div",{children:"Processed Columns:"}),e.jsxs("div",{children:["- DMA: ",(r==null?void 0:r.dmaColumn)||"Not set"]}),e.jsxs("div",{children:["- Numeric 1: ",(r==null?void 0:r.numericColumn)||"Not set"]}),e.jsxs("div",{children:["- Numeric 2: ",(r==null?void 0:r.numericColumn2)||"Not set"]}),e.jsxs("div",{children:["- Numeric 3: ",(r==null?void 0:r.numericColumn3)||"Not set"]}),e.jsxs("div",{children:["Data Present: ",l?"Yes":"No"]}),e.jsxs("div",{children:["Available Columns: ",l?Object.keys(l).join(", "):"None"]}),e.jsxs("div",{children:["Data Sample: ",m()," rows"]}),e.jsxs("div",{children:["Raw Data: ",e.jsx("pre",{children:JSON.stringify(l,null,2)})]}),e.jsxs("div",{children:["Environment: ",window.parent!==window?"Sigma iframe":"Direct browser"]})]});return c?e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,textAlign:"center"},children:[e.jsx("h2",{children:"Loading Plugin..."}),e.jsxs("div",{children:["Current State: ",n]}),e.jsx(h,{})]}):o?e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:20,color:"#c62828",background:"#ffebee",textAlign:"center"},children:[e.jsx("h2",{children:"Error Loading Plugin"}),e.jsxs("pre",{style:{whiteSpace:"pre-wrap",maxWidth:"80%"},children:[o.message,o.stack]}),e.jsx(h,{})]}):e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx(A,{}),e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[e.jsx("div",{children:"Plugin loaded successfully!"}),e.jsx("div",{style:{marginTop:10,fontSize:14,color:"#666"},children:r!=null&&r.source?"Source selected":"Please select a source in Sigma"}),(r==null?void 0:r.source)&&e.jsxs("div",{style:{marginTop:5,fontSize:14,color:"#666"},children:["Found ",m()," rows of data"]})]}),e.jsx(h,{})]})}async function T(){console.log("Starting app initialization...");const o=document.getElementById("root");if(!o){console.error("Root element not found!");return}try{console.log("Initializing React app..."),M.render(e.jsx(P.StrictMode,{children:e.jsx(O,{})}),o),console.log("React app initialized successfully"),window.parent!==window?(console.log("Running in Sigma iframe, setting up message listener..."),window.addEventListener("message",s=>{console.log("Received message:",s.origin,s.data)})):console.log("Running in direct browser mode")}catch(s){console.error("Error during initialization:",s),o.innerHTML=`
      <div style="padding: 20px; color: #c62828; background: #ffebee">
        <h2>Failed to initialize application</h2>
        <pre>${s.message}</pre>
        <div style="margin-top: 20px; font-size: 12px; color: #666;">
          Debug Info:
          <br>In iframe: ${window.parent!==window}
          <br>Location: ${window.location.href}
          <br>Sigma client: ${!!f.client}
        </div>
      </div>
    `}}T();
